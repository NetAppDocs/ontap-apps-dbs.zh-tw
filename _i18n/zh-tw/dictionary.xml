<?xml version="1.0" encoding="UTF-8"?>
<blocks>
  <block id="d41d8cd98f00b204e9800998ecf8427e" category="summary"></block>
  <block id="30d965eef5ba25c6b9998ae38270b43e" category="doc">法律聲明</block>
  <block id="e9c44bbfd795a5d63d74c6a77afee70d" category="paragraph">法律聲明提供版權聲明、商標、專利等存取權限。</block>
  <block id="6016a2b341113bf496b719905398ecd2" category="section-title">版權</block>
  <block id="52009bb7ee17227f566cd26a02caee56" category="inline-link-macro"><block ref="52009bb7ee17227f566cd26a02caee56" category="inline-link-rx"></block></block>
  <block id="a1a9afcf552a769c282769271829889a" category="paragraph"><block ref="a1a9afcf552a769c282769271829889a" category="inline-link-macro-rx"></block></block>
  <block id="126a02652da6de02962cf1b654fd6376" category="section-title">商標</block>
  <block id="c4ce4761e466527d26b3e3d5ed1006fd" category="paragraph">NetApp 、 NetApp 標誌及 NetApp 商標頁面上列出的標章均為 NetApp 、 Inc. 的商標。其他公司與產品名稱可能為其各自所有者的商標。</block>
  <block id="f99aa604031e5049799e73b5c3748a98" category="inline-link-macro"><block ref="f99aa604031e5049799e73b5c3748a98" category="inline-link-rx"></block></block>
  <block id="5d545fe5152641e2ebe654e336e520e5" category="paragraph"><block ref="5d545fe5152641e2ebe654e336e520e5" category="inline-link-macro-rx"></block></block>
  <block id="be89498d2f8a22ce47c02ba9795fe2af" category="section-title">專利</block>
  <block id="d0b19d36be2c5f16e9aef46c8a452d3d" category="paragraph">如需最新的 NetApp 擁有專利清單、請參閱：</block>
  <block id="88e5eabd3917048b6927c42496b98f86" category="inline-link-macro"><block ref="88e5eabd3917048b6927c42496b98f86" category="inline-link-rx"></block></block>
  <block id="dd38f906b37d412de7d1c1dcf4cbf31c" category="paragraph"><block ref="dd38f906b37d412de7d1c1dcf4cbf31c" category="inline-link-macro-rx"></block></block>
  <block id="56c34c6410dd45c5cec44149ad0ce037" category="section-title">隱私權政策</block>
  <block id="8acb58cbd50ef1b468a020ee0bd351d3" category="inline-link-macro"><block ref="8acb58cbd50ef1b468a020ee0bd351d3" category="inline-link-rx"></block></block>
  <block id="2352c4e1f4d0024ade0869e00e6243f4" category="paragraph"><block ref="2352c4e1f4d0024ade0869e00e6243f4" category="inline-link-macro-rx"></block></block>
  <block id="c0227cef6f07a8cd2ac72f2945b031aa" category="section-title">開放原始碼</block>
  <block id="9b73989307c1975dfa4d5e1581e4afe8" category="paragraph">通知檔案提供有關 NetApp 軟體所使用之協力廠商版權與授權的資訊。</block>
  <block id="253b40ae359ba25b56231803430c4873" category="section-title">ONTAP</block>
  <block id="856c8958afd787f748a4a025f649154a" category="inline-link-macro">ONTAP 9.13.1 注意事項</block>
  <block id="b22b3b2970d843f99e7e6904bea05207" category="inline-link-macro">關於此功能的注意事項ONTAP 9.12.1.1</block>
  <block id="0358f41254df2d512849db5a04b7e3d4" category="inline-link-macro">關於此功能的注意事項ONTAP 9.12.0</block>
  <block id="28f1290102a277ef2fd452d558c74219" category="inline-link-macro">ONTAP 9.11.1 注意事項</block>
  <block id="57b07f14c8eb4660f94a86d29d53362d" category="inline-link-macro">關於本產品的注意事項ONTAP 9.10.1</block>
  <block id="396712eb9c1644241047ac30619b2b3e" category="inline-link-macro">ONTAP 9.10.0 注意事項</block>
  <block id="1e6000d4849ef9f3e08d1d9908e9f163" category="inline-link-macro">關於此功能的注意事項ONTAP</block>
  <block id="6f408b9c999245c7aa32bc9cb1a020f6" category="inline-link-macro">關於本產品的注意事項ONTAP 9.8</block>
  <block id="04b0bd5b1b4d414fdde93f809162d36d" category="inline-link-macro">關於產品的注意ONTAP 事項9.7</block>
  <block id="0c1d7dffcba488555d5eb39b8991e822" category="inline-link-macro">關於此功能的注意事項ONTAP</block>
  <block id="a11ac6880e72412c0f54ae19bea3d191" category="inline-link-macro">關於本產品的注意事項ONTAP</block>
  <block id="e49c3c01b15761b5f011d0bd2a0661a3" category="inline-link-macro">關於產品的注意事項ONTAP 9.4</block>
  <block id="bf7dcf6467a8a03b05b2d37d31d6eccd" category="inline-link-macro">關於本產品的注意事項ONTAP</block>
  <block id="0328352fdfda84af6968462d1a67d3a6" category="inline-link-macro">關於此功能的注意事項ONTAP 9.2</block>
  <block id="83904100c7d6fe0102e8b2b5bd8ec4bb" category="inline-link-macro">關於此產品的注意事項ONTAP</block>
  <block id="5672f5979be77bb31dd559817c9e1e76" category="paragraph"><block ref="f7a2b1db149ed9886af0ce846dbc3e14" category="inline-link-macro-rx"></block>
<block ref="b349c509ad858348b30db7e73307e3aa" category="inline-link-macro-rx"></block>
<block ref="0dce234dfded58bd461541473b86e42a" category="inline-link-macro-rx"></block>
<block ref="9760ec4df13f0afbdfec88ae16c871ae" category="inline-link-macro-rx"></block>
<block ref="b6dab2933dfb92cf0c1355707a4aec7c" category="inline-link-macro-rx"></block>
<block ref="1b7c80b26162b03bd0addd587f70df55" category="inline-link-macro-rx"></block>
<block ref="14faf912aa42102a6628af4551e02583" category="inline-link-macro-rx"></block>
<block ref="a90f36d649d3be5d386cc3563ab044fb" category="inline-link-macro-rx"></block>
<block ref="2cd65b4a044075cfd9ad4a91f42fdff4" category="inline-link-macro-rx"></block>
<block ref="5e764cc3fdcc19ff667796e414159bdc" category="inline-link-macro-rx"></block>
<block ref="561451f09c7bca700ea0d7833cd9e92e" category="inline-link-macro-rx"></block>
<block ref="d23d341a344216fbf99a91152429d49c" category="inline-link-macro-rx"></block>
<block ref="b35e8fbd7b0369b23734510994911ec4" category="inline-link-macro-rx"></block>
<block ref="41d4305cf7a6acb595086f123121a781" category="inline-link-macro-rx"></block>
<block ref="ea685649fabe77da53e843fec56f72b8" category="inline-link-macro-rx"></block></block>
  <block id="07ee2fe6f236deffba69a7cf80a680fd" category="section-title">適用於 MCC IP 的 ONTAP Mediator</block>
  <block id="f089ab2b9f25f609795bdd46ae636f18" category="inline-link-macro">9.9.1 ONTAP Mediator for MCC IP 通知</block>
  <block id="239794a299abe62705440f2dab3114cb" category="inline-link-macro">9.8 ONTAP Mediator for MCC IP 通知</block>
  <block id="51fcca20d278d2d03192c01120f17442" category="inline-link-macro">9.7 適用於 MCC IP 的 ONTAP Mediator 通知</block>
  <block id="3ba2aeb22339424d5f5b15dafd2c3eca" category="paragraph"><block ref="c8696a7854fcd089ea112145e4968b10" category="inline-link-macro-rx"></block>
<block ref="4d19e06382f392d0f1a50df789d77c13" category="inline-link-macro-rx"></block>
<block ref="fe4ac88b6b3f1cb9f1dc6d5d4b5086ee" category="inline-link-macro-rx"></block></block>
  <block id="9e476387322a5c250893cf9c5c4ce78c" category="doc">原則</block>
  <block id="b9e18a3460bc17eb9ea65b03f0167453" category="paragraph">這在資料庫中很常見。已知包含非作用中區塊的資料庫也可用於 FabricPool 分層。例如、供應鏈管理資料庫可能包含歷史資訊、這些資訊必須在必要時提供、但在正常作業期間無法存取。FabricPool 可用於選擇性地重新定位非使用中的區塊。</block>
  <block id="95e955bbbe5dd9520a6bf45b0d8a9d4c" category="paragraph">例如、在 FabricPool 磁碟區上執行的資料檔案<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 90 天的期間會保留過去 90 天內在效能層級上存取的任何區塊。然而、 90 天內未存取的任何項目都會重新移至容量層。在其他情況下、正常的應用程式活動會將正確的區塊保留在正確的層級上。例如、如果資料庫通常用於定期處理過去 60 天的資料、則會降低許多<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 可以設定期間、因為應用程式的自然活動可確保區塊不會提早重新定位。</block>
  <block id="c33af7c93d461803ceaf8531e861017d" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 原則應與資料庫一起使用。許多資料庫都有定期活動、例如季末流程或重新編製索引作業。如果這些作業的期間大於<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 可能會發生效能問題。例如、如果季度末處理需要 1TB 的資料、而這些資料原本沒有受到影響、則該資料現在可能會出現在容量層。從容量層讀取的速度通常極快、可能不會造成效能問題、但實際結果將取決於物件儲存區組態。</block>
  <block id="03431a55183cb73a12c1bbc3e1927678" category="paragraph">。<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 原則的設定應足夠高、以保留效能層上可能需要的檔案。例如、如果資料庫需要最新 60 天的資料、而且效能最佳、則需要設定<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 期間為 60 天。也可以根據檔案的存取模式來達成類似的結果。例如、如果需要最近 90 天的資料、而應用程式正在存取該 90 天的資料範圍、則資料會保留在效能層。設定<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 在資料變得不活躍之後、將會立即將資料分級至 2 天。</block>
  <block id="25d9496e96e698b08c4fc713bfc9a5ca" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 由於只有<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 原則會影響作用中檔案系統中的區塊。</block>
  <block id="55fad400d892fb6062e67904fa9be485" category="admonition">任何類型的資料存取都會重設熱圖資料。因此、資料庫完整表格掃描、甚至是讀取來源檔案的備份活動、都會因為需要而防止分層<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 從未達到臨界值。</block>
  <block id="117c4b6bad0236ab23e0fe29aead8aef" category="paragraph">雖然 LUN 調整大小是增加容量的選項、但通常最好使用 LVM 、包括 Oracle ASM 。LVM 存在的主要原因之一、是為了避免需要調整 LUN 大小。使用 LVM 時、多個 LUN 會結合在一個虛擬儲存池中。從該池中切出的邏輯卷由 LVM 管理，可以輕鬆調整大小。另一項優點是在所有可用 LUN 之間分配給定的邏輯磁碟區、以避免在特定磁碟機上出現熱點。通常可以使用 Volume Manager 將邏輯磁碟區的基礎範圍重新放置到新的 LUN 、以執行透明移轉。</block>
  <block id="4d4855a15e1f9d6fd8f8bdf1668c537e" category="doc">手動強制 NVFAIL</block>
  <block id="8772c1c8bed97f5c942657feeb8bfb6f" category="admonition">本節將進一步說明基本的 ONTAP NVFAIL 、以涵蓋 MetroCluster 專屬主題。</block>
  <block id="14d74316044293d1ebd8c5a01ff90055" category="paragraph">使用 MetroCluster 時、寫入必須登入至少一個其他控制器的本機 NVRAM 和 NVRAM 、才能被確認。此方法可確保硬體故障或停電不會導致機內 I/O 遺失如果本機 NVRAM 故障或連線至其他節點失敗、則資料將不再鏡射。</block>
  <block id="d820d86d09ea05a0de19c3aacbfb72b2" category="paragraph">如果本機 NVRAM 回報錯誤、節點會關機。當使用 HA 配對時、此關機會導致容錯移轉至合作夥伴控制器。使用 MetroCluster 時、行為取決於所選的整體組態、但可能會導致自動容錯移轉至遠端記事。無論如何、由於發生故障的控制器尚未確認寫入作業、因此不會遺失任何資料。</block>
  <block id="886174de078cee4595eb8a8d07f81703" category="paragraph">站台對站台連線故障會封鎖 NVRAM 複寫至遠端節點、這種情況更為複雜。寫入不再複寫到遠端節點、因此如果控制器發生災難性錯誤、可能會導致資料遺失。更重要的是、在這些情況下、嘗試容錯移轉至其他節點會導致資料遺失。</block>
  <block id="790ec042c9b89dac2390ea81b9c29a51" category="paragraph">控制因素是 NVRAM 是否同步。如果 NVRAM 已同步、則節點對節點容錯移轉可安全地繼續進行、而不會有資料遺失的風險。在 MetroCluster 組態中、如果 NVRAM 和基礎 Aggregate plex 同步、則在不遺失資料的情況下繼續進行轉換是安全的。</block>
  <block id="3d936bb059b98a2fc7c177d20eb755c9" category="paragraph">除非強制進行容錯移轉或切換、否則 ONTAP 不允許在資料不同步時進行容錯移轉或切換。以這種方式強制變更條件、即表示資料可能會留在原始控制器中、而且資料遺失是可以接受的。</block>
  <block id="3d37a3a8ed77bebc986238aedccecbc9" category="paragraph">如果強制進行容錯移轉或切換、則資料庫特別容易遭到毀損、因為資料庫會在磁碟上保留較大的內部資料快取。如果發生強制容錯移轉或切換、先前確認的變更將會有效捨棄。儲存陣列的內容會有效地及時向後跳轉、而且資料庫快取的狀態不再反映磁碟上資料的狀態。</block>
  <block id="7ad23b7fa394c8666b132d78a58b1987" category="paragraph">為了保護應用程式不受這種情況影響、 ONTAP 允許設定磁碟區、以針對 NVRAM 故障提供特殊保護。觸發時、此保護機制會導致磁碟區進入稱為 NVFAIL 的狀態。此狀態會導致 I/O 錯誤、導致應用程式關機、使其不使用過時的資料。資料不應遺失、因為儲存系統上仍有任何已確認的寫入資料、而資料庫則應在記錄中顯示任何已認可的交易資料。</block>
  <block id="99259586124503e22927506a7ed3738d" category="paragraph">通常的後續步驟是讓系統管理員在手動將 LUN 和磁碟區重新上線之前、先完全關閉主機。雖然這些步驟可能涉及一些工作、但這種方法是確保資料完整性的最安全方法。並非所有資料都需要這項保護、因此 NVFAIL 行為可依每個磁碟區設定。</block>
  <block id="13fbc5a220fe8007dcaea69217bba134" category="paragraph">最安全的選項是透過指定來強制轉換跨站台散佈的應用程式叢集（包括 VMware 、 Oracle RAC 及其他）<block ref="71e644310ff0f1164d905d6e80174023" prefix=" " category="inline-code"></block> 在命令列。此選項可作為緊急措施使用、以確保所有快取資料均已清除。如果主機使用的儲存資源原本位於災難性站台上、則會收到 I/O 錯誤或過時的檔案處理 <block ref="a3c6541ac12f1f06a81cc9b03e6bd094" prefix="(" category="inline-code"></block>）錯誤。Oracle 資料庫當機、檔案系統可能完全離線、或切換至唯讀模式。</block>
  <block id="dc6683d37e50abd82911fa91c036fbb2" category="paragraph">在完成重新操作之後、<block ref="6b0a5ec5ecf08db5d4b32d860214d098" prefix=" " category="inline-code"></block> 需要清除旗標、且 LUN 必須置於線上。完成此活動後、即可重新啟動資料庫。這些工作可以自動化、以降低 RTO 。</block>
  <block id="a2626552f293b2377efe829e69d14daa" category="section-title">dr-force-nvfail</block>
  <block id="f0cc4bbe3d196251009dbe9f0ac42ffc" category="paragraph">作為一般安全措施、請設定<block ref="a2626552f293b2377efe829e69d14daa" prefix=" " category="inline-code"></block> 在所有可能在正常作業期間從遠端站台存取的磁碟區上加上旗標、表示這些磁碟區是在容錯移轉之前使用的活動。此設定的結果是、選取的遠端磁碟區在進入時無法使用<block ref="6b0a5ec5ecf08db5d4b32d860214d098" prefix=" " category="inline-code"></block> 在進行重新操作時。在完成重新操作之後、<block ref="6b0a5ec5ecf08db5d4b32d860214d098" prefix=" " category="inline-code"></block> 旗標必須清除、且 LUN 必須置於線上。這些活動完成後、即可重新啟動應用程式。這些工作可以自動化、以降低 RTO 。</block>
  <block id="5f6aa76cc0fe886c07f242f921486ef7" category="paragraph">結果就像使用<block ref="71e644310ff0f1164d905d6e80174023" prefix=" " category="inline-code"></block> 手動切換的旗標。然而、受影響的磁碟區數量可能僅限於必須受到保護的磁碟區、不受具有過時快取的應用程式或作業系統的影響。</block>
  <block id="4df566a29b44806612369c0c1f67521b" category="paragraph">對於不使用的環境、有兩項關鍵需求<block ref="a2626552f293b2377efe829e69d14daa" prefix=" " category="inline-code"></block> 在應用程式磁碟區上：</block>
  <block id="aaf1cc67bd88c39a71e691d413ded49f" category="list-text">在主站台遺失後、強制進行的重新操作不得超過 30 秒。</block>
  <block id="7f9cc623e2a11875714cf4bc64f148fd" category="list-text">在維護工作期間、或是在 SyncMirror 叢或 NVRAM 複寫不同步的任何其他情況下、切勿進行切入。第一項需求可以透過使用已設定為在站台故障 30 秒內執行轉換的斷路器軟體來達成。這並不表示切入作業必須在偵測站台故障的 30 秒內執行。這表示、如果站台確認運作已過 30 秒、就不再安全地強制進行轉換。</block>
  <block id="0929cc8043c21dcf0163f06424677ede" category="paragraph">第二項需求可在已知 MetroCluster 組態不同步時停用所有自動切換功能、以部分滿足。更好的選擇是擁有可監控 NVRAM 複寫和 SyncMirror 叢的健全狀況的斷路器解決方案。如果叢集未完全同步、則斷路器不應觸發切入。</block>
  <block id="a168430c68d0310385371eabe149a118" category="paragraph">NetApp MCTB 軟體無法監控同步處理狀態、因此當 MetroCluster 因任何原因而未同步時、應該停用同步處理狀態。ClusterLion 確實包含 NVRAM 監控和叢監視功能、除非 MetroCluster 系統確認完全同步、否則可將其設定為不觸發切入。</block>
  <block id="baba038803e218b2ac3b2688bc2fd5db" category="doc">LUN 計數</block>
  <block id="b0e4db975ae00108abe9f47db9be5668" category="paragraph">LUN 是 ONTAP 上的虛擬化物件、存在於託管集合體中的所有磁碟機中。因此、 LUN 的效能不受其大小影響、因為無論選擇何種大小、 LUN 都會充分發揮彙總的效能潛力。</block>
  <block id="7235d4b71fadc2fe03d09d863c7cdd66" category="paragraph">為了方便起見、客戶可能想要使用特定大小的 LUN 。例如、如果資料庫建置在由兩個 LUN 組成的 LVM 或 Oracle ASM 磁碟群組上、每個 LUN 均為 1TB 、則該磁碟群組必須以 1TB 為增量來擴充。最好是從八個 LUN （每個 LUN 爲 500GB ）構建磁盤組，以便可以以更小的增量來增加磁盤組。</block>
  <block id="4b1ffe65479a23391a2c7f9caf467a35" category="paragraph">我們不鼓勵建立通用標準 LUN 大小的做法、因為這樣做可能會使管理變得複雜。例如、當資料庫或資料存放區的範圍介於 1TB 到 2TB 時、 100GB 的標準 LUN 大小可能運作良好、但大小為 20TB 的資料庫或資料存放區需要 200 個 LUN 。這表示伺服器重新開機時間較長、不同 UI 中需要管理的物件較多、而 SnapCenter 等產品必須在許多物件上執行探索。使用較少、較大的 LUN 可避免此類問題。</block>
  <block id="4afa3de974c36a09c2055d30989bb405" category="list-text">LUN 數量比 LUN 大小更重要。</block>
  <block id="691c70133d96d57796a9299359666f80" category="list-text">LUN 大小大多由 LUN 數需求控制。</block>
  <block id="8af9e525c143179b948a11fc382a331e" category="list-text">避免建立超過所需數量的 LUN 。</block>
  <block id="407b2218ad77513a7e3964f169d07e66" category="paragraph">與 LUN 大小不同、 LUN 數量確實會影響效能。應用程式效能通常取決於透過 SCSI 層執行平行 I/O 的能力。因此、兩個 LUN 的效能優於單一 LUN 。使用 LVM （例如 Veritas VxVM 、 Linux LVM2 或 Oracle ASM ）是提高平行度的最簡單方法。</block>
  <block id="39143fe6204f383e4ce3bb3b77926455" category="paragraph">NetApp 客戶通常從 LUN 數量增加到 16 個以上獲得最小的效益、不過測試 100% SSD 環境時、隨機 I/O 非常繁重、這已證實可進一步改善至 64 個 LUN 。</block>
  <block id="9875f7503e59521e91e519abd87f5c9e" category="paragraph">* NetApp 建議 * 下列事項：</block>
  <block id="57153ab478a4958250d76ac6bf4e3ac0" category="paragraph">一般而言、四到十六個 LUN 足以支援任何特定資料庫工作負載的 I/O 需求。由於主機 SCSI 實作的限制、少於四個 LUN 可能會造成效能限制。</block>
  <block id="de932976b195d4755fcbea64295fc7cb" category="doc">主機作業系統設定</block>
  <block id="f62cb371f65c322cd9e17a5c2cecd1c8" category="paragraph">大多數應用程式廠商文件都包含特定的 TCP 和乙太網路設定、以確保應用程式能以最佳方式運作。這些相同的設定通常足以提供最佳的 IP 型儲存效能。</block>
  <block id="ae7a0bb210cbd1edb935128116a21c55" category="section-title">乙太網路流量控制</block>
  <block id="a3c15fb208efc85bdfe72c57d56c92b8" category="paragraph">這項技術可讓用戶端要求傳送者暫時停止資料傳輸。這通常是因為接收者無法快速處理傳入的資料。一次、要求傳送者停止傳輸的中斷程度比接收者丟棄封包的中斷程度低、因為緩衝區已滿。現今作業系統中使用的 TCP 堆疊已不再如此。事實上、流量控制所造成的問題比解決的問題還多。</block>
  <block id="950d31923e253d170d6c994801ce7cec" category="paragraph">近年來、乙太網路流量控制所造成的效能問題不斷增加。這是因為乙太網路流量控制是在實體層運作。如果網路組態允許任何主機作業系統將乙太網路流量控制要求傳送至儲存系統、則所有連線的用戶端都會暫停 I/O 。由於單一儲存控制器服務的用戶端數量不斷增加、因此其中一或多個用戶端傳送流量控制要求的可能性會增加。在擁有廣泛作業系統虛擬化的客戶據點、經常會發現這個問題。</block>
  <block id="6bfd8563627c68f73c30581843441a74" category="paragraph">NetApp 系統上的 NIC 不應接收流量控制要求。實現此結果的方法因網路交換器製造商而異。在大多數情況下、可將乙太網路交換器上的流量控制設定為<block ref="a67b5ddb674c9ca32d9c9e1ca81578ee" prefix=" " category="inline-code"></block> 或<block ref="f4eb0bfa09695eb47ff4f3bd3ca4449d" prefix=" " category="inline-code"></block>，這意味着流控制請求不會轉發到存儲控制器。在其他情況下、儲存控制器上的網路連線可能不允許停用流程控制。在這些情況下、用戶端必須設定為永遠不要傳送流量控制要求、方法是變更至主機伺服器本身的 NIC 組態、或是變更主機伺服器所連接的交換器連接埠。</block>
  <block id="7496f3ff64e30d4732c2c64880faf186" category="admonition">* NetApp 建議 * 確保 NetApp 儲存控制器不會接收乙太網路流量控制封包。這通常可以透過設定控制器所連接的交換器連接埠來完成、但有些交換器硬體有限制、可能需要改用用戶端端變更。</block>
  <block id="ae6d0fc57efaf02ad7dfdacd3575e315" category="section-title">MTU 大小</block>
  <block id="ff13ea04765cd9c9aed7b839f15eb2b4" category="paragraph">使用巨型框架的結果顯示、透過降低 CPU 和網路成本、可在速度較低的網路中提供一些效能改善、但效益通常並不顯著。</block>
  <block id="ee3f364287a30ef10dfdce2f37d94ed2" category="admonition">* NetApp 建議 * 盡可能實作巨型框架、以實現任何可能的效能效益、並確保解決方案符合未來需求。</block>
  <block id="2c6ba27b7ed602a9089da6ad9f762c9a" category="paragraph">在 10Gb 網路中使用巨型框架幾乎是強制性的。這是因為大多數的 10Gb 實作都達到每秒封包數的限制、而不需要巨型框架、就能達到 10Gb 標誌。使用巨型框架可改善 TCP/IP 處理效率、因為它可讓作業系統、伺服器、 NIC 和儲存系統處理較少但較大的封包。效能的改善因 NIC 而異、但成效相當顯著。</block>
  <block id="a44be1bbfde97e4a64b50282325165e7" category="paragraph">對於巨型框架實作、通常但不正確的看法是、所有連線的裝置都必須支援巨型框架、而且 MTU 大小必須與端點對端點相符而是在建立連線時、兩個網路端點會協商最高的雙方可接受的框架大小。在一般環境中、網路交換器的 MTU 大小設為 9216 、 NetApp 控制器設為 9000 、用戶端則設為 9000 和 1514 的混合。支援 9000 MTU 的用戶端可以使用巨型框架、而只支援 1514 的用戶端可以協商較低的值。</block>
  <block id="a31484167f31e1c3f36f7cea821bc581" category="paragraph">在完全交換的環境中、這種配置的問題很少發生。不過、在沒有中繼路由器被迫分割巨型框架的路由環境中、請務必小心。</block>
  <block id="c805e9846e6fca449dbe3233cc5dbdf5" category="paragraph">* NetApp 建議 * 設定下列項目：</block>
  <block id="b4446b5ca60d915111af271495bd4c17" category="list-text">使用 1 GB 乙太網路（ GbE ）時、巨型框架是理想的選擇、但不是必要的。</block>
  <block id="5b1ea13ac12a9c8be0d09303f637dba4" category="list-text">使用 10GbE 及更快的速度、需要巨型框架才能達到最佳效能。</block>
  <block id="08a8dce78637f5dd14ed052163feb9da" category="section-title">TCP 參數</block>
  <block id="1a999618685598bee637262fe589de70" category="paragraph">三項設定通常設定錯誤： TCP 時間戳記、選擇性認可（ SACK ）和 TCP 視窗縮放。網際網路上的許多過時文件建議停用一或多個這些參數、以改善效能。這項建議在多年前就有一些優點、因為 CPU 功能較低、因此有助於盡可能降低 TCP 處理的成本。</block>
  <block id="6a594ec6f0bb742c1d2b0f631cf65ba1" category="paragraph">然而、在現代化的作業系統中、停用任何這些 TCP 功能通常會導致無法偵測的效益、同時也可能造成效能受損。在虛擬化網路環境中、效能受損的可能性特別大、因為這些功能是有效處理封包遺失和網路品質變更所必需的。</block>
  <block id="cdc44d05b1633e8a8c7835010c423dd6" category="admonition">* NetApp 建議 * 在主機上啟用 TCP 時間戳記、 SACK 和 TCP 視窗縮放功能、而且在任何目前的作業系統中、這三個參數都應該預設為開啟。</block>
  <block id="72a921ac9177188a9be32ec711fc15d8" category="doc">路徑存取</block>
  <block id="544c599da087dba677a820c3df344503" category="paragraph">SnapMirror Business Continuity （ SM-BC ）基本上是 SAN 的強化 SnapMirror 功能、可讓主機從主控 LUN 的系統以及主控其複本的系統存取 LUN 。</block>
  <block id="6139cdabb39d5ceac18a60642497c6a7" category="paragraph">SMBC 和 SnapMirror Sync （ SM-S ）共用複寫引擎、不過 SMBC 還包含其他功能、例如企業應用程式的透明應用程式容錯移轉和容錯回復。</block>
  <block id="a73743f15de974052b0640c60f489d90" category="paragraph">實際上、它的運作方式類似於精細的 MetroCluster 版本、可針對個別工作負載啟用選擇性且精細的 RPO = 0 同步複寫。低階路徑行為與 MetroCluster 非常不同、但主機觀點的最終結果卻相似。</block>
  <block id="b3bf85c7b0a17286752c110f404a7035" category="paragraph">SM-BC 可讓主儲存陣列和遠端儲存陣列中的主機作業系統看到儲存裝置。路徑是透過非對稱式邏輯單元存取（ ALUA ）進行管理、這是一種業界標準傳輸協定、用於識別儲存系統與主機之間的最佳化路徑。</block>
  <block id="cbf0bd4f4096570f567049c984f8c9d3" category="paragraph">存取 I/O 最短的裝置路徑被視為主動 / 最佳化路徑、其餘路徑則被視為主動 / 非最佳化路徑。</block>
  <block id="350b9208772a185e0d0943b105765d89" category="paragraph">SM-BC 關係是位於不同叢集上的一對 SVM 之間的關係。兩個 SVM 都能提供資料、但 ALUA 會優先使用 SVM 、而 SVM 目前擁有 LUN 所在磁碟機的所有權。遠端 SVM 的 IO 將透過 SM-BC 互連代理。</block>
  <block id="341d84aa26cb4521474864e04ea2a63b" category="inline-image-macro">錯誤：缺少圖形影像</block>
  <block id="532db5273379dd6149d97b7ab6e420b6" category="paragraph"><block ref="532db5273379dd6149d97b7ab6e420b6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b56265ceb6311e42003e668438136a59" category="section-title">同步複寫</block>
  <block id="8159c40a86db91b72e00c2eb5cf751fe" category="paragraph">在正常作業中、遠端複本始終為 RPO = 0 同步複本、但有一個例外。如果無法複寫資料、 SM-BC 將釋出複寫資料和恢復服務 IO 的需求。如果客戶認為複寫連結遺失的情況近乎災難、或是不想在無法複寫資料時停止業務作業、則偏好使用此選項。</block>
  <block id="0cf4a786acebd750bbfdfc4416c89406" category="section-title">儲存硬體</block>
  <block id="f0fd4c8ee2422af8e335cc85c485ccbf" category="paragraph">與其他儲存災難恢復解決方案不同、 SM-BC 提供非對稱式平台靈活度。每個站台的硬體不一定相同。此功能可讓您調整支援 SM-BC 所用硬體的大小。如果遠端儲存系統需要支援完整的正式作業工作負載、則它可以與主要站台相同、但如果災難導致 I/O 減少、遠端站台上較小的系統可能會更具成本效益。</block>
  <block id="ea9f3de5dd21190fbc6bca180b2040f1" category="section-title">中間器ONTAP</block>
  <block id="b378eb5f2b386494f24a3f09afd8ae1f" category="paragraph">ONTAP Mediator 是從 NetApp 支援下載的軟體應用程式。中介程序可自動執行主與遠端站台儲存叢集的容錯移轉作業。它可以部署在內部部署或雲端的小型虛擬機器（ VM ）上。設定之後、它會成為第三個站台、用來監控兩個站台的容錯移轉案例。</block>
  <block id="0f54fb931dbdeea735f18a8e73f9eab5" category="doc">使用 SyncMirror 保護資料</block>
  <block id="d7023f86951b6c3c009891a468c3effd" category="paragraph">在最簡單的層級上、同步複寫表示必須先對鏡射儲存設備的兩側進行任何變更、然後才會被確認。例如、如果資料庫正在寫入記錄檔、或是正在修補 VMware 來賓作業系統、則寫入作業絕不能遺失。作爲一種協議級別，在兩個站點上的非易失性介質被認可之前，存儲系統不得確認寫入內容。只有這樣、在不遺失資料的風險下繼續作業是安全的。</block>
  <block id="eee4f7a4e0ed3a8646a97bcf3e118fb9" category="paragraph">使用同步複寫技術是設計和管理同步複寫解決方案的第一步。最重要的考量是瞭解在各種計畫性和非計畫性失敗案例中可能發生的情況。並非所有同步複寫解決方案都提供相同的功能。如果您需要提供零恢復點目標（ RPO ）的解決方案、亦即零資料遺失、則必須考慮所有故障情況。特別是、當站台之間的連線中斷而無法進行複寫時、預期會產生什麼結果？</block>
  <block id="71554672a088c43ab21c759ddd161928" category="section-title">SyncMirror 資料可用度</block>
  <block id="bec293a9cf8e49ec40e6a4fdc02b9146" category="paragraph">MetroCluster 複寫是以 NetApp SyncMirror 技術為基礎、其設計旨在有效率地切換至同步模式及從同步模式切換到同步模式。這項功能符合要求同步複寫、但也需要高可用度資料服務的客戶需求。例如、如果中斷與遠端站台的連線、通常最好讓儲存系統繼續以非複寫狀態運作。</block>
  <block id="9a9ce41f4b23474045b6c6e0ac7752af" category="paragraph">許多同步複寫解決方案只能以同步模式運作。這種類型的全或全無複寫有時稱為 Domino 模式。這類儲存系統會停止提供資料、而不允許資料的本機和遠端複本變得不同步。如果複寫被強制中斷、重新同步可能會非常耗時、而且可能會讓客戶在重新建立鏡像期間暴露在完全資料遺失的風險中。</block>
  <block id="8646bb558f8f18a200cce2f70602627a" category="paragraph">SyncMirror 不僅可以在無法連線到遠端站台時、無縫切換至同步模式、也可以在連線恢復時、快速重新同步至 RPO = 0 狀態。遠端站台的資料過時複本也可在重新同步期間保留為可用狀態、以確保資料的本機和遠端複本隨時都存在。</block>
  <block id="995f5151d2d1c0a4e8371b2b3c9b6e5b" category="paragraph">在需要 Domino 模式的情況下、 NetApp 提供 SnapMirror 同步（ SM-S ）。應用程式層級選項也存在、例如 Oracle DataGuard 或主機端磁碟鏡射的延長逾時。如需其他資訊和選項、請洽詢您的 NetApp 或合作夥伴客戶團隊。</block>
  <block id="1d12d7a206d9b5337ae6fa442f23d377" category="doc">僅限 Snapshot</block>
  <block id="64c29f2f2feedeb607ff588b13d9758b" category="paragraph">。<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block><block ref="964193481f440d73ce3474a7a09bc3ac" prefix=" " category="inline-code"></block> 僅適用於未與作用中檔案系統共用的區塊。它基本上會導致資料庫備份分層。在建立快照之後、區塊會成為分層的候選項目、然後區塊會被覆寫、導致區塊只存在於快照中。A 之前的延遲<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 區塊視為冷區、由控制<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 音量設定。ONTAP 9.8 的範圍為 2 至 183 天。</block>
  <block id="ebd9889c847a7a3ddeccd2717ead46f2" category="paragraph">許多資料集的變更率都很低、因此這項原則可節省的成本極低。例如、在 ONTAP 上觀察到的典型資料庫每週變更率低於 5% 。資料庫歸檔記錄檔可能佔用大量空間、但通常會繼續存在於作用中的檔案系統中、因此不會成為根據此原則分層的候選項目。</block>
  <block id="06b9281e396db002010bde1de57262eb" category="section-title">自動</block>
  <block id="ecf602bd5abbd6a605debedbb6c3d4e0" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 分層原則可將分層延伸至快照專用區塊、以及作用中檔案系統內的區塊。區塊冷卻前的延遲由控制<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 音量設定。ONTAP 9.8 的範圍為 2 至 183 天。</block>
  <block id="6256ce48698ff0bde6f818679cdfb382" category="paragraph">此方法可啟用無法與搭配使用的分層選項<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 原則。例如、資料保護原則可能需要保留 90 天的特定記錄檔。如果將冷卻期設定為 3 天、則任何超過 3 天的記錄檔都會從效能層中分層移出。此動作可釋放效能層級上的大量空間、同時仍可讓您檢視及管理完整的 90 天資料。</block>
  <block id="6adf97f83acf6453d4a6a4b1070f3754" category="section-title">無</block>
  <block id="7026ff5c5d4ab3946ff2d86f0e2cca6f" category="paragraph">。<block ref="334c4a4c42fdb79d7ebc3e73b517e6f8" prefix=" " category="inline-code"></block> 分層原則可防止任何額外的區塊從儲存層分層、但容量層中的任何資料仍會保留在容量層中、直到讀取為止。如果接著讀取區塊、則會將其拉回並放置在效能層上。</block>
  <block id="d152c7b0939fb6d35fdb0433de0d6369" category="paragraph">使用的主要原因<block ref="334c4a4c42fdb79d7ebc3e73b517e6f8" prefix=" " category="inline-code"></block> 分層原則旨在防止區塊分層、但隨著時間推移而變更原則可能會很有用。例如、假設某個特定資料集已廣泛分層至容量層、但卻產生對完整效能功能的非預期需求。可變更原則以防止任何額外的分層、並確認隨 IO 增加而讀取的任何區塊仍保留在效能層中。</block>
  <block id="b1c94ca2fbc3e78fc30069c8d0f01680" category="section-title">全部</block>
  <block id="84826d7e23dfac7549819d5115fdcedd" category="paragraph">。<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 分層原則取代了<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> 原則自 ONTAP 9.6 起。。<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> 原則僅套用至資料保護磁碟區、意指 SnapMirror 或 NetApp SnapVault 目的地。。<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 原則的功能相同、但不限於資料保護磁碟區。</block>
  <block id="10d8500e282e8bbacd668af6f773f412" category="paragraph">有了這項原則、就能立即將區塊視為酷炫、並立即分層至容量層。</block>
  <block id="ec583de0216b95bc673c84e4ec9356e6" category="paragraph">此原則特別適用於長期備份。它也可以用作階層式儲存管理（ HSM ）的形式。過去、 HSM 通常用於將檔案的資料區塊分層至磁帶、同時讓檔案本身在檔案系統上保持可見。具有的 FabricPool Volume<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 原則可讓您將檔案儲存在可見且可管理的環境中、但幾乎無需佔用本機儲存層的空間。</block>
  <block id="79768a069a539d4f130e672a660bf45f" category="doc">分區</block>
  <block id="79da1502ddfac887bfdf0d92f2428fe6" category="paragraph">這包括典型的規劃措施、例如確保主機和儲存系統之間的 SAN 上有足夠的頻寬、使用 FC 交換器廠商所需的 FC 連接埠設定、檢查所有必要裝置之間是否存在所有 SAN 路徑、避免 ISL 爭用、 並使用適當的 SAN 架構監控。</block>
  <block id="a0bdb98e8b9da585816478d24278e42f" category="paragraph">FC 區域不得包含多個啟動器。這種安排一開始可能會運作、但啟動器之間的串擾最終會影響效能和穩定性。</block>
  <block id="8ef958d9e25538841b306960ab117626" category="paragraph">雖然在極少數情況下、來自不同廠商的 FC 目標連接埠行為造成問題、但多目標區域通常被視為安全區域。例如、避免將 NetApp 和非 NetApp 儲存陣列的目標連接埠同時納入同一區域。此外、將 NetApp 儲存系統和磁帶裝置置於同一個區域、更有可能造成問題。</block>
  <block id="642223473862db290604321fe2ebe763" category="doc">SVM</block>
  <block id="47ea917cf14ad91c68c407f90a7a189d" category="paragraph">SVM 在 ONTAP CLI 中稱為 vserver 、是基本的儲存功能單元、比較 SVM 與 VMware ESX 伺服器上的客體是很有用的。</block>
  <block id="9efbaa34de852e33319ca8ceb1861832" category="paragraph">首次安裝時、 ESX 沒有預先設定的功能、例如代管來賓作業系統或支援終端使用者應用程式。它是空容器、直到定義虛擬機器（ VM ）為止。ONTAP 類似。第一次安裝 ONTAP 時、只有建立 SVM 、它才具備資料服務功能。定義資料服務的是 SVM 特性設定。</block>
  <block id="13ce2622b2cc2118c44d3aae7df8167d" category="paragraph">與儲存架構的其他層面一樣、 SVM 和邏輯介面（ LIF ）設計的最佳選項、在很大程度上取決於擴充需求和業務需求。</block>
  <block id="8fb41a27984f0beba2e12fb920a486aa" category="paragraph">我們並未正式提供 ONTAP 的 SVM 資源配置最佳實務做法。正確的方法取決於管理和安全要求。</block>
  <block id="f4d8541bb6d07f7533a6b5aa6cfb2455" category="paragraph">大多數客戶只需操作一部主要 SVM 、即可滿足大部分的日常需求、然後針對特殊需求建立少量 SVM 。例如、您可能想要建立：</block>
  <block id="259908e9e431c0fbb9d425249ceb7930" category="list-text">由專業團隊管理的關鍵業務資料庫 SVM</block>
  <block id="0e10f2715884f3538282397d69b2cd00" category="list-text">開發群組的 SVM 已獲得完整的管理控制權、可讓他們獨立管理自己的儲存設備</block>
  <block id="7624156e307247e4ea1ec8bf574136a1" category="list-text">必須限制管理團隊的 SVM 、用於處理敏感業務資料、例如人力資源或財務報告資料</block>
  <block id="e5e09031843479ef9ef8cbbd4c2f404c" category="inline-link-macro">NetApp Hardware Universe</block>
  <block id="bd32656670155eb09690047819fc0971" category="paragraph">在多租戶環境中、每個租戶的資料都可以獲得專屬的 SVM 。每個叢集、 HA 配對和節點的 SVM 和生命量限制取決於所使用的傳輸協定、節點模型和 ONTAP 版本。  請參閱 <block ref="41f66f34b3a905f864500c9319fdff8f" category="inline-link-macro-rx"></block> 針對這些限制。</block>
  <block id="fb012f1e7970d8285bd5d6c5a7f7d523" category="doc">SSD 集合體、包括 AFF 系統</block>
  <block id="cb8e4651c457f71d5788f38eac01471f" category="paragraph">可用空間定義為任何不用於實際資料的空間、並包括集合體本身的未分配空間、以及組成磁碟區內的未使用空間。也必須考慮精簡配置。例如、某個磁碟區可能包含 1TB LUN 、其中只有 50% 被實際資料使用。在精簡佈建的環境中、這似乎是消耗 500GB 的空間。不過、在完全佈建的環境中、 1TB 的完整容量似乎正在使用中。500GB 的未分配空間會隱藏起來。實際資料未使用此空間、因此應納入總可用空間的計算。</block>
  <block id="d3487661d9a0702bd5915d49070f62dc" category="paragraph">NetApp 對於企業應用程式所使用的儲存系統建議如下：</block>
  <block id="678e476783bceae80094bcb4c1f32969" category="admonition">* NetApp 建議 * 至少有 10% 的可用空間。這包括所有未使用的空間、包括集合體或磁碟區內的可用空間、以及因使用完整資源配置而分配但實際資料未使用的任何可用空間。邏輯空間並不重要、問題在於實際可用的實體空間可用於資料儲存。</block>
  <block id="2171d172d184f1202a686849c85dce91" category="paragraph">10% 可用空間的建議非常保守。SSD 集合體可支援使用率更高的工作負載、而不會對效能造成任何影響。不過、隨著 Aggregate 的使用率增加、如果未仔細監控使用率、則用盡空間的風險也會增加。此外、當系統的容量達到 99% 時、可能不會導致效能降低、但在訂購額外硬體時、可能需要管理人員努力避免系統完全裝滿、而且可能需要一些時間來採購和安裝額外的磁碟機。</block>
  <block id="789243e17acb0b134f435d6c4c1350f2" category="section-title">HDD 集合體、包括 Flash Pool 集合體</block>
  <block id="7302e9f16fb8c5bc30f6035fe4098b52" category="admonition">* 使用旋轉磁碟機時、 NetApp 建議 * 至少有 15% 的可用空間。這包括所有未使用的空間、包括集合體或磁碟區內的可用空間、以及因使用完整資源配置而分配但實際資料未使用的任何可用空間。在免費語音方法中、效能將受到 10% 的影響。</block>
  <block id="0b0a68e2dedde9c0b9a3ea4276f4b85c" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 原則是最適合備份資料的原則。如此可確保在達到冷卻臨界值時、無論主要檔案系統中的檔案是否已刪除或繼續存在、都能立即分層。將所有可能需要的檔案儲存在作用中檔案系統的單一位置、也能簡化管理。沒有理由搜尋快照以找出需要還原的檔案。</block>
  <block id="11a75a1257cc68a4a46bc553dabe0c0d" category="paragraph">。<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 原則可以生效、但該原則僅適用於不在作用中檔案系統中的區塊。因此、必須先刪除 NFS 或 SMB 共用上的檔案、才能分層化資料。</block>
  <block id="b4af96e8cea99b56592db816cab30fce" category="paragraph">使用 LUN 組態時、此原則的效率會更低、因為從 LUN 刪除檔案只會從檔案系統中繼資料中移除檔案參照。LUN 上的實際區塊會一直保留到位、直到被覆寫為止。這種情況可能會造成從刪除檔案到覆寫區塊並成為分層候選項目之間的長時間延遲。移動有一些好處<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 區塊到容量層、但整體而言、備份資料的 FabricPool 管理最適合搭配使用<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 原則。</block>
  <block id="1c237d1ebcdeff13ae0145c741d9401d" category="admonition">此方法可協助使用者更有效率地管理備份所需的空間、但 FabricPool 本身並不是備份技術。將備份檔案分層至物件存放區可簡化管理、因為檔案仍可在原始儲存系統上看到、但物件存放區目的地中的資料區塊則取決於原始儲存系統。如果來源磁碟區遺失、物件儲存區資料將無法再使用。</block>
  <block id="a19665c8f7c0210f96ad2934ad0ee361" category="paragraph">在 ONTAP 系統上、儲存設備是以 4KB 為單位進行組織。資料庫或檔案系統 8KB 區塊應對應至兩個 4KB 區塊。如果 LUN 組態發生錯誤、在任一方向將對齊移至 1KB 、則每個 8KB 區塊會存在於三個不同的 4KB 儲存區塊、而非兩個。這種安排會導致延遲增加、並導致在儲存系統中執行額外的 I/O 。</block>
  <block id="211a9fe299057fe8665b591dddbac56d" category="paragraph">對齊也會影響 LVM 架構。如果在整個磁碟機裝置上定義邏輯磁碟區群組內的實體磁碟區（不建立分割區）、 LUN 上的前 4KB 區塊會與儲存系統上的前 4KB 區塊對齊。這是正確的對齊方式。磁碟分割發生問題、因為它們會移轉作業系統使用 LUN 的起始位置。只要偏移量以 4KB 的整體單位移動、 LUN 就會對齊。</block>
  <block id="7c8a0aad1f59988f8160921a07203bb4" category="paragraph">在 Linux 環境中、在整個磁碟機裝置上建立邏輯磁碟區群組。當需要磁碟分割時、請執行檢查對齊<block ref="16ae8c2dc7757a3180ce37bad780251a" prefix=" " category="inline-code"></block> 並驗證每個分割區的開始時間為八個之倍數。這表示分割區從八個 512 位元組磁區的倍數開始、即 4KB 。</block>
  <block id="e98a692d783d8d778aab49ed4c55e214" category="doc">站台故障保護： NVRAM 和 MetroCluster</block>
  <block id="186577daf29184ed8a55cf899ba2979c" category="paragraph">MetroCluster 以下列方式擴充 NVRAM 資料保護：</block>
  <block id="679f5a5873d7d3378cf4b3035fd5cb13" category="list-text">在雙節點組態中、 NVRAM 資料會使用交換器間連結（ ISL ）複寫到遠端合作夥伴。</block>
  <block id="00bec98f52b9151dd2e0c760becd4ca8" category="list-text">在 HA 配對組態中、 NVRAM 資料會同時複寫到本機合作夥伴和遠端合作夥伴。</block>
  <block id="94deccfbf8f798c1661000b27a568b18" category="list-text">寫入內容必須複寫到所有合作夥伴、才能予以確認。此架構可將 NVRAM 資料複寫至遠端合作夥伴、保護機上 I/O 不受站台故障影響。此程序不涉及磁碟機層級的資料複寫。擁有該集合體的控制器負責將資料複寫至集合體中的兩個叢集、但在站台遺失時仍必須保護資料、避免在執行中遺失 I/O 。只有當合作夥伴控制器必須接管故障控制器時、才會使用複寫的 NVRAM 資料。</block>
  <block id="996aa1ed8a906e55c7f157a1643021b7" category="section-title">站台和機櫃故障保護： SyncMirror 和叢</block>
  <block id="1c114a932963683e04dc7dece97c15c9" category="paragraph">SyncMirror 是一項鏡射技術、可增強但不取代 RAID DP 或 RAID-TEC 。它會鏡射兩個不同 RAID 群組的內容。邏輯組態如下：</block>
  <block id="b4b4f1d65cb5f1370402220b00584e79" category="list-text">磁碟機會根據位置設定成兩個集區。一個集區由站台 A 上的所有磁碟機組成、第二個集區由站台 B 上的所有磁碟機組成</block>
  <block id="418f0763b76bff8e324f1afdd5456b49" category="list-text">接著會根據鏡射的 RAID 群組集建立通用儲存池（稱為 Aggregate ）。從每個站台擷取的磁碟機數量相等。例如、 20 個磁碟機的 SyncMirror Aggregate 將由站台 A 的 10 個磁碟機和站台 B 的 10 個磁碟機組成</block>
  <block id="51bf74357f742acfa0a7cd11ce52ed7f" category="list-text">指定站台上的每組磁碟機都會自動設定為一個或多個完全備援的 RAID DP 或 RAID-TEC 群組、而不受鏡像的使用影響。在鏡射下使用 RAID 、即使在站台遺失之後、也能提供資料保護。</block>
  <block id="8a35ad1e53533c7a3a8ff427bda0deb2" category="paragraph"><block ref="8a35ad1e53533c7a3a8ff427bda0deb2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="abf64dbc3ac20af1b4a30150a016ca58" category="paragraph">上圖說明 SyncMirror 組態範例。在控制器上建立了 24 個磁碟機的集合體、其中 12 個磁碟機來自於站台 A 上配置的機櫃、 12 個磁碟機來自站台 B 上配置的機櫃磁碟機分為兩個鏡射 RAID 群組。RAID 群組 0 包含站台 A 的 6 磁碟機叢、鏡射到站台 B 的 6 磁碟機叢同樣地、 RAID 群組 1 也包含站台 A 的 6 磁碟叢叢、鏡射到站台 B 的 6 磁碟叢叢</block>
  <block id="d9945e1dbadc87ba8e52a5e69376005c" category="paragraph">SyncMirror 通常用於提供 MetroCluster 系統的遠端鏡射、每個站台都有一份資料複本。有時候、它是用來在單一系統中提供額外的備援層級。特別是提供機架層級的備援。磁碟機櫃已包含雙電源供應器和控制器、整體上比金屬板稍多、但在某些情況下、可能需要額外的保護。例如、有一位 NetApp 客戶部署 SyncMirror 、用於汽車測試期間使用的行動即時分析平台。系統分為兩個實體機架、分別隨附獨立的電源饋送和獨立的 UPS 系統。</block>
  <block id="f3495a1e6cf563a617c71164f3b11ca3" category="section-title">備援故障： NVFAIL</block>
  <block id="c7474a3ed1a224804e4741a256bdd953" category="paragraph">如前所述、寫入必須先登入本機 NVRAM 及至少一個其他控制器上的 NVRAM 、才會被確認。此方法可確保硬體故障或停電不會導致機內 I/O 遺失如果本機 NVRAM 故障或連線至其他節點失敗、則資料將不再鏡射。</block>
  <block id="4774101e81ea03c43fe20e0d7f2d21d1" category="paragraph">控制因素是 NVRAM 是否同步。如果 NVRAM 已同步、則節點對節點容錯移轉可安全地繼續進行、不會有資料遺失的風險。在 MetroCluster 組態中、如果 NVRAM 和基礎 Aggregate plex 同步、則可以安全地繼續進行轉換、而不會有資料遺失的風險。</block>
  <block id="03e97c023521445cd70307afabdcf0d5" category="paragraph">如果強制進行容錯移轉或切換、資料庫和其他應用程式尤其容易毀損、因為它們會在磁碟上保留較大的內部資料快取。如果發生強制容錯移轉或切換、先前確認的變更將會有效捨棄。儲存陣列的內容會有效地及時向後跳轉、而且快取狀態不再反映磁碟上資料的狀態。</block>
  <block id="ff7a32ed70b7df57dd29a3ed75e8c787" category="paragraph">為了避免這種情況發生、 ONTAP 允許設定磁碟區、以針對 NVRAM 故障提供特殊保護。觸發時、此保護機制會導致磁碟區進入稱為 NVFAIL 的狀態。此狀態會導致 I/O 錯誤、導致應用程式當機。這項當機會導致應用程式關機、使其不使用過時的資料。資料不應遺失、因為記錄中應存在任何已認可的交易資料。通常的後續步驟是讓系統管理員在手動將 LUN 和磁碟區重新上線之前、先完全關閉主機。雖然這些步驟可能涉及一些工作、但這種方法是確保資料完整性的最安全方法。並非所有資料都需要這項保護、因此 NVFAIL 行為可依每個磁碟區設定。</block>
  <block id="637d4b37868fb7825461df6edd674158" category="section-title">HA 配對與 MetroCluster</block>
  <block id="9d8738f531e6c6a809ba66315beaa2f4" category="paragraph">MetroCluster 提供兩種組態：雙節點和 HA 配對。雙節點組態在 NVRAM 上的運作方式與 HA 配對相同。如果發生突然故障、合作夥伴節點可以重新執行 NVRAM 資料、以確保磁碟機一致、並確保沒有遺失任何已確認的寫入資料。</block>
  <block id="936f4311b16ee4dc74a5564892f8976d" category="paragraph">HA 配對組態也會將 NVRAM 複寫到本機合作夥伴節點。簡單的控制器故障會在合作夥伴節點上重新執行 NVRAM 、而獨立 HA 配對則不使用 MetroCluster 。萬一突然完全遺失站台、遠端站台也需要 NVRAM 、才能讓磁碟機保持一致、開始提供資料。</block>
  <block id="83b6c3c3018b913ecf1aca67e0daa35e" category="paragraph">MetroCluster 的一個重要層面是、在正常作業條件下、遠端節點無法存取合作夥伴資料。每個站台基本上都是一個可假設對方站台特性的個別系統。此程序稱為「轉換」、包含計畫性的轉換、可在不中斷營運的情況下、將站台作業移轉至另一個站台。它也包括站台遺失的非計畫性情況、以及災難恢復需要手動或自動切換。</block>
  <block id="58504b36cfdfd10d5f2802d7b943a379" category="section-title">切換與切換</block>
  <block id="d505751d1708fb5d57b0e23d089507a9" category="paragraph">術語切換和切換是指在 MetroCluster 組態中、在遠端控制器之間轉換磁碟區的程序。此程序僅適用於遠端節點。在四個磁碟區組態中使用 MetroCluster 時、本機節點容錯移轉是先前所述的相同接管和恢復程序。</block>
  <block id="1127608e73df5ede22b149c8f19fc860" category="section-title">計畫性切換與切換</block>
  <block id="a6733335678588619c977608e891e54e" category="paragraph">規劃的切換或切換類似於節點之間的接管或恢復。此程序有多個步驟、可能需要幾分鐘的時間、但實際發生的是儲存設備和網路資源的多階段順暢轉換。控制傳輸的速度比執行完整命令所需的時間快得多。</block>
  <block id="4bb5647dcff332f0b53819ecd631303c" category="paragraph">接管 / 恢復與切換 / 切換回復之間的主要差異在於對 FC SAN 連線能力的影響。使用本機接管 / 恢復功能、主機會遺失通往本機節點的所有 FC 路徑、並仰賴其原生 MPIO 來切換至可用的替代路徑。連接埠不會重新定位。透過切換和切換、控制器上的虛擬 FC 目標連接埠會轉換到另一個站台。它們在 SAN 上實際上已經停用一段時間、然後重新出現在替代控制器上。</block>
  <block id="0ba902ec3f6ce91c2e801715bb8b96fa" category="section-title">SyncMirror 逾時</block>
  <block id="9c8a1814b60b84d1aa68fa7bba69138b" category="paragraph">SyncMirror 是一項 ONTAP 鏡射技術、可針對機櫃故障提供保護。當機櫃之間相隔一段距離時、就能獲得遠端資料保護。</block>
  <block id="68cf36f65a7e56ff3b6c0894be3ed9e8" category="paragraph">SyncMirror 無法提供通用同步鏡像。因此、可用度更高。有些儲存系統使用固定的全或全自動鏡射、有時稱為 Domino 模式。這種形式的鏡像在應用程式中受到限制、因為如果與遠端站台的連線中斷、所有寫入活動都必須停止。否則、寫字會存在於某個站台、但不會存在於另一個站台。一般而言、如果站台對站台連線中斷超過一段短時間（例如 30 秒）、這類環境就會設定為使 LUN 離線。</block>
  <block id="84ad4c21def9c355e80ef250d910bfa2" category="paragraph">這種行為是小型環境子集的理想選擇。不過、大多數應用程式都需要一套解決方案、能夠在正常作業條件下提供保證同步複寫、但能夠暫停複寫。站台對站台連線能力完全中斷通常被視為近乎災難的情況。一般而言、這類環境會保持在線上狀態並提供資料、直到連線能力修復或正式決定關閉環境以保護資料為止。純粹因為遠端複寫失敗而需要自動關閉應用程式、這是不尋常的。</block>
  <block id="e3bd381a7bbaee6c741aee230972acf4" category="paragraph">SyncMirror 支援同步鏡射需求、並可靈活調整逾時時間。如果與遠端控制器和 / 或叢的連線中斷、 30 秒定時器就會開始倒數。當計數器達到 0 時、會使用本機資料繼續寫入 I/O 處理。資料的遠端複本可以使用、但會在連線恢復之前、及時凍結。重新同步利用 Aggregate 層級快照、將系統儘快恢復至同步模式。</block>
  <block id="0c919cd6511df6d83b811234b0448374" category="paragraph">值得注意的是、在許多情況下、這種通用的「全或全無」 Domino 模式複寫功能更適合在應用程式層上實作。例如、 Oracle DataGuard 包括最大保護模式、可在任何情況下保證執行個體的長時間複寫。如果複寫連結失敗超過可設定的逾時時間、資料庫就會關閉。</block>
  <block id="ba92cbe464cfee8aa12c41e6aecd1071" category="section-title">使用 Fabric 附加 MetroCluster 自動進行無人值守切換</block>
  <block id="515094655d10031595da776c94b3d710" category="paragraph">自動無人值守切換（ AUSO ）是一項 Fabric 附加 MetroCluster 功能、可提供一種跨站台 HA 的形式。如前所述、 MetroCluster 有兩種類型：每個站台上只有一個控制器、或每個站台上有一個 HA 配對。HA 選項的主要優點是、計畫性或非計畫性控制器關機仍可讓所有 I/O 成為本機。單一節點選項的優勢在於降低成本、複雜度和基礎架構。</block>
  <block id="29d4da26af76b66db3a172a39edf8367" category="paragraph">AUSO 的主要價值在於改善 Fabric 附加 MetroCluster 系統的 HA 功能。每個站台都會監控相對站台的健全狀況、如果沒有節點仍可提供資料、 AUSO 就會導致快速的轉換。這種方法在每個站台只有一個節點的 MetroCluster 組態中特別有用、因為在可用度方面、它使組態更接近 HA 配對。</block>
  <block id="6b3a5f7923b2d803fd3b28c255fef420" category="paragraph">AUSO 無法在 HA 配對層級提供全方位監控。HA 配對可提供極高的可用度、因為它包含兩條備援實體纜線、可用於直接節點對節點通訊。此外、 HA 配對中的兩個節點都能存取備援迴圈上的同一組磁碟、為一個節點提供另一條路由來監控另一個節點的健全狀況。</block>
  <block id="da87dad268507a3523bc38275b1d3fbc" category="paragraph">MetroCluster 叢集存在於站台之間、節點對節點通訊和磁碟存取都仰賴站台對站台網路連線。監控叢集其餘部分的活動訊號的能力有限。AUSO 必須區分其他站台實際停機、而非因為網路問題而無法使用的情況。</block>
  <block id="e8e4f55c4203e7fb24d4543a7a0f65da" category="paragraph">因此、如果 HA 配對中的控制器偵測到因特定原因（例如系統異常）而發生的控制器故障、就會提示接管。如果連線完全中斷、也可能會提示接管、有時也稱為「失去心跳」。</block>
  <block id="91aa4ce36cb243281f3777d66c8f89e0" category="paragraph">只有在原始站台偵測到特定故障時、 MetroCluster 系統才能安全地執行自動切換。此外、擁有儲存系統所有權的控制器必須能夠保證磁碟和 NVRAM 資料同步。控制器無法保證進行變更的安全性、因為它與來源站台失去接觸、而該站台仍可運作。如需將交換作業自動化的其他選項、請參閱下一節中的 MetroCluster tiebreaker （ MCTB ）解決方案資訊。</block>
  <block id="8e7705fe4aea384d7f6a99ab6dc0f408" category="section-title">MetroCluster tiebreaker 搭配網路附加 MetroCluster</block>
  <block id="897b7698cb343dbc3452e845705ab0f3" category="inline-link">NetApp MetroCluster tiebreaker</block>
  <block id="9c093f14319e8253b8c9b37290597239" category="inline-link">NetApp 支援網站</block>
  <block id="a1d9fc4fb49119a9fe9b39abec0a769b" category="paragraph">。<block ref="9332969062716487f0feefe076babf99" category="inline-link-rx"></block> 軟體可在第三個站台上執行、以監控 MetroCluster 環境的健全狀況、傳送通知、並在災難情況下強制切換。如需有關斷路器的完整說明、請參閱<block ref="c21658567f794984b03c21186a56713d" category="inline-link-rx"></block>但 MetroCluster 斷路器的主要用途是偵測站台遺失。它還必須區分站台遺失和連線中斷。例如、不應因為斷路器無法到達主要站台而進行切入、這就是為什麼斷路器也會監控遠端站台與主要站台聯絡的能力。</block>
  <block id="6f29b1849750ceee5eb7f6f02d100e6b" category="paragraph">與 AUSO 的自動切換功能也相容於 MCTB 。AUSO 反應非常迅速、因為它的設計是偵測特定故障事件、然後只有在 NVRAM 和 SyncMirror 叢同步時才叫用切入。</block>
  <block id="6f5c7ae76595eca2ca83c5dd30cd8e9f" category="paragraph">相反地、斷路器位於遠端位置、因此必須等到定時器結束後才會宣告站台停機。tiebreaker 最終會偵測 AUSO 涵蓋的控制器故障類型、但一般而言、 AUSO 已經開始進行開關作業、而且可能會在 tiebreaker 運作之前完成開關作業。產生的第二個來自 tiebreaker 的切換命令將會遭到拒絕。</block>
  <block id="842547e1622bb12d9201167b0c39cf6d" category="paragraph">* 注意： * 強制切入時、 MCTB 軟體無法驗證 NVRAM 是否與 / 或叢同步。如果已設定自動切換、則應在維護活動期間停用、導致 NVRAM 或 SyncMirror 叢同步中斷。</block>
  <block id="7110edd59c3d0f25a584723f6fea26a0" category="paragraph">此外、 MCTB 可能無法因應導致下列事件順序的滾動災難：</block>
  <block id="93d732b784eaf1a323f191e75c10f233" category="list-text">站台之間的連線中斷超過 30 秒。</block>
  <block id="81d4275cc3534a9fa8cfdcdb5172eb94" category="list-text">SyncMirror 複寫逾時、且作業會繼續在主要站台上執行、使遠端複本過時。</block>
  <block id="44441f68631008a941ce92e985131ff9" category="list-text">主站台會遺失。結果是主站台上存在未複寫的變更。因此、由於下列幾個原因、可能不希望進行任何一次的重新操作：</block>
  <block id="499527dd40fad77b119b8b33c99cd614" category="list-text">關鍵資料可能會出現在主要站台上、而且該資料最終可能會恢復。允許應用程式繼續作業的轉換作業、將會有效捨棄該關鍵資料。</block>
  <block id="86de4e3737e3d871dacf8ffef353fc31" category="list-text">當站台遺失時、使用主要站台上儲存資源的仍在運作中站台上的應用程式可能已快取資料。切入會導致資料的過時版本與快取不相符。</block>
  <block id="dbb2a01afe28c8310daf781bb80b795f" category="list-text">當發生站台遺失時、使用主要站台上儲存資源的仍在運作中站台上的作業系統、可能已快取資料。切入會導致資料的過時版本與快取不相符。最安全的選項是將斷路器設定為在偵測到站台故障時傳送警示、然後讓人員決定是否強制進行轉換。應用程式和（或）作業系統可能需要先關機、才能清除任何快取資料。此外、 NVFAIL 設定也可用於新增進一步的保護、並協助簡化容錯移轉程序。</block>
  <block id="ec6b0ea9c511479c118aa0f028f6519d" category="section-title">ONTAP Mediator 搭配 MetroCluster IP</block>
  <block id="8ada6a626a475d631df231bbb3a88ac9" category="paragraph">ONTAP Mediator 可搭配 MetroCluster IP 和某些其他 ONTAP 解決方案使用。它是一項傳統的斷路器服務、就像上述的 MetroCluster tiebreaker 軟體一樣、但也包含一項重要功能、即執行自動無人值守的移除。</block>
  <block id="991d7d7d7388ccdd87c65ca09aa804f2" category="paragraph">光纖連接的 MetroCluster 可直接存取位於相對站台的儲存裝置。這可讓一個 MetroCluster 控制器從磁碟機讀取心跳資料、以監控其他控制器的健全狀況。這可讓一個控制器辨識另一個控制器的故障、並執行切換。</block>
  <block id="db2e932a11478bcf14c75d38e8b9a170" category="paragraph">相反地、 MetroCluster IP 架構只會透過控制器控制器連線路由所有 I/O 、而無法直接存取遠端站台上的儲存裝置。這會限制控制器偵測故障和執行轉換的能力。因此、 ONTAP Mediator 必須作為斷路器裝置、才能偵測站台遺失並自動執行轉換。</block>
  <block id="8004e6d63f487a456290225b74768a6c" category="section-title">使用 ClusterLion 的虛擬第三站點</block>
  <block id="f1d5a7305654a402a719675fbec810e7" category="paragraph">ClusterLion 是一款先進的 MetroCluster 監控設備、可作為虛擬第三站點使用。此方法可讓 MetroCluster 安全部署在雙站台組態中、並具備全自動的轉換功能。此外、 ClusterLion 還能執行額外的網路層級監控、並執行後置作業。完整文件可從 ProLion 取得。</block>
  <block id="a60b8f728a13371898fea9947ef1e0dc" category="paragraph"><block ref="a60b8f728a13371898fea9947ef1e0dc" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f8aae92ec17ec82868ef9ffc767dbd03" category="list-text">ClusterLion 設備會使用直接連接的乙太網路和序列纜線來監控控制器的健全狀況。</block>
  <block id="c5f8963a91e3d8e7ac0abda2eab9f17d" category="list-text">這兩台設備透過備援的 3G 無線連線彼此連線。</block>
  <block id="24de16a13a1b584832d19117982cbfa6" category="list-text">ONTAP 控制器的電源會透過內部中繼路由傳送。發生站台故障時、包含內部 UPS 系統的 ClusterLion 會先切斷電源連線、然後再啟動切入。此程序可確保不會發生任何大腦分割狀況。</block>
  <block id="b2bcd3c3c555e2e4f27d453de4e0f06d" category="list-text">ClusterLion 會在 30 秒 SyncMirror 逾時內執行切換、或完全不執行。</block>
  <block id="390fb5f827a3fbcdc7d05e6e7db03223" category="list-text">除非 NVRAM 和 SyncMirror 叢集的狀態同步、否則 ClusterLion 不會執行切入。</block>
  <block id="f322f850d55e87946f9660e4ccb1bbb6" category="list-text">由於 ClusterLion 只會在 MetroCluster 完全同步時執行切入、因此不需要 NVFAIL 。此組態可讓擴充 Oracle RAC 等站台跨距環境保持連線、即使在非計畫性的轉換期間亦然。</block>
  <block id="5c132e05fb0e306f56955603619de359" category="list-text">支援包括光纖連接的 MetroCluster 和 MetroCluster IP</block>
  <block id="86bcf99dbc3944da56f06b48074d09f6" category="doc">正常運作</block>
  <block id="16dd4928055f2caf6f6fb8119ef69bcc" category="paragraph">SM-BC 支援兩種類型的儲存容錯移轉作業：計畫性和非計畫性、運作方式略有不同。系統管理員會手動啟動計畫性容錯移轉、以快速切換至遠端站台、而非計畫性容錯移轉則由第三站台的協調員自動啟動。計畫性容錯移轉的主要目的是執行漸進式修補與升級、執行災難恢復測試、或是採用正式的原則、在一年內在站台之間切換作業、以證明完整的業務持續運作能力。</block>
  <block id="63d4f976530f4faffa1ecd40fe8843f4" category="paragraph">下圖顯示正常、容錯移轉及容錯回復作業期間的情況。為了便於說明、它們描述了複寫的 LUN 。在實際的 SM-BC 組態中、複寫是以磁碟區為基礎、其中每個磁碟區都包含一個或多個 LUN 、但為了讓圖片更簡單、磁碟區層已經移除。</block>
  <block id="e48472f7daf781b63506f9e296443027" category="paragraph">在正常作業中、可以從本機或遠端複本存取 LUN 。紅色線表示 ALUA 所通告的最佳化路徑、結果應該是 IO 優先傳送至此路徑。</block>
  <block id="ef1d805ecb3b65664c42a1d32d8120d5" category="paragraph">綠線是作用中路徑、但因為該路徑上的 IO 必須通過 SM-BC 路徑、所以會產生更多延遲。額外的延遲時間取決於站台之間用於 SM-BC 的互連速度。</block>
  <block id="e139a585510a502bbf1841cf589f5086" category="section-title">故障</block>
  <block id="7ed516552b652790c92df0bf237264b2" category="paragraph">如果主動鏡像複本因為計畫性或非計畫性容錯移轉而無法使用、則顯然無法再使用。然而、遠端系統已擁有通往遠端站台的同步複本和 SAN 路徑。遠端系統能夠為該 LUN 提供 IO 服務。</block>
  <block id="89a4933a199f7b0e286c8bcb1606905a" category="paragraph">是否立即使用遠端複本取決於 SMBC 是以同步模式還是 StrictSync 模式運作。</block>
  <block id="af43c542f512c4f7dc1b137d5de49d40" category="paragraph"><block ref="af43c542f512c4f7dc1b137d5de49d40" category="inline-image-macro-rx" type="image"></block></block>
  <block id="7388404ef116c3ff812bfd290b094d9e" category="section-title">容錯移轉</block>
  <block id="997dfe060d2107e84407cfb41e692c54" category="paragraph">容錯移轉會導致遠端複本變成使用中複本。路徑會從「 Active 」變更為「 Active/Optimized 」、 IO 也會持續提供服務、不會遺失資料。</block>
  <block id="52da4ea35ba60090f331eefab5d6c612" category="paragraph"><block ref="52da4ea35ba60090f331eefab5d6c612" category="inline-image-macro-rx" type="image"></block></block>
  <block id="0493d27e20d11e356e53e0a730b0ad08" category="section-title">修復</block>
  <block id="4f125c91283d9dc1751ad99a7a171420" category="paragraph">一旦來源系統恢復服務、 SM-BC 可以重新同步複寫、但可以執行其他方向。現在的組態基本上與起點相同、只是主動鏡射站台已經翻轉。</block>
  <block id="5c647f57a104a05d7d8b55d089efefbe" category="paragraph"><block ref="5c647f57a104a05d7d8b55d089efefbe" category="inline-image-macro-rx" type="image"></block></block>
  <block id="6d80a3efb80520f47b63dc279e1bea3d" category="section-title">容錯回復</block>
  <block id="d47f47372b9b94d274cceb3638b28845" category="paragraph">如果需要、管理員可以執行容錯回復、並將 LUN 的作用中複本移回原始控制器。</block>
  <block id="0c99cedb6f39d8ac16d5b4c01c162c23" category="paragraph">資料庫重做 / 交易記錄通常會產生未對齊的 I/O 、導致 ONTAP 上未對齊 LUN 的錯誤警告。</block>
  <block id="b2f7bb8e75b21ee3e883141c6ac1defe" category="paragraph">記錄會以不同大小的寫入方式、連續寫入記錄檔。不符合 4KB 界限的記錄寫入作業通常不會造成效能問題、因為下一個記錄寫入作業會完成區塊。結果是 ONTAP 幾乎能將所有寫入作業視為完整的 4KB 區塊來處理、即使某些 4KB 區塊中的資料是以兩個不同的作業來寫入。</block>
  <block id="0e635e1f8ffad809203304cf41ed45c4" category="inline-link-macro">WAFL 對齊驗證</block>
  <block id="bf837d24f10c904e697e3c0092da43b9" category="paragraph">使用公用程式（例如）來驗證對齊<block ref="40883add63f1fbabc7fe6158f93c1246" prefix=" " category="inline-code"></block> 或<block ref="1aabac6d068eef6a7bad3fdf50a05cc8" prefix=" " category="inline-code"></block> 可在定義的區塊大小下產生 I/O 。您可以使用檢視儲存系統上的 I/O 對齊統計資料<block ref="446501053769c06c565094b26d26e8ef" prefix=" " category="inline-code"></block> 命令。請參閱 <block ref="ebccec7997af507c87f985ec4ccec634" category="inline-link-macro-rx"></block> 以取得更多資訊。</block>
  <block id="b5ffbfb0c082804ad41d0f61c87525ed" category="paragraph">許多應用程式資料集都是按日期組織、而且隨著時間的演進、存取這些資料的可能性通常會越來越小。例如、某家銀行可能會有包含五年客戶對帳單的 PDF 檔案儲存庫、但只有最近幾個月是有效的。FabricPool 可用於將較舊的資料檔案重新放置到容量層。14 天的冷卻期可確保最近 14 天的 PDF 檔案仍保留在效能層級上。此外、至少每 14 天讀取一次的檔案仍會很熱、因此會保留在效能層級上。</block>
  <block id="ed7e2cc7ff107d4b2032fe65cf4e756a" category="paragraph">若要實作檔案型分層方法、您必須有已寫入且未隨後修改的檔案。。<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 原則應該設定得足夠高、以便您可能需要的檔案保留在效能層。例如、需要最近 60 天資料的資料集、且需要設定最佳效能<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 期間為 60 。也可以根據檔案存取模式來達成類似的結果。例如、如果需要最近 90 天的資料、而應用程式正在存取該 90 天的資料範圍、則資料會保留在效能層。設定<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 期間為 2 、資料變少後、系統會提示您分層。</block>
  <block id="8a467b35326e4738b1bd39865c3b21a0" category="admonition">任何類型的資料存取都會重設熱圖資料。病毒掃描、索引甚至是讀取來源檔案的備份活動、都會因為必要而防止分層<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 從未達到臨界值。</block>
  <block id="7a1920d61156abc05a60135aefe8bc67" category="doc">預設</block>
  <block id="5ba46d288640832c345e169b04a7458a" category="paragraph">所有 FabricPool 磁碟區的初始設定為<block ref="c21f969b5f03d33d43e04f8f136e7682" prefix=" " category="inline-code"></block>這表示行為是由「雲端擷取原則」所控制。「確切的行為取決於所使用的分層原則。</block>
  <block id="5ec354970d7934d92ba67ccaa0de0121" category="list-text"><block ref="9df22f196a33acd0b372fe502de51211" prefix="" category="inline-code"></block>–僅擷取隨機讀取的資料</block>
  <block id="74092cfa5efab8e6ddc5c2991ee2cfc9" category="list-text"><block ref="8805d416ce540c5f2df34af5b18d742b" prefix="" category="inline-code"></block>–擷取所有依序或隨機讀取的資料</block>
  <block id="2de036541477f953c6fd33d14a8db0e8" category="list-text"><block ref="334c4a4c42fdb79d7ebc3e73b517e6f8" prefix="" category="inline-code"></block>–擷取所有依序或隨機讀取的資料</block>
  <block id="b6ffdb7ccf86e99ecf73899ec23bdd46" category="list-text"><block ref="a181a603769c1f98ad927e7367c7aa51" prefix="" category="inline-code"></block>–請勿從容量層擷取資料</block>
  <block id="d556a0d2cad80695d1d803ebb49de9cd" category="section-title">讀取中</block>
  <block id="7c39eb141ca855e5a211b468bd67636c" category="paragraph">設定<block ref="d253e682212338dd6cbe577947f0511e" prefix=" " category="inline-code"></block> 對讀取會覆寫預設行為、因此讀取任何階層資料會導致資料傳回效能層。</block>
  <block id="e07df43ea07fecb178484ef278644eb2" category="paragraph">例如、在的下、一個 Volume 可能已被輕度使用了很長時間<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 分層原則和大多數區塊現在都是分層的。</block>
  <block id="98c8614a9e0467f220df33a02cf7550a" category="paragraph">如果業務發生非預期的變更、需要重複掃描部分資料以準備特定報告、則可能需要變更<block ref="d253e682212338dd6cbe577947f0511e" prefix=" " category="inline-code"></block> 至<block ref="0ba0dc933ac714a0bef4467360437336" prefix=" " category="inline-code"></block> 確保讀取的所有資料都會傳回效能層、包括依序和隨機讀取資料。這將改善連續 I/O 相對於磁碟區的效能。</block>
  <block id="3ea4ba4aadef21fbda74c9b242c99efa" category="section-title">推廣</block>
  <block id="cb674c0cbcbaa23bdd3c8e4f6182f865" category="paragraph">升級原則的行為取決於分層原則。如果分層原則是<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block>、然後設定<block ref="723c2b1883eb9949dd821267c2d1b5c7" prefix=" " category="inline-code"></block> 在下一次分層掃描時、從容量層移回所有區塊。</block>
  <block id="452d85cc34fd3a4cf55ac61e732239f4" category="paragraph">如果分層原則是<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block>，則只會傳回與作用中檔案系統相關聯的區塊。通常這不會有任何影響、因為唯一的區塊會在底下分層<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 原則將是與快照完全相關的區塊。作用中檔案系統中不會有階層式區塊。</block>
  <block id="d6269fb1a970b6c261fedbc79464b3dc" category="paragraph">然而、如果磁碟區上的資料是由 Volume SnapRestore 或快照的檔案複製作業還原、則目前使用中檔案系統可能需要一些因為只與快照相關而分層的區塊。您可能需要暫時變更<block ref="d253e682212338dd6cbe577947f0511e" prefix=" " category="inline-code"></block> 原則目標<block ref="eeefc0add5ccd6e20ac4214923d27fbc" prefix=" " category="inline-code"></block> 快速擷取所有本機需要的區塊。</block>
  <block id="6e7b34fa59e1bd229b207892956dc41c" category="section-title">永不</block>
  <block id="c45e30a0f86af155e2feb17dd7ba6e44" category="paragraph">請勿從容量層擷取區塊。</block>
  <block id="2d242bb36ec91b32005f9296ff03a912" category="doc">架構</block>
  <block id="ac30d4a74ecef302adab70e9669a4bf2" category="paragraph">FabricPool 是一項分層技術、將區塊歸類為熱區塊或冷卻區塊、並將其置於最適當的儲存層。效能層最常位於 SSD 儲存設備上、並裝載熱資料區塊。容量層位於物件存放區、並裝載 Cool 資料區塊。物件儲存支援包括 NetApp StorageGRID 、 ONTAP S3 、 Microsoft Azure Blob 儲存設備、 Alibaba 雲端物件儲存服務、 IBM 雲端物件儲存設備、 Google 雲端儲存設備和 Amazon AWS S3 。</block>
  <block id="f9f5fe2f7456d37c955f3291744c93b6" category="paragraph">有多個分層原則可供使用、可控制區塊如何分類為熱或冷區、並可針對每個磁碟區設定原則、並視需要進行變更。只有資料區塊會在效能層和容量層之間移動。定義 LUN 和檔案系統結構的中繼資料一律保留在效能層上。因此、管理作業會集中在 ONTAP 上。檔案和 LUN 與儲存在任何其他 ONTAP 組態上的資料並無不同。NetApp AFF 或 FAS 控制器會套用定義的原則、將資料移至適當的層級。</block>
  <block id="156a1cf692c4ba9a4f9574fb16428b01" category="paragraph"><block ref="156a1cf692c4ba9a4f9574fb16428b01" category="inline-image-macro-rx" type="image"></block></block>
  <block id="616ce0475334fe37834d13972a168ca5" category="section-title">物件存放區提供者</block>
  <block id="71e79501cc067e6b35ac3d3e97c940a4" category="paragraph">物件儲存傳輸協定使用簡單的 HTTP 或 HTTPS 要求來儲存大量的資料物件。物件儲存設備的存取必須可靠、因為 ONTAP 的資料存取取決於要求的即時服務。選項包括 Amazon S3 Standard 和 In常用 存取選項、以及 Microsoft Azure Hot 和 Cool Blob Storage 、 IBM Cloud 和 Google Cloud 。不支援 Amazon Glacier 和 Amazon Archive 等歸檔選項、因為擷取資料所需的時間可能超過主機作業系統和應用程式的容許值。</block>
  <block id="e114e830308285cd9085063fad91662c" category="paragraph">NetApp StorageGRID 也受到支援、是最佳的企業級解決方案。它是高效能、可擴充且高度安全的物件儲存系統、可為 FabricPool 資料及其他物件儲存應用程式提供地理上的備援、這些應用程式越來越可能成為企業應用程式環境的一部分。</block>
  <block id="fb318c5cd9ed18c79e1f7a298dd96665" category="paragraph">StorageGRID 也能避免許多公有雲供應商為了從服務讀取資料而收取的出口費用、進而降低成本。</block>
  <block id="119d8a1213b5b7cae4bb567153b028cf" category="section-title">資料與中繼資料</block>
  <block id="b59d6123a3191bd85fe14e57b7a01e11" category="paragraph">請注意、此處的「資料」一詞適用於實際的資料區塊、而非中繼資料。只有資料區塊是階層式的、而中繼資料則保留在效能層級中。此外、只有讀取實際的資料區塊、才能影響區塊的「熱」或「冷」狀態。只要讀取檔案的名稱、時間戳記或所有權中繼資料、就不會影響基礎資料區塊的位置。</block>
  <block id="1414cdc093d39dd56d0b0d20049e17fc" category="section-title">備份</block>
  <block id="e0b766a7a0a7633679ecddd0f78a7390" category="paragraph">雖然 FabricPool 可以大幅減少儲存佔用空間、但它本身並不是備份解決方案。NetApp WAFL 中繼資料一律保持在效能層級。如果災難性災難破壞效能層、則無法使用容量層上的資料來建立新環境、因為該環境不包含 WAFL 中繼資料。</block>
  <block id="7a25ce12890e524732cb71784b5915ab" category="paragraph">不過、 FabricPool 可以成為備份策略的一部分。例如、 FabricPool 可以使用 NetApp SnapMirror 複寫技術進行設定。每一半的鏡像都可以有自己與物件儲存目標的連線。結果是兩個資料的複本。主要複本包含效能層上的區塊、以及容量層中的相關區塊、而複本則是第二組效能和容量區塊。</block>
  <block id="82af841589057aa8922b1ac3bb4a28a4" category="doc">壓縮</block>
  <block id="e242ff0701d9ed7d8317b32fd762a100" category="paragraph">空間效率功能（例如壓縮、壓縮和重複資料刪除）的設計、是為了增加符合特定實體儲存量的邏輯資料量。結果是降低成本和管理成本。</block>
  <block id="13b992c3d358d786db03341886472c4f" category="paragraph">在高層級、壓縮是一種數學程序、可偵測及編碼資料模式、以減少空間需求。相反地、重複資料刪除功能會偵測實際重複的資料區塊、並移除額外的複本。資料實作可讓多個邏輯區塊在媒體上共用相同的實體區塊。</block>
  <block id="786d7cc1b18aa3d9c3e8d3e30865240e" category="paragraph">在提供 All Flash 儲存系統之前、以陣列為基礎的壓縮價值有限、因為大多數 I/O 密集的工作負載都需要大量磁碟來提供可接受的效能。儲存系統的容量總是比所需的容量大得多、這是大量磁碟機的副作用。固態儲存設備的興起、改變了這種情況。不再需要純粹為了獲得良好效能而大幅過度配置磁碟機。儲存系統中的磁碟機空間可與實際容量需求相符。</block>
  <block id="b207c460d31fea9e1cfab71057e8152c" category="paragraph">固態硬碟機（ SSD ）的 IOPS 容量增加、幾乎總是比旋轉硬碟機節省成本、但壓縮技術可以增加固態媒體的有效容量、進而進一步節省成本。</block>
  <block id="bd6c983943da8bf0ead08c643f0e75f3" category="paragraph">壓縮資料的方法有好幾種。許多資料庫都包含自己的壓縮功能、但在客戶環境中很少會發現這種情況。原因通常是對壓縮資料的 * 變更 * 效能降低、而且授權成本通常很高。最後、對資料庫作業的整體效能影響。對於執行資料壓縮與解壓縮的 CPU 、而非實際的資料庫工作、支付高昂的每 CPU 授權成本是不合理的。更好的選擇是將壓縮工作卸載到儲存系統。</block>
  <block id="6296c8b7406b90d37edf269f1ea6f6ee" category="section-title">自適應壓縮</block>
  <block id="1245fef302b5da2c27766d9a98ad358c" category="paragraph">即使在以微秒為單位測量延遲的 All Flash 環境中、主動式壓縮也已針對企業工作負載進行徹底測試、且未對效能產生任何影響。有些客戶甚至報告使用壓縮技術時效能會提高、因為資料會保持在快取中的壓縮、有效增加控制器中可用的快取數量。</block>
  <block id="93e0a644c8f1b7f7f378bc071d15d1e9" category="paragraph">ONTAP 以 4KB 單位管理實體區塊。自適應壓縮使用 8KB 的預設壓縮區塊大小、也就是以 8KB 為單位壓縮資料。這與關係式資料庫最常使用的 8KB 區塊大小相符。隨著將更多資料壓縮成單一單元、壓縮演算法就會變得更有效率。32 KB 壓縮區塊大小比 8 KB 壓縮區塊單元更具空間效率。這表示使用預設 8KB 區塊大小的調適式壓縮確實會導致效率稍微降低、但使用較小的壓縮區塊大小也有很大的好處。資料庫工作負載包括大量的覆寫活動。若要覆寫 32 KB 壓縮資料區塊的 8KB 資料、必須讀回整個 32 KB 的邏輯資料、將其解壓縮、更新所需的 8 KB 區域、重新壓縮、然後將整個 32 KB 寫入磁碟機。這對儲存系統來說是非常昂貴的作業、也是因為某些競爭儲存陣列以較大的壓縮區塊大小為基礎、也會對資料庫工作負載造成重大效能損失的原因。</block>
  <block id="096cc7f8e7e1861c3ee0269a90fc27e3" category="admonition">調適式壓縮所使用的區塊大小最多可增加至 32KB 。這可能會改善儲存效率、而且當大量的這類資料儲存在陣列上時、應該考慮將歸檔記錄檔和備份檔案等靜態檔案。在某些情況下、使用 16KB 或 32KB 區塊大小的作用中資料庫、也可能因為增加適應式壓縮的區塊大小而受惠。請洽詢 NetApp 或合作夥伴代表、瞭解這是否適合您的工作負載。</block>
  <block id="f291779c724993ded5e79421d88f3e55" category="admonition">在串流備份目的地上、不應將大於 8KB 的壓縮區塊大小與重複資料刪除一起使用。原因是備份資料的細微變更會影響 32KB 壓縮時間。如果視窗移動、則產生的壓縮資料會在整個檔案中有所不同。重複資料刪除是在壓縮之後進行、這表示重複資料刪除引擎會以不同的方式檢視每個壓縮備份。如果需要重複資料刪除串流備份（例如 Oracle RMAN ）、則只應使用 8KB 區塊調適性壓縮。調適性壓縮較為理想、因為它的區塊大小較小、不會中斷重複資料刪除的效率。由於類似的原因、主機端壓縮也會影響重複資料刪除的效率。</block>
  <block id="1f9367b7afff301ee24188d35050ae0a" category="section-title">對溫度敏感的儲存效率</block>
  <block id="78aa8c12abb3bf9f61a08df0f9b403de" category="paragraph">溫度敏感儲存效率（ TSSE ）是 ONTAP 9.8 及更新版本中提供的產品、它仰賴區塊存取熱圖來識別不常存取的區塊、並以更高的效率加以壓縮。</block>
  <block id="02e44d620def629a6c145ccd0d9a0fd3" category="section-title">壓縮對齊</block>
  <block id="3b6e6c232a02ab9c64199eb9efae012c" category="paragraph">資料庫環境中的調適性壓縮需要考量壓縮區塊對齊。這樣做只是對隨機覆寫非常特定區塊的資料的考量。這種方法的概念與整體檔案系統對齊方式類似、檔案系統的開始必須與 4K 裝置邊界對齊、檔案系統的區塊大小必須是 4K 的倍數。</block>
  <block id="327a36f7ca539411197c2f867b501719" category="paragraph">例如、只有在檔案與檔案系統本身的 8KB 邊界對齊時、才會壓縮寫入 8KB 檔案。這表示它必須落在檔案的前 8KB 、檔案的第二 8KB 等。RMAN 備份或歸檔記錄等資料是循序寫入的作業、跨越多個區塊、所有區塊都會被壓縮。因此、不需要考慮對齊。唯一令人擔憂的 I/O 模式是隨機覆寫檔案。</block>
  <block id="1d1a594959ec615f56516f5d0f5e8ddb" category="section-title">NFS</block>
  <block id="8dae8f7054353dae17cd9da8deb0e091" category="paragraph">使用 NFS 時、檔案 I/O 會對齊。檔案的每個區塊都會相對於檔案的開頭進行對齊。</block>
  <block id="62a0282d39568be094470486eaf70c4f" category="section-title">SAN</block>
  <block id="b0762e9957c8485f911e57bfd027eddb" category="paragraph">SAN 環境需要資料與 8KB 邊界對齊、才能達到最佳壓縮效果。SAN 的對齊有兩個層面： LUN 和檔案系統。LUN 必須設定為全磁碟機裝置（無分割區）、或是與 8KB 邊界對齊的分割區。</block>
  <block id="ad16b6d5634739ef4ceb795c5beea659" category="admonition">如需壓縮與部分保留之間互動的說明、請參閱精簡配置章節。</block>
  <block id="14c3c56ff2a98d1a9c47b63a917f67a3" category="section-title">資料壓縮</block>
  <block id="546168bb7b68da66be7b6c0e60a23460" category="paragraph">資料壓縮是 ONTAP 引進的一項技術、可改善壓縮效率。如前所述、僅有調適式壓縮功能、最多可節省 2 ： 1 、因為它僅限於在 4KB WAFL 區塊中儲存 8KB I/O 。較大區塊大小的壓縮方法可提供更好的效率。不過、這些資料不適合受到小型區塊覆寫的資料。解壓縮 32KB 的資料單元、更新 8KB 部分、重新壓縮及回寫磁碟機、都會產生額外的負荷。</block>
  <block id="0b01f66d49b9df153ee76048de44f6eb" category="paragraph">資料壓縮的運作方式是允許將多個邏輯區塊儲存在實體區塊內。例如、含有高度壓縮資料（例如文字或部分完整區塊）的資料庫、可能會從 8KB 壓縮至 1KB 。如果沒有壓縮、 1KB 的資料仍會佔用整個 4KB 區塊。即時資料壓縮功能可將 1KB 的壓縮資料與其他壓縮資料一起儲存在 1KB 的實體空間中。這不是一項壓縮技術、只是在磁碟機上分配空間的一種更有效率的方法、因此不應產生任何可偵測的效能影響。</block>
  <block id="07b153ed9b6a6f9f334f2ad1fe94651e" category="paragraph">節省的程度各不相同。已壓縮或加密的資料通常無法進一步壓縮、因此資料集無法從資料壓縮中獲益。新初始化的 Oracle 資料檔案包含的區塊中繼資料和零只有很少的資料、最多可壓縮至 80 ： 1 。這創造了極廣泛的可能性。</block>
  <block id="83f45cad5e6f535ff10e564a526baad0" category="section-title">重複資料刪除</block>
  <block id="f591ef30da06841378ee7f595e63a93c" category="paragraph">重複資料刪除是從資料集移除重複的區塊大小。例如、如果 10 個不同的檔案中存在相同的 4KB 區塊、重複資料刪除會將所有 10 個檔案中的 4KB 區塊重新導向至相同的 4KB 實體區塊。結果是該資料的效率提升 10 ： 1 。</block>
  <block id="699c85c5df1985b2af588f9e6c1ad353" category="paragraph">VMware 來賓開機 LUN 等資料通常會極好地刪除重複資料、因為這些資料包含相同作業系統檔案的多個複本。效率達到 100 ： 1 以上。</block>
  <block id="c3ed34b88ac0b8efff210a99f19a4b9b" category="paragraph">部分資料不包含重複資料。例如、 Oracle 區塊包含資料庫的全域唯一標頭、以及近乎唯一的標尾。因此、 Oracle 資料庫的重複資料刪除功能很少能節省 1% 以上的成本。</block>
  <block id="9653a3d4907877aae00bb7d39eeec66d" category="paragraph">在某些情況下、使用 16KB 和大型區塊大小的資料庫可節省高達 15% 的空間。每個區塊的初始 4KB 包含全域唯一的標頭、最後 4KB 區塊則包含近乎獨特的標尾。內部區塊是重複資料刪除的候選項目、但實際上、這幾乎完全歸功於重複資料刪除零位資料。</block>
  <block id="89d6ec0df0a54d3cdcc8f0573a6b37c5" category="paragraph">許多競爭陣列宣稱能夠根據資料庫複製多次的假設來刪除重複的 Oracle 資料庫。在這方面，也可以使用 NetApp 重複資料刪除技術，但 ONTAP 提供更好的選擇： NetApp FlexClone 技術。最終結果相同；會建立多個 Oracle 資料庫複本、以共用大部分的基礎實體區塊。使用 FlexClone 比花時間複製資料檔案、然後刪除複製資料檔案更有效率。實際上，它是不重複數據刪除，而不是重複數據刪除，因爲從一開始就不會創建重複數據。</block>
  <block id="32aeb47267cb2045610b468115f3ae0e" category="section-title">效率與精簡配置</block>
  <block id="3381946611f34fb44ad8a38a0c44e0a8" category="paragraph">效率功能是精簡配置的形式。例如、佔用 100GB 磁碟區的 100GB LUN 可能會壓縮至 50GB 。由於磁碟區仍為 100GB 、因此尚未實現實際節省。必須先縮小磁碟區的大小、才能將儲存的空間用於系統的其他位置。如果稍後變更為 100GB LUN 、則資料的壓縮性會降低、 LUN 的大小會增加、而且磁碟區可能會填滿。</block>
  <block id="20132d08f816a6401f40a29feb68df8d" category="paragraph">強烈建議採用精簡配置、因為它可以簡化管理、同時大幅改善可用容量、並節省相關成本。原因很簡單： Oracle 環境通常包括大量的空空間、大量的磁碟區和 LUN 、以及可壓縮的資料。如果磁碟區和 LUN 的儲存空間有一天 100% 滿、而且包含 100% 不可壓縮的資料、則大量資源配置會導致保留空間。這種情況不太可能發生。精簡配置可回收空間並在其他地方使用、並可讓容量管理以儲存系統本身為基礎、而非許多較小的磁碟區和 LUN 。</block>
  <block id="38ef8b6f2fc332958c293d93c61d7756" category="paragraph">有些客戶偏好針對特定工作負載使用完整資源配置、或是根據既定的營運和採購實務做法。</block>
  <block id="f8ea8eaa5ca0e58c6a43ec0117b7bd8d" category="paragraph">* 注意： * 如果磁碟區是完整配置的磁碟區、則必須小心將該磁碟區的所有效率功能完全停用、包括使用解壓縮和移除重複資料刪除<block ref="3cfeff511a11b8c5f54ce9749a719a58" prefix=" " category="inline-code"></block> 命令。Volume 不應出現在中<block ref="df899f2d908ec33afe1d01ee26b3dd47" prefix=" " category="inline-code"></block> 輸出。如果有、則磁碟區仍會部分設定為使用效率功能。因此、覆寫保證會以不同的方式運作、這會增加組態超視導致磁碟區意外用盡空間的機會、進而導致資料庫 I/O 錯誤。</block>
  <block id="0e7c78164adb6d4650ea685a79d8e99e" category="section-title">效率最佳實務做法</block>
  <block id="d67dd6ae62908b7781805cf297fa8d87" category="paragraph">NetApp 針對 ONTAP 9 及更高版本提供下列建議。若為 ONTAP 9 之前的 ONTAP 版本、請聯絡您的 NetApp 代表。</block>
  <block id="ec499ad25fa5a765ba43ec2c87819623" category="section-title">AFF 預設值</block>
  <block id="38b7d52fb2d518d07c1c857b20ebbbd2" category="paragraph">在 All Flash AFF 系統上執行的 ONTAP 上建立的磁碟區會自動精簡佈建、並啟用所有的內嵌效率功能。雖然 Oracle 資料庫通常無法從重複資料刪除中獲益、而且可能包含不可壓縮的資料、但預設設定仍適用於幾乎所有的工作負載。ONTAP 旨在有效處理所有類型的資料和 I/O 模式、無論是否能節省成本。只有在充分瞭解理由且有偏離的好處時、才應變更預設值。</block>
  <block id="9f7127e69d50bf7b844ff3723b86fbd1" category="section-title">一般建議</block>
  <block id="2c24e4751310e03f119a4df187a3bc08" category="list-text">如果磁碟區和（或） LUN 並未精簡配置、您必須停用所有效率設定、因為使用這些功能並不會節省成本、而將複雜資源配置與啟用空間效率的組合、可能會導致非預期的行為、包括空間不足的錯誤。</block>
  <block id="4922fe547c351d6a121465da036d478e" category="list-text">如果資料不需要覆寫、例如備份或資料庫交易記錄檔、您可以在冷卻週期較短的情況下啟用 TSSE 、以達到更高的效率。</block>
  <block id="e75fd383e4106eb78482b18896975daf" category="list-text">某些檔案可能包含大量不可壓縮的資料、例如、當檔案的應用程式層級已啟用壓縮時、就會進行加密。如果上述任何情況屬實、請考慮停用壓縮、以便在包含可壓縮資料的其他磁碟區上執行更有效率的作業。</block>
  <block id="11845fef1d21077d7b23ce880868b556" category="list-text">請勿將 32KB 壓縮和重複資料刪除同時用於資料庫備份。請參閱「」一節<block ref="57ee2712afc5e59236f86db0537b05dc" category="inline-xref-macro-rx"></block>以取得詳細資料。</block>
  <block id="64d5def835c194cac8afe4fafded756e" category="doc">原則 - 本機快照</block>
  <block id="baa596d0db91317fa83739a95649752e" category="paragraph">FabricPool 的初始版本以備份使用案例為目標。唯一可以分層的區塊類型是不再與作用中檔案系統中的資料相關聯的區塊。因此、只能將快照資料區塊移至容量層。當您需要確保效能不受影響時、這仍然是最安全的分層選項之一。</block>
  <block id="b21eb7f0b67c3e27e915183638bf92cf" category="paragraph">有兩個選項可將非作用中的快照區塊分層到容量層。首先<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 原則僅針對快照區塊。儘管如此<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 原則包括<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 區塊、也會將區塊分層、從作用中的檔案系統中移出。這可能不理想。</block>
  <block id="eeba990304f236b36a9fec2434c77470" category="paragraph">。<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 值應設為時間週期、以便在效能層上提供還原期間所需的資料。例如、重要正式作業資料庫的大多數還原案例、都會在過去幾天的某個時間加入還原點。設定 A<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 值 3 可確保檔案的任何還原都會產生可立即提供最大效能的檔案。作用中檔案中的所有區塊仍會顯示在快速儲存設備上、而無需從容量層恢復。</block>
  <block id="baf531ed01ad56f5614e1a68e8a2e7aa" category="section-title">原則 - 複寫的快照</block>
  <block id="27e5121a4c75181022e7be2b738339d0" category="paragraph">使用 SnapMirror 或 SnapVault 複寫的僅用於恢復的快照通常應使用 FabricPool<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 原則。使用此原則、會複寫中繼資料、但所有資料區塊都會立即傳送至容量層、以獲得最大效能。大部分的恢復程序都涉及循序 I/O 、這是固有的效率。應該評估物件存放區目的地的恢復時間、但在設計完善的架構中、此恢復程序不需要比從本機資料恢復慢很多。</block>
  <block id="639e481de0ffe002bd83251b26a2540a" category="paragraph">如果複製的資料也要用於複製、則會使用<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 原則比較適當、請使用<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 包含預期在複製環境中經常使用的資料的值。例如、資料庫的作用中工作集可能包含前三天讀取或寫入的資料、但也可能包含另外 6 個月的歷史資料。如果是、則是<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> SnapMirror 目的地的原則可讓工作集在效能層上使用。</block>
  <block id="ace0bd0c1be3a9e17d9736d93e7a1da2" category="doc">IOPS QoS</block>
  <block id="786ee59e0cdaa09335e12fea3a168653" category="paragraph">具體而言、由於採用 All Flash 儲存設備的情況增加、因此能夠整合工作負載。依賴旋轉媒體的儲存陣列往往只支援有限數量的 I/O 密集工作負載、因為舊版旋轉式磁碟機技術的 IOPS 功能有限。一或兩個高作用中的資料庫會在儲存控制器達到限制之前、使基礎磁碟機飽和。這種情況已經改變。即使是功能最強大的儲存控制器、相對少數 SSD 磁碟機的效能也能達到飽和。這意味著控制器的完整功能可以充分發揮、而不會因為旋轉媒體延遲尖峰而突然降低效能。</block>
  <block id="270d79669200ef485add1ecc1833cc94" category="paragraph">舉例來說、簡單的雙節點 HA AFF A800 系統能夠在延遲超過 1 毫秒之前、提供高達 100 萬次的隨機 IOPS 服務。只有很少單一工作負載會達到這類層級。充分利用此 AFF A800 系統陣列、將需要託管多個工作負載、同時確保可預測性、這需要 QoS 控制。</block>
  <block id="4dca0c3547523a2e5bd1b8d0e2ff8de5" category="paragraph">ONTAP 中有兩種服務品質（ QoS ）： IOPS 和頻寬。QoS 控制可套用至 SVM 、磁碟區、 LUN 和檔案。</block>
  <block id="3ea539ed2021ba46a3658039e8af419f" category="paragraph">IOPS QoS 控制顯然是以指定資源的 IOPS 總計為基礎、但 IOPS QoS 的許多層面可能並不符合直覺。剛開始有幾位客戶對於達到 IOPS 臨界值時、延遲明顯增加感到困惑。延遲增加是限制 IOPS 的自然結果。從邏輯上講、它的運作方式與權杖系統類似。例如、如果包含資料檔案的特定磁碟區有 10K IOPS 限制、則每個到達的 I/O 都必須先接收權杖才能繼續處理。只要在指定的秒數內使用的權杖不超過 10K 、就不會有延遲。如果 IO 作業必須等待接收其權杖、則此等待會顯示為額外延遲。工作負載相對於 QoS 限制的推動越大、每個 IO 在佇列中等待處理的時間就越長、使用者認為延遲越高。</block>
  <block id="34a96885dd7f4501920b13026e7f2cab" category="admonition">將 QoS 控制套用至資料庫交易 / 重做記錄資料時、請務必謹慎。雖然重做記錄的效能需求通常比資料檔案低很多、但重做記錄活動卻很繁瑣。IO 會以簡短的脈衝形式發生、而顯示適合平均重做 IO 層級的 QoS 限制、對於實際需求而言可能太低。結果可能會造成嚴重的效能限制、因為每次重做記錄突增時、 QoS 都會啟動。一般而言、重作和歸檔記錄不應受到 QoS 的限制。</block>
  <block id="c79dc76371299e08f4b4ebd609314ca4" category="section-title">頻寬 QoS</block>
  <block id="b9d5c520039715de9b997c5a69f4aeaa" category="paragraph">並非所有 I/O 大小都相同。例如、資料庫可能會執行大量的小區塊讀取、導致達到 IOPS 臨界值、 但資料庫也可能執行完整的資料表掃描作業、這項作業會由極少數的大量區塊讀取所組成、佔用大量頻寬、但 IOPS 相對較少。</block>
  <block id="4930ae83bb8dd5e539dc9f7e73c6d74c" category="paragraph">同樣地、 VMware 環境在開機期間可能會產生極高的隨機 IOPS 、但在外部備份期間執行的 IO 會較少、但會較大。</block>
  <block id="eabb5a523a77d4521c12622ee9388aa6" category="paragraph">有時有效管理效能需要 IOPS 或頻寬 QoS 限制、甚至兩者都需要。</block>
  <block id="13dac55a5f26cefab26368ea5a67e29f" category="section-title">最低 / 保證的 QoS</block>
  <block id="68559688130772c84bb39b2a9ca2c2af" category="paragraph">許多客戶尋求的解決方案都包含保證的 QoS 、這比看起來更難達成、而且可能相當浪費。例如、如果要放置 10 個具有 10K IOPS 保證的資料庫、就必須針對所有 10 個資料庫同時以 10K IOPS 執行的情況來調整系統規模、總共需要 10 萬個。</block>
  <block id="c0938f706c890ea85c86388391ffad22" category="paragraph">最適合用於最低 QoS 控制的是保護關鍵工作負載。例如、假設 ONTAP 控制器的 IOPS 最高可達 50 萬、同時混合了生產與開發工作負載。您應該將 QoS 原則上限套用至開發工作負載、以防止任何指定的資料庫壟斷控制器。然後、您可以將最低 QoS 原則套用至正式作業工作負載、以確保它們在需要時隨時都能使用所需的 IOPS 。</block>
  <block id="acdda1c20fb3985ce840929f7525c803" category="section-title">調適性QoS</block>
  <block id="dd5bc58ed6ab031b170a409470d9a763" category="paragraph">調適性 QoS 是指 ONTAP 功能、其中 QoS 限制是根據儲存物件的容量而定。它很少用於資料庫、因為資料庫的大小與其效能需求之間通常沒有任何連結。大型資料庫可能幾乎無法運作、而較小的資料庫則可能是 IOPS 最密集的資料庫。</block>
  <block id="eb595833577352045f92d14ac4315ad2" category="paragraph">Adaptive QoS 對於虛擬化資料存放區非常有用、因為這類資料集的 IOPS 需求往往與資料庫的總大小相關。較新的資料存放區包含 1TB 的 VMDK 檔案、可能需要的效能約為 2TB 資料存放區的一半。Adaptive QoS 可讓您在資料存放區填入資料時、自動增加 QoS 限制。</block>
  <block id="23f3d415bb4fe6f99165df604b24da0e" category="paragraph">使用 FabricPool 分層資料集會導致主要儲存陣列與物件存放區層之間的相依性。有許多物件儲存選項可提供不同層級的可用度。請務必瞭解主要儲存陣列與物件儲存層之間可能中斷連線的影響。</block>
  <block id="7e856c11a853d276fd5d6274bf60fafd" category="paragraph">如果發給 ONTAP 的 I/O 需要容量層的資料、而 ONTAP 無法到達容量層來擷取區塊、則 I/O 最終會逾時。此逾時的影響取決於所使用的傳輸協定。在 NFS 環境中、 ONTAP 會根據傳輸協定回應 EJUKEBOX 或 EDELAY 回應。有些較舊的作業系統可能會將此視為錯誤、但 Oracle Direct NFS 用戶端目前的作業系統和修補程式層級會將此視為可重試的錯誤、並繼續等待 I/O 完成。</block>
  <block id="207d9fe0f57910936bfa043248f3afca" category="paragraph">較短的逾時時間適用於 SAN 環境。如果需要物件存放區環境中的區塊、而且無法連線兩分鐘、則會將讀取錯誤傳回主機。ONTAP 磁碟區和 LUN 保持連線、但主機作業系統可能會將檔案系統標示為處於錯誤狀態。</block>
  <block id="c9251835da8df507ca4f6ce02d4216be" category="paragraph">物件儲存連線問題<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 由於只有備份資料是階層式的、因此原則並不令人擔心。通訊問題會拖慢資料恢復速度、但不會影響使用中的資料。。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 和<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 原則允許從作用中 LUN 分層處理冷資料、這表示物件儲存區資料擷取期間發生的錯誤可能會影響資料庫可用度。採用這些原則的 SAN 部署只能搭配專為高可用度所設計的企業級物件儲存設備和網路連線使用。NetApp StorageGRID 是絕佳的選擇。</block>
  <block id="0f8062f9220efe4f38e7236fe8885379" category="paragraph">大部分的關聯式資料庫都是以交易記錄歸檔模式運作、以提供時間點還原。對資料庫所做的變更會記錄交易記錄中的變更、並保留交易記錄而不會被覆寫。結果可能需要保留大量歸檔的交易記錄檔。許多其他應用程式工作流程也有類似的例子、這些工作流程會產生必須保留的資料、但很難存取。</block>
  <block id="229384bbfb1db19c4897d87ba4b9bc2d" category="paragraph">FabricPool 透過提供整合式分層的單一解決方案來解決這些問題。檔案會儲存並保留在其一般位置、但實際上不會佔用主要陣列上的任何空間。</block>
  <block id="f60aec7aaed8420e09f17a8cfd1d7d37" category="paragraph">使用<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 幾天的原則會導致在效能層上保留最近建立的檔案（近期最可能需要的檔案）中的區塊。之後、舊檔案的資料區塊會移至容量層。</block>
  <block id="485e24df9e0ebeecf416daa6e5441bba" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 無論主要檔案系統中的記錄是否已刪除或繼續存在、都會在達到冷卻臨界值時強制執行提示分層。將所有可能需要的記錄儲存在作用中檔案系統的單一位置、也能簡化管理。沒有理由搜尋快照以找出需要還原的檔案。</block>
  <block id="bbe0132696bc482e0ba7a1f293d80083" category="paragraph">某些應用程式（例如 Microsoft SQL Server ）會在備份作業期間截斷交易記錄檔、使記錄不再位於作用中的檔案系統中。使用可節省容量<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 分層原則、但<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 原則對記錄資料並不實用、因為作用中檔案系統中應該很少會冷卻記錄資料。</block>
  <block id="0694b4972669f201ca85f9427a230208" category="doc">MetroCluster 可在 3 種不同組態中使用</block>
  <block id="948676ffa8073153cbe404795950ad85" category="list-text">HA 可與 IP 連線配對</block>
  <block id="ef012b81fd45a95681a584a59f8df77e" category="list-text">HA 可與 FC 連線配對</block>
  <block id="6ffec869ba36dff4e093b5ed8bac798a" category="list-text">單一控制器、具備 FC 連線能力</block>
  <block id="6fa7041982bed9488213a7bd2ecccfdf" category="paragraph">[ 注意 ] 「連線」一詞是指用於跨站台複寫的叢集連線。它並不指主機協定。無論叢集間通訊所使用的連線類型為何、 MetroCluster 組態中的所有主機端通訊協定都會如常支援。</block>
  <block id="4767099b22895a8101a1cba45d8cf6e9" category="section-title">知識產權MetroCluster</block>
  <block id="adc397d87c1a7827f2df9fdd362d5ff7" category="paragraph">HA 配對 MetroCluster IP 組態每個站台使用兩或四個節點。此組態選項可增加與雙節點選項相關的複雜度和成本、但它提供重要的優點：站台內備援。簡單的控制器故障不需要透過 WAN 存取資料。透過替代本機控制器、資料存取仍保持在本機狀態。</block>
  <block id="c15560f2ae5432223c591c5f5d9db5c1" category="paragraph">大多數客戶都選擇 IP 連線、因為基礎架構需求較為簡單。過去、高速跨站台連線通常較容易使用深色光纖和 FC 交換器進行配置、但如今、高速、低延遲的 IP 電路更容易使用。</block>
  <block id="b28c5a429800ea9669a191a402a72b49" category="paragraph">由於唯一的跨站台連線適用於控制器、因此架構也更簡單。在 FC SAN 附加 MetroCluster 中、控制器會直接寫入另一個站台上的磁碟機、因此需要額外的 SAN 連線、交換器和橋接器。相反地、 IP 組態中的控制器會透過控制器寫入相對的磁碟機。</block>
  <block id="457b0075e8f0333975a8e2aaeaceb149" category="inline-link">SIP解決方案架構與設計MetroCluster</block>
  <block id="82aa44c8aa5ebe78f1496c8fc80cb954" category="paragraph">如需其他資訊、請參閱 ONTAP 正式文件和<block ref="03a3c76178d2d43147a2756857a0985e" category="inline-link-rx"></block>。</block>
  <block id="68cf128ce140240c63e9a47e2a82a333" category="paragraph"><block ref="68cf128ce140240c63e9a47e2a82a333" category="inline-image-macro-rx" type="image"></block></block>
  <block id="0d2d438a72f6c558744351265fa49a62" category="section-title">HA 配對 FC SAN 附加 MetroCluster</block>
  <block id="3e9133ff590581b29a911d9631ab1737" category="paragraph">HA 配對 MetroCluster FC 組態每個站台使用兩個或四個節點。此組態選項可增加與雙節點選項相關的複雜度和成本、但它提供重要的優點：站台內備援。簡單的控制器故障不需要透過 WAN 存取資料。透過替代本機控制器、資料存取仍保持在本機狀態。</block>
  <block id="7ea740801794ba8a2ce3f87db010c319" category="paragraph"><block ref="7ea740801794ba8a2ce3f87db010c319" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4bc2926f030255369db3e4435de5c774" category="paragraph">有些多站台基礎架構並非設計用於主動式作業、而是更多用於主要站台和災難恢復站台。在這種情況下、 HA 配對 MetroCluster 選項通常較為理想、原因如下：</block>
  <block id="5f49f48dd22b405a813e2ef7cc02e9f8" category="list-text">雖然雙節點 MetroCluster 叢集是 HA 系統、但控制器意外故障或規劃的維護作業需要資料服務必須在相反的站台上線。如果站台之間的網路連線能力不支援所需的頻寬、效能就會受到影響。唯一的選項是將各種主機作業系統和相關服務容錯移轉至替代站台。HA 配對 MetroCluster 叢集可消除此問題、因為遺失控制器會導致同一個站台內的簡單容錯移轉。</block>
  <block id="0ce798a4f2e77d6aa1a6e0d718fa8e98" category="list-text">有些網路拓撲並非設計用於跨站台存取、而是使用不同的子網路或隔離的 FC SAN 。在這種情況下、雙節點 MetroCluster 叢集不再作為 HA 系統運作、因為替代控制器無法將資料提供給位於相反站台的伺服器。HA 配對 MetroCluster 選項是提供完整備援的必要條件。</block>
  <block id="098fa44ef37572e0f8ea717199ac72e6" category="list-text">如果將雙站台基礎架構視為單一的高可用度基礎架構、則雙節點 MetroCluster 組態很適合。不過、如果系統在站台故障後必須長時間運作、則最好使用 HA 配對、因為它會繼續在單一站台內提供 HA 。</block>
  <block id="ea8bb3e5a357ca97851352f6944342c9" category="section-title">雙節點 FC SAN 附加 MetroCluster</block>
  <block id="b759079fef92c80eca80e7349bf84363" category="paragraph">雙節點 MetroCluster 組態每個站台僅使用一個節點。此設計比 HA 配對選項簡單、因為要設定和維護的元件較少。此外、它也降低了佈線和 FC 交換方面的基礎架構需求。最後、它能降低成本。</block>
  <block id="5bfcbf762ac959212294cdf71bbec2b5" category="paragraph"><block ref="5bfcbf762ac959212294cdf71bbec2b5" category="inline-image-macro-rx" type="image"></block></block>
  <block id="bcf549481eb36a62594e938bca6a10bb" category="paragraph">這項設計的明顯影響是、控制器在單一站台上故障、表示資料可從另一個站台取得。這種限制不一定是個問題。許多企業都有多站台資料中心作業、並有延伸、高速、低延遲的網路、基本上是一個基礎架構。在這些情況下、 MetroCluster 的雙節點版本是慣用的組態。多家服務供應商目前以 PB 規模使用雙節點系統。</block>
  <block id="78558542e724655ba80fc4879399f103" category="section-title">MetroCluster 恢復功能</block>
  <block id="5427d2eb91f25a425f13544e56fb12c4" category="paragraph">MetroCluster 解決方案沒有單點故障：</block>
  <block id="6a988bf07e73bcbf69f62ce9724dd0f3" category="list-text">每個控制器都有兩條通往本機站台磁碟櫃的路徑。</block>
  <block id="2c98a75e02c6e103b43724f02e99e393" category="list-text">每個控制器都有兩條通往遠端站台磁碟機櫃的路徑。</block>
  <block id="e18f703538cd1f5af3b9185eed57b49b" category="list-text">每個控制器都有兩條通往另一個站台上控制器的路徑。</block>
  <block id="800ec0ea85a62c2fb192ac2f79ee1d02" category="list-text">在 HA 配對組態中、每個控制器都有兩條路徑通往本機合作夥伴。</block>
  <block id="a3d7a569ad6ea771a0ad9b995619251b" category="paragraph">總而言之、您可以移除組態中的任何一個元件、而不會影響 MetroCluster 提供資料的能力。這兩個選項之間恢復能力的唯一差異是 HA 配對版本在站台故障後仍是整個 HA 儲存系統。</block>
  <block id="9b4c3976d453e66a3dd22e2793fc3a8e" category="doc">空間管理</block>
  <block id="e89d3732a2fbc592923c30e54522dcdb" category="paragraph">精簡配置有多種形式、是 ONTAP 為企業應用程式環境提供的許多功能不可或缺的一部分。精簡配置也與效率技術密切相關、原因相同：效率功能可儲存比儲存系統技術更多的邏輯資料。</block>
  <block id="537642ed3bfef7f2bb3e580b3b266bd3" category="paragraph">幾乎任何快照的使用都需要精簡配置。例如、 NetApp 儲存設備上的典型 10TB 資料庫、包含約 30 天的快照。這種配置可在作用中的檔案系統中看到大約 10TB 的資料、而在快照中則有 300TB 的資料。總儲存容量為 310TB 、通常位於大約 12TB 到 15TB 的空間上。作用中資料庫消耗 10TB 、而其餘 300TB 的資料僅需要 2TB 到 5TB 的空間、因為只會儲存對原始資料所做的變更。</block>
  <block id="a19609016ad1cb6b7bae7cac796a26a4" category="paragraph">複製也是精簡配置的範例。一位主要 NetApp 客戶建立 40 個 80 TB 資料庫的複本、供開發人員使用。如果使用這些複本的 40 位開發人員都在每個資料檔案中覆寫每個區塊、則需要超過 3.2PB 的儲存空間。實際上，週轉率較低，而且由於磁碟機上只儲存變更，因此集體空間需求接近 40 TB 。</block>
  <block id="2433af6347e4871be5af0f2af0f6bd6e" category="paragraph">由於資料變更率可能會意外增加、因此精簡配置應用程式環境時必須謹慎處理。例如、如果資料庫資料表重新編製索引、或是將大規模的修補套用至 VMware 來賓系統、快照所造成的空間使用量就會迅速增加。錯誤的備份可能會在很短的時間內寫入大量資料。最後、如果檔案系統在非預期的情況下用盡可用空間、可能很難恢復某些應用程式。</block>
  <block id="5cf4dc4d1ce52ff655ea7f1157a72e2e" category="paragraph">幸運的是、這些風險可以透過仔細設定來解決<block ref="f9e1f2ea1a2becbaf82dd54e55a12e6b" prefix=" " category="inline-code"></block> 和<block ref="24d554277b3513bb6cef3f0a336725a9" prefix=" " category="inline-code"></block> 原則。如同其名稱所暗示、這些選項可讓使用者建立原則、以自動清除快照佔用的空間、或是增加磁碟區以容納額外資料。有許多選項可供選擇、需求因客戶而異。</block>
  <block id="6a28738961e6f6e4b57e4dd70c446600" category="inline-link-macro">邏輯儲存管理文件</block>
  <block id="01570cb5a3aec2324ab56e318e1de04d" category="paragraph">請參閱 <block ref="e69bd75bdb49183ee90588843edb33f4" category="inline-link-macro-rx"></block> 以完整討論這些功能。</block>
  <block id="8cf44a7a390ab582c5010ba430143d4b" category="section-title">LUN 精簡配置</block>
  <block id="ba0bdf51bc57bacdd6f3f0bd26b7674c" category="paragraph">在檔案系統環境中自動精簡配置作用中 LUN 的效率、可能會隨著資料刪除而隨時間而喪失。除非刪除的資料以零覆寫、或是以修剪 / 取消對應空間回收釋放空間、否則「清除的」資料會佔用檔案系統中越來越多的未分配空白。此外、在許多資料庫環境中、主動式 LUN 的精簡配置功能有限、因為資料檔案會在建立時初始化為全尺寸。</block>
  <block id="e10d46632bc86306cf4c22633ee930ab" category="paragraph">仔細規劃 LVM 組態可提高效率、並將儲存資源配置和 LUN 調整大小的需求降至最低。當使用 Veritas VxVM 或 Oracle ASM 等 LVM 時、基礎 LUN 會分割成僅在需要時才使用的範圍。例如、如果資料集的大小從 2TB 開始、但隨時間而成長至 10TB 、則此資料集可放置在配置在 LVM 磁碟群組中的 10TB 精簡配置 LUN 上。在建立時、它只會佔用 2TB 的空間、而且只會在分配範圍以容納資料成長時、才會要求額外的空間。只要監控空間、此程序就安全無虞。</block>
  <block id="66a41fd6fc38c454973e91d92cf0e291" category="section-title">部分保留</block>
  <block id="e8a206fe65814e0ea465e32487544751" category="paragraph">「部分保留」是指磁碟區中 LUN 在空間效率方面的行為。選項<block ref="c1acac5c4332e37ec1f281fcbaf0765a" prefix=" " category="inline-code"></block> 設為 100% 、磁碟區中的所有資料在任何資料模式下都能達到 100% 的營業額、而不會耗盡磁碟區上的空間。</block>
  <block id="a3cd28aef7d0becd57b60187fdc4a24e" category="paragraph">例如、假設資料庫位於 1TB 磁碟區中的單一 250GB LUN 上。建立快照將會立即在磁碟區中保留額外的 250GB 空間、以確保磁碟區不會因任何原因而用盡空間。使用分數保留通常是浪費、因為資料庫磁碟區中的每個位元組都不太可能需要覆寫。沒有理由為永遠不會發生的事件預留空間。不過、如果客戶無法監控儲存系統中的空間使用量、而且必須確定空間永遠不會用盡、則使用快照需要 100% 的部分保留。</block>
  <block id="e30fbe8981929fb070a820a213381bab" category="section-title">壓縮與重複資料刪除</block>
  <block id="1b6e4e9a2be031edc6f3da1f559ef884" category="paragraph">壓縮和重複資料刪除都是精簡配置的形式。例如、 50TB 的資料佔用空間可能會壓縮至 30TB 、因此可節省 20TB 。為了讓壓縮產生任何效益、其中某些 20TB 必須用於其他資料、或是儲存系統必須購買的容量低於 50TB 。因此、儲存的資料量比儲存系統技術上的資料量還多。從資料觀點來看、即使磁碟機僅佔用 30TB 、資料仍有 50TB 。</block>
  <block id="dbca4bb791f36eac2c11c32f73f2b4ec" category="paragraph">資料集的可壓縮性隨時都會變更、這會導致實際空間的使用量增加。這種使用量的增加意味著、在監控和使用方面、必須像其他形式的精簡配置一樣管理壓縮<block ref="f9e1f2ea1a2becbaf82dd54e55a12e6b" prefix=" " category="inline-code"></block> 和<block ref="24d554277b3513bb6cef3f0a336725a9" prefix=" " category="inline-code"></block>。</block>
  <block id="ad241666a88b5414e8c2fe6d1cc1edb0" category="paragraph">有關壓縮和重複資料刪除的詳細資訊、請參閱連結： efficiency.html 一節</block>
  <block id="8ecfcadfebb472a089481e8554ebed87" category="section-title">壓縮與部分保留</block>
  <block id="4f8fcc146d2e8e712dcd8c56b1684fcc" category="paragraph">壓縮是一種精簡配置形式。部分保留會影響壓縮的使用、並附有一個重要附註；在建立快照之前、會保留空間。通常、只有存在快照時、部分保留才會很重要。如果沒有快照、則部分保留並不重要。這不是壓縮的情況。如果在具有壓縮功能的磁碟區上建立 LUN 、 ONTAP 會保留空間以容納快照。在組態期間、這種行為可能會令人困惑、但這是預期的。</block>
  <block id="e26f8048b4bf60dad827c5a425271361" category="paragraph">舉例來說、請考慮使用 5GB LUN 的 10GB 磁碟區、該磁碟區已壓縮至 2.5GB 、但沒有快照。請考慮以下兩種情況：</block>
  <block id="ade18971a2dab7e37335e95d81da0ef1" category="list-text">分數保留 = 100 會導致 7.5 GB 使用率</block>
  <block id="1d07b8e7c92488a55301ea201328cf35" category="list-text">部分保留量 =0 會導致使用率為 2.5GB</block>
  <block id="aa410d0e46ec94b6efcf344f0d870c1a" category="paragraph">第一個案例包括目前資料使用 2.5 GB 的空間、以及 5 GB 的空間、可在預期使用快照時、讓來源的營業額達到 100% 。第二個案例不會保留額外空間。</block>
  <block id="e79414ad391b126cc9bd53af1624c8de" category="paragraph">雖然這種情況可能令人困惑、但實際上並不可能發生。壓縮意味著精簡配置、而 LUN 環境中的精簡配置則需要部分保留。壓縮資料永遠可以被無法壓縮的東西覆寫、這表示必須精簡配置磁碟區以進行壓縮、以節省任何成本。</block>
  <block id="499a10b92cb9ca6b3412d4bf5a91a2b0" category="paragraph">* NetApp 建議 * 下列保留組態：</block>
  <block id="7f26e875cee50c1b3baf71a014043794" category="list-text">設定<block ref="c1acac5c4332e37ec1f281fcbaf0765a" prefix=" " category="inline-code"></block> 與一起進行基本容量監控時為 0<block ref="f9e1f2ea1a2becbaf82dd54e55a12e6b" prefix=" " category="inline-code"></block> 和<block ref="24d554277b3513bb6cef3f0a336725a9" prefix=" " category="inline-code"></block>。</block>
  <block id="675996bd34ec0d8c134215f5be73fb3a" category="list-text">設定<block ref="c1acac5c4332e37ec1f281fcbaf0765a" prefix=" " category="inline-code"></block> 如果沒有監控能力、或在任何情況下都無法排放空間、則達到 100 。</block>
  <block id="8ee38535add58992c14b23a6f7cf8d27" category="doc">LIF 類型</block>
  <block id="50d034374ef68094a0f6c8e8d06a77af" category="inline-link-macro">ONTAP 網路管理文件</block>
  <block id="fc25025f3f0a2afd42465a55f35c02d0" category="paragraph">本節概述 LIF 的主要設計原則。如需更完整的文件、請參閱 <block ref="a3e6361e1a52d384f542a2f2d8bc9bb1" category="inline-link-macro-rx"></block>。與資料庫架構的其他層面一樣、儲存虛擬機器（ SVM 、在 CLI 稱為 vserver ）和邏輯介面（ LIF ）設計的最佳選項、在很大程度上取決於擴充需求和業務需求。</block>
  <block id="be0801f7fb241be642bec73b799d45cb" category="paragraph">建置 LIF 策略時、請考量下列主要主題：</block>
  <block id="362c2978dddcf6988ce266d3d60f5beb" category="list-text">* 效能。 * 網路頻寬是否足夠？</block>
  <block id="cfc88efb72b2c7ea83a4a3d68b760d55" category="list-text">* 恢復能力。 * 設計中是否有任何單點故障？</block>
  <block id="af02972fd4dc1e949d800731d9518812" category="list-text">* 管理能力。 * 網路是否能不中斷地擴充？</block>
  <block id="fdcbadc80d2dd31527cc91cf81fb725d" category="paragraph">這些主題適用於端點對端點解決方案、從主機到交換器、再到儲存系統。</block>
  <block id="f45fe079103703d0b315ff2e339728fd" category="inline-link-macro">LIF 類型的 ONTAP 文件</block>
  <block id="cc4583278db25277db9ddcd781cbf992" category="paragraph">有多種 LIF 類型。 <block ref="9d27879d9d2bd4f0f081ffed63159522" category="inline-link-macro-rx"></block> 提供更完整的本主題資訊、但從功能觀點來看、生命可分為下列群組：</block>
  <block id="f34a52d788c5a4cf56d7ae8ccb85f8c2" category="list-text">* 用於管理儲存叢集的叢集與節點管理生命期 * 。</block>
  <block id="73ac4e00a9ff3caf31e6df13a6df2f78" category="list-text">* SVM 管理階層。 * 允許透過 REST API 或 ONTAPI （也稱為 ZAPI ）存取 SVM 的介面、以執行快照建立或磁碟區調整大小等功能。SnapManager for Oracle （ SMO ）等產品必須能夠存取 SVM 管理 LIF 。</block>
  <block id="b7010e46f4769f638197aa230f448ba0" category="list-text">* 資料生命。 * FC 、 iSCSI 、 NVMe / FC 、 NVMe / TCP 、 NFS 、 或 SMB/CIFS 資料。</block>
  <block id="1eb4f53fa8ee8f0954514a1b9858bf6b" category="admonition">用於 NFS 流量的資料 LIF 也可透過變更防火牆原則來進行管理<block ref="8d777f385d3dfec8815d20f7496026dc" prefix=" " category="inline-code"></block> 至<block ref="d724f231a9a7b89757c4394d6622bc47" prefix=" " category="inline-code"></block> 或其他允許 HTTP 、 HTTPS 或 SSH 的原則。這項變更可避免每部主機的組態設定、以同時存取 NFS 資料 LIF 和個別的管理 LIF 、進而簡化網路組態。儘管這兩者都使用 IP 傳輸協定、但無法同時為 iSCSI 和管理流量設定介面。iSCSI 環境需要個別的管理 LIF 。</block>
  <block id="85d465743ad38be108b50648ab283d78" category="section-title">SAN LIF 設計</block>
  <block id="8800a54085e1b2987d83537423221cf9" category="paragraph">SAN 環境中的 LIF 設計相對簡單、原因有一：多重路徑。所有現代化的 SAN 實作均可讓用戶端透過多個、不受限制的網路路徑存取資料、並選擇最佳的存取路徑或路徑。因此、 LIF 設計的效能更容易因應、因為 SAN 用戶端會在最佳可用路徑之間自動平衡 I/O 負載。</block>
  <block id="e33c923a4d6280bf6f2b2a982ff74ee3" category="paragraph">如果路徑無法使用、用戶端會自動選取不同的路徑。因此設計簡易性讓 SAN 的工作更容易管理。這並不表示 SAN 環境總是更容易管理、因為 SAN 儲存設備還有許多其他層面比 NFS 複雜得多。這只是表示 SAN LIF 設計更簡單。</block>
  <block id="9446a98ad14416153cc4d45ab8b531bf" category="section-title">效能</block>
  <block id="141614e246b14131ec01a449d61ed657" category="paragraph">在 SAN 環境中、 LIF 效能的最重要考量是頻寬。例如、雙節點 ONTAP AFF 叢集每個節點有兩個 16GB FC 連接埠、可在每個節點之間提供高達 32GB 的頻寬。</block>
  <block id="02bc0523497de72834c4c7990e32d155" category="section-title">恢復能力</block>
  <block id="01b1d8276ca14813ff4804089a9ac082" category="paragraph">AFF 儲存系統上的 SAN Lifs 不會容錯移轉。如果 SAN LIF 因控制器容錯移轉而失敗、則用戶端的多重路徑軟體會偵測路徑遺失、並將 I/O 重新導向至不同的 LIF 。使用 ASA 儲存系統時、在短暫延遲後將會容錯移轉、但這不會中斷 IO 、因為其他控制器上已經有作用中的路徑。發生容錯移轉程序是為了在所有定義的連接埠上還原主機存取。</block>
  <block id="b7c94ef25c0629a65f8a1f6ce7014d95" category="section-title">管理能力</block>
  <block id="1325935a6fa0e88cfec45038005f18e3" category="paragraph">LIF 移轉是 NFS 環境中較常見的工作、因為 LIF 移轉通常與在叢集周圍重新放置磁碟區有關。當磁碟區移轉至 HA 配對內時、無需在 SAN 環境中移轉 LIF 。這是因為在磁碟區移動完成之後、 ONTAP 會傳送路徑變更通知給 SAN 、而 SAN 用戶端會自動重新最佳化。與 SAN 的 LIF 移轉主要與重大實體硬體變更有關。例如、如果需要不中斷營運的控制器升級、則 SAN LIF 會移轉至新硬體。如果發現 FC 連接埠故障、 LIF 就可以移轉至未使用的連接埠。</block>
  <block id="dbb887b1373e51dab774976c5a556964" category="section-title">設計建議</block>
  <block id="076872b2444637e6142c3c6f0f157423" category="paragraph">NetApp 提出下列建議：</block>
  <block id="d8d6bca7c981c13479781da85883cfef" category="list-text">請勿建立超過所需的路徑。過多的路徑會使整體管理更為複雜、並可能導致部分主機上路徑容錯移轉的問題。此外、有些主機對 SAN 開機等組態有非預期的路徑限制。</block>
  <block id="bd662d86fcca370cddf188ff5378fb1b" category="list-text">極少數組態需要四條以上的路徑才能連接到 LUN 。如果擁有 LUN 的節點及其 HA 合作夥伴故障、則無法存取主控 LUN 的集合、因此限制將超過兩個節點的路徑通告至 LUN 的價值。在非主要 HA 配對的節點上建立路徑、在這種情況下並無幫助。</block>
  <block id="8873f044ab7c082f16372e4b8bdc6e03" category="list-text">雖然可視 LUN 路徑的數量可以透過選擇 FC 區域中包含哪些連接埠來進行管理、但通常較容易在 FC 區域中包含所有潛在目標點、並控制 ONTAP 層級的 LUN 可見度。</block>
  <block id="0ebc6267761306c4daefb9871a470e4b" category="list-text">在 ONTAP 8.3 及更新版本中、選擇性 LUN 對應（ SLM ）功能為預設功能。透過 SLM 、任何新的 LUN 都會自動從擁有基礎 Aggregate 的節點和節點的 HA 合作夥伴通告。這種安排可避免建立連接埠集或設定分區、以限制連接埠存取。每個 LUN 都可在最佳效能和恢復能力所需的最小節點數上使用。
* 如果必須在兩個控制器之外移轉 LUN 、則可以使用新增額外的節點<block ref="02d0bbdc14988c85bbd7994723f4dd7f" prefix=" " category="inline-code"></block> 命令，以便在新節點上通告 LUN 。這樣做會建立通往 LUN 的額外 SAN 路徑、以進行 LUN 移轉。但是、主機必須執行探索作業、才能使用新路徑。</block>
  <block id="cc4b24f288afae5889c6061466dda472" category="list-text">不要過度擔心間接流量。最好在 I/O 密集環境中避免間接流量、因為每微秒的延遲都是關鍵、但對於一般工作負載而言、可見的效能影響卻微不足道。</block>
  <block id="f54fccb82abaa995eb9f86264f431505" category="section-title">NFS LIF 設計</block>
  <block id="e68dee93f11ae71aebd7a1e4c2abfc5a" category="paragraph">與 SAN 通訊協定不同、 NFS 定義多個資料路徑的能力有限。NFSv4 的平行 NFS （ pNFS ）擴充解決了這項限制、但由於乙太網路速度已達 100GB 、而且在新增其他路徑時、很少會有價值。</block>
  <block id="391dc675ec3d853200129b799ed5923e" category="section-title">效能與恢復能力</block>
  <block id="a0bd34f908e3947aa4aba15382354836" category="paragraph">雖然測量 SAN LIF 效能主要是從所有主要路徑計算總頻寬、但判斷 NFS LIF 效能需要仔細瞭解確切的網路組態。例如、兩個 10Gb 連接埠可設定為原始實體連接埠、或是可設定為連結集合體控制傳輸協定（ LACP ）介面群組。如果將它們設定為介面群組、則可根據流量是交換還是路由、使用不同的多個負載平衡原則。最後、 Oracle Direct NFS （ DNFS ）提供目前不存在於任何 OS NFS 用戶端的負載平衡組態。</block>
  <block id="e500ca27c6b92454c989d80e0445c359" category="paragraph">與 SAN 通訊協定不同的是、 NFS 檔案系統需要在通訊協定層恢復能力。例如、 LUN 一律設定為啟用多重路徑、表示儲存系統可使用多個備援通道、每個通道都使用 FC 傳輸協定。另一方面、 NFS 檔案系統則取決於單一 TCP/IP 通道的可用度、而該通道只能在實體層受到保護。這種配置是為何存在連接埠容錯移轉和 LACP 連接埠集合等選項。</block>
  <block id="35926e2ada969ad80fd3b16c0cd7d35a" category="paragraph">在 NFS 環境中、網路傳輸協定層會同時提供效能和恢復能力。因此、這兩個主題彼此交織在一起、必須一起討論。</block>
  <block id="84f4a5dfaa9613a469cd783c353a186c" category="section-title">將生命體繫結至連接埠群組</block>
  <block id="44bfb87c11d83c1b91c3589f2081e7ca" category="paragraph">若要將 LIF 繫結至連接埠群組、請將 LIF IP 位址與一組實體連接埠建立關聯。將實體連接埠集合在一起的主要方法是 LACP 。LACP 的容錯功能相當簡單； LACP 群組中的每個連接埠都會受到監控、並在發生故障時從連接埠群組中移除。不過、對於 LACP 在效能方面的運作方式、有許多誤解：</block>
  <block id="19a43026949fb6ef1017a54cf7c94f9b" category="list-text">LACP 不需要在交換器上進行組態以符合端點。例如、 ONTAP 可設定 IP 型負載平衡、而交換器則可使用 MAC 型負載平衡。</block>
  <block id="86501252b34395de5303a65f5e9943e3" category="list-text">使用 LACP 連線的每個端點可以個別選擇封包傳輸連接埠、但無法選擇用於接收的連接埠。這表示從 ONTAP 到特定目的地的流量會連結到特定連接埠、而傳回流量可能會到達不同的介面。但這不會造成問題。</block>
  <block id="298ca40b99dd3540dcd82ba5537f3f8d" category="list-text">LACP 不會一直平均分配流量。在擁有許多 NFS 用戶端的大型環境中、通常甚至會使用 LACP 集合中的所有連接埠。不過、環境中的任何一個 NFS 檔案系統都只能使用一個連接埠的頻寬、而非整個集合。</block>
  <block id="d071b5ccd1569aace97a0b4d6c0a71ac" category="list-text">雖然 ONTAP 上有資源配置資源配置資源 LACP 原則、但這些原則並不會解決從交換器到主機的連線問題。例如、主機上有四埠 LACP 主幹的組態、 ONTAP 上有四埠 LACP 主幹的組態、仍只能使用單一連接埠讀取檔案系統。雖然 ONTAP 可以透過所有四個連接埠傳輸資料、但目前沒有任何交換器技術可以透過所有四個連接埠從交換器傳送到主機。僅使用一個。</block>
  <block id="6e9e98dfaea1ca7860606f1fc05e414a" category="paragraph">在包含許多資料庫主機的大型環境中、最常見的方法是使用 IP 負載平衡、建立一個包含適當數量 10Gb （或更快）介面的 LACP 集合體。只要有足夠的用戶端、這種方法就能讓 ONTAP 提供所有連接埠的均勻使用。當組態中的用戶端較少時、負載平衡會中斷、因為 LACP 主幹不會動態重新分配負載。</block>
  <block id="7815da600ab459d2b05c5792f2271c1a" category="paragraph">建立連線後、特定方向的流量只會放置在一個連接埠上。例如、對透過四埠 LACP 主幹連接的 NFS 檔案系統執行完整表格掃描的資料庫、只會透過一個網路介面卡（ NIC ）讀取資料。如果只有三個資料庫伺服器在這種環境中、則可能所有三個都從同一個連接埠讀取、而其他三個連接埠則處於閒置狀態。</block>
  <block id="153f704ea16440133d51b1877af2a657" category="section-title">將生命與實體連接埠繫結</block>
  <block id="70e655aa3c03f840747c5272142b3527" category="paragraph">將 LIF 繫結至實體連接埠、可更精細地控制網路組態、因為 ONTAP 系統上的指定 IP 位址一次只與一個網路連接埠相關聯。然後、可透過設定容錯移轉群組和容錯移轉原則來實現恢復能力。</block>
  <block id="218f00463f5281b8ead536582c69ac3a" category="section-title">容錯移轉原則和容錯移轉群組</block>
  <block id="0a53c26a1bc4036c84fc3b4b63542744" category="inline-link-macro">適用於容錯移轉群組和原則的 ONTAP 網路管理文件</block>
  <block id="f29ae31443947c9782482ee9683dbc0e" category="paragraph">網路中斷期間的生命行為是由容錯移轉原則和容錯移轉群組所控制。不同版本的 ONTAP 已變更組態選項。請參閱 <block ref="96c8cd47b667604fb9991ace7d2eff29" category="inline-link-macro-rx"></block> 以取得所部署 ONTAP 版本的特定詳細資料。</block>
  <block id="0f2f345dd1247ae428cee703c1bf1c84" category="paragraph">ONTAP 8.3 及更高版本可根據廣播網域來管理 LIF 容錯移轉。因此、系統管理員可以定義所有可存取指定子網路的連接埠、並允許 ONTAP 選取適當的容錯移轉 LIF 。這種方法可由部分客戶使用、但由於缺乏可預測性、因此在高速儲存網路環境中有限制。例如、環境可同時包含 1Gb 連接埠、以供例行檔案系統存取、而 10Gb 連接埠則可用於資料檔案 I/O如果兩種連接埠都存在於同一個廣播網域中、 LIF 容錯移轉可能會導致資料檔案 I/O 從 10Gb 連接埠移至 1Gb 連接埠。</block>
  <block id="ced0729d57c08312b2b12382f2147d26" category="paragraph">總而言之、請考慮下列實務做法：</block>
  <block id="57cb6a7ba8acb7faa31cc5219bae83b3" category="list-text">將容錯移轉群組設定為使用者定義。</block>
  <block id="b444855eccae552d7fb79bf3d31a4f7b" category="list-text">將儲存容錯移轉（ SFO ）合作夥伴控制器上的連接埠填入容錯移轉群組、以便在儲存容錯移轉期間、生命體跟隨集合體。如此可避免產生間接流量。</block>
  <block id="86c48b21d166ed8e440a07e1d4a0b15d" category="list-text">使用效能特性與原始 LIF 相符的容錯移轉連接埠。例如、單一實體 10Gb 連接埠上的 LIF 應包含單一 10Gb 連接埠的容錯移轉群組。四埠 LACP LIF 應容錯移轉至另一個四埠 LACP LIF 。這些連接埠將是廣播網域中定義的連接埠子集。</block>
  <block id="3e839a73f7dc1262508f23a89628ca2d" category="list-text">將容錯移轉原則設為僅限 SFO 合作夥伴。這樣做可確保 LIF 在容錯移轉期間跟隨集合體。</block>
  <block id="85e82ce4c9842f978fa774c4fe96b14c" category="section-title">自動還原</block>
  <block id="3dc8610f78478640e47688101cecbfad" category="paragraph">設定<block ref="9f1b7141f09f19c4e33409646aef43cf" prefix=" " category="inline-code"></block> 視需要設定參數。大多數客戶偏好將此參數設為<block ref="b326b5062b2f0e69046810717534cb09" prefix=" " category="inline-code"></block> 讓 LIF 還原至其主連接埠。不過、在某些情況下、客戶將此設定為「假」、表示在將 LIF 傳回其主連接埠之前、可以調查非預期的容錯移轉。</block>
  <block id="edf6d4c299bc2890ba63c7eb3ef8b4d2" category="section-title">LIF 與 Volume 比率</block>
  <block id="9c75becef8c432a0152a40c7c037a04c" category="paragraph">常見的誤解是、磁碟區和 NFS 生命體之間必須有一對一的關係。雖然在叢集中的任何位置移動磁碟區都需要此組態、但絕不會產生額外的互連流量、但絕對不需要此組態。必須考慮叢集間流量、但僅存在叢集間流量並不會造成問題。為 ONTAP 所發佈的許多基準測試主要包括間接 I/O</block>
  <block id="2b4ebcd522b07b80d3fd76b301c506e8" category="paragraph">例如、資料庫專案中包含相對少數的效能關鍵資料庫、只需要總共 40 個磁碟區、可能需要將 1 ： 1 磁碟區轉換為 LIF 策略、這種安排需要 40 個 IP 位址。然後、任何磁碟區都可以連同相關的 LIF 一起移至叢集中的任何位置、而且流量永遠是直接的、即使在微秒層級、也能將每個延遲來源減至最低。</block>
  <block id="38bad4911bcdf1117d37eb1195566f8c" category="paragraph">舉例來說、大型託管環境的管理可能更容易、因為客戶與生命的關係是一對一。隨著時間的推移、可能需要將磁碟區移轉至不同的節點、這會造成一些間接流量。但是、除非互連交換器上的網路連接埠飽和、否則效能影響應該無法偵測。如果有疑慮、可以在其他節點上建立新的 LIF 、並在下一個維護時段更新主機、以移除組態中的間接流量。</block>
  <block id="d75b0d8f723c3e97eaa4ca39630c7420" category="doc">MetroCluster 和多個集合體</block>
  <block id="df5855269b493a27a5565dfd9f2584f0" category="list-text">在正常情況下、傳入的寫入資料會同步鏡射至指定的控制器、以供其合作夥伴使用。在 NetApp MetroCluster 環境中、寫入也會鏡射到遠端控制器。除非寫入儲存在所有位置的非揮發性媒體中、否則不會對主機應用程式進行確認。</block>
  <block id="05b60db315aa45e1524b7a6ffa242fa8" category="list-text">儲存寫入資料的媒體稱為非揮發性記憶體或 NVMEM 。它有時也稱為非揮發性隨機存取記憶體（ NVRAM ）、雖然它是日誌、但仍可視為寫入快取。在正常作業中、不會讀取來自 NVMEM 的資料；只有在軟體或硬體故障時、才會用來保護資料。當資料寫入磁碟機時、資料會從系統的 RAM 傳輸、而非從 NVMEM 傳輸。</block>
  <block id="e6dd8b559da6e046f2043043a55faafc" category="list-text">在接管作業期間、高可用度（ HA ）配對中的一個節點會接管其合作夥伴的作業。切換基本上相同、但適用於遠端節點接管本機節點功能的 MetroCluster 組態。</block>
  <block id="33c0c466972aae7427262e3075a2ed07" category="paragraph">在例行維護作業期間、儲存設備接管或切換作業應該是透明的、但網路路徑變更時、操作可能會短暫暫停。然而、網路連線可能很複雜、而且容易出錯、因此 NetApp 強烈建議您在將儲存系統投入生產之前、先徹底測試接管和轉換作業。這樣做是確保正確設定所有網路路徑的唯一方法。在 SAN 環境中、請仔細檢查命令的輸出<block ref="41dc2c94e82e1c56ba876085acf5a974" prefix=" " category="inline-code"></block> 以確保所有預期的主要和次要路徑都可用。</block>
  <block id="d33ea1ad1493de23aafd480e95fea159" category="paragraph">發出強制接管或關機時、請務必小心。使用這些選項強制變更儲存組態、表示會忽略擁有磁碟機的控制器狀態、而替代節點則強制控制磁碟機。不正確地強制接管可能會導致資料遺失或毀損。這是因為強制接管或變更會捨棄 NVMEM 的內容。在接管或切換完成後、資料遺失表示儲存在磁碟機上的資料可能會從資料庫的角度還原到稍微舊的狀態。</block>
  <block id="c226371d96b605ccff84ad23db0069b8" category="paragraph">很少需要強制接管正常的 HA 配對。在幾乎所有故障情況下、節點都會關機並通知合作夥伴、以便進行自動容錯移轉。有些邊緣情況、例如發生滾動故障、節點之間的互連中斷、然後一個控制器遺失、需要強制接管。在這種情況下、節點之間的鏡像會在控制器故障之前遺失、這表示當機的控制器將不再擁有正在進行的寫入複本。然後需要強制接管、這表示資料可能會遺失。</block>
  <block id="418f81f529a577cb711b44adece1376f" category="paragraph">同樣的邏輯也適用於 MetroCluster 轉換。在正常情況下、可進行的作業幾乎透明化。然而、災難可能會導致仍在運作的站台和災難站台之間的連線中斷。從仍在運作的站台觀點來看、問題可能只是站台之間的連線中斷、而原始站台可能仍在處理資料。如果節點無法驗證主控制器的狀態、則只能強制進行移轉。</block>
  <block id="ae0c16d397348d8f8fd4e56b08b06c7c" category="paragraph">* NetApp 建議 * 採取下列預防措施：</block>
  <block id="79fd18cb18befbe5c2113757478be193" category="list-text">請務必小心、避免意外強制接管或切入。一般而言、不應強制、強制變更可能會導致資料遺失。</block>
  <block id="26cece11254903c5ba8bfdd8d54ae779" category="list-text">如果需要強制接管或移除、請確定應用程式已關機、所有檔案系統均已卸除、且邏輯 Volume Manager （ LVM ）磁碟區群組已移除。必須卸載 ASM 磁碟群組。</block>
  <block id="0b6986eb1285d28a9987ea13adbca358" category="list-text">在強制 MetroCluster 轉換的情況下、請將故障節點從所有仍在運作的儲存資源中隔離。如需詳細資訊、請參閱 MetroCluster 管理與災難恢復指南、以取得相關版本的 ONTAP 。</block>
  <block id="71303adf87737046acd4381c72151278" category="paragraph">MetroCluster 是一種同步複寫技術、可在連線中斷時切換至非同步模式。這是客戶最常提出的要求、因為保證同步複寫意味著站台連線中斷會導致資料庫 I/O 完全停止、使資料庫停止運作。</block>
  <block id="cb791a44ee361703eb7594a7932f57de" category="paragraph">透過 MetroCluster 、集合體在連線恢復後會快速重新同步。與其他儲存技術不同、 MetroCluster 在站台故障後絕不應要求完整的重新鏡射。只能運送差異變更。</block>
  <block id="c1536091d7c1ca33c9dc4dfa8c0852a2" category="paragraph">在跨集合體的資料集中、在循環災難案例中需要額外的資料恢復步驟、風險很小。具體而言、如果（ a ）站台之間的連線中斷、（ b ）連線恢復、（ c ）集合體會達到某種狀態、其中有些是同步的、有些則不是同步的、 然後（ d ）主站台會遺失、結果是無法運作的站台、而集合體彼此之間不會同步。如果發生這種情況、資料集的某些部分會彼此同步、因此無法在沒有恢復的情況下啟動應用程式、資料庫或資料存放區。如果資料集橫跨整個集合體、 NetApp 強烈建議您利用快照式備份、搭配眾多可用工具之一、在這種不尋常的情況下驗證快速的可恢復性。</block>
  <block id="a42c87064c284490a38efac4bf0b7f7f" category="paragraph">RAID 4 、 RAID 5 、 RAID 6 、 RAID DP 和 RAID-TEC 都使用同位元檢查來確保磁碟機故障不會導致資料遺失。與鏡像相比、這些 RAID 選項可提供更好的儲存使用率、但大多數 RAID 實作都有影響寫入作業的缺點。在其他 RAID 實作上完成寫入作業可能需要多個磁碟機讀取才能重新產生同位元資料、這是一種通常稱為 RAID 懲罰的程序。</block>
  <block id="3cfcf9a3299db75df9aa0e024ebef965" category="paragraph">不過、 ONTAP 並不會因此而受到此 RAID 處罰。這是因為 NetApp WAFL （隨處寫入檔案配置）與 RAID 層整合。寫入作業會整合在 RAM 中、並準備為完整的 RAID 等量磁碟區、包括同位元檢查產生。ONTAP 不需要執行讀取即可完成寫入、這表示 ONTAP 和 WAFL 可以避免 RAID 的損失。對於延遲關鍵作業（例如重作記錄）的效能不受阻礙、隨機的資料檔案寫入不會因重新產生同位元檢查而導致任何 RAID 損失。</block>
  <block id="5ff9a871332f0f82f38d880b68a9874b" category="paragraph">在統計可靠性方面、即使是 RAID DP 也能提供比 RAID 鏡射更好的保護。主要問題是 RAID 重建期間對磁碟機的需求。有了鏡射 RAID 集、當磁碟機在重建時發生故障、而在 RAID 組中重建其合作夥伴時、資料遺失的風險遠高於 RAID DP 組中發生三重磁碟機故障的風險。</block>
  <block id="12c3fe87fd5a746ce8a7cbe25dc1c25b" category="paragraph">在快閃磁碟機時代之前、使用區塊延展來協助克服旋轉磁碟機的效能限制。例如、如果作業系統需要執行 1MB 讀取作業、則從單一磁碟機讀取 1MB 的資料時、需要大量的磁碟機磁頭搜尋和讀取、因為 1MB 會緩慢傳輸。如果將 1MB 的資料分散在 8 個 LUN 上、則作業系統可能會同時執行 8 個 128K 讀取作業、並縮短完成 1MB 傳輸所需的時間。</block>
  <block id="e337352c3d57672fd08af8ba709b544f" category="paragraph">由於必須事先知道 I/O 模式、因此使用旋轉磁碟機進行分拆會更困難。如果串列區塊延展未針對真正的 I/O 模式正確調整、則等量區塊配置可能會損害效能。使用 Oracle 資料庫、特別是搭配 All Flash 組態、分拆作業更容易設定、並經證實可大幅提升效能。</block>
  <block id="7025652291dc6872022b0f79a2b2be21" category="paragraph">依預設、邏輯磁碟區管理程式（例如 Oracle ASM 等量磁碟區）不屬於原生 OS LVM 。其中有些 LUN 會將多個 LUN 連結在一起、成為串連的裝置、導致資料檔案存在於一台 LUN 裝置上、而只存在於一台 LUN 裝置上。這會造成熱點。其他 LVM 實作預設為分散式擴充。這與分拆類似、但卻是比較粗糙的。磁碟區群組中的 LUN 會切成大型片段、稱為區段、通常以百萬位元組為單位測量、然後邏輯磁碟區會分佈在這些區段中。結果是對檔案進行隨機 I/O 、應該能在 LUN 之間妥善分配、但連續 I/O 作業的效率卻不如以前那麼高。</block>
  <block id="0c2f3b2ec9d90baa0a0a0b6fb673a113" category="paragraph">效能密集的應用程式 I/O 幾乎總是（ a ）以基本區塊大小為單位、或（ b ） 1 MB 。</block>
  <block id="804d5b1f06570b4d242be0c2f0c3392c" category="paragraph">等量分配組態的主要目標是確保單一檔案 I/O 可作為單一單元執行、而多區塊 I/O 的大小應為 1MB 、可在等量磁碟區中的所有 LUN 之間平均平行處理。這表示等量磁碟區大小不得小於資料庫區塊大小、且等量磁碟區大小乘以 LUN 數量應為 1MB 。</block>
  <block id="0598f393baefd05d48b48076cc7df606" category="paragraph">下圖顯示等量磁碟區大小和寬度調校的三個可能選項。選擇 LUN 數量以滿足上述效能需求、但在所有情況下、單一等量磁碟區內的總資料為 1MB 。</block>
  <block id="9ca503fae9ccd4d6d8e67806b23adfa0" category="paragraph"><block ref="9ca503fae9ccd4d6d8e67806b23adfa0" category="inline-image-macro-rx" type="image"></block></block>
  <block id="0353522b39b87d54d40d3f09ec668851" category="doc">組態ONTAP</block>
  <block id="8e52de0d4b03d5fe87dc88da09616c7f" category="inline-link-macro">請按這裡。</block>
  <block id="337c62c6b6eb7319bae58701105e889c" category="doc">分層</block>
  <block id="3493794b3ccb587f71a663f51f4484ef" category="summary">ONTAP 上的 PostgreSQL 資料庫</block>
  <block id="2d3298c651b356a82db5d664ce68e65e" category="doc">原生資料保護</block>
  <block id="31c6611c8e0bd237a3ee51db1728a440" category="paragraph">儲存設計的主要層面之一、是為 PostgreSQL Volume 提供保護。客戶可以使用傾印方法或使用檔案系統備份來保護 PostgreSQL 資料庫。本節說明備份個別資料庫或整個叢集的不同方法。</block>
  <block id="9f3265914462c64fd02bc50ab4c9ebe9" category="paragraph">備份 PostgreSQL 資料有三種方法：</block>
  <block id="6b592c7950245a5a9f54d9424e851e97" category="list-text">SQL Server 傾印</block>
  <block id="c8b1fc69d12d1da6589e384671c8e82c" category="list-text">檔案系統層級備份</block>
  <block id="3c25062a0babfa1495dd604698707610" category="list-text">持續歸檔</block>
  <block id="58c132e2be12705408a7456c6183b617" category="paragraph">SQL Server 傾印方法背後的想法是使用 SQL Server 命令產生檔案、當檔案傳回伺服器時、就能像在傾印時一樣重新建立資料庫。PostgreSQL 提供公用程式<block ref="5a5149b2817f30cbb3805307f9cadae4" prefix=" " category="inline-code"></block> 和<block ref="0ead269b3d000482b5a44a1ef4e8cd54" prefix=" " category="inline-code"></block> 用於建立個別和叢集層級的備份。這些傾印都是邏輯的、而且沒有足夠的資訊可供 Wal 重新執行使用。</block>
  <block id="1d05b80fc6f199681263e063190e8325" category="paragraph">另一種備份策略是使用檔案系統層級的備份、系統管理員可在其中直接複製 PostgreSQL 用來將資料儲存在資料庫中的檔案。此方法是在離線模式下執行：必須關閉資料庫或叢集。另一種方法是使用<block ref="35679fc424d9eec0c30f38459fd9b322" prefix=" " category="inline-code"></block> 執行 PostgreSQL 資料庫的熱串流備份。</block>
  <block id="10907e7ac5ab6e5235a23898a2331b31" category="doc">ONTAP 上的 PostgreSQL 資料庫</block>
  <block id="b5f477e959f26421a80e1eebdadbdd71" category="paragraph">PostgreSQL 隨附的變種包括 PostgreSQL 、 PostgreSQL Plus 和 EDBS PostgreSQL 進階伺服器（ EPAS ）。PostgreSQL 通常部署為多層應用程式的後端資料庫。它受一般中介軟體套件的支援（例如 PHP 、 Java 、 Python 、 Tcl/Tk 、 ODBC 、 和 JDBC) ，過去一直是開放原始碼資料庫管理系統的熱門選擇。NetApp ONTAP 是執行 PostgreSQL 資料庫的絕佳選擇、可確保其可靠性、高效能及高效率的資料管理功能。</block>
  <block id="841a21e58e7c22a71c07b89a4362d2b6" category="admonition">ONTAP 和 PostgreSQL 資料庫上的這份文件取代先前發佈的 _TR-4770 ： ONTAP 最佳實務做法的 PostgreSQL 資料庫。 _</block>
  <block id="9147e5e61a7b9260dec09f3a6eb3e5be" category="doc">快照</block>
  <block id="0b9d99167191c5d9ad23ca07bc6a9b38" category="paragraph">PostgreSQL 的 Snapshot 型備份需要為資料檔案、 Wal 檔案和歸檔的 Wal 檔案組態快照、才能提供完整或時間點還原。</block>
  <block id="8c6a53edc4449a4cc3983d47ecffa851" category="paragraph">對於 PostgreSQL 資料庫而言、快照的平均備份時間介於數秒到數分鐘之間。此備份速度比快 60 至 100 倍<block ref="35679fc424d9eec0c30f38459fd9b322" prefix=" " category="inline-code"></block> 以及其他檔案系統備份方法。</block>
  <block id="c798632224ae09152f66f60e0edc757e" category="paragraph">NetApp 儲存設備上的快照既可一致當機、也可一致應用程式。當機一致的快照是在儲存設備上建立、而不會停止資料庫、而在資料庫處於備份模式時則會建立應用程式一致的快照。NetApp 也可確保後續快照是永久遞增備份、以節省儲存成本並提高網路效率。</block>
  <block id="d0e369216eeac8de66e915909364970a" category="paragraph">由於快照速度很快、不會影響系統效能、因此您可以每天排程多個快照、而不必像其他串流備份技術一樣建立單一的每日備份。當需要還原與還原作業時、系統停機時間會減少兩項重要功能：</block>
  <block id="316eb8adba4d16a34c92eaf9db381b9e" category="list-text">NetApp SnapRestore 資料還原技術代表還原作業只需數秒即可完成。</block>
  <block id="c128c475c12703e37685edd6db8144bc" category="list-text">積極的恢復點目標（ RPO ）意味著必須套用較少的資料庫記錄、同時也加速轉送恢復。</block>
  <block id="9b9f26085ff7149d4dbb916b1db0f121" category="paragraph">若要備份 PostgreSQL 、您必須使用（一致性群組） Wal 和歸檔記錄、確保資料磁碟區同時受到保護。使用 Snapshot 技術複製 Wal 檔案時、請務必執行<block ref="a3b8c8ee15ba60bfb2b999195d2b4e7d" prefix=" " category="inline-code"></block> 清除所有必須歸檔的 Wal 項目。如果您在還原期間清除 Wal 項目、則只需要停止資料庫、卸載或刪除現有的資料目錄、並在儲存設備上執行 SnapRestore 作業。還原完成後、您可以掛載系統並將其恢復至目前狀態。對於時間點恢復、您也可以還原 Wal 和歸檔記錄檔、然後 PostgreSQL 會決定最一致的點並自動恢復。</block>
  <block id="8e8d6187572eace409fee5bf2dbb7cf9" category="paragraph">一致性群組是 ONTAP 中的一項功能、建議在有多個磁碟區掛載到單一執行個體或具有多個資料表空間的資料庫時使用。一致性群組快照可確保將所有磁碟區分組並加以保護。一致性群組可從 ONTAP 系統管理員有效管理、您甚至可以複製它來建立資料庫的執行個體複本、以供測試或開發之用。</block>
  <block id="55ca4b30c6f7c3ef975a6d1e1fb222a2" category="inline-link-macro">NetApp 一致性群組總覽</block>
  <block id="69dd5879aee425e37fdd5796a8e06a56" category="paragraph">如需一致性群組的詳細資訊、請參閱 <block ref="112c5744a39904facdbc5fab385d9fe1" category="inline-link-macro-rx"></block>。</block>
  <block id="7e7397a7b79323762c61941fc0e6b5f9" category="doc">資料保護</block>
  <block id="16a49d0bc0249ef3dd42949589a0ed4e" category="doc">表格空間</block>
  <block id="d6d544de56c329d9f68bb176c6245e7c" category="paragraph">初始化資料庫叢集時會自動建立兩個資料表空間。</block>
  <block id="6df924905e21856e4e8b8f936767cdd6" category="paragraph">。<block ref="bd676cbef0d168a62a062c8709af1824" prefix=" " category="inline-code"></block> 表空間用於共享系統目錄。。<block ref="3224684b8e7208962a73daeb0bb24110" prefix=" " category="inline-code"></block> 表空間是 template1 和 template0 資料庫的預設資料表空間。如果初始化叢集的磁碟分割或磁碟區空間不足且無法擴充、則可在不同的磁碟分割上建立資料表空間、並在重新設定系統之前使用。</block>
  <block id="364c9d7b9593277eee9477befaf9f66b" category="paragraph">大量使用的索引可以放在快速、高可用度的磁碟上、例如固態裝置。此外、儲存歸檔資料的表格、無論是極少使用或非效能關鍵、都可以儲存在成本較低、速度較慢的磁碟系統上、例如 SAS 或 SATA 磁碟機。</block>
  <block id="9bfe8d8e1117bd1d4b8597220e3f166e" category="paragraph">資料表空間是資料庫叢集的一部分、無法視為資料檔案的獨立集合。它們取決於主資料目錄中包含的中繼資料、因此無法附加至不同的資料庫叢集或個別備份。同樣地、如果您遺失資料表空間（透過檔案刪除、磁碟故障等方式）、資料庫叢集可能會變得無法讀取或無法啟動。將資料表空間放在像 RAM 磁碟一樣的暫存檔案系統上、會危及整個叢集的可靠性。</block>
  <block id="7d9573b1ed3543ec6ea42c81830dc27c" category="paragraph">建立表格後、如果要求的使用者擁有足夠的權限、則可以從任何資料庫使用表格區。PostgreSQL 使用符號連結來簡化資料表空間的實作。PostgreSQL 會在中新增一列<block ref="4a926dc6e7549c49a13755513af41e67" prefix=" " category="inline-code"></block> 表（叢集範圍表格）、並將新的物件識別碼（ OID ）指派給該列。最後、伺服器會使用 OID 在叢集與指定目錄之間建立符號連結。目錄<block ref="8e3da386e945c59fb1e1cd1d7a47697c" prefix=" " category="inline-code"></block> 包含指向叢集中定義的每個非內建表格空間的符號連結。</block>
  <block id="249fd7d68098688fab42436eed51be7d" category="doc">資料庫組態</block>
  <block id="8daf26b2c72dd18a89fa89a6b1aa988d" category="paragraph">有幾種 PostgreSQL 調校組態可以改善效能。</block>
  <block id="abb3dae412afe5c801e9ab90de71675b" category="paragraph">最常用的參數如下：</block>
  <block id="bfdf741f4acb3dfee6e87075b535610e" category="list-text"><block ref="39d79378db03fed7c5ba62efba38e327" prefix="" category="inline-code"></block>：一次擁有的最大資料庫連線數。使用此參數可限制磁碟交換並終止效能。根據應用程式需求、您也可以針對連線集區設定調整此參數。</block>
  <block id="9625e1a6f5d1f695fd1c72401afaa07e" category="list-text"><block ref="904d399f43708a8a5b6d10c1ee3f8356" prefix="" category="inline-code"></block>：提高資料庫伺服器效能的最簡單方法。對於大多數現代硬體而言、預設值為低。在部署期間、系統上的可用 RAM 約為 25% 。此參數設定會因其與特定資料庫執行個體的運作方式而異；您可能必須根據試用和錯誤來增加和減少值。不過、將其設為高可能會降低效能。</block>
  <block id="d1960c56572383fc401fec3f0b767cf9" category="list-text"><block ref="5edeed59821790d8bec6d32da26bca4c" prefix="" category="inline-code"></block>：此值告訴 PostgreSQL 的最佳化程式 PostgreSQL 有多少記憶體可用於快取資料、並有助於判斷是否使用索引。較大的值會增加使用索引的可能性。此參數應設為分配給的記憶體容量<block ref="e15ed0f69e5c2475450b97691d6a2cee" prefix=" " category="inline-code"></block> 加上可用的作業系統快取容量。此值通常超過系統總記憶體的 50% 。</block>
  <block id="508df54f84fc7abb00f3a92937ca3506" category="list-text"><block ref="1edef4d43b06d4deb28010505df5724d" prefix="" category="inline-code"></block>：此參數控制用於排序作業和雜湊表的記憶體容量。如果您在應用程式中進行大量排序、可能需要增加記憶體容量、但請謹慎。它不是系統範圍的參數、而是每次操作的參數。如果複雜查詢中有多個排序作業、則會使用多個 work_mem 記憶體單元、而多個後端也可能同時執行此作業。如果值太大、此查詢通常會引導您的資料庫伺服器進行切換。此選項先前在舊版 PostgreSQL 中稱為 sort_mem 。</block>
  <block id="59d9770060aecba84c7e8ed849b5653d" category="list-text"><block ref="65768448b4f275b95af20a317c7355a9" prefix="" category="inline-code"></block>：此參數確定在提交事務之前是否應使用 fsync （）將所有 Wal 頁面同步到磁盤。關閉它有時會改善寫入效能、並將其開啟、以提高系統當機時避免毀損的風險。</block>
  <block id="625a65dd6cef83bac66319bde3894899" category="list-text"><block ref="ff5a06a39dd6824f30a778a51cf7ea69" prefix="" category="inline-code"></block>：檢查點處理程序會將已提交的資料清除至磁碟。這涉及磁碟上的大量讀寫作業。此值以秒為單位設定、較低的值可減少損毀恢復時間、而增加的值則可減少檢查點呼叫、進而降低系統資源的負載。根據應用程式的關鍵程度、使用量、資料庫可用度、設定 checkpoint 逾時的值。</block>
  <block id="309b1036c45e7ad490448925dc4f9597" category="list-text"><block ref="6a5c0586429891e84e05d6ab15088405" prefix="" category="inline-code"></block> 和<block ref="9080796d32078fea7d191100eab64f92" prefix=" " category="inline-code"></block>：這些選項可同時用於撰寫多筆同時提交的交易、以協助改善效能。如果交易提交時有多個 command_sibliblings 物件處於作用中狀態、伺服器會等待 command_delay 微秒、嘗試一次提交多個交易。</block>
  <block id="8d5137ce002c6328c2b5f4f328662e1d" category="list-text"><block ref="fa4ca2cd95c20a44171f964fb8f5fdb9" prefix="" category="inline-code"></block>：配置流程的最佳工作人員數量。max_paralle_founds 對應可用的 CPU 數量。視應用程式設計而定、查詢可能需要較少的工作人員來執行平行作業。最好保持兩個參數的值相同、但在測試後調整值。</block>
  <block id="c8736e7ca19e9096796c624f3030dae5" category="list-text"><block ref="8dda85a5feb6de66d8f5f9a4cbdb0754" prefix="" category="inline-code"></block>：此值控制 PostgreSQL 檢視非連續磁碟讀取的方式。較高的值表示 PostgreSQL 較可能使用連續掃描、而非索引掃描、表示伺服器有快速磁碟。請在評估其他選項（例如計畫型最佳化、吸塵、索引以變更查詢或架構）之後、修改此設定。</block>
  <block id="17edf3863f12b7d9480b3336a9fca773" category="list-text"><block ref="709989c844c22473cb8406550423d39a" prefix="" category="inline-code"></block>：此參數設置 PostgreSQL 嘗試同時執行的並行磁盤 I/O 操作數。提高此值會增加任何個別 PostgreSQL 工作階段嘗試平行啟動的 I/O 作業數。允許範圍為 1 到 1 、 000 、或為零、以停用非同步 I/O 要求的發出。目前、此設定只會影響點陣圖堆疊掃描。固態硬碟（ SSD ）和其他記憶體型儲存設備（ NVMe ）通常可以處理許多並行要求、因此最佳價值可能在數百種環境中。</block>
  <block id="82b38edb10ad73f9645c5d65e73a659b" category="paragraph">如需 PostgreSQL 組態參數的完整清單、請參閱 PostgreSQL 文件。</block>
  <block id="402fbc243dbef50cd5c8e57ccbdd92f5" category="section-title">吐司</block>
  <block id="0d2b62abb26bd0b4109f5bc967250933" category="paragraph">Toast 代表「超大型屬性儲存技術」。PostgreSQL 使用固定的頁面大小（通常為 8KB ）、不允許 Tuple 跨越多個頁面。因此、無法直接儲存大欄位值。當您嘗試儲存超過此大小的資料列時、 Toast 會將大型資料欄的資料分成較小的「片段」、並將其儲存在 Toast 資料表中。</block>
  <block id="3f11f21bdc22c3c955c3f0fca39e9bc0" category="paragraph">只有在將結果集傳送至用戶端時、才會拔出（如果完全選取）已烘烤的屬性大值。表格本身比沒有任何離線儲存設備（ Toast ）時更小、可容納更多資料列到共用緩衝區快取中。</block>
  <block id="9a311ef6dad816cb7a15c0ab41920ad8" category="section-title">真空</block>
  <block id="385e23b8ebe64dfd0005f6846cc8e85e" category="paragraph">在正常的 PostgreSQL 作業中、因為更新而刪除或過時的 Tuple 不會從其表格中實際移除、直到執行真空為止。因此、您必須定期執行吸氣、尤其是在經常更新的表格上。接著必須回收它所佔用的空間、以便新列重複使用、以避免磁碟空間中斷。不過、它不會將空間傳回作業系統。</block>
  <block id="db81319c35b48ed94867775a9a1ce1d7" category="paragraph">頁面內的可用空間不會分散。真空會重新寫入整個區塊、有效地將剩餘的資料列封裝起來、並在頁面中留下一個連續的可用空間區塊。</block>
  <block id="8a5c17164c9920590fc057ee01f2fcb3" category="paragraph">相反地、使用「完全真空」技術、可以撰寫完全新版的表格檔案、而不會有任何空間。此動作可將表格大小減至最小、但可能需要很長時間。在作業完成之前、它也需要額外的磁碟空間來容納表格的新複本。例行真空的目標是避免完全真空。此程序不僅能將資料表保持在最小大小、還能維持磁碟空間的穩定狀態使用量。</block>
  <block id="61bcd96a2c1f8026527cbf2019d6e9a4" category="doc">初始化</block>
  <block id="f4f9dac58f7c47e819293af5f2dd1177" category="paragraph">您可以使用建立新的資料庫叢集<block ref="abc91e782cd3950bfa31202aff74ca69" prefix=" " category="inline-code"></block> 方案。一<block ref="abc91e782cd3950bfa31202aff74ca69" prefix=" " category="inline-code"></block> 指令碼會建立定義叢集的資料檔案、系統表格和範本資料庫（ template0 和 template1 ）。</block>
  <block id="b668460552732302350bbb840d57931c" category="paragraph">範本資料庫代表常用資料庫。其中包含系統表格、標準檢視、功能和資料類型的定義。<block ref="3865cf98fe802a965570b4a10a1d894b" prefix=" " category="inline-code"></block> 做為的引數<block ref="abc91e782cd3950bfa31202aff74ca69" prefix=" " category="inline-code"></block> 指定資料庫叢集位置的指令碼。</block>
  <block id="8fcd14822a5b94d212898fe3e006526e" category="paragraph">PostgreSQL 中的所有資料庫物件都是由各自的 OID 在內部管理。表格和索引也由個別的 OID 管理。資料庫物件與其各自的 OID 之間的關係會儲存在適當的系統目錄表格中、視物件類型而定。例如、資料庫和堆積表格的 OID 會儲存在中<block ref="d0fcebb608269edbd5d67486884ebed7" prefix=" " category="inline-code"></block> 和 "pg_class" 。您可以在 PostgreSQL 用戶端上發佈查詢來判斷 OID 。</block>
  <block id="d0e97e34fe92edd2facd0f7377b6340b" category="paragraph">每個資料庫都有自己的個別資料表和索引檔案、限制為 1GB 。每個表格都有兩個相關的檔案、分別以後綴表示<block ref="7b9b00c45b01f7b7c6d3a3c8ba2e9275" prefix=" " category="inline-code"></block> 和<block ref="a1d869a79e2f43693a6a416fcbdc2724" prefix=" " category="inline-code"></block>。它們稱為可用空間地圖和可見度地圖。這些檔案會儲存可用空間容量的相關資訊、並在表格檔案中的每個頁面上都有可見度。索引只有個別的可用空間地圖、而且沒有可見度地圖。</block>
  <block id="048a7ed79caf84bb5c725efc5f474911" category="paragraph">。<block ref="c28f4f32219f5ff99fb4b116980b8549" prefix=" " category="inline-code"></block> 目錄包含預先寫入記錄。預先寫入記錄可用來改善資料庫的可靠性和效能。每當您更新表格中的列時、 PostgreSQL 會先將變更寫入預先寫入記錄、然後將修改寫入實際的資料頁面到磁碟。。<block ref="f7223cfaa9416056a91e259e326ac5cf" prefix=" " category="inline-code"></block> 目錄通常包含數個檔案、但 initdb 只會建立第一個檔案。視需要新增額外檔案。每個 xlog 檔案長度為 16MB 。</block>
  <block id="789a6c7dd865d16eb1df122bcc5c9a3a" category="admonition">* 如果需要 NFSv4 功能、 NetApp 建議 * 使用 NFSv4.1 。NFSv4.1 中的 NFSv4 傳輸協定有一些功能性增強功能、可改善某些邊緣情況的恢復能力。</block>
  <block id="8e86e0aee135afb67c6a1d3d6e0f3306" category="inline-link-macro">NFS 傳輸大小</block>
  <block id="d84b41126744795c4ee82f7b256e7234" category="inline-link-macro">FC SAN</block>
  <block id="2c8c2171fc87c96e58fb40d8714f85cf" category="doc">PostgreSQL 架構</block>
  <block id="ee62b4420d426c21a46d892ac084872a" category="paragraph">PostgreSQL 是以用戶端和伺服器架構為基礎的 RDBMS 。PostgreSQL 執行個體稱為資料庫叢集、是資料庫的集合、而非伺服器集合。</block>
  <block id="89c30c326e106773af32af40255b92a8" category="inline-image-macro">錯誤：找不到圖形</block>
  <block id="54c2dd41fd1ad3efa25e80bee0bae549" category="paragraph">PostgreSQL 資料庫中有三個主要元素：郵政局長、前端（用戶端）和後端用戶端會傳送要求給郵政局長、其中包含 IP 傳輸協定等資訊、以及要連線的資料庫。郵政局長會驗證連線、並將其傳送至後端程序以進行進一步的通訊。後端程序會執行查詢、並將結果直接傳送至前端（用戶端）。</block>
  <block id="9f96e07bbaf7c0237047d6d0f95301a8" category="paragraph">PostgreSQL 執行個體是以多重處理模式為基礎、而非多重執行緒模式。它會為不同的工作產生多個處理程序、而且每個處理程序都有自己的功能。主要程序包括用戶端程序、 Wal 寫入程序、背景寫入程序及檢查指標程序：</block>
  <block id="6aebf901bd4be26a765c56e4133b3798" category="list-text">當用戶端（前景）程序傳送讀取或寫入要求至 PostgreSQL 執行個體時、它不會直接讀取或寫入資料至磁碟。它首先緩衝共享緩衝區和預先寫入記錄（ Wal ）緩衝區中的資料。</block>
  <block id="458239ee6c634dc5fef96f9dfab275f0" category="list-text">Wal 寫入器程序會操控共用緩衝區和 Wal 緩衝區的內容、以寫入 Wal 記錄檔。Wal 記錄檔通常是 PostgreSQL 的交易記錄檔、並依序寫入。因此、為了改善資料庫的回應時間、 PostgreSQL 會先寫入交易記錄檔、並確認用戶端。</block>
  <block id="9ec2999256fe568cd596b42e7da2cc39" category="list-text">若要將資料庫置於一致的狀態、背景寫入器程序會定期檢查共用緩衝區是否有髒頁。然後將資料排清至儲存在 NetApp 磁碟區或 LUN 上的資料檔案。</block>
  <block id="5c852dd8ba7215c01dfde8e98f6c46c6" category="list-text">checkpointer 程序也會定期執行（比背景程序更少）、並防止對緩衝區進行任何修改。它會向 Wal 寫入器程序發出訊號、將檢查點記錄寫入並清除至儲存在 NetApp 磁碟上的 Wal 記錄檔結尾。它也會向背景寫入器程序發出訊號、要求將所有髒頁寫入磁碟並清除。</block>
  <block id="0a7b1215fd0b9621d4d7300f88b2906c" category="doc">資料保護軟體</block>
  <block id="e265011e47d11db43ee112fd2fdc9d5b" category="paragraph">適用於 PostgreSQL 資料庫的 NetApp SnapCenter 外掛程式、結合 Snapshot 和 NetApp FlexClone 技術、可為您提供下列優點：</block>
  <block id="4dcdaba06a92b8fecfdc823643a71723" category="list-text">快速備份與還原。</block>
  <block id="aee746a577a1baebdc33197fb5f3a279" category="list-text">節省空間的複本。</block>
  <block id="b96bb0cd2ebc0389b6670602ac80d983" category="list-text">能夠建置快速有效的災難恢復系統。</block>
  <block id="9e060ad00fced94f2616dd71fbc49f76" category="paragraph">在下列情況下、您可能偏好選擇 NetApp 的優質備份合作夥伴、例如 Veeam Software 和 CommVault ：</block>
  <block id="0ee17b3b55ea2b0af3d90985bc347775" category="list-text">在異質環境中管理工作負載</block>
  <block id="88fbde7bbe0274fbe9e7ce01c563d03c" category="list-text">將備份儲存至雲端或磁帶、以供長期保留</block>
  <block id="445e3e0cce7f959696dde65b3be27843" category="list-text">支援多種作業系統版本和類型</block>
  <block id="21c5d67cc22beaf7d7c9c84c8deaabbe" category="paragraph">適用於 PostgreSQL 的 SnapCenter 外掛程式是社群支援的外掛程式、可在 NetApp Automation Store 取得設定與文件。透過 SnapCenter 、使用者可以遠端備份資料庫、複製及還原資料。</block>
  <block id="7d334ca369e4a752ec91b1503183f0ed" category="summary">適用於 SAP HANA 和 AnyDB 的解決方案</block>
  <block id="1ac73696f4529e3901b0d4e5430365cb" category="doc">SAP HANA 與 SAP 搭配 AnyDB</block>
  <block id="2c1b27a986b5e37a810d61f72b23ee4b" category="paragraph">設定、管理及自動化 SAP 解決方案的最佳實務做法、請參閱 NetApp SAP 解決方案頁面。</block>
  <block id="6c92285fa6d3e827b198d120ea3ac674" category="inline-link-macro">請按這裡</block>
  <block id="ee1e67308b27672a8f54eace4c615a98" category="paragraph">請按一下 <block ref="c95e4a3e1de9e00fefc4bf8a7ce42893" category="inline-link-macro-rx"></block> 以取得更多資訊。</block>
  <block id="beb3ca55ed0a53a38a2b97540b05d6e4" category="summary">ONTAP 上的 Microsoft SQL Server</block>
  <block id="7636ae91f443b605f05bed59d7d57a02" category="doc">Microsoft SQL Server 災難恢復</block>
  <block id="810304d54e0a61663cfc457b0894037b" category="paragraph">NetApp 提供各種方法、可在發生硬體、軟體或站台故障時提高資料可用度。</block>
  <block id="9c1e9d82d3220658621f72dca978adb0" category="section-title">NetApp SnapMirror</block>
  <block id="46983273062fdc8ce8561a9ce89cdc5b" category="paragraph">NetApp SnapMirror 技術提供快速靈活的企業解決方案、可透過 LAN 和 WAN 來鏡射或複寫資料。SnapMirror 技術在初始基礎傳輸之後、只會將經過修改的 4KB 資料區塊傳輸到目的地、大幅降低網路頻寬需求。SnapMirror 可根據設定的複寫更新間隔、提供非同步的磁碟區層級複寫。
以下是 SnapMirror for SQL Server 的建議：</block>
  <block id="5f3bfe8f92842bdc2f9455d4102f2531" category="list-text">如果使用 CIFS 、目的地 SVM 必須是來源 SVM 所屬 Active Directory 網域的成員、如此一來、在從災難恢復期間、 NAS 檔案中儲存的存取控制清單（ ACL ）就不會中斷。</block>
  <block id="e0fd410ebdc68e7ca628bbca66b63ff4" category="list-text">不需要使用與來源 Volume 名稱相同的目的地 Volume 名稱、但可讓將目的地 Volume 掛載至目的地的程序更容易管理。如果使用 CIFS 、您必須在來源命名空間的路徑和目錄結構中、使目的地 NAS 命名空間相同。</block>
  <block id="14b01fb6bdbebef1f8a00c7f84926307" category="list-text">為了一致性、請勿從控制器排程 SnapMirror 更新。不過、在完整備份或記錄備份完成後、啟用 SnapCenter 的 SnapMirror 更新來更新 SnapMirror 。</block>
  <block id="18c6a681ea46e1ed394e092461bb53ef" category="list-text">將包含 SQL Server 資料的磁碟區分散到叢集中的不同節點、以允許所有叢集節點共用 SnapMirror 複寫活動。此套裝作業系統可最佳化節點資源的使用。</block>
  <block id="0a01e6837f5c691536f0b6cbdd0232ec" category="inline-link-macro">TR-4015 ： ONTAP 9 的 SnapMirror 組態與最佳實務做法指南</block>
  <block id="1cca1a3fad8c6dd7e2dadbd2aa08bf07" category="paragraph">如需 SnapMirror 的詳細資訊、請參閱 <block ref="64b916f792bad525a069a243c092b62e" category="inline-link-macro-rx"></block>。</block>
  <block id="3d4b417d78ff0ef4c84f0c043de24b10" category="doc">資料庫安全性</block>
  <block id="77641f4a3e4406855e878235cbd89b87" category="doc">CPU 組態</block>
  <block id="a51adad5719779145ac252822e328611" category="section-title">超執行緒</block>
  <block id="fe520b79816bad6a21fbebcb205c7ca9" category="paragraph">超執行緒是 Intel 專屬的同步多執行緒（ SMT ）實作、可改善在 x86 微處理器上執行的運算（多工）平行化。</block>
  <block id="005f484c2235e04f39d2e69256147281" category="paragraph">使用超執行緒的硬體可讓邏輯超執行緒 CPU 在作業系統中顯示為實體 CPU 。SQL Server 接著會看到作業系統所呈現的實體 CPU 、因此可以使用超執行緒處理器。</block>
  <block id="673c216e20d1cf8827f347c01dace664" category="paragraph">此處的注意點是、每個 SQL Server 版本都有自己的運算能力限制。如需詳細資訊、請參閱依 SQL Server 版本計算容量限制。</block>
  <block id="932a9271c08db114962ce3791480f371" category="paragraph">授權 SQL Server 時有兩大主要考量。第一個稱為伺服器 + 用戶端存取授權（ CAL ）模式、第二個是每個處理器核心模式。雖然您可以使用伺服器 + CAL 策略存取 SQL Server 中所有可用的產品功能、但每個插槽的硬體限制為 20 個 CPU 核心。即使您的伺服器的 SQL Server Enterprise Edition + CAL 每個插槽有超過 20 個 CPU 核心、應用程式也無法在該執行個體上同時使用所有這些核心。圖顯示啟動後的 SQL Server 記錄訊息、指出核心限制的強制執行。</block>
  <block id="d06fce44fdcf20791141e7585205a477" category="section-title">記錄項目指出 SQL Server 啟動後所使用的核心數。</block>
  <block id="cf0e2551e639758cc3c4d82df655eccd" category="inline-link-macro">SQL Server 2022 ：現代化的資料平台</block>
  <block id="809c9e1f6ce0bc82bf42fae361c6f43e" category="paragraph">因此、若要使用所有 CPU 、您應該使用每個處理器核心授權。如需 SQL Server 授權的詳細資訊、請參閱 <block ref="457abfaf1083b1cbfc49f2783069c6cd" category="inline-link-macro-rx"></block>。</block>
  <block id="cb8d56a3511d402b7355db8502a54c5a" category="section-title">CPU 親和性</block>
  <block id="884be48d06a17be095fb51de089dfc89" category="paragraph">除非您遇到效能問題、否則您不太可能需要變更處理器親和性預設值、但仍值得您瞭解它們是什麼、以及它們的運作方式。</block>
  <block id="74f896768ee487acfd4c42370c202bed" category="paragraph">SQL Server 可透過兩個選項來支援處理器關聯性：</block>
  <block id="cb315fb2b62c836ba51357d46f2e8c3f" category="list-text">CPU 親和性遮罩</block>
  <block id="cb00a2408ea648cf85edfd7dbb23fbe0" category="list-text">關聯性 I/O 遮罩</block>
  <block id="14ad08466dec6635067b988a82e91a8e" category="paragraph">SQL Server 會使用作業系統提供的所有 CPU （如果選擇了每個處理器核心授權）。它會在所有 CPU 上建立排程器、以便為任何指定的工作負載充分利用資源。當多工處理時、伺服器上的作業系統或其他應用程式可以將處理執行緒從一個處理器切換至另一個處理器。SQL Server 是一種資源密集的應用程式、因此發生這種情況時、效能可能會受到影響。若要將影響降至最低、您可以設定處理器、使所有 SQL Server 負載都導向預先選取的處理器群組。這是透過使用 CPU 關聯性遮罩來達成的。</block>
  <block id="28a51b601de21080b76fe2d8b2ec8101" category="paragraph">關聯性 I/O 遮罩選項會將 SQL Server 磁碟 I/O 繫結至 CPU 子集。在 SQL Server OLTP 環境中、此延伸功能可提升 SQL Server 執行緒的效能、以執行 I/O 作業。</block>
  <block id="49e103832576f4486179df8868372d17" category="section-title">平行度上限（ MAXDOP ）</block>
  <block id="f7e9f8e341a301aec4560db108b93020" category="paragraph">根據預設、 SQL Server 會在查詢執行期間使用所有可用的 CPU （如果選擇了個別處理器核心授權）。</block>
  <block id="9bdcdbe52ea41cf96b314b7b7671bd2a" category="paragraph">雖然這對大型查詢來說很好、但可能會造成效能問題、並限制並行處理。更好的方法是將平行度限制在單一 CPU 插槽中的實體核心數量。例如、在具有兩個實體 CPU 插槽、每個插槽有 12 個核心的伺服器上、無論超執行緒為何、 MAXDOP 都應設為 12 。MAXDOP 無法限制或規定要使用的 CPU 。而是限制單一批次查詢可以使用的 CPU 數量。</block>
  <block id="1a6b79859b80796a108bd348f98856f6" category="admonition">* NetApp 建議 * 使用 DSS （例如資料倉儲）、從這項設定開始於 50 左右、並視情況調校或調校。請務必測量應用程式中的關鍵查詢、並視需要進行調整。</block>
  <block id="a99f7ebb3b0f5b0ecea93ed586b2a17d" category="section-title">最大工作執行緒數</block>
  <block id="aff27140f50a549b1331add8d5025f7e" category="paragraph">當大量用戶端連線至 SQL Server 時、最大工作執行緒選項可協助最佳化效能。</block>
  <block id="aefc7f2ee96effbbbe49e6ece6d2f72a" category="paragraph">通常會為每個查詢要求建立個別的作業系統執行緒。如果數百個同時連線到 SQL Server 、則每個查詢要求一個執行緒會消耗大量的系統資源。「最大工作執行緒」選項可讓 SQL Server 建立工作執行緒集區、以服務更多查詢要求、進而協助改善效能。</block>
  <block id="decd79137325e1efbc7b994f946ea24f" category="paragraph">預設值為 0 、可讓 SQL Server 在啟動時自動設定工作執行緒數量。這適用於大多數系統。Max Worker 執行緒是進階選項、如果沒有經驗豐富的資料庫管理員（ DBA ）的協助、就不應變更。</block>
  <block id="030a270970f70c1bd91d3689b6f95f3f" category="inline-link-macro">設定最大工作執行緒伺服器組態選項</block>
  <block id="2a0c648df721b9bc2643d59c4a3a310a" category="paragraph">何時應設定 SQL Server 使用更多工作執行緒？如果每個排程器的平均工作佇列長度超過 1 、您可能會因為在系統中新增更多執行緒而受益、但前提是負載未受 CPU 限制或遇到任何其他繁重的等待。如果發生上述任一種情況、新增更多執行緒並不會有幫助、因為它們最終會等待其他系統瓶頸。如需工作者執行緒上限的詳細資訊、請參閱 <block ref="77c391df5f9f06cdf367c2a7314ce351" category="inline-link-macro-rx"></block>。</block>
  <block id="29d04e616d2293c4c7538dd6226feac5" category="section-title">使用 SQL Server Management Studio 設定最大工作執行緒。</block>
  <block id="5962130d833e0408cf58a87e342bc1f9" category="doc">Microsoft SQL Server tempdb 檔案</block>
  <block id="625156cc6cef9a3c56b1b535579bd2c9" category="paragraph">NetApp 建議主動將 tempdb 檔案充氣至其完整大小、以避免磁碟分割。</block>
  <block id="ca75041d415f4dafabb49b7f06b634ed" category="paragraph">當 SQL Server 必須寫入特殊系統頁面以分配新物件時、網頁爭用可能會發生在全域分配對應（ GAM ）、共用全域分配對應（ SGAM ）或頁面可用空間（ PFS ）頁面上。鎖條可保護（鎖定）記憶體中的這些頁面。在忙碌的 SQL Server 執行個體上、在 tempdb 的系統頁面上取得鎖定可能需要很長時間。這會導致查詢執行時間變慢、也稱為鎖定爭用。請參閱下列建立 tempdb 資料檔案的最佳實務做法：</block>
  <block id="44dbc82801d84781083ed9e23b63be00" category="list-text">對於 &lt; 或 = 至 8 核心： tempdb 資料檔案 = 核心數</block>
  <block id="6203fcdbdad10bb603fd00edd2f0fcf5" category="list-text">若為 &gt; 8 核心： 8 個 tempdb 資料檔案</block>
  <block id="b9f341e4fb0e6b384aa7ec0b5c33f964" category="paragraph">下列範例指令碼會建立八個 tempdb 檔案、並將 tempdb 移至掛載點、以修改 tempdb<block ref="ae6fbe62f3ddc46fa9a9885244d23675" prefix=" " category="inline-code"></block> 適用於 SQL Server 2012 及更新版本。</block>
  <block id="0424163d6b24f29436021dfd7072863b" category="paragraph">從 SQL Server 2016 開始、在安裝期間會自動偵測作業系統可見的 CPU 核心數量、並根據該數量、 SQL Server 會計算和設定最佳效能所需的 tempdb 檔案數量。</block>
  <block id="1c5b37437282a3648dde78afd914e452" category="doc">Microsoft SQL Server 概述</block>
  <block id="9aa5016539f88d8f1972a16ce9babd34" category="paragraph">SQL Server 是 Microsoft 資料平台的基礎、無論是在內部部署或雲端、都能以記憶體內建技術提供關鍵任務效能、並更快洞悉任何資料。</block>
  <block id="8133a02d7327679696821fb31b105177" category="paragraph">Microsoft SQL Server 以先前版本所提供的關鍵任務功能為基礎、為關鍵任務應用程式提供突破性的效能、可用度和管理能力。儲存系統是 SQL Server 資料庫整體效能的關鍵因素。NetApp 提供數種產品、可讓您的 SQL Server 資料庫提供企業級效能、同時提供世界級的工具來管理您的環境。</block>
  <block id="0bdfc026961d516d3d473152b4b6a87e" category="section-title">目的與範圍</block>
  <block id="d0554e23b25bb82082a0cd9eaf810d0f" category="paragraph">本節說明最佳實務做法、並深入瞭解在執行 NetApp ONTAP 軟體的 NetApp 儲存系統上部署 SQL Server 的設計考量、目標是實現有效且有效率的儲存部署、以及端點對端點資料保護與保留規劃。本指南的範圍僅限於根據 NetApp 在部署 SQL Server 時針對儲存基礎架構所建議的設計原則和偏好的標準、制定技術設計準則。端點對端點實作不在本報告的範圍之內。</block>
  <block id="cf4cab9c6fd24025b34dfcae06e9b6fc" category="paragraph">本指南所述的最佳實務做法與建議、可讓 SQL Server 架構設計師與 NetApp 儲存管理員規劃高可用度且易於管理的 SQL Server 環境、並符合嚴格的 SLA 。NetApp 假設讀者具備下列工作知識：</block>
  <block id="9801f873fe2232da0de3cbab00483bfb" category="list-text">NetApp ONTAP 軟體</block>
  <block id="3b5b2ca12603a36517ce602ffe47361c" category="list-text">NetApp SnapCenter 做為備份軟體、包括：</block>
  <block id="36a92a010308100e1efc10d9eb98c369" category="list-text">適用於Microsoft Windows的解決方案SnapCenter</block>
  <block id="ec51578d7d8f930329548bf3d00d7038" category="list-text">適用於 SQL Server 的 SnapCenter 外掛程式</block>
  <block id="a6d698a68f555339f6e91957f636ad69" category="list-text">Microsoft SQL Server 架構與管理</block>
  <block id="697ea025ecb303d4f40d1bf3a8b4bde0" category="inline-link-macro">NetApp互通性對照表工具IMT （不含）</block>
  <block id="c02eaaaf0eed9e51c3a9e1e9ae8b9147" category="paragraph">如需跨 NetApp 堆疊的組態相容性、請參閱 <block ref="ea0e6fe442c1f7a042a8853ffcc2b382" category="inline-link-macro-rx"></block>。</block>
  <block id="fbd4c4f9516af91c6c3cb5fa35fb5720" category="doc">Microsoft SQL Server 儲存考量</block>
  <block id="8c2a9e7195a263b5d79d397f5c6a9f68" category="paragraph">結合 NetApp 儲存解決方案與 Microsoft SQL Server 、可建立企業級資料庫儲存設計、滿足現今最嚴苛的應用程式需求。</block>
  <block id="8136e237a15b0f72e5d7a60392225d17" category="paragraph">若要最佳化這兩種技術、瞭解 SQL Server I/O 模式和特性是非常重要的。精心設計的SQL Server資料庫儲存配置可支援SQL Server的效能及SQL Server基礎架構的管理。良好的儲存配置也能讓初始部署成功、並隨著業務成長、環境隨時間而順利成長。</block>
  <block id="3da07c62fca4dd242f7ffcfcf72998be" category="section-title">資料儲存設計</block>
  <block id="9e45010900186b3cbbe04f954a6f3562" category="paragraph">對於不使用SnapCenter 支援功能執行備份的SQL Server資料庫、Microsoft建議將資料和記錄檔放在不同的磁碟機上。對於同時更新和要求資料的應用程式、記錄檔會密集寫入、而且資料檔（視應用程式而定）會密集讀寫。對於資料擷取、不需要記錄檔。因此、您可以從放在自己磁碟機上的資料檔案來滿足資料要求。</block>
  <block id="df018ea4abdb71f91802ea1d4fb0fb37" category="inline-link-macro">將資料和記錄檔放在不同的磁碟機上</block>
  <block id="f2f25c68d67c561be1926b4b06e676b0" category="paragraph">當您建立新資料庫時、Microsoft建議您為資料和記錄指定個別的磁碟機。若要在資料庫建立之後移動檔案、資料庫必須離線。如需更多 Microsoft 建議、請參閱 <block ref="04fab8828edf0d2e95eff3c4f124b372" category="inline-link-macro-rx"></block>。</block>
  <block id="d5350d8759b1ec84607e47908809058e" category="section-title">集合體</block>
  <block id="b8212b86fca1dcaeb0438529a03212c3" category="paragraph">Aggregate 是 NetApp 儲存組態的主要儲存容器、包含一個或多個 RAID 群組、其中包括資料磁碟和同位元磁碟。NetApp 已使用資料檔案和交易記錄檔分離的共用和專用集合體、執行各種 I/O 工作負載特性分析測試。測試結果顯示、一個大型集合體具有更多的 RAID 群組和磁碟、可最佳化及改善儲存效能、而且管理員更容易管理、原因有兩個：</block>
  <block id="5f9196be7c85ebe3a38375ace1f3a345" category="list-text">一個大型集合體可讓所有磁碟的 I/O 功能可供所有檔案使用。</block>
  <block id="77f1d6b9cbcaf3663f6bdd19a821e773" category="list-text">一個大型Aggregate可讓您以最有效率的方式使用磁碟空間。</block>
  <block id="63d9962fabe500361986d05317bd65a5" category="paragraph">若要獲得高可用度（ HA ）、請將 SQL Server Always On Availability Group 次要同步複本放在 Aggregate 中的獨立儲存虛擬機器（ SVM ）上。為了進行災難恢復、請將非同步複本放在 DR 站台中屬於獨立儲存叢集的集合上、並使用 NetApp SnapMirror 技術複寫內容。NetApp 建議在集合體中至少有 10% 的可用空間、以獲得最佳的儲存效能。</block>
  <block id="c6f01c78bfe0a0a495cb5d3ed77824a9" category="section-title">磁碟區</block>
  <block id="5ec65e803efce0f0779c59e4df9b2a71" category="paragraph">NetApp FlexVol 磁碟區會建立並位於集合體內。許多磁碟區都可以建立在單一集合體中、而且每個磁碟區都可以在集合體之間進行擴充、縮減或移動、而不會造成使用者停機。</block>
  <block id="17fce39141e6fa457c789ce2c3239b0c" category="section-title">Volume 設計考量</block>
  <block id="d1c9fdbcdbb8521971decf35c6d1c0c8" category="paragraph">在您建立資料庫 Volume 設計之前、請務必瞭解 SQL Server I/O 模式和特性的差異、視工作負載及備份與還原需求而定。請參閱下列 NetApp 建議的彈性磁碟區：</block>
  <block id="570f1006846b0d45ff44b4332b9b4d14" category="list-text">使用靈活的 Volume 來儲存 SQL Server 資料庫檔案、避免在主機之間共用磁碟區。</block>
  <block id="674343739e297abb52c536a453ebaad0" category="list-text">請使用 NTFS 掛載點而非磁碟機代號、以超越 Windows 中 26 個磁碟機代號的限制。使用 Volume 掛載點時、一般建議將 Volume 標籤命名為與掛載點相同的名稱。</block>
  <block id="d5fe4f7f1c47df1ec78c926d21498f73" category="list-text">適當時、請設定 Volume 自動調整大小原則、以協助避免空間不足的情況。17 Microsoft SQL Server with ONTAP 最佳實務指南 © 2022 NetApp 、 Inc. 版權所有。</block>
  <block id="fdb3a973962ea77cf56d76e12cff8c7d" category="list-text">當 SQL Server 資料庫 I/O 設定檔包含大部分的大量循序讀取（例如決策支援系統工作負載）時、可在磁碟區上啟用讀取重新分配。讀取重新分配可最佳化區塊、提供更好的效能。</block>
  <block id="3a9320cf27fb328f77ec6153273784d5" category="list-text">如果您在 SMB 共用上安裝 SQL Server 、請確定已在 SMB/CIFS 磁碟區上啟用 Unicode 以建立資料夾。</block>
  <block id="08a6901e4e7b04d6170563bc57864093" category="list-text">將磁碟區中的 NetApp Snapshot 複本保留值設為零、以便從作業角度進行監控。</block>
  <block id="156ce9adf6c474183396aa3cfb8f92f1" category="list-text">停用 Storage Snapshot ™複本排程和保留原則。而是使用 SnapCenter 來協調 SQL Server 資料磁碟區的 Snapshot 複本。</block>
  <block id="f2e00c12259a4bb11608f2a12fc8014a" category="list-text">將 SQL Server 系統資料庫放在專用磁碟區或 VMDK 上。</block>
  <block id="4176288dbc134524f79476ba4e57e3aa" category="list-text">Tempdb 是 SQL Server 用來做為暫用工作區的系統資料庫、特別是用於 I/O 密集型 DBCC CHECKDB 作業。因此、請將此資料庫放在具有獨立磁碟集的專用磁碟區上。在磁碟區數是一項挑戰的大型環境中、您可以將Tempdb整合為較少的磁碟區、並在經過仔細規劃之後、將其儲存在與其他系統資料庫相同的磁碟區中。對 tempdb 的資料保護不是高優先順序、因為每次重新啟動 SQL Server 時都會重新建立此資料庫。</block>
  <block id="57eda1aa66778bf3c77caa0294652ba8" category="list-text">將使用者資料檔（.mdf）放在不同的磁碟區上、因為它們是隨機讀取/寫入工作負載。建立交易記錄備份的頻率通常高於資料庫備份。因此、請將交易記錄檔（ .ldf ）放在不同的磁碟區、或將 VMDK 放在資料檔案中、以便為每個檔案建立獨立的備份排程。這種分隔方式也能將記錄檔的連續寫入I/O與資料檔案的隨機讀寫I/O隔離、大幅提升SQL Server效能。</block>
  <block id="b26e74ed6e2892c7e2bb95e414d460c6" category="section-title">LUN</block>
  <block id="b703a2ceaabee81dd9dfcfb3a4b738ee" category="list-text">請確定使用者資料庫檔案和用於儲存記錄備份的記錄目錄位於不同的磁碟區、以防止保留原則在與 SnapVault 技術搭配使用時覆寫快照。</block>
  <block id="152bb9192ea87919eda3b4f97fd4e1bf" category="list-text">請確定 SQL Server 資料庫位於與具有非資料庫檔案（例如全文搜尋相關檔案）的 LUN 分開的 LUN 上。</block>
  <block id="e2faf723544ceb1ea01ba41cef2d633a" category="list-text">將資料庫次要檔案（作為檔案群組的一部分）放置在不同的磁碟區、可改善 SQL Server 資料庫的效能。只有當資料庫的 .mdf 檔案未與任何其他 .mdf 檔案共用其 LUN 時、此分隔才有效。</block>
  <block id="ae72f885471636cbfd0dbe902ddf24e1" category="list-text">如果您使用 DiskManager 或其他工具建立 LUN 、請確保在格式化 LUN 時、將分割區的分配單元大小設為 64K 。</block>
  <block id="ac4782a9243acaaff52164f9e47417d5" category="inline-link-macro">適用於現代 SAN 的 ONTAP 最佳實務做法下的 Microsoft Windows 和原生 MPIO</block>
  <block id="934e206705ddafc720e4a8f25a4acded" category="list-text">請參閱 <block ref="95506eaa4fca841adc20747ae4650d10" category="inline-link-macro-rx"></block> 將 Windows 上的多重路徑支援套用至 MPIO 內容中的 iSCSI 裝置。</block>
  <block id="31a8d85b6a44cffc2c7dfc6387696f31" category="section-title">記錄目錄</block>
  <block id="973781a026becacffaae9fd5fd5c2b7b" category="paragraph">記錄目錄是在 SQL Server 中指定、用於在主機層級儲存交易記錄備份資料。如果您使用 SnapCenter 來備份記錄檔、則 SnapCenter 使用的每個 SQL Server 主機都必須設定一個主機記錄目錄、才能執行記錄備份。由於包含資料庫儲存庫、因此與備份、還原或複製作業相關的中繼資料會儲存在中央資料庫儲存庫中SnapCenter 。</block>
  <block id="29766ed5967263787fface0a4ad3396f" category="paragraph">主機記錄目錄的大小計算方式如下：
主機記錄目錄大小 = （（最大 DB LDF 大小 x 每日記錄變更率 % ） x （快照保留） ÷ （ 1 - LUN 額外負荷空間 % ）
主機記錄目錄大小調整公式假設 LUN 負荷空間為 10%</block>
  <block id="31333b887781902e13c263570523ddc1" category="paragraph">將記錄目錄放在專用磁碟區或 LUN 上。主機記錄目錄中的資料量取決於備份的大小和保留備份的天數。SnapCenter 每個 SQL Server 主機只允許一個主機記錄目錄。您可以在 SnapCenter --&gt; 主機 --&gt; 組態外掛程式中設定主機記錄目錄。</block>
  <block id="e815059019027c04aa969a50787d5b34" category="paragraph">* NetApp 建議 * 下列主機記錄目錄：</block>
  <block id="07ae4edb1ccfbfe1f5da6006c95ee4a9" category="list-text">請確定主機記錄目錄未被任何其他可能毀損備份快照資料的資料類型共用。</block>
  <block id="991bd1f492a593453f65c2a23c1f1612" category="list-text">請勿將使用者資料庫或系統資料庫放置在裝載點的 LUN 上。</block>
  <block id="bdfdf6f1492d7a7beac0bce2c4109f95" category="list-text">在 SnapCenter 複製交易記錄的專用 FlexVol 磁碟區上建立主機記錄目錄。</block>
  <block id="7b01578e73f5081fecdcc6dedf28aa3c" category="list-text">使用 SnapCenter 精靈將資料庫移轉至 NetApp 儲存設備、以便將資料庫儲存在有效位置、進而成功執行 SnapCenter 備份與還原作業。請記住、移轉程序會中斷運作、並可能導致資料庫在移轉進行中時離線。</block>
  <block id="b2d0e2f60ee139155b728ef6933efe7c" category="list-text">SQL Server 的容錯移轉叢集執行個體（ FCI ）必須符合下列條件：</block>
  <block id="863fda0972208e1e15d0c4a16d6915af" category="list-text">如果您使用容錯移轉叢集執行個體、則主機記錄目錄 LUN 必須是與要備份 SnapCenter 的 SQL Server 執行個體位於同一個叢集群組中的叢集磁碟資源。</block>
  <block id="ddb1104e1e71caabad3e7639c7675af8" category="list-text">如果您使用容錯移轉叢集執行個體、則使用者資料庫必須放置在共用 LUN 上、這些 LUN 是指派給與 SQL Server 執行個體相關聯的叢集群組的實體磁碟叢集資源。</block>
  <block id="bca5f9a18696e080113088282fe481de" category="doc">Microsoft SQL Server 記憶體組態</block>
  <block id="02578ec0e8ce2fbef37ca792fd20c289" category="section-title">最大伺服器記憶體</block>
  <block id="81dbc262a15fc545920141998ddd1c17" category="paragraph">最大伺服器記憶體選項可設定 SQL Server 執行個體可使用的最大記憶體容量。</block>
  <block id="c9fa383209ffc05f20049101298fec96" category="paragraph">如果在執行 SQL Server 的同一部伺服器上執行多個應用程式、而且您想要保證這些應用程式有足夠的記憶體可以正常運作、通常會使用此功能。</block>
  <block id="1ceeb5f5f18aefbc39e34d0d3c7b7e1c" category="paragraph">有些應用程式只會在啟動時使用任何可用的記憶體、即使需要也不會要求更多。這就是最大伺服器記憶體設定的作用所在。</block>
  <block id="6e345f11e9b2856a7ac40d6cf283606b" category="paragraph">在具有多個 SQL Server 執行個體的 SQL Server 叢集上、每個執行個體可能會爭用資源。為每個 SQL Server 執行個體設定記憶體限制、有助於保證每個執行個體的最佳效能。</block>
  <block id="318b34a3511a1be6d179a73303da2077" category="admonition">* NetApp 建議 * 為作業系統保留至少 4GB 至 6GB 的 RAM 、以避免效能問題。</block>
  <block id="cd151dbdf946ad6bd27e1d55ea1cd029" category="section-title">使用 SQL Server Management Studio 調整最小和最大伺服器記憶體。</block>
  <block id="2e0d4de7d927936246f5537ba48015d2" category="paragraph">若要使用 SQL Server Management Studio 調整最小或最大伺服器記憶體、必須重新啟動 SQL Server 服務。您可以使用以下代碼、使用 TransAct SQL （ T-SQL ）來調整伺服器記憶體：</block>
  <block id="998c5e632fa0f987c20c182fc9322f67" category="section-title">不一致的記憶體存取</block>
  <block id="d92030bf70ac1cf1da30ce4c9ab2bbf6" category="paragraph">非一致性記憶體存取（ NUMA ）是一種記憶體存取最佳化方法、可協助提高處理器速度、而不會增加處理器匯流排的負載。</block>
  <block id="6ef102e61df24a50b0119558432f5623" category="paragraph">如果在安裝 SQL Server 的伺服器上設定 NUMA 、則不需要額外的組態、因為 SQL Server 可感知 NUMA 並在 NUMA 硬體上執行良好。</block>
  <block id="b3b5cd113ed637ebe6cb28eab322307a" category="section-title">索引會建立記憶體</block>
  <block id="8e7c0153e4b7aa851a5a62683c378d1c" category="paragraph">索引建立記憶體選項是另一個進階選項、您通常不應變更。</block>
  <block id="631c6718cc62ad33b6e3b3b48d754569" category="paragraph">它控制最初分配給建立索引的最大 RAM 容量。此選項的預設值為 0 、這表示它是由 SQL Server 自動管理。不過、如果您在建立索引時遇到困難、請考慮增加此選項的值。</block>
  <block id="8c91aa3f5264c57bd2d2e66bd70f2ad1" category="section-title">每個查詢的最小記憶體</block>
  <block id="027d5a3eabe88aa0ab705b9c4a2fe096" category="paragraph">執行查詢時、 SQL Server 會嘗試分配最適當的記憶體量、讓它能夠有效率地執行。</block>
  <block id="4c7836a7e63c3ecb3f6860ec19643561" category="paragraph">根據預設， [ 每個查詢的最小記憶體 ] 設定會為每個要執行的查詢分配 &gt; 或 = 至 1024KB 。最佳做法是將此設定保留為預設值 0 、以允許 SQL Server 動態管理分配給索引建立作業的記憶體量。不過、如果 SQL Server 的 RAM 超過有效執行所需的容量、則如果您增加此設定、某些查詢的效能可能會大幅提升。因此、只要 SQL Server 、任何其他應用程式或作業系統未使用的伺服器上有可用的記憶體、則提升此設定有助於整體 SQL Server 效能。如果沒有可用的可用記憶體、增加此設定可能會影響整體效能。</block>
  <block id="d2a88da9a0fcc96168f8f051909d5599" category="section-title">緩衝區集區副檔名</block>
  <block id="11a3fdcfeb0715eaf26e855034f6ab9a" category="paragraph">緩衝區集區擴充可將 NVRAM 擴充與資料庫引擎緩衝區集區無縫整合、大幅改善 I/O 處理量。</block>
  <block id="c722da593d2f37b2c1ffc91a10c03dad" category="paragraph">並非每個 SQL Server 版本都提供緩衝區集區擴充功能。僅適用於 64 位元 SQL Server Standard 、 Business Intelligence 和 Enterprise 版本。</block>
  <block id="df07548a7c164cbe93b68c4cbebbdcf8" category="paragraph">緩衝區集區擴充功能可利用非揮發性儲存設備（通常是 SSD ）來擴充緩衝區集區快取。此擴充功能可讓緩衝區集區容納更大的資料庫工作集、強制在 RAM 和 SSD 之間分頁 I/O 、並有效地將小型隨機 I/O 從機械磁碟卸載到 SSD 。由於 SSD 延遲較低、隨機 I/O 效能較佳、因此緩衝區集區擴充功能可大幅改善 I/O 處理量。</block>
  <block id="54af95ef673718e2f8bf1cc873d8b3ce" category="paragraph">緩衝區集區擴充功能提供下列優點：</block>
  <block id="2c250b49dc6705e6d219cf2bf8d50bc5" category="list-text">增加隨機 I/O 處理量</block>
  <block id="93dce890e8c62b3a651edb9098201e58" category="list-text">降低 I/O 延遲</block>
  <block id="d7e49f79c1b78c9ead1e9541d2160307" category="list-text">提高交易處理量</block>
  <block id="6643befb3c9dc2fbb68fe1107fe24842" category="list-text">利用較大的混合式緩衝區集區來改善讀取效能</block>
  <block id="6609220b8670ffd627a3663b3beef46b" category="list-text">一種快取架構、可充分利用現有和未來的低成本記憶體</block>
  <block id="471bda18bb94c589b421edccb0e402fe" category="paragraph">* NetApp 建議 * 將緩衝區集區延伸設定為：</block>
  <block id="12810c53d2afa05bd2a75aa3c0c55592" category="list-text">請確定將 SSD 支援的 LUN （例如 NetApp AFF ）呈現給 SQL Server 主機、以便將其用作緩衝區集區擴充目標磁碟。</block>
  <block id="824cfa1576a82f89ee0af13fb9f086dc" category="list-text">副檔名必須與緩衝區集區大小相同或大於該檔案。</block>
  <block id="c7e0d87e723625072015431887edf349" category="paragraph">下列範例顯示 T-SQL 命令、可設定 32GB 的緩衝區集區擴充。</block>
  <block id="7ef20d2374bc8b734222e4ec2f0f3643" category="doc">使用 Microsoft SQL Server 實現 ONTAP 儲存效率</block>
  <block id="e5bc122522e9ae1409590d9944ec4421" category="paragraph">儲存效率是以消耗最少儲存空間的方式來儲存和管理 SQL Server 資料、對系統整體效能幾乎沒有影響或完全沒有影響。</block>
  <block id="2d3c9d6f03cd640c224f5daf9c2352b0" category="paragraph">SQL Server 也具備壓縮及有效管理資料的功能。SQL Server 目前支援兩種類型的資料壓縮：資料列壓縮和頁面壓縮。</block>
  <block id="181341700086c5e2f2259774b2aaa59c" category="inline-link-macro">頁面壓縮實作</block>
  <block id="46c6aaf21d639d23d4f297a1f6922d9a" category="paragraph">資料列壓縮會變更資料儲存格式。例如、它會將整數和小數位數變更為可變長度格式、而非原生固定長度格式。它也會消除空白、將固定長度字元字串變更為可變長度格式。頁面壓縮會實作列壓縮及其他兩種壓縮策略（前置壓縮和字典壓縮）。您可以在中找到有關頁面壓縮的詳細資料 <block ref="88eab602b149fe360da37498ad5cdeae" category="inline-link-macro-rx"></block>。</block>
  <block id="0d629ff07f9214182fa91977089ff029" category="paragraph">SQL Server 2008 及更新版本的 Enterprise 、 Developer 及 Evaluation 版本目前支援資料壓縮。雖然壓縮可以由資料庫本身執行、但在 SQL Server 環境中很少會發生這種情況。</block>
  <block id="c6757fbc56df4ba20f0ef165aeb214d0" category="paragraph">以下是管理 SQL Server 資料檔案空間的建議</block>
  <block id="46344e63db1ea2128cc47543b10a0f96" category="list-text">在 SQL Server 環境中使用自動精簡配置、以提高空間使用率、並在使用空間保證功能時、降低整體儲存需求。</block>
  <block id="924e1b131d6b3a2846efd1a81de8eac1" category="list-text">對於大多數常見的部署組態、請使用自動擴充、因為儲存管理員只需要監控集合體中的空間使用量。</block>
  <block id="13a233d96ce19e7530391105360d749b" category="list-text">建議不要在包含 SQL Server 資料檔案的任何磁碟區上啟用重複資料刪除功能、除非已知該磁碟區包含相同資料的多個複本、例如將資料庫從備份還原至單一磁碟區。</block>
  <block id="752d71c042ef775879f6db705ccf6b31" category="section-title">空間回收</block>
  <block id="89f8656e4e33094d6011ef9aaa8fa8de" category="paragraph">空間回收可定期啟動、以恢復 LUN 中未使用的空間。有了 SnapCenter 、您可以使用下列 PowerShell 命令來啟動空間回收。</block>
  <block id="aa864feb1e600aa376e91ac119da387b" category="paragraph">如果您需要執行空間回收、則此程序應在低活動期間執行、因為它最初會在主機上使用週期。</block>
  <block id="a356c94dff23a233551ff221e74a144d" category="summary">使用 ONTAP 保護 Microsoft SQL Server 資料</block>
  <block id="731c00fe6475fb22aece82ffa9d74ef3" category="paragraph">保護資料庫對任何組織都至關重要。隨著資料庫的資料大小和數量增加、維持恢復時間目標（ RTO ）和恢復點目標（ RPO ）非常重要。</block>
  <block id="5c014f8939a89da0166a347a0237cf4f" category="section-title">SnapCenter</block>
  <block id="2ddb1872f6c378e74cb7269e9de4c4e5" category="paragraph">SnapCenter 是適用於企業應用程式的 NetApp 資料保護軟體。使用 NetApp SnapCenter 軟體搭配適用於 SQL Server 的外掛程式和適用於 Microsoft Windows 的外掛程式、即可快速輕鬆地保護 SQL Server 資料庫。</block>
  <block id="bdc6c0cf646d837838203c2980eba84a" category="paragraph">此產品可讓 SQL Server 資料庫、執行個體或可用度群組進行應用程式一致的備份、自動複製、還原及還原。</block>
  <block id="2450e19674db2a865555d3c04563e647" category="admonition">* NetApp 建議 * 使用 SnapCenter 來建立 Snapshot 複本。</block>
  <block id="1567bc0803275089d7cbc1ffc468158c" category="inline-link-macro">TR-4714 ：使用 NetApp SnapCenter 的 SQL Server 最佳實務指南</block>
  <block id="17f58c1b5cb5feb5dcaf49ca87298c00" category="paragraph">如需適用於 SnapCenter 的 SQL Server 外掛程式的詳細資訊、請參閱 <block ref="c94de7812b9bc9ed76b3c4005974958d" category="inline-link-macro-rx"></block>。</block>
  <block id="91a7baba41dc4b5f958101b261cf179b" category="section-title">使用 T-SQL 快照保護資料庫</block>
  <block id="e158e137ead13fd14e064b875e45df20" category="paragraph">在 SQL Server 2022 中、 Microsoft 推出了 T-SQL 快照、相較於資料庫管理員不容易使用的傳統方法、它具有內建的優勢。利用 ONTAP REST API 、您可以呼叫命令來建立磁碟區快照。</block>
  <block id="02e19b2989ebddca9ad3778807bdc426" category="paragraph">以下是備份工作流程範例：</block>
  <block id="17884d5a1cfc06145e718a49c8d6ac66" category="list-text">使用 ALTER 命令凍結資料庫 - 提供機會在基礎儲存設備上執行一致的快照。之後、您可以使用備份命令來解凍資料庫並記錄快照。</block>
  <block id="bd03301405e4dd8f2460ff1788765ac4" category="list-text">使用新的備份群組和備份伺服器命令、同時在儲存磁碟區上執行多個資料庫的快照。</block>
  <block id="a3b19be7df3ddff7295558d9934cd9b6" category="list-text">執行完整備份或僅複製完整備份。這些備份也會記錄在 msdb 中。</block>
  <block id="e2d06152222f63515f4b83229cb5444c" category="list-text">使用快照完整備份後以正常串流方式進行的記錄備份、執行時間點還原。如果需要、也支援串流差異備份。</block>
  <block id="a7a2496066febda8d325e0964e434481" category="inline-link-macro">瞭解 T-SQL 快照的 Microsoft 文件</block>
  <block id="bf06f3f95c5b653499bb4ac53ba44c95" category="paragraph">若要深入瞭解、請參閱 <block ref="2ba8392a398067f6d2e5f6e4167e9d00" category="inline-link-macro-rx"></block>。</block>
  <block id="450eb6d84ec721a20f17b7778b24b457" category="doc">Microsoft SQL Server 工作負載</block>
  <block id="764e07fc8f1f5e2d1b9fc63f83b88cbd" category="paragraph">SQL Server 資料庫平台可以支援許多應用程式。</block>
  <block id="25343e3363b414e89943f5a4e46f51ad" category="paragraph">部署 SQL Server 之前、您必須先瞭解 SQL Server 執行個體所支援應用程式的資料庫工作負載需求。每個應用程式對於容量、效能和可用度的需求各不相同、因此每個資料庫都應該設計成能以最佳方式支援這些需求。許多組織會使用應用程式需求來定義 SLA 、將資料庫分類為多個管理層。SQL Server 工作負載的說明如下：</block>
  <block id="c6a1c5843ff7b078079edf24beeea746" category="list-text">OLTP 資料庫通常也是組織中最重要的資料庫。這些資料庫通常會支援面對客戶的應用程式、因此被視為是公司核心營運不可或缺的一環。關鍵任務 OLTP 資料庫及其支援的應用程式通常都有需要高效能的 SLA 、而且對效能降級和可用度很敏感。他們也可能是永遠在容錯移轉叢集或永遠在可用度群組的候選對象。這些類型資料庫的 I/O 組合通常以 75% 至 90% 隨機讀取和 25% 至 10% 寫入為特徵。</block>
  <block id="96d864d235bcd68e1ef22c2c49aef352" category="list-text">決策支援系統（ DSS ）資料庫也可稱為資料倉儲。這些資料庫在許多仰賴分析技術的企業中、都是關鍵任務。執行查詢時、這些資料庫會對 CPU 使用率和從磁碟讀取作業敏感。在許多組織中、 DSS 資料庫在月底、每季和每年都是最重要的此工作負載通常有 100% 的讀取 I/O 混合。</block>
  <block id="da02a82356735ded82f6661108abe7ef" category="section-title">基準測試</block>
  <block id="b9a9b34816c2e5ebaecb45f376b52bc3" category="paragraph">交易程序委員會（ TPC ）是一家非營利組織、成立宗旨在於定義交易處理和資料庫基準、並將客觀且可驗證的 TPC 效能資料傳播給業界。TPC 測試會模擬完整的運算環境、其中有一群使用者會對資料庫執行交易。</block>
  <block id="427af860f9733f0c5427a1408195bb2b" category="cell">工作負載類型</block>
  <block id="54861efdd06fc309e1c9a420feff98eb" category="cell">案例</block>
  <block id="b130fcf8f0704ab887b72883b1eda2fa" category="cell">讀取 / 寫入比率（百分比）</block>
  <block id="3edb9cc3b98f151feb21dbde6323e82a" category="cell">OLTP</block>
  <block id="69e16af975a283d07a422bdbcc70aa33" category="cell">TPC-C</block>
  <block id="b1e04731135df8a16c5318612ec8654e" category="cell">~75/25</block>
  <block id="106ff1baff5c32dc414f262e0a710c54" category="cell">TPC-E</block>
  <block id="48e219d97cf4619f212471bafd4215ec" category="cell">約 90/10</block>
  <block id="e71f0182ed04206cb78bd7ceb2d9f4f3" category="cell">DSS</block>
  <block id="5788057170990ecf5e4d921f2853c2ae" category="cell">TPC-H</block>
  <block id="492d66c3da61bdb9c69261aa1aa6f5f9" category="cell">~100/0</block>
  <block id="0737ef89fbed16c79fadf3568aad6ba0" category="inline-link-macro">HammerDB.com</block>
  <block id="45e5ae4569fb8a91cd5513654f31b764" category="paragraph">雖然提供各種工作負載產生選項、但我們通常會專注於在處理交易工作負載時測量 SQL Server 資料庫的效能、我們也會使用 Microsoft 或 TPC-H 的 TPC-E 工具、使用 HammerDB （<block ref="af66be8e0834614cdd62ca4f34bc61ec" category="inline-link-macro-rx"></block>^ ）。關於如何使用這些特定基準測試的詳細說明不在本文件的範圍之內。</block>
  <block id="1b1b4c822e9c1b28b845dcc038fec08e" category="doc">Microsoft SQL Server 資料庫檔案和檔案群組</block>
  <block id="381c0738613a6b6a27d1c14f223e99ba" category="paragraph">SQL Server 資料庫是物件的集合、可讓您儲存及處理資料。</block>
  <block id="5306de2e4bff067a10c1c9b5aafe5920" category="paragraph">理論上、 SQL Server （ 64 位元）支援每個執行個體 32,767 個資料庫、以及 524272TB 的資料庫大小、雖然一般安裝通常有多個資料庫。不過 SQL Server 可以處理的資料庫數量取決於負載和硬體。看到 SQL Server 執行個體託管數十個、數百個甚至數千個小型資料庫、並不罕見。</block>
  <block id="9a3f42cec243006996ab4580d3ce5d56" category="paragraph">每個資料庫都包含一或多個資料檔案、以及一或多個交易記錄檔。交易記錄會儲存資料庫交易的相關資訊、以及每個工作階段所做的所有資料修改。每次修改資料時、 SQL Server 都會在交易記錄中儲存足夠的資訊、以復原（復原）或重做（重新執行）動作。SQL Server 交易記錄是 SQL Server 在資料完整性和健全性方面聲譽的重要一環。交易記錄對於 SQL Server 的原子性、一致性、隔離和耐用性（ ACID ）功能至關重要。一旦資料頁發生任何變更、 SQL Server 就會立即寫入交易記錄檔。每個 Data 操縱語言（ DML ）陳述式（例如、 SELECT 、 INSERT 、 UPDATE 或 DELETE ）都是完整的交易、而且交易記錄會確保整個以 Set 為基礎的作業都能進行、確保交易的完整性。</block>
  <block id="cbe6958e46fbab53cdbdb9deb2d75938" category="paragraph">每個資料庫都有一個主要資料檔案、預設會有 .mdf 副檔名。此外、每個資料庫都可以有次要資料庫檔案。根據預設、這些檔案的副檔名為 .NDF 。</block>
  <block id="811b578b6dfbb4a4ca16ba0c0911e3df" category="paragraph">所有資料庫檔案都會分組為檔案群組。檔案群組是邏輯單元、可簡化資料庫管理。它們允許在邏輯物件放置和實體資料庫檔案之間進行分隔。當您建立資料庫物件表格時、您可以在檔案群組中指定它們應該放置的位置、而無需擔心基礎資料檔案組態。</block>
  <block id="3717596742d438a1c8e77b0aeb58fcec" category="paragraph">將多個資料檔案放入檔案群組的能力、可讓您將負載分散到不同的儲存裝置、有助於改善系統的 I/O 效能。與此相反的是、由於 SQL Server 會循序寫入交易記錄檔、因此無法從多個檔案中獲益。</block>
  <block id="c136ffb510a6a465d338ab0affc16641" category="paragraph">檔案群組中的邏輯物件放置與實體資料庫檔案之間的分隔、可讓您微調資料庫檔案配置、充分發揮儲存子系統的效益。例如、將產品部署給不同客戶的獨立軟體廠商（ ISV ）、可以根據基礎 I/O 組態和部署階段的預期資料量、調整資料庫檔案數量。這些變更對應用程式開發人員來說是透明的、他們將資料庫物件放置在檔案群組中、而非資料庫檔案中。</block>
  <block id="3ac46c2f04dec9d215efbe44d307a020" category="admonition">* NetApp 建議 * 避免將主要檔案群組用於系統物件以外的任何項目。為使用者物件建立個別的檔案群組或一組檔案群組、可簡化資料庫管理和災難恢復、尤其是大型資料庫。</block>
  <block id="e3fc56c012a5d0c9f92dff9b49bcc80d" category="paragraph">您可以在建立資料庫或將新檔案新增至現有資料庫時指定初始檔案大小和自動成長參數。SQL Server 在選擇要將資料寫入哪個資料檔案時、會使用比例填滿演算法。它會將大量資料按比例寫入檔案中的可用空間。檔案中的可用空間越大、其處理的寫入次數就越多。</block>
  <block id="91d249de86b62102d6324849de2360fe" category="admonition">* NetApp 建議 * 單一檔案群組中的所有檔案都具有相同的初始大小和自動成長參數、其成長大小以 MB 為單位定義、而非百分比。這有助於比例填滿演算法在資料檔案之間平均平衡寫入活動。</block>
  <block id="a39d73055b8dbbe112e749e7c3ededb8" category="paragraph">每次 SQL Server 增加檔案時、都會以零填滿檔案中新分配的空間。該程序會封鎖所有需要寫入對應檔案的工作階段、或在交易記錄增加時產生交易記錄。</block>
  <block id="54db492ee9e4d356cc8722d1f4126f77" category="paragraph">SQL Server 一律會將交易記錄檔歸零、而且該行為無法變更。不過、您可以啟用或停用即時檔案初始化來控制資料檔案是否正在歸零。啟用即時檔案初始化有助於加速資料檔案成長、並縮短建立或還原資料庫所需的時間。</block>
  <block id="92208bd4d9c6fec3f7c1dedeca62e135" category="paragraph">與即時檔案初始化有關的安全風險較小。啟用此選項時、資料檔案的未分配部分可能會包含先前刪除的作業系統檔案資訊。資料庫管理員可以檢查這類資料。</block>
  <block id="2b222ad4000e6e966783fd7bc480180e" category="paragraph">您可以將 SA_SA_SAM_VOLUM_NAME 權限（也稱為「執行 Volume 維護工作」）新增至 SQL Server 啟動帳戶、以啟用即時檔案初始化。您可以在本機安全性原則管理應用程式（ secpol.msc ）下執行此動作、如下圖所示。開啟「執行 Volume 維護工作」權限的內容、並將 SQL Server 啟動帳戶新增至該處的使用者清單。</block>
  <block id="c622e0142ed854a10f98fcaa8b3487f8" category="paragraph">若要檢查權限是否已啟用、您可以使用下列範例中的程式碼。此程式碼會設定兩個追蹤旗標、強制 SQL Server 將其他資訊寫入錯誤記錄檔、建立小型資料庫、以及讀取記錄內容。</block>
  <block id="eba8c32bde087b29aaa1fe0d3bb32ef3" category="paragraph">如果未啟用即時檔案初始化、 SQL Server 錯誤記錄會顯示 SQL Server 除了將 ldf 記錄檔歸零之外、還會將 MDF 資料檔案歸零、如下例所示。當啟用即時檔案初始化時、它只會顯示記錄檔的零位。</block>
  <block id="cf346325be0652c6b6e9a04b9352bda3" category="paragraph">執行 Volume 維護工作在 SQL Server 2016 中已簡化、稍後會在安裝過程中提供選項。此圖顯示選項、可授予 SQL Server 資料庫引擎服務執行 Volume 維護工作的權限。</block>
  <block id="638b283700120d26a838f9cb56fca59d" category="paragraph">控制資料庫檔案大小的另一個重要資料庫選項是自動壓縮。啟用此選項時、 SQL Server 會定期縮減資料庫檔案、減少檔案大小、並釋出空間給作業系統。這項作業需要大量資源、而且很少有用、因為當新資料進入系統時、資料庫檔案會在一段時間後再次增加。永遠不要在資料庫上啟用自動壓縮。</block>
  <block id="3b6c913908f5844ccb31a4d3775cb34e" category="doc">Microsoft SQL Server 共用執行個體與專用執行個體的比較</block>
  <block id="8b58192b54b5dc25444ace0536a34893" category="paragraph">如果應用程式有許多架構和儲存程序、可能會影響其他共用 SQL Server 執行個體的應用程式。</block>
  <block id="0f85d9701e2ca305652e98c4181097e4" category="paragraph">執行個體資源可能會被分割或鎖定、進而導致在共用 SQL Server 執行個體上主控資料庫的其他應用程式發生效能問題。</block>
  <block id="37fbf1be337695452699ab9df948aa25" category="paragraph">疑難排解效能問題可能很複雜、因為您必須找出哪個執行個體是根本原因。此問題與作業系統授權和 SQL Server 授權的成本相比較。如果應用程式效能至關重要、則強烈建議使用專用執行個體。</block>
  <block id="c840abede1d1bcf78e7b3e30048c08b1" category="paragraph">Microsoft 在伺服器層級的每個核心授權 SQL Server 、而非每個執行個體授權。因此、資料庫管理員想要安裝伺服器能處理的 SQL Server 執行個體數量、以節省授權成本、這可能會導致日後發生重大效能問題。</block>
  <block id="8a77155b45f0f2313c8ebf3d755463e5" category="admonition">* NetApp 建議 * 盡可能選擇專屬的 SQL Server 執行個體、以獲得最佳效能。</block>
  <block id="df7423789cebcf51de121abdae4181c3" category="summary">ONTAP 與企業應用程式</block>
  <block id="6e1c62c6c9ec560b6b6cf47a8a8c83f8" category="summary">使用 Solaris 的 ONTAP 上的 Oracle</block>
  <block id="eaf36c98b91893b7f79bd5184a23d377" category="doc">Solaris</block>
  <block id="fb04d97697a77a89d0c3f5c09cd9ba47" category="paragraph">特定於 Solaris OS 的組態主題。</block>
  <block id="eefc332f1bd0a0aa81d0ce222989294f" category="section-title">Solaris NFS 掛載選項</block>
  <block id="3e484486d582145f6d93ca5f8c71e228" category="paragraph">下表列出單一執行個體的 Solaris NFS 掛載選項。</block>
  <block id="6622c14ce91b6b9683505626a5eebdd2" category="cell">檔案類型</block>
  <block id="f18f8a29d3e2281d374f43c78cf8f0f1" category="cell">掛載選項</block>
  <block id="a45543a64530673135f37ff8f9e95e69" category="cell">ADR 首頁</block>
  <block id="93a02670f814a2df6c830194a7244ea9" category="cell"><block ref="623bbf58c0b2f552d891a1c276bcc3bc" prefix="" category="inline-code"></block></block>
  <block id="80d52d74fd5c383b43f91575d569b42c" category="cell">控制檔
資料檔案
重作記錄</block>
  <block id="73cf9d3814b8678439c37316096219b1" category="cell"><block ref="4c899c62e1ffeb12078476828bb54351" prefix="" category="inline-code"></block></block>
  <block id="72d33cb5c8b7ff5f7fd6a894094b0697" category="cell"><block ref="e1f651debac4f720c13ae930ff3ca14a" prefix="" category="inline-code"></block></block>
  <block id="3f490427e0bf55dc5c837e7b0d4c651c" category="cell"><block ref="b9ce73264210e6d0faa4115ce7525610" prefix="" category="inline-code"></block></block>
  <block id="b00b0ab6e8494db1a230bf3da7f42fd6" category="paragraph">的用途<block ref="545e1db0caafaa47ef37ce893c8fb92c" prefix=" " category="inline-code"></block> 已獲證實、可移除在儲存系統上取得和釋放鎖定的相關延遲、大幅提升客戶環境的效能。在將多個伺服器設定為掛載相同檔案系統的環境中、請謹慎使用此選項、並將 Oracle 設定為掛載這些資料庫。雖然這是非常不尋常的組態、但只有少數客戶使用。如果第二次意外啟動某個執行個體、可能會因為 Oracle 無法偵測到外部伺服器上的鎖定檔案而導致資料毀損。NFS 鎖定不會提供保護；如同 NFS 第 3 版一樣、它們只是建議事項。</block>
  <block id="f480015b57b289b7dad1473ee5c55216" category="paragraph">因為<block ref="545e1db0caafaa47ef37ce893c8fb92c" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block> 參數是互斥的、這一點很重要<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 存在於中<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 檔案就是這樣<block ref="6887bae4cda2d09a283a165c5be3f2b8" prefix=" " category="inline-code"></block> 已使用。如果沒有此參數、就會使用主機作業系統緩衝區快取、而且效能可能會受到負面影響。</block>
  <block id="5171d5dfdc21b0941b921796638c10a9" category="paragraph">下表列出了 Solaris NFS RAC 掛載選項。</block>
  <block id="38e4e10abf410c92cd13e9cb4d54ae35" category="cell"><block ref="41a82b9bd64cb001f8913a34614b00d1" prefix="" category="inline-code"></block></block>
  <block id="e72cc50c204d77a1e47f0dcc8ad28a56" category="cell">控制檔
資料檔案
重作記錄</block>
  <block id="98ee9e91a49f27abbd9dc831afa9fae5" category="cell"><block ref="f3a0fd4a197a2eae60d2ef904e5366f1" prefix="" category="inline-code"></block></block>
  <block id="f93eecf9c582d76d4e14292dc34c79f8" category="cell">CRS/ 投票</block>
  <block id="42c82995de255264e2a8690c3149c16a" category="cell">專屬<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block></block>
  <block id="b71e04a676ec52e65edb52c138f2ad98" category="cell"><block ref="ac15a7c050732bc5169b6c17ce30f859" prefix="" category="inline-code"></block></block>
  <block id="273f714e976e2a709a6abe18d34e4b61" category="cell">共享<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block></block>
  <block id="2052aa052eee25e077178cd737b68f47" category="cell"><block ref="18f533bce293643d1004086db883dd03" prefix="" category="inline-code"></block></block>
  <block id="e9d3beba8b6a40da6f8074236ca3ddbc" category="paragraph">單一執行個體與 RAC 掛載選項之間的主要差異在於新增<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block> 至掛載選項。此新增功能可停用主機作業系統快取、使 RAC 叢集中的所有執行個體都能一致地檢視資料狀態。雖然使用<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 參數<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 停用主機快取的效果相同、仍需使用<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block>。</block>
  <block id="983c4ff0cb78851d95be06277152653f" category="paragraph">原因<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 為共享的必要項目<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> 部署是為了促進檔案的一致性、例如 Oracle 密碼檔案和 spfiles 。如果 RAC 叢集中的每個執行個體都有專用的<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>，不需要此參數。</block>
  <block id="5a11994cffaa4d0a9c8594d2223e3e96" category="section-title">Solaris UFS 掛載選項</block>
  <block id="130c5ffb786e38c2e6648fd53593681a" category="paragraph">NetApp 強烈建議您使用記錄掛載選項、以便在 Solaris 主機當機或 FC 連線中斷時保留資料完整性。記錄掛載選項也可保留 Snapshot 備份的使用性。</block>
  <block id="516f7006de2e9b1f7f871d961db4a1ca" category="section-title">Solaris ZFS</block>
  <block id="a92c2c52c7360246c6da2b1169e0fa50" category="paragraph">必須仔細安裝和設定 Solaris ZFS 、才能提供最佳效能。</block>
  <block id="c9208a3ad95d5ce3d9e2ba1839426251" category="section-title">mvector</block>
  <block id="c54b9977f43cf2f9a1aa7cb0de8fec22" category="paragraph">Solaris 11 變更了 IT 處理大型 I/O 作業的方式、可能會在 SAN 儲存陣列上造成嚴重的效能問題。NetApp 錯誤報告 630173 「 Solaris 11 ZFS 效能回歸」中詳細說明了此問題。" 解決方案是變更名為的 OS 參數<block ref="954f82599f7db0212a28fd448e03bdf3" prefix=" " category="inline-code"></block>。</block>
  <block id="17e692fa261653b11634297d15070637" category="paragraph">以 root 執行下列命令：</block>
  <block id="bc7e9b3c34345bf9ebe88467d6714f1b" category="paragraph">如果這項變更發生任何非預期的問題、您可以以 root 執行下列命令、輕鬆地將其還原：</block>
  <block id="6ff9f4444ac481652f4412b5e1623846" category="section-title">核心</block>
  <block id="78d06f587305b9e5481c8cf660693a61" category="paragraph">可靠的 ZFS 效能需要修補 Solaris 核心、以因應 LUN 對齊問題。此修正程式是隨 Solaris 10 中的修補程式 147440-19 和適用於 Solaris 11 的 SRU 10.5 一起推出的。只能將 Solaris 10 及更新版本與 ZFS 搭配使用。</block>
  <block id="db8880d80ab20f2f01a010e5c454f7fb" category="section-title">LUN 組態</block>
  <block id="3b296d65c0c37979abe39ac7f6d8e1d8" category="paragraph">若要設定 LUN 、請完成下列步驟：</block>
  <block id="3bdc2a5622b76404f8b0ce2fc774e69a" category="list-text">建立類型的 LUN<block ref="7bee0477f82303aa43de5d78f7b9cb05" prefix=" " category="inline-code"></block>。</block>
  <block id="c06f6c6685c06bb821295b3a6d5e580c" category="list-text">安裝所指定的適當主機公用程式套件（ Huk ） <block ref="b5b16f3cdb0eb25a282348ba54f8c677" category="inline-link-macro-rx"></block>。</block>
  <block id="33db73c9b3936cb8eaae825d3101f60c" category="inline-link-macro">最新文件</block>
  <block id="c8646086dca29c1d978ab285faa93709" category="list-text">請依照 Huk 中的說明進行操作、完全符合上述說明。以下概述基本步驟、但請參閱 <block ref="33574dfffc2cb6d01be0edb6738c51bb" category="inline-link-macro-rx"></block> 以瞭解正確的程序。</block>
  <block id="6c06455cad171d61eac3593147bd71d6" category="list-text">執行<block ref="3062dc928daa4d85f6e34b6dea110a00" prefix=" " category="inline-code"></block> 更新的公用程式<block ref="d5416d340f5bec1fcb3addb6ae7d059e" prefix=" " category="inline-code"></block> 檔案：這樣做可讓 SCSI 磁碟機正確探索 ONTAP LUN 。</block>
  <block id="7ec6668202fa9a677238143b0445102f" category="list-text">請遵循所提供的指示<block ref="3062dc928daa4d85f6e34b6dea110a00" prefix=" " category="inline-code"></block> 啟用多重路徑輸入 / 輸出（ MPIO ）的公用程式。</block>
  <block id="b53abe6c0013125abea171427b351ccc" category="list-text">重新開機。此步驟是必要步驟、以便在整個系統中辨識任何變更。</block>
  <block id="b88caedbe9708683eed783eb534ae5f6" category="list-text">分割 LUN 並確認它們已正確對齊。請參閱「附錄 B ： WAFL 校準驗證」、瞭解如何直接測試及確認校準。</block>
  <block id="a0c1c26e783204cf713b2e1f0823aab3" category="section-title">zPools</block>
  <block id="c81b8fe4a368c32102406e65fc41a227" category="inline-link-macro">LUN 組態</block>
  <block id="869dc3a8daf591c7f33e5bb32a4a63c9" category="paragraph">的價值<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 預設為 9 、表示 2^9 或 512 位元組。為了獲得最佳效能<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 值必須為 12 （ 2^12=4K ）。此值是在創建 zpool 時設置的，不能更改，這意味着 zpool 中的數據<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 除 12 個以外、應將資料複製到新建立的 zPool 、以進行移轉。</block>
  <block id="6a00a2262e030c2656588743cb031710" category="paragraph">建立 zPool 之後、請驗證的值<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 繼續之前。如果值不是 12 、則表示未正確探索到 LUN 。銷毀 zpool 、確認相關主機公用程式文件中顯示的所有步驟均已正確執行、然後重新建立 zPool 。</block>
  <block id="15ec722ce3f6694d12f89aeb5b621941" category="section-title">zPools 和 Solaris LDoms</block>
  <block id="8826ef54a7d108df25ed6921b5129cb6" category="paragraph">Solaris LDoms 還需要確保 I/O 對齊正確無誤。雖然 LUN 可能會被正確發現為 4K 裝置、但 LDOM 上的虛擬 vdsk 裝置不會繼承 I/O 網域的組態。以該 LUN 為基礎的 vdsk 預設為 512 位元組區塊。</block>
  <block id="9a984f24f825e4f0bca1f36e11acbca9" category="paragraph">需要額外的組態檔案。首先、必須針對 Oracle 錯誤 15824910 修補個別的 LDOM 、才能啟用其他組態選項。此修補程式已移轉至所有目前使用的 Solaris 版本。一旦 LDOM 獲得修補、就可以依照下列方式設定新的正確對齊 LUN ：</block>
  <block id="e0f306ab540315b015db849b1ae9099e" category="list-text">識別要在新的 zPool 中使用的 LUN 或 LUN 。在此範例中、它是 c2d1 裝置。</block>
  <block id="f469046d419183a7be08ed5a13d2c65e" category="list-text">擷取要用於 ZFS Pool 的裝置之 VDC 執行個體：</block>
  <block id="bcaa63dcd5db76bffd8b867e8720a272" category="list-text">編輯<block ref="ebceeaa7b6ce5abf6c8de7177255fef5" prefix=" " category="inline-code"></block>：</block>
  <block id="ec960a08b4666fe258b6e005064378ab" category="paragraph">這表示裝置執行個體 1 的區塊大小為 4096 。</block>
  <block id="3df4cdc476a0c3a5a930597e9d8da84c" category="paragraph">另一個範例是假設需要將 vdsk 執行個體 1 至 6 設定為 4K 區塊大小和<block ref="74a491ed941b00d0c9909d488eee67bf" prefix=" " category="inline-code"></block> 內容如下：</block>
  <block id="dfed6d8974f03c5b31f20c9c5c2bbe66" category="list-text">最終結果<block ref="3328fba80b08b36663ffae0684f6c578" prefix=" " category="inline-code"></block> 檔案應包含下列項目：</block>
  <block id="764a2caff05993fc0d3eff5de7b225e9" category="cell">注意</block>
  <block id="5c442834a7707cc96719e468c87b2ff6" category="cell">設定 VC.conf 並建立 vdsk 之後、必須重新啟動 LDOM 。無法避免此步驟。區塊大小變更只會在重新開機後生效。繼續使用 zpool 組態、並確保如前所述、移位已正確設定為 12 。</block>
  <block id="2138e0b461ac7e557539bb0b33bde81a" category="section-title">ZFS Intent Log （ ZIL ）</block>
  <block id="5477cebfd480a13008afdd16bea2b3f9" category="paragraph">一般而言、沒有理由在不同的裝置上找到 ZFS Intent Log （ ZIL ）。記錄檔可以與主集區共用空間。獨立 ZIL 的主要用途是使用缺乏現代儲存陣列寫入快取功能的實體磁碟機。</block>
  <block id="26a004aeb043de19f767bd7daa39cf2f" category="section-title">logbias</block>
  <block id="07fff183bc4c01bf9bbb21a48b389845" category="paragraph">設定<block ref="26a004aeb043de19f767bd7daa39cf2f" prefix=" " category="inline-code"></block> 託管 Oracle 資料的 ZFS 檔案系統參數。</block>
  <block id="ac01fbc5e98d6450f3b565d0617f4a55" category="paragraph">使用此參數可降低整體寫入層級。根據預設值、寫入的資料會先提交至 ZIL 、然後再提交至主儲存池。此方法適用於使用純磁碟機組態的組態、包括 SSD 型 ZIL 裝置和主儲存池的旋轉媒體。這是因為它允許在可用的最低延遲媒體上、在單一 I/O 交易中進行認可。</block>
  <block id="c6cc0f147c42f124079d7fc1a0761886" category="paragraph">使用包含其快取功能的現代化儲存陣列時、通常不需要使用此方法。在極少數情況下、可能需要在單一交易中寫入記錄檔、例如由高度集中、對延遲敏感的隨機寫入所組成的工作負載。寫入放大的形式會產生影響、因為記錄的資料最終會寫入主儲存池、導致寫入活動加倍。</block>
  <block id="92b9531657a4ce6a31c623d889a2c55d" category="section-title">直接 I/O</block>
  <block id="387f4a4c250ed7a5003f3f6a19abfd1f" category="paragraph">許多應用程式（包括 Oracle 產品）都可以啟用直接 I/O 、藉此略過主機緩衝區快取此策略無法在 ZFS 檔案系統中正常運作。雖然會略過主機緩衝區快取、但 ZFS 本身仍會繼續快取資料。使用 Fio 或 Sio 等工具執行效能測試時、這項動作可能會產生誤導性的結果、因為很難預測 I/O 是否到達儲存系統、或是是否在作業系統中本機快取。此動作也會讓使用此類模擬測試來比較 ZFS 效能與其他檔案系統的情況變得非常困難。實際上、在真實使用者工作負載下、檔案系統效能幾乎沒有任何差異。</block>
  <block id="ec79b30d56e7bae54aa7efedccc47e93" category="section-title">多個 zPools</block>
  <block id="f5aa5b31f0536ddcdb748ae360d91358" category="paragraph">必須在 zpool 層級執行快照型備份、還原、複製及歸檔 ZFS 型資料、而且通常需要多個 zPools 。zpool 類似於 LVM 磁碟群組、應使用相同的規則進行設定。例如、資料庫的配置最好是存放在資料檔案上<block ref="f1fb162e58045170396a0ac29d648fa5" prefix=" " category="inline-code"></block> 以及駐留在上的歸檔記錄、控制檔和重做記錄<block ref="92073f03d18c8eaec3eb5e0908210e1a" prefix=" " category="inline-code"></block>。此方法允許標準熱備份、將資料庫置於熱備份模式、然後是的快照<block ref="f1fb162e58045170396a0ac29d648fa5" prefix=" " category="inline-code"></block>。接著會從熱備份模式移除資料庫、強制進行記錄歸檔、並建立快照<block ref="92073f03d18c8eaec3eb5e0908210e1a" prefix=" " category="inline-code"></block> 已建立。還原作業需要卸載 zfs 檔案系統、並在執行 SnapRestore 還原作業之後、將 zPool 完全離線。然後可以重新上線並恢復資料庫。</block>
  <block id="f1110589be196c2310808482067fce1b" category="section-title">filesystemio_options</block>
  <block id="c271ff9f255f2d215054d508448781a3" category="paragraph">Oracle 參數<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 使用 ZFS 的方式不同。如果<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block> 或<block ref="6887bae4cda2d09a283a165c5be3f2b8" prefix=" " category="inline-code"></block> 使用時、寫入作業會同步並略過 OS 緩衝區快取、但讀取會由 ZFS 進行緩衝。此動作會導致效能分析方面的困難、因為有時會被 ZFS 快取攔截和服務 I/O 、使儲存延遲和總 I/O 比預期的要少。</block>
  <block id="22a7d37643562540ddbda52f511fb1fe" category="summary">使用 HP-UX 的 ONTAP 上的 Oracle</block>
  <block id="b1fd823d262032e04291313f72be9452" category="doc">HP-UX</block>
  <block id="5be7e182308e16aee80978c6a5ebe02b" category="paragraph">適用於 HP-UX 作業系統的組態主題。</block>
  <block id="8ec258cd0b6ab050fc478a415a20f2e9" category="section-title">HP-UX NFS 掛載選項</block>
  <block id="7c5876d5737071c64af78562fe375386" category="paragraph">下表列出單一執行個體的 HP-UX NFS 掛載選項。</block>
  <block id="9c9fb3cc18a83e4e46165b5c3d4ce8ef" category="cell">控制檔
資料檔案
重作記錄</block>
  <block id="55b835c747261995c0e1022d234e286d" category="cell"><block ref="fa8766c679857b7d589983df0ab5bcf4" prefix="" category="inline-code"></block></block>
  <block id="189dbd39cabd57c5d2e51714d9a5b85b" category="paragraph">下表列出適用於 RAC 的 HP-UX NFS 掛載選項。</block>
  <block id="fa9da3a6a7ef8986a94c7395577c322f" category="cell"><block ref="8b080dc74532d24847a6163dcc34d93f" prefix="" category="inline-code"></block></block>
  <block id="add42ff64fa5b57e5abeab49d154a9d9" category="cell"><block ref="acdef4af05a9f0c43f72b7c600f04d62" prefix="" category="inline-code"></block></block>
  <block id="c88a7b7f83f761f7fc2979815d210140" category="cell"><block ref="d29d7b7ed8c19a99fe17fd7f3d07ea7b" prefix="" category="inline-code"></block></block>
  <block id="af8831a1b8129b099114c3237a61db88" category="paragraph">單一執行個體與 RAC 掛載選項之間的主要差異在於新增<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block> 至掛載選項。此新增功能可停用主機作業系統快取、使 RAC 叢集中的所有執行個體都能一致地檢視資料狀態。雖然使用<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 參數<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 停用主機快取的效果相同、仍需使用<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block>。</block>
  <block id="b865c6aba24c3f61595471aab993d27c" category="paragraph">原因<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 為共享的必要項目<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> 部署是為了促進檔案的一致性、例如 Oracle 密碼檔案和 spfiles 。如果 RAC 叢集中的每個執行個體都有專用的<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>，不需要此參數。</block>
  <block id="898311d838a2fa2fa41b4b52a63a7f1d" category="section-title">HP-UX VxFS 掛載選項</block>
  <block id="85b4a3d44370909d395ab8af28ff4927" category="paragraph">對於託管 Oracle 二進位檔的檔案系統、請使用下列掛載選項：</block>
  <block id="6630bbc9a901be0d038b2c39e2faf65d" category="paragraph">對於包含資料檔案、重做記錄檔、歸檔記錄檔和控制檔的檔案系統、若 HP-UX 版本不支援並行 I/O 、請使用下列掛載選項：</block>
  <block id="ed37730e0f28a631768a396e7898e197" category="paragraph">支援並行 I/O （ VxFS 5.0.1 及更新版本、或 ServiceGuard Storage Management Suite ）時、請針對包含資料檔案、重作記錄檔、歸檔記錄檔和控制檔的檔案系統、使用這些掛載選項：</block>
  <block id="f51ddb98d92e83609db075add5fba4d8" category="admonition">參數<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> 在 VxFS 環境中尤其重要。Oracle 建議在 Oracle 10g R1 及更新版本中保留此參數、除非另有特別指示。Oracle 8KB 區塊大小的預設值為 128 。如果此參數的值強制為 16 或更少、請移除<block ref="a6b02283cba560dcfdea44af66ec792c" prefix=" " category="inline-code"></block> 裝載選項、因為它可能會損害連續 I/O 效能。此步驟會損害其他效能層面、只有在的價值下才應採取<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> 必須從預設值變更。</block>
  <block id="ca3fa25943498edb0ee62d0ea286bb7a" category="summary">使用 Linux 和 ASMlib/ASM 篩選器驅動程式的 ONTAP 上的 Oracle</block>
  <block id="d7e9c72be485a5a848f1f7cd15a9a5ba" category="doc">ASMLib 和 ASM 篩選器驅動程式</block>
  <block id="5802d9527a43305e9e1c903bc6b5a721" category="paragraph">使用 AFD 和 ASMLib 的 Linux 作業系統專屬組態主題</block>
  <block id="2681013be5b0a9063a7ef0a8fe4d31da" category="section-title">ASMLib 區塊大小</block>
  <block id="1943673cc25055e93f0129f2baa8f499" category="paragraph">ASMLib 是選用的 ASM 管理程式庫和相關公用程式。其主要值是將 LUN 或 NFS 型檔案標記為具有人類可讀標籤的 ASM 資源。</block>
  <block id="51713fdb873939c9c333273947776b8e" category="paragraph">ASMLib 的最新版本會偵測稱為每個實體區塊指數（ LBPPBE ）的邏輯區塊的 LUN 參數。ONTAP SCSI 目標直到最近才回報此值。現在會傳回一個值、表示偏好 4KB 區塊大小。這不是區塊大小的定義、但它是使用 LBPPBE 的任何應用程式的提示、可能會更有效率地處理特定大小的 I/O 。不過、 ASMLib 會將 LBPPBE 解譯為區塊大小、並在建立 ASM 裝置時持續標記 ASM 標頭。</block>
  <block id="65242d5b49071240043eeef598415104" category="paragraph">此程序可能會以多種方式造成升級和移轉問題、全部是因為無法在同一個 ASM 磁碟群組中混合使用不同區塊大小的 ASMLib 裝置。</block>
  <block id="ea884eec0628302adc731211dc4e2cc7" category="paragraph">例如、較舊的陣列通常回報 LBPPBE 值為 0 、或根本沒有回報此值。ASMLib 會將此解譯為 512 位元組的區塊大小。較新的陣列會被解譯為具有 4KB 區塊大小。無法在同一個 ASM 磁碟群組中混合使用 512 位元組和 4KB 的裝置。這樣做會阻止用戶使用兩個陣列中的 LUN 或使用 ASM 作爲遷移工具來增加 ASM 磁盤組的大小。在其他情況下、 RMAN 可能不允許在具有 512 位元組區塊大小的 ASM 磁碟群組和具有 4KB 區塊大小的 ASM 磁碟群組之間複製檔案。</block>
  <block id="f17ff15b23b87f35906ece98842a080f" category="paragraph">首選的解決方案是修補 ASMLib 。Oracle 錯誤 ID 為 13999609 、而 Oracle 錯誤 ID 則存在於 oracleas-support-2.1.8-1 及更高版本中。此修補程式可讓使用者設定參數<block ref="442e2026c8afecc4611b52331b5d0d56" prefix=" " category="inline-code"></block> 至<block ref="b326b5062b2f0e69046810717534cb09" prefix=" " category="inline-code"></block> 在中<block ref="92a59ba9a0643a344be2d72cfd504181" prefix=" " category="inline-code"></block> 組態檔。這樣做會阻止 ASMLib 使用 LBPPBE 參數、這表示新陣列上的 LUN 現在會被辨識為 512 位元組區塊裝置。</block>
  <block id="f140ff6b2b71e70e551e39dacb9561ef" category="admonition">此選項不會變更先前由 ASMLib 戳記的 LUN 區塊大小。例如、如果具有 512 位元組區塊的 ASM 磁碟群組必須移轉至回報 4KB 區塊的新儲存系統、則選項<block ref="442e2026c8afecc4611b52331b5d0d56" prefix=" " category="inline-code"></block> 必須先設定、才能使用 ASMLib 標記新的 LUN 。  如果裝置已被 oracleasm 戳記、則必須先重新格式化、然後再重新設定新的區塊大小。首先、請使用取消設定裝置<block ref="41bd8c47b8e640da7bdb5c7dc995d435" prefix=" " category="inline-code"></block>、然後使用清除裝置的前 1GB<block ref="85c2e94baaf4d9c084e19d290907596e" prefix=" " category="inline-code"></block>。最後、如果裝置先前已分割、請使用<block ref="9a287d63dabd6fbcbbe1b12344bfe922" prefix=" " category="inline-code"></block> 命令移除過時的分割區、或只是重新開機作業系統。</block>
  <block id="75ad83418241561186f96dfed5229aaa" category="paragraph">如果無法修補 ASMLib 、可以從組態中移除 ASMLib 。這項變更會造成中斷、需要在 ASM 磁碟上加蓋戳記、並確定<block ref="0802edf7303a95bdecde832bbbe3a89c" prefix=" " category="inline-code"></block> 參數設定正確。不過、這項變更並不需要移轉資料。</block>
  <block id="ad9ac4c6d7ed2e11bdcf8c693658a482" category="section-title">ASM Filter Drive （ AFD ）區塊大小</block>
  <block id="de59cd97a61c9f9964a35d2cd8b05c88" category="paragraph">AFD 是選用的 ASM 管理程式庫、正在取代 ASMLib 。從儲存角度來看、它與 ASMLib 非常類似、但它還包含其他功能、例如能夠封鎖非 Oracle I/O 、以降低使用者或應用程式錯誤可能毀損資料的機會。</block>
  <block id="36dc27685773851e52f035f82e3deba2" category="section-title">裝置區塊大小</block>
  <block id="1ef92cf7e561e179d6079cc937b2778a" category="paragraph">如同 ASMLib 、 AFD 也會讀取 LUN 參數每個實體區塊指數（ LBPPBE ）的邏輯區塊、並依預設使用實體區塊大小、而非邏輯區塊大小。</block>
  <block id="b95ce6c503801cb15f2f9c0773c58f00" category="paragraph">如果將 AFD 新增至現有組態、而 ASM 裝置已格式化為 512 位元組區塊裝置、則可能會造成問題。AFD 驅動程式會將 LUN 辨識為 4K 裝置、而 ASM 標籤與實體裝置之間的不符將會妨礙存取。同樣地、移轉也會受到影響、因為無法在同一個 ASM 磁碟群組中混合使用 512 位元組和 4KB 的裝置。這樣做會阻止用戶使用兩個陣列中的 LUN 或使用 ASM 作爲遷移工具來增加 ASM 磁盤組的大小。在其他情況下、 RMAN 可能不允許在具有 512 位元組區塊大小的 ASM 磁碟群組和具有 4KB 區塊大小的 ASM 磁碟群組之間複製檔案。</block>
  <block id="7ef45d3a7c5fff234bf42bdf549b8339" category="paragraph">解決方案很簡單 - AFD 包含一個參數、可控制它是否使用邏輯區塊或實體區塊大小。這是影響系統上所有裝置的全域參數。若要強制 AFD 使用邏輯區塊大小、請設定<block ref="722fc896569f3d455bb5ef8f5b8c3703" prefix=" " category="inline-code"></block> 在中<block ref="dcd5fd81543c5e08e927c54e89acdd40" prefix=" " category="inline-code"></block> 檔案：</block>
  <block id="47b0d7fc4c27720c4fc326722edad27c" category="section-title">多重路徑傳輸大小</block>
  <block id="7c329811bcc7bb2f50005da5a3aff250" category="paragraph">最近的 Linux 核心變更會強制執行傳送至多重路徑裝置的 I/O 大小限制、而 AFD 則不遵守這些限制。然後會拒絕 I/O 、導致 LUN 路徑離線。結果是無法安裝 Oracle Grid 、設定 ASM 或建立資料庫。</block>
  <block id="926e4b7a2822a39a07f61474b92e9d8c" category="paragraph">解決方案是在 ONTAP LUN 的 multipath.conf 檔案中手動指定傳輸長度上限：</block>
  <block id="3d0c741146f1e8e31bc7d07128ca6e0a" category="admonition">即使目前沒有問題、如果使用 AFD 來確保未來的 Linux 升級不會意外造成問題、也應設定此參數。</block>
  <block id="72247c591c444399f3d42dffa31b644e" category="summary">使用 AIX 的 ONTAP 上的 Oracle</block>
  <block id="23802d94b756cf69028557bea156ab1a" category="doc">IBM AIX</block>
  <block id="5b8d4d99cdcb494ca636eb065004b165" category="paragraph">特定於 IBM AIX 作業系統的組態主題。</block>
  <block id="d99ae60d37a12f766bc2a1f1c228fb4f" category="section-title">並行 I/O</block>
  <block id="0f3eb508f611e203aeffa91d5753648a" category="paragraph">若要在 IBM AIX 上達到最佳效能、必須同時使用 I/O如果沒有並行 I/O 、效能限制很可能是因為 AIX 執行序列化的原子 I/O 、這會產生重大的負荷。</block>
  <block id="ecdc41fc6a2adf7e41e7277e12eeb805" category="paragraph">NetApp 最初建議使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 掛載選項可強制在檔案系統上使用並行 I/O 、但此程序有缺點、不再需要。自從推出 AIX 5.2 和 Oracle 10gR1 之後、 AIX 上的 Oracle 就可以開啟個別檔案來同時執行 IO 、而不是強制在整個檔案系統上同時執行 I/O 。</block>
  <block id="445b433b62b675f0ca0bda7acb56d41b" category="paragraph">啟用並行 I/O 的最佳方法是設定<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 參數<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 至<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block>。這樣做可讓 Oracle 開啟特定檔案、以與並行 I/O 搭配使用</block>
  <block id="6206c23a0282b18352573158f9a8f9b3" category="paragraph">使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 作爲掛載選項，強制使用並行 I/O ，這可能會產生負面影響。例如、強制並行 I/O 會停用檔案系統上的預先讀取、這可能會損害 Oracle 資料庫軟體以外的 I/O 效能、例如複製檔案和執行磁帶備份。此外、 Oracle GoldenGate 和 SAP BR* Tools 等產品與使用不相容<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 裝載選項搭配特定版本的 Oracle 。</block>
  <block id="770cb9a1e9321ca3012ecbb9ec65c422" category="list-text">請勿使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 檔案系統層級的掛載選項。而是透過使用來啟用並行 I/O<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block>。</block>
  <block id="872080b7d5ec5585776f1426fb157842" category="list-text">請僅使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 如果無法設定掛載選項、則應選擇掛載選項<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block>。</block>
  <block id="0c5d86482201f32acb30cd2f7de3048f" category="section-title">AIX NFS 裝載選項</block>
  <block id="1ce07cafb2507c98c8b96ad5f35fb66a" category="paragraph">下表列出 Oracle 單一執行個體資料庫的 AIX NFS 掛載選項。</block>
  <block id="9a8f040dae3f0f15b337fe69a85239c0" category="cell"><block ref="86d38d6e2b36f6557e583e005e23d258" prefix="" category="inline-code"></block></block>
  <block id="d45a1a2afa30c30042b28f028fe75953" category="cell"><block ref="915be14765d6133923d803e1221f1513" prefix="" category="inline-code"></block></block>
  <block id="b74f5956b4bcda2de3c82ee97e192ab6" category="paragraph">下表列出 RAC 的 AIX NFS 掛載選項。</block>
  <block id="b547b55ba7f2a20602494777c5426eba" category="cell"><block ref="7e879bda961bd5b7d64d2ef4f5fb7869" prefix="" category="inline-code"></block></block>
  <block id="875abb256654bd3f6da7abcb1bd92f27" category="cell"><block ref="f93eecf9c582d76d4e14292dc34c79f8" prefix="" category="inline-code"></block></block>
  <block id="3ed8fb68917b28af138fb74ccde62e80" category="cell"><block ref="415e8eb8b9fc05cb48e633d31fd04944" prefix="" category="inline-code"></block></block>
  <block id="8102775fe4080f632332ab8d3312311a" category="paragraph">單一執行個體與 RAC 掛載選項之間的主要差異在於新增<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 至掛載選項。此新增功能可停用主機作業系統快取、使 RAC 叢集中的所有執行個體都能一致地檢視資料狀態。</block>
  <block id="1e3f10dfa324520cb7261c0da5bf6ec7" category="paragraph">雖然使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 裝載選項和<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 參數<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 停用主機快取的效果相同、仍需使用<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block>。<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 為共享的必要項目<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> 部署以促進 Oracle 密碼檔案和等檔案的一致性<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block> 參數檔。如果 RAC 叢集中的每個執行個體都有專用的<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>，則不需要此參數。</block>
  <block id="5365dd1a92461c9e6cf65017c4a11647" category="section-title">AIX jfs/JFS2 掛載選項</block>
  <block id="d7a578263480a2003f05c459a8961298" category="paragraph">下表列出 AIX jfs/JFS2 掛載選項。</block>
  <block id="0aabf727ab0a83c5f5d078e8b18445e0" category="cell">預設值</block>
  <block id="e1f651debac4f720c13ae930ff3ca14a" category="cell">Oracle_Home</block>
  <block id="27a7ffa293f5a4d2a5bb54354486dece" category="paragraph">使用 AIX 之前<block ref="b7cc91287fc99a8937a55e79376c6f54" prefix=" " category="inline-code"></block> 任何環境中的裝置（包括資料庫）都請檢查參數<block ref="9d51746070ef554ad4e93a16de4aed0f" prefix=" " category="inline-code"></block>。此參數不是 HBA 佇列深度、而是與個別主機的 SCSI 佇列深度相關<block ref="66ad66c6ace8456eae4ca6807552e54b" prefix=" " category="inline-code"></block> 效能可能太低。測試顯示最佳值為 64 。</block>
  <block id="6e1dee25b21d0005970053df9e9384ba" category="summary">使用 Microsoft Windows 的 ONTAP 上的 Oracle</block>
  <block id="bb79f96acbff544ded541446c9c7c894" category="doc">Microsoft Windows</block>
  <block id="44959b8c12de9e1107621ee8c0337463" category="paragraph">Microsoft Windows 作業系統專屬的組態主題。</block>
  <block id="14ce2582c2080a7f08fe9249f6565f40" category="paragraph">Oracle 支援搭配直接 NFS 用戶端使用 Microsoft Windows 。這項功能提供 NFS 管理效益的途徑、包括跨環境檢視檔案、動態調整磁碟區大小、以及使用較便宜的 IP 傳輸協定。如需在 Microsoft Windows 上使用 DNFS 安裝及設定資料庫的詳細資訊、請參閱正式的 Oracle 文件。不存在任何特殊的最佳實務做法。</block>
  <block id="f854b764258138b512f30be71e1c7908" category="paragraph">為達到最佳壓縮效率、請確保 NTFS 檔案系統使用 8K 或更大的分配單元。使用 4K 分配單元（通常是預設）會對壓縮效率造成負面影響。</block>
  <block id="140def8362bd2cf6a999328e25572cfd" category="summary">使用 Linux 的 ONTAP 上的 Oracle</block>
  <block id="edc9f0a5a5d57797bf68e37364743831" category="doc">Linux</block>
  <block id="dfc95ed5e895617bbd0d4b1a8bfba8ca" category="paragraph">Linux 作業系統專屬的組態主題。</block>
  <block id="5ecd4a6f4aedfdd45cce80a18b1a7942" category="section-title">插槽表格</block>
  <block id="2518e65e64213437c921c39a097db167" category="section-title">Linux NFS 裝載選項</block>
  <block id="29cd2e6d4fc96e749c4a0e622cad7f50" category="paragraph">下表列出單一執行個體的 Linux NFS 掛載選項。</block>
  <block id="9fafd031075cede0e8a5a796ec45fbff" category="paragraph">下表列出 RAC 的 Linux NFS 掛載選項。</block>
  <block id="f16135915fe2ca5c3b0d660acc0325d3" category="cell"><block ref="4c927b3193f1cd00c7cfd3ac2e7ba8ea" prefix="" category="inline-code"></block></block>
  <block id="fc1ea13514277ff14dc705f62c31c0fc" category="cell"><block ref="4d0511346ac74044d79c9bc297d59b09" prefix="" category="inline-code"></block></block>
  <block id="13c64659680c0bc3603209997cc22225" category="cell">CRS/ 投票</block>
  <block id="672c5eef2603018159295408f761324b" category="cell"><block ref="26b20bdf0b0e7d3ddef3749a70c17932" prefix="" category="inline-code"></block></block>
  <block id="f7085c7dc406f5b44813ac43c18b80c0" category="paragraph">單一執行個體與 RAC 掛載選項之間的主要差異在於新增<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 至掛載選項。此新增功能可停用主機作業系統快取、使 RAC 叢集中的所有執行個體都能一致地檢視資料狀態。雖然使用<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 參數<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 停用主機快取的效果相同、仍需使用<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block>。</block>
  <block id="d2537738f34705bc9d100925252c0102" category="paragraph">原因<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 為共享的必要項目<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> 部署是為了促進檔案的一致性、例如 Oracle 密碼檔案和 spfiles 。如果 RAC 叢集中的每個執行個體都有專用的<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>，則不需要此參數。</block>
  <block id="5084019c1051a9937b5ff77568ce579b" category="paragraph">一般而言、非資料庫檔案的掛載應該與單一執行個體資料檔案所使用的選項相同、不過特定應用程式可能有不同的需求。避免使用掛載選項<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 如果可能、因為這些選項會停用檔案系統層級的預先讀取和緩衝處理。這可能會對擷取、轉譯和載入等程序造成嚴重的效能問題。</block>
  <block id="243de27c01fea05cc58186d2e5ad1ce5" category="section-title">存取與 GetAttr</block>
  <block id="59dcf78e97c197a0f240067da57a248f" category="paragraph">有些客戶指出、存取和 GetAttr 等極高層級的其他 IOPS 、可能會主導他們的工作負載。在極端情況下、讀取和寫入等作業可低於總作業量的 10% 。這是任何包含使用的資料庫的正常行為<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 和/或<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 在 Linux 上、因為這些選項會導致 Linux 作業系統持續從儲存系統重新載入檔案中繼資料。存取和 GetAttr 等作業是從資料庫環境中的 ONTAP 快取提供服務的低影響作業。它們不應被視為真正的 IOPS 、例如讀寫、而會對儲存系統產生真正的需求。不過、這些其他 IOPS 確實會產生一些負載、尤其是在 RAC 環境中。若要解決這種情況、請啟用 DNFS 、以略過作業系統緩衝區快取、避免這些不必要的中繼資料作業。</block>
  <block id="041f371e212c70407e145ae9f752a8b4" category="section-title">Linux Direct NFS</block>
  <block id="dd2f3f344f14ae5daf12cb0a817a72e0" category="paragraph">另一個掛載選項、稱為<block ref="4740c034d97ca90a96b8050082816605" prefix=" " category="inline-code"></block>（ a ） DNFS 啟用時、需要使用、（ b ）來源磁碟區多次裝載於具有巢狀 NFS 裝載的單一伺服器（ c ）上。此組態主要出現在支援 SAP 應用程式的環境中。例如、 NetApp 系統上的單一磁碟區可能會有位於的目錄<block ref="9f9f4ccb1fc3afcbfe0cc3f5eac4332c" prefix=" " category="inline-code"></block> 再來一次<block ref="ac2f9bbcd397d8f6b39e6713658051ea" prefix=" " category="inline-code"></block>。如果<block ref="9f9f4ccb1fc3afcbfe0cc3f5eac4332c" prefix=" " category="inline-code"></block> 安裝於<block ref="9ad16912cc0ba54a259b1a15d233c264" prefix=" " category="inline-code"></block> 和<block ref="ac2f9bbcd397d8f6b39e6713658051ea" prefix=" " category="inline-code"></block> 安裝於<block ref="1da707b60c3b55bd01cb7df7c171a368" prefix=" " category="inline-code"></block>，結果是來自相同來源的巢狀 NFS 掛載。</block>
  <block id="b06ff38483faff2d17d8de1fc966848e" category="paragraph">作業系統可以偵測到這個事實<block ref="9ad16912cc0ba54a259b1a15d233c264" prefix=" " category="inline-code"></block> 和<block ref="1da707b60c3b55bd01cb7df7c171a368" prefix=" " category="inline-code"></block> 位於同一個磁碟區、即相同的來源檔案系統。作業系統接著會使用相同的裝置控制代碼來存取資料。這樣做可以改善 OS 快取和某些其他作業的使用、但會干擾 DNFS 。如果 DNFS 必須存取檔案、例如<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block>、開啟<block ref="1da707b60c3b55bd01cb7df7c171a368" prefix=" " category="inline-code"></block>，它可能會錯誤地嘗試使用錯誤的資料路徑。結果是 I/O 作業失敗。在這些組態中、新增<block ref="4740c034d97ca90a96b8050082816605" prefix=" " category="inline-code"></block> 裝載選項至任何與該主機上其他 NFS 檔案系統共用來源 FlexVol 磁碟區的 NFS 檔案系統。這樣做會強制 Linux 作業系統為該檔案系統分配獨立的裝置控制代碼。</block>
  <block id="14dd7af30f62ec838445a1e167d2aff6" category="section-title">Linux Direct NFS 和 Oracle RAC</block>
  <block id="c6a209e4ad702c6424efb7d63d76feca" category="paragraph">使用 DNFS 對 Linux 作業系統上的 Oracle RAC 有特殊的效能優勢、因為 Linux 沒有強制直接 I/O 的方法、而 RAC 需要此方法才能在節點之間保持一致。因應措施是 Linux 需要使用<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 掛載選項、會使檔案資料從作業系統快取立即過期。此選項會強制 Linux NFS 用戶端持續重新讀取屬性資料、進而損害延遲並增加儲存控制器的負載。</block>
  <block id="3070cb366c38db327b0cf057d63792c1" category="paragraph">啟用 DNFS 會略過主機 NFS 用戶端、避免此損害。多家客戶在啟用 DNFS 時、報告 RAC 叢集的效能大幅提升、 ONTAP 負載大幅降低（特別是其他 IOPS ）。</block>
  <block id="e97ab7f94d503bbec4b013b5b77118c6" category="section-title">Linux Direct NFS 和 oranfstab 檔案</block>
  <block id="f63255b70940d25581e0cf5f81dd6cd6" category="paragraph">在 Linux 上搭配多重路徑選項使用 DNFS 時、必須使用多個子網路。在其他作業系統上、可使用建立多個 DNFS 通道<block ref="54b4c4075463b2e02cd69f5cd139b5b2" prefix=" " category="inline-code"></block> 和<block ref="bbf52a1a57a4eaa83512cab68fd52b70" prefix=" " category="inline-code"></block> 可在單一子網路上設定多個 DNFS 通道的選項。不過、這在 Linux 上無法正常運作、因此可能會產生非預期的效能問題。在 Linux 中、用於 DNFS 流量的每個 NIC 都必須位於不同的子網路上。</block>
  <block id="6c5cf31ca1af553b1f4a9b99e3cb054c" category="section-title">I/O 排程器</block>
  <block id="49bb1f5f4810e5f3d32dac84bd96005d" category="paragraph">Linux 核心可讓您以低層級控制 I/O 排程封鎖裝置的方式。Linux 各版本的預設值差異極大。測試顯示、截止日期通常會提供最佳結果、但有時 NOOP 會稍微好一點。效能差異最小、但如果需要從資料庫組態擷取最大可能效能、請測試這兩個選項。在許多組態中、 CFQ 是預設值、而且已證明資料庫工作負載的效能有重大問題。</block>
  <block id="38f25b8840d56fc601af1024115764b2" category="paragraph">如需設定 I/O 排程器的指示、請參閱相關的 Linux 廠商文件。</block>
  <block id="4150162ad42bffea7bb903b4c7a4ffd9" category="section-title">多重路徑</block>
  <block id="305482bf1c318f0a9a04f94987db06b2" category="paragraph">部分客戶在網路中斷期間遭遇當機、因為多重路徑常駐程式未在其系統上執行。在最新版本的 Linux 上、作業系統的安裝程序和多重路徑常駐程式可能會讓這些作業系統容易受到此問題的影響。套件已正確安裝、但未設定為在重新開機後自動啟動。</block>
  <block id="6fb0bf499bef576f56e0fd6360eba0a6" category="paragraph">例如、 RHEL5.5 上多重路徑常駐程式的預設值可能如下所示：</block>
  <block id="31026ba0b77cbe4c9d44ed6afc859ed6" category="paragraph">您可以使用下列命令來修正此問題：</block>
  <block id="c759a9b7e4db09da8a25fb73d256f6b7" category="section-title">ASM 鏡像</block>
  <block id="f2f41836b42c08199948378b4a4a6e26" category="paragraph">ASM鏡射可能需要變更Linux多重路徑設定、以允許ASM辨識問題並切換至其他故障群組。大部分關於「不完整」的ASM組態ONTAP 都使用外部備援、這表示資料保護是由外部陣列提供、而ASM不會鏡射資料。某些站台使用具有一般備援的ASM來提供雙向鏡像、通常是跨不同站台。</block>
  <block id="25f47751ccd5df99e3c25a8eb2a21fc5" category="inline-link-macro">NetApp 主機公用程式文件</block>
  <block id="066a79b72a430b074cdc0476b67bbde3" category="paragraph">中顯示的 Linux 設定 <block ref="210658f6fe0d0061c73c19a9a6b263d1" category="inline-link-macro-rx"></block> 包含會導致 I/O 無限期佇列的多重路徑參數這表示 LUN 裝置上沒有作用中路徑的 I/O 會在 I/O 完成所需的時間內等待。這通常是很理想的做法、因為 Linux 主機會在 SAN 路徑變更完成、 FC 交換器重新開機或儲存系統完成容錯移轉所需的時間內等待。</block>
  <block id="184ea23c04f24d03fc0123bc6eb30de2" category="paragraph">這種不受限制的佇列行為會導致 ASM 鏡像發生問題、因為 ASM 必須收到 I/O 故障、才能在替代 LUN 上重試 I/O 。</block>
  <block id="5616945ee545765b51d3fe1871cff4ec" category="paragraph">在 Linux 中設定下列參數<block ref="9ac80d53ede05256c28cf9e043eb423c" prefix=" " category="inline-code"></block> 用於 ASM 鏡像的 ASM LUN 檔案：</block>
  <block id="49af3bbe0c557480960d217b217502ff" category="paragraph">這些設定會為 ASM 裝置建立 120 秒的逾時。逾時會計算為<block ref="e2f0125c5971e1ce714f86f145386ee3" prefix=" " category="inline-code"></block> *<block ref="9434de34302b4f40887a7277cf35a8fc" prefix=" " category="inline-code"></block> 秒。在某些情況下可能需要調整確切的值、但 120 秒的逾時時間應足以滿足大部分的使用需求。具體而言、 120 秒的時間應該能讓控制器接管或恢復、而不會產生 I/O 錯誤、導致故障群組離線。</block>
  <block id="dbff1dc161f3f1d61258259b3a0b549c" category="paragraph">較低<block ref="9434de34302b4f40887a7277cf35a8fc" prefix=" " category="inline-code"></block> 此值可縮短 ASM 切換至替代故障群組所需的時間、但這也會增加在維護活動（例如控制器接管）期間不必要的容錯移轉風險。仔細監控 ASM 鏡像狀態、即可降低風險。如果發生不必要的容錯移轉、只要執行重新同步的速度相對較快、鏡像就能快速重新同步。如需更多資訊、請參閱 ASM Fast Mirror Resync 上的 Oracle 說明文件、以瞭解所使用的 Oracle 軟體版本。</block>
  <block id="ec0b68df6b5a0fdd6d73ac710b9684da" category="section-title">Linux xfs 、 ext3 和 ext4 掛載選項</block>
  <block id="278230e4238d02fcb49850454e7d79e0" category="admonition">* NetApp 建議 * 使用預設掛載選項。</block>
  <block id="17361a1d111a3ff3a45b20c3a1efa11b" category="summary">Oracle 和 TCP/IP 及乙太網路組態。</block>
  <block id="fe586387f0871fa578f77ac2e26e624a" category="doc">Oracle 資料庫的 TCP/IP 和乙太網路組態</block>
  <block id="02a5a4d50c5112bb31ff9c94f5b47ce9" category="paragraph">ONTAP 上的許多 Oracle 客戶都使用乙太網路、 NFS 、 iSCSI 、 NVMe / TCP 的網路傳輸協定、尤其是雲端。</block>
  <block id="8a1870adbe8a237106c32d72660a9c42" category="summary">Oracle 資料庫的邏輯介面設計</block>
  <block id="f46a94d438563c03413adfec27c6bfda" category="paragraph">Oracle 資料庫需要存取儲存設備。邏輯介面（ Lifs ）是將儲存虛擬機器（ SVM ）連接到網路、然後再連接到資料庫的網路配送。需要適當的 LIF 設計、才能確保每個資料庫工作負載都有足夠的頻寬、而且容錯移轉不會導致儲存服務遺失。</block>
  <block id="f445528d334d486a14570735705e2223" category="summary">Oracle 資料庫的 FC 網路組態</block>
  <block id="ee955933387c00b282dcfda69005517f" category="doc">Oracle 的 FC 組態</block>
  <block id="92cdde4ecc529b9f9379ed2bdb6aae34" category="paragraph">為 Oracle 資料庫設定 FC SAN 主要是為了遵循日常的 SAN 最佳實務做法。</block>
  <block id="953369199e3a71ad1ad58bc7d5ad2d9f" category="summary">NetApp ONTAP 是一款功能強大的資料管理平台、具備原生功能、包括即時備份、還原與複製功能、即時壓縮等效率功能、不中斷的硬體升級、以及從外部儲存陣列匯入 LUN 的能力。</block>
  <block id="9eaca569c6f5ca3388f5613da3aa008c" category="doc">ONTAP 上的 Oracle 資料庫</block>
  <block id="528b35962f1679204260ddef6800eece" category="paragraph">ONTAP 專為 Oracle 資料庫所設計。數十年來、 ONTAP 已針對關聯式資料庫 I/O 的獨特需求進行最佳化、並特別建立多項 ONTAP 功能、以滿足 Oracle 資料庫的需求、甚至是 Oracle Inc. 本身的要求。</block>
  <block id="c9f8ef2db64ce19b15d2cc98fbd3d24c" category="admonition">本文件取代先前發佈的技術報告 _TR-3633 ： ONTAP 上的 Oracle 資料庫； TR-4591 ： Oracle 資料保護：備份、還原、複寫； TR-4592 ： MetroCluster 上的 Oracle ；以及 TR-4534 ：將 Oracle 資料庫移轉至 NetApp 儲存系統</block>
  <block id="b42ad0517ef7394f97178fb9e1de8d78" category="paragraph">除了 ONTAP 為您的資料庫環境帶來價值的許多可能方式之外、也有許多使用者需求、包括資料庫大小、效能需求和資料保護需求。NetApp 儲存設備的已知部署包括從虛擬化環境（約 6 、 000 個在 VMware ESX 下執行的資料庫）到目前規模為 996TB 且不斷成長的單一執行個體資料倉儲、應有盡有。因此、在 NetApp 儲存設備上設定 Oracle 資料庫的最佳實務做法很少。</block>
  <block id="7bf0493f27e81fe4c3740e773e137a48" category="paragraph">在 NetApp 儲存設備上操作 Oracle 資料庫的需求有兩種解決方法。首先、當有明確的最佳實務做法時、將會特別加以說明。我們將根據 Oracle 儲存解決方案架構設計師的特定業務需求、詳細說明許多設計考量。</block>
  <block id="633d94718c25247da5772ed6f2b244c9" category="summary">Oracle 儲存設備移轉簡介</block>
  <block id="6ca08c212e9ec987ce485fd9c7705eff" category="doc">將 Oracle 資料庫移轉至 NetApp 儲存系統</block>
  <block id="9e099143017b5d9ff9c117de4ac659d7" category="paragraph">利用新儲存平台的功能、有一項不可避免的需求；資料必須放在新的儲存系統上。</block>
  <block id="08beeb11d62fd51ef2742eae3ee3719f" category="admonition">本文件取代先前發佈的技術報告 _TR-4534 ：將 Oracle 資料庫移轉至 NetApp 儲存系統</block>
  <block id="5f2a4190824fd64be3c8cabeb7dc62ff" category="paragraph">若是新的資料庫專案、這並不是問題、因為資料庫和應用程式環境都已建置就緒。然而、移轉對於業務中斷、完成移轉所需的時間、所需的技能組合、以及將風險降至最低等方面、都會帶來特殊挑戰。</block>
  <block id="a83f1ca5ad00b39773d9e6a26b0e70b2" category="section-title">指令碼</block>
  <block id="08293bec81c296b61f4a751175d9caa7" category="paragraph">本文件提供範例指令碼。這些指令碼提供自動化移轉各個層面的範例方法、以降低使用者錯誤的機率。這些指令碼可降低 IT 人員對於移轉作業的整體需求、並加速整體程序。這些指令碼都是從 NetApp 專業服務和 NetApp 合作夥伴執行的實際移轉專案中擷取而來。本文件中會顯示使用範例。</block>
  <block id="b3978e376e381abd116a2ae7938d8a9c" category="summary">FLI Cutover - Oracle</block>
  <block id="c28b52826242c7cdffe5f3ae1e917f61" category="paragraph">由於需要變更 FC 網路組態、因此無法避免在外部 LUN 匯入期間發生中斷。不過、中斷時間不一定比重新啟動資料庫環境和更新 FC 分區所需的時間長、以便將主機 FC 連線能力從外部 LUN 切換至 ONTAP 。</block>
  <block id="a2248459756ffc1877beb9b39c77668b" category="paragraph">此程序可歸納如下：</block>
  <block id="c9f77905e39abbada6c73a7a3d5f51f8" category="list-text">在外部 LUN 上執行所有 LUN 活動。</block>
  <block id="cff6e7c6c4f8dd7e57a0286f28712c58" category="list-text">將主機 FC 連線重新導向至新的 ONTAP 系統。</block>
  <block id="9fea842823b73e1eb32307ab325f170e" category="list-text">觸發匯入程序。</block>
  <block id="df814ea2bf92d4f18e72a648e93103a2" category="list-text">重新探索 LUN 。</block>
  <block id="030a5009bbe6fb141ca5863ab6c59464" category="list-text">重新啟動資料庫。</block>
  <block id="f3bb22d18791c042e889671ad1963239" category="paragraph">您不需要等待移轉程序完成。一旦開始移轉給定的 LUN 、就可以在 ONTAP 上使用、並在資料複製程序繼續進行時提供資料。所有讀取都會傳送到外部 LUN 、而且所有寫入都會同步寫入兩個陣列。複製作業非常快速、重新導向 FC 流量的負荷也很小、因此對效能的任何影響都應該是暫時性的、而且最小的。如果有疑慮、您可以延遲重新啟動環境、直到移轉程序完成、匯入關係已刪除為止。</block>
  <block id="b19e17ab765f91aa0bc0e7152f13779f" category="section-title">關閉資料庫</block>
  <block id="2869cd69e0fec20ba28a42e74afef158" category="paragraph">在本範例中、停止環境的第一步是關閉資料庫。</block>
  <block id="e20dab0880a91f5da2ea05170177576d" category="section-title">關閉網格服務</block>
  <block id="89c458e5176d6caf0690f1e61ecb0620" category="paragraph">其中一個要移轉的 SAN 型檔案系統也包含 Oracle ASM 服務。若要停止基礎 LUN 、則需要卸除檔案系統、這也意味著在此檔案系統上停止任何開啟檔案的處理程序。</block>
  <block id="49f05bf7da4eacfa4c80bb987443eb5a" category="section-title">卸除檔案系統</block>
  <block id="c5a09ac3ff0bb25c97951c7b7f815cd0" category="paragraph">如果所有程序都關閉、 umount 作業就會成功。如果權限遭拒、檔案系統上必須有鎖定的程序。。<block ref="ace112f9725b6fa0b702e6b3970b2102" prefix=" " category="inline-code"></block> 命令可協助識別這些程序。</block>
  <block id="765e13ffc3361a9fd6c6088b2603ffbf" category="section-title">停用 Volume 群組</block>
  <block id="907e5f35f70dc2f5e4b67da56381bdf4" category="paragraph">卸除指定 Volume 群組中的所有檔案系統後、即可停用該 Volume 群組。</block>
  <block id="ad80f935ccd133a802189e3c2f4421d7" category="section-title">FC 網路變更</block>
  <block id="a497da6790d9ab4bb5cce3d04b0efd2e" category="paragraph">現在可以更新 FC 區域、以移除主機對外部陣列的所有存取權、並建立對 ONTAP 的存取權。</block>
  <block id="3ef31115a10790468ad841ec2cdf566f" category="section-title">開始匯入程序</block>
  <block id="5bc309ef1913ddc70534a0a7135ba938" category="paragraph">若要啟動 LUN 匯入程序、請執行<block ref="76ffc50817aa4cd6214aa0061339fdf6" prefix=" " category="inline-code"></block> 命令。</block>
  <block id="0a10f1ad4a0b45d384c5771ec0906c4c" category="section-title">監控匯入進度</block>
  <block id="9a3a7545f4a7407ec022c4b2271e0c34" category="paragraph">您可以使用監控匯入作業<block ref="1ab15ef2c245a4434fcea3cc3149f4f4" prefix=" " category="inline-code"></block> 命令。如下所示、目前正在匯入所有 20 個 LUN 、這表示即使資料複製作業仍在進行中、仍可透過 ONTAP 存取資料。</block>
  <block id="d36f98c8a305e33483232e7b5cd90c49" category="inline-link-macro">外部 LUN 匯入：完成</block>
  <block id="24a74765303a8fc0e4b1e7afbb8e2205" category="paragraph">如果您需要離線程序、請延遲重新探索或重新啟動服務、直到<block ref="1ab15ef2c245a4434fcea3cc3149f4f4" prefix=" " category="inline-code"></block> 命令表示所有移轉均已成功完成。接著您可以依照中所述、完成移轉程序 <block ref="5b0017122426f8734e0358273adc6802" category="inline-link-macro-rx"></block>。</block>
  <block id="a9c97f84ee4958d39ed989b3da7ed0ba" category="paragraph">如果您需要線上移轉、請繼續在新的主目錄中重新探索 LUN 、並啟動服務。</block>
  <block id="d0369936c6fe8c292874e3bc647893b8" category="section-title">掃描 SCSI 裝置變更</block>
  <block id="6d338faddede649cab4c5b498e8e4379" category="paragraph">在大多數情況下、重新探索新 LUN 最簡單的選項是重新啟動主機。這樣做會自動移除舊的過時裝置、正確探索所有新的 LUN 、並建置相關的裝置、例如多重路徑裝置。以下範例顯示出完全線上的示範程序。</block>
  <block id="3b493a859f19779c1f7db7d1951785ee" category="paragraph">注意：在重新啟動主機之前、請確定中的所有項目都已存在<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 這項參照移轉的 SAN 資源會被註解出來。如果未執行此操作、且 LUN 存取有問題、作業系統可能無法開機。這種情況不會損害資料。不過、開機進入救援模式或類似模式並修正可能非常不方便<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 如此一來、就能開機作業系統以進行疑難排解。</block>
  <block id="9d7b16568eb7edb80492b49cb02d7663" category="paragraph">本範例所使用 Linux 版本上的 LUN 可與重新掃描<block ref="b6f75508bf2af141e9de6f862662661e" prefix=" " category="inline-code"></block> 命令。如果命令成功、每個 LUN 路徑都會出現在輸出中。輸出可能很難解譯、但如果分區和 igroup 組態正確、許多 LUN 應該會顯示為包含<block ref="971c047750d8e3b03c71d24020b3816f" prefix=" " category="inline-code"></block> 廠商字串。</block>
  <block id="3384aa7c090758ad18028832967b143f" category="section-title">檢查多重路徑裝置</block>
  <block id="07a39d42e6d8cc61e0a880e43b83e2a3" category="paragraph">LUN 探索程序也會觸發多重路徑裝置的重新開發、但已知 Linux 多重路徑驅動程式偶爾會發生問題。的輸出<block ref="eeb30d005cab1d8c69785a3cd5818f55" prefix=" " category="inline-code"></block> 應檢查以驗證輸出是否如預期。例如、下列輸出顯示與相關的多重路徑裝置<block ref="971c047750d8e3b03c71d24020b3816f" prefix=" " category="inline-code"></block> 廠商字串。每個裝置有四條路徑、其中兩條優先順序為 50 、兩條優先順序為 10 。雖然確切的輸出可能會因 Linux 的不同版本而有所不同、但此輸出的外觀與預期相同。</block>
  <block id="efd921479c3d57448954050760c568ca" category="admonition">請參閱您用來驗證的 Linux 版本的主機公用程式文件<block ref="dd5ff67ba72768d33f75e645aa2b8e56" prefix=" " category="inline-code"></block> 設定正確。</block>
  <block id="28751dc1e914a778d11ca0e69613690b" category="section-title">重新啟動 LVM Volume 群組</block>
  <block id="a66a38e4056f28a310ef6d1fa8bbcc77" category="paragraph">如果正確探索到 LVM LUN 、則會發現<block ref="5239f542d8edbc4b528b1f362153c0c7" prefix=" " category="inline-code"></block> 命令應該成功。這是邏輯 Volume Manager 的價值範例。由於磁碟區群組中繼資料是寫入 LUN 本身、因此 LUN 的 WWN 變更甚至是序列號都不重要。</block>
  <block id="1d374f8de5ba1b82ab4407b8c6efbd0d" category="paragraph">作業系統掃描 LUN 、並發現 LUN 上寫入的少量資料、可將其識別為屬於的實體磁碟區<block ref="83b7788c8e4de444d6cd4c69978eaf32" prefix=" " category="inline-code"></block>。然後、它會建置所有必要的裝置。只需重新啟動 Volume 群組即可。</block>
  <block id="1f0285a57b2357507c3b77ce5130b548" category="section-title">重新掛載檔案系統</block>
  <block id="a9047d68dc7e99f553b71590cff301d6" category="paragraph">磁碟區群組重新啟動後、檔案系統可以裝入、所有原始資料均完整無缺。如前所述、即使資料複寫仍在後端群組中作用中、檔案系統仍可完全運作。</block>
  <block id="a787d65e2525ac6bc3a6328efe383b5c" category="section-title">重新掃描 ASM 設備</block>
  <block id="a25bb20f07ed95a633f623678855e8dc" category="paragraph">重新掃描 SCSI 裝置時、應已重新探索 ASMLib 裝置。重新探索可透過重新啟動 ASMLib 、然後掃描磁碟來線上驗證。</block>
  <block id="37fb12a52b4a5371c12209e89e09b04f" category="admonition">此步驟僅與使用 ASMLib 的 ASM 組態相關。</block>
  <block id="6de48f39063d81d53fd0ff3e9938af13" category="paragraph">注意：若未使用 ASMLib 、請使用<block ref="9c9f766701f811ef6f170c7a3453c53f" prefix=" " category="inline-code"></block> 裝置應已自動重新建立。不過、權限可能不正確。在 ASMLib 不存在的情況下、您必須為基礎裝置設定特殊權限。這樣做通常是透過中的特殊項目來完成<block ref="dd5ff67ba72768d33f75e645aa2b8e56" prefix=" " category="inline-code"></block> 或<block ref="ab775c875d5f89d991a670444dd32ad2" prefix=" " category="inline-code"></block> 規則、或可能同時在兩個規則集中。這些檔案可能需要更新、以反映環境中的 WWN 或序號變更、以確保 ASM 裝置仍擁有正確的權限。</block>
  <block id="08b33d6af4ec78f99dbbc3533589aafc" category="paragraph">在此範例中、重新啟動 ASMLib 並掃描磁碟時、會顯示與原始環境相同的 10 個 ASM LUN 。</block>
  <block id="17c4ae76000d9a79a56195071665af32" category="section-title">重新啟動網格服務</block>
  <block id="e8c3dc00e15826e3b77a2d41d7fde92a" category="paragraph">現在、 LVM 和 ASM 裝置已上線且可供使用、可以重新啟動網格服務。</block>
  <block id="934317e45581988a01f54761705ca58a" category="section-title">重新啟動資料庫</block>
  <block id="41475a737e947d73c674b90e78e246a0" category="paragraph">網格服務重新啟動後、即可啟動資料庫。在嘗試啟動資料庫之前、可能需要等待幾分鐘、 ASM 服務才能完全可用。</block>
  <block id="0b986cf2a434b03b097578ad444e72f0" category="summary">完成 FLI 轉換 - Oracle</block>
  <block id="24bd7d2a01571aa270c81d8d9f8370e9" category="doc">FLI 完成 - Oracle</block>
  <block id="b171714b39ad4102aced4daceef8c678" category="paragraph">從主機的角度來看、移轉已完成、但在匯入關係刪除之前、仍會從外部陣列提供 I/O 。</block>
  <block id="f708d001227724fa0a8a3d57aacedb1a" category="paragraph">刪除關係之前、您必須確認所有 LUN 的移轉程序已完成。</block>
  <block id="85cf20229bc9008553794abdaed507f5" category="section-title">刪除匯入關係</block>
  <block id="b23ec325eb9c6278cb36e4c45c2c3499" category="paragraph">移轉程序完成後、請刪除移轉關係。完成後、 I/O 將由 ONTAP 上的磁碟機獨家提供。</block>
  <block id="40b98b0023a7eea7c432c29e3c44ba7d" category="section-title">取消註冊外部 LUN</block>
  <block id="5ccc14ae93ba94bd4183439a9f80f6c8" category="paragraph">最後、修改磁碟以移除<block ref="96ea0e5f46787e93e2970a086b47fdb6" prefix=" " category="inline-code"></block> 指定。</block>
  <block id="875bb561ba851d301052704e0ffb70f4" category="summary">透過記錄傳送進行 Oracle 移轉</block>
  <block id="e0f9c3b73fe5700df95f30eb98ca4034" category="doc">Oracle 記錄傳送</block>
  <block id="8e42b5809657e127c7e2d24f30bc493e" category="paragraph">使用記錄傳送進行移轉的目標是在新位置建立原始資料檔案的複本、然後建立將變更傳送到新環境的方法。</block>
  <block id="599df5f564506c95624dd78b0b75eeac" category="paragraph">一旦建立、記錄傳送和重播就能自動進行、使複本資料庫與來源保持大致同步。例如、 cron 工作可排程至（ a ）將最近的記錄複製到新位置、並（ b ）每 15 分鐘重播一次。這樣做可在轉換時將中斷次數降至最低、因為必須重播不超過 15 分鐘的歸檔記錄。</block>
  <block id="41bec1b4ddc17b3367c68a025c0ddfb9" category="paragraph">以下程序基本上也是資料庫複製作業。所示邏輯類似於 NetApp SnapManager for Oracle （ SMO ）和 NetApp SnapCenter Oracle Plug-in 內的引擎。有些客戶已使用指令碼或 WFA 工作流程中所示的程序來進行自訂的複製作業。雖然此程序比使用 SnapCenter 或 SMO 更為手冊化、但仍可輕鬆撰寫指令碼、而 ONTAP 中的資料管理 API 則可進一步簡化程序。</block>
  <block id="f0616883a5ca70aa97676de436a7fb9e" category="section-title">記錄傳送 - 檔案系統至檔案系統</block>
  <block id="8f922b64f0bc64f6bba1d555a61ee3bb" category="paragraph">本範例示範如何將名為華夫餅的資料庫從一般檔案系統移轉至位於不同伺服器上的其他一般檔案系統。它也說明 SnapMirror 可用來快速複製資料檔案、但這並不是整體程序不可或缺的一部分。</block>
  <block id="60100e1b826a4b972fc113c391f932e7" category="section-title">建立資料庫備份</block>
  <block id="80cf34e10dcfbc5e76c6b2f845f2708d" category="paragraph">第一步是建立資料庫備份。具體而言、此程序需要一組資料檔案、可用於歸檔記錄重新執行。</block>
  <block id="0ba29c6a1afacf586b03a26162c72274" category="section-title">環境</block>
  <block id="82f9b672d88793b2ca5716b2a5427056" category="paragraph">在此範例中、來源資料庫位於 ONTAP 系統上。建立資料庫備份最簡單的方法是使用 Snapshot 複本。將資料庫置於熱備份模式幾秒鐘<block ref="252ce13e6c150af4d3e7eea5fca266bc" prefix=" " category="inline-code"></block> 在託管資料檔案的磁碟區上執行作業。</block>
  <block id="1fd3a22cf15d1e18a6507f539346c40d" category="paragraph">結果是磁碟上的 Snapshot 複本稱為<block ref="a8b3bc9f12cd194b80d404c30e9015ee" prefix=" " category="inline-code"></block> 包含處於熱備份模式時的資料檔案映像。如果結合適當的歸檔記錄以使資料檔案一致、則此 Snapshot 複本中的資料可作為還原或複製的基礎。在這種情況下、它會複寫到新的伺服器。</block>
  <block id="744a73803cdac4a5067725ca5814a2cf" category="section-title">還原至新環境</block>
  <block id="46228bb2ce31b0d397faad2b805e8a37" category="paragraph">現在必須在新環境中還原備份。這可以透過多種方式完成、包括 Oracle RMAN 、從備份應用程式（如 NetBackup ）還原、或是簡單複製置於熱備份模式的資料檔案。</block>
  <block id="ca7da361ad92f677545e12dd462c6e39" category="paragraph">在此範例中、 SnapMirror 用於將稱為熱備份的 Snapshot 複本複寫到新位置。</block>
  <block id="1f255556546f1fdfb53692e41f35eb6c" category="list-text">建立新的磁碟區以接收快照資料。從初始化鏡像<block ref="937e9fa808ccfe9a4f6b004a2a7caada" prefix=" " category="inline-code"></block> 至<block ref="96f9dacb3cb1b1f6f9b4ad02992a1a0e" prefix=" " category="inline-code"></block>。</block>
  <block id="5b1944ec8c0ed933e5b2ea2e3e5fa76e" category="list-text">在 SnapMirror 設定狀態後、表示同步已完成、請特別根據所需的快照來更新鏡像。</block>
  <block id="f4d90c6c29b1f76ab9c87a9996c9751e" category="list-text">您可以透過檢視來驗證同步成功與否<block ref="31952c255e722053d4cc3f82921e95db" prefix=" " category="inline-code"></block> 鏡射磁碟區上的欄位。</block>
  <block id="0934c3fcad3065c2a479125e4a80b259" category="list-text">然後鏡射可能會中斷。</block>
  <block id="fcf1f505b94151a36eba8e1563e7176f" category="list-text">掛載新的檔案系統。使用區塊型檔案系統時、精確的程序會因使用中的 LVM 而異。必須設定 FC 分區或 iSCSI 連線。建立與 LUN 的連線後、命令如 Linux<block ref="302c49bbd5bcda5463eb5130804effc1" prefix=" " category="inline-code"></block> 可能需要探索哪些磁碟區群組或 LUN 需要正確設定、才能讓 ASM 發現。</block>
  <block id="20c4d1d4163c2463cf15ff7df6424459" category="paragraph">在此範例中、使用簡單的 NFS 檔案系統。此檔案系統可直接掛載。</block>
  <block id="b2dd88a1f03a5fb4c2e3c0d46f425161" category="section-title">建立控制檔建立範本</block>
  <block id="1c30e11140f1d0a1093bedee34eef1e4" category="paragraph">接下來必須建立控制檔範本。。<block ref="3177841b2335a6640ea3054199830f1c" prefix=" " category="inline-code"></block> 命令會建立文字命令以重新建立控制檔。在某些情況下、此功能可用於從備份還原資料庫、而且通常用於執行資料庫複製等工作的指令碼。</block>
  <block id="3f51d58ec72b9d36cb5e0636525130b5" category="list-text">以下命令的輸出用於爲遷移的數據庫重新創建控制文件。</block>
  <block id="cb395c3bf18fd427287caecc9b28058a" category="list-text">建立控制檔之後、請將檔案複製到新伺服器。</block>
  <block id="cf5c9046a3617a19c0ccc24e4cf54a33" category="section-title">備份參數檔案</block>
  <block id="0d1d1a7db58f3f93ec977733f4909f5d" category="paragraph">在新環境中也需要一個參數檔。最簡單的方法是從目前的 spfile 或 pfile 建立 pfile 。在此範例中、來源資料庫使用的是 spfile 。</block>
  <block id="051a634cb1e9a53dbf139214e1d24001" category="section-title">建立 oratab 項目</block>
  <block id="2dabc26c8b55d44e25a184ba2624eed0" category="paragraph">需要建立 oratab 項目、才能正常運作如 oraenv 等公用程式。若要建立 oratab 項目、請完成下列步驟。</block>
  <block id="87ef75141d237e3b44e8310aad8fcf19" category="section-title">準備目錄結構</block>
  <block id="12f833c44c11e6bbd970cc126bce2bcb" category="paragraph">如果所需目錄尚未存在、您必須建立它們、否則資料庫啟動程序會失敗。若要準備目錄結構、請完成下列最低需求。</block>
  <block id="60225c364a012796a6d886e8cf4ec486" category="section-title">參數檔案更新</block>
  <block id="e36ee2d9a95a6b672917862d714af383" category="list-text">若要將參數檔複製到新伺服器、請執行下列命令。預設位置為<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> 目錄。在這種情況下、 pfile 可以放在任何地方。它只是移轉程序中的中間步驟。</block>
  <block id="d437a40a59905247cfb39cf9dc9da256" category="list-text">視需要編輯檔案。例如、如果歸檔記錄位置已變更、則必須變更 pfile 以反映新位置。在此範例中、只有控制檔正在重新定位、部分是為了在記錄檔和資料檔案系統之間散佈。</block>
  <block id="55cc35656c3d28c1b3267c246b397521" category="list-text">編輯完成後、請根據此 pfile 建立 spfile 。</block>
  <block id="a833a03e6af0b969524dcccb8f296f1c" category="section-title">重新建立控制檔</block>
  <block id="74a636ee3a009f08cd5623dc8066dd09" category="paragraph">在前一個步驟中、的輸出<block ref="3177841b2335a6640ea3054199830f1c" prefix=" " category="inline-code"></block> 已複製到新伺服器。所需輸出的特定部分是<block ref="0ca1fba455d799b9a1cc2440b9ba7043" prefix=" " category="inline-code"></block> 命令。此資訊可在檔案中標記的區段下找到<block ref="9fb76d62be749cec8bdd06f46c77bf5b" prefix=" " category="inline-code"></block>。從這條線開始<block ref="13ac20c4a96b2ecfd703e831ad722907" prefix=" " category="inline-code"></block> 並應包含這個字<block ref="c3c62948f78a7ccaabb9ef2eea80a895" prefix=" " category="inline-code"></block>。結尾是分號（；）字元。</block>
  <block id="bf4b2a006646a8e77166a2a596425074" category="list-text">在此範例程序中、檔案會讀取如下內容。</block>
  <block id="a9a27c002ec883341220e267712250a7" category="list-text">視需要編輯此指令碼、以反映各種檔案的新位置。例如、已知可支援高 I/O 的某些資料檔案、可能會重新導向至高效能儲存層上的檔案系統。在其他情況下、這些變更可能純粹是因為系統管理員的理由、例如在專用磁碟區中隔離指定的 PDB 資料檔案。</block>
  <block id="2540fb1670d4f9ee8a704a7eb8d748fe" category="list-text">在此範例中<block ref="b86df74c6982de8dec7509d039294d7a" prefix=" " category="inline-code"></block> stanza 保持不變、但重做記錄會移至中的新位置<block ref="96bb85ed0fe822778c4e5a821e991ad8" prefix=" " category="inline-code"></block> 而非與歸檔登入共用空間<block ref="0e62afc91abe157ef67895cca0a7f912" prefix=" " category="inline-code"></block>。</block>
  <block id="8d47ad079859f2976fdc7ebf742f768d" category="paragraph">如果有任何檔案放錯位置或參數設定錯誤、就會產生錯誤、指出必須修正的項目。資料庫已掛載、但尚未開啟且無法開啟、因為使用中的資料檔案仍標示為處於熱備份模式。必須先套用歸檔記錄檔、才能使資料庫一致。</block>
  <block id="6b7c2d588ac708b58f7ac889090608f6" category="section-title">初始記錄複寫</block>
  <block id="2db2d3d6001a06d1a027904fa66bc78c" category="paragraph">為了使資料檔案一致、至少需要執行一項記錄回覆作業。有許多選項可供重播記錄。在某些情況下、原始伺服器上的原始歸檔記錄檔位置可以透過 NFS 共用、而且記錄回覆可以直接完成。在其他情況下、必須複製歸檔記錄。</block>
  <block id="5c394e6951584d114c6706d0768e30d7" category="paragraph">例如、簡單<block ref="8a444a43bdf534c0c6338bb7809659b3" prefix=" " category="inline-code"></block> 作業可將所有目前記錄從來源伺服器複製到移轉伺服器：</block>
  <block id="5fdb3158ed28dd3aa90b94556476b781" category="section-title">初始記錄重新播放</block>
  <block id="c2f93ef52583f81f0eba05a39483e2d8" category="paragraph">檔案在歸檔記錄位置後、可以發出命令來重新播放<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block> 接著是回應<block ref="e1f2d5134ed2543d38a0de9751cf75d9" prefix=" " category="inline-code"></block> 自動重播所有可用的記錄。</block>
  <block id="f30a45a22256018185c5d235292e4d5e" category="paragraph">最終的歸檔記錄回覆會回報錯誤、但這是正常現象。記錄會指出這一點<block ref="a84f4f3da79386c29ab6dfa560af786e" prefix=" " category="inline-code"></block> 正在尋找特定的記錄檔、但找不到該檔案。原因很可能是記錄檔尚未存在。</block>
  <block id="80bea8a60412cace54760b223b2d799e" category="paragraph">如果在複製歸檔記錄之前可以關閉來源資料庫、則此步驟只能執行一次。歸檔記錄會複製並重新播放、然後程序會直接繼續進行轉換程序、以複寫重要的重作記錄。</block>
  <block id="1e334141582a9dcb581c9b34ef2df071" category="section-title">遞增記錄複寫及重新播放</block>
  <block id="5fd2b0bf662c2b1ebdc677ea888536ce" category="paragraph">在大多數情況下、移轉作業不會立即執行。移轉程序可能在幾天甚至幾週前完成、這表示記錄必須持續運送至複本資料庫並重新執行。因此、當轉換程式到達時、必須傳輸和重播最少的資料。</block>
  <block id="0c56d82ec6857bcef5475899b9f7b5cc" category="paragraph">這樣做有許多方式可以撰寫指令碼、但其中最受歡迎的方法之一是使用 rsync 、這是通用的檔案複寫公用程式。使用此公用程式最安全的方法是將其設定為常駐程式。例如、<block ref="b31375af035ed8a698a803a491084f61" prefix=" " category="inline-code"></block> 下列檔案顯示如何建立名為的資源<block ref="260e23541ff372b9bc53b4bd3c0c38ba" prefix=" " category="inline-code"></block> 使用 Oracle 使用者認證存取、並對應至<block ref="488a4921a81e36fca411e6f13cefbbf2" prefix=" " category="inline-code"></block>。最重要的是、資源設為唯讀、可讀取正式作業資料、但不變更。</block>
  <block id="eabf1b424989b2c7113ba3a538079afa" category="paragraph">下列命令會將新伺服器的保存檔記錄目的地與 rsync 資源同步<block ref="260e23541ff372b9bc53b4bd3c0c38ba" prefix=" " category="inline-code"></block> 在原始伺服器上。。<block ref="e358efa489f58062f10dd7316b65649e" prefix=" " category="inline-code"></block> 引數<block ref="293e33723231f0504effabb52b054a31" prefix=" " category="inline-code"></block> 根據時間戳記比較檔案清單、只複製新檔案。此程序提供新伺服器的遞增更新。此命令也可在 cron 中排程為定期執行。</block>
  <block id="c775c44069da13c8f7ee5c5116e76e36" category="inline-link-macro">重播資料庫上的記錄</block>
  <block id="c3bf9b2ef3e3ae2ae6a02f7f77cfcbc6" category="paragraph">在收到記錄之後、必須重新播放記錄。前面的範例顯示使用 sqlplus 來手動執行<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block>，這是一種可以輕鬆自動化的程序。此處顯示的範例使用中所述的指令碼 <block ref="3e57a2099043fa40c58f1e0d4eed995d" category="inline-link-macro-rx"></block>。指令碼會接受指定需要重新執行作業之資料庫的引數。如此可在多資料庫移轉作業中使用相同的指令碼。</block>
  <block id="4ea2a6c39b10b3e3076f976f58a861d1" category="section-title">轉換</block>
  <block id="5de3f1ba0bbef459baa93f04f63b9ea1" category="paragraph">當您準備好切換至新環境時、必須執行最後一次同步、其中包括歸檔記錄和重做記錄。如果尚未知道原始的重做記錄位置、可以如下所示識別：</block>
  <block id="677f005cc0f8be0f891df5af72fb5688" category="list-text">關閉來源資料庫。</block>
  <block id="41b182875e12de118d17b3432cca93fa" category="list-text">使用所需的方法、在新伺服器上執行歸檔記錄的最後一次同步。</block>
  <block id="37d6d9420cef8230249e7691315f0e13" category="list-text">來源重做記錄檔必須複製到新伺服器。在此範例中、重做記錄會重新定位到新的目錄<block ref="96bb85ed0fe822778c4e5a821e991ad8" prefix=" " category="inline-code"></block>。</block>
  <block id="d0a5f1380bd67b0d0fd3bc72f22d88f2" category="list-text">在此階段、新的資料庫環境包含所有必要的檔案、使其與來源完全相同。歸檔記錄必須最後重播一次。</block>
  <block id="c2721157205b2d2e96c656c45ca72992" category="list-text">完成後、必須重新執行重作記錄。如果出現此訊息<block ref="975df7a5099101ffbe47981cd1d37c2c" prefix=" " category="inline-code"></block> 會傳回、程序成功、資料庫會同步、並可開啟。</block>
  <block id="6acab27c5f334c66f06f3f74bc62d6d8" category="section-title">記錄傳送 - ASM 至檔案系統</block>
  <block id="a67ffcc8b155bb909a6f8c5d5ba2f334" category="paragraph">本範例說明如何使用 Oracle RMAN 移轉資料庫。這與先前的檔案系統傳送檔案系統記錄檔範例非常類似、但主機看不到 ASM 上的檔案。唯一用於移轉位於 ASM 裝置上的資料的選項是重新放置 ASM LUN 、或使用 Oracle RMAN 來執行複製作業。</block>
  <block id="1c51600a778919f7f3abb5b25175220a" category="paragraph">雖然 RMAN 是從 Oracle ASM 複製檔案的必要條件、但 RMAN 的使用不限於 ASM 。RMAN 可用於從任何類型的儲存設備移轉至任何其他類型。</block>
  <block id="2cb6a5bfc4a76f651d496cddc685e078" category="paragraph">此範例顯示將名為 pake 的資料庫從 ASM 儲存設備重新放置到位於路徑上不同伺服器上的一般檔案系統<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> 和<block ref="0e62afc91abe157ef67895cca0a7f912" prefix=" " category="inline-code"></block>。</block>
  <block id="d1d789c37f1c96d0a5de07798c14fcc5" category="paragraph">第一步是建立要移轉到替代伺服器的資料庫備份。由於來源使用 Oracle ASM 、因此必須使用 RMAN 。簡單的 RMAN 備份可執行如下。此方法會建立標記備份、可在稍後的程序中由 RMAN 輕鬆識別。</block>
  <block id="ed927706d8abc2bbf3a5a8bc55e1e562" category="paragraph">第一個命令定義備份的目的地類型和要使用的位置。第二個只會啟動資料檔案的備份。</block>
  <block id="db85d05166dd65559ae5f426b51198e6" category="section-title">備份控制檔</block>
  <block id="a0b95d36955723a82dde7bbe40b6ccb9" category="paragraph">稍後的程序中需要備份控制檔<block ref="08de2bfcc2d52d5bc4f3f2dcb97558ad" prefix=" " category="inline-code"></block> 營運。</block>
  <block id="76ff543de72e62217293a1d0ceade0aa" category="paragraph">在新環境中也需要一個參數檔。最簡單的方法是從目前的 spfile 或 pfile 建立 pfile 。在此範例中、來源資料庫使用 spfile 。</block>
  <block id="d28f3a5b77909b45c50e6c711bef8b60" category="section-title">ASM 檔案重新命名指令碼</block>
  <block id="c242730c760d895368557f78141ff8b1" category="paragraph">移動資料庫時、控制檔中目前定義的數個檔案位置會變更。下列指令碼會建立 RMAN 指令碼、以簡化程序。此範例顯示的資料庫資料檔案數量極少、但資料庫通常包含數百個甚至數千個資料檔案。</block>
  <block id="359b84bcf7447a77b212e844aeaa9d89" category="inline-link-macro">ASM 至檔案系統名稱轉換</block>
  <block id="374a1a0facd7c604ac09ed0dca6efb3e" category="paragraph">此指令碼位於 <block ref="288325982fd7bee6cf9eb66ad33f6f7a" category="inline-link-macro-rx"></block> 它有兩件事。</block>
  <block id="42787fdca1cf792241ce03151ec7dbd3" category="paragraph">首先、它會建立一個參數、重新定義稱為的重做記錄位置<block ref="0f2d7ef9b967c2d9fb1ad5aa5e9eb688" prefix=" " category="inline-code"></block>。基本上是交替欄位清單。第一個欄位是目前重做記錄檔的位置、第二個欄位是新伺服器上的位置。然後重複該模式。</block>
  <block id="cf444fd96c87609516f0ad8212f41b01" category="paragraph">第二個功能是提供資料檔案重新命名的範本。指令碼會循環瀏覽資料檔案、擷取名稱和檔案編號資訊、並將其格式化為 RMAN 指令碼。然後、它會對暫存檔案執行相同的操作。結果是一個簡單的 RMAN 指令碼、可視需要加以編輯、以確保檔案還原至所需的位置。</block>
  <block id="50614366822786a4f2ee3a5065543634" category="paragraph">擷取此畫面的輸出。。<block ref="0f2d7ef9b967c2d9fb1ad5aa5e9eb688" prefix=" " category="inline-code"></block> 參數會如下所述放置在 pfile 中。RMAN 資料檔案重新命名和重複指令碼必須據此編輯、才能將資料檔案放置在所需的位置。在此範例中、所有的項目都放在中<block ref="36c3572e381980ee1f1343988ae4a955" prefix=" " category="inline-code"></block>。</block>
  <block id="e60cd818b9f7ae02a73d8b3a6ea0a809" category="paragraph">指令碼幾乎可以執行、但首先必須有目錄結構。如果所需目錄尚未存在、則必須建立這些目錄、否則資料庫啟動程序會失敗。以下範例反映最低需求。</block>
  <block id="2f2eed2ed14ba876a017aa9ea9515724" category="paragraph">下列命令是 oraenv 等公用程式正常運作所需的命令。</block>
  <block id="f34a9f7c077457a54f8838b55b9fc025" category="section-title">參數更新</block>
  <block id="fd5c3a935e7374f8b1577e73e85ef375" category="paragraph">必須更新儲存的 pfile 、以反映新伺服器上的任何路徑變更。資料檔案路徑變更是由 RMAN 複製指令碼所變更、幾乎所有資料庫都需要變更<block ref="d98137bd230dac4372cf20a2e7839463" prefix=" " category="inline-code"></block> 和<block ref="2d205df7ae2efff1576140524b40b93c" prefix=" " category="inline-code"></block> 參數。也可能有必須變更的稽核檔案位置和參數、例如<block ref="40f8833ae28ec69bcc89eb0eba090fe4" prefix=" " category="inline-code"></block> 在 ASM 之外可能無關緊要。經驗豐富的 DBA 應仔細審查建議的變更、然後再繼續。</block>
  <block id="b581dd429e9b4c24127b8940ca8e4346" category="paragraph">在此範例中、主要變更為控制檔位置、記錄歸檔目的地、以及新增<block ref="0f2d7ef9b967c2d9fb1ad5aa5e9eb688" prefix=" " category="inline-code"></block> 參數。</block>
  <block id="bbba1f65801697ba3abd94d90c83ba71" category="paragraph">確認新參數之後、必須使參數生效。存在多個選項、但大多數客戶會根據文字 pfile 建立 spfile 。</block>
  <block id="3a17a12678d74dabb1032aaf373166d8" category="section-title">啟動 nomount</block>
  <block id="a9dc570a0b3161e69edc31f3545cbf22" category="paragraph">複寫資料庫之前的最後一個步驟是啟動資料庫程序、但不要掛載檔案。在此步驟中、 spfile 可能會出現問題。如果是<block ref="357eedab214bb515c5622e275bc19cdb" prefix=" " category="inline-code"></block> 命令因參數錯誤而失敗、關機很簡單、請修正 pfile 範本、將其重新載入為 spfile 、然後再試一次。</block>
  <block id="0257eff4bf9bf0cb483f2544fd42f109" category="section-title">複製資料庫</block>
  <block id="4632b675c558eda129fe6da4fbbae2b2" category="paragraph">將先前的 RMAN 備份還原至新位置、比此程序中的其他步驟花費更多時間。必須複製資料庫、而不需變更資料庫 ID （ DBID ）或重新設定記錄。這可防止套用記錄、這是完全同步複本的必要步驟。</block>
  <block id="06206ea0cdea741420d9f7619503db89" category="paragraph">使用 RMAN AS aux 連線至資料庫、並使用在前一個步驟中建立的指令碼發出重複資料庫命令。</block>
  <block id="5ae45dfed3c4aff7fe4fd6a7e3606cb0" category="paragraph">您現在必須將變更從來源資料庫傳送至新位置。這樣做可能需要多個步驟的組合。最簡單的方法是讓來源資料庫上的 RMAN 將歸檔記錄寫入共用網路連線。如果無法使用共用位置、則另一種方法是使用 RMAN 寫入本機檔案系統、然後使用 rcp 或 rsync 複製檔案。</block>
  <block id="e355807335e5f05930a748afe1c3b23d" category="paragraph">在此範例中<block ref="45987b06d5eae35fc3e3487749a9ba27" prefix=" " category="inline-code"></block> 目錄是一種 NFS 共用、可同時用於原始和移轉的資料庫。</block>
  <block id="49fffa356bcd041918ce24ef714f3f72" category="paragraph">此處的一個重要問題是<block ref="6761e3b36547cd115b3966fcbc7192b2" prefix=" " category="inline-code"></block> 條款。備份的磁碟格式為<block ref="9ae0f22d9fa2eac270499e74092af364" prefix=" " category="inline-code"></block>，這表示您必須使用資料庫的執行緒編號、序號和啟動 ID 格式。雖然字母不同、但這與相符<block ref="03e92f2c3a8cae5315f0e42bf6acf436" prefix=" " category="inline-code"></block> pfile 中的參數。此參數也會以執行緒編號、序號和啟動 ID 的格式來指定封存記錄。最終結果是來源上的記錄檔備份使用資料庫預期的命名慣例。如此一來、就能執行像這樣的作業<block ref="81168dbef15af03d02c51a7447378e76" prefix=" " category="inline-code"></block> 更簡單、因為 sqlplus 能正確預測要重新播放的歸檔記錄名稱。</block>
  <block id="76d77393c7ffc6b0a0edd47ad09afe4d" category="paragraph">檔案在歸檔記錄位置後、可以發出命令來重新播放<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block> 接著是回應<block ref="e1f2d5134ed2543d38a0de9751cf75d9" prefix=" " category="inline-code"></block> 自動重播所有可用的記錄。參數檔目前正在將歸檔記錄導向<block ref="e421a42fc6f604fcc78707336ed222b9" prefix=" " category="inline-code"></block>但這與 RMAN 用於保存日誌的位置不匹配。在恢復資料庫之前、可依下列方式暫時重新導向位置。</block>
  <block id="0a96a4559ad3ab8c616a12a207e8daca" category="paragraph">最終的歸檔記錄回覆會回報錯誤、但這是正常現象。此錯誤表示 sqlplus 正在尋找特定的記錄檔、但找不到該檔案。原因很可能是記錄檔尚未存在。</block>
  <block id="e2a234d3299b9e66f0756db00c9ee8c7" category="paragraph">在大多數情況下、移轉作業不會立即執行。移轉程序可能在幾天甚至幾週前完成、這表示記錄必須持續運送至複本資料庫並重新執行。這樣做可確保轉換程序到達時、必須傳輸和重播最少的資料。</block>
  <block id="247e1695519da78866726a4dcb2c5252" category="paragraph">此程序很容易撰寫指令碼。例如、您可以在原始資料庫上排程下列命令、以確保用於記錄傳送的位置持續更新。</block>
  <block id="3ce19ecb7c874f75b9a46e29abe2012e" category="inline-link-macro">重播待命資料庫上的記錄</block>
  <block id="469d3082a0f3ad08223ba8fe69bf9311" category="paragraph">在收到記錄之後、必須重新播放記錄。先前的範例顯示使用 sqlplus 來手動執行<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block>可輕鬆自動化。此處顯示的範例使用中所述的指令碼 <block ref="7c7730292e0135c86626e1771f7f02ec" category="inline-link-macro-rx"></block>。指令碼會接受一個引數、指定需要重新執行作業的資料庫。此程序允許在多資料庫移轉工作中使用相同的指令碼。</block>
  <block id="15d3442f7626bb62f4b255c7ed5c5098" category="paragraph">準備好切換至新環境時、您必須執行最後一次同步。使用一般檔案系統時、由於原始的重作記錄會複製並重新播放、因此很容易確保移轉的資料庫與原始資料庫 100% 同步。使用 ASM 執行此作業的方法並不理想。只有歸檔日誌可以輕鬆地重新記錄。為了確保不會遺失任何資料、必須謹慎執行原始資料庫的最終關機。</block>
  <block id="f9952f2469fbec5fc9dca180322ff9ee" category="list-text">首先、必須將資料庫暫時禁用、確保不會進行任何變更。這種停止可能包括停用排程作業、關閉接聽程式及 / 或關閉應用程式。</block>
  <block id="58fd1c52efcde7151ac264a8f67b14ff" category="list-text">執行此步驟後、大多數 DBA 會建立一個虛擬表格、做為關機的標記。</block>
  <block id="442da9ab2cced82a6cbdd112be285bcf" category="list-text">強制記錄歸檔、以確保在歸檔記錄檔中記錄建立虛擬表格。若要這麼做、請執行下列命令：</block>
  <block id="83fce8a41250d6af49205f9659468351" category="list-text">若要複製最後一個歸檔記錄檔、請執行下列命令。資料庫必須可用、但不可開啟。</block>
  <block id="1b0e887c1394d4617c2a5243da19e44e" category="list-text">若要複製歸檔記錄檔、請執行下列命令：</block>
  <block id="86a7e05acb17098c514dd570b9220302" category="list-text">最後、在新伺服器上重播剩餘的歸檔記錄。</block>
  <block id="a430882deb5403e7b4b8061dec17cc80" category="list-text">在此階段、複寫所有資料。資料庫已準備好從待命資料庫轉換為作用中的作業資料庫、然後開啟。</block>
  <block id="077c7bcbf9a94bb62aecadc85045886e" category="list-text">確認虛擬表格是否存在、然後將其丟棄。</block>
  <block id="6130a27b8ec8ccf18e06bb3389b0fbbd" category="section-title">不中斷的重作記錄移轉</block>
  <block id="26c294f993888218237d5f9306bfcfc4" category="paragraph">有時資料庫會在整體上正確組織、但重做記錄除外。這可能是因為許多原因、其中最常見的原因與快照有關。SnapManager for Oracle 、 SnapCenter 和 NetApp Snap Creator 儲存管理架構等產品可讓您近乎即時地恢復資料庫、但前提是您必須還原資料檔案磁碟區的狀態。如果重做記錄檔與資料檔案共用空間、則無法安全執行還原、因為還原會導致重做記錄檔毀損、這可能表示資料遺失。因此、重做記錄必須重新定位。</block>
  <block id="2c56f5081b94b926c93c40f4c935a44a" category="paragraph">此程序很簡單、可在不中斷營運的情況下執行。</block>
  <block id="2986f9fe7ed4aab5aaa64c2ee9fe4841" category="section-title">目前的重做記錄組態</block>
  <block id="dd786d22c88a5f1fe0c10cfec58c1b44" category="list-text">識別重做記錄群組的數目及其各自的群組編號。</block>
  <block id="3cd0f7a32a4f5ee026702f8125f3dda7" category="list-text">輸入重做記錄檔的大小。</block>
  <block id="7c2f6ada37d59f2be0bc1a3ead80f77c" category="section-title">建立新記錄</block>
  <block id="106b215e5d87fb1256e47932f2ebf9cf" category="list-text">針對每個重做記錄、建立一個大小和成員數目相符的新群組。</block>
  <block id="0851b65f20b98420968e488fc3c0085e" category="list-text">驗證新組態。</block>
  <block id="cbccec9e0905e0b7f5cd630a3fa12f64" category="section-title">刪除舊記錄</block>
  <block id="00f63618719701ddae7fc2ff1d406ec2" category="list-text">刪除舊記錄（群組 1 、 2 和 3 ）。</block>
  <block id="f00c8361a8acc818247282bb6420a8c1" category="list-text">如果您遇到錯誤、導致無法刪除作用中記錄、請強制切換至下一個記錄檔、以釋放鎖定並強制建立全域檢查點。請參閱下列此程序範例。由於此記錄檔中仍有作用中的資料、因此拒絕嘗試丟棄位於舊位置的記錄檔群組 2 。</block>
  <block id="5d49a93437a42d2926c8be7eb3c7a56f" category="list-text">記錄歸檔之後再加上檢查點、可讓您捨棄記錄檔。</block>
  <block id="e3898c187d7edf64fc8e4d4e409fd244" category="list-text">然後從檔案系統刪除記錄。您應該非常小心地執行此程序。</block>
  <block id="eb290dfcb2d35cffcb49a22fd05168b5" category="summary">Oracle 移轉規劃</block>
  <block id="dacc2a633e9981c9f91e43ac6b59e889" category="paragraph">Oracle 資料移轉可在下列三個層級中進行：資料庫、主機或儲存陣列。</block>
  <block id="5153193d50d4c628312db2d5bc0132ed" category="paragraph">不同之處在於整體解決方案的哪個元件負責移動資料：資料庫、主機作業系統或儲存系統。</block>
  <block id="cc3e73ae592a355b9beb405232d08fe2" category="paragraph">下圖顯示移轉層級和資料流的範例。在資料庫層級移轉的情況下、資料會從原始儲存系統透過主機和資料庫層移至新環境。主機層級移轉類似、但資料不會通過應用程式層、而是使用主機程序寫入新位置。最後、隨著儲存層級移轉、 NetApp FAS 系統等陣列也會負責資料移動。</block>
  <block id="204415652114bfb773b51cd76c8c692e" category="paragraph"><block ref="204415652114bfb773b51cd76c8c692e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b059e0e23ffaa8fbd97f681942ce0018" category="paragraph">資料庫層級移轉通常指透過待命資料庫傳送 Oracle 記錄以完成 Oracle 層級的移轉。主機層級的移轉是使用主機作業系統組態的原生功能來執行。此組態包括檔案複製作業、使用 CP 、 tar 和 Oracle Recovery Manager （ RMAN ）等命令、或使用邏輯 Volume Manager （ LVM ）來重新定位檔案系統的基礎位元組。Oracle 自動儲存管理（ ASM ）被歸類為主機層級功能、因為它的執行層級低於資料庫應用程式層級。ASM 取代主機上一般的邏輯磁碟區管理程式。最後、資料可以在儲存陣列層級上移轉、也就是在作業系統層級之下。</block>
  <block id="228d9e0418aa12bae73676a5743558db" category="section-title">規劃考量</block>
  <block id="ce7eea640cd6ee20e55cbe868f4026e9" category="paragraph">最佳移轉選項取決於多種因素、包括要移轉的環境規模、避免停機的需求、以及執行移轉所需的整體工作。大型資料庫顯然需要更多時間和精力來進行移轉、但這類移轉的複雜度極低。小型資料庫可以快速移轉、但如果要移轉數千個資料庫、則工作規模可能會造成複雜問題。最後、資料庫越大、業務關鍵的可能性就越大、因此需要將停機時間降至最低、同時保留一條後端路徑。</block>
  <block id="d4b9b19593598d98059aae44d6a7bbe1" category="paragraph">此處將討論規劃移轉策略的一些考量事項。</block>
  <block id="931c6f2c99380fbd899e3eaa31e97d98" category="section-title">資料大小</block>
  <block id="64e4d570abeebacf6bdcb19dfb73fcae" category="paragraph">要移轉的資料庫大小顯然會影響移轉規劃、但大小不一定會影響轉換時間。當必須移轉大量資料時、主要考量的是頻寬。複製作業通常是以高效率的連續 I/O 來執行保守估計、假設複製作業的可用網路頻寬使用率為 50% 。例如、 8GB FC 連接埠理論上可傳輸約 800MBps 。假設使用率為 50% 、則資料庫的複製速度約為 400Mbps 。因此、 10TB 資料庫可在此速率下在大約七小時內複製。</block>
  <block id="84a80a048e7abc027dd6bdce55fda9d2" category="inline-link-macro">線上資料檔案移動</block>
  <block id="1c169b76761527b28040655a783e50a2" category="section-title">資料庫計數</block>
  <block id="da3770c5d6d1215e9f2524b9d7b7c3c5" category="paragraph">在許多情況下、移動大量資料的問題並不是資料大小、而是支援資料庫的組態複雜度。只要知道必須移轉 50TB 的資料庫、就無法獲得足夠的資訊。它可以是單一 50TB 關鍵任務資料庫、 4 、 000 個舊資料庫的集合、或是正式作業和非正式作業資料的混合。在某些情況下、大部分資料是由來源資料庫的複本所組成。這些複本完全不需要移轉、因為它們可以輕鬆地重新建立、特別是當新架構設計為使用 NetApp FlexClone Volume 時。</block>
  <block id="a1739e745a7544d2432b2b990a715817" category="paragraph">在移轉規劃方面、您必須瞭解範圍內有多少資料庫、以及它們的優先順序。隨著資料庫數量的增加、偏好的移轉選項在堆疊中會較低和較低。例如、在 RMAN 和短暫停機的情況下、複製單一資料庫可能很容易。這是主機層級的複寫。</block>
  <block id="284723d6a05b50ace5e5b96c761d03ac" category="paragraph">如果有 50 個資料庫、可能會更容易避免設定新的檔案系統結構來接收 RMAN 複本、而改為將資料移到適當位置。此程序可透過利用主機型 LVM 移轉來將資料從舊 LUN 重新放置到新的 LUN 來完成。這樣做會將責任從資料庫管理員（ DBA ）團隊移轉至作業系統團隊、因此資料會以透明方式移轉至資料庫。檔案系統組態不變。</block>
  <block id="8e734da04d394519001f47f723341e9d" category="paragraph">最後、如果必須移轉 200 部伺服器上的 500 個資料庫、則可使用 ONTAP 外部 LUN 匯入（ FLI ）功能等儲存型選項來執行 LUN 的直接移轉。</block>
  <block id="39f43935349622951e0f392c83b6e736" category="section-title">重新架構需求</block>
  <block id="50f1558a3f9d47464b5d57f9d9d0f9d1" category="paragraph">一般而言、必須變更資料庫檔案配置才能運用新儲存陣列的功能、但情況並非總是如此。例如、 EF 系列 All Flash 陣列的功能主要是針對 SAN 效能和 SAN 可靠性。在大多數情況下、資料庫可以移轉至 EF 系列陣列、而無需特別考量資料配置。唯一的要求是高 IOPS 、低延遲和強大的可靠性。雖然 RAID 組態或動態磁碟集區等因素都有最佳實務做法、但 EF 系列專案很少需要對整體儲存架構進行任何重大變更、才能運用這些功能。</block>
  <block id="0e2c78f7e9948e19ccb1bf2e1b7f0faf" category="paragraph">相反地、移轉至 ONTAP 通常需要更多考量資料庫配置、以確保最終組態能提供最大價值。ONTAP 本身可為資料庫環境提供許多功能、即使沒有任何特定的架構工作也沒問題。最重要的是、當目前的硬體達到使用壽命時、它能夠不中斷地移轉至新的硬體。一般而言、移轉至 ONTAP 是您最後需要執行的移轉作業。隨後的硬體即會就地升級、資料也不會中斷營運地移轉至新媒體。</block>
  <block id="ad93bd21d59f2286385dc519fd7e39fb" category="paragraph">有了一些規劃、就能獲得更多效益。使用快照時最重要的考量事項。快照是執行近乎即時的備份、還原及複製作業的基礎。作為快照功能的範例、已知最大的用途是在 6 個控制器上的約 250 個 LUN 上執行單一資料庫 996TB 。此資料庫可在 2 分鐘內備份、 2 分鐘內還原、 15 分鐘內複製完成。其他優點包括：能夠在叢集內移動資料、以因應工作負載的變化、以及應用服務品質（ QoS ）控制來在多資料庫環境中提供良好且一致的效能。</block>
  <block id="6b48ce64da84423ce167ffb72f5f9a8b" category="inline-link-macro">Oracle 移轉程序概述</block>
  <block id="1311d3b592e4da5950e91965dac1d593" category="paragraph">QoS 控制、資料重新配置、快照和複製等技術幾乎可在任何組態中運作。不過、一般需要考慮一些方法才能最大化效益。在某些情況下、資料庫儲存配置可能需要變更設計、以最大化對新儲存陣列的投資。這類設計變更可能會影響移轉策略、因為主機型或儲存型移轉會複寫原始資料配置。完成移轉並提供針對 ONTAP 最佳化的資料配置、可能需要其他步驟。中所示的程序 <block ref="d4d5600aaaced44e203002ec1910822d" category="inline-link-macro-rx"></block> 稍後、我們將示範一些方法、讓您不只是移轉資料庫、還能以最少的心力將資料庫移轉至最佳的最終配置。</block>
  <block id="1fd9b0a8321228b5b8ad4be85e71cf64" category="section-title">轉換時間</block>
  <block id="95b9194d9f06f6f70febc87c071f3050" category="paragraph">應決定轉換期間允許的服務中斷上限。假設整個移轉程序會造成中斷、這是常見的錯誤。許多工作都可以在服務中斷開始之前完成、許多選項都能在不中斷或中斷的情況下完成移轉。即使無法避免中斷、您仍必須定義允許的服務中斷上限、因為轉換時間的持續時間因程序而異。</block>
  <block id="9cfeaf56d2fc41c2695a69adf260c3f8" category="section-title">回溯路徑</block>
  <block id="f493e16f7e2caba820eba88a1c5f82d8" category="paragraph">沒有移轉作業完全沒有風險。即使技術運作正常、使用者也永遠可能發生錯誤。與所選移轉路徑相關的風險、必須與移轉失敗的後果一併考量。例如、 Oracle ASM 的透明線上儲存移轉功能是其重要功能之一、這是最可靠的方法之一。然而、資料正以這種方法進行無法扭轉的複製。在 ASM 發生問題的極不可能發生的事件中、沒有簡單的回傳路徑。唯一的選項是還原原始環境、或使用 ASM 將移轉回復至原始 LUN 。如果系統能夠執行此類作業、則可在原始儲存系統上執行快照類型備份、將風險降至最低、但不會消除。</block>
  <block id="1886f1ab01daa4511ce537d1af675427" category="section-title">排練</block>
  <block id="dd5dac65febd7071311b1ae3be1eca90" category="paragraph">某些移轉程序必須在執行前經過完整驗證。移轉和排練轉換程序是關鍵任務資料庫的常見要求、移轉必須成功、停機時間必須降至最低。此外、使用者驗收測試通常是移轉後工作的一部分、只有在完成這些測試之後、才能將整個系統恢復正常運作。</block>
  <block id="7d06b32cdd06d27f7c62fb110d831e60" category="paragraph">如果需要排練、有幾項 ONTAP 功能可以讓流程更輕鬆。特別是、快照可以重設測試環境、並快速建立資料庫環境的多個具空間效益的複本。</block>
  <block id="440a667261bd94f099ef4dde5caf024f" category="summary">移轉個別的 Oracle 資料檔案</block>
  <block id="727bb4db430517995ca651c4f57b0c9f" category="doc">資料檔案移動</block>
  <block id="fade70b277397e039e100bf0faa98d8e" category="paragraph">單一命令即可移動個別的 Oracle 資料檔案。</block>
  <block id="50c3d56e93d52f122bab9de1f2b35780" category="paragraph">例如、下列命令會將資料檔案 IOPST.dbf 從檔案系統中移出<block ref="87941c54be03c9785752ea54ac9a2dd4" prefix=" " category="inline-code"></block> 至檔案系統<block ref="eff8b2f7c4da1cf002bdea257a43fd10" prefix=" " category="inline-code"></block>。</block>
  <block id="53784088a62519d581c3dac4640c41b5" category="paragraph">使用此方法移動資料檔案可能會很慢、但通常不應產生足夠的 I/O 、而會干擾日常資料庫工作負載。相反地、透過 ASM 重新平衡移轉可以更快執行、但卻會在資料移動時降低整體資料庫的速度。</block>
  <block id="f92065612dfd409585ca08d95cc7a4dc" category="paragraph">您可以建立測試資料檔、然後移動資料檔案、輕鬆測量移動資料檔案所需的時間。操作所耗用的時間會記錄在 v$ 工作階段資料中：</block>
  <block id="78fb69ccdf01155db62828d0bc182b84" category="paragraph">在此範例中、移動的檔案是 datafile 8 、大小為 21 GB 、需要約 6 分鐘才能移轉。所需時間顯然取決於儲存系統、儲存網路的功能、以及移轉時發生的整體資料庫活動。</block>
  <block id="593b763e01de37a327966ee1abb3f8a2" category="summary">使用主機端儲存堆疊進行 Oracle 移轉</block>
  <block id="174f3246d5f9cdf330404cb6158e67e2" category="doc">Oracle 主機資料複本</block>
  <block id="3dc2d5f8d7209bb75e8d67aed68bc5ed" category="paragraph">如同資料庫層級的移轉、主機層的移轉也提供儲存設備廠商的不受侷連的方法。</block>
  <block id="1686ceaaa0d8fb4f9a8adb5e717b029c" category="paragraph">換句話說、有時候「只複製檔案」是最佳選擇。</block>
  <block id="d5732a4ab4c633ceb871cebdbf9ae34f" category="paragraph">雖然這種低技術方法似乎過於基本、但它確實提供了顯著的效益、因為不需要特殊軟體、而且在程序期間、原始資料仍保持安全不變。主要的限制是檔案複製資料移轉是一項破壞性程序、因為必須在複製作業開始之前關閉資料庫。沒有適當的方法可以同步處理檔案中的變更、因此檔案必須在開始複製之前完全處於禁用狀態。</block>
  <block id="706e7514bb30a289d7ce786a1a5c2ca0" category="paragraph">如果複製作業所需的關機不理想、則下一個最佳的主機型選項是使用邏輯 Volume Manager （ LVM ）。包括 Oracle ASM 在內的許多 LVM 選項都具有類似的功能、但也有一些必須考量的限制。在大多數情況下、可在不中斷或停機的情況下完成移轉。</block>
  <block id="f58e97ac8406ca3e8f0bb7a019a81985" category="section-title">檔案系統複製到檔案系統</block>
  <block id="a08ab728e75c63a41ce7571cb781cda2" category="paragraph">不應低估簡單複製作業的效用。這項作業需要在複製程序期間停機、但這是一個非常可靠的程序、不需要操作系統、資料庫或儲存系統的專門知識。此外、它也非常安全、因為它不會影響原始資料。通常、系統管理員會將來源檔案系統變更為唯讀安裝、然後重新啟動伺服器、以保證沒有任何東西會損壞目前的資料。複製程序可以撰寫指令碼、確保能以最快的速度執行、而不會發生使用者錯誤的風險。由於 I/O 類型是簡單的資料循序傳輸、因此具有極高的頻寬效率。</block>
  <block id="ba0bd93801872993ce832352dd03b56a" category="paragraph">下列範例示範安全快速移轉的一個選項。</block>
  <block id="d8cb8bcd239bbe7a2a488c1d68dbe420" category="paragraph">要移轉的環境如下：</block>
  <block id="3ffbdefc66ad1d1e707c1d6820afbdc0" category="list-text">目前的檔案系統</block>
  <block id="bdc9e98c6b17bb14a7bce916054413ba" category="list-text">新檔案系統</block>
  <block id="3b878279a04dc47d60932cb294d96259" category="section-title">總覽</block>
  <block id="e76912cd513cc8cbcabc2735b524e814" category="paragraph">資料庫可由 DBA 移轉、只需關閉資料庫並複製檔案即可、但如果必須移轉許多資料庫、或是將停機時間降至最低、則此程序很容易撰寫指令碼。使用指令碼也能降低使用者錯誤的機率。</block>
  <block id="d21aae9692f3b1d4e53fd73131414b93" category="paragraph">所示範例指令碼可自動化下列作業：</block>
  <block id="66909ae9d06bad444f5a059b8ee2cd41" category="list-text">關閉資料庫</block>
  <block id="ae737f3f8c04ccbefa99b2bbf87dccc2" category="list-text">將現有檔案系統轉換為唯讀狀態</block>
  <block id="1dd90b7b28cbd03687df6538c66ff494" category="list-text">將所有資料從來源複製到目標檔案系統、以保留所有檔案權限</block>
  <block id="741341be7809d7f5765b2352e6ab0aab" category="list-text">卸載舊的和新的檔案系統</block>
  <block id="7465bc030ca3fe236bcf3ecdf8aaebe4" category="list-text">將新檔案系統重新掛載到與先前檔案系統相同的路徑</block>
  <block id="8c4271e6faf2cea4cfc8e5b7108d8ee9" category="section-title">程序</block>
  <block id="b273f8d4284bd1f58cfbafe8065af9fa" category="list-text">關閉資料庫。</block>
  <block id="67eadd4b70772835f318e6d3027e4308" category="inline-link-macro">將檔案系統轉換為唯讀</block>
  <block id="474aae6515223cc3ba71074c9d5abcae" category="list-text">將檔案系統轉換為唯讀。如所示、使用指令碼可以更快完成這項工作 <block ref="2d6e37849c641071fe1cf71ac348d28c" category="inline-link-macro-rx"></block>。</block>
  <block id="4879ec77723fce4974f8ae2a7f87121a" category="list-text">確認檔案系統現在為唯讀。</block>
  <block id="c91e7f5dba3c873d0978f4892bf8b3f2" category="list-text">將檔案系統內容與同步<block ref="89a4551b0f29c1a652648b1cb8747021" prefix=" " category="inline-code"></block> 命令。</block>
  <block id="91e702884985853b8a7091ed5f2beceb" category="inline-link-macro">取代檔案系統</block>
  <block id="ea27cab9fe7b891870e0ce59aa34e853" category="list-text">卸載舊檔案系統、並重新放置複製的資料。如所示、使用指令碼可以更快完成這項工作 <block ref="fa3b775593af4f3de8972aced258710d" category="inline-link-macro-rx"></block>。</block>
  <block id="5fe2431acb45422c46eadf66a93851af" category="list-text">確認新檔案系統已就位。</block>
  <block id="2d53403ab873059f92ad884eb271e8dc" category="list-text">啟動資料庫。</block>
  <block id="40351c33ab81b8b374a20fd292057481" category="section-title">全自動轉換</block>
  <block id="3f70361470a11fb351c83257cd7aa63e" category="paragraph">此範例指令碼接受資料庫 SID 的引數、後面接著通用分隔的檔案系統配對。如前所示、命令發出方式如下：</block>
  <block id="5cddd7b314b7ae819e2cfcac85021426" category="paragraph">執行時、範例指令碼會嘗試執行下列順序。如果在任何步驟中遇到錯誤、它都會終止：</block>
  <block id="43d4fce7952ee09c0c8df60a17f5ea56" category="list-text">將目前的檔案系統轉換為唯讀狀態。</block>
  <block id="9d53d62d1e6dc69460f47c83e6c1919d" category="list-text">使用每個以逗號分隔的檔案系統引數配對、並將第一個檔案系統同步到第二個檔案系統。</block>
  <block id="39ff0e6dfa9915344ec96f9e78a27267" category="list-text">卸除先前的檔案系統。</block>
  <block id="e220fa2a2806386a64e9860f27372e43" category="list-text">更新<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 檔案如下：</block>
  <block id="232c2c4ddd45fc028ae13b58251c5f7e" category="list-text">請在下列位置建立備份<block ref="9eb56e72a6bb8350a1453c2762d14178" prefix=" " category="inline-code"></block>。</block>
  <block id="d5082ae73767550813688202df21bc4d" category="list-text">註解先前和新檔案系統的先前項目。</block>
  <block id="b8793b424d1738f1e00e545379867b0d" category="list-text">為使用舊掛載點的新檔案系統建立新項目。</block>
  <block id="29478980f354caa483bc0cfb827c7251" category="list-text">掛載檔案系統。</block>
  <block id="a0ec0d8bede7d9d58172084de7d5ce53" category="paragraph">下列文字提供此指令碼的執行範例：</block>
  <block id="350265a378d2cb1183cd51d56f0e5843" category="section-title">Oracle ASM spfile 和 passwd 移轉</block>
  <block id="f37bc722651f2fd86ba4da87f947c4db" category="paragraph">在完成涉及 ASM 的移轉時、有一個困難是 ASM 專屬的 spfile 和密碼檔案。根據預設、這些關鍵中繼資料檔案會建立在定義的第一個 ASM 磁碟群組上。如果必須撤出和移除特定的 ASM 磁碟群組、則必須重新放置管理該 ASM 執行個體的 spfile 和密碼檔案。</block>
  <block id="88e2a97e52f9854b59ce63e74c4b0cac" category="paragraph">另一個需要重新放置這些檔案的使用案例是在部署資料庫管理軟體時、例如 SnapManager for Oracle 或 SnapCenter Oracle 外掛程式。這些產品的其中一項功能是透過還原代管資料檔案的 ASM LUN 狀態、快速還原資料庫。這樣做需要在執行還原之前將 ASM 磁碟群組離線。只要指定資料庫的資料檔案隔離在專用的 ASM 磁碟群組中、這不是問題。</block>
  <block id="24de04443b6bdae76336fcab04ae946c" category="paragraph">當該磁碟群組也包含 ASM spfile/passwd 檔案時、唯一可以將磁碟群組離線的方法是關閉整個 ASM 執行個體。這是一項破壞性程序、也就是說、 spfile/passwd 檔案必須重新放置。</block>
  <block id="a6221bf4332cc966c69066295a843480" category="list-text">資料庫 SID = Toast</block>
  <block id="0af0da2831407b8130e7f2fabdfab87d" category="list-text">目前的資料檔案位於<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block></block>
  <block id="24aa2824a0b52b46b301afdb3af9336f" category="list-text">上目前的記錄檔和控制檔<block ref="ad6062251d172504e3b3bed3a8256a5a" prefix=" " category="inline-code"></block></block>
  <block id="bb6de9ea84381f7d01fdd038f104e4ae" category="list-text">建立為的新 ASM 磁碟群組<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block> 和<block ref="5e20ccf28224fc0cc564f9825c208dbd" prefix=" " category="inline-code"></block></block>
  <block id="8b14bd9d310bf8b211c19645576201e3" category="section-title">ASM spfile/passwd 檔案位置</block>
  <block id="7c7d8dd5d09a73f06678562b66dcdc68" category="paragraph">您可以不中斷地重新放置這些檔案。不過、為了安全起見、 NetApp 建議您關閉資料庫環境、以便確定檔案已重新放置、且組態已正確更新。如果伺服器上有多個 ASM 執行個體、則必須重複此程序。</block>
  <block id="3666b74ddcf77306328ac5d6db94fecd" category="section-title">識別 ASM 執行個體</block>
  <block id="9d19a85576af8e1b3dbd78e343a2b022" category="paragraph">根據中記錄的資料來識別 ASM 執行個體<block ref="9da4474b569071bcb2ece1d0bdfe7560" prefix=" " category="inline-code"></block> 檔案：ASM 執行個體以 + 符號表示。</block>
  <block id="3fe2dd8cf6f82ac15544fd96f9b59b28" category="paragraph">此伺服器上有一個稱為 +ASM 的 ASM 執行個體。</block>
  <block id="35a557b0490d5a93931025eaaf712cac" category="section-title">確定所有資料庫都已關閉</block>
  <block id="e6b0819ae1eca7d408a097efc2fbf2cf" category="paragraph">唯一可見的 SMON 程序應該是使用中 ASM 執行個體的 SMON 。另一個 SMON 程序的存在表示資料庫仍在執行中。</block>
  <block id="97639c779a60f010af01997e2363f4eb" category="paragraph">唯一的 SMON 程序是 ASM 執行個體本身。這表示沒有其他資料庫正在執行中、而且在不中斷資料庫作業的風險下繼續作業是安全的。</block>
  <block id="a8d157790e55d19378ddbbdfeb675ef8" category="section-title">尋找檔案</block>
  <block id="12d8c982eb4072e31ac4bfe375193160" category="paragraph">使用識別 ASM spfile 和密碼檔案的目前位置<block ref="e258dbf5114b4df07f0d9e72deb386f2" prefix=" " category="inline-code"></block> 和<block ref="bb41cdf6c9bb75ee17856f938070f23d" prefix=" " category="inline-code"></block> 命令。</block>
  <block id="bebe64e9d0d4ae3d44b4dfb3583e0109" category="paragraph">這些檔案都位於的基礎上<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 磁碟群組。</block>
  <block id="558f28628ba8ab4cb8420949524832d3" category="section-title">複製檔案</block>
  <block id="c0c2c850cb11c5bb52abbd55a9578e54" category="paragraph">使用將檔案複製到新的 ASM 磁碟群組<block ref="c0baea639672c84505e661b9e369c68a" prefix=" " category="inline-code"></block> 和<block ref="c7adee97d05083a7b65e4b6953045177" prefix=" " category="inline-code"></block> 命令。如果新磁碟群組是最近建立的、而且目前是空的、則可能需要先掛載。</block>
  <block id="3ed2faf3e1299edd7d92d6c4064f1579" category="paragraph">檔案現已從複製<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 至<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block>。</block>
  <block id="1dba5fc559232a8dae45d9f88ed36030" category="section-title">更新 ASM 執行個體</block>
  <block id="1fe2cc6cf436a4bcc6bdc41f947a416a" category="paragraph">現在必須更新 ASM 執行個體、以反映位置變更。。<block ref="c8b1affa9ec15d0c0e79347905e75d3e" prefix=" " category="inline-code"></block> 和<block ref="73fb08020d8535b4123a8968c596038c" prefix=" " category="inline-code"></block> 命令會更新啟動 ASM 磁碟群組所需的 ASM 中繼資料。</block>
  <block id="626759f91a0458b0c068cce8a05a6468" category="section-title">使用更新的檔案啟動 ASM</block>
  <block id="69f08287c6faa04381e5a05f4087abe1" category="paragraph">此時、 ASM 執行個體仍會使用這些檔案的先前位置。必須重新啟動執行個體、以強制重新讀取新位置的檔案、並釋放先前檔案上的鎖定。</block>
  <block id="5505cf0c514193b89221f1cef3004c58" category="section-title">移除舊的 spfile 和密碼檔案</block>
  <block id="8f2d3ac58be7a91f51d7ce9ffa04e397" category="paragraph">如果程序已成功執行、先前的檔案將不再鎖定、現在可以移除。</block>
  <block id="cfca2b2eb0d694e70904ec82f5d1c34e" category="section-title">Oracle ASM 至 ASM 複本</block>
  <block id="12632d520b8d9518b5622ac00dc764a8" category="paragraph">Oracle ASM 本質上是輕量的組合 Volume Manager 和檔案系統。由於檔案系統並不容易看到、因此 RMAN 必須用於執行複製作業。雖然複製型移轉程序既安全又簡單、但會造成部分中斷。可以將中斷降至最低、但不能完全消除。</block>
  <block id="152106ebb2aaa94cc87657d353331189" category="paragraph">如果您想要不中斷地移轉 ASM 型資料庫、最好的方法是利用 ASM 的功能、在移轉舊 LUN 的同時、重新平衡 ASM 擴充至新 LUN 的平衡。這樣做通常是安全且不中斷營運的、但它不提供回溯路徑。如果遇到功能或效能問題、唯一的選項是將資料移回來源。</block>
  <block id="81fe23a1ac3b2bb348e579b2c5b0f5d5" category="paragraph">您可以將資料庫複製到新位置而非移動資料、以避免此風險、避免原始資料受到影響。資料庫可以在新位置進行完整測試後再上線運作、如果發現問題、原始資料庫則可作為回復選項使用。</block>
  <block id="3028182db088e823770b3d02aa0eac9e" category="paragraph">此程序是 RMAN 的眾多選項之一。其設計允許建立初始備份的兩個步驟程序、然後透過記錄重播進行同步處理。這項程序最適合將停機時間降至最低、因為它可讓資料庫在初始基準複本期間維持運作並提供資料。</block>
  <block id="634f50a6c6f112c46150a301d749dbcb" category="section-title">複製資料庫</block>
  <block id="5f0bd85dd65afab1472713e8e034fff7" category="paragraph">Oracle RMAN 會建立目前位於 ASM 磁碟群組的來源資料庫層級 0 （完整）複本<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 移至新位置<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block>。</block>
  <block id="b51dc519efad4b151a05682b68f4b182" category="section-title">強制歸檔記錄切換</block>
  <block id="10793485747151dfa2eaddb0854c84b2" category="paragraph">您必須強制使用歸檔記錄切換、以確保歸檔記錄包含所有必要資料、使複本完全一致。如果沒有此命令、重做記錄檔中可能仍會有關鍵資料。</block>
  <block id="c55a88a6b8fdc5972d4e2a4924f93dbf" category="section-title">關閉來源資料庫</block>
  <block id="9ec82bff06c706f42a8170befdd6cf39" category="paragraph">由於資料庫已關機、並處於有限存取、唯讀模式、因此在此步驟中就會開始中斷。若要關閉來源資料庫、請執行下列命令：</block>
  <block id="6ecf02e1343e82cf0cd95d7303346ff1" category="section-title">控制檔備份</block>
  <block id="e7bc82f6d1381df55ace121dc02368e6" category="paragraph">您必須備份控制檔、以防您必須中止移轉並還原至原始儲存位置。備份控制檔的複本並非 100% 必要、但它確實讓將資料庫檔案位置重設回原始位置的程序變得更簡單。</block>
  <block id="4e7a51f2c1ee60c69cd719d415f5e87a" category="paragraph">目前的 spfile 包含對舊 ASM 磁碟群組內控制檔目前位置的參照。您必須編輯此檔案、只要編輯中繼 pfile 版本即可輕鬆完成。</block>
  <block id="253e30479f86461bc79f2fca58ee4cb1" category="section-title">更新 pfile</block>
  <block id="35db8a54b9c7581f0f77b059233cc61b" category="paragraph">更新任何參照舊 ASM 磁碟群組的參數、以反映新的 ASM 磁碟群組名稱。然後儲存更新的 pfile 。請確定<block ref="5fa1d01559c04dcdb3ba05775712b1ab" prefix=" " category="inline-code"></block> 有參數存在。</block>
  <block id="bb607fbd46f48c3a4080ecda83288b69" category="paragraph">在以下範例中、請參考<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 變更為<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block> 以黃色反白顯示。兩個主要參數是<block ref="5fa1d01559c04dcdb3ba05775712b1ab" prefix=" " category="inline-code"></block> 在正確位置建立任何新檔案的參數。</block>
  <block id="5275e85db4d606621d8f074e44b95748" category="section-title">更新 init.ora 檔案</block>
  <block id="17a2b5d1af48f7f8d1511d5372896f7a" category="paragraph">大多數以 ASM 為基礎的資料庫都使用<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 檔案位於<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> 目錄、指向 ASM 磁碟群組上的 spfile 。此檔案必須重新導向至新 ASM 磁碟群組上的位置。</block>
  <block id="6ad274256421918b584abff3b9446b09" category="paragraph">變更此檔案的方式如下：</block>
  <block id="b6638505615764c377e2cf2585993fd0" category="section-title">參數檔案重新建立</block>
  <block id="52b21c2e6103a3b8d888a4185e21a787" category="paragraph">spfile 現在已準備好由編輯的 pfile 中的資料填入。</block>
  <block id="37f4738eddd35e77d15af55a40e1ab1c" category="section-title">啟動資料庫以開始使用新的 spfile</block>
  <block id="79f8a930424fe3b21dc30a72791171d4" category="paragraph">啟動資料庫以確保它現在使用新建立的 spfile 、並正確記錄對系統參數的任何進一步變更。</block>
  <block id="231ef0ea12d142611eeea2fdfad67114" category="section-title">還原控制檔</block>
  <block id="33cdbbeabc7f2c647f20b3f8b924307f" category="paragraph">RMAN 所建立的備份控制檔也可直接還原至新 spfile 中指定的位置。</block>
  <block id="ce656b7f351ebdc7c599aff6a99e0f2a" category="paragraph">裝入資料庫並驗證新控制檔的使用。</block>
  <block id="fda1e79fe400519496075b7e2871092a" category="section-title">記錄重新播放</block>
  <block id="daaec4441f16b5bac11476d4582a296c" category="paragraph">資料庫目前使用舊位置的資料檔案。在使用複本之前、必須先進行同步處理。初始複製程序已經過時間、變更主要記錄在歸檔記錄中。這些變更會複寫如下：</block>
  <block id="fca6726270a94f51cab3142509d32919" category="list-text">執行包含歸檔記錄的 RMAN 遞增備份。</block>
  <block id="8b8a5667b011b5f37163ff4da1004343" category="list-text">重新播放記錄。</block>
  <block id="a9a62e70841c4d06dd16306a85700d36" category="section-title">啟動</block>
  <block id="8fecb0145484a35b1d9d5926c945ca30" category="paragraph">還原的控制檔仍會參照原始位置的資料檔案、也會包含複製資料檔案的路徑資訊。</block>
  <block id="f590db5fdc10f6942f7cd173c0bb578b" category="list-text">若要變更使用中的資料檔案、請執行<block ref="7705ebb59373d0b1dfc71d86ef726f93" prefix=" " category="inline-code"></block> 命令。</block>
  <block id="2c5c2b5174eafe321358329636e80f5e" category="paragraph">使用中的資料檔案現在是複製的資料檔案、但最終的重做記錄檔中可能仍有變更。</block>
  <block id="fe83c5826bec1aa20e26802fa94a4a0f" category="list-text">若要重播所有剩餘記錄、請執行<block ref="81168dbef15af03d02c51a7447378e76" prefix=" " category="inline-code"></block> 命令。如果出現此訊息<block ref="cef3519da39a73834e89a18ca91951f1" prefix=" " category="inline-code"></block> 出現時、程序成功。</block>
  <block id="15434ad90ad32205a804fe96f265b91d" category="paragraph">此程序只會變更一般資料檔案的位置。必須重新命名暫存資料檔案、但不需要複製、因為它們只是暫時性的。資料庫目前關閉、因此暫存資料檔案中沒有作用中的資料。</block>
  <block id="2a7c5560f8e4ad220c853666c46eb051" category="list-text">若要重新放置暫存資料檔案、請先識別其位置。</block>
  <block id="10b2632cf9c3bf6568b36f6a37e627c2" category="list-text">使用 RMAN 命令重新定位暫存資料檔案、為每個資料檔案設定新名稱。使用 Oracle 託管檔案（ OMF ）時、不需要完整名稱； ASM 磁碟群組已足夠。開啟資料庫時、 OMF 會連結至 ASM 磁碟群組上的適當位置。若要重新定位檔案、請執行下列命令：</block>
  <block id="2c592b1e2841899b280deafe27eeefbf" category="section-title">重做記錄移轉</block>
  <block id="3f53598059c3bf11ff505ad9dc0d6776" category="paragraph">移轉程序即將完成、但重做記錄仍位於原始 ASM 磁碟群組中。重作記錄無法直接重新定位。而是會建立新的重做記錄集、並將其新增至組態、然後刪除舊的記錄。</block>
  <block id="d54f1c98a924385411a8488657b21dad" category="list-text">針對每個重做記錄、建立具有相符組態的新群組。如果您未使用 OMF 、則必須指定完整路徑。這也是使用的範例<block ref="c9655c773db3ebd5871fbe76c0e38a52" prefix=" " category="inline-code"></block> 參數。如先前所示、此參數設為 +NEWLOGS 。此組態可讓您使用下列命令來建立新的線上記錄檔、而無需指定檔案位置、甚至是特定的 ASM 磁碟群組。</block>
  <block id="3e0c7c8ee841e9919343fe45e3e04f2d" category="list-text">開啟資料庫。</block>
  <block id="7e4b38db083a404d0d628bdb1ad83311" category="list-text">刪除舊記錄。</block>
  <block id="37e48dd687a01e58ed329feebebf3198" category="list-text">如果您遇到錯誤、導致無法刪除作用中記錄、請強制切換至下一個記錄檔、以釋放鎖定並強制建立全域檢查點。範例如下所示。嘗試丟棄位於舊位置的記錄檔群組 3 、因為此記錄檔中仍有作用中資料、因此遭到拒絕。檢查點之後的記錄封存可讓您刪除記錄檔。</block>
  <block id="79d08abfbe5fd73dc85c55cd20ad4974" category="list-text">檢閱環境、確定所有位置型參數都已更新。</block>
  <block id="799f5ce04f1d9cad4455676b2fd908d9" category="list-text">下列指令碼示範如何簡化此程序：</block>
  <block id="9867dfc0eee2725f24f86d8114c356a0" category="list-text">如果 ASM 磁碟群組已完全撤出、現在可以使用卸載<block ref="ae709dc3414219bf2c9c8abc9ff6c67a" prefix=" " category="inline-code"></block>。不過、在許多情況下、屬於其他資料庫或 ASM spfile/passwd 檔案的檔案可能仍存在。</block>
  <block id="49f8dc5754bd205ea0da17521cb89a1f" category="section-title">Oracle ASM 至檔案系統複本</block>
  <block id="0f5b1767a58e43cb548226e94441dc07" category="paragraph">Oracle ASM 至檔案系統複製程序與 ASM 至 ASM 複製程序非常類似、具有類似的優點和限制。主要差異在於使用可見檔案系統時、不同命令和組態參數的語法、而非使用 ASM 磁碟群組。</block>
  <block id="b533404c568b600f9fceddeac9253964" category="paragraph">Oracle RMAN 用於建立目前位於 ASM 磁碟群組的來源資料庫層級 0 （完整）複本<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 移至新位置<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block>。</block>
  <block id="f78b0ab71e2863c28dbe331056451135" category="paragraph">必須強制使用歸檔記錄交換器、才能確保歸檔記錄包含所有必要資料、使複本完全一致。如果沒有此命令、重做記錄檔中可能仍會有關鍵資料。若要強制使用歸檔記錄交換器、請執行下列命令：</block>
  <block id="c37c761fc28428b9ead4533aba9ee148" category="paragraph">由於資料庫已關機、並處於有限存取的唯讀模式、因此此步驟開始造成中斷。若要關閉來源資料庫、請執行下列命令：</block>
  <block id="3abd8870d8a333edcaec6a1082520c67" category="paragraph">備份控制檔、以防您必須中止移轉並還原至原始儲存位置。備份控制檔的複本並非 100% 必要、但它確實讓將資料庫檔案位置重設回原始位置的程序變得更簡單。</block>
  <block id="38825215f02e25ca63ff64387b01c1c2" category="paragraph">任何參照舊 ASM 磁碟群組的參數都應該更新、在某些情況下、當不再相關時、就會刪除。更新它們以反映新的檔案系統路徑、並儲存更新的 pfile 。請確定已列出完整的目標路徑。若要更新這些參數、請執行下列命令：</block>
  <block id="9d0dce3e570fa0ec18269ca508809401" category="section-title">停用原始的 init.ora 檔案</block>
  <block id="03dda6526778417460fd0bbb7716b373" category="paragraph">此檔案位於<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> 目錄和通常位於 pfile 中、作為指向 ASM 磁碟群組上 spfile 的指標。若要確定不再使用原始 spfile 、請重新命名。不過、請勿刪除它、因為如果必須中止移轉、就需要此檔案。</block>
  <block id="6087f741090627369fd114fbc794abc4" category="paragraph">這是重新定位 spfile 的最後一步。原始 spfile 不再使用、而且資料庫目前是使用中繼檔案啟動（但未掛載）。此檔案的內容可以寫入新的 spfile 位置、如下所示：</block>
  <block id="3f62847435205b7b2af1bd5aaf1d3277" category="paragraph">您必須啟動資料庫以釋放中繼檔案上的鎖定、並只使用新的 spfile 檔案來啟動資料庫。啟動資料庫也能證明新的 spfile 位置正確、而且其資料有效。</block>
  <block id="ea164abfd83078cd71a2f3ba5d237900" category="paragraph">已在路徑上建立備份控制檔<block ref="7a1a1280501cff0194d8ce6e351f2a2c" prefix=" " category="inline-code"></block> 請稍早在程序中進行。新的 spfile 將控制檔位置定義為 <block ref="b4d54c88ccade13a82dcaf8f7c07cac5" prefix="/" category="inline-code"></block> 和<block ref="cd300fb0386526438b368e7a6d1b8ace" prefix=" " category="inline-code"></block>。不過、這些檔案尚不存在。</block>
  <block id="f7ed72e578ca8d23dd45bfa2c0a61ed8" category="list-text">此命令會將控制檔資料還原至 spfile 中定義的路徑。</block>
  <block id="c947c89cb4c7a595782d0be73bbe8cfa" category="list-text">發出 mount 命令、以便正確探索控制檔並包含有效資料。</block>
  <block id="da4ae71a31a1286600968f8a340fddb2" category="paragraph">驗證<block ref="d98137bd230dac4372cf20a2e7839463" prefix=" " category="inline-code"></block> 參數、請執行下列命令：</block>
  <block id="c25a81770c591c46d6909aae84bf5814" category="paragraph">資料庫目前正在使用舊位置的資料檔案。在使用複本之前、必須先同步資料檔案。在初始複製程序期間已經過時間、變更主要記錄在歸檔記錄中。以下兩個步驟會複寫這些變更。</block>
  <block id="95ea23a5654037c0ab2a5418478d9da2" category="list-text">重播記錄。</block>
  <block id="e726fdb8508ef59abc6d8ef533186382" category="list-text">若要變更使用中的資料檔案、請執行<block ref="7705ebb59373d0b1dfc71d86ef726f93" prefix=" " category="inline-code"></block> 命令：</block>
  <block id="7fdba4cfea0e0d298cda23e7f46e40c4" category="list-text">雖然資料檔案應完全一致、但仍需最後一步才能重播線上重作記錄中記錄的其餘變更。使用<block ref="81168dbef15af03d02c51a7447378e76" prefix=" " category="inline-code"></block> 命令重播這些變更、並使複本 100% 與原始版本相同。不過、複本尚未開啟。</block>
  <block id="8eb94d53286760da56ca9c892a49cd8b" category="section-title">重新部署暫存資料檔案</block>
  <block id="a1e7f15bee0eaa976661307aa884fd99" category="list-text">識別仍在原始磁碟群組中使用的暫存資料檔案位置。</block>
  <block id="89b79c94ceba42d5bc646c1b4b1acd24" category="list-text">若要重新放置資料檔案、請執行下列命令。如果有許多 tempfiles 、請使用文字編輯器建立 RMAN 命令、然後剪下並貼上。</block>
  <block id="81aa65cb154a5f125bbf3ede064d4b3f" category="paragraph">移轉程序即將完成、但重做記錄仍位於原始 ASM 磁碟群組中。重作記錄無法直接重新定位。而是建立新的重做記錄集、並在刪除舊記錄之後新增至組態。</block>
  <block id="6e46687c6cc5deabe53fa42932683c4d" category="list-text">對於每個重做記錄、請使用與目前重做記錄群組相同的大小、使用新的檔案系統位置來建立新群組。</block>
  <block id="22fd48a866ce4d04edb57c15b2fad5da" category="list-text">移除仍位於先前儲存設備上的舊記錄檔群組。</block>
  <block id="94158400e59555bf69ecd550887bd9f6" category="list-text">如果遇到阻止刪除作用中記錄的錯誤、請強制切換至下一個記錄檔、以釋放鎖定並強制建立全域檢查點。範例如下所示。嘗試丟棄位於舊位置的記錄檔群組 3 、因為此記錄檔中仍有作用中資料、因此遭到拒絕。記錄歸檔之後再加上檢查點、即可刪除記錄檔。</block>
  <block id="326770a786c5933416b6a167c854e7b8" category="list-text">下列指令碼示範如何簡化此程序。</block>
  <block id="ffdcdc8ee9653232a906773fa11358fd" category="list-text">如果 ASM 磁碟群組已完全撤出、現在可以使用卸載<block ref="ae709dc3414219bf2c9c8abc9ff6c67a" prefix=" " category="inline-code"></block>。在許多情況下、屬於其他資料庫或 ASM spfile/passwd 檔案的檔案仍會存在。</block>
  <block id="3d8b8f4734039817e35d5fb6993c8d08" category="section-title">資料檔案清理程序</block>
  <block id="637607e2203ac522fc9dbc88deb6c36f" category="inline-link-macro">ASM 移轉清理</block>
  <block id="18325b8b206963bc1ae6cca25406f942" category="paragraph">根據 Oracle RMAN 的使用方式而定、移轉程序可能會導致資料檔案的語法較長或較隱密。在此所示範例中、備份是以的檔案格式執行<block ref="1da91ad80bcfeb818066022a42cde773" prefix=" " category="inline-code"></block>。<block ref="432459869b7d0085e120ec9454032267" prefix=" " category="inline-code"></block> 表示 RMAN 應為每個資料檔案建立預設的唯一名稱。結果與下列文字所示類似。資料檔案的傳統名稱會內嵌在名稱中。您可以使用中所示的指令碼方法來清除此問題 <block ref="bf0c2c579af181f7d1e4d0267c1385fe" category="inline-link-macro-rx"></block>。</block>
  <block id="5e8488a95f83d2789417a1f3298f2f31" category="section-title">Oracle ASM 重新平衡</block>
  <block id="2768938325db3a71a6713959a0f309d9" category="paragraph">如前所述、 Oracle ASM 磁碟群組可透過重新平衡程序、以透明方式移轉至新的儲存系統。總而言之、重新平衡程序需要在現有的 LUN 群組中新增大小相同的 LUN 、然後再中斷先前 LUN 的作業。Oracle ASM 會以最佳配置自動將基礎資料重新定位至新儲存設備、然後在完成時釋出舊的 LUN 。</block>
  <block id="24a638b29b3c55f26c731aa4b9943a52" category="paragraph">移轉程序使用高效率的循序 I/O 、通常不會造成任何效能中斷、但可視需要調整移轉率。</block>
  <block id="25d06b03dd002ad791b19500c58e9f72" category="section-title">識別要移轉的資料</block>
  <block id="3709d4034873467e8e6ae138da54a443" category="section-title">建立新的 LUN</block>
  <block id="32176bd565539329eafb96db9447e517" category="paragraph">建立大小相同的新 LUN 、並視需要設定使用者和群組成員資格。LUN 應顯示為<block ref="bea4821516973214973a70aea8337c38" prefix=" " category="inline-code"></block> 磁碟。</block>
  <block id="6e59535a7b8dd239c67b8d015618f5e1" category="section-title">新增 LUN</block>
  <block id="71f7e1ff1a6e075f8364d083f145b655" category="paragraph">雖然可以同時執行新增和刪除作業、但通常只需兩個步驟即可輕鬆新增 LUN 。首先、將新 LUN 新增至磁碟群組。此步驟會將一半的擴充從目前的 ASM LUN 移轉至新的 LUN 。</block>
  <block id="7989dfdf722e8bee00001dac817e4833" category="paragraph">重新平衡的力量代表資料傳輸的速度。資料傳輸的平行度越高、資料傳輸的數量就越多。執行移轉時、必須執行有效率的連續 I/O 作業、而這些作業不太可能造成效能問題。不過、若有需要、可利用調整進行中移轉的重新平衡能力<block ref="e20ea7dfbbe351f6a5275d7adc71efbd" prefix=" " category="inline-code"></block> 命令。典型移轉使用 5 個值。</block>
  <block id="2b69f08c262a142b3fb0868f4d31ab4f" category="section-title">監控作業</block>
  <block id="a5097a0967c777285f74d63bf0cc26a1" category="paragraph">可透過多種方式監控和管理重新平衡作業。在此範例中、我們使用下列命令。</block>
  <block id="5d68829c11bdb5ae7a50b847bb126d44" category="paragraph">移轉完成時、不會回報任何重新平衡作業。</block>
  <block id="957310262614cddc1992368d2d0b14b3" category="section-title">丟棄舊的 LUN</block>
  <block id="260c16583c8eb689202ed5b4a44708b1" category="paragraph">移轉作業現在已完成一半。您可能需要執行一些基本效能測試、以確保環境健全。確認之後、可藉由丟棄舊的 LUN 來重新放置其餘的資料。請注意、這不會導致 LUN 立即發行。此中斷作業會先發出 Oracle ASM 重新定位延伸、然後再釋放 LUN 。</block>
  <block id="90423249814011b02ba06afd9fb2d617" category="paragraph">可透過多種方式監控和管理重新平衡作業。在此範例中、我們使用下列命令：</block>
  <block id="1544b3a52519b3856f1f7d1e704cb56f" category="section-title">移除舊的 LUN</block>
  <block id="983d704730b30910fc03d3ed444278f0" category="paragraph">從磁碟群組移除舊 LUN 之前、您應該先對標頭狀態執行一次最後檢查。從 ASM 發佈 LUN 後、它不再列出名稱、而且標頭狀態會列為<block ref="e2ffc99cf675f5f0f1a3456438551a9a" prefix=" " category="inline-code"></block>。這表示這些 LUN 可以安全地從系統中移除。</block>
  <block id="22a67c375eff91d37f2363ea69b0c41f" category="section-title">LVM 移轉</block>
  <block id="d52f83c78118c243801797ba9b795b72" category="paragraph">此處介紹的程序顯示了以 LVM 為基礎的磁碟區群組移轉原則、稱為<block ref="ec2db4422261eae02091227fb9e53c88" prefix=" " category="inline-code"></block>。這些範例來自 Linux LVM 、但這些原則同樣適用於 AIX 、 HP-UX 和 VxVM 。精確命令可能會有所不同。</block>
  <block id="64a375907ede7a86c9e8a1b4b142f22e" category="list-text">識別目前在中的 LUN<block ref="ec2db4422261eae02091227fb9e53c88" prefix=" " category="inline-code"></block> Volume 群組。</block>
  <block id="0ae75856dd12545cdd98b8cad5c12ad8" category="list-text">建立相同或稍大實體大小的新 LUN 、並將其定義為實體磁碟區。</block>
  <block id="2426fa707e9d362c711977b79acd65bb" category="list-text">將新的磁碟區新增至磁碟區群組。</block>
  <block id="02443ebd7f86c3a688a1e3466d3f106a" category="list-text">發行<block ref="8167c9a6bd495f7ed235364201039099" prefix=" " category="inline-code"></block> 命令將每個目前 LUN 的範圍重新放置到新 LUN 。。<block ref="1b464374742cfda0167b82bc6f9462f1" prefix=" " category="inline-code"></block> 引數會監控作業的進度。</block>
  <block id="ce4a174d56245f6ba5b8808527919921" category="list-text">完成此程序後、請使用從磁碟區群組中刪除舊的 LUN<block ref="3a4d1e7b0af1cf3d80e419c09d238535" prefix=" " category="inline-code"></block> 命令。如果成功、現在即可安全地從系統移除 LUN 。</block>
  <block id="599a80136f745b38f35077e1c7eb020e" category="summary">Oracle 移轉程序</block>
  <block id="329ffa7a9038afa62748f87628b749d5" category="paragraph">Oracle 移轉資料庫有許多可用的程序。正確的選擇取決於您的業務需求。</block>
  <block id="48a2d08de8943e7ca4718c02e6b791b6" category="paragraph">在許多情況下、系統管理員和 DBA 都有自己偏好的方法來重新定位實體磁碟區資料、鏡像和磁碟鏡射、或是利用 Oracle RMAN 來複製資料。</block>
  <block id="79d01f6e7efcfef7db530c0b3c5ea516" category="paragraph">這些程序主要是為不熟悉某些可用選項的 IT 人員提供指引。此外、這些程序還說明每種移轉方法的工作、時間需求和專長類別需求。如此一來、 NetApp 和合作夥伴專業服務或 IT 管理等其他方就能更充分瞭解每個程序的要求。</block>
  <block id="5604c71a7d9ae37df511cc85052c1894" category="paragraph">建立移轉策略沒有單一最佳實務做法。建立計畫需要先瞭解可用度選項、然後選擇最符合業務需求的方法。下圖說明客戶所做的基本考量和典型結論、但並不適用於所有情況。</block>
  <block id="fa2e72668f7d48694bef3ba5474e3967" category="paragraph">例如、一個步驟會引發資料庫總大小的問題。下一步取決於資料庫是否大於或小於 1TB 。建議的步驟就是根據一般客戶實務做法提出建議。大多數客戶不會使用 DataGuard 複製小型資料庫、但有些客戶可能會使用。大多數客戶不會因為所需時間而嘗試複製 50TB 資料庫、但有些客戶可能會有足夠大的維護時間來允許這類作業。</block>
  <block id="82f59f5f005a6ea06f0466a4ffc18b6c" category="paragraph">您可以找到最適合移轉路徑的考量類型流程圖 <block ref="d197151b12289ca0258c12e9b0e8fb1c" category="inline-link-macro-rx"></block>。</block>
  <block id="e38af1623479eee6cfe1782df43819d3" category="paragraph">Oracle 12cR1 及更高版本可在資料庫保持連線時移動資料檔案。此外、它還能在不同的檔案系統類型之間運作。例如、資料檔案可從 xfs 檔案系統重新定位至 ASM 。由於需要個別資料檔案移動作業的數量、因此通常不會大規模使用此方法、但這是一個值得考慮的選項、因為較小的資料庫資料檔案數量較少。</block>
  <block id="5972a038819f045814401b2baea9ee09" category="paragraph">此外、單純移動資料檔案是移轉部分現有資料庫的好選項。例如、較不活躍的資料檔案可重新放置到更具成本效益的儲存設備、例如可在物件儲存區中儲存閒置區塊的 FabricPool Volume 。</block>
  <block id="fcdd0d9eae6df775f1bdc52f950a0160" category="section-title">資料庫層級移轉</block>
  <block id="2b619622b2b8505c335acc8be3a2c3fd" category="paragraph">資料庫層級的移轉意味著允許資料庫重新配置資料。具體而言、這表示記錄傳送。RMAN 和 ASM 等技術是 Oracle 產品、但為了進行移轉、它們會在主機層級運作、在主機層級複製檔案和管理磁碟區。</block>
  <block id="1048000638cc5357b8b2b36ab55cbc5a" category="section-title">記錄傳送</block>
  <block id="36f7294e33f88b462199b92362434684" category="paragraph">資料庫層級移轉的基礎是 Oracle 歸檔記錄檔、其中包含資料庫變更的記錄檔。歸檔記錄通常是備份與還原策略的一部分。恢復程序從還原資料庫開始、然後重新播放一或多個歸檔記錄檔、將資料庫恢復到所需的狀態。這項相同的基本技術可用於執行移轉、幾乎不會中斷營運。更重要的是、這項技術可在不影響原始資料庫的情況下進行移轉、並保留一條向外移轉的路徑。</block>
  <block id="d43de5ded302797939b76670bc488b51" category="paragraph">移轉程序從將資料庫備份還原至次要伺服器開始。您可以透過多種方式進行、但大多數客戶都會使用正常的備份應用程式來還原資料檔案。資料檔案還原後、使用者便可建立記錄傳送方法。目標是建立由主要資料庫所產生的持續歸檔記錄摘要、並在還原的資料庫上重新播放、使兩者都接近相同的狀態。轉換時間到達時、來源資料庫會完全關閉、最後的歸檔記錄會複製並重新播放、有時則會複製重做記錄。重做記錄也必須列入考量、因為它們可能包含已提交的部分最終交易。</block>
  <block id="f6fc42763ddbd981d5803ee6676dc7c3" category="paragraph">在傳輸和重播這些記錄之後、兩個資料庫彼此之間的一致性。此時、大多數客戶都會執行一些基本測試。如果在移轉過程中發生任何錯誤、則記錄重新執行應會報告錯誤並失敗。還是建議您根據已知的查詢或應用程式導向的活動來執行一些快速測試、以驗證組態是否最佳化。在關閉原始資料庫之前建立一個最終測試表格、以確認該表格是否存在於移轉的資料庫中、這也是常見的做法。此步驟可確保在最終記錄同步期間不會發生任何錯誤。</block>
  <block id="d8e9d23b4beb4db3da15d77542782747" category="paragraph">簡單的記錄傳送移轉作業可針對原始資料庫進行頻外設定、這對關鍵任務資料庫特別有用。來源資料庫不需要變更組態、移轉環境的還原和初始組態也不會影響正式作業。設定記錄傳送之後、它會對正式作業伺服器提出一些 I/O 需求。不過、記錄傳送是由簡單的歸檔記錄循序讀取所組成、這對正式作業資料庫效能不太可能有任何影響。</block>
  <block id="2c31403002a9f424c6ef56460c6b3715" category="paragraph">已證實、記錄傳送對於長期、高變更率的移轉專案特別有用。在某個案例中、單一 220TB 資料庫已移轉至距離約 500 英哩的新位置。變更率極高、安全性限制無法使用網路連線。記錄傳送是使用磁帶和快遞業者來執行。原始資料庫的複本最初是使用下列程序來還原。然後、快遞業者每週寄送記錄、直到最後一組磁帶送達時、記錄才會套用至複本資料庫。</block>
  <block id="b8efa655c4deb7af8a24fc241f8b53ff" category="section-title">Oracle DataGuard</block>
  <block id="d3165c4060fc6d19c0a6364e7c4580ee" category="paragraph">在某些情況下、保證提供完整的 DataGuard 環境。使用術語 DataGuard 來指稱任何記錄傳送或待命資料庫組態是不正確的。Oracle DataGuard 是管理資料庫複寫的全方位架構、但它不是複寫技術。在移轉工作中、完整的 DataGuard 環境的主要優點是能從一個資料庫透明切換到另一個資料庫。如果發現問題（例如新環境的效能或網路連線問題）、 Dataguard 也能將切換回原始資料庫。完整設定的 DataGuard 環境不僅需要設定資料庫層、也需要設定應用程式、以便應用程式能夠偵測主要資料庫位置的變更。一般而言、不需要使用 DataGuard 來完成移轉、但有些客戶內部擁有豐富的 DataGuard 專業知識、而且已經仰賴它來進行移轉工作。</block>
  <block id="f17c0a1ce359c1a6665412f89234bf41" category="section-title">重新架構</block>
  <block id="ece8d784e248d63091fc0d248cdeebc3" category="paragraph">如前所述、運用儲存陣列的進階功能有時需要變更資料庫配置。此外、從 ASM 移轉至 NFS 檔案系統等儲存傳輸協定變更、也必然會改變檔案系統配置。</block>
  <block id="71843fb61639ed5fe216bfebc85af16f" category="paragraph">記錄傳送方法（包括 DataGuard ）的主要優點之一是複寫目的地不需要與來源相符。使用記錄傳送方法從 ASM 移轉至一般檔案系統時沒有任何問題、反之亦然。您可以在目的地變更資料檔案的精確配置、以最佳化易插拔資料庫（ PDB ）技術的使用、或選擇性地設定特定檔案的 QoS 控制。換句話說、以記錄傳送為基礎的移轉程序可讓您輕鬆安全地最佳化資料庫儲存配置。</block>
  <block id="f00ec1b23f539163f4c748a85e49e2dd" category="section-title">伺服器資源</block>
  <block id="76c5d43a72d856a95b0eed94694ae696" category="paragraph">資料庫層級移轉的一項限制是需要第二部伺服器。使用第二部伺服器的方法有兩種：</block>
  <block id="6cb133f8b5045ef30c17e96ab281749e" category="list-text">您可以使用第二部伺服器作為資料庫的永久新主目錄。</block>
  <block id="f5133929790fe62dbc76a73db4c88544" category="list-text">您可以使用第二部伺服器做為暫存伺服器。在資料移轉至新儲存陣列完成並測試之後、 LUN 或 NFS 檔案系統會從暫存伺服器中斷連線、然後重新連線至原始伺服器。</block>
  <block id="48a00ba9881b62c610201cd833ee9c88" category="paragraph">第一個選項是最簡單的、但在需要非常強大伺服器的大型環境中、使用它可能不可行。第二個選項需要額外的工作、才能將檔案系統重新放置回原始位置。這可以是一項簡單的作業、使用 NFS 做為儲存傳輸協定、因為檔案系統可以從暫存伺服器卸載、然後重新掛載到原始伺服器上。</block>
  <block id="c223252c2d577984b75caddbd1dff9dc" category="paragraph">區塊型檔案系統需要額外的工作、才能更新 FC 分區或 iSCSI 啟動器。對於大多數邏輯磁碟區管理員（包括 ASM ）、 LUN 會在原始伺服器上可用後自動偵測並上線。不過、某些檔案系統和 LVM 實作可能需要更多工作才能匯出和匯入資料。確切的程序可能會有所不同、但通常很容易建立簡單且可重複的程序、以完成移轉並將資料重新存放在原始伺服器上。</block>
  <block id="2d22ab8be3661ce5dfd8c9910d1cc003" category="paragraph">雖然可以在單一伺服器環境中設定記錄傳送和複寫資料庫、但新執行個體必須具有不同的處理程序 SID 、才能重新播放記錄。您可以使用不同的 SID 、在不同的處理序識別碼集下暫時開啟資料庫、稍後再變更。然而、這樣做可能會導致許多複雜的管理活動、並使資料庫環境面臨使用者錯誤的風險。</block>
  <block id="2660e825d3a58f68aeec49e1c749f477" category="section-title">主機層級移轉</block>
  <block id="fae5bb68519bf78c1b3711566283f4ef" category="paragraph">在主機層級移轉資料是指使用主機作業系統和相關公用程式來完成移轉。此程序包括複製資料的任何公用程式、包括 Oracle RMAN 和 Oracle ASM 。</block>
  <block id="01070e0746a412afd171ccf162d3a170" category="section-title">資料複製</block>
  <block id="180e717e34d5e4bd2991c47960d00f51" category="paragraph">不應低估簡單複製作業的價值。現代化的網路基礎架構可以以每秒 GB 的速度來移動資料、而檔案複製作業則是以高效率的連續讀寫 I/O 為基礎相較於記錄傳送、主機複本作業無法避免造成更多中斷、但移轉不只是資料移動而已。通常包括網路變更、資料庫重新啟動時間和移轉後測試。</block>
  <block id="750e04d167938f35054d1c30fd06af58" category="paragraph">複製資料所需的實際時間可能並不重要。此外、複製作業會保留保證的回傳路徑、因為原始資料不會受到影響。如果在移轉過程中遇到任何問題、可以重新啟動原始資料的原始檔案系統。</block>
  <block id="5a3572c65171e06d99a4e055f9d35d32" category="section-title">重新建立平台</block>
  <block id="d123cc133e4de7ab3a4b1a5af3bf37a7" category="paragraph">重組是指 CPU 類型的變更。當資料庫從傳統的 Solaris 、 AIX 或 HP-UX 平台移轉至 x86 Linux 時、由於 CPU 架構的變更、資料必須重新格式化。SPARC 、 IA64 和 Power CPU 稱為 Big endian 處理器、而 x86 和 x86_64 架構則稱為小 endian 。因此、 Oracle 資料檔案中的某些資料會根據使用中的處理器而有不同的訂購方式。</block>
  <block id="6a03806f9c4b1f0048478bab7863fd2c" category="paragraph">傳統上、客戶都使用 DataPump 跨平台複寫資料。datapump 是一種公用程式、可建立特殊類型的邏輯資料匯出、以便更快地匯入目的地資料庫。因為它會建立資料的邏輯複本、所以 DataPump 會將處理器位準的相依性留在背後。有些客戶仍使用資料平台來重新建立平台、但 Oracle 11g 提供更快速的選項：跨平台可攜式表格空間。這項進階功能可將資料表空間轉換成不同的 endian 格式。這是一種實體轉型、效能優於 DataPump 匯出、它必須將實體位元組轉換為邏輯資料、然後再轉換回實體位元組。</block>
  <block id="713bf8ff4ea4c4ece861f3345e15e3ea" category="paragraph">關於 DataPump 和可攜式資料表空間的完整討論不在 NetApp 文件的範圍之內、但 NetApp 根據我們協助客戶移轉至具有新 CPU 架構的新儲存陣列記錄的經驗、提供一些建議：</block>
  <block id="86b0ebca28354c7f55b4cc2fe79bee0e" category="list-text">如果使用 DataPump 、則應在測試環境中測量完成移轉所需的時間。客戶有時會對完成移轉所需的時間感到驚訝。這種非預期的額外停機可能會造成中斷。</block>
  <block id="8a592f25a72fd6f3718b1b01869ade30" category="list-text">許多客戶誤以為跨平台可攜式資料表空間不需要資料轉換。當使用具有不同序位元組的 CPU 時、會使用 RMAN<block ref="31168275dcaac634489082b54c4c66d0" prefix=" " category="inline-code"></block> 必須事先對資料檔案執行作業。這不是即時操作。在某些情況下、轉換程序可以透過在不同資料檔案上執行多個執行緒來加速、但無法避免轉換程序。</block>
  <block id="db7b3f86f4c9a2a6a76adac81614c03b" category="section-title">邏輯 Volume Manager 導向的移轉</block>
  <block id="86586aa50b0df80a7c68bcd3e86c8606" category="paragraph">LVMS 的運作方式是將一組或多個 LUN 拆分為一般稱為擴充的小型單元。然後將擴充集區用作建立邏輯磁碟區的來源、這些邏輯磁碟區基本上是虛擬化的。此虛擬化層以各種方式提供價值：</block>
  <block id="68d083c44669b8b20f0421b0389c6ded" category="list-text">邏輯磁碟區可以使用從多個 LUN 擷取的範圍。在邏輯磁碟區上建立檔案系統時、它可以使用所有 LUN 的完整效能功能。此外、它也能提升磁碟區群組中所有 LUN 的平均載入速度、提供更可預測的效能。</block>
  <block id="10d1e748082641ce33e82f457cabcbe7" category="list-text">您可以新增邏輯磁碟區、並在某些情況下移除範圍、以調整其大小。在邏輯磁碟區上調整檔案系統大小通常不會中斷營運。</block>
  <block id="5efed6e7bf2fda8321882aff35768721" category="list-text">透過移動基礎範圍、邏輯磁碟區可以不中斷地移轉。</block>
  <block id="96371ba57b3d2f331cc9bd7b5e34708b" category="paragraph">使用 LVM 移轉的運作方式有兩種：移動範圍或鏡射 / 去除範圍。LVM 移轉使用高效率的大型區塊連續 I/O 、而且很少會造成任何效能問題。如果這確實是問題、通常有節流 I/O 速率的選項。如此可增加完成移轉所需的時間、同時減輕主機和儲存系統的 I/O 負擔。</block>
  <block id="28084a93e6570f55c3923991e269816e" category="section-title">鏡射與鏡射</block>
  <block id="f5b05967100f74bb14ae26d5021ef4e3" category="paragraph">某些 Volume 管理程式（例如 AIX LVM ）可讓使用者指定每個範圍的複本數量、並控制裝載每個複本的裝置。移轉作業是透過取得現有的邏輯磁碟區、將基礎範圍鏡射到新磁碟區、等待複本同步、然後丟棄舊複本來完成。如果需要返回路徑、可以在放置鏡射複本之前建立原始資料的快照。或者、您也可以在強制刪除內含的鏡像複本之前、暫時關閉伺服器以遮罩原始 LUN 。這樣做會在資料的原始位置保留可恢復的資料複本。</block>
  <block id="7151373ff69a9fafa4a579b40282beeb" category="section-title">擴展移轉</block>
  <block id="682ba6adb168511d03877bdbf940a0b7" category="paragraph">幾乎所有的 Volume 管理程式都允許移轉擴充、有時也有多個選項。例如、某些 Volume 管理程式可讓管理員將特定邏輯磁碟區的個別擴充區從舊儲存區重新定位到新儲存區。Volume 管理程式（例如 Linux LVM2 ）提供<block ref="8167c9a6bd495f7ed235364201039099" prefix=" " category="inline-code"></block> 命令、可將指定 LUN 裝置上的所有延伸重新定位至新 LUN 。移除舊 LUN 之後、即可將其移除。</block>
  <block id="8c232bd157fb78062260d11e1ec3fc2c" category="admonition">作業的主要風險是從組態中移除舊的、未使用的 LUN 。變更 FC 分區和移除過時的 LUN 裝置時、必須格外小心。</block>
  <block id="41175a8b2053bedbf868e340edf92f55" category="section-title">Oracle 自動儲存管理</block>
  <block id="dce3f0c1b1c85aaee6448197054602d1" category="paragraph">Oracle ASM 是結合邏輯 Volume Manager 與檔案系統的產品。在較高層級、 Oracle ASM 會將 LUN 集合起來、分成小的分配單元、並將其呈現為稱為 ASM 磁碟群組的單一磁碟區。ASM 也能透過設定備援層級來鏡射磁碟群組。磁碟區可以是無鏡射（外部備援）、鏡射（正常備援）或三向鏡射（高備援）。設定備援層級時、請務必謹慎、因為建立後無法變更。</block>
  <block id="d0ac5c14a6207835f733f4366345089d" category="paragraph">ASM 也提供檔案系統功能。雖然檔案系統無法直接從主機看到、但 Oracle 資料庫仍可在 ASM 磁碟群組上建立、移動及刪除檔案與目錄。此外、您也可以使用 asmcmd 公用程式來瀏覽結構。</block>
  <block id="e72c9da30cbec4daedddc9b6e6fdf03b" category="paragraph">與其他 LVM 實作一樣、 Oracle ASM 也會在所有可用 LUN 之間、對每個檔案的 I/O 進行分拆和負載平衡、以最佳化 I/O 效能。其次、基礎擴充可重新定位、以便同時調整 ASM 磁碟群組的大小和移轉。Oracle ASM 會透過重新平衡作業來自動化程序。新的 LUN 會新增至 ASM 磁碟群組、而舊的 LUN 會被丟棄、這會觸發磁碟群組中的磁碟區重新配置及後續刪除已清空的 LUN 。此程序是最獲證實的移轉方法之一、而 ASM 提供透明移轉的可靠性、可能是最重要的功能。</block>
  <block id="d4ad443888b51ec4e13912c45da68f76" category="admonition">由於 Oracle ASM 的鏡射層級是固定的、因此無法搭配鏡射和鏡射移轉方法使用。</block>
  <block id="048429277e643e20907317612c1f3318" category="section-title">儲存層級移轉</block>
  <block id="623bb7ffbb3730716ea39b5086d26f18" category="paragraph">儲存層級移轉是指在應用程式和作業系統層級以下執行移轉。過去、這有時是指使用專門的裝置來複製網路層級的 LUN 、但現在這些功能在 ONTAP 中是原生的。</block>
  <block id="794cb725c5631ad99b5b7c000307f0df" category="section-title">SnapMirror</block>
  <block id="963ce762febea70d619f1fd5c114d85c" category="paragraph">使用 NetApp SnapMirror 資料複寫軟體、幾乎可以通用地從 NetApp 系統之間移轉資料庫。此程序包括為要移轉的磁碟區設定鏡射關係、允許它們進行同步處理、然後等待轉換時間。當來源資料庫到達時、即會關閉、執行最後一個鏡像更新、而且鏡像也會中斷。然後、複本磁碟區就可以開始使用、方法是掛載包含的 NFS 檔案系統目錄、或是探索包含的 LUN 並啟動資料庫。</block>
  <block id="1871452e5ea7e53152b5c874a12a890b" category="paragraph">在單一 ONTAP 叢集中重新放置磁碟區並不視為移轉作業、而是例行作業<block ref="0fc2ecb8aa71bddc595fbc39f593496a" prefix=" " category="inline-code"></block> 營運。SnapMirror 用作叢集中的資料複寫引擎。此程序完全自動化。當磁碟區的屬性（例如 LUN 對應或 NFS 匯出權限）與磁碟區本身一起移動時、無需執行其他移轉步驟。重新配置不會中斷主機作業。在某些情況下、必須更新網路存取、以確保以最有效率的方式存取新重新部署的資料、但這些工作也不會中斷營運。</block>
  <block id="19fee3ea4b7f4472b5c1853122e8f47b" category="section-title">外部 LUN 匯入（ FLI ）</block>
  <block id="a73cf458eed5aeff5c15aa5d70298cce" category="paragraph">FLI 是一項功能、可讓執行 8.3 或更高版本的 Data ONTAP 系統從另一個儲存陣列移轉現有 LUN 。此程序很簡單： ONTAP 系統會分區到現有的儲存陣列、就像是任何其他 SAN 主機一樣。然後 Data ONTAP 控制所需的舊版 LUN 、並移轉基礎資料。此外、匯入程序會在資料移轉時使用新 Volume 的效率設定、也就是說、資料可以在移轉過程中內嵌進行壓縮及刪除重複資料。</block>
  <block id="0ee4b09881406835f151f103412a2f1e" category="paragraph">Data ONTAP 8.3 中首次實作的 FLI 僅允許離線移轉。這是非常快速的傳輸、但仍表示在移轉完成之前、 LUN 資料無法使用。線上移轉是在 Data ONTAP 8.3.1 中推出。這類移轉可讓 ONTAP 在傳輸過程中提供 LUN 資料、將中斷情形減至最低。當主機重新分區以透過 ONTAP 使用 LUN 時、會發生短暫的中斷。不過、一旦進行這些變更、資料就會再次存取、並在整個移轉程序中保持可存取的狀態。</block>
  <block id="19d95ee75467fc2f9a06d150cc99d944" category="paragraph">讀取 I/O 會透過 ONTAP 代理、直到複製作業完成為止、而寫入 I/O 會同步寫入外部和 ONTAP LUN 。這兩個 LUN 複本會以這種方式保持同步、直到系統管理員執行完整的轉換程式來釋放外部 LUN 、而不再複寫寫入內容。</block>
  <block id="5caad387757ca99ada41709ce30a31a5" category="paragraph">FLI 的設計可與 FC 搭配使用、但如果您想要變更為 iSCSI 、則可在移轉完成後、輕鬆將移轉的 LUN 重新對應為 iSCSI LUN 。</block>
  <block id="7fa6cfc683e0f5f9e3a79f6be14e23f4" category="paragraph">FLI 的功能包括自動對齊偵測與調整。在這種情況下、「對齊」一詞是指 LUN 裝置上的分割區。最佳效能需要將 I/O 與 4K 區塊對齊。如果分割區的偏移量不是 4K 的倍數、效能就會受到影響。</block>
  <block id="7b4ef266729f1ddfbc724cad17af4efc" category="paragraph">第二個對齊層面無法透過調整分割區偏移（檔案系統區塊大小）來修正。例如、 ZFS 檔案系統通常預設為 512 位元組的內部區塊大小。其他使用 AIX 的客戶偶爾會建立具有 512 或 1 、 024 位元組區塊大小的 JFS2 檔案系統。雖然檔案系統可能會與 4K 邊界對齊、但在該檔案系統中建立的檔案不會受到影響、效能也會受到影響。</block>
  <block id="1d6b28ed67b1d554df806b0b5a020711" category="paragraph">在此情況下不應使用 FLI 。雖然資料在移轉後仍可存取、但結果是檔案系統的效能嚴重限制。一般而言、任何支援 ONTAP 上隨機覆寫工作負載的檔案系統、都應該使用 4K 區塊大小。這主要適用於資料庫資料檔案和 VDI 部署等工作負載。區塊大小可使用相關的主機作業系統命令來識別。</block>
  <block id="4941562ef813562e0d6aaef673158b99" category="paragraph">例如、在 AIX 上、可以使用檢視區塊大小<block ref="10c9a985c983a826424b496a708263ec" prefix=" " category="inline-code"></block>。使用 Linux 、<block ref="ba5265473f00b27178098cc38d3aef24" prefix=" " category="inline-code"></block> 和<block ref="1f8a87190704df357c64a49aee936874" prefix=" " category="inline-code"></block> 可用於<block ref="310201b6353c5f38bc039e0e51b079d3" prefix=" " category="inline-code"></block> 和<block ref="5382133ffbecb9bce9d47f2e44327b16" prefix=" " category="inline-code"></block>。與<block ref="8cbc6ba7c8bba133ce2bc44780d88742" prefix=" " category="inline-code"></block>、命令是<block ref="1615297782a0dff59b20451e2ca97ea7" prefix=" " category="inline-code"></block>。</block>
  <block id="033a4cb04b5225e2b7cf966f2ce16598" category="paragraph">控制區塊大小的參數為<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 而且通常預設值為 9 ，即 2^9 或 512 位元組。為了獲得最佳效能<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 值必須為 12 （ 2^12=4K ）。此值是在創建 zpool 時設置的，不能更改，這意味着使用的數據 zpool<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 除 12 個以外、應將資料複製到新建立的 zPool 、以進行移轉。</block>
  <block id="8bd9661d8c8eb9924c62b8242191af4e" category="paragraph">Oracle ASM 沒有基本區塊大小。唯一的要求是必須正確對齊 ASM 磁碟所在的磁碟分割區。</block>
  <block id="ea7f7e1e8119ee64585b6173afe720e8" category="section-title">7-Mode Transition Tool</block>
  <block id="75df51cc2f43b8dde951695f97b838c0" category="paragraph">7-Mode Transition Tool （ 7MTT ）是一種自動化公用程式、用於將大型 7-Mode 組態移轉至 ONTAP 。大多數資料庫客戶發現其他方法都比較容易、部分原因是他們通常會依資料庫來移轉環境資料庫、而非重新配置整個儲存設備佔用空間。此外、資料庫通常只是較大型儲存環境的一部分。因此、資料庫通常會個別移轉、其餘的環境則可以使用 7MTT 進行移轉。</block>
  <block id="85fd7dcbc2206c27059ae7f88712154d" category="paragraph">有少數客戶擁有專為複雜資料庫環境設計的儲存系統。這些環境可能包含許多磁碟區、快照和許多組態詳細資料、例如匯出權限、 LUN 啟動器群組、使用者權限和輕量型目錄存取傳輸協定組態。在這種情況下、 7MTT 的自動化功能可簡化移轉作業。</block>
  <block id="2c87fbdecbf0dfe299f9f89958d61085" category="paragraph">7MTT 可在下列兩種模式中的其中一種運作：</block>
  <block id="dc818e71a5519d1b99c7e996cf21fd74" category="list-text">* 複製型轉換（ CBT ） * 7MTT 搭配 CBT 、可從新環境中現有的 7 模式系統設定 SnapMirror 磁碟區。資料同步後、 7MTT 會協調轉換程序。</block>
  <block id="453bbc96e365e25cc2d091dced3565a6" category="list-text">* 複製 - 自由轉換（ CFT ）。 * 採用 CFT 的 7MTT 是根據現有 7-Mode 磁碟櫃的原位轉換而定。不會複製任何資料、也可以重複使用現有的磁碟櫃。保留現有的資料保護與儲存效率組態。</block>
  <block id="16262236c3981cb3310b9320b5a67fd0" category="paragraph">這兩種選項的主要差異在於：無複製轉換是一種非常有效的方法、其中所有連接至原始 7-Mode HA 配對的磁碟櫃都必須重新放置到新環境中。沒有選項可以移動一部分機櫃。複製型方法可讓選取的磁碟區移動。此外、由於可重新儲存磁碟櫃和轉換中繼資料所需的連結、因此也可能會有較長的轉換時間、且無需複製。根據現場經驗、 NetApp 建議允許 1 小時重新配置及重新配置磁碟櫃、 15 分鐘至 2 小時的中繼資料轉換時間。</block>
  <block id="c8365c28332d425fd91f2de2e2c22dfb" category="summary">準備 ONTAP 進行 FLI 移轉</block>
  <block id="25c18537e56595b3e7f3ce78905917ba" category="doc">FLI 規劃 - Oracle</block>
  <block id="f1033948d9d2d14612d27f1808720f12" category="inline-link">TR-4380 ：使用外部 LUN Import 進行 SAN 移轉</block>
  <block id="58fc59a248fefa86003ac1867e5bd279" category="paragraph">NetApp 中記錄了使用 FLI 移轉 SAN 資源的程序<block ref="5abd855dd5d8332b78fa966ac34c0f22" category="inline-link-rx"></block>。</block>
  <block id="795bbfbd054829fad905065087ba2d5a" category="paragraph">從資料庫和主機的觀點來看、不需要採取任何特殊步驟。更新 FC 區域並在 ONTAP 上提供 LUN 之後、 LVM 應該能夠從 LUN 讀取 LVM 中繼資料。此外、這些磁碟區群組也可以開始使用、無需進一步的組態步驟。在極少數情況下、環境可能會包含硬編碼的組態檔案、其中包含先前儲存陣列的參考資料。例如、內含的 Linux 系統<block ref="dd5ff67ba72768d33f75e645aa2b8e56" prefix=" " category="inline-code"></block> 參考指定裝置 WWN 的規則必須更新、以反映 FLI 所做的變更。</block>
  <block id="9e7ddc2ddefcd6f202fb11a82a80bc7e" category="admonition">如需支援組態的相關資訊、請參閱 NetApp 相容性對照表。如果您的環境未包含在內、請聯絡 NetApp 代表以取得協助。</block>
  <block id="0f5b3758229b3e28c8605b6c42398115" category="paragraph">此範例顯示 Linux 伺服器上代管的 ASM 和 LVM LUN 移轉。其他作業系統支援 FLI 、雖然主機端命令可能不同、但原則相同、 ONTAP 程序相同。</block>
  <block id="f1036cd97e461d07351c9df32fc5948d" category="section-title">識別 LVM LUN</block>
  <block id="88f7413f9621a816ee3d370703168647" category="paragraph">準備的第一步是識別要移轉的 LUN 。在此所示範例中、會在裝載兩個 SAN 型檔案系統<block ref="572f241ef88fdb17d16eba97133d861f" prefix=" " category="inline-code"></block> 和<block ref="d14bc7787c7396144583e99a7df52f67" prefix=" " category="inline-code"></block>。</block>
  <block id="ecad615a52fda392a9b7c1075d2cb2c5" category="paragraph">Volume 群組的名稱可以從裝置名稱中擷取、該名稱使用格式（ Volume 群組名稱） - （邏輯磁碟區名稱）。在這種情況下、會呼叫 Volume 群組<block ref="bb97320b8c517da828eae4ec543113db" prefix=" " category="inline-code"></block>。</block>
  <block id="b08986bb1757d5ae8de06d523c71803d" category="paragraph">。<block ref="f1e2c495108b111c930735e3a0f9a04e" prefix=" " category="inline-code"></block> 命令可用於識別支援此 Volume 群組的 LUN 、如下所示。在這種情況下、共有 10 個 LUN 組成<block ref="bb97320b8c517da828eae4ec543113db" prefix=" " category="inline-code"></block> Volume 群組。</block>
  <block id="8b47fac6803dfff2e8d2cdad6f297cfa" category="section-title">識別 ASM LUN</block>
  <block id="a23d0124954ecdbfe9d0f3aceb9e17a2" category="paragraph">ASM LUN 也必須移轉。若要以 sysasm 使用者的身分從 sqlplus 取得 LUN 和 LUN 路徑的數目、請執行下列命令：</block>
  <block id="918841992da84786f00de7c4c7d83dbf" category="paragraph">目前環境包含 20 個要移轉的 LUN 。更新目前的 SAN 、讓 ONTAP 能夠存取目前的 LUN 。資料尚未移轉、但 ONTAP 必須從目前的 LUN 讀取組態資訊、才能為該資料建立新的主目錄。</block>
  <block id="5816768a5d83977f34ffa5025c14f430" category="paragraph">AFF/FAS 系統上至少必須將一個 HBA 連接埠設定為啟動器連接埠。此外、必須更新 FC 區域、讓 ONTAP 能夠存取外部儲存陣列上的 LUN 。某些儲存陣列已設定 LUN 遮罩、限制哪些 WWN 可以存取指定的 LUN 。在這種情況下、 LUN 遮罩也必須更新、才能授予 ONTAP WWN 存取權。</block>
  <block id="030a992b1340f67584d67ef6230e9adf" category="paragraph">完成此步驟後、 ONTAP 應能使用檢視外部儲存陣列<block ref="d90ba20b63acab53952d68665c50ec47" prefix=" " category="inline-code"></block> 命令。它傳回的關鍵欄位是用來識別系統上外部 LUN 的首碼。在以下範例中、為外部陣列上的 LUN<block ref="25103eba8d70e82b5bd837be0d2f63c4" prefix=" " category="inline-code"></block> 在 ONTAP 中使用前置碼顯示<block ref="6b35470d99880c4630ed3ca7b4c842e7" prefix=" " category="inline-code"></block>。</block>
  <block id="c1a0f5174323df40a8b659eb65ac5155" category="section-title">識別外部陣列</block>
  <block id="6c1b8919e2e706972b3ec48cb7f014ba" category="section-title">識別外部 LUN</block>
  <block id="63841e312d3a8531331e35bd826268d1" category="paragraph">可以通過傳送來列出 LUN<block ref="907702f5103a7823393b8dd296a75c26" prefix=" " category="inline-code"></block> 至<block ref="242f4ce1948273386f8bb487bdd3732f" prefix=" " category="inline-code"></block> 命令。移轉程序期間會多次參照傳回的資料。</block>
  <block id="e5e94f7e2098883f0d621e064b1104f4" category="section-title">將外部陣列 LUN 登錄為匯入候選項目</block>
  <block id="c968ec41c1c0c449b0263962966d8293" category="paragraph">外部 LUN 一開始會歸類為任何特定的 LUN 類型。在匯入資料之前、必須將 LUN 標記為外部、因此是匯入程序的候選項目。將序號傳送至即可完成此步驟<block ref="93c633f7fa188f1b27df574c0e5e929a" prefix=" " category="inline-code"></block> 命令、如下列範例所示。請注意、此程序只會將 LUN 標記為 ONTAP 中的外部。不會將任何資料寫入外部 LUN 本身。</block>
  <block id="33380a523841f23815f2f83c9de1a628" category="section-title">建立磁碟區以裝載移轉的 LUN</block>
  <block id="2c2ba8ca6bdd77da1da981b91a3fae4a" category="paragraph">需要一個磁碟區來裝載移轉的 LUN 。確切的 Volume 組態取決於運用 ONTAP 功能的整體計畫。在此範例中、 ASM LUN 會放置在一個磁碟區中、而 LVM LUN 則放置在第二個磁碟區中。這樣做可讓您將 LUN 當作個別群組來管理、例如分層、建立快照或設定 QoS 控制。</block>
  <block id="8bc7d64e68e4be8f4908effd57293a2a" category="paragraph">設定<block ref="fb983ebeedc63d8723c0d4aa558a4c02" prefix=" " category="inline-code"></block>。移轉程序可能包括大量資料流動。因此、如果快照是意外建立的、可能會大幅增加空間使用量、因為快照中會擷取不需要的資料。</block>
  <block id="8c0675d07e44f55f1f5aa6d45abe0cdb" category="section-title">建立 ONTAP LUN</block>
  <block id="0b799020dac78a5e12a3d1a6400fd0c8" category="paragraph">建立磁碟區之後、必須建立新的 LUN 。一般而言、建立 LUN 需要使用者指定 LUN 大小之類的資訊、但在此情況下、外部磁碟引數會傳遞給命令。因此、 ONTAP 會從指定的序號複寫目前的 LUN 組態資料。它也會使用 LUN 幾何資料和分割表格資料來調整 LUN 對齊、並建立最佳效能。</block>
  <block id="5272a1dc3854f1eddc353c8073234e03" category="paragraph">在此步驟中、序號必須與外部陣列交叉參照、以確保正確的外部 LUN 與正確的新 LUN 相符。</block>
  <block id="f6ee70ec9fce7bd34fa5a33d8969fb5e" category="section-title">建立匯入關係</block>
  <block id="94700a911b95416221efe4064acbc2ba" category="paragraph">LUN 現已建立、但尚未設定為複寫目的地。在執行此步驟之前、必須先將 LUN 離線。這項額外步驟旨在保護資料不受使用者錯誤影響。如果 ONTAP 允許在線上 LUN 上執行移轉、可能會造成打字錯誤、導致覆寫作用中資料。強制使用者先將 LUN 離線的額外步驟、有助於確認使用正確的目標 LUN 做為移轉目的地。</block>
  <block id="85255e52054af9c6ffd3c4e79c723a34" category="paragraph">LUN 離線後、您可以將外部 LUN 序號傳送至、以建立匯入關係<block ref="04c2f87857699971f5aedd525e65690a" prefix=" " category="inline-code"></block> 命令。</block>
  <block id="8e3c921431d2b7f66fa0cc85f3ae5c9d" category="paragraph">建立所有匯入關係之後、即可將 LUN 重新上線。</block>
  <block id="ea382cbfdb353cee0cf25eaae9bba150" category="section-title">建立啟動器群組</block>
  <block id="152c4728a5fb152525a639439b9d7cb9" category="inline-link-macro">傳輸協定轉換</block>
  <block id="298a1c3c736859f2cfa3cb8eb1f3fdcc" category="paragraph">在此範例中、會建立一個 igroup 、其中包含兩個 WWN 、對應於主機 HBA 上可用的兩個連接埠。</block>
  <block id="4f6f03762bfcdc7174cdd30240ce45b3" category="section-title">將新 LUN 對應至主機</block>
  <block id="c22fee2d07a149be91ae1ae2ada1cb57" category="paragraph">在建立 igroup 之後、 LUN 會對應至定義的 igroup 。這些 LUN 僅適用於此 igroup 中包含的 WWN 。NetApp 假設移轉程序目前階段主機尚未分區至 ONTAP 。這一點很重要、因為如果主機同時分區到外部陣列和新的 ONTAP 系統、則可能會在每個陣列上發現具有相同序號的 LUN 。這種情況可能導致多重路徑故障或資料受損。</block>
  <block id="ecca392290c36269e0489c0b1cf36f50" category="summary">用於自動化 Oracle 移轉作業的範例指令碼</block>
  <block id="fc53c036602508ed6c2afc18e2fbdf51" category="doc">範例指令碼</block>
  <block id="6f78af00b87bcad5d08c95c7b6066ad0" category="paragraph">提供的指令碼是如何為各種作業系統和資料庫工作撰寫指令碼的範例。這些都是依現狀供應。如果特定程序需要支援、請聯絡 NetApp 或 NetApp 經銷商。</block>
  <block id="3146889e40b3ca2b78c56a19178bff84" category="section-title">資料庫關機</block>
  <block id="5b98b9877c0c74dc3a3daf46cf943d3f" category="paragraph">下列 Perl 指令碼會採用 Oracle SID 的單一引數、並關閉資料庫。它可以以 Oracle 使用者或 root 身分執行。</block>
  <block id="7df41a3619af59182fb5df6d1920d11a" category="section-title">資料庫啟動</block>
  <block id="57249fb9cdac8ddc9ea8843636c4e088" category="section-title">將檔案系統轉換為唯讀</block>
  <block id="f2977a22ba44544ca8921e2d75bce435" category="paragraph">下列指令碼會採用檔案系統引數、並嘗試將其卸除並重新掛載為唯讀。在移轉過程中、這樣做非常有用、因為必須將檔案系統保留在可複寫資料的位置、但必須保護其免於意外損壞。</block>
  <block id="4eac395595a8d266839db0b88fae31e4" category="section-title">取代檔案系統</block>
  <block id="988d7030a130298e1641007b5b0aae20" category="paragraph">下列指令碼範例用於將一個檔案系統取代為另一個檔案系統。因爲它編輯了 /etc/fstab 文件，所以它必須以 root 身份運行。它接受新舊檔案系統的單一逗號分隔引數。</block>
  <block id="149c75d086adf78a50a16bcb5e349158" category="list-text">若要取代檔案系統、請執行下列指令碼：</block>
  <block id="67a4c588434c781febb12c165c3e860a" category="paragraph">以本指令碼的使用範例為例、假設中的資料<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> 移轉至<block ref="27df80f143a5812bda1553d09c712efc" prefix=" " category="inline-code"></block> 和<block ref="0e62afc91abe157ef67895cca0a7f912" prefix=" " category="inline-code"></block> 移轉至<block ref="1c988fc7a325635f00f9b55992128a08" prefix=" " category="inline-code"></block>。執行此工作最簡單的方法之一、就是使用簡單的檔案複製作業、將新裝置重新放置回原始安裝點。</block>
  <block id="4a3d90c30a5e921650fe8ad0decf4827" category="list-text">假設舊的和新的檔案系統存在於中<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 檔案如下：</block>
  <block id="4588a4e3d2f8d0f7c036f59c1be2163f" category="list-text">執行時、此指令碼會卸載目前的檔案系統、並以新的：</block>
  <block id="2d808cb44231d0a80164567e7220fc44" category="list-text">指令碼也會更新<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 請據此歸檔。在此處所示範例中、包含下列變更：</block>
  <block id="840967a448e36b9efeaacf7673f825aa" category="section-title">自動化資料庫移轉</block>
  <block id="1107dd36fe8ba0c18ea8abc8734986e2" category="paragraph">此範例示範如何使用關機、啟動及檔案系統置換指令碼來完全自動化移轉。</block>
  <block id="36881541e7d9c7bced65fcac337ac327" category="section-title">顯示檔案位置</block>
  <block id="1e9a1acc40d4943a73e6865cdebaf560" category="paragraph">此指令碼會收集許多重要的資料庫參數、並以易讀的格式列印。此指令碼在檢閱資料配置時非常實用。此外、指令碼也可以修改以供其他用途使用。</block>
  <block id="6172b49b7fdf806b59af0aeef8de71e3" category="section-title">ASM 移轉清理</block>
  <block id="dd8d75d6766af495b5442e67eb27d387" category="section-title">ASM 至檔案系統名稱轉換</block>
  <block id="abc3fc91423668bb4bd49e6e837fa3e4" category="section-title">在資料庫上重新播放記錄</block>
  <block id="cc7b9a518bb2532f61662a9893248133" category="paragraph">此指令碼接受 Oracle SID 的單一引數、用於處於掛載模式的資料庫、並嘗試重新播放所有目前可用的歸檔記錄。</block>
  <block id="2a5bd3a209a1ed33b81c5306780227ce" category="section-title">在待命資料庫上重新播放記錄</block>
  <block id="ea7bebed0b4151a9b28acbde55fc0eb3" category="paragraph">此指令碼與前述指令碼相同、但其設計用於待命資料庫。</block>
  <block id="109be8945d38cda6c034a22373bdbd3b" category="summary">在 FLI 移轉之後變更 SAN 傳輸協定</block>
  <block id="b5e65fbdff41aa940dad918d9f7c0b9e" category="doc">FLI 傳輸協定轉換 - Oracle</block>
  <block id="2adcfd589637337984e39e94dd14ae33" category="paragraph">變更用於存取 LUN 的傳輸協定是常見的需求。</block>
  <block id="38fe6838f11a6023172d11d806adbfcf" category="paragraph">在某些情況下、它是將資料移轉至雲端的整體策略的一部分。TCP/IP 是雲端的傳輸協定、從 FC 變更為 iSCSI 可讓您更輕鬆地移轉至各種雲端環境。在其他情況下、 iSCSI 可能需要善用 IP SAN 降低的成本。有時候、移轉可能會使用不同的傳輸協定作為臨時措施。例如、如果外部陣列和 ONTAP 型 LUN 無法共存於同一個 HBA 上、您可以使用足夠長的 iSCSI LUN 、從舊陣列複製資料。然後、您可以在從系統移除舊 LUN 之後、將其轉換回 FC 。</block>
  <block id="832c81bd0db3ad98a3804ff5ce996a58" category="paragraph">下列程序示範從 FC 轉換至 iSCSI 的過程、但整體原則適用於從 iSCSI 轉換至 FC 的反轉過程。</block>
  <block id="e21180783b17ea695cf9275fce8a0bc7" category="section-title">安裝 iSCSI 啟動器</block>
  <block id="0e1ddcc32a3ef636c9ca084a3d7706f5" category="paragraph">大多數作業系統預設都包含軟體 iSCSI 啟動器、但如果不包含軟體 iSCSI 啟動器、則可輕鬆安裝。</block>
  <block id="289fe013df899f5f74fb362d4efcdd5d" category="section-title">識別 iSCSI 啟動器名稱</block>
  <block id="8242e97b190184a6c7b8ec96c5662886" category="paragraph">在安裝過程中會產生唯一的 iSCSI 啟動器名稱。在 Linux 上、它位於<block ref="22565a44e8f73044eb2029acbb069639" prefix=" " category="inline-code"></block> 檔案：此名稱用於識別 IP SAN 上的主機。</block>
  <block id="721a96eb0b922b337fa815839839b328" category="section-title">建立新的啟動器群組</block>
  <block id="cda1311d977b7b77ad3aebe4a813b3bd" category="paragraph">啟動器群組（ igroup ）是 ONTAP LUN 遮罩架構的一部分。除非先授予主機存取權、否則無法存取新建立的 LUN 。此步驟的完成方法是建立一個 igroup 、列出需要存取的 FC WWN 或 iSCSI 啟動器名稱。</block>
  <block id="6548788f050643897f7354b6df4488db" category="paragraph">在此範例中、會建立包含 Linux 主機 iSCSI 啟動器的 igroup 。</block>
  <block id="da8490d81c1ef6b559b09c2ab94631d2" category="section-title">關閉環境</block>
  <block id="0bf211160ad57fedca3499176f213b11" category="paragraph">變更 LUN 傳輸協定之前、必須完全禁用 LUN 。任何要轉換的 LUN 上的資料庫都必須關機、檔案系統必須卸載、而且必須停用磁碟區群組。使用 ASM 時、請確定已卸除 ASM 磁碟群組、並關閉所有網格服務。</block>
  <block id="2ba1c509ee5f5e31f05b24aed2d23054" category="section-title">從 FC 網路取消對應 LUN</block>
  <block id="2f9e42c479a76dd54d7946c181049dd4" category="paragraph">LUN 完全禁用後、請從原始 FC igroup 移除對應。</block>
  <block id="5f889f52ef85be290c3e5c0211bbb8fa" category="section-title">將 LUN 重新對應至 IP 網路</block>
  <block id="4ac84701530b31d8d33d9aa742715d25" category="paragraph">將每個 LUN 的存取權授予新的 iSCSI 型啟動器群組。</block>
  <block id="3d59eaa280c8b75d8e997eac2cf5b3e6" category="section-title">探索 iSCSI 目標</block>
  <block id="981b782c3eacf8b87d8231b887873f03" category="paragraph">iSCSI 探索分為兩個階段。第一是探索目標、這與探索 LUN 不同。。<block ref="f88921f58beaaae5bcb9dffac54bf5ad" prefix=" " category="inline-code"></block> 下列命令會探查指定的入口網站群組<block ref="24e12535882a30ad33a21d76d76bd0ff" prefix=" " category="inline-code"></block> 並儲存提供 iSCSI 服務的所有 IP 位址和連接埠清單。在這種情況下、預設連接埠 3260 上有四個 iSCSI 服務的 IP 位址。</block>
  <block id="0ab5dd035c7f92f4dce1026744c01604" category="admonition">如果無法到達任何目標 IP 位址、此命令可能需要幾分鐘的時間才能完成。</block>
  <block id="1dba8f39914c5f44e3cb635e7ac7563e" category="section-title">探索 iSCSI LUN</block>
  <block id="68307bef4b9dc4071d875a0c2aadd321" category="paragraph">發現 iSCSI 目標後、請重新啟動 iSCSI 服務以探索可用的 iSCSI LUN 、並建置相關裝置、例如多重路徑或 ASMLib 裝置。</block>
  <block id="25d811252f87ae85dda97f2ab9dd1f3a" category="section-title">重新啟動環境</block>
  <block id="8a9aae851d31dae8baf96171f114955e" category="paragraph">重新啟動 Volume 群組、重新掛載檔案系統、重新啟動 RAC 服務等、以重新啟動環境。為了預防這種情況、 NetApp 建議您在轉換程序完成後重新啟動伺服器、以確保所有組態檔案都正確無誤、並移除所有過時的裝置。</block>
  <block id="00f4c8378b0bf837cee4b0aed8886f31" category="paragraph">注意：在重新啟動主機之前、請確定中的所有項目都已存在<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 這項參照移轉的 SAN 資源會被註解出來。如果未執行此步驟、且 LUN 存取有問題、則可能是無法開機的作業系統。此問題不會損壞資料。不過、開機進入救援模式或類似模式進行修正可能會非常不方便<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 這樣就能啟動作業系統、開始進行疑難排解工作。</block>
  <block id="7e712b6bec5dd0821f1822121da9f0c6" category="summary">Oracle 效能管理與 QoS</block>
  <block id="ff8b87ff7571fb54e71c9589f1b886a3" category="doc">Oracle 資料庫的服務品質</block>
  <block id="08e3cfb3c3dfa08d34bcbbfe07fe5f28" category="paragraph">安全有效地管理多個 Oracle 資料庫、需要有效的 QoS 策略。原因在於現代儲存系統的效能功能不斷提升。</block>
  <block id="3408fe4b6e4b2ed9366356f08e3b9ab0" category="summary">Oracle 資料庫與儲存效率</block>
  <block id="151654fbc652cca26707bd7a060073d3" category="doc">Oracle 資料庫與 ONTAP 效率功能</block>
  <block id="4564218d346b0ef8263512ebe659337d" category="paragraph">ONTAP 空間效率功能已針對 Oracle 資料庫進行最佳化。在幾乎所有情況下、最佳方法是在啟用所有效率功能的情況下、保留預設值。</block>
  <block id="794c6d3bb54da92d9a4a4022bc5c4e94" category="summary">RAID 和 Oracle 資料庫</block>
  <block id="ead1ce56c368cc12c4f8932e01c92f65" category="doc">Oracle RAID 需求</block>
  <block id="e959fe6bb794f67f31a0d4e6bc5d5bf4" category="paragraph">RAID 是指使用備援功能來保護資料、避免磁碟機遺失。</block>
  <block id="b60b0e7c75501fe2f322675f2e6da6d7" category="paragraph">在設定用於 Oracle 資料庫和其他企業應用程式的 NetApp 儲存設備時、偶爾會出現 RAID 層級的問題。許多舊版 Oracle 儲存陣列組態的最佳實務做法都包含使用 RAID 鏡射和 / 或避免使用特定類型 RAID 的警告。雖然這些來源提出有效點、但這些來源不適用於 RAID 4 、以及 ONTAP 中使用的 NetApp RAID DP 和 RAID-TEC 技術。</block>
  <block id="6de6bcceac7c1a53ecb774d42b8d5c9a" category="summary">Oracle 與 ONTAP 精簡配置</block>
  <block id="e04c5c8668870edf8392b07169f96644" category="doc">使用 Oracle 進行精簡配置</block>
  <block id="26c71bfc140fc9f2d56f83f7aedffd53" category="paragraph">簡化 Oracle 資料庫的資源配置需要仔細規劃、因為結果是在儲存系統上設定的空間比實際可用的空間更多。這項工作非常值得、因為正確完成後、可大幅節省成本、並改善管理能力。</block>
  <block id="c9a6446e7a1a2aa2d3d06c76b3dd02ae" category="summary">Oracle 資料庫的 SVM 資源配置</block>
  <block id="eaa6380760494a867d1be23523aaba3e" category="doc">Oracle 資料庫與儲存虛擬機器</block>
  <block id="ffa2dec61afa63c15c9906328e62e2e8" category="paragraph">Oracle 資料庫儲存管理集中在儲存虛擬機器（ SVM ）上</block>
  <block id="ba0fd7b6bfa61ad7f7ad5326a0934d01" category="summary">需要瞭解儲存設備接管和切入功能、才能確保 Oracle 資料庫作業不會因這些作業而中斷。此外、如果不正確使用、接管和切入作業所使用的引數可能會影響資料完整性。</block>
  <block id="75f921b4326183319e82bc907e80cc42" category="doc">Oracle 與 ONTAP 控制器容錯移轉 / 切換</block>
  <block id="999548558d2844d78a3b5f9186c231a4" category="summary">資料庫與 ONTAP 儲存容量與可用空間</block>
  <block id="3736e7d9912dca1541f3d86788010d1d" category="doc">Oracle 和儲存容量管理</block>
  <block id="360612d74cdd78953036946ec943f795" category="paragraph">使用可預測、可管理的高效能企業儲存設備來管理資料庫或其他企業應用程式、需要磁碟機上的一些可用空間來進行資料和中繼資料管理。所需的可用空間量取決於使用的磁碟機類型和業務程序。</block>
  <block id="655dc175973dc3d055e6e798ce1399a6" category="summary">Oracle 多區塊讀取參數</block>
  <block id="d3cc759510a3aba837fc8efeb2e24b91" category="doc">DB_FILE_multimblock_read_count</block>
  <block id="32faf0a922da10425f2be9f86a5f5e18" category="paragraph">。<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> 參數控制 Oracle 在連續 I/O 期間讀取為單一作業的 Oracle 資料庫區塊數量上限</block>
  <block id="36cb03af3dc688208e0e94fda31ca7a4" category="paragraph">不過、此參數不會影響 Oracle 在任何及所有讀取作業期間讀取的區塊數、也不會影響隨機 I/O只有連續 I/O 的區塊大小會受到影響。</block>
  <block id="2565c992b3732464484104f4c846d9b4" category="paragraph">Oracle 建議使用者不要設定此參數。如此可讓資料庫軟體自動設定最佳值。這通常表示此參數設為可產生 1MB I/O 大小的值。例如、 1MB 讀取 8KB 區塊需要 128 個區塊才能讀取、因此此參數的預設值為 128 。</block>
  <block id="0fd26e725a6c1a81508e013094776e2c" category="paragraph">NetApp 在客戶站台上觀察到的大多數資料庫效能問題、都涉及此參數的設定不正確。使用 Oracle 版本 8 和 9 變更此值的理由是正確的。因此、參數可能會在不知情的情況下出現在中<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 檔案、因為資料庫已就地升級至 Oracle 10 及更新版本。傳統設定為 8 或 16 、而預設值為 128 、會大幅損害連續 I/O 效能。</block>
  <block id="3f594bb922365c7a9f095f44822fa22e" category="admonition">* NetApp 建議 * 設定<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> 參數不應出現在中<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 檔案：NetApp 從未遇到過變更此參數可改善效能的情況、但在許多情況下、它會對連續 I/O 處理量造成明顯損害。</block>
  <block id="669ebbf33c0b19005e2ccaf02ba69e5f" category="summary">使用網路儲存設備的 Oracle RAC 設定</block>
  <block id="5c87e825763ec1e41a459f6baa4b2a44" category="doc">Oracle Real Application叢集（RAC）</block>
  <block id="0eec903bb9d87349e379892ca99ef9ec" category="paragraph">Oracle RAC 是一款叢集軟體產品、內含多種類型的內部活動訊號處理程序、可監控叢集的健全狀況。</block>
  <block id="7c13d022c9fda6e792c4349a043a6c74" category="inline-link-macro">遺失計數</block>
  <block id="bab4ae46619fcbbb84e3375ef205e61c" category="admonition">中的資訊 <block ref="9cd17d807316d35ef47b12cbecab4ec8" category="inline-link-macro-rx"></block> 本節包含使用網路儲存設備的 Oracle RAC 環境的重要資訊、在許多情況下、需要變更預設 Oracle RAC 設定、以確保 RAC 叢集在網路路徑變更和儲存設備容錯移轉 / 切換作業之後仍能順利運作。</block>
  <block id="0494651671c3dc7f1ccdf99a4368a2cf" category="section-title">磁碟逾時</block>
  <block id="1973cfff3b7c6d828ede9d420b8481b5" category="paragraph">主要儲存相關 RAC 參數為<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block>。此參數控制投票檔案 I/O 必須完成的臨界值。如果是<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block> 超過參數、 RAC 節點就會從叢集中移出。此參數的預設值為 200 。此值應足以用於標準儲存設備接管和恢復程序。</block>
  <block id="4aa33fc988e36b9531d36da80d35ec2f" category="paragraph">NetApp 強烈建議您在將 RAC 組態投入生產之前、先徹底測試這些組態、因為許多因素會影響接管或恢復作業。除了完成儲存容錯移轉所需的時間之外、連結集合化控制傳輸協定（ LACP ）變更也需要額外的時間才能傳播。此外、 SAN 多重路徑軟體必須偵測 I/O 逾時、然後在替代路徑上重試。如果資料庫處於極活躍狀態、則必須在處理投票磁碟 I/O 之前、先佇列並重新嘗試大量 I/O 。</block>
  <block id="655a10764a0781d26dca3bfb939457b7" category="paragraph">如果無法執行實際的儲存接管或恢復、則可以在資料庫伺服器上進行纜線拉出測試來模擬影響。</block>
  <block id="b2a9e8dd67b2d9a7333cb2c2495c2aa5" category="list-text">離開<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block> 預設值為 200 的參數。</block>
  <block id="971a52f4b805c654dd133cf142457c53" category="list-text">務必徹底測試 RAC 組態。</block>
  <block id="cd7a91511dbfbe5c79de12fa7d394dc0" category="paragraph">。<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 參數通常只會影響 RAC 節點之間的網路心跳。預設值為 30 秒。如果網格二進位檔位於儲存陣列上、或作業系統開機磁碟機不是本機磁碟機、此參數可能會變得很重要。這包括 FC SAN 上具有開機磁碟機的主機、 NFS 開機作業系統、以及位於虛擬化資料存放區（例如 VMDK 檔案）上的開機磁碟機。</block>
  <block id="9c1fd24d7d8e04847dadb944a6643121" category="paragraph">如果因儲存接管或恢復而中斷開機磁碟機的存取、網格二進位位置或整個作業系統可能會暫時停止運作。ONTAP 完成儲存作業所需的時間、以及作業系統變更路徑和恢復 I/O 所需的時間、可能會超過<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 臨界值。因此、節點會在連線到開機 LUN 或網格二進位檔恢復後立即停止。在大多數情況下、會發生遷離和後續重新開機、而不會出現記錄訊息來指出重新開機的原因。並非所有組態都會受到影響、因此請在 RAC 環境中測試任何 SAN 開機、 NFS 開機或資料存放區型主機、以便在與開機磁碟機的通訊中斷時、 RAC 保持穩定。</block>
  <block id="2b875dbca82565f3d7e2fa51633bc2c9" category="paragraph">非本機開機磁碟機或非本機檔案系統代管的情況<block ref="ff4a008470319a22d9cf3d14af485977" prefix=" " category="inline-code"></block> 二進位檔案<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 需要變更以符合<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block>。如果變更此參數、請進行進一步測試、以識別對 RAC 行為的任何影響、例如節點容錯移轉時間。</block>
  <block id="08d7a86ed9292993deaa28bee18d5ce5" category="list-text">離開<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 參數的預設值為 30 、除非符合下列其中一項條件：</block>
  <block id="5b46e861366ffd98cd94c26abf2bf550" category="list-text"><block ref="ff4a008470319a22d9cf3d14af485977" prefix="" category="inline-code"></block> 二進位檔位於網路附加磁碟機上、包括 NFS 、 iSCSI 、 FC 和資料存放區型磁碟機。</block>
  <block id="7ace6d79e63cb29c86093526fbddf845" category="list-text">作業系統是 SAN 開機。</block>
  <block id="985511d6258bbf659d35bd76e0b0cea1" category="list-text">在這種情況下、請評估網路中斷對 OS 或的存取造成的影響<block ref="9599929f8663b5e2093f7bc5cb20b0c2" prefix=" " category="inline-code"></block> 檔案系統。在某些情況下、這類中斷會導致 Oracle RAC 精靈停止運作、進而導致<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block>根據的逾時和遷離。逾時預設為 27 秒、即的值<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 減號<block ref="c9333b0a26b9f9e9fd808e6238d613b0" prefix=" " category="inline-code"></block>。在這種情況下、請增加<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 200 比對<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block>。</block>
  <block id="6cde0106c3eb71034259ac34de5e6a2c" category="summary">Oracle filesystemio_options</block>
  <block id="a3f7c31b8d967e0ac9f9dd30fc81c061" category="paragraph">Oracle 初始化參數<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 控制非同步和直接 I/O 的使用</block>
  <block id="d1fa3441fd96418a75a509ac2907d644" category="paragraph">與一般的看法相反、非同步和直接 I/O 並不相互排斥。NetApp 發現、在客戶環境中、此參數經常設定錯誤、而這種錯誤設定直接導致許多效能問題。</block>
  <block id="0775b72ddf51e2a16e466ee2df8f75ab" category="paragraph">非同步 I/O 表示 Oracle I/O 作業可以平行化。在各種作業系統上均可使用非同步 I/O 之前、使用者已設定數個 dbwriter 程序、並變更伺服器程序組態。透過非同步 I/O 、作業系統本身就能以高效率且平行的方式代表資料庫軟體執行 I/O 。此程序不會讓資料面臨風險、而且關鍵作業（例如 Oracle 重做記錄）仍會同步執行。</block>
  <block id="6b72950206966c1983e559eb6886ec69" category="paragraph">直接 I/O 會略過作業系統緩衝區快取。UNIX 系統上的 I/O 通常會流經作業系統緩衝區快取。這對不維護內部快取的應用程式很有用、但 Oracle 在 SGA 中擁有自己的緩衝區快取。在幾乎所有情況下、最好是啟用直接 I/O 並將伺服器 RAM 分配給 SGA 、而非仰賴作業系統緩衝區快取。Oracle SGA 更有效率地使用記憶體。此外、當 I/O 流經作業系統緩衝區時、它會受到額外處理、因此會增加延遲。當低延遲是關鍵需求時、在大量寫入 I/O 時、延遲特別明顯。</block>
  <block id="d8590a940a5bb30d8a845f4359f3c779" category="paragraph">的選項<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 是：</block>
  <block id="0aea10c6719256027228a859db38f291" category="list-text">* 非同步 * 。 * Oracle 將 I/O 要求提交給作業系統以進行處理。此程序可讓 Oracle 執行其他工作、而非等待 I/O 完成、進而增加 I/O 平行化。</block>
  <block id="00cb0cc309682c42b3b936a19a042434" category="list-text">*directio.* Oracle 直接針對實體檔案執行 I/O 、而非透過主機作業系統快取來路由 I/O 。</block>
  <block id="f9941e1b6cc84711e95db0e757efc36a" category="list-text">* 無。 * Oracle 使用同步和緩衝 I/O在此組態中、選擇共享與專用伺服器程序與 dbWriters 數量更為重要。</block>
  <block id="f0939ff6231565c83c5c8c9ce1eddc9d" category="list-text">*setall.* Oracle 同時使用非同步和直接 I/O在幾乎所有情況下、都是使用<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block> 是最佳的。</block>
  <block id="8647b2eaf101a9425f69e6f2e67aeb9d" category="admonition">。<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 參數在 DNFS 和 ASM 環境中無效。使用 DNFS 或 ASM 時、會自動同時使用非同步和直接 I/O</block>
  <block id="6dd5604aa0be2956f8b1b41c74fa648e" category="paragraph">有些客戶過去曾遇到非同步 I/O 問題、尤其是先前的 Red Hat Enterprise Linux 4 （ RHEL4 ）版本。網際網路上有些過時的建議仍建議避免非同步 IO 、因為資訊過時。在所有目前的作業系統上、非同步 I/O 都是穩定的。沒有理由停用它、作業系統沒有已知的錯誤。</block>
  <block id="1ea377466376b194b2d1bfc3ab2fa4c4" category="paragraph">如果資料庫已使用緩衝 I/O 、則直接 I/O 的交換器也可能需要變更 SGA 大小。停用緩衝 I/O 可消除主機作業系統快取為資料庫提供的效能優勢。將 RAM 新增回 SGA 可修復此問題。最終結果應該是 I/O 效能的改善。</block>
  <block id="787b3d8b62af05ac3efd1c9ca7a8fc7e" category="paragraph">雖然 Oracle SGA 使用 RAM 幾乎比使用 OS 緩衝區快取更好、但可能無法判斷最佳值。例如、最好在資料庫伺服器上使用具有極小型 SGA 大小的緩衝 I/O 、其中有許多間歇性作用中的 Oracle 執行個體。這種配置可讓所有執行中的資料庫執行個體靈活使用作業系統上的剩餘可用 RAM 。這是非常不尋常的情況、但在某些客戶據點已發現這種情況。</block>
  <block id="d4157ab77eb31459bd406aa0f873e20c" category="admonition">* NetApp 建議 * 設定<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 至<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block>但請注意、在某些情況下、遺失主機緩衝區快取可能需要增加 Oracle SGA 。</block>
  <block id="caa6d47f2f011d5d1b5fb830e85a37f0" category="summary">Oracle 區塊大小</block>
  <block id="6db776dab2989df63d245511a4dccf08" category="doc">Oracle 區塊大小</block>
  <block id="f8b42f9efd1a05ede10b0e0c11dfa8b0" category="paragraph">ONTAP 內部使用可變的區塊大小、這表示 Oracle 資料庫可以設定任何所需的區塊大小。不過、檔案系統區塊大小可能會影響效能、在某些情況下、較大的重做區塊大小可能會改善效能。</block>
  <block id="0944aedb4703c4a5e94fb90de9d7a22f" category="section-title">資料檔案區塊大小</block>
  <block id="cc4662c047050e0082701ce6f052dcb7" category="paragraph">部分作業系統提供多種檔案系統區塊大小選擇。對於支援 Oracle 資料檔案檔案的檔案系統、使用壓縮時區塊大小應為 8KB 。不需要壓縮時、可以使用 8KB 或 4KB 的區塊大小。</block>
  <block id="e1a001cf8c7e2072c7a44ee65e8fee11" category="paragraph">如果資料檔案放在具有 512 位元組區塊的檔案系統上、則可能會有未對齊的檔案。根據 NetApp 建議、 LUN 和檔案系統可能已正確對齊、但檔案 I/O 可能未對齊。這種錯誤的調整會導致嚴重的效能問題。</block>
  <block id="9514c8638f798f68108498dd218ec793" category="paragraph">支援重做記錄的檔案系統必須使用重做區塊大小的倍數。這通常需要重做記錄檔系統和重做記錄本身都使用 512 位元組的區塊大小。</block>
  <block id="cac7d87a1164763b666ca7d02109d153" category="section-title">重做區塊大小</block>
  <block id="fa06b9584ea36af182742c07894220f0" category="paragraph">重做率極高時、 4KB 區塊大小可能會執行得更好、因為重做率較高、可在較少且更有效率的作業中執行 I/O 。如果重做速率大於 50Mbps 、請考慮測試 4KB 區塊大小。</block>
  <block id="781000593b4913b5625dd5ed9eebe87e" category="paragraph">在具有 4KB 區塊大小和許多極小型交易的檔案系統上、使用 512 位元組區塊大小的重做記錄檔來識別資料庫中的一些客戶問題。將多個 512 位元組的變更套用到單一 4KB 檔案系統區塊所涉及的額外負荷、導致效能問題、而這些問題已透過將檔案系統變更為使用 512 位元組的區塊大小來解決。</block>
  <block id="a02416fde36b174cf1196213fcf1bef6" category="admonition">* NetApp 建議 * 除非相關客戶支援或專業服務組織建議您變更重做區塊大小、否則請勿變更重做區塊大小、否則變更將以正式產品文件為基礎。</block>
  <block id="00783c075f877e6e69c64079296967ed" category="summary">使用 ONTAP 進行 Oracle 災難恢復</block>
  <block id="6a87f84ba62b57e5643d5bfa5967c7a8" category="doc">使用 ONTAP 進行災難恢復</block>
  <block id="65a6ece62f52a5e2ff74baaae821ae86" category="paragraph">災難恢復是指在發生災難性事件（例如破壞儲存系統甚至整個站台的火災）之後還原資料服務。</block>
  <block id="e168b3b0b2f075f39012df52c5ea3c0a" category="admonition">本文件取代先前發佈的技術報告 _TR-4591 ： Oracle Data Protection _ 和 _TR-4592 ： Oracle on MetroCluster 。 _</block>
  <block id="a91982f09e6a0341a90dae002865ea11" category="paragraph">當然、災難恢復可以透過使用 SnapMirror 簡單複寫資料來完成、許多客戶會在每小時更新鏡射複本。</block>
  <block id="0f1b72a875a2bcb3d0e844ca2dcee233" category="paragraph">對於大多數客戶而言、 DR 不只需要擁有遠端資料複本、還需要能夠快速使用該資料。NetApp 提供兩種技術來滿足這種需求： MetroCluster 和 SnapMirror 業務連續性（ SM-BC ）</block>
  <block id="ad2c5e9521f13e89cd84fdd65ec96c7d" category="paragraph">MetroCluster 指的是硬體組態中的 ONTAP 、其中包括低階同步鏡射儲存設備和許多其他功能。MetroCluster 等整合式解決方案可簡化現今複雜的橫向擴充資料庫、應用程式及虛擬化基礎架構。它以一個簡單的中央儲存陣列取代多種外部資料保護產品和策略。它也能在單一叢集式儲存系統中提供整合式備份、還原、災難恢復和高可用度（ HA ）。</block>
  <block id="05be1e741eba1ac3f0b7c924f261403b" category="paragraph">SnapMirror Business Continuity （ SM-BC ）是以 SnapMirror Synchronous 為基礎。使用 MetroCluster 、每個 ONTAP 控制器都負責將其磁碟機資料複寫到遠端位置。有了 SM-BC 、您基本上擁有兩個不同的 ONTAP 系統、可維護獨立的 LUN 資料複本、但可以合作呈現該 LUN 的單一執行個體。從主機的角度來看、這是單一 LUN 實體。</block>
  <block id="70f47db03a0843fec433c8cc41a54635" category="paragraph">雖然 SMBC 和 MetroCluster 在內部的運作方式非常不同、但對於主機而言、結果卻非常相似。主要差異在於精細度。如果您只需要選取要同步複寫的工作負載、則 SMBC 是更好的選擇。如果您需要複寫整個環境、甚至是資料中心、 MetroCluster 是更好的選擇。此外、 SMBC 目前僅限 SAN 、而 MetroCluster 則是多重傳輸協定、包括 SAN 、 NFS 和 SMB 。</block>
  <block id="7389dc8e47495ffdde7fd2e0fc19df20" category="summary">使用 SM-BC 進行 Oracle 容錯移轉</block>
  <block id="0a54809bbd5dc721967217b79aa04429" category="paragraph">在 SM-BC 上託管 Oracle 資料庫的主要原因、是在計畫性和非計畫性儲存事件期間提供透明的容錯移轉。</block>
  <block id="cfb8f86af03363ef2c73933e34108390" category="summary">ONTAP 上的 Oracle 單一執行個體、搭配 SM-BC</block>
  <block id="f25228759326d365adf4dca6b7b2cb8b" category="doc">單一執行個體 Oracle 搭配 SM-BC</block>
  <block id="a38cb04f35bd24313f90398cdc07e149" category="paragraph">下圖顯示一個簡單的部署模式、您可以將儲存裝置分區或從主要和遠端儲存叢集連線至 Oracle 資料庫。</block>
  <block id="ac38db4f14e512b48d088eedb84cd611" category="paragraph">Oracle 僅在主要系統上設定。此模式可因應儲存端災難時的無縫儲存容錯移轉、在沒有任何應用程式停機的情況下、不會造成資料遺失。然而、此模型無法在站台故障期間提供資料庫環境的高可用度。這類架構對於想要尋找零資料遺失解決方案、且儲存服務可用度高的客戶而言非常實用、但請接受、資料庫叢集的整體遺失需要手動作業。</block>
  <block id="ccc53ca027c7d8fb1e0d647249fd67cd" category="paragraph"><block ref="ccc53ca027c7d8fb1e0d647249fd67cd" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4e072ef2eba1c46e59475046cd4fb880" category="paragraph">這種方法也能節省 Oracle 授權成本。在遠端站台上預先設定 Oracle 資料庫節點時、所有核心都必須根據大多數 Oracle 授權合約獲得授權。如果安裝 Oracle 資料庫伺服器和掛載仍在運作的資料複本所需的時間所造成的延遲是可以接受的、則此設計可能非常具成本效益。</block>
  <block id="5e2dd7c2fa063e6d7af964efc0e488a0" category="summary">ONTAP 上的 Oracle RAC 搭配 SM-BC</block>
  <block id="f7d366254f13816be07d3c8dff4ef00c" category="doc">Oracle RAC 搭配 SM-BC</block>
  <block id="67bbc9e19672ee6c9c548cae8a472396" category="paragraph">SM-BC 可針對資料集複寫提供精細的控制、例如負載平衡或個別應用程式容錯移轉。整體架構看起來像延伸 RAC 叢集、但有些資料庫是專供特定站台使用、整體負載則分散。</block>
  <block id="9331b3ad2bcf259818157930e1c82ad3" category="paragraph">例如、您可以建置一個 Oracle RAC 叢集、主控六個個別資料庫。其中三個資料庫的儲存設備主要託管於站台 A 、其他三個資料庫的儲存設備則裝載於站台 B此組態可將跨網站流量降至最低、以確保最佳效能。此外、應用程式也會設定為使用儲存系統本機的資料庫執行個體、並使用作用中路徑。如此可將 RAC 互連流量降至最低。最後、這項整體設計可確保所有運算資源均能平均使用。隨著工作負載改變、資料庫可以在站台之間選擇性地來回容錯、以確保負載均勻。</block>
  <block id="4278792a47efb1e599476fe07109dca4" category="inline-link-macro">MetroCluster 上的 Oracle RAC</block>
  <block id="1c6753ccdcc6629af3e1febabbf271b5" category="paragraph">除了精細度之外、使用 SM-BC 的 Oracle RAC 的基本原則和選項與相同 <block ref="f7453402f1e4779ea0ec67d873358932" category="inline-link-macro-rx"></block></block>
  <block id="7e544b57620f5cdeb71865606eab0549" category="summary">Oracle with SnapMirror Business Continuity （ SM-BC ）</block>
  <block id="33aa8b7a84723347d228956fab2a4de8" category="doc">Oracle 和 SnapMirror 業務持續運作</block>
  <block id="41eec95e0dbb542c5cd25248ec5759d5" category="paragraph">SM-BC 可為個別 Oracle 資料庫和應用程式環境啟用選擇性 RPO =0 同步鏡射。</block>
  <block id="563d0bf19fd5d623a031d90c30128dc1" category="summary">Oracle SM-BC 故障案例</block>
  <block id="3c1ea312a3c6648fc3f94a1ccd12bebc" category="doc">Oracle SM-BC 故障案例</block>
  <block id="87777c84375810d8b6fd65f604dd2561" category="paragraph">有多種 SnapMirror Business Continuity （ SM-BC ）故障案例、每種案例的結果各不相同。</block>
  <block id="8eea62084ca7e541d918e823422bd82e" category="cell">結果</block>
  <block id="ee70ac41df7240931fee4110b599c39f" category="cell">複寫連結失敗</block>
  <block id="e79e76eca171f3e596eb56ba4bb24743" category="cell">中介程序可辨識這種分割腦案例、並在保留主複本的節點上恢復 I/O 。當站台之間的連線恢復上線時、替代站台會執行自動重新同步。</block>
  <block id="98a638ba6cee257a8f751bcf8d30e1f2" category="cell">主要站台儲存設備故障</block>
  <block id="b92af6cefecfe68535bbd851b797379f" category="cell">自動非計畫性容錯移轉是由 Mediator 啟動。

無 I/O 中斷。</block>
  <block id="ce9a584219636ca5b159a27f2dd8c445" category="cell">遠端站台儲存設備故障</block>
  <block id="68a293bd16c4e2589057d43506a5afbd" category="cell">沒有 I/O 中斷。由於網路造成同步複寫中斷、主機確認其擁有者是合法的 I/O 服務者（共識）、因此暫時暫停。因此、 I/O 暫停數秒、然後 I/O 就會恢復。

網站上線時會自動重新同步。</block>
  <block id="64f4e3573d0b569ef7b5a08476fb9f7d" category="cell">Mediator 或 Mediator 與儲存陣列之間的連結遺失</block>
  <block id="7e7abe23ef8e465ee1b6879b35e6bab3" category="cell">I/O 會繼續並與遠端叢集保持同步、但如果沒有 Mediator 、則無法自動進行非計畫性 / 計畫性容錯移轉和容錯回復。</block>
  <block id="96b352ebd03c8c5b7589a527b18f1a2d" category="cell">HA 叢集中的其中一個儲存控制器遺失</block>
  <block id="426c4468c3cc76191842240593fcfec3" category="cell">HA 叢集中的合作夥伴節點會嘗試接管（ n ）。如果接管失敗、 Mediator 會注意到儲存設備中的兩個節點都已關閉、並自動執行非計畫性容錯移轉至遠端叢集。</block>
  <block id="0e578c93ab393c3d449d484e9fa4b84e" category="cell">磁碟遺失</block>
  <block id="3d5fea5d89ec844fc92c08a585050e4e" category="cell">IO 會持續連續三次發生磁碟故障。這是 RAID-TEC 的一部分。</block>
  <block id="bd300f92769c0ee071832cadaff91f04" category="cell">在一般部署中遺失整個站台</block>
  <block id="9cfa40a514d333ea10de6fc8a75ac663" category="cell">故障站台上的伺服器顯然無法再使用。支援叢集的應用程式可設定為在兩個站台上執行、並在其他站台上繼續作業、不過大多數的應用程式都需要類似於 SM-BC 需要中介程式的第三站台斷路器。

如果沒有應用程式層級的叢集、應用程式就必須在正常運作的站台上啟動。這會影響可用性、但會保留 RPO =0 。不會遺失任何資料。</block>
  <block id="f2762385d394491398659925e75d5d01" category="summary">MetroCluster 實體架構 - Oracle</block>
  <block id="5be41b602a41d06df45e8986ec09a8dc" category="doc">MetroCluster 實體架構 - Oracle</block>
  <block id="d12be40db836559c628e8024f5d6ff56" category="paragraph">瞭解 Oracle 資料庫在 MetroCluster 環境中的運作方式、需要對 MetroCluster 系統的實體設計進行一些說明。</block>
  <block id="5e33c0d8a2417ce5fb6e7a211ad063bb" category="admonition">本文件取代先前發佈的技術報告 _TR-4592 ： Oracle on MetroCluster 。 _</block>
  <block id="bdec122112fe3ad35d588380dc643e48" category="summary">MetroCluster 邏輯架構 - Oracle</block>
  <block id="141402e8d9fa946970f252a09a01a462" category="doc">MetroCluster 邏輯架構 - Oracle</block>
  <block id="37fa92fc2662529308c62c84eb1b38ea" category="paragraph">瞭解 Oracle 資料庫在 MetroCluster 環境中的運作方式需要對 MetroCluster 系統的邏輯功能進行一些說明。</block>
  <block id="2623b589ddbc1cdb6184ba32aa06e83f" category="inline-link-macro">NVFAIL</block>
  <block id="6ddd3d6bc3ad92b983699970b1596e0f" category="summary">Oracle with MetroCluster</block>
  <block id="c1fac7a72cd91bcd345e567f6d6d93a3" category="doc">MetroCluster 的 Oracle 容錯移轉</block>
  <block id="7a60cb119af7ddcdfe38fc872d2027a1" category="paragraph">使用 MetroCluster 並不一定能新增或變更營運企業應用程式和資料庫的任何最佳實務做法。</block>
  <block id="a4feacea8b05d0f24e5a4612a164a055" category="paragraph">通常的最佳實務做法仍適用、如果您的需求只需要 RPO = 0 資料保護、則 MetroCluster 會滿足您的需求。然而、大多數客戶不僅使用 MetroCluster 來保護 RPO =0 資料、還能在災難期間改善 RTO 、並在站台維護活動中提供透明的容錯移轉。</block>
  <block id="3ff8bcf18c694581aa25b0a347508e0f" category="section-title">使用預先設定的作業系統進行容錯移轉</block>
  <block id="9bd9ad7f296a0e8ac3df804b3c6a392f" category="paragraph">SyncMirror 在災難恢復站點上提供資料的同步複本、但要讓資料可用、則需要作業系統和相關應用程式。基本自動化可大幅改善整體環境的容錯移轉時間。Oracle RAC 、 Veritas 叢集伺服器（ VCS ）或 VMware HA 等叢集式產品通常用於在站台之間建立叢集、在許多情況下、容錯移轉程序可以使用簡單的指令碼來驅動。</block>
  <block id="c5a2f3b867d990c681a218d29a55fcfa" category="paragraph">如果主節點遺失、叢集軟體（或指令碼）會設定為在替代站台上線應用程式。其中一個選項是建立預先針對構成應用程式的 NFS 或 SAN 資源所預先設定的待命伺服器。如果主站台發生故障、叢集軟體或指令碼替代方案會執行類似下列的一系列動作：</block>
  <block id="442f34633164f1be348a442b2c62d29d" category="list-text">強制 MetroCluster 進行重新操作</block>
  <block id="e081e79ea1b1040c51d4a452e46de76d" category="list-text">執行 FC LUN 探索（僅限 SAN ）</block>
  <block id="6f3fd86521759fc98ed93853eaf8a03a" category="list-text">掛載檔案系統</block>
  <block id="9d9ea7a9c532a3cec63305130018a45b" category="list-text">啟動應用程式</block>
  <block id="b8eca7b573624230962095fcadb03ddf" category="paragraph">此方法的主要需求是在遠端站台上執行作業系統。它必須預先設定應用程式二進位檔、也就是說、修補等工作必須在主要站台和待命站台上執行。或者、應用程式二進位檔可鏡射至遠端站台、並在宣告災難時掛載。</block>
  <block id="e60946bf73021e18706a6ac33386b376" category="paragraph">實際的啟動程序很簡單。LUN 探索等命令每個 FC 連接埠只需要幾個命令。檔案系統掛載只不過是<block ref="19822b1b15d9eefc54c07ab49f87b100" prefix=" " category="inline-code"></block> 只需一個命令、即可在 CLI 上啟動和停止資料庫和 ASM 。如果在切換之前、磁碟區和檔案系統並未在災難恢復站台上使用、則無需設定<block ref="3b93661df04b698b1340ff2da3238d16" prefix=" " category="inline-code"></block> 在磁碟區上。</block>
  <block id="486eed21f55b6fb544db5504294592e6" category="section-title">使用虛擬化作業系統進行容錯移轉</block>
  <block id="bf65e943f86f26b49698bfdac9b95f81" category="paragraph">資料庫環境的容錯移轉可延伸至包含作業系統本身。理論上、此容錯移轉可以使用開機 LUN 來完成、但通常是使用虛擬化的作業系統來完成。此程序類似於下列步驟：</block>
  <block id="7c37589384e83d2b43bba430c18a45aa" category="list-text">裝載託管資料庫伺服器虛擬機器的資料存放區</block>
  <block id="3d4d04d6cdab90b7ca0deb0344f04eec" category="list-text">啟動虛擬機器</block>
  <block id="ba2f22f63087151f0a0694be5f35fcf2" category="list-text">手動啟動資料庫、或將虛擬機器設定為自動啟動資料庫</block>
  <block id="810078f3b19b93e24de8638d68f727b5" category="paragraph">例如、 ESX 叢集可以跨越站台。在發生災難時、虛擬機器可在移至災難恢復站台後上線。只要主控虛擬化資料庫伺服器的資料存放區在災難發生時並未使用、就不需要設定<block ref="3b93661df04b698b1340ff2da3238d16" prefix=" " category="inline-code"></block> 在相關的磁碟區上。</block>
  <block id="681afe3bdc351138642f233429d64762" category="summary">Oracle 與 SyncMirror</block>
  <block id="bc8a6c6eac662831d2ddce97adbd4324" category="doc">SyncMirror - Oracle</block>
  <block id="c702c387f07bcb4f18482e68d69a155a" category="paragraph">SyncMirror 是 MetroCluster 系統的 Oracle 資料保護基礎、是最大效能的橫向擴充同步鏡射技術。</block>
  <block id="9028b52caaa7bdbfb9be779eeb1fe00e" category="summary">Oracle Extended RAC with MetroCluster</block>
  <block id="dbcedb2fd86e6012347a3c9ad111f3a8" category="doc">MetroCluster 上的延伸 Oracle RAC</block>
  <block id="4d4d8a609e5b2ac58e622eb1e90f9e39" category="paragraph">許多客戶透過在各個站台之間延伸 Oracle RAC 叢集來最佳化 RTO 、進而實現完全主動式的組態。整體設計變得更複雜、因為它必須包含 Oracle RAC 的仲裁管理。此外、從兩個站台存取資料、這表示強制轉換可能會導致使用過時的資料複本。</block>
  <block id="89ffaa1a7d089080e9a1ce912bb8c2d3" category="paragraph">雖然兩個站台上都有資料複本、但只有目前擁有 Aggregate 的控制器才能提供資料。因此、使用擴充的 RAC 叢集時、遠端節點必須透過站台對站台連線來執行 I/O 。結果會增加 I/O 延遲、但這種延遲通常不是問題。RAC 互連網路也必須延伸至站台、這表示無論如何都需要高速、低延遲的網路。如果增加的延遲確實造成問題、則叢集可以主動被動方式運作。接著、需要將 I/O 密集作業導向至擁有該集合體的控制器本機的 RAC 節點。然後、遠端節點會執行較輕的 I/O 作業、或純粹作為暖待機伺服器使用。</block>
  <block id="375c3caa97162bd0c2c07869d9c5b026" category="paragraph">如果需要雙主動式擴充 RAC 、則應考慮使用 ASM 鏡像來取代 MetroCluster 。ASM 鏡像可讓您偏好資料的特定複本。因此、可以內建擴充 RAC 叢集、讓所有讀取作業都在本機進行。讀取 I/O 永遠不會跨越網站、因此可提供最低的延遲。所有寫入活動仍必須傳輸站台間連線、但任何同步鏡射解決方案都無法避免此類流量。</block>
  <block id="f441d5fdc388f3419fb87e071534f3ce" category="inline-link-macro">Oracle RAC 搭配 ONTAP</block>
  <block id="59d934fc4614a6275fef2828bfab30cf" category="admonition">如果開機 LUN （包括虛擬化開機磁碟）與 Oracle RAC 搭配使用、請使用<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 可能需要變更參數。如需 RAC 逾時參數的詳細資訊、請參閱 <block ref="75080d28a1748f78cf8a666ababf51af" category="inline-link-macro-rx"></block>。</block>
  <block id="58285fb769eb7fb05ab12d9e0efb3e50" category="section-title">雙站台組態</block>
  <block id="af1184f29d838fbfec8d5b5bf5225f66" category="paragraph">雙站台擴充 RAC 組態可提供雙主動式資料庫服務、可在不中斷營運的情況下、在許多（但並非全部）災難案例中順利運作。</block>
  <block id="7544489c7854fcae445508015240a865" category="section-title">RAC 投票檔案</block>
  <block id="8b6e46422f88dab6ea82f2dbcadfc76b" category="paragraph">在 MetroCluster 上部署擴充 RAC 時、首先應考慮仲裁管理。Oracle RAC 有兩種機制可管理仲裁：磁碟心跳和網路心跳。磁碟心跳會使用投票檔案來監控儲存設備存取。只要基礎儲存系統提供 HA 功能、單一投票資源就足以搭配單一站台 RAC 組態。</block>
  <block id="fafd618b82d1827eeb8197e1c38722bc" category="paragraph">在早期版本的 Oracle 中、投票檔案會放置在實體儲存裝置上、但在目前版本的 Oracle 中、投票檔案會儲存在 ASM 磁碟群組中。</block>
  <block id="aeab2391a07321ac474989b9c9047226" category="admonition">NFS 支援 Oracle RAC 。在網格安裝程序期間、會建立一組 ASM 程序、將用於網格檔案的 NFS 位置顯示為 ASM 磁碟群組。此程序對終端使用者來說幾乎透明、安裝完成後不需要持續進行 ASM 管理。</block>
  <block id="42aca4aae768d5ec1cb0c50d41b7b8b7" category="paragraph">雙站台組態的第一項需求是確保每個站台都能以保證不中斷災難恢復程序的方式存取超過半數的投票檔案。這項工作在投票檔案儲存在 ASM 磁碟群組之前很簡單、但現在管理員必須瞭解 ASM 備援的基本原則。</block>
  <block id="60a723853bb2c173648452baf2199e73" category="paragraph">ASM 磁碟群組有三種備援選項<block ref="6a21b6995a068148bbb65c8f949b3fb2" prefix=" " category="inline-code"></block>、<block ref="fea087517c26fadd409bd4b9dc642555" prefix=" " category="inline-code"></block>和<block ref="8d966b2253a917086c8604959e152243" prefix=" " category="inline-code"></block>。換句話說、非鏡射、鏡射和 3 向鏡射。名為的較新選項<block ref="09d2bd168181f1e64c2b1651a80a8aa8" prefix=" " category="inline-code"></block> 也可以使用、但很少使用。備援裝置的備援層級和放置位置可控制故障情況發生的情況。例如：</block>
  <block id="32cdeb2c0245b51a0b590e6054f03c21" category="list-text">將投票檔案放在上<block ref="d4f266c5956ee60df748738c483f3dc0" prefix=" " category="inline-code"></block> 與<block ref="6a21b6995a068148bbb65c8f949b3fb2" prefix=" " category="inline-code"></block> 如果站台間連線中斷、備援資源保證可收回一個站台。</block>
  <block id="a549b4f1fc0c2d14bc333c70bbde73dc" category="list-text">將投票檔案放在上<block ref="d4f266c5956ee60df748738c483f3dc0" prefix=" " category="inline-code"></block> 與<block ref="fea087517c26fadd409bd4b9dc642555" prefix=" " category="inline-code"></block> 如果站台間連線中斷、每個站台只有一個 ASM 磁碟的備援功能可確保兩個站台的節點遷離、因為兩個站台都不會有大部分的仲裁。</block>
  <block id="c15f1c43a368db0ab3dde90eca52582d" category="list-text">將投票檔案放在上<block ref="d4f266c5956ee60df748738c483f3dc0" prefix=" " category="inline-code"></block> 與<block ref="8d966b2253a917086c8604959e152243" prefix=" " category="inline-code"></block> 當兩個站台都可以運作且彼此可連線時、一個站台上有兩個磁碟和另一個站台上的單一磁碟的備援功能可讓雙主動式作業運作。但是、如果單一磁碟站台與網路隔離、則該站台會被逐出。</block>
  <block id="478ced47a1ea1d6f0db02af749bfdaec" category="section-title">RAC 網路心跳</block>
  <block id="2432333dc52d6150fb3d58051bc8b0c2" category="paragraph">Oracle RAC 網路活動訊號可監控叢集互連中的節點可連性。若要保留在叢集中、節點必須能夠連絡其他節點的一半以上。在雙站台架構中、此需求會為 RAC 節點數建立下列選項：</block>
  <block id="3e36a59c8a51ee9cc2cba0e7051ed35f" category="list-text">如果每個站台放置相同數量的節點、則會在網路連線中斷時、在某個站台上造成遷離。</block>
  <block id="4955aede919912b3c62fadbc1039671b" category="list-text">在另一個站台上放置 N 個節點、在另一個站台上放置 N+1 個節點、可確保站台之間的連線中斷、導致站台的網路仲裁中剩餘節點數量較多、而節點移出數量較少的站台。</block>
  <block id="80bd651a66488201c928634689e2e5cc" category="paragraph">在 Oracle 12cR2 之前、無法控制哪一方在站台遺失時會發生遷離。當每個站台的節點數量相等時、會由主要節點控制遷離、這通常是第一個要開機的 RAC 節點。</block>
  <block id="d128c05245b2e633856a5061db176b7e" category="paragraph">Oracle 12cR2 引進節點加權功能。這項功能可讓管理員更有效地控制 Oracle 如何解決大腦分裂狀況。例如、下列命令可設定 RAC 中特定節點的偏好設定：</block>
  <block id="104c5747f0d9dbb47b0d09953c709a8d" category="paragraph">重新啟動 Oracle 高可用度服務後、組態如下所示：</block>
  <block id="693cce334ab6658c73ea67674775156b" category="paragraph">節點<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> 現已指定為關鍵伺服器。如果兩個 RAC 節點是隔離的、<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> 生存、和<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block> 被逐出。</block>
  <block id="386839b09451962d03e26b7bbfabce74" category="admonition">如需完整詳細資料、請參閱 Oracle 白皮書《 Oracle Clusterware 12c Release 2 Technical Overview 》。」</block>
  <block id="11f65689342acc8f71c8014eeb7945ee" category="paragraph">對於 12cR2 之前的 Oracle RAC 版本、可透過檢查 CRS 記錄來識別主節點、如下所示：</block>
  <block id="c8b8cd80b31dac17fb85459c341042bd" category="paragraph">此記錄表示主節點為<block ref="c81e728d9d4c2f636f067f89cc14862c" prefix=" " category="inline-code"></block> 和節點<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> ID 為<block ref="c4ca4238a0b923820dcc509a6f75849b" prefix=" " category="inline-code"></block>。這意味著<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> 不是主節點。您可以使用命令確認主節點的身分識別<block ref="08e7c60bbf8289a563b25cc033d431f7" prefix=" " category="inline-code"></block>。</block>
  <block id="fdf6179b59d3f4873b042609a5f09bc4" category="paragraph">識別碼為的節點<block ref="c81e728d9d4c2f636f067f89cc14862c" prefix=" " category="inline-code"></block> 是<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block>，這是主節點。在每個站台上節點數量相等的組態中、站台為<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block> 如果這兩組因為任何原因而失去網路連線、則該站台仍可生存。</block>
  <block id="f2932b43ad604fa01d57212558608ed6" category="paragraph">識別主節點的記錄項目可能會超出系統的使用期限。在這種情況下、可以使用 Oracle 叢集登錄（ OCR ）備份的時間戳記。</block>
  <block id="50cd29958db0c1dcb6505d470f553e54" category="paragraph">此範例顯示主節點是<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block>。它也表示主節點的變更來源<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> 至<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block> 5 月 4 日下午 2 ： 05 至 21 ： 39 之間。這種識別主節點的方法只有在也檢查了 CRS 記錄檔時才安全使用、因為主節點可能自上一次的 OCR 備份後變更。如果發生此變更、則應可在 OCR 記錄中看到。</block>
  <block id="df044a3c3d7f7f244db7c42b347b9a90" category="paragraph">大多數客戶選擇單一投票磁碟群組來服務整個環境、以及每個站台上相同數量的 RAC 節點。磁碟群組應放置在包含資料庫的網站上。結果是連線中斷會導致遠端站台被逐出。遠端站台將不再擁有仲裁、也無法存取資料庫檔案、但本機站台會繼續如常運作。連線恢復後、遠端執行個體即可重新上線。</block>
  <block id="84a24276bfdfbe485b9d961c1a57a830" category="paragraph">發生災難時、需要進行轉換、才能讓資料庫檔案和投票磁碟群組在正常運作的網站上線。如果災難允許 AUSO 觸發切換、則不會觸發 NVFAIL 、因為已知叢集處於同步狀態、且儲存資源正常上線。AUSO 是一項非常快速的作業、應在完成之前完成<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block> 期間過期。</block>
  <block id="6244ee13e435dcc768edbc9b0b38b73e" category="paragraph">由於只有兩個站台、因此無法使用任何類型的自動外部中斷軟體、這表示強制切換必須是手動操作。</block>
  <block id="568c8c12fdb7c74f65125732ee717ad3" category="section-title">三站台組態</block>
  <block id="2c7696fb04f52eb5687d059415066fa7" category="paragraph">擴充的 RAC 叢集可更輕鬆地建構三個站台。裝載 MetroCluster 系統每一半的兩個站台也支援資料庫工作負載、而第三個站台則是資料庫和 MetroCluster 系統的斷路器。Oracle tiebreaker 組態可能只需在第三站台上放置用於投票的 ASM 磁碟群組成員、也可能在第三站台上加入作業執行個體、以確保 RAC 叢集中有奇數個節點。</block>
  <block id="6265611ca77e9ad52249c5fdd4780da9" category="admonition">有關在擴展 RAC 配置中使用 NFS 的重要信息，請參閱 Oracle 文檔中的“ quorum failure group （仲裁故障組）”。總而言之、 NFS 掛載選項可能需要修改以包含軟選項、以確保主仲裁資源所在的第三站台連線中斷、不會使主 Oracle 伺服器或 Oracle RAC 程序掛起。</block>
  <block id="d84d0eea463e72a6e15018c70a45af46" category="doc">Oracle 、 MetroCluster 和 NVFAIL</block>
  <block id="ee6c613c07239c0923d940dfd448493f" category="paragraph">NVFAIL 是 ONTAP 中的一般資料完整性功能、對資料庫工作負載而言特別重要。</block>
  <block id="9dc6a9986107298da2a22e7c5a3efb00" category="summary">MetroCluster 上的 Oracle 單一執行個體</block>
  <block id="f8b28e31633ae72c2971ee8b815ed4af" category="paragraph">如前所述、 MetroCluster 系統的存在並不一定會新增或變更任何操作資料庫的最佳實務做法。目前在客戶 MetroCluster 系統上執行的大多數資料庫都是單一執行個體、並遵循 Oracle on ONTAP 文件中的建議。</block>
  <block id="f4872c843923dd8d8731ef66462b5a99" category="paragraph">SyncMirror 在災難恢復站點上提供資料的同步複本、但要讓資料可用、則需要作業系統和相關應用程式。基本自動化可大幅改善整體環境的容錯移轉時間。例如 Veritas Cluster Server （ VCS ）等叢集件產品通常用於在站台之間建立叢集、而且在許多情況下、容錯移轉程序可以使用簡單的指令碼來驅動。</block>
  <block id="c50820a41eb4f23d0a3acc1eeddb391b" category="paragraph">如果主節點遺失、叢集軟體（或指令碼）會設定為在替代站台上線資料庫。其中一個選項是建立預先設定為 NFS 或 SAN 資源的備用伺服器、以供組成資料庫。如果主站台發生故障、叢集軟體或指令碼替代方案會執行類似下列的一系列動作：</block>
  <block id="2a6f458321ddf666cb0c876ee39255f3" category="list-text">掛載檔案系統和 / 或掛載 ASM 磁碟群組</block>
  <block id="3dee93bd9bc9b8b50dcdd2066a86009f" category="list-text">啟動資料庫</block>
  <block id="620515885465a26daea6cc6441403e34" category="paragraph">此方法的主要需求是在遠端站台上執行作業系統。它必須預先設定 Oracle 二進位檔、這也表示 Oracle 修補等工作必須在主要站台和待命站台上執行。或者、 Oracle 二進位檔可鏡射至遠端站台、並在宣告災難時掛載。</block>
  <block id="edb5332feef69c0aa60ea10ed5d31a9f" category="list-text">手動啟動資料庫、或將虛擬機器設定為自動啟動資料庫、例如 ESX 叢集可能跨越站台。在發生災難時、虛擬機器可在移至災難恢復站台後上線。只要主控虛擬化資料庫伺服器的資料存放區在災難發生時並未使用、就不需要設定<block ref="3b93661df04b698b1340ff2da3238d16" prefix=" " category="inline-code"></block> 在相關的磁碟區上。</block>
  <block id="6c2e01aca4f10a83d34e3f3046435e82" category="summary">SnapMirror 和 SyncMirror</block>
  <block id="64bba30b717cb45555458da4fed880a1" category="paragraph">幾乎每個應用程式都需要資料複寫。</block>
  <block id="25fb1fa02f326334533a22c105ad3e69" category="paragraph">在最基本的層級上、複寫可能是指將儲存在異地磁帶上的複本、或是將應用程式層級複寫到待命位置。災難恢復是指在發生災難性服務中斷時、使用這些複本複本將服務上線。</block>
  <block id="eab6cb3a1168ef2311865e6155b8272c" category="paragraph">ONTAP 提供多種複寫選項、可因應儲存陣列本身的各種需求、滿足各種需求。這些選項包括簡單地將備份複寫到遠端站台、直到在同一個平台上同時提供災難恢復和高可用度的同步全自動化解決方案。</block>
  <block id="32df0c1cabf839652741a56bdaac7def" category="paragraph">適用於應用程式的主要 ONTAP 複寫技術是 NetApp SnapMirror 和 NetApp SyncMirror 技術。這些不是附加產品、而是完全整合至 ONTAP 、只要簡單新增授權金鑰就能啟動。儲存層級複寫也不是唯一的選項。應用程式層級的複寫、例如搭配 Oracle DataGuard 、也能整合至以 ONTAP 為基礎的資料保護策略。</block>
  <block id="a2259fa074bae962e46ca7fc7aa31be1" category="paragraph">正確的選擇取決於特定的複寫、恢復和保留需求。</block>
  <block id="0d3b37ff5855bf299f3c4a154373c1e2" category="section-title">ONTAP SnapMirror</block>
  <block id="296e89e943f5160d338484b3b705a44e" category="paragraph">SnapMirror 是 NetApp 非同步複寫解決方案、非常適合用來保護大型、複雜且動態的資料集、例如資料庫及其相關應用程式。其主要值如下：</block>
  <block id="d9f36dae2818ace926c4259271530724" category="list-text">* 管理能力。 * SnapMirror 易於設定及管理、因為它是儲存軟體的原生部分。不需要附加產品。複寫關係可在幾分鐘內建立、並可直接在儲存系統上管理。</block>
  <block id="8f761eff026903aa0140319f597d1fb0" category="list-text">* 簡易性。 * 複寫是以 FlexVol 磁碟區為基礎、這些磁碟區是 LUN 或檔案的容器、會以單一一致群組的形式複寫。</block>
  <block id="8b737d6a9db3de6436966db508cb51d4" category="list-text">* 效率。 * 建立初始複寫關係後、只會複寫變更。此外、還會保留重複資料刪除和壓縮等效率功能、進一步減少必須傳輸至遠端站台的資料量。</block>
  <block id="0783dadb67ff77ed26bbfc5d80fa0cbd" category="list-text">* 靈活度。 * 鏡像可以暫時中斷、以便測試災難恢復程序、然後輕鬆地重新建立鏡像、而不需要進行完整的重新鏡像。只有變更的資料必須套用、才能使鏡射恢復同步。鏡像也可以還原、以便在災難結束後、原始站台恢復運作後、能夠快速重新同步。最後、複寫資料的讀寫複本可供測試與開發。</block>
  <block id="8a00f09d8937e890f2cfb4d7acf72733" category="paragraph">ONTAP 提供數種不同的複寫技術、但最靈活的是 SnapMirror 、這是一個 Volume 對 Volume 的非同步鏡射選項。</block>
  <block id="80c8fae3d0b5dd100cc984d9ba3eced7" category="paragraph">如前所述、 FlexVol Volume 是管理 Snapshot 型備份和 SnapRestore 型還原的基本單位。FlexVol Volume 也是 SnapMirror 型複寫的基本單元。第一步是建立來源 Volume 到目的地 Volume 的基準鏡射。初始化此鏡射關係之後、所有後續作業都會以複寫變更的資料為基礎。</block>
  <block id="c1020b1755f65f23643158ce6a4d22cc" category="paragraph">從恢復的角度來看、 SnapMirror 的主要價值如下：</block>
  <block id="50bde20b37cd4d57fbff2b95f2f8ec97" category="list-text">SnapMirror 作業很容易理解、而且可以輕鬆自動化。</block>
  <block id="66162be45733f65fee4abb22e989eb78" category="list-text">SnapMirror 複本的簡單更新只需要複寫差異變更、減少頻寬需求、並允許更頻繁的更新。</block>
  <block id="a3b4fbe416387a4991ccaa8b325a68be" category="list-text">SnapMirror 非常精細。它是以簡單的磁碟區對磁碟區關係為基礎、可建立數百個分別管理的複本和複寫間隔。複寫不一定是一體適用的。</block>
  <block id="4e3785883ef3ccad9938d7e35e493057" category="list-text">鏡射方向可以輕鬆反轉、同時保留僅根據變更更新關係的能力。這可在主站台在發生停電等災難後恢復服務後、提供快速的容錯回復功能。只有變更必須同步回來源。</block>
  <block id="8b8325381cf528eff12c1e678a3112f9" category="list-text">鏡像可以輕鬆中斷並有效地重新同步、以便進行災難恢復程序的排練。</block>
  <block id="b1f45b7d95bfc815351fb649fa94b671" category="list-text">SnapMirror 以完整區塊層級複寫模式運作、不僅能複寫磁碟區中的資料、也能複寫快照。此功能可在災難恢復站點上提供資料複本和完整的備份集。</block>
  <block id="ffafd9ae31dee51209961eb2453ac806" category="paragraph">SnapMirror 以版本彈性模式運作、可複寫特定快照、讓主要和次要站台的保留時間不同。</block>
  <block id="974658d7ac018cb945e78365b0a760fb" category="section-title">SnapMirror同步</block>
  <block id="ffbf9d0ce29a631b6eae8b22c41ec95e" category="paragraph">SnapMirror Synchronous （ SM-S ）是 SnapMirror 的增強功能、可提供 RPO = 0 同步複寫。它最常用於儲存架構、只有資料的子集需要同步鏡射。</block>
  <block id="e8a45c4c0391895df78421904703c933" category="paragraph">SM-S 可在兩種稍微不同的模式下運作： Sync 和 StrictSync 。</block>
  <block id="15a4e16195fb9d30c5df0e11df5c2166" category="paragraph">在「同步」模式中、變更會先複寫、然後才會被確認。只要複寫作業正常、就能保證 RPO 為零。如果無法複寫變更、則 SM-S 可以結束同步模式、並允許作業繼續。這允許在正常情況下使用 RPO=0 、但如果複寫目的地無法使用、資料處理程序不會完全停止。</block>
  <block id="115455025d4664c0dd6deaaf3c1fc93c" category="paragraph">StrictSync 保證 RPO=0 。複寫變更失敗會導致 I/O 錯誤、這通常會導致應用程式關機。</block>
  <block id="1b1ea0d1ad6e5cfb06253a14fcdcfe71" category="inline-link">TR-4733</block>
  <block id="9ccd61d6efc86cc37743fdff385832e8" category="paragraph">如需 SM-S 的完整說明、請參閱<block ref="4459b84726c651a8047a6486e87e48fb" category="inline-link-rx"></block> 以及正式的 ONTAP 文件。新版 ONTAP 會持續新增功能。</block>
  <block id="6165c4352e1504dbaeef34d0cc50c187" category="section-title">一致性群組</block>
  <block id="0651e813e385dbd62a9bca9baee23c6c" category="paragraph">ONTAP 可建立一致性群組快照、從 9.13.1 開始、 ONTAP 可複寫磁碟區群組（請記住、 ONTAP 術語中的磁碟區不是 LUN 、而是由一或多個檔案或 LUN 組成的管理容器）、作為一致的群組。</block>
  <block id="80c6d3e933105ad9a2c104ec78444b8c" category="paragraph">SnapMirror 複寫和中斷 CG SnapMirror 關係可維持各磁碟區之間的一致性、 SnapMirror Synchronous 和 SnapMirror Business Continuity 則可維持各組成磁碟區之間的一致性。</block>
  <block id="455c7758003d6ebd974e8858f5ef1d7d" category="paragraph">因此、您可以複寫多個 Volume 資料集、並確保所有磁碟區都一致。除此之外、這還能「中斷鏡射並移轉」災難恢復作業、而不需要額外的應用程式或資料庫還原步驟。</block>
  <block id="c44a2da164b7b770fce6338a987670ee" category="section-title">MetroCluster 與 SyncMirror</block>
  <block id="b1a1cfbf3988d8abdfdedaabc1742ae9" category="paragraph">MetroCluster 也是同步複寫解決方案、適用於大規模的關鍵任務工作負載。複寫是以 SyncMirror 為基礎。在最簡單的層面、 SyncMirror 會在兩個不同位置建立兩組完整的 RAID 保護資料。它們可能位於資料中心內的鄰近房間、也可能位於相距數公里的地方。</block>
  <block id="89b8adf28db7abb0febecafdca5871ad" category="paragraph">SyncMirror 與 ONTAP 完全整合、運作速度剛剛高於 RAID 層級。因此、所有常見的 ONTAP 功能、例如 Snapshot 複本、 SnapRestore 和 NetApp FlexClone 、都能順暢運作。它仍是 ONTAP 、只是包含額外的同步資料鏡射層。</block>
  <block id="75c677fa68f5d15c17efbf6fd1fe1765" category="paragraph">管理 SyncMirror 資料的 ONTAP 控制器集合稱為 NetApp MetroCluster 組態。MetroCluster 的主要用途是在各種典型和災難恢復故障情況下、提供對同步鏡射資料的高可用度存取。</block>
  <block id="af845652f0234e1f71bc37e241ab63dc" category="paragraph">MetroCluster 和 SyncMirror 的資料保護主要價值如下：</block>
  <block id="9ab80c5e33e343c3415c21be433c4447" category="list-text">在正常作業中、 SyncMirror 可在不同位置提供保證同步鏡射。寫入作業在兩個站台的非揮發性媒體上都存在之前、才會被確認。</block>
  <block id="680ccf94624c9f922ed236c8cc0c1af2" category="list-text">如果站台之間的連線失敗、 SyncMirror 會自動切換至非同步模式、以保留主要站台提供資料、直到連線恢復為止。還原後、它會有效率地更新主要站台上累積的變更、以提供快速重新同步。不需要完全重新初始化。</block>
  <block id="c18ec55908c635b68abe8c6edbf6476e" category="paragraph">SnapMirror 也與以 SyncMirror 為基礎的系統完全相容。例如、主要資料庫可能是在分散在兩個地理站台的 MetroCluster 叢集上執行。此資料庫也可以將備份複寫到第三個站台、做為長期歸檔、或是在 DevOps 環境中建立複本。</block>
  <block id="0660b44d1a6d7e0d905c3fe28eef63ab" category="summary">Oracle on ONTAP DR 程序、含記錄傳送</block>
  <block id="54bae719e8fa53582d5b2781b4952c6b" category="doc">以記錄重新執行進行災難恢復</block>
  <block id="3a8111f0b903472ec78531619bf984f6" category="paragraph">Oracle 資料庫的複寫程序基本上與備份程序相同。主要需求是、構成可恢復備份的快照必須複寫到遠端儲存系統。</block>
  <block id="c62b3abab4fdbaf8f0a84e8c3559b5fd" category="paragraph">如先前在本機資料保護文件中所述、可利用熱備份程序或快照最佳化備份來建立可恢復的備份。</block>
  <block id="3d8f8c6a5c90bcd85a22fbd17390a864" category="inline-link-macro">資料配置</block>
  <block id="30394da99a39ca8264b8f7c0e6f679e0" category="paragraph">最重要的需求是將資料檔案隔離到一個或多個專用磁碟區。它們必須不受任何其他檔案類型的污染。原因在於確保資料檔案複寫完全不受其他資料類型複寫的影響、例如歸檔記錄。如需檔案配置的其他資訊、以及確保儲存配置適合快照的重要詳細資料、請參閱  <block ref="5a4fdf6a1fc411e544cf6d70d47a8289" category="inline-link-macro-rx"></block>。</block>
  <block id="f3f227cc5c07a040d61c36679053a58a" category="paragraph">假設資料檔案封裝在專用磁碟區中、下一個問題是如何管理重做記錄檔、歸檔記錄檔和控制檔。最簡單的方法是將所有這些資料類型放入單一磁碟區。其優點是複寫的重做記錄檔、歸檔記錄檔和控制檔都能完全同步。不需要進行不完整的還原或使用備份控制檔、不過也可以針對其他可能的還原案例、建立備份控制檔指令碼。</block>
  <block id="927992cbeccc8211e382c97e81514ef9" category="section-title">兩個 Volume 配置</block>
  <block id="fe1cf96940a710dc95fd30bbb7533b52" category="paragraph">下圖顯示最簡單的配置。</block>
  <block id="57f1db4bdf2ce49a98f375d8393f02bf" category="paragraph">這是最常見的方法。從 DBA 的觀點來看、在同一個磁碟區上共同找出所有重做記錄和歸檔記錄複本似乎不太常見。但是、當檔案和 LUN 仍位於相同的基礎磁碟機集上時、分離功能並不會提供更多額外的保護。</block>
  <block id="bc46e4831ef5654d084e456c4c544a42" category="section-title">三個 Volume 配置</block>
  <block id="f6e969769d9d166122489505d676769b" category="paragraph">有時候、由於資料保護考量或需要在控制器之間散佈重做記錄 I/O 、因此需要分離重做記錄。如果是這樣、則下圖所示的三個磁碟區配置將用於複寫、同時仍可避免執行不完整還原或依賴備份控制檔的任何需求。</block>
  <block id="4957c2feaa2cb72d80a0ab65228ad43f" category="paragraph">如此一來、重做記錄和控制檔就能在來源上的各組磁碟軸和控制器之間串列。不過、歸檔記錄和一組控制檔和重做記錄檔仍可在與歸檔記錄同步的狀態下複寫。</block>
  <block id="39128da64bc55500b4b11391aa54a011" category="paragraph">在此模型中、重做記錄 B 磁碟區不會複寫。</block>
  <block id="c0ce858e99375deac8274c96b7e5d0ee" category="section-title">災難恢復程序—熱備份</block>
  <block id="6993729228512b7e23e3ff3ec9099f33" category="paragraph">若要使用熱備份來執行災難恢復、請使用下列基本程序：</block>
  <block id="ee68e5b99222bbc29a480fcb0d1d6ee2" category="section-title">先決條件</block>
  <block id="41bde9c586a860264c425700c48bd375" category="list-text">Oracle 二進位檔安裝在災難恢復伺服器上。</block>
  <block id="cebf7cec81152da2cadffd580d81937f" category="list-text">中列出資料庫執行個體<block ref="2c0b0433aa1c96a2be6f40d9e71bc6af" prefix=" " category="inline-code"></block>。</block>
  <block id="17f8e5eda67237f2ca94c7dcce3e4022" category="list-text">。<block ref="76a2173be6393254e72ffa4d6df1030a" prefix=" " category="inline-code"></block> 和<block ref="6b2f852f7f63f2e5d4be597bbca97bb6" prefix=" " category="inline-code"></block> 或<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block> 例如、執行個體必須在中<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> 目錄。。</block>
  <block id="645a84975202e30700b572b49a5ee29d" category="section-title">災難恢復</block>
  <block id="25d18766964d7515e1f5acd893094f6e" category="list-text">中斷資料檔案和一般記錄磁碟區的鏡射。</block>
  <block id="8fc655e4752d521563db3bfa138ba62e" category="list-text">將資料檔案磁碟區還原為資料檔案的最新熱備份快照。</block>
  <block id="68a9c75816a16f6d4f7572fe287961bf" category="list-text">如果使用 SAN 、請啟動 Volume 群組和 / 或掛載檔案系統。</block>
  <block id="312007510a0f0dc7878d4ed6a7a01554" category="list-text">將歸檔記錄重播至所需的點。</block>
  <block id="e54b793d8bfa83bbb1bd965992c3474e" category="list-text">如果需要完整還原、請重新播放目前的重做記錄。</block>
  <block id="72e5734d53581f86093de5c97d8a3a24" category="paragraph">使用 NFS 可大幅簡化程序、因為可隨時將資料檔案和記錄檔的 NFS 檔案系統掛載到災難恢復伺服器上。當鏡射中斷時、它會變成讀取 / 寫入。</block>
  <block id="de4735bc5bbfdcae3d690313c739ad67" category="section-title">災難恢復程序：快照最佳化備份</block>
  <block id="6b2b8ef11e5ded8a083372ba49d488d2" category="paragraph">從快照最佳化備份中還原、幾乎與熱備份還原程序完全相同、變更如下：</block>
  <block id="af1e49e7bc2b25ce36bd93df09433fb4" category="list-text">將資料檔案磁碟區還原至目前記錄磁碟區複本之前建立的快照。</block>
  <block id="5e09669c98226c5d3a748f7e0f0333ad" category="paragraph">這些差異可簡化整體還原程序、因為當資料庫處於熱備份模式時、不需要確定已在來源上正確建立快照。災難恢復程序是以災難恢復站台上快照的時間戳記為基礎。建立快照時的資料庫狀態並不重要。</block>
  <block id="81d6beef7eaf28bbce692d4b59888f3e" category="section-title">使用熱備份快照進行災難恢復</block>
  <block id="dc711b77f0d6a9c9ccf88b424509440a" category="paragraph">這是以熱備份快照複寫為基礎的災難恢復策略範例。它也可作為簡單且可擴充的本機備份策略範例。</block>
  <block id="edaef18e1c956b9284405fd664c4ca4a" category="paragraph">範例資料庫位於基本的雙磁碟區架構上。<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> 包含資料檔案和<block ref="894db1fc1592356880976f1b92c3e6a2" prefix=" " category="inline-code"></block> 用於組合的重做記錄檔、歸檔記錄檔和控制檔。</block>
  <block id="fc0e7b6cd7cd15929987b1429d1c3a7e" category="paragraph">需要兩個排程、一個用於夜間資料檔案備份、另一個用於記錄檔備份。這些時間分別稱為午夜和 15 分鐘。</block>
  <block id="44c0956347a70c78d2124c1041321049" category="paragraph">然後在快照原則中使用這些排程<block ref="44dc83cda2d6b3ce99cc25803e824061" prefix=" " category="inline-code"></block> 和<block ref="9b055600529d69c4ae0d2a9408dc7aa3" prefix=" " category="inline-code"></block>，如下所示：</block>
  <block id="180e86b8e3c5049779c98c2c1006bb15" category="paragraph">最後、這些快照原則會套用至磁碟區。</block>
  <block id="2887f2c14c7efbc97d53ac2f914c5657" category="paragraph">這會定義磁碟區的備份排程。資料檔案快照會在午夜建立、並保留 60 天。記錄磁碟區包含以 15 分鐘為間隔建立的 72 個快照、可增加長達 18 小時的涵蓋範圍。</block>
  <block id="e1e5ef0e7100311d950b4ffebe040670" category="paragraph">然後、確定資料庫在建立資料檔案快照時處於熱備份模式。這是使用一個小型指令碼來完成的、該指令碼會接受一些在指定的 SID 上啟動和停止備份模式的基本引數。</block>
  <block id="683cdd7abd993faf3ace355cd6870b6f" category="paragraph">此步驟可確保資料庫在午夜快照周圍的四分鐘時間內處於熱備份模式。</block>
  <block id="ccff7eb3ad0059a184886709c87f4889" category="paragraph">複寫到災難恢復站台的設定如下：</block>
  <block id="42d3752a745fb0cdae528f6cc425b569" category="paragraph">記錄 Volume 目的地每 15 分鐘更新一次。這可提供約 15 分鐘的 RPO 。確切的更新時間間隔會因更新期間必須傳輸的資料總量而稍有不同。</block>
  <block id="e272424001d72919ad498e0e9d3c2cc4" category="paragraph">datafile Volume 目的地每六小時更新一次。這不會影響 RPO 或 RTO 。如果需要災難恢復、則第一步是將資料檔案磁碟區還原回熱備份快照。更新時間間隔越頻繁的目的、是要讓此磁碟區的傳輸率更順暢。如果每天排程更新一次、則必須一次傳輸當天累積的所有變更。隨著更新次數增加、變更會在一天內逐步複寫。</block>
  <block id="ce176ff569d716c1fa73d0754aba684b" category="paragraph">如果發生災難、第一步是中斷兩個磁碟區的鏡射：</block>
  <block id="4b9cdb6e2096c0828aeccd2ee5eecf42" category="paragraph">複本現在是讀寫的。下一步是驗證記錄磁碟區的時間戳記。</block>
  <block id="b4d461e48f5be5d08f677045d11e8200" category="paragraph">最新的記錄磁碟區複本是 3 月 14 日 13:30 。</block>
  <block id="96f75a4b63f4377efdf64d571d71caec" category="paragraph">接著、識別在記錄磁碟區狀態之前立即建立的熱備份快照。這是必要的、因為記錄重新執行程序需要在熱備份模式中建立的所有歸檔記錄。因此、記錄磁碟區複本必須比熱備份映像舊、否則它不會包含所需的記錄。</block>
  <block id="d358e4eb10a2f4e0b591e16941d7782c" category="paragraph">最近建立的快照是<block ref="c001e27abf0e66d13790bb8a7e00da54" prefix=" " category="inline-code"></block>。這是資料檔案的最新熱備份映像、然後還原如下所示：</block>
  <block id="d2037035a976c9be71cf6f372300c8c3" category="paragraph">在這個階段、資料庫現在已準備好進行還原。如果這是 SAN 環境、下一步將包括啟動 Volume 群組和掛載檔案系統、這是一項輕鬆自動化的程序。由於此範例使用 NFS 、檔案系統已掛載並變成讀寫、因此在鏡射中斷時無需再掛載或啟動。</block>
  <block id="2edce22eade45b42bc6b2665057fa082" category="paragraph">現在可以將資料庫還原到所需的時間點、或是針對複寫的重做記錄複本進行完整還原。此範例說明歸檔記錄、控制檔和重做記錄 Volume 的組合值。由於不需要仰賴備份控制檔或重設記錄檔、因此恢復程序會大幅簡化。</block>
  <block id="51f74a82c7125b3b288755b6668091b1" category="section-title">利用快照最佳化備份進行災難恢復</block>
  <block id="3680a4757ddad43934237ab6a0ca955c" category="paragraph">使用快照最佳化備份的災難恢復程序與熱備份災難恢復程序幾乎相同。與熱備份快照程序一樣、它基本上也是本機備份架構的延伸、其中的備份會複寫以用於災難恢復。以下範例顯示詳細的組態和還原程序。此範例也指出熱備份與快照最佳化備份之間的主要差異。</block>
  <block id="330dadae5e2585726f41ed1f90e88f9f" category="paragraph">範例資料庫位於基本的雙磁碟區架構上。<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> 包含資料檔案、和<block ref="894db1fc1592356880976f1b92c3e6a2" prefix=" " category="inline-code"></block> 用於組合的重做記錄檔、歸檔記錄檔和控制檔。</block>
  <block id="1669f47e046ce7e069e9d143f42e025d" category="paragraph">需要兩個排程：一個用於夜間資料檔案備份、另一個用於記錄檔備份。這些時間分別稱為午夜和 15 分鐘。</block>
  <block id="ef4adcab3e9bd572d0670f9f2073c311" category="paragraph">這可控制磁碟區的最終備份排程。快照會在午夜建立並保留 60 天。記錄磁碟區包含以 15 分鐘為間隔建立的 72 個快照、最多可增加 18 小時的涵蓋範圍。</block>
  <block id="f9d5149b630a43ff5996adc26c6e1f08" category="paragraph">記錄 Volume 目的地每 15 分鐘更新一次。這會提供約 15 分鐘的 RPO 、而精確的更新間隔會因更新期間必須傳輸的資料總量而稍有不同。</block>
  <block id="992398ebd9e9f825f0aa4415519abdba" category="paragraph">datafile Volume 目的地每 6 小時更新一次。這不會影響 RPO 或 RTO 。如果需要災難恢復、您必須先將資料檔案磁碟區還原回熱備份快照。更新時間間隔越頻繁的目的、是要讓此磁碟區的傳輸率更順暢。如果每天排程一次更新、則必須一次傳輸當天累積的所有變更。隨著更新次數增加、變更會在一天內逐步複寫。</block>
  <block id="9e85b8590ac2f9ff5ebc8d1def51ae82" category="paragraph">如果發生災難、第一步是中斷所有磁碟區的鏡射：</block>
  <block id="fd2834dcadb39f00eb897fdcdc07a03d" category="paragraph">最新的記錄磁碟區複本是 3 月 14 日 13 ： 30 。接著、識別在記錄磁碟區狀態之前立即建立的資料檔案快照。這是必要的、因為記錄重新執行程序需要從快照之前的所有歸檔記錄檔到所需的還原點。</block>
  <block id="810e47566b9cd5aa3b28e6514ec95735" category="paragraph">最近建立的快照是<block ref="c001e27abf0e66d13790bb8a7e00da54" prefix=" " category="inline-code"></block>。還原此快照。</block>
  <block id="87d83a0406ac6622efcdf91c42784ecd" category="paragraph">資料庫現在已準備就緒、可進行還原。如果這是 SAN 環境、您就可以啟動 Volume 群組並掛載檔案系統、這是一項輕鬆自動化的程序。不過、本範例使用 NFS 、因此檔案系統已掛載、並變成讀寫、因此在鏡像毀損時無需再掛載或啟動。</block>
  <block id="7a2e97f17454be76b7e522ce612ff961" category="paragraph">現在可以將資料庫還原到所需的時間點、或是針對複寫的重做記錄複本進行完整還原。此範例說明歸檔記錄、控制檔和重做記錄 Volume 的組合值。恢復程序大幅簡化、因為不需要仰賴備份控制檔或重設記錄檔。</block>
  <block id="d6597945276340ba33115e737eb4b489" category="summary">Oracle 資料庫的一致性群組複寫</block>
  <block id="fc506ae4ea109f50758acc176bcb5341" category="doc">一致性群組災難恢復</block>
  <block id="5eda890cc07e4b7cd409730d8af8ddc3" category="paragraph">一致性群組複寫可以簡單地透過 SnapMirror 排程單一磁碟區的複寫。這包括資料檔案、控制檔、歸檔記錄檔和重做記錄檔。每次 SnapMirror 更新都會在目的地站台上建立新的資料庫複本、並透過中斷鏡射來保持一致並準備好啟動。</block>
  <block id="89cb1432594ce7c25dadf229401874e7" category="paragraph">如果資料庫必須橫跨多個磁碟區、則需要一致性群組快照（ CG-snapshot ）。</block>
  <block id="f96b125d1bacc785389957041be148e9" category="paragraph">在區塊層級複寫模式中搭配 SnapMirror 使用時、這項策略的另一個優點是完整複寫來源儲存系統上的所有快照。除了災難恢復複本之外、還會複寫完整的備份補充。</block>
  <block id="77fda44088666155052f9d4224878cbc" category="summary">Oracle 歸檔記錄分層</block>
  <block id="113d9dffdeb8fa14877fc8cf8ca7c9d5" category="doc">Oracle 記錄分層</block>
  <block id="8625af69ad0b5f76799d87df777e3c86" category="paragraph">FabricPool 最重要的用途可能是提高已知冷資料的效率、例如資料庫交易記錄。</block>
  <block id="a98d546484d238b37b7e2584ae8d399d" category="summary">Oracle 備份分層</block>
  <block id="9f409a250e4be99904c9e90259cb747d" category="paragraph">傳統應用程式備份包括 Oracle Recovery Manager 等產品、可在原始資料庫之外建立檔案型備份。</block>
  <block id="6cddb309df5eb8791dc990f72ef2deb2" category="summary">Oracle 分層原則</block>
  <block id="7ba3322dbc0b3c33a66f1963e80b7a2a" category="doc">Oracle 資料庫分層原則</block>
  <block id="4627801bdbb24a1991e64f30a2d80cb1" category="paragraph">ONTAP 提供四項原則、可控制效能層上的 Oracle 資料如何成為移轉至容量層的候選對象。</block>
  <block id="47f6817eca23122cc683f7c2759e6ecb" category="summary">Oracle 全區塊分層</block>
  <block id="1def0ac22a738b54cce584e969065918" category="doc">Oracle 完整檔案分層</block>
  <block id="2eea2725f31529888b5e57b36492819f" category="paragraph">雖然 FabricPool 分層是在區塊層級運作、但在某些情況下、它可用於提供檔案層級的分層。</block>
  <block id="468853d9ed2134af17ede5fd165a8dff" category="summary">使用 FabricPool 進行部分檔案分層</block>
  <block id="5638b2f30ee966b3ff84bac350092971" category="doc">Oracle 部分檔案分層</block>
  <block id="f935a501eae76f9c13d430bc3879cd0d" category="paragraph">由於 FabricPool 是在區塊層級運作、因此可能變更的檔案可以部分分層化為物件儲存、而部分保留在效能層級上。</block>
  <block id="dd22ff2cf158f98efbd92f4522b3064b" category="summary">物件存放區存取中斷期間的資料庫存取</block>
  <block id="cc4e17c26faf6b70b383529b6215ba0f" category="doc">物件存放區存取中斷</block>
  <block id="bbb21240a2cc48eb7a229ec824e70cdf" category="summary">Oracle with FabricPool 分層概述</block>
  <block id="ec2ffb259f21d115e5481eb0f215aa0d" category="doc">Oracle 分層概述</block>
  <block id="ec35a176f3e7c086273baee0c7f374d5" category="paragraph">瞭解 FabricPool 分層對 Oracle 和其他資料庫的影響、需要瞭解低階 FabricPool 架構。</block>
  <block id="cd6b77e4d343896571bc445479f24588" category="summary">高效能分層擷取原則</block>
  <block id="3bf6f5a455b1889775d79713ad4e19ed" category="doc">擷取原則</block>
  <block id="6edf1821ddc55278229c2156f42905f0" category="paragraph">分層原則可控制哪些 Oracle 資料庫區塊從效能層分層分層到容量層。擷取原則可控制已階層的區塊讀取時所發生的情況。</block>
  <block id="95ab96ac5aaeae15f7b499d0fa0313cf" category="summary">Oracle 快照分層</block>
  <block id="d01cbb2be77343ccdb1d3372c4b9891e" category="summary">Oracle 資料庫 LUN 規模調整和 LUN 數量準則</block>
  <block id="b9e88e2eb3d5eef807fc42db706d866a" category="doc">Oracle LUN 規模調整和 LUN 數量</block>
  <block id="51f96d1f8b50084e3a2ddc21ceef8b2f" category="paragraph">選擇最佳 LUN 大小和要使用的 LUN 數量、對於 Oracle 資料庫的最佳效能和管理性至關重要。</block>
  <block id="3d1bd23e74923cdc48fe992d0687809f" category="summary">Oracle 資料庫和 NFS 會租用和鎖定</block>
  <block id="472f36eb81330c2c27f02245ce8a911e" category="doc">NFS 租賃與鎖定 - Oracle</block>
  <block id="cec6f8a988408ba212798e1cc32658c7" category="paragraph">NFSv3 無狀態。這實際上意味著 NFS 伺服器（ ONTAP ）無法追蹤哪些檔案系統是掛載的、由誰掛載、或哪些鎖定是真的就位。</block>
  <block id="7c96331bd03e63c4eb3505c526b42244" category="paragraph">ONTAP 確實有一些功能會記錄掛載嘗試、因此您可以知道哪些用戶端可能正在存取資料、而且可能會出現諮詢鎖定、但這項資訊並不保證 100% 完整。無法完成、因為追蹤 NFS 用戶端狀態並非 NFSv3 標準的一部分。</block>
  <block id="20733ad7135aa0ede95fd8637fe05cf6" category="section-title">NFSv4 狀態</block>
  <block id="3f7c11f662fc6e07a91179fdf2322ef5" category="paragraph">相反地、 NFSv4 是有狀態的。NFSv4 伺服器會追蹤哪些用戶端正在使用哪些檔案系統、哪些檔案存在、哪些檔案和 / 或檔案區域被鎖定等 這表示 NFSv4 伺服器之間需要定期通訊、才能保持狀態資料最新。</block>
  <block id="6f7e4a1e570f45fa3db0b8a0ed80a38f" category="paragraph">NFS 伺服器所管理的最重要狀態是 NFSv4 鎖定和 NFSv4 租賃、它們彼此之間有很大的關聯。您必須瞭解每個項目本身的運作方式、以及它們彼此之間的關係。</block>
  <block id="0d55fd4062f29237d0fb3b7f666fb8eb" category="section-title">NFSv4 鎖定</block>
  <block id="bf4139ff42e411ae5483e062387b3f70" category="paragraph">有了 NFSv3 、鎖定是建議事項。NFS 用戶端仍可修改或刪除「鎖定」檔案。NFSv3 鎖本身不會過期、必須將其移除。這會造成問題。例如、如果叢集式應用程式會建立 NFSv3 鎖定、而其中一個節點發生故障、您該怎麼做？您可以在仍在運作的節點上對應用程式進行編碼、以移除鎖定、但您如何知道這是安全的？可能是「故障」節點可以運作、但無法與叢集的其他部分通訊？</block>
  <block id="11d1c33ac6b190a233c00cdbdd6a355b" category="paragraph">有了 NFSv4 、鎖定的持續時間有限。只要持有鎖定的用戶端繼續與 NFSv4 伺服器簽入、就不允許其他用戶端取得這些鎖定。如果用戶端無法使用 NFSv4 進行存回、伺服器最終會撤銷鎖定、而其他用戶端則能要求並取得鎖定。</block>
  <block id="c17985911e0182dc5e96c4d60aadf139" category="section-title">NFSv4 租賃</block>
  <block id="596bcfef3aaccfe299bb45a969afcaf0" category="paragraph">NFSv4 鎖定與 NFSv4 租用相關聯。當 NFSv4 用戶端與 NFSv4 伺服器建立連線時、它會取得租用。如果用戶端取得鎖定（鎖定類型眾多）、則鎖定會與租用相關聯。</block>
  <block id="b5248856b1835e14738aa32e053e30e0" category="paragraph">此租用具有定義的逾時時間。根據預設、 ONTAP 會將逾時值設為 30 秒：</block>
  <block id="7e2a66190f452806ac1183721a43eaa1" category="paragraph">這表示 NFSv4 用戶端需要每 30 秒與 NFSv4 伺服器簽入一次、才能續約。</block>
  <block id="809c552ae0a4d377e87f495b4e3ac62b" category="paragraph">租賃會自動由任何活動續約、因此如果用戶端正在工作、就不需要執行額外作業。如果某個應用程式變得很安靜、而且沒有真正的工作、則需要改為執行某種保持活動狀態的作業（稱為順序）。基本上只是說：「我還在這裏、請重新整理我的租約。」</block>
  <block id="70cb78bb7e91dcafab559f9b72e40bb6" category="paragraph">NFSv3 無狀態。這並不需要用戶端的通訊。NFSv4 可設定狀態、一旦租用期間結束、租用即會過期、鎖定會被撤銷、而鎖定的檔案會提供給其他用戶端使用。</block>
  <block id="2ee5d81cfa6306ae71ce534ed9b31431" category="paragraph">有了 NFSv3 、您可以四處移動網路纜線、重新啟動網路交換器、進行組態變更、並確保不會發生任何問題。應用程式通常只會耐心等待網路連線再次運作。</block>
  <block id="8900ff182e4197f8eb2acd7d2b7fd902" category="paragraph">有了 NFSv4 、您有 30 秒的時間（除非您已在 ONTAP 中增加該參數的值）來完成工作。如果您超過此上限、您的租約將會逾時。這通常會導致應用程式當機。</block>
  <block id="ffa8c7744b3e2d43b18c67aec0fe7743" category="paragraph">舉例來說、如果您有 Oracle 資料庫、而且網路連線中斷（有時稱為「網路分割區」）超過租用逾時、您就會使資料庫當機。</block>
  <block id="33b9897348039594b4b17bf1e1629c74" category="paragraph">以下是 Oracle 警示記錄中發生這種情況的範例：</block>
  <block id="85608585bf8e790a579c49ba9af705c6" category="paragraph">如果您查看系統記錄檔、您應該會看到以下幾個錯誤：</block>
  <block id="e19b338de53dada4cf4da3837aaba76d" category="paragraph">記錄訊息通常是問題的第一個徵象、而非應用程式凍結。通常、在網路中斷期間、您完全看不到任何內容、因為程序和作業系統本身都遭到封鎖、無法嘗試存取 NFS 檔案系統。</block>
  <block id="7a3c8c17a9dd10fa565f79e0ebb5bba7" category="paragraph">網路重新運作後、就會出現錯誤。在上述範例中、一旦重新建立連線、作業系統就會嘗試重新取得鎖定、但時間太晚了。租約已到期、鎖定已移除。這會導致一個錯誤、該錯誤會傳播到 Oracle 層、並導致警示記錄中出現訊息。根據資料庫的版本和組態、您可能會看到這些模式的變化。</block>
  <block id="4bec5e793e34a5819aefb68e4f65db26" category="paragraph">總之、 NFSv3 可容忍網路中斷、但 NFSv4 更敏感、並規定了一段定義的租用期。</block>
  <block id="069de2d717910b2677190b9a9b5ed1cf" category="paragraph">如果無法接受 30 秒的逾時、該怎麼辦？如果您管理一個動態變化的網路、在其中重新啟動交換器或重新放置纜線、導致網路偶爾中斷、該怎麼辦？您可以選擇延長租用期、但是否需要說明 NFSv4 寬限期。</block>
  <block id="4b84416146795544deb5c9de89187f91" category="section-title">NFSv4 寬限期</block>
  <block id="7d98e091c5f7be92cd5fb85b985d8d20" category="paragraph">如果 NFSv3 伺服器重新開機、幾乎可以立即為 IO 服務。它並未維持任何形式的用戶端狀態。結果是、 ONTAP 接管作業通常似乎接近即時。當控制器準備好開始提供資料時、就會傳送 ARP 給網路、以表示拓撲的變化。客戶端通常幾乎立即檢測到這種情況，數據恢復流動。</block>
  <block id="173d4fd05086441236dbee4710639d10" category="paragraph">不過 NFSv4 會短暫暫停。這只是 NFSv4 運作方式的一部分。</block>
  <block id="21483115213b27583a07dc2ca994671c" category="paragraph">NFSv4 伺服器需要追蹤租用、鎖定、以及使用何種資料的人員。如果 NFS 伺服器出現問題並重新開機、或停電一段時間、或在維護活動期間重新啟動、則會導致租約 / 鎖定、而其他用戶端資訊也會遺失。伺服器需要先找出哪個用戶端正在使用哪些資料、才能恢復作業。這就是寬限期的開始。</block>
  <block id="09b6f386094bd895d3c9694f28bfdf65" category="paragraph">如果您突然關閉 NFSv4 伺服器的電源、當恢復 IO 時、嘗試恢復 IO 的用戶端會收到回應、基本上說：「我遺失了租用 / 鎖定資訊。您是否要重新登錄鎖定？」 這就是寬限期的開始。ONTAP 預設為 45 秒：</block>
  <block id="e4f8aa90af36d76254e2f02e56232aed" category="paragraph">結果是、在重新啟動之後、控制器會暫停 IO 、而所有用戶端都會回收租用和鎖定。寬限期結束後、伺服器將恢復 IO 作業。</block>
  <block id="bb2b26fdcb4e947cda6f8e38724ecfc9" category="section-title">租用逾時與寬限期比較</block>
  <block id="563494d7f0f6ebcb6698cac7f9705aaa" category="paragraph">寬限期與租用期間已連線。如上所述、預設的租用逾時為 30 秒、這表示 NFSv4 用戶端必須至少每 30 秒與伺服器簽入一次、否則就會遺失租約、進而導致鎖定。存在寬限期、可讓 NFS 伺服器重建租用 / 鎖定資料、預設為 45 秒。ONTAP 要求寬限期比租用期長 15 秒。如此可確保設計為至少每 30 秒續約的 NFS 用戶端環境、在重新啟動後能夠與伺服器簽入。45 秒的寬限期可確保所有預期至少每 30 秒續約一次的客戶都有機會續約。</block>
  <block id="5e6b60906bbbb9a41b140c0749591489" category="paragraph">如果無法接受 30 秒的逾時、您可以選擇延長租用期。如果您想要將租用逾時延長至 60 秒、以便承受 60 秒的網路中斷、您必須將寬限期延長至至少 75 秒。ONTAP 要求比租用期高 15 秒。這表示您將會在控制器容錯移轉期間經歷更長的 IO 暫停時間。</block>
  <block id="4611c7c931fc15a6feba513fe72e22de" category="paragraph">這通常不是問題。一般使用者每年只會更新 ONTAP 控制器一或兩次、而且由於硬體故障而造成的非計畫性容錯移轉極少。此外、如果您的網路發生 60 秒網路中斷的可能性、而您需要將租用逾時時間延長至 60 秒、那麼您可能不會反對罕見的儲存系統容錯移轉、導致暫停時間也達 75 秒。您已確認網路暫停超過 60 秒、而且速度較快。</block>
  <block id="c4fb6f7d31d205bc07dbff47d0ae4bb3" category="summary">Oracle Direct NFS</block>
  <block id="f58bdad9659176e411f064fdb414233f" category="doc">Oracle directNFS</block>
  <block id="1bd6ec1185ba67395dc6f9cd2b458ec8" category="paragraph">Oracle 資料庫可使用 NFS 的方式有兩種。</block>
  <block id="96997ca5c577dd19a3ba5f7ff771f27a" category="paragraph">首先、它可以使用以作業系統一部分的原生 NFS 用戶端所掛載的檔案系統。這有時稱為核心 NFS 或 kNFS 。NFS 檔案系統是由 Oracle 資料庫安裝及使用、與任何其他應用程式使用 NFS 檔案系統的方式完全相同。</block>
  <block id="95c17c63df7ceea39a175b1d96955bb7" category="paragraph">第二種方法是 Oracle Direct NFS （ DNFS ）。這是在 Oracle 資料庫軟體中實作 NFS 標準。它不會改變 DBA 設定或管理 Oracle 資料庫的方式。只要儲存系統本身有正確的設定、就應該對 DBA 團隊和終端使用者透明使用 DNFS 。</block>
  <block id="43539d2fca21e5b644484efb94614a7b" category="paragraph">啟用 DNFS 功能的資料庫仍會掛載一般的 NFS 檔案系統。資料庫開啟後、 Oracle 資料庫會開啟一組 TCP/IP 工作階段、並直接執行 NFS 作業。</block>
  <block id="26e7ebad3936387b4b3f7c4f5688ef27" category="section-title">Direct NFS</block>
  <block id="6d431a52c8a41a7c2335f98e2ae8c454" category="paragraph">Oracle Direct NFS 的主要值是略過主機 NFS 用戶端、並直接在 NFS 伺服器上執行 NFS 檔案作業。啟用它只需要變更 Oracle 磁碟管理程式（ ODM ）程式庫。Oracle 說明文件中提供此程序的說明。</block>
  <block id="8401d91735209aeccbe56f33b4e2db73" category="paragraph">使用 DNFS 可大幅提升 I/O 效能、並降低主機和儲存系統的負載、因為 I/O 是以最有效率的方式執行。</block>
  <block id="b0dedecb00787180a9e0c657cfb278c9" category="paragraph">此外、 Oracle DNFS 還包含 * 選項 * 、可用於網路介面多重路徑和容錯功能。例如、兩個 10Gb 介面可以結合在一起、以提供 20Gb 的頻寬。如果某個介面發生故障、則會在另一個介面上重試 I/O 。整體作業與 FC 多重路徑非常類似。多重路徑在數年前是最常見的標準、那就是 1 個乙太網路。10Gb NIC 足以應付大多數 Oracle 工作負載、但如果需要更多 10Gb NIC 、則可加以連結。</block>
  <block id="11e50b3c816105439151db3a3b4fdda3" category="paragraph">使用 DNFS 時、必須安裝 Oracle Doc 1495104.1 中所述的所有修補程式。如果無法安裝修補程式、則必須評估環境、確保該文件中所述的錯誤不會造成問題。在某些情況下、無法安裝所需的修補程式會導致無法使用 DNFS 。</block>
  <block id="8f98002fee392ad6151679875de1a7cc" category="paragraph">請勿將 DNFS 用於任何類型的循環名稱解析、包括 DNS 、 DDNS 、 NIS 或任何其他方法。這包括 ONTAP 中可用的 DNS 負載平衡功能。當使用 DNFS 的 Oracle 資料庫將主機名稱解析為 IP 位址時、後續查詢時不得變更。這可能會導致 Oracle 資料庫當機、並可能導致資料毀損。</block>
  <block id="e80ad3efb180dc2d016b27506b7b24ce" category="section-title">直接 NFS 和主機檔案系統存取</block>
  <block id="4c38a8c0a49e721bf2a378d0b4fb2010" category="paragraph">使用 DNFS 有時會導致依賴掛載在主機上的可見檔案系統的應用程式或使用者活動發生問題、因為 DNFS 用戶端會從主機作業系統不定期存取檔案系統。DNFS 用戶端可以在不瞭解作業系統的情況下建立、刪除及修改檔案。</block>
  <block id="c03389fdb295f2acb079603123e6d0e3" category="paragraph">使用單一執行個體資料庫的掛載選項時、會啟用檔案和目錄屬性的快取、這也表示目錄內容會快取。因此、 DNFS 可以建立檔案、而且在作業系統重新讀取目錄內容和讓使用者看到檔案之前、會有短暫的延遲。這通常不是問題、但在極少數情況下、 SAP BR*Tools 等公用程式可能會發生問題。如果發生這種情況、請變更掛載選項、以使用 Oracle RAC 的建議來解決此問題。這項變更會導致停用所有主機快取。</block>
  <block id="a370a203383b565c3fb746c1c2e1a64b" category="paragraph">只有在使用（ a ） DNFS 時才變更掛載選項、且（ b ）檔案可見度延遲所造成的問題。如果未使用 DNFS 、在單一執行個體資料庫上使用 Oracle RAC 掛載選項會導致效能降低。</block>
  <block id="b1ced01e4bbcd95ec43a2756131f8f9d" category="admonition">請參閱附註<block ref="4740c034d97ca90a96b8050082816605" prefix=" " category="inline-code"></block> 在中 <block ref="657185beb26ec14433f7e083717fa98b" category="inline-link-macro-rx"></block> 針對可能產生異常結果的 Linux 特定 DNFS 問題。</block>
  <block id="22a7a03175addfd9aa5b1fa2c351e833" category="summary">Oracle 資料庫的 NFS 組態</block>
  <block id="6cb2edd2369a17890dce007723d98a6f" category="paragraph">NetApp 已提供企業級 NFS 儲存設備超過 30 年、由於其簡易性、隨著雲端型基礎架構的推向、其使用量也不斷增加。</block>
  <block id="95e0ac965f4d3a739263ba13584b6411" category="inline-link-macro">TR-4067 NetApp ONTAP 最佳實務做法上的 NFS</block>
  <block id="c46e4d65876bc5d9253e8e293f59b613" category="paragraph">NFS 傳輸協定包含多個不同需求的版本。如需 ONTAP 的 NFS 組態完整說明、請參閱 <block ref="e3fa0577f1d5ea8870d93a30eb76667f" category="inline-link-macro-rx"></block>。下列各節涵蓋一些較重要的需求和一般使用者錯誤。</block>
  <block id="0f8a941fcc56687ad8e3914162c19a41" category="section-title">NFS 版本</block>
  <block id="d0972be450ccf257fb73d4878bce204e" category="paragraph">NetApp 必須支援作業系統 NFS 用戶端。</block>
  <block id="7722a2ae10cef9bccea115dfdfe78a99" category="list-text">NFSv3 支援符合 NFSv3 標準的作業系統。</block>
  <block id="a3550edc6962850398d217f78cc4ad0d" category="list-text">Oracle DNFS 用戶端支援 NFSv3 。</block>
  <block id="89c45ebba54478419aa679a7ece8593d" category="list-text">所有遵循 NFSv4 標準的作業系統都支援 NFSv4 。</block>
  <block id="471ff51c89daf6e35e8e2b5111039744" category="inline-link-macro">NetApp IMT</block>
  <block id="8594659e8c4292db778973052a30ab86" category="list-text">NFSv4.1 和 NFSv4.2 需要特定的作業系統支援。請參閱 <block ref="d98f827de8e80b3365d5f4160c243cdc" category="inline-link-macro-rx"></block> 適用於支援的作業系統。</block>
  <block id="d1eb4c2a4d74705a5aa7945f734eff7c" category="list-text">Oracle DNFS 支援 NFSv4.1 需要 Oracle 12.2.0.2 或更高版本。</block>
  <block id="d8bacc1a7a9d6baaeb962e367920593b" category="inline-link-macro">NetApp 支援對照表</block>
  <block id="f16dcce07ca44aa38c7ebe3016b981b2" category="admonition">。 <block ref="f1e4f72fb4419d4270270c5ed1e0d9f6" category="inline-link-macro-rx"></block> 對於 NFSv3 和 NFSv4 、不包含特定的作業系統。一般支援所有遵守 RFC 的作業系統。搜尋線上 IMT 以取得 NFSv3 或 NFSv4 支援時、請勿選取特定的作業系統、因為不會顯示任何相符項目。一般原則隱含支援所有作業系統。</block>
  <block id="26ed9768d6a659a9768842d903d0025f" category="section-title">Linux NFSv3 TCP 插槽表</block>
  <block id="c56ec9836fbbd9c0a426a40fc71c265c" category="paragraph">TCP 插槽表是與主機匯流排介面卡（ HBA ）佇列深度相當的 NFSv3 。這些表格可控制任何時間都可以處理的NFS作業數量。預設值通常為16、這對於最佳效能而言太低。相反的問題發生在較新的Linux核心上、這會自動將TCP插槽表格限制增加到要求使NFS伺服器飽和的層級。</block>
  <block id="5270700baa50d07af667096293a27564" category="paragraph">為了達到最佳效能並避免效能問題、請調整控制 TCP 插槽表的核心參數。</block>
  <block id="5b29db1d99e19013580fa375a5f87fa5" category="paragraph">執行<block ref="1a1e44f7a3390ed4647a7d5b7e8b08ed" prefix=" " category="inline-code"></block> 並觀察下列參數：</block>
  <block id="8821adf56df4952370cfaa57ccaac68d" category="paragraph">所有 Linux 系統都應該包括在內<block ref="c5f48b899461d4c2b9ddc0b24ea87744" prefix=" " category="inline-code"></block>但只有部分包含在內<block ref="6f72acaebcb9a0de6696aaf3508a6144" prefix=" " category="inline-code"></block>。兩者都應設為 128 。</block>
  <block id="3a954c4e5e8d5ac3af590651efc5a2cb" category="cell">若未設定這些參數、可能會對效能造成重大影響。在某些情況下、效能會受到限制、因為 Linux 作業系統沒有發出足夠的 I/O在其他情況下、隨著 Linux 作業系統嘗試發出的 I/O 數量超過可服務的數量、 I/O 延遲也會增加。</block>
  <block id="837f157b2f309f5415420467f7643e3a" category="section-title">ADR 和 NFS</block>
  <block id="c0e7bb1383be0bf1268d1d70280bef6d" category="paragraph">部分客戶回報的效能問題是由於中的資料 I/O 過多所造成<block ref="18ca3ed022c239421418de608ceb49c5" prefix=" " category="inline-code"></block> 位置。問題通常不會在累積許多效能資料之前發生。I/O 過多的原因不明、但此問題似乎是 Oracle 處理程序重複掃描目標目錄以進行變更所致。</block>
  <block id="99be2ae95d50120a7c33c818afda1834" category="paragraph">移除<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和/或<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 掛載選項可執行主機作業系統快取、並降低儲存 I/O 層級。</block>
  <block id="8950578c587f9503f949dfc6a274b611" category="admonition">* NetApp 建議 * 不要放置<block ref="18ca3ed022c239421418de608ceb49c5" prefix=" " category="inline-code"></block> 檔案系統上的資料<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 或<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 因為效能問題很可能會發生。獨立<block ref="18ca3ed022c239421418de608ceb49c5" prefix=" " category="inline-code"></block> 如有必要、請將資料移至不同的掛載點。</block>
  <block id="cdb92b4a73ae99cde4df55c06e20dd3c" category="section-title">NFS-rootonly 和 mount-rootonly</block>
  <block id="c1f0a21ee026237bef11139a30b07040" category="paragraph">ONTAP 包含一個稱為的 NFS 選項<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block> 控制伺服器是否接受來自高連接埠的 NFS 流量連線。為了安全起見、只有 root 使用者可以使用低於 1024 的來源連接埠來開啟 TCP/IP 連線、因為這類連接埠通常是保留給作業系統使用、而非使用者處理程序。此限制有助於確保 NFS 流量來自實際的作業系統 NFS 用戶端、而非模擬 NFS 用戶端的惡意程序。Oracle DNFS 用戶端是 userspace 驅動程式、但程序是以 root 執行、因此通常不需要變更的值<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block>。連線是從低連接埠建立。</block>
  <block id="832b4524bcec11d28ca777ef9cdb4084" category="paragraph">。<block ref="eb6c1a5ecd1e17d4cd46fa5c9d415816" prefix=" " category="inline-code"></block> 選項僅適用於 NFSv3 。它控制是否從大於 1024 的連接埠接受 RPC 掛載呼叫。使用 DNFS 時、用戶端會再次以 root 執行、因此能夠開啟低於 1024 的連接埠。此參數無效。</block>
  <block id="57c47a1451485bec1ebb060afdf65cb4" category="paragraph">透過 NFS 4.0 及更高版本開啟與 DNFS 連線的程序不會以 root 執行、因此需要 1024 以上的連接埠。。<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block> 參數必須設為停用、 DNFS 才能完成連線。</block>
  <block id="4dd73247734d116e5039cc04c4979f2c" category="paragraph">如果<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block> 啟用時、結果會在掛載階段開啟 DNFS 連線時暫停。sqlplus 輸出類似於以下內容：</block>
  <block id="f62d72479920ff0f8dc9a3ca6f301b5d" category="paragraph">參數可變更如下：</block>
  <block id="47fc6c6691aed3ba0dbdc66c7896c61b" category="admonition">在極少數情況下、您可能需要將 NFS-rootonly 和 mount-rootonly 都變更為停用。如果伺服器正在管理大量的 TCP 連線、則可能沒有低於 1024 的連接埠可用、而且作業系統必須使用較高的連接埠。需要變更這兩個 ONTAP 參數、才能完成連線。</block>
  <block id="10b4eb170fe7bd035f21e7d863796683" category="section-title">NFS 匯出原則：超級使用者和 setuid</block>
  <block id="98bfec37486e95443730cc3d462022fb" category="paragraph">如果 Oracle 二進位檔位於 NFS 共用區、則匯出原則必須包含超級使用者和 setuid 權限。</block>
  <block id="3c0699ba2c56cb17c145bbda5580ed67" category="paragraph">用於一般檔案服務（例如使用者主目錄）的共享 NFS 匯出通常會佔用 root 使用者。這表示已掛載檔案系統的主機上 root 使用者的要求、會重新對應為具有較低權限的不同使用者。這有助於防止特定伺服器上的根使用者存取共用伺服器上的資料、進而保護資料安全。在共享環境中， setuid 位元也可能是安全性風險。setuid 位元可讓處理程序以不同於使用者的身分執行、而非以使用者的身分執行指令。例如、 root 擁有的 Shell 指令碼搭配 setuid 位元、會以 root 執行。如果其他使用者可以變更該 Shell 指令碼、任何非 root 使用者都可以透過更新指令碼、以 root 身分發出命令。</block>
  <block id="e341736b7d51c23cb7ef95615832e502" category="paragraph">Oracle 二進位檔包含 root 擁有的檔案、並使用 setuid 位元。如果在 NFS 共用上安裝 Oracle 二進位檔、匯出原則必須包含適當的超級使用者和 setuid 權限。在以下範例中、這兩項規則都包含在內<block ref="1efaeada4e3307369aca511f5da0498a" prefix=" " category="inline-code"></block> 及許可<block ref="0baea2f0ae20150db78f58cddac442a9" prefix=" " category="inline-code"></block> （ root ）使用系統驗證來存取 NFS 用戶端。</block>
  <block id="f1a0fa258c785ac546835a1a75017faf" category="section-title">NFSv4/4.1 組態</block>
  <block id="52f9ad2e353a42e61d9bf7dd9f59d0cb" category="paragraph">對於大多數應用程式、 NFSv3 和 NFSv4 之間的差異很小。應用程式 I/O 通常是非常簡單的 I/O 、而且不會從 NFSv4 中提供的某些進階功能中獲得顯著效益。較高版本的 NFS 不應從資料庫儲存的角度視為「升級」、而應視為包含其他功能的 NFS 版本。例如、如果需要 Kerberos 隱私模式（ krb5p ）的端點對端安全性、則需要 NFSv4 。</block>
  <block id="5cee42a6ee353ec8d6538898f8e63d2d" category="inline-link">TR-4067 NetApp ONTAP 最佳實務做法上的 NFS</block>
  <block id="1ca271e9db310f8a7fb925b114fd6811" category="paragraph">切換至 NFSv4 比單純將掛載選項從 ves=3 變更為 ves=4.1 更複雜。如需更完整的 NFSv4 組態與 ONTAP 說明、包括作業系統設定指南、請參閱<block ref="2d2395ce3ab8a9852abebca9822b9553" category="inline-link-rx"></block>。本 TR 的下列各節說明使用 NFSv4 的一些基本要求。</block>
  <block id="a1dc4350330c061ae52050f5a3400e25" category="section-title">NFSv4 網域</block>
  <block id="c30669603c950b31f6093d8beaf8060a" category="paragraph">NFSv4/4.1 組態的完整說明已超出本文件的範圍、但常見的問題之一是網域對應不相符。從系統管理員的角度來看、 NFS 檔案系統的行為似乎正常、但應用程式會報告某些檔案的權限和 / 或 setuid 錯誤。在某些情況下、系統管理員不正確地判斷應用程式二進位檔的權限已受損、並在實際問題是網域名稱時執行 chown 或 chmod 命令。</block>
  <block id="f0c6c8a632eeaa954640907ee1da277d" category="paragraph">NFSv4 網域名稱是在 ONTAP SVM 上設定：</block>
  <block id="97a98ebe6ac1f4a8eaf69158419dd818" category="paragraph">主機上的 NFSv4 網域名稱是在中設定<block ref="60969252b5b8391a3378335ae420d2e8" prefix=" " category="inline-code"></block></block>
  <block id="4ade50e8135e817e75aa3086851eaaa8" category="paragraph">網域名稱必須相符。如果沒有、則會在中顯示類似下列的對應錯誤<block ref="452905a167cf4509fd08acb964fdb20c" prefix=" " category="inline-code"></block>：</block>
  <block id="c0eb73bb35a4c58d87b330cd00f1986a" category="paragraph">應用程式二進位檔（例如 Oracle 資料庫二進位檔）包含 root 擁有的具有 setuid 位元的檔案、這表示 NFSv4 網域名稱不相符會導致 Oracle 啟動失敗、並會發出呼叫檔案擁有權或權限的警告<block ref="dd440398b298ff16eb1188ba8afca6df" prefix=" " category="inline-code"></block>、位於<block ref="002f94d606ac06f290f33a5fcc67b264" prefix=" " category="inline-code"></block> 目錄。其內容應如下所示：</block>
  <block id="21cc6f8790de2a7022b344914915604e" category="paragraph">如果此檔案的擁有權為 nobody 、則可能是 NFSv4 網域對應問題。</block>
  <block id="203f1cdb2421d34e9eb7391e03ffcaf6" category="paragraph">若要修正此問題、請參閱<block ref="60969252b5b8391a3378335ae420d2e8" prefix=" " category="inline-code"></block> 根據 ONTAP 上的 vv4 識別碼網域設定來建立檔案、並確保檔案一致。如果沒有、請進行必要的變更、然後執行<block ref="1c7ebfbcaa2681599e41320ed491ca91" prefix=" " category="inline-code"></block>，然後等待一段時間讓變更傳播。接著、檔案擁有權應正確辨識為 root 。如果使用者嘗試執行<block ref="05f0da969f2e0e6ecf3ab445e1e665ad" prefix=" " category="inline-code"></block> 在 NFS 網域設定修正之前、可能需要在這個檔案上執行<block ref="05f0da969f2e0e6ecf3ab445e1e665ad" prefix=" " category="inline-code"></block> 再一次。</block>
  <block id="51fb8677d45bb006235a9f8cbe477f6f" category="summary">NFS 屬性快取資料庫</block>
  <block id="4da0a3b9c2e8fc0df8844a41ac133401" category="doc">使用資料庫進行 NFS 快取</block>
  <block id="748f6387bf49161b9a69b7bfd691dcd2" category="paragraph">如果存在下列任一掛載選項、則會停用主機快取：</block>
  <block id="9f75df502ef11eaef4292c94110cb673" category="paragraph">這些設定可能會嚴重影響軟體安裝、修補及備份 / 還原作業的速度。在某些情況下、尤其是叢集式應用程式、這些選項是必要的、因為必須在叢集中的所有節點之間提供快取一致性。在其他情況下、客戶誤用這些參數、結果是不必要的效能損害。</block>
  <block id="8d23519d53d6611bc42fef8dc4a432df" category="paragraph">許多客戶在安裝或修補應用程式二進位檔時、會暫時移除這些掛載選項。如果使用者在安裝或修補程序過程中確認沒有其他處理程序正在使用目標目錄、則可安全地執行此移除。</block>
  <block id="f73bede4039d47664f70de3c2d1f2b46" category="summary">適用於 Oracle 資料庫的 LVM 等量磁碟區組態</block>
  <block id="7844f2cc495a938f3039da5801958506" category="doc">使用 Oracle 資料庫進行 LVM 分拆</block>
  <block id="1b5681ffc153e25d2a48ae3f3f01b9f5" category="paragraph">LVM 分拆是指在多個 LUN 之間分配資料。如此一來、許多資料庫的效能大幅提升。</block>
  <block id="358b9a846de3e04b423c68bac9bc6d53" category="summary">LUN 與 Oracle 資料庫一致</block>
  <block id="c4cb2c6af5d7b6c38cd7e588d846e8b4" category="doc">Oracle I/O 的 LUN 對齊</block>
  <block id="3e00e4d28b17eedd6f6c2c38233e06a8" category="paragraph">LUN 對齊是指針對基礎檔案系統配置最佳化 I/O 。</block>
  <block id="a6c7e85d51ae3b98197ceb3eafa3686a" category="inline-link-macro">效率</block>
  <block id="6e2524d5663b2bdc0c7985fa3e57cc55" category="section-title">錯誤對齊警告</block>
  <block id="79e721357e358d77c4700c25c863fc37" category="inline-link">SAN主機組態ONTAP</block>
  <block id="268b1da3f1ff11d32e385d0223101718" category="paragraph">在 Solaris 環境中進行對齊更為複雜。請參閱<block ref="2d33e0364c07dc165b4079892340d4fe" category="inline-link-rx"></block> 以取得更多資訊。</block>
  <block id="6d017248f1e4f0ec7e2cd19d967b6bee" category="cell">在 Solaris x86 環境中、由於大多數組態都有多層分割區、因此請格外注意正確的對齊方式。Solaris x86 分割區磁碟片通常位於標準主開機記錄分割區表格的上方。</block>
  <block id="b1230060a0220caf9d68d64b9dd85e6f" category="summary">使用 Oracle 的 NFS 傳輸大小</block>
  <block id="fabe34ed4a5e432f4d1c4f6584956d8d" category="doc">Oracle 資料庫的 NFS 傳輸大小</block>
  <block id="1e207db9a7c8127a6c43c771b89254fb" category="paragraph">根據預設、 ONTAP 將 NFS I/O 大小限制為 64K 。</block>
  <block id="72d22e3b9af95e272859e64eb1d82df7" category="paragraph">大多數應用程式和資料庫的隨機 I/O 使用的區塊大小要小得多、遠低於 64K 的最大值。大型區塊 I/O 通常是平行處理的、因此 64K 的最大值也不是取得最大頻寬的限制。</block>
  <block id="ebf61afddb34d070825eb696bea48813" category="paragraph">有些工作負載的上限為 64K 、因此會造成限制。特別是、如果資料庫執行的 I/O 數量較少、但容量較大、則備份或還原作業或資料庫完整表格掃描等單執行緒作業、會更快、更有效率地執行。ONTAP 的最佳 I/O 處理大小為 256k 。</block>
  <block id="b0a5b394f3a29e64573049cda19fbacc" category="paragraph">指定 ONTAP SVM 的最大傳輸大小可變更如下：</block>
  <block id="b070b82d66be7116d5fd6dfd8172351b" category="cell">切勿將 ONTAP 上允許的傳輸大小上限降至低於目前掛載之 NFS 檔案系統的 rsize/wsize 值。這可能會在某些作業系統中造成當機或甚至資料毀損。例如、如果 NFS 用戶端目前設定為 rsize/wsize 65536 、則 ONTAP 最大傳輸大小可在 65536 到 1048576 之間調整、因為用戶端本身受到限制、因此沒有任何影響。將傳輸大小上限降至 65536 以下可能會損害可用度或資料。</block>
  <block id="a5c97d9c3645b9a26e3febeb4bc95e24" category="summary">使用 ONTAP 的 ASM 回收公用程式</block>
  <block id="861a5ecc95a8478c750be41bf2ddd6f5" category="doc">ASM 回收公用程式與零區塊偵測</block>
  <block id="8eb703f2756cafd21dbac4f23c0d6416" category="paragraph">啟用即時壓縮時、 ONTAP 可有效移除寫入檔案或 LUN 的歸零區塊。Oracle ASM 回收公用程式（ ASRU ）等公用程式的運作方式是將零寫入未使用的 ASM 範圍。</block>
  <block id="9de53c14f2bae0c5d4b6e19be495ee94" category="paragraph">從資料庫的角度來看、 ASM 磁碟群組包含零、讀取 LUN 的這些區域會產生零串流、但 ONTAP 不會將零儲存在磁碟機上。而是進行簡單的中繼資料變更、在內部將 LUN 的歸零區域標記為任何資料的空白。</block>
  <block id="06348c6e795160187e298a91b25a37a3" category="paragraph">由於類似的原因、涉及零位資料的效能測試無效、因為零區塊實際上並未在儲存陣列內以寫入方式處理。</block>
  <block id="cee584f1e6223f6dbb73c0d64d599228" category="admonition">使用 ASRU 時、請確定已安裝所有 Oracle 建議的修補程式。</block>
  <block id="17ff263bc6eb701aecb8e79f9ef53efd" category="summary">使用 Oracle 資料庫調整 LUN 和 LVM 大小</block>
  <block id="e0327f97ac271a738dd1ac6b182a4369" category="doc">LUN 調整大小和 LVM 型調整大小</block>
  <block id="ff15e8b125dae74c1231f09380e48886" category="paragraph">當 SAN 型檔案系統達到容量上限時、有兩個選項可以增加可用空間：</block>
  <block id="4182200437c090276a01ad8ca54076b0" category="summary">設定 NVFAIL 以保護 Oracle 資料庫</block>
  <block id="60e002164f8988e984cf4a95b240f19d" category="doc">Oracle 和 NVFAIL</block>
  <block id="370bdf5dd39278264774ea595054e243" category="paragraph">NVFAIL 是 ONTAP 中的一項功能、可確保災難性容錯移轉案例期間的完整性。</block>
  <block id="80250c1f1d70fc693877be6f22cc134e" category="paragraph">資料庫在儲存設備容錯移轉事件期間容易受損、因為它們會維持大型內部快取。如果災難性事件需要強制 ONTAP 容錯移轉或強制 MetroCluster 切換、無論整體組態的健全狀況為何、都可能會有效捨棄先前確認的變更。儲存陣列的內容會及時向後跳轉、而且資料庫快取的狀態不再反映磁碟上資料的狀態。這種不一致會導致資料毀損。</block>
  <block id="68114defc717054e7e3b02df438cdbe1" category="paragraph">快取可能發生在應用程式或伺服器層。例如、 Oracle Real Application Cluster （ RAC ）組態、主站台和遠端站台上的伺服器都處於作用中狀態、可在 Oracle SGA 中快取資料。強制切入作業會導致資料遺失、因此資料庫可能會發生毀損、因為儲存在 SGA 中的區塊可能與磁碟上的區塊不符。</block>
  <block id="162de6d405c04ce8f152f1d246ed9187" category="paragraph">較不明顯的快取用途是在作業系統檔案系統層。來自掛載 NFS 檔案系統的區塊可能會快取到作業系統中。或者、以位於主要站台上的 LUN 為基礎的叢集式檔案系統、可以掛載到遠端站台的伺服器上、然後再次快取資料。在這些情況下、 NVRAM 故障或強制接管或強制性的作業系統、可能會導致檔案系統毀損。</block>
  <block id="04ca8d9ad570a3bdf1d76e23bc108ae5" category="paragraph">ONTAP 使用 NVFAIL 及其相關設定、保護資料庫和作業系統不受此案例影響。</block>
  <block id="45293b650c7dacd88d269bebf219b8ef" category="summary">ONTAP 中的快速 Oracle 資料庫從 Snapshot 複本還原是由 NetApp SnapRestore 技術提供。</block>
  <block id="82ef718f4ebe0c276814ee3d51e33361" category="doc">SnapRestore</block>
  <block id="863696626734d6591db8be57b41c7eec" category="paragraph">NetApp SnapRestore 技術可從快照快速還原 ONTAP 中的資料。</block>
  <block id="9099b669f87419bc03914f11f5779c60" category="paragraph">當關鍵資料集無法使用時、關鍵業務營運就會中斷。磁帶可能會中斷、甚至是從磁碟型備份還原、在網路上傳輸速度可能會很慢。SnapRestore 可提供近乎即時的資料集還原功能、避免這些問題。即使是 PB 規模的資料庫、只要花幾分鐘的時間就能完全還原。</block>
  <block id="b02fb7dec22d0e276ca01cc60b9efb48" category="paragraph">SnapRestore 有兩種形式：檔案 /LUN 型和磁碟區型。</block>
  <block id="520e4b70b10aa2755a82b77e438a510f" category="list-text">無論是 2TB LUN 或 4KB 檔案、個別檔案或 LUN 都能在數秒內還原。</block>
  <block id="45e8a84fe4ac58c8b30a7bdaf17c0b7f" category="list-text">無論是 10GB 或 100TB 的資料、檔案或 LUN 的容器都能在數秒內還原。</block>
  <block id="4be4677be8cd434956b9b9af515b971a" category="paragraph">「檔案或 LUN 的容器」通常指的是 FlexVol Volume 。例如、您可以在單一磁碟區中擁有 10 個組成 LVM 磁碟群組的 LUN 、或是一個磁碟區可以儲存 1000 位使用者的 NFS 主目錄。您可以將整個磁碟區還原為單一作業、而不需為每個個別檔案或 LUN 執行還原作業。此程序也適用於包含多個磁碟區的橫向擴充容器、例如 FlexGroup 或 ONTAP 一致性群組。</block>
  <block id="a8d6a4d1b7fc6e1f60bb0ab716b4e72f" category="paragraph">SnapRestore 之所以能如此快速有效地運作、是因為 Snapshot 複本的本質、基本上是在特定時間點平行檢視 Volume 內容的唯讀檢視。作用中區塊是可以變更的實際區塊、而快照則是建立快照時構成檔案和 LUN 之區塊狀態的唯讀檢視。</block>
  <block id="55abea92d64d6738f9e0ed48799696e7" category="paragraph">ONTAP 僅允許唯讀存取快照資料、但可透過 SnapRestore 重新啟動資料。快照會重新啟用為資料的讀寫檢視、並將資料恢復至先前的狀態。SnapRestore 可以在磁碟區或檔案層級運作。這項技術基本上相同、但行為上有一些小差異。</block>
  <block id="f10f2af75e2770a8ed3c2fde594e986d" category="section-title">Volume SnapRestore</block>
  <block id="ca9846346bc3b03cdec10f9fff456866" category="paragraph">Volume 型 SnapRestore 會將整個資料量傳回至較早的狀態。這項作業不需要資料移動、也就是說還原程序基本上是即時的、雖然 API 或 CLI 作業可能需要幾秒鐘的時間才能處理。還原 1GB 的資料並不比還原 1PB 的資料複雜或耗時。這項功能是許多企業客戶移轉至 ONTAP 儲存系統的主要原因。即使是最大的資料集、也能以秒為單位提供 RTO 。</block>
  <block id="627436e77bb011a6a312ae87b12f98ea" category="paragraph">Volume 型 SnapRestore 的缺點之一、是因為磁碟區內的變更會隨時間累積。因此、每個快照和作用中檔案資料都取決於到該點之前的變更。將磁碟區還原為較早的狀態、表示捨棄所有後續對資料所做的變更。然而、不太明顯的是、這包括後續建立的快照。這並不總是理想的。</block>
  <block id="5c956f2c1cfc5b9e5bac32ad1acba314" category="paragraph">例如、資料保留 SLA 可能會指定每晚備份 30 天。將資料集還原至五天前以 Volume SnapRestore 建立的快照、將會捨棄前五天建立的所有快照、違反 SLA 。</block>
  <block id="8bf9e697004f47ed6133aef724a8a42c" category="paragraph">有許多選項可解決此限制：</block>
  <block id="ad3b75456e625de5fe347fb918f59a22" category="list-text">資料可從先前的快照複製、而非執行整個 Volume 的 SnapRestore 。此方法最適合較小的資料集。</block>
  <block id="90541eb74c7c56cadc2f90ec6fb6f0c0" category="list-text">您可以複製快照、而非還原快照。此方法的限制在於來源快照是複本的相依性。因此、除非也刪除複本、或將其分割成一個不同的 Volume 、否則無法將其刪除。</block>
  <block id="ab6045d3463c0f68ce2fa405dce9d554" category="list-text">使用檔案型 SnapRestore 。</block>
  <block id="7f7599a8b92846b691484dc91e090164" category="section-title">File SnapRestore</block>
  <block id="f03eebe4f07d362dbfe4c1d4e76c724d" category="paragraph">檔案型 SnapRestore 是更精細的快照型還原程序。個別檔案或 LUN 的狀態會還原、而非還原整個磁碟區的狀態。不需要刪除快照、此作業也不需要對先前的快照建立任何相依性。檔案或 LUN 會立即在作用中磁碟區中可用。</block>
  <block id="e432fdcc277fc74a1b2b94cfeec8a7d2" category="paragraph">SnapRestore 還原檔案或 LUN 時不需要移動資料。不過、需要進行一些內部中繼資料更新、以反映檔案或 LUN 中的基礎區塊現在同時存在於快照和作用中磁碟區中。不應影響效能、但此程序會封鎖快照的建立、直到快照完成為止。根據還原的檔案總大小、處理速度約為 5Gbps （ 18TB/ 小時）。</block>
  <block id="a68b31b502bf7555cda2514354e553c2" category="summary">ONTAP 資料保護策略</block>
  <block id="6bb9a5aec98309d1414b32f7e0751415" category="doc">資料保護規劃</block>
  <block id="45c46768a1cb073f0d13245a0dc816f2" category="paragraph">正確的企業資料保護架構、取決於資料保留、可恢復性、以及各種事件中斷的容忍度等業務需求。</block>
  <block id="46e1b2893bdb002c0ede448cbfe1cb14" category="paragraph">例如、請考慮範圍內的應用程式、資料庫和重要資料集數量。為單一資料集建立備份策略、以確保符合典型 SLA 的要求相當簡單、因為沒有太多物件需要管理。隨著資料集數量增加、監控作業變得更複雜、系統管理員可能不得不花費更多時間來解決備份故障。當環境達到雲端與服務供應商的規模時、需要完全不同的方法。</block>
  <block id="b70d233428e03d072b1134a97d853ab2" category="paragraph">資料集大小也會影響策略。例如、由於資料集太小、因此有許多選項可用於 100GB 資料庫的備份與還原。只要使用傳統工具從備份媒體複製資料、通常就能提供足夠的恢復 RTO 。100TB 資料庫通常需要完全不同的策略、除非 RTO 允許多天中斷、否則傳統的複製備份與還原程序可能是可以接受的。</block>
  <block id="64848fee9c168231f5d0f13322ed0a87" category="paragraph">最後、除了備份與還原程序本身之外、還有其他因素。例如、是否有支援關鍵生產活動的資料庫、使恢復成為僅由熟練的 DBA 執行的罕見事件？或者、資料庫是否是大型開發環境的一部分、而在大型開發環境中、恢復是經常發生的事、並由一群通才的 IT 團隊負責管理？</block>
  <block id="e26b57887de9a65c0316a87d49bf6c44" category="section-title">快照是否為備份？</block>
  <block id="c3fd105ab426caff0a0ade2e93476543" category="paragraph">人們普遍反對使用快照做為資料保護策略、因為「真實」資料和快照資料位於同一個磁碟機上。遺失這些磁碟機將會導致主要資料和備份遺失。</block>
  <block id="12d1adb01d24027626b2a47660fb5b81" category="paragraph">這是一項有效的考量。本機快照是用於日常備份與還原需求、在這方面、快照是備份。在 NetApp 環境中、將近 99% 的還原案例都仰賴快照來滿足最嚴苛的 RTO 需求。</block>
  <block id="fc34c9966c8ecb7307468637d9e79933" category="paragraph">然而、本機快照不應是唯一的備份策略、因此 NetApp 提供 SnapMirror 複寫等技術、可快速有效地將快照複寫至一組不同的磁碟機。在架構正確的解決方案中、快照加上快照複寫功能可將磁帶的使用降至最低、甚至是每季歸檔、或完全消除。</block>
  <block id="1ea948130a9dbbc02e3a80648a99ff57" category="section-title">一致性群組備份</block>
  <block id="9b234a126e57777ab83807827d4e7078" category="paragraph">一致性群組備份包括在單一時間點擷取資料集（或多個資料集）的狀態。例如、這包括所有資料庫元件、例如資料檔案、記錄檔、以及與資料庫直接相關的其他檔案。這幾乎適用於所有關聯式資料庫產品、包括 Oracle RDBMS 、 Microsoft SQL Server 、 SAP HANA 、 PostgreSQL 、 MySQL 和 MariaDB 。使用一致性群組備份來保護 VMware 組態的做法類似、也就是在單一時間點內擷取所有的資料存放區、以及可能的 ESX 開機 LUN 。</block>
  <block id="5a1f7038c74e54c08669efa6722f1091" category="paragraph">建立這樣的一致性群組快照、基本上就是模擬當機、這就是為什麼這類備份經常稱為損毀一致的備份。有時候、對於支援恢復案例有疑慮、但請務必瞭解、通常不需要任何恢復程序。當應用程式在還原一致性群組備份之後啟動時、會執行一般的記錄還原程序、檔案系統日誌重新播放、以及其他工作、以重播備份點正在執行中的任何 I/O 。然後應用程式會照常啟動。</block>
  <block id="aebdbddec25f7eba6434244a989fb659" category="paragraph">基本上、任何能夠承受停電或伺服器當機而不毀損資料的應用程式、都能以這種方式受到保護。許多不同廠商的同步與非同步鏡射產品、可保護大量應用程式、也能證明這項工作的成效。如果災難突然發生在主要站台、則複本站台會在發生災難時、包含原始環境的一致映像。再一次、不需要特殊的恢復程序。</block>
  <block id="e085ffefd89f8fb66260a9720e3fb6f8" category="paragraph">此方法的 RPO 通常僅限於備份點。一般而言、單一磁碟區快照的最小 RPO 是一小時。例如、 48 小時快照加上 30 天夜間快照是合理的、不需要保留過多的快照。不到一小時的 RPO 就變得更難達成、建議您先諮詢 NetApp 專業服務部門、瞭解環境、規模及資料保護需求。</block>
  <block id="1fe119a790b393b7dd7e79b63f15f52b" category="paragraph">RTO 通常可在數秒內測量。應用程式會關閉、磁碟區會還原、應用程式也會重新啟動。</block>
  <block id="444cd304758b7607c8f7a3f627a5bc1f" category="paragraph">最簡單的方法是將所有檔案或 LUN 放在單一磁碟區一致性群組中、以便直接在 ONTAP 中排程快照建立。如果資料集必須跨越多個磁碟區、則需要一致性群組快照（ CG-snapshot ）。這可以使用系統管理員或 RESTful API 呼叫來設定、而且 SnapCenter 能夠在已定義的磁碟區清單上建立簡單的一致性群組快照。</block>
  <block id="689b0155b42a554594a44cddc736eb67" category="section-title">複寫與災難恢復架構</block>
  <block id="1749d12df3df2319d3eee218a277ff83" category="inline-link-macro">MetroCluster</block>
  <block id="7b8111b0a2fc76252bbacbbc9de542a4" category="inline-link-macro">SnapMirror營運不中斷</block>
  <block id="96a7c86d5bc52a478876c48dc6dcc9f0" category="paragraph">本節說明遠端資料保護、將資料複寫到遠端站台、以保護異地儲存和災難恢復的安全。請注意、這些表格並未解決同步鏡射資料保護問題。如需此需求、請參閱 NetApp MetroCluster 文件、包括 <block ref="5c964f26ec7fbbad5ac67aaa5dcf9269" category="inline-link-macro-rx"></block> 和 <block ref="30831ec866621e18e7521d6c2750acaa" category="inline-link-macro-rx"></block></block>
  <block id="f443592081a2b3ddc55b94abe49ba128" category="paragraph">災難恢復 RPO 受限於可用的網路頻寬和受保護資料的總大小。建立初始基準傳輸之後、更新僅以變更的資料為基礎、這通常是資料佔用空間總量的低百分比、但確實存在例外情況。</block>
  <block id="89e87a831dae60244ba34496d70fd45d" category="paragraph">例如、每週變更率為 10% 的 10TB 資料庫、在總變更中、平均每小時約為 6GB 。10 Gb 的連線能力、此資料庫需要大約六分鐘的時間才能傳輸。變更率會因資料庫變更率的波動而異、但整體而言、 15 分鐘的更新間隔、因此應可達成 15 分鐘的 RPO 。如果有 100 個這樣的資料庫、則需要 600 分鐘才能傳輸資料。因此、一小時的 RPO 是不可能的。同樣地、單一資料庫的複本、每週變更率為 10% 、大小為 100TB 、無法在一小時內可靠地更新。</block>
  <block id="3c886a803aef21f5ac9f7bcea7408cbb" category="paragraph">其他因素可能會影響複寫作業、例如複寫作業的額外負荷和限制。不過、單一磁碟區複寫策略的整體規劃可根據可用頻寬進行、複寫 RPO 一般可達一小時。不到一小時的 RPO 變得更難達成、只能在諮詢 NetApp 專業服務之後才能執行。在某些情況下、 15 分鐘的時間是可行的、因為站台對站台網路連線能力非常好。不過、整體而言、當需要一小時以下的 RPO 時、多重 Volume 記錄重播架構會產生更好的結果。</block>
  <block id="5e2cbdd214e7a73bca1af8ed5cc04626" category="paragraph">災難恢復案例中的 RTO 與一致性群組複寫功能非常出色、通常從儲存點算起、以秒為單位。最直接的方法是中斷鏡射、資料庫已準備就緒、可以開始運作。資料庫啟動時間通常約為 10 秒、但有大量記錄交易的大型資料庫可能需要幾分鐘的時間。</block>
  <block id="1c18c939e73ddb1ceee34e8a33079d1a" category="paragraph">判斷 RTO 的最重要因素不是儲存系統、而是執行 RTO 的應用程式和主機作業系統。例如、複寫的資料可在一秒或兩秒內提供、但這只代表資料。此外、還必須有正確設定的作業系統、並具備應用程式二進位檔、才能使用資料。</block>
  <block id="6fab898feea25b9d7fd4477911b90b31" category="paragraph">在某些情況下、客戶已預先準備好災難恢復執行個體、並在作業系統上預先探索到儲存設備。在這些情況下、啟動災難恢復案例只需要中斷鏡射並啟動應用程式即可。在其他情況下、作業系統和相關應用程式可能會與資料庫一起鏡射、做為 ESX 虛擬機器磁碟（ VMDK ）。在這些案例中、 RPO 是由客戶投資多少自動化來快速啟動 VMDK 、以便啟動應用程式所決定。</block>
  <block id="c7d5d755b896edf43189fbb020202913" category="paragraph">保留時間部分由快照限制控制。例如、 ONTAP 中的磁碟區限制為 1024 個快照。在某些情況下、客戶會使用多工複寫來增加限制。例如、如果需要 2000 天的備份、則可以將來源複寫到兩個磁碟區、並在其他日期進行更新。這需要增加所需的初始空間、但與傳統的備份系統相比、它仍然是更有效率的方法、而傳統的備份系統則需要多個完整備份。</block>
  <block id="7ec0f114b69016879106b5018cdf10b9" category="section-title">單一磁碟區一致性群組</block>
  <block id="cd70f3e596e275fe80fbbe5d7858ce1a" category="paragraph">最簡單的方法是將所有檔案或 LUN 放在單一磁碟區一致性群組中、以便直接在儲存系統上排程 SnapMirror 和 SnapVault 更新。不需要外部軟體。</block>
  <block id="909e8df57072d0b3c6d7d64b11acb571" category="section-title">多磁碟區一致性群組</block>
  <block id="c7371eded617935ace6c71a33cfbf3fd" category="paragraph">當資料庫必須跨越磁碟區時、需要一致性群組快照（ CG-snapshot ）。如前所述、這可以使用系統管理員或 RESTful API 呼叫來設定、而且 SnapCenter 能夠在已定義的磁碟區清單上建立簡單的一致性群組快照。</block>
  <block id="9c991b38c054d7bec0632efd6667540c" category="paragraph">另外還有一項考量、就是使用多個 Volume 一致的快照來進行災難恢復。執行多個磁碟區的更新時、可能會在傳輸仍在進行中時發生災難。結果是一組不一致的磁碟區。如果發生這種情況、某些磁碟區必須還原為較早的快照狀態、才能提供一致當機且可供使用的資料庫映像。</block>
  <block id="fad8a5f46ebd89f74383b461e32dd6b9" category="section-title">災難恢復：啟動</block>
  <block id="5ac319591298468b0af89c2c469201f8" category="paragraph">啟動災難恢復複本的程序取決於儲存類型。有了 NFS 、檔案系統就可以預先掛載到災難恢復伺服器上。它們處於唯讀狀態、當鏡射中斷時會變成讀寫狀態。如此可提供極低的 RPO 、而且整體災難恢復程序更可靠、因為需要管理的零件較少。</block>
  <block id="b829fc11ff11b57af8d4632d38d7d7e8" category="paragraph">在災難恢復變得更複雜時啟動 SAN 組態。最簡單的選項通常是暫時中斷鏡像並掛載 SAN 資源、包括探索 LVM 組態（包括 Oracle 自動儲存管理 [ASM/] 等應用程式特定功能）、以及新增項目至 /etc/fstab 。</block>
  <block id="335a5796fb106a877544d121062534be" category="paragraph">結果是目標伺服器知道 LUN 裝置路徑、磁碟區群組名稱和其他裝置路徑。然後可以關閉這些資源、然後還原鏡像。結果是伺服器處於可快速將應用程式上線的狀態。啟動磁碟區群組、掛載檔案系統、或啟動資料庫和應用程式的步驟都能輕鬆自動化。</block>
  <block id="b1a175c5f42da29f6c27f4ea29684b63" category="paragraph">必須謹慎確保災難恢復環境是最新的。例如、新的 LUN 可能會新增至來源伺服器、這表示必須在目的地預先探索新的 LUN 、以確保災難恢復計畫能如預期般運作。</block>
  <block id="90426ba53f908049843b3ea392578d04" category="doc">Oracle 災難恢復</block>
  <block id="7fe779a487e8f113f1ffdff0fb80353f" category="summary">ONTAP 上 Oracle 的一致性群組備份</block>
  <block id="773f9afa3df0cf82ed853c988183c73f" category="doc">Oracle 一致性群組備份</block>
  <block id="5afd3dc3f8d489d47587e10e6663c512" category="paragraph">若要進行最簡單的備份、只要將整個 Oracle 資料庫放在單一磁碟區即可。</block>
  <block id="2a4fa9d9434561574119e3086112023f" category="paragraph">使用單一快照來保護資料檔案、歸檔記錄檔、重做記錄檔和控制檔是一種有效的備份、還原和複寫方法。  不過、 RPO 僅限於備份本身的點。適用於一小時或更長的 RPO 。如果資料庫跨越磁碟區、則需要使用先前討論的工具之一來建立 CG 快照。</block>
  <block id="93310f4cebc752304c164f00d67e0bca" category="paragraph">例如、整個資料庫可以位於單一磁碟區、其快照排程如下：</block>
  <block id="a33821be4b3522d65daed1ec317299f6" category="list-text">72 小時快照</block>
  <block id="0eea0679ac7bf43c19d603cd78e81de9" category="list-text">30 個夜間快照</block>
  <block id="c4546c401776d279c5577011584577fa" category="list-text">12 個月快照</block>
  <block id="b63db1b650d128c342617b377baf928a" category="paragraph">這可在前 72 小時的滾動期間提供 1 小時的 RPO 、以及額外的夜間和每月備份。單一磁碟區或一組 CG 快照也可包含多個資料庫或應用程式檔案、以便在大型環境中提供一致的備份。</block>
  <block id="5eb532bcede5a8d57b8fb4429d5cc7ec" category="summary">透過 ONTAP 上的 Oracle 、將可用度最大化</block>
  <block id="b4343a8438e1b9cc9e9486f85831f2a1" category="doc">ONTAP 提供 Oracle 資料可用度</block>
  <block id="686540783626106489734a1990d4930d" category="paragraph">ONTAP 旨在提供最大的 Oracle 資料庫可用度。ONTAP 高可用度功能的完整說明不在本文件的範圍之內。然而、與資料保護一樣、在設計資料庫基礎架構時、對此功能的基本瞭解非常重要。</block>
  <block id="b049fcbe8198301adc6bf87634a02845" category="section-title">HA 配對</block>
  <block id="1a7c11d1e2d03d3d1b57cff284ebd761" category="paragraph">高可用度的基本單位是 HA 配對。每對都包含備援連結、可支援將資料複寫到 NVRAM 。NVRAM 不是寫入快取。控制器內的 RAM 會做為寫入快取。NVRAM 的用途是暫時記錄資料、以防止發生非預期的系統故障。在這方面、它與資料庫重做記錄類似。</block>
  <block id="cd2e54027dfcfeddd07ddd580db527c0" category="paragraph">NVRAM 和資料庫重做記錄都可用來快速儲存資料、讓資料的變更能夠儘快提交。磁碟機（或資料檔案）上的持續資料更新直到稍後在 ONTAP 和大多數資料庫平台上稱為檢查點的程序期間才會進行。正常作業期間不會讀取 NVRAM 資料或資料庫重做記錄。</block>
  <block id="4e044ec0c36e513506c77c0a97d53539" category="paragraph">如果控制器突然故障、可能會有擱置中的變更、這些變更儲存在 NVRAM 中、但尚未寫入磁碟機。合作夥伴控制器會偵測故障、控制磁碟機、並套用儲存在 NVRAM 中的必要變更。</block>
  <block id="310e46747ebab6a43d5a15998f6e2b33" category="section-title">接管與恢復</block>
  <block id="1d739263e44469ad28f77fe7329fa78d" category="paragraph">接管與恢復是指在 HA 配對中的節點之間轉移儲存資源責任的程序。接管和恢復有兩個層面：</block>
  <block id="f2d43d90397aa8140414437eda14febb" category="list-text">管理可存取磁碟機的網路連線能力</block>
  <block id="6e1c794c81468e3286a23138460bb3fb" category="list-text">管理磁碟機本身</block>
  <block id="89d3f6c60c53a11e16a6756bde03ca00" category="paragraph">支援 CIFS 和 NFS 流量的網路介面、都是設定在主位置和容錯移轉位置。接管包括將網路介面移至與原始位置位於同一子網路的實體介面上的暫存主目錄。贈品包括將網路介面移回其原始位置。您可以視需要調整確切行為。</block>
  <block id="108018656caf59cc565f1172047dab38" category="paragraph">支援 SAN 區塊傳輸協定（例如 iSCSI 和 FC ）的網路介面不會在接管和恢復期間重新定位。而是應使用包含完整 HA 配對的路徑來佈建 LUN 、以產生主要路徑和次要路徑。</block>
  <block id="80795d5dd590e432b4f5945aba47caf4" category="admonition">您也可以設定其他控制器的路徑、以支援在較大叢集中的節點之間重新放置資料、但這並不屬於 HA 程序的一部分。</block>
  <block id="aae63904d16fd1c522dc5ff53eb695b5" category="paragraph">接管與恢復的第二個層面是磁碟擁有權的轉移。確切的程序取決於多種因素、包括接管 / 恢復的原因、以及發出的命令列選項。目標是盡可能有效率地執行作業。雖然整體程序可能需要幾分鐘的時間、但磁碟機的實際擁有權從節點移轉至節點的時間通常只需幾秒鐘。</block>
  <block id="61775b9e8f759f26eafd6b03448d1f30" category="section-title">接管時間</block>
  <block id="3224b51e62790c4ce988d8c1876fb36e" category="paragraph">主機 I/O 在接管和恢復作業期間會短暫暫停 I/O 、但在正確設定的環境中不應發生應用程式中斷。I/O 延遲的實際轉換程序通常是以秒為單位來測量、但主機可能需要額外的時間來識別資料路徑的變更並重新提交 I/O 作業。</block>
  <block id="40f291752a9848bfecb7264cfd9aa8ee" category="paragraph">中斷的性質取決於傳輸協定：</block>
  <block id="cb44db7841f8fb68230a260c4c68bfe0" category="list-text">支援 NFS 和 CIFS 流量的網路介面會在移轉至新實體位置後、向網路發出位址解析傳輸協定（ ARP ）要求。這會導致網路交換器更新其媒體存取控制（ MAC ）位址表、並繼續處理 I/O在計畫性接管和恢復的情況下、中斷通常以秒為單位來衡量、在許多情況下都無法偵測到。有些網路可能會較慢、無法完全辨識網路路徑的變更、有些作業系統可能會在很短的時間內排入大量 I/O 、因此必須重新嘗試。這可能會延長恢復 I/O 所需的時間</block>
  <block id="6a410522094e0b0f874dab5784e81ab8" category="list-text">支援 SAN 通訊協定的網路介面不會轉換到新位置。主機作業系統必須變更使用中的路徑。主機觀察到 I/O 暫停的情形取決於多種因素。從儲存系統的角度來看、無法提供 I/O 的時間只有幾秒鐘。不過、不同的主機作業系統可能需要額外的時間、才能讓 I/O 逾時、再重試。較新的作業系統更能更快辨識路徑變更、但較舊的作業系統通常需要 30 秒才能辨識變更。</block>
  <block id="cabc4f9cda7d4bfb99181166c863a374" category="paragraph">下表顯示儲存系統無法將資料提供給應用程式環境的預期接管時間。在任何應用程式環境中都不應發生任何錯誤、而是在 IO 處理過程中、接管應該會顯示為短暫的暫停。</block>
  <block id="c8984126713ed072b9cb0a44a162be4d" category="cell">AFF</block>
  <block id="b7b46ce5d1a547db89c0bc615ff272a5" category="cell">ASA</block>
  <block id="ed3467fac861f6a32cd66093ac415805" category="cell">計畫性接管</block>
  <block id="57a915dfa0e8469b25c1b8b947f7ee2c" category="cell">15 秒</block>
  <block id="cd5dce62294e9a79e9c2165ee0903f5f" category="cell">6-10 秒</block>
  <block id="cbfdbb11fd5eab0d9fdd078ae66a1c69" category="cell">2-3 秒</block>
  <block id="1a066f0304c1d3a279466c70359c5103" category="cell">非計畫性接管</block>
  <block id="0f4a6e109a34d3483995e427b6581130" category="cell">30 秒</block>
  <block id="a4985782267828ce03a3d13f37392de1" category="summary">Checksum 與 Oracle 資料保護</block>
  <block id="407941abab873f61b271b481e105eb33" category="doc">Checksum 與 Oracle 資料完整性</block>
  <block id="b93232347a11497969d0ea20d34cd16e" category="paragraph">NetApp 常問的一個問題是如何保護 Oracle 資料庫的資料完整性。</block>
  <block id="dbfb054670bc82c6e08a7e101c0f0ef4" category="paragraph">ONTAP 內的邏輯資料保護包含三項關鍵需求：</block>
  <block id="b6cc6762545d78ab663e39c37d172bd2" category="list-text">資料必須受到保護、以免資料毀損。</block>
  <block id="e7c7e14f4b6ca1b3ae32b2279243dba6" category="list-text">資料必須受到保護、避免磁碟機故障。</block>
  <block id="1168469b387027a850496f6cac9f3529" category="list-text">資料變更必須受到保護、以免遺失。</block>
  <block id="864a6ca5da4b36656beba11c90f4c4e5" category="paragraph">以下各節將討論這三項需求。</block>
  <block id="a05b54004946aa523bfe7c1e92a52f52" category="section-title">網路毀損： Checksum</block>
  <block id="ed95581a613a4f19be367c10cd063cc2" category="paragraph">最基本的資料保護層級是 Checksum 、這是儲存在資料旁的特殊錯誤偵測程式碼。在網路傳輸期間、會使用 Checksum 和（在某些情況下）多個 Checksum 來偵測資料毀損。</block>
  <block id="c1343e51090396cf011509389bc0adab" category="paragraph">例如、 FC 框架包含稱為循環備援檢查（ CRC ）的校驗和形式、以確保有效負載不會在傳輸過程中毀損。傳輸器會同時傳送資料和資料的 CRC 。FC 訊框的接收器會重新計算接收資料的 CRC 、以確保其符合傳輸的 CRC 。如果新計算的 CRC 與附加至框架的 CRC 不相符、則資料會毀損、 FC 框架會遭到捨棄或拒絕。iSCSI I/O 作業包括 TCP/IP 層和乙太網路層的校驗和、此外、為了提供額外的保護、也可在 SCSI 層提供選用的 CRC 保護。TCP 層或 IP 層偵測到線路上的任何位元毀損、導致封包重新傳輸。與 FC 一樣、 SCSI CRC 中的錯誤也會導致作業遭到捨棄或拒絕。</block>
  <block id="1f08639c540e47068c16c3ac48ea7bbe" category="section-title">磁碟機毀損： Checksum</block>
  <block id="c5d50bc8d916a4b26166bbda091cd6d4" category="paragraph">Checksum 也可用來驗證儲存在磁碟機上的資料完整性。寫入磁碟機的資料區塊會以 Checksum 功能儲存、產生與原始資料相關的不可預測數字。從磁碟機讀取資料時、會重新計算總和檢查碼、並與儲存的總和檢查碼進行比較。如果不相符、則資料已毀損、必須由 RAID 層還原。</block>
  <block id="8edc44db01815f20f6508db8b5630cfe" category="section-title">資料毀損：寫入遺失</block>
  <block id="972eab86b2aecd693914feabc5a3b65c" category="paragraph">最難偵測的毀損類型之一是遺失或錯誤寫入。確認寫入後、必須將其寫入正確位置的媒體。就地資料毀損使用儲存在資料中的簡單檢查碼、相當容易偵測。但是、如果寫入資料只是遺失、則先前版本的資料可能仍然存在、而且總和檢查碼是正確的。如果寫入放置在錯誤的實體位置、則相關的 Checksum 將再次對儲存的資料有效、即使寫入已銷毀其他資料。</block>
  <block id="53830741c46fbc560962b086f582e79a" category="paragraph">這項挑戰的解決方案如下：</block>
  <block id="656d064400822ca2ffb25f52c9fc95db" category="list-text">寫入作業必須包含中繼資料、以指出寫入的預期位置。</block>
  <block id="37a60b1c7392a26270880a361f85db55" category="list-text">寫入作業必須包含某種版本識別碼。</block>
  <block id="4275b2e68761baa23b112833facf4ca1" category="paragraph">ONTAP 寫入區塊時、會包含區塊所屬的資料。如果後續讀取識別出某個區塊、但中繼資料指出該區塊在位置 456 找到時屬於位置 123 、則表示該寫入已放錯位置。</block>
  <block id="009b13bf07c7db21c1e4769526e60694" category="paragraph">更難偵測完全遺失的寫入。這項說明非常複雜、但基本上 ONTAP 是以寫入作業導致磁碟機上兩個不同位置的更新方式來儲存中繼資料。如果寫入遺失、後續的資料讀取和相關中繼資料會顯示兩個不同的版本識別。這表示磁碟機未完成寫入。</block>
  <block id="3b04a99c209a31ad69e7865ea94e5c94" category="paragraph">遺失或放錯位置的寫入毀損極少發生、但隨著磁碟機持續成長、資料集也逐漸擴充至 EB 規模、風險也會增加。任何支援資料庫工作負載的儲存系統都應包含遺失寫入偵測。</block>
  <block id="e978ccc010ec4d37148d52e2fbf439dd" category="section-title">磁碟機故障： RAID 、 RAID DP 和 RAID-TEC</block>
  <block id="a9fffaaf2b1b518afb56ef273736c0c2" category="paragraph">如果發現磁碟機上的資料區塊毀損、或整個磁碟機故障且完全無法使用、則必須重新建立資料。這是在 ONTAP 中使用同位元磁碟機來完成的。資料會在多個資料磁碟機之間進行等量分割、然後產生同位元檢查資料。這會與原始資料分開儲存。</block>
  <block id="54abdf00b7122c16619266482eb09f43" category="paragraph">ONTAP 最初使用 RAID 4 、每組資料磁碟機使用單一同位元檢查磁碟機。結果是群組中的任何一個磁碟機都可能發生故障、而不會導致資料遺失。如果同位元磁碟機故障、則沒有資料受損、也可以建構新的同位元磁碟機。如果單一資料磁碟機故障、其餘磁碟機可與同位元磁碟機搭配使用、以重新產生遺失的資料。</block>
  <block id="6d1ccb512ce2b25e53d90e6d8d459e18" category="paragraph">當磁碟機很小時、同時發生兩個磁碟機故障的統計機率可忽略不計。隨著磁碟機容量的增加、磁碟機故障後重建資料所需的時間也隨之增加。這增加了第二個磁碟機故障會導致資料遺失的時間。此外、重建程序也會在正常運作的磁碟機上建立許多額外的 I/O 。隨著磁碟機老化、導致第二個磁碟機故障的額外負載風險也會增加。最後、即使持續使用 RAID 4 、資料遺失的風險並未增加、資料遺失的後果也會更加嚴重。在 RAID 群組故障時遺失的資料越多、還原資料所需的時間就越長、業務中斷也就越長。</block>
  <block id="caef9e75bcd55d5a9a4ec855b5a6385c" category="paragraph">這些問題導致 NetApp 開發 NetApp RAID DP 技術、這是 RAID 6 的變體。此解決方案包含兩個同位元檢查磁碟機、表示 RAID 群組中的任何兩個磁碟機都可能發生故障、而不會造成資料遺失。磁碟機的大小持續成長、最終導致 NetApp 開發 NetApp RAID-TEC 技術、引進第三個同位元磁碟機。</block>
  <block id="704c2697ee323569003b7b7ea203ae0f" category="paragraph">某些歷史資料庫最佳實務做法建議使用 RAID-10 、也稱為等量鏡射。因為有多個雙磁碟故障案例、因此資料保護功能比 RAID DP 更少、而在 RAID DP 中則沒有。</block>
  <block id="3d0147402d7506d1d3a5227fe447427a" category="paragraph">由於效能考量、有些歷史資料庫最佳實務做法表示 RAID-10 較 RAID-4/5/6 選項更為偏好。這些建議有時是指 RAID 罰款。雖然這些建議一般都是正確的、但不適用於在 ONTAP 中實作 RAID 。效能考量與同位元重生有關。在傳統的 RAID 實作中、處理資料庫執行的例行隨機寫入作業需要多個磁碟讀取才能重新產生同位元資料並完成寫入。其懲罰定義為執行寫入作業所需的額外讀取 IOPS 。</block>
  <block id="84ff015d2df40fc0ebb34485173f39e4" category="paragraph">ONTAP 不會發生 RAID 損失、因為寫入會分段在記憶體中產生同位元檢查、然後以單一 RAID 等量磁碟寫入磁碟。完成寫入作業不需要讀取。</block>
  <block id="b7fe11ecbd8b434a231195335b4894ac" category="paragraph">總而言之、相較於 RAID 10 、 RAID DP 和 RAID-TEC 可提供更多可用容量、更好的磁碟機故障防護、而且不會犧牲效能。</block>
  <block id="e5e0dc0629a299f8e56ebe7de38f49f9" category="section-title">硬體故障保護： NVRAM</block>
  <block id="1db5fde40e489d805029f9d5be6375e7" category="paragraph">任何服務資料庫工作負載的儲存陣列、都必須儘快服務寫入作業。此外、寫入作業也必須受到保護、避免因電源故障等非預期事件而遺失。這表示任何寫入作業都必須安全地儲存在至少兩個位置。</block>
  <block id="ff540b857af868ec85f8f53ddc1f1bd1" category="paragraph">AFF 和 FAS 系統仰賴 NVRAM 來滿足這些需求。寫入程序的運作方式如下：</block>
  <block id="049f2df0de743a6be8d3ec69864f234a" category="list-text">傳入寫入資料儲存在 RAM 中。</block>
  <block id="976be2293c2f4499d079224003644acf" category="list-text">必須對磁碟上的資料所做的變更、會同時記入本機節點和合作夥伴節點上的 NVRAM 。NVRAM 不是寫入快取、而是類似資料庫重做記錄的日誌。在正常情況下、系統不會讀取。它僅用於恢復、例如在 I/O 處理期間發生電源故障後。</block>
  <block id="8ae87ed4a421bec56e020cd0e83bd748" category="list-text">然後寫入會被確認給主機。</block>
  <block id="3a7682bcbb490353074b5ee69e18f01c" category="paragraph">此階段的寫入程序從應用程式的角度來看已完成、而且資料會受到保護、不會遺失、因為資料會儲存在兩個不同的位置。最後、變更會寫入磁碟、但此程序會從應用程式的觀點超出頻外、因為它會在寫入確認之後發生、因此不會影響延遲。此程序再次類似於資料庫記錄。對資料庫的變更會盡快記錄在重做記錄檔中、然後將變更確認為已認可。資料檔案的更新會在稍後進行、不會直接影響處理速度。</block>
  <block id="c17f09622da5f1e0064f7b6a65cb8b01" category="paragraph">如果控制器發生故障、合作夥伴控制器會取得所需磁碟的所有權、並重新執行 NVRAM 中記錄的資料、以恢復發生故障時正在執行的任何 I/O 作業。</block>
  <block id="24e6592d53b3bd56ed8827d2f51bb1ab" category="section-title">硬體故障保護： NVFAIL</block>
  <block id="7965eb54acae120d25d0c77b012b8f90" category="paragraph">如前所述、寫入必須先登入本機 NVRAM 及至少一個其他控制器上的 NVRAM 、才會被確認。此方法可確保硬體故障或停電不會導致機內 I/O 遺失如果本機 NVRAM 故障或連線至 HA 合作夥伴失敗、則無法再鏡射此傳輸中的資料。</block>
  <block id="307b6d3e63c12ada7fbcf75cdda0b574" category="paragraph">如果本機 NVRAM 回報錯誤、節點會關機。此關機會導致容錯移轉至 HA 合作夥伴控制器。由於發生故障的控制器尚未確認寫入作業、因此不會遺失任何資料。</block>
  <block id="6e0c6c8fe69a50581a4ac18acb2c04dd" category="paragraph">除非強制容錯移轉、否則 ONTAP 不允許在資料不同步時進行容錯移轉。以這種方式強制變更條件、即表示資料可能會留在原始控制器中、而且資料遺失是可以接受的。</block>
  <block id="a3961862ed464a06ef6fa4e23935fef2" category="paragraph">如果強制容錯移轉、則資料庫特別容易受損、因為資料庫會在磁碟上保留大量的內部資料快取。如果發生強制容錯移轉、先前確認的變更將會有效捨棄。儲存陣列的內容會有效地及時向後跳轉、而且資料庫快取的狀態不再反映磁碟上資料的狀態。</block>
  <block id="b46ce3019d702ee3ece327e5df990be0" category="paragraph">為了保護資料不受這種情況影響、 ONTAP 允許設定磁碟區、以針對 NVRAM 故障提供特殊保護。觸發時、此保護機制會導致磁碟區進入稱為 NVFAIL 的狀態。此狀態會導致 I/O 錯誤、導致應用程式關機、使其不使用過時的資料。資料不應遺失、因為儲存陣列上應該存在任何已確認的寫入資料。</block>
  <block id="322e1f85910dfc206274f8bd58a54a9d" category="list-text">指定站台上的每組磁碟機都會自動設定為一個或多個完全備援的 RAID-DP 或 RAID-TEC 群組、而不受鏡像的使用影響。即使在站台遺失之後、也能提供持續的資料保護。</block>
  <block id="dee2dfce5ab0c47301b3c12970a57aa6" category="paragraph">上圖說明 SyncMirror 組態範例。在控制器上建立了 24 個磁碟機的集合體、其中 12 個磁碟機來自於站台 A 上配置的機櫃、 12 個磁碟機來自於站台 B 上配置的機櫃磁碟機分為兩個鏡射 RAID 群組。RAID 群組 0 包括站台 A 上的 6 磁碟機叢、鏡射到站台 B 上的 6 磁碟機叢同樣地、 RAID Group 1 也包含站台 A 的 6 磁碟叢、鏡射到站台 B 的 6 磁碟叢叢</block>
  <block id="4fbc0abe91c0c1381d0a742f58b4e537" category="paragraph">SyncMirror 通常用於提供 MetroCluster 系統的遠端鏡射、每個站台都有一份資料複本。有時候、它是用來在單一系統中提供額外的備援層級。特別是提供機架層級的備援。磁碟機櫃已包含雙電源供應器和控制器、整體上比金屬板稍多、但在某些情況下、可能需要額外的保護。例如、有一位 NetApp 客戶部署 SyncMirror 、用於汽車測試期間使用的行動即時分析平台。系統由獨立的 UPS 系統提供獨立的電源供應器、分為兩個實體機架。</block>
  <block id="95a3cc99b05998d49d8e035b994815bc" category="paragraph">=checksum</block>
  <block id="0cac56685de94a3ef0e1fd2bfca0c112" category="paragraph">對於習慣使用 Oracle RMAN 串流備份的 DBA 來說、檢查和主題特別重要、因為它們會移轉至快照型備份。RMAN 的一項功能是在備份作業期間執行完整性檢查。雖然這項功能有一些價值、但其主要優點是資料庫並未用於現代化的儲存陣列。當實體磁碟機用於 Oracle 資料庫時、幾乎可以確定磁碟機老化時最終會發生毀損、這是由真正儲存陣列中的陣列型校驗和所解決的問題。</block>
  <block id="58d7088c13cf2013ef373d85e3c27de7" category="paragraph">使用真正的儲存陣列、資料完整性可在多個層級上使用校驗和加以保護。如果 IP 型網路中的資料毀損、傳輸控制傳輸協定（ TCP ）層會拒絕封包資料並要求重新傳輸。FC 傳輸協定包括校驗和、封裝的 SCSI 資料也一樣。在陣列上之後、 ONTAP 就有 RAID 和 Checksum 保護。可能會發生毀損、但如同大多數企業陣列一樣、系統會偵測並修正毀損。一般而言、整個磁碟機都會故障、導致 RAID 重建、資料庫完整性也不會受到影響。ONTAP 偵測到 Checksum 錯誤的頻率較低、表示磁碟機上的資料已損壞。然後磁碟機故障、 RAID 重建就會開始。資料完整性再次不受影響。</block>
  <block id="8b7b33533c2b36c157a0a482bdd52a8e" category="paragraph">Oracle 資料檔案和重做記錄架構也設計成即使在極端情況下、也能提供最高程度的資料完整性。在最基本的層級、 Oracle 區塊幾乎包含每個 I/O 的 Checksum 和基本邏輯檢查如果 Oracle 尚未當機或將資料表空間離線、則資料會保持不變。資料完整性檢查的程度可調整、 Oracle 也可設定為確認寫入。因此、幾乎所有的當機和故障情況都可以恢復、而且在極罕見的不可恢復情況下、系統會立即偵測到毀損。</block>
  <block id="4066c36b811913c85aa86346e30cee4d" category="paragraph">大多數使用 Oracle 資料庫的 NetApp 客戶在移轉至快照型備份後、都會停止使用 RMAN 和其他備份產品。仍有一些選項可讓 RMAN 使用 SnapCenter 執行區塊層級的還原。然而、日常使用的 RMAN 、 NetBackup 及其他產品只會偶爾用於建立每月或每季的歸檔複本。</block>
  <block id="d0cf0e689669c61d564607d2ef7deb79" category="paragraph">有些客戶選擇執行<block ref="d308cbfce7e270e5b41a84d84385645f" prefix=" " category="inline-code"></block> 定期對現有資料庫執行完整性檢查。NetApp 不鼓勵這種做法、因為它會產生不必要的 I/O 負載。如上所述、如果資料庫先前沒有遇到問題、就有可能發生<block ref="d308cbfce7e270e5b41a84d84385645f" prefix=" " category="inline-code"></block> 偵測問題接近零、此公用程式會在網路和儲存系統上產生非常高的連續 I/O 負載。除非有理由相信存在毀損、例如暴露於已知的 Oracle 錯誤、否則沒有理由執行<block ref="d308cbfce7e270e5b41a84d84385645f" prefix=" " category="inline-code"></block>。</block>
  <block id="db97518eeb3e040b5a78c451efd4b252" category="summary">快照最佳化備份</block>
  <block id="431bbcf828b8d3513280cb1207824991" category="doc">Oracle Storage Snapshot 最佳化備份</block>
  <block id="52fb042c0d82d8e7bdf9ae239c387729" category="paragraph">使用 Oracle 12c 、快照型備份與還原變得更簡單、因為不需要將資料庫置於熱備份模式。結果是能夠直接在儲存系統上排程快照式備份、同時仍保留執行完整或時間點還原的能力。</block>
  <block id="c9447fe684870cf68e9cb4f23f44db43" category="paragraph">雖然 DBA 較熟悉熱備份還原程序、但很長一段時間以來、它仍能使用資料庫處於熱備份模式時未建立的快照。恢復期間、 Oracle 10g 和 11g 需要額外的手動步驟、才能使資料庫保持一致。使用 Oracle 12c 、<block ref="a84f4f3da79386c29ab6dfa560af786e" prefix=" " category="inline-code"></block> 和<block ref="075b7d3bd3bbe7767f7ef62f430bc22b" prefix=" " category="inline-code"></block> 包含額外的邏輯、可在非熱備份模式的資料檔案備份上重播歸檔記錄。</block>
  <block id="5c7dba68615d3fa5c4c90a36dab57bcb" category="paragraph">如前所述、復原快照型熱備份需要兩組資料：</block>
  <block id="50a7086972cada154c8164dc1c6b3539" category="list-text">在備份模式下建立的資料檔案快照</block>
  <block id="c72d009669a638aab75c21a28a2101de" category="list-text">資料檔案處於熱備份模式時所產生的歸檔記錄</block>
  <block id="b8de4b1201e5595bc3de878f2bf59d9b" category="paragraph">在還原期間、資料庫會從資料檔案讀取中繼資料、以選取所需的歸檔記錄進行還原。</block>
  <block id="66ee0a6fd90f3cfab8320e1de1341cbd" category="paragraph">儲存快照最佳化的還原需要稍微不同的資料集、才能達到相同的結果：</block>
  <block id="6030a1d9761fca3806ef0a0329438071" category="list-text">資料檔案的快照、加上一種識別快照建立時間的方法</block>
  <block id="4e822d4c19600b654f176d335c158829" category="list-text">從最新資料檔案檢查點的時間到快照的確切時間、都會歸檔記錄檔</block>
  <block id="604432b50055c69f34df17a8ed5befb5" category="paragraph">在還原期間、資料庫會從資料檔案讀取中繼資料、以識別所需的最早歸檔記錄。可以執行完整或時間點恢復。執行時間點還原時、必須知道資料檔案快照的時間。指定的恢復點必須在快照建立時間之後。NetApp 建議您在快照時間中加入至少幾分鐘、以因應時鐘變化。</block>
  <block id="08bfe39c49a2dc07b08bd2ccd77d8281" category="paragraph">如需完整的詳細資料、請參閱 Oracle 各版本的 Oracle 12c 說明文件中有關「使用儲存 Snapshot 最佳化進行恢復」主題的 Oracle 文件。此外、請參閱 Oracle 文件 ID 文件 ID 604683.1 、瞭解 Oracle 協力廠商快照支援。</block>
  <block id="d22a890163762fcf7a4cb7605c29b7e6" category="section-title">資料配置</block>
  <block id="6a7fc1f74262f6973420f4fc849ba7f7" category="paragraph">最簡單的配置是將資料檔案隔離為一個或多個專用磁碟區。它們必須不受任何其他檔案類型的污染。這是為了確保資料檔案磁碟區可以透過 SnapRestore 作業快速還原、而不會破壞重要的重做記錄檔、控制檔或歸檔記錄檔。</block>
  <block id="ff6fb5d2136ab516e182f4b23f45886d" category="paragraph">SAN 對專用磁碟區內的資料檔案隔離有類似的需求。在 Microsoft Windows 等作業系統中、單一磁碟區可能包含多個資料檔案 LUN 、每個 LUN 都有 NTFS 檔案系統。在其他作業系統中、通常也會有邏輯 Volume Manager 。例如、使用 Oracle ASM 時、最簡單的選項是將磁碟群組限制在單一磁碟區、以便作為一個單元進行備份和還原。如果基於效能或容量管理的理由而需要額外的磁碟區、則在新磁碟區上建立額外的磁碟群組、將可更輕鬆地進行管理。</block>
  <block id="a06956ba6de69aec2dc2b015074e5821" category="paragraph">如果遵循這些準則、則可直接在 ONTAP 上排程快照、而無需執行一致性群組快照。原因是快照最佳化備份不需要同時備份資料檔案。</block>
  <block id="9e422c12420f1bd8c73e3c0f63da55e9" category="paragraph">在 ASM 磁碟群組等情況下、會發生複雜的情況、而 ASM 磁碟群組會分散在不同的磁碟區中。在這種情況下、必須執行 CG 快照、以確保 ASM 中繼資料在所有組成磁碟區之間一致。</block>
  <block id="7a7969d6a47ed242c25f6a38f2da0e36" category="paragraph">[ 注意 ] 確認 ASM spfile 和 passwd 檔案不在主控資料檔案的磁碟群組中。這會影響選擇性還原資料檔案和僅還原資料檔案的能力。</block>
  <block id="12eb3ceede91a01c74368e0fab03dbe4" category="section-title">本機恢復程序— NFS</block>
  <block id="e1a03fcc478ae212f07b5044b11ff369" category="paragraph">此程序可以手動或透過 SnapCenter 等應用程式來驅動。基本程序如下：</block>
  <block id="abb0083d6ab87bbe9d906632fea121ae" category="list-text">在所需還原點之前、立即將資料檔案磁碟區復原至快照。</block>
  <block id="3450fe1e1eea00fa55cfb5cb835a3d80" category="paragraph">此程序假設所需的歸檔記錄檔仍存在於作用中的檔案系統中。如果沒有、則必須還原歸檔記錄、或<block ref="075b7d3bd3bbe7767f7ef62f430bc22b" prefix=" " category="inline-code"></block> 或<block ref="a84f4f3da79386c29ab6dfa560af786e" prefix=" " category="inline-code"></block> 可導向至中的資料<block ref="a15da8cecb1f1192c4d913b8ba676121" prefix=" " category="inline-code"></block> 目錄。</block>
  <block id="e43e33171833b26f6b024d28cb8b1afd" category="paragraph">此外、對於較小的資料庫、終端使用者可以直接從中復原資料檔案<block ref="a15da8cecb1f1192c4d913b8ba676121" prefix=" " category="inline-code"></block> 無需自動化工具或儲存管理員協助執行 SnapRestore 命令的目錄。</block>
  <block id="097230f6ad5345abbe261eabbf533a68" category="section-title">本機恢復程序— SAN</block>
  <block id="4e3110543ebf2a771c16b3b2101f1f88" category="list-text">將託管資料檔案的磁碟群組置於系統中。此程序會因所選的邏輯磁碟區管理程式而異。使用 ASM 時、此程序需要卸除磁碟群組。在 Linux 中、必須卸除檔案系統、並停用邏輯磁碟區和磁碟區群組。目標是停止要還原之目標 Volume 群組上的所有更新。</block>
  <block id="1d0ecd206531f96737f8e8002be4a047" category="list-text">在所需還原點之前、立即將資料檔案磁碟群組還原至快照。</block>
  <block id="946fe41f610ab658e270a1844c992bcc" category="list-text">重新啟動新還原的磁碟群組。</block>
  <block id="c21d8f41541fc2a0259e7ea5e51edac3" category="paragraph">此程序假設所需的歸檔記錄檔仍存在於作用中的檔案系統中。如果沒有、則必須將歸檔記錄 LUN 離線並執行還原、以還原歸檔記錄。這也是將歸檔記錄分割成專用磁碟區的範例。如果歸檔記錄與重做記錄共用磁碟區群組、則必須在還原整體 LUN 組之前、將重做記錄複製到其他位置、以免遺失最終記錄的交易。</block>
  <block id="3fd5b2a08b3d7c4db29da8590ef6013f" category="section-title">完整恢復範例</block>
  <block id="31679daa394b7091acfd728d940b7322" category="paragraph">假設資料檔案已毀損或毀損、且需要完整還原。執行程序如下：</block>
  <block id="aa09ca247daac25fc18c2633124ca9b6" category="section-title">時間點恢復範例</block>
  <block id="935ff627038d1f5001220c8df7f0e1b9" category="paragraph">整個恢復過程只需一個命令：<block ref="3df448f0a5ec82cac76d91ba14c0fa1d" prefix=" " category="inline-code"></block>。</block>
  <block id="dcd27cf8b8ceae2cd84c898d3c1b9fdb" category="paragraph">如果需要時間點恢復、則必須知道快照的時間戳記、並可識別如下：</block>
  <block id="17108ef3ad2e1e613b844beb5f2c6d29" category="paragraph">快照建立時間列於 3 月 9 日和 10 ： 10 ： 06 。為了安全起見、快照時間會增加一分鐘：</block>
  <block id="904b0a17b003c70e398ea85996f0f9ba" category="paragraph">恢復作業現在已啟動。它指定的快照時間為 10 ： 11 ： 00 、記錄時間後一分鐘、以計算可能的時鐘差異、目標恢復時間為 10 ： 44 。接下來、 sqlplus 會要求所需的歸檔記錄檔、以達到所需的 10 ： 44 恢復時間。</block>
  <block id="91f99c5ad04365fb4d00e509963e2a0c" category="admonition">使用來完成資料庫的快照還原<block ref="3df448f0a5ec82cac76d91ba14c0fa1d" prefix=" " category="inline-code"></block> 命令不需要特定授權、而是使用時間點還原<block ref="72104026d9850e8c478c23b2e2e4e8e9" prefix=" " category="inline-code"></block> 需要 Oracle 進階壓縮授權。</block>
  <block id="87161b635cff9308859c719a20929913" category="summary">Oracle 和 NetApp 備份工具</block>
  <block id="9173402b63dc5f55506a692258f185e8" category="doc">SnapCenter 和其他工具</block>
  <block id="400937771ac8b3d4e7be82bf39033db5" category="paragraph">應用程式環境中 ONTAP 的主要價值來自核心 ONTAP 技術、例如即時 Snapshot 複本、簡單的 SnapMirror 複寫、以及快速建立 FlexClone Volume 。</block>
  <block id="5459c1727c923baa303ff472498dbe97" category="paragraph">在某些情況下、直接在 ONTAP 上簡單設定這些核心功能即可滿足需求、但更複雜的需求則需要協調層。</block>
  <block id="aeeb3212c35c26d321183e81d4926e57" category="paragraph">SnapCenter 是 NetApp 資料保護的旗艦產品。在極低的層級上、它與 SnapManager 產品在執行資料庫備份的方式上類似、但它是從頭開始打造、提供單一窗口來管理 NetApp 儲存系統上的資料保護。</block>
  <block id="e538db970e1ed1ffe018725fdf223f9e" category="paragraph">SnapCenter 包括 Snapshot 複本型備份與還原、 SnapMirror 與 SnapVault 複寫等基本功能、以及大型企業大規模營運所需的其他功能。這些進階功能包括擴充的角色型存取控制（ RBAC ）功能、可與協力廠商協調化產品整合的 RESTful API 、資料庫主機上 SnapCenter 外掛程式的不中斷中央管理、以及專為雲端規模環境設計的使用者介面。</block>
  <block id="50780f47f6839d47d60bc4555ee00c3f" category="section-title">休息</block>
  <block id="a0bac638f30c704da8e03aba136da86d" category="paragraph">ONTAP 也包含豐富的 RESTful API 集。這可讓協力廠商建立資料保護及其他管理應用程式、並與 ONTAP 進行深度整合。此外、想要建立自己的自動化工作流程和公用程式的客戶也能輕鬆使用 RESTful API 。</block>
  <block id="e4cea644160fe9fa4ccd92ab3f079363" category="summary">Oracle 快照型備份與還原</block>
  <block id="9adc36f162691b8ed14a886b6068f368" category="doc">Oracle 線上備份</block>
  <block id="a3b43ae3d4028e3c7ccac3d5720e9fb0" category="paragraph">在備份模式中保護和恢復 Oracle 資料庫需要兩組資料。請注意、這不是唯一的 Oracle 備份選項、而是最常見的選項。</block>
  <block id="8e523970ff7c41dba74e723511d14717" category="list-text">備份模式中資料檔案的快照</block>
  <block id="deeddf207b1a29c63ae7c1943f90f3d9" category="list-text">資料檔案處於備份模式時所建立的歸檔記錄</block>
  <block id="fa1229103a2e02a4ed8790098c98f71f" category="paragraph">如果需要完整恢復（包括所有已提交的交易）、則需要第三個項目：</block>
  <block id="7c11b244c2549a2cc477c134ec4c5635" category="list-text">一組目前的重做記錄</block>
  <block id="8522faf14bc9d4ab497945bb48adc870" category="paragraph">有許多方法可以推動線上備份的還原。許多客戶使用 ONTAP CLI 還原快照、然後使用 Oracle RMAN 或 sqlplus 來完成還原。這在大型正式作業環境中尤其常見、因為資料庫還原的可能性和頻率極低、而且任何還原程序都是由熟練的 DBA 來處理。為了實現完整的自動化、 NetApp SnapCenter 等解決方案包含 Oracle 外掛程式、其中包含命令列和圖形介面。</block>
  <block id="f88f41d4801183a5d53a4b71f383d144" category="paragraph">有些大型客戶已在主機上設定基本指令碼、以便在特定時間將資料庫置於備份模式、以準備排程的快照、藉此採取更簡單的方法。例如、排程命令<block ref="56f72994c4cc84b13a4c20dab49fea35" prefix=" " category="inline-code"></block> 23 時 58 分、<block ref="84c8391d82cbfe300a9615844e0a167f" prefix=" " category="inline-code"></block> 於 00 ： 02 、然後於午夜直接在儲存系統上排程快照。如此一來、就能實現簡單易用、擴充性極高的備份策略、無需外部軟體或授權。</block>
  <block id="719fbeb74939b8c065321f175de3d222" category="paragraph">最簡單的配置是將資料檔案隔離到一個或多個專用磁碟區。它們必須不受任何其他檔案類型的污染。這是為了確保資料檔案磁碟區可以透過 SnapRestore 作業快速還原、而不會破壞重要的重做記錄檔、控制檔或歸檔記錄。</block>
  <block id="19156bdcbf322e8e3189909bbb7a69e8" category="paragraph">SAN 對專用磁碟區內的資料檔案隔離有類似的需求。在 Microsoft Windows 等作業系統中、單一磁碟區可能包含多個資料檔案 LUN 、每個 LUN 都有 NTFS 檔案系統。在其他作業系統中、通常會有邏輯 Volume Manager 。例如、使用 Oracle ASM 時、最簡單的選項是將 ASM 磁碟群組的 LUN 限制在單一磁碟區、以便作為一個單元進行備份和還原。如果基於效能或容量管理的理由而需要額外的磁碟區、則在新磁碟區上建立額外的磁碟群組、將可簡化管理。</block>
  <block id="993afa8643b7200c5c9e527c24c1d8b2" category="paragraph">如果遵循這些準則、則可直接在儲存系統上排程快照、而無需執行一致性群組快照。原因是 Oracle 備份不需要同時備份資料檔案。線上備份程序旨在讓資料檔案在數小時內緩慢串流至磁帶、因此能夠繼續更新。</block>
  <block id="a2ea5ea024e4a68e4d7f4abeca3441a1" category="paragraph">在使用分佈於不同磁碟區的 ASM 磁碟群組等情況下、會產生複雜性。在這種情況下、必須執行 CG 快照、以確保 ASM 中繼資料在所有組成磁碟區之間一致。</block>
  <block id="0a3ecb97c1b7c97e5075bae0daaa45aa" category="paragraph">* 注意： * 驗證 ASM<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block> 和<block ref="76a2173be6393254e72ffa4d6df1030a" prefix=" " category="inline-code"></block> 檔案不在主控資料檔案的磁碟群組中。這會影響選擇性還原資料檔案和僅還原資料檔案的能力。</block>
  <block id="2f8a5e254c86a42ebcc8b7d3c84cd22e" category="paragraph">此程序假設所需的歸檔記錄檔仍存在於作用中的檔案系統中。如果沒有、則必須還原歸檔記錄、或將 RMAN/sqlplus 導向快照目錄中的資料。</block>
  <block id="a67a69f712a877950e94edd27310b40e" category="paragraph">此外、對於較小的資料庫、終端使用者可以直接從中復原資料檔案<block ref="a15da8cecb1f1192c4d913b8ba676121" prefix=" " category="inline-code"></block> 目錄、無需自動化工具或儲存管理員協助執行<block ref="a4c0ce4da6fb04943b499690fb3afd6e" prefix=" " category="inline-code"></block> 命令。</block>
  <block id="6da8ebf3245e4fbe4654e7f92f0330d7" category="list-text">將託管資料檔案的磁碟群組置於系統中。此程序會因所選的邏輯磁碟區管理程式而異。使用 ASM 時、此程序需要卸除磁碟群組。在 Linux 中、必須卸除檔案系統、且必須停用邏輯磁碟區和磁碟區群組。目標是停止要還原之目標 Volume 群組上的所有更新。</block>
  <block id="931ab211ac6773d20c03a998f9f921ce" category="list-text">如果需要完整還原、請重新播放所有重做記錄。</block>
  <block id="b6575c3fca5eaaa56eeb8e9ce8867f05" category="paragraph">此程序假設所需的歸檔記錄檔仍存在於作用中的檔案系統中。如果沒有、則必須將歸檔記錄 LUN 離線並執行還原、以還原歸檔記錄。這也是將歸檔記錄分割成專用磁碟區的範例。如果歸檔記錄與重做記錄共用一個磁碟區群組、則必須先將重做記錄複製到其他位置、才能還原整個 LUN 集。此步驟可防止這些最終記錄的交易遺失。</block>
  <block id="1536f0d3e3ee227abdec76f432b89cae" category="summary">Oracle 資料保護 SLA</block>
  <block id="e9c8b7044dfae7a21f1a9c4d08628a66" category="doc">恢復時間目標、恢復點目標和服務層級協議</block>
  <block id="020e620c60ad38b75f0ff2a2fe4067b0" category="paragraph">資料保護策略應根據業務需求來定義。</block>
  <block id="65fd6f7f97414140b4d6060b743dc645" category="paragraph">這些需求包括恢復速度、最大允許資料遺失量、以及備份保留需求等因素。資料保護計畫也必須考量資料保留與還原的各種法規要求。最後、必須考量不同的資料恢復情境、從使用者或應用程式錯誤所造成的典型和可預見的恢復、到包括站點完全遺失的災難恢復情境。</block>
  <block id="2bd1d35ff88de136066c33905c0fd677" category="paragraph">資料保護與還原原則的細微變更、可能會對儲存、備份與還原的整體架構造成重大影響。在開始設計工作之前、務必先定義並記錄標準、以免資料保護架構複雜化。不必要的功能或保護層級會導致不必要的成本和管理成本、而最初忽略的需求可能導致專案方向錯誤、或是需要最後一分鐘的設計變更。</block>
  <block id="a60e6b87ede45aef49d8d095435db22b" category="section-title">恢復時間目標</block>
  <block id="3d3b341e14c584d1edcea9fe13619ee1" category="paragraph">恢復時間目標（ RTO ）定義了恢復服務所允許的最長時間。例如、人力資源資料庫的 RTO 可能為 24 小時、因為雖然在工作天內無法存取這些資料、但企業仍可繼續營運。相反地、支援銀行總分類帳的資料庫、其 RTO 會以分鐘甚至秒為單位來衡量。RTO 為零是不可能的、因為必須有辦法區分實際服務中斷和例行事件、例如遺失的網路封包。然而、典型的要求是接近零的 RTO 。</block>
  <block id="5a27873285a0397cc06f9f47280c9426" category="section-title">恢復點目標</block>
  <block id="f3ae061e139f47d793058ee596a5243f" category="paragraph">恢復點目標（ RPO ）定義了最大可容忍的資料遺失量。在許多情況下、 RPO 完全取決於快照或 SnapMirror 更新的頻率。</block>
  <block id="2d68fbd3cefeb34bfd64c8f89caba64d" category="paragraph">在某些情況下、 RPO 可能會變得更具侵略性、因此可選擇性地更頻繁地保護某些資料。在資料庫內容中、 RPO 通常是在特定情況下可能遺失多少記錄資料的問題。在資料庫因產品錯誤或使用者錯誤而受損的典型還原案例中、 RPO 應為零、表示不應有資料遺失。恢復程序包括還原較早的資料庫檔案複本、然後重新播放記錄檔、將資料庫狀態提升至所需的時間點。此作業所需的記錄檔應已在原始位置中。</block>
  <block id="57df8b025934bcd0f7e96bae19cf0688" category="paragraph">在不尋常的情況下、記錄資料可能會遺失。例如、意外或惡意<block ref="4609acba202877f99742342f4195d95e" prefix=" " category="inline-code"></block> 資料庫檔案可能會導致刪除所有資料。唯一的選擇是從備份還原、包括記錄檔、有些資料必然會遺失。在傳統備份環境中改善 RPO 的唯一選項是執行記錄資料的重複備份。然而、由於資料持續移動、而且難以將備份系統維持為持續運作的服務、因此這項功能也有其侷限性。進階儲存系統的優點之一、就是能夠保護資料、避免意外或惡意損壞檔案、進而在不移動資料的情況下提供更好的 RPO 。</block>
  <block id="3d08c71e26ac92e34925e02570c4bd22" category="paragraph">災難恢復包括在發生實體災難時恢復服務所需的 IT 架構、原則和程序。這可能包括洪水、火災或惡意或疏忽意圖的人。</block>
  <block id="78f4e749ec0c6bb2627abbbc00bce296" category="paragraph">災難恢復不只是一套恢復程序。這是識別各種風險、定義資料恢復和服務持續性需求、以及提供適當架構及相關程序的完整程序。</block>
  <block id="75bcd60b234aba82b5827cd7a5171563" category="paragraph">在建立資料保護需求時、必須區分典型的 RPO 和 RTO 需求、以及災難恢復所需的 RPO 和 RTO 需求。有些應用程式環境需要零 RPO 和近乎零的 RTO 、才能因應資料遺失的情況、從相對正常的使用者錯誤到破壞資料中心的火災。然而、這些高層級的保護措施會產生成本和管理上的後果。</block>
  <block id="756651fea87d05811d7a42451d074b60" category="paragraph">一般而言、非災難性資料恢復需求應嚴格、原因有兩個。首先、應用程式錯誤和使用者錯誤會導致資料受損、幾乎是不可避免的。其次、只要儲存系統未遭銷毀、就不難設計出可提供零 RPO 和低 RTO 的備份策略。沒有理由不解決容易補救的重大風險、這就是為何用於本機恢復的 RPO 和 RTO 目標應該積極主動的原因。</block>
  <block id="cb6faee28dd34d25f06bd0b33abe1c2f" category="paragraph">災難恢復 RTO 和 RPO 需求因災難可能性及相關資料遺失或業務中斷所造成的後果而異。RPO 和 RTO 需求應以實際業務需求為基礎、而非一般原則。他們必須考慮多種邏輯和實體災難案例。</block>
  <block id="68f31611fc8a5e6a20793905280a7001" category="section-title">邏輯災難</block>
  <block id="07f5727077caaf8dedf895542181d26b" category="paragraph">邏輯災難包括使用者、應用程式或作業系統錯誤所造成的資料毀損、以及軟體故障。邏輯災難也可能包括由外部人士利用病毒或蠕蟲或利用應用程式弱點發動的惡意攻擊。在這些情況下、實體基礎架構並未受損、但基礎資料已不再有效。</block>
  <block id="3cb5ee5f24e42f56ba6dac48b7b046d2" category="paragraph">越來越常見的邏輯災難類型稱為勒索軟體、其中攻擊模式是用來加密資料。加密不會損壞資料、但會在付款給第三方之前無法使用。越來越多的企業被勒索軟體攻擊的目標鎖定。針對此威脅、 NetApp 提供防竄改快照、即使儲存管理員也無法在設定的到期日之前變更受保護的資料。</block>
  <block id="91c87f53ce0a1f416308a67ce119c623" category="section-title">實體災難</block>
  <block id="79055ca11f54a97d22617a656eab8b9b" category="paragraph">實體災難包括基礎架構元件故障、其超過備援功能、導致資料遺失或服務延長中斷。例如、 RAID 保護可提供磁碟機備援、而使用 HBA 則可提供 FC 連接埠和 FC 纜線備援。這類元件的硬體故障是可預見的、不會影響可用度。</block>
  <block id="3f7c55fe5f35f94cd2c4bd73b9cbb11b" category="paragraph">在企業環境中、通常可以使用備援元件來保護整個站台的基礎架構、直到唯一可預見的實體災難案例完全遺失站台為止。災難恢復規劃則取決於站台對站台的複寫。</block>
  <block id="7f3dd7bdd41f7af6853732a383bbd7e2" category="section-title">同步與非同步資料保護</block>
  <block id="c5ac17d5693914368f39b40a07af23d4" category="paragraph">在理想的環境中、所有資料都會在地理上分散的站台之間同步複寫。這類複寫不一定可行、甚至可能、原因有幾個：</block>
  <block id="28c59a675d03e1f62a48958bb53ae523" category="list-text">同步複寫不可避免地會增加寫入延遲、因為所有變更都必須複寫到兩個位置、應用程式 / 資料庫才能繼續處理。因此產生的效能影響有時是不可接受的、無法使用同步鏡射。</block>
  <block id="50a05ceeb998c4dac7e8b5d706fe2029" category="list-text">100% SSD 儲存設備的採用率增加、意味著更有可能注意到額外的寫入延遲、因為效能期望包括數十萬 IOPS 和低於毫秒的延遲。若要充分發揮 100% SSD 的效益、可能需要重新規劃災難恢復策略。</block>
  <block id="04d90fe6288ce6cceba54a2b71e55727" category="list-text">資料集會繼續以位元組為單位增加、因此必須確保足夠的頻寬來維持同步複寫、因此會產生挑戰。</block>
  <block id="d3aaae220bd5b3d68dd4ccec3bf78197" category="list-text">資料集的複雜度也隨之增加、管理大規模同步複寫也會帶來挑戰。</block>
  <block id="c3a841e0bfc640f91b0a00c4af8c6f5c" category="list-text">雲端型策略通常需要較長的複寫距離和延遲、進一步排除同步鏡射的使用。</block>
  <block id="7df1515e247dfa2063c433b9339c2d4a" category="paragraph">NetApp 提供的解決方案包括同步複寫、可滿足最嚴苛的資料恢復需求、並可提供更優異的效能與靈活度的非同步解決方案。此外、 NetApp 技術也能與許多第三方複寫解決方案無縫整合、例如 Oracle DataGuard</block>
  <block id="4d2c802af835583121763e1a6acc3f9b" category="section-title">保留時間</block>
  <block id="123dbb4c09a5c8fb993a856cf65c9d25" category="paragraph">資料保護策略的最後一個層面是資料保留時間、這可能會大幅改變。</block>
  <block id="d3a424909a8559a2d076e5d9a28d834f" category="list-text">一般要求是在主要站台上進行 14 天夜間備份、以及儲存在次要站台上的 90 天備份。</block>
  <block id="1d7c2d97c3bfd5ca9489e0ffeb06b150" category="list-text">許多客戶會建立獨立的季度歸檔、儲存在不同的媒體上。</block>
  <block id="61ae175e4a0c88c4624184a0cb9b04d2" category="list-text">持續更新的資料庫可能不需要歷史資料、而備份只需保留幾天。</block>
  <block id="8bb85c2149e1e808032e7025b0a27b80" category="list-text">法規要求可能需要在 365 天內恢復任何任意交易的點。</block>
  <block id="a83f7a3ea63946cbdc1977d641e8460c" category="summary">ONTAP 上的 Oracle 和快照的角色</block>
  <block id="05280349760feacdd6227fb8012e39d7" category="doc">快照型備份</block>
  <block id="5e3f0537b2a1927f4a24b28e9157cc0b" category="paragraph">ONTAP 上的 Oracle 資料保護基礎是 NetApp Snapshot 技術。</block>
  <block id="a4c2aeedbfeeda21f232cbf45be91693" category="paragraph">關鍵值如下：</block>
  <block id="d06c89cff665ecdde6eded3c9d44cd2b" category="list-text">* 簡易性。 * 快照是特定時間點資料容器內容的唯讀複本。</block>
  <block id="175888ba89c31a851f719bdd271cae9c" category="list-text">* 效率。 * 快照在建立時不需要任何空間。只有在資料變更時才會使用空間。</block>
  <block id="d853e9e275a6e58b3a9a56fa641cbb9f" category="list-text">* 管理能力。 * 由於快照是儲存作業系統的原生部分、因此以快照為基礎的備份策略很容易設定和管理。如果儲存系統已開機、就可以開始建立備份。</block>
  <block id="b564e5fbab71af776ed54a19d09b268c" category="list-text">* 擴充性。 * 最多可保留 1024 個檔案和 LUN 的單一容器備份。對於複雜的資料集、可透過一組一致的快照來保護多個資料容器。</block>
  <block id="7159872a568b97a971b9ea182fb23b7c" category="list-text">無論磁碟區包含 1024 個快照或無、效能都不會受到影響。</block>
  <block id="1a54f7e14e6e652bb32b12df22faf387" category="paragraph">雖然許多儲存廠商都提供快照技術、但 ONTAP 中的 Snapshot 技術是獨一無二的、可為企業應用程式和資料庫環境帶來顯著效益：</block>
  <block id="d77b23e355dc2f65b90fb52ed9a90f9c" category="list-text">Snapshot 複本是基礎 Write -Anywhere File Layout （ WAFL ）的一部分。它們不是附加技術或外部技術。這簡化了管理、因為儲存系統是備份系統。</block>
  <block id="8b888e6a2d883c0111428c101532294a" category="list-text">快照複本不會影響效能、但某些邊緣情況除外、例如當基礎儲存系統填滿的快照中儲存了大量資料時。</block>
  <block id="2283ea50a243a5d1ad551f7d21f39895" category="list-text">「一致性群組」一詞通常是指一組儲存物件、這些物件是以一致的資料集合來管理。特定 ONTAP 磁碟區的快照構成一致性群組備份。</block>
  <block id="ac72c83a8204d600d567261b41c5488c" category="paragraph">ONTAP 快照的擴充能力也優於競爭技術。客戶可以儲存 5 、 50 或 500 個快照、而不會影響效能。磁碟區目前允許的最大快照數為 1024 。如果需要額外的快照保留、則有選項可將快照串聯至其他磁碟區。</block>
  <block id="3b7ff39ba50f1bc3f56d38c41ba51855" category="paragraph">因此、保護託管在 ONTAP 上的資料集非常簡單且具有高度擴充性。備份不需要移動資料、因此備份策略可以根據業務需求量身打造、而非限制網路傳輸率、大量磁帶機或磁碟接移區域。</block>
  <block id="55c5bbb3aad88266600eaa1a526406d4" category="paragraph">將快照當作資料保護策略使用的常見問題之一、就是「真實」資料和快照資料位於同一個磁碟機上。遺失這些磁碟機將會導致主要資料和備份遺失。</block>
  <block id="68870deb35eeb53373325a314030bd11" category="paragraph">然而、本機快照不應是唯一的備份策略、因此 NetApp 提供 SnapMirror 和 SnapVault 複寫等技術、可快速有效地將快照複寫至一組不同的磁碟機。在架構正確的解決方案中、快照加上快照複寫功能可將磁帶的使用降至最低、甚至是每季歸檔、或完全消除。</block>
  <block id="73d3fd255835ca3dc926f59d50223f91" category="paragraph">使用 ONTAP Snapshot 複本保護資料有許多選項、快照是許多其他 ONTAP 功能的基礎、包括複寫、災難恢復和複製。快照技術的完整說明不在本文件的範圍內、但以下各節提供一般概觀。</block>
  <block id="7441577327d1d49b71cc2f6403e17e7b" category="paragraph">建立資料集快照的主要方法有兩種：</block>
  <block id="b38ba43128207852ef5149e6c578ba89" category="list-text">損毀一致的備份</block>
  <block id="dc64a2f6075820724476e435a1ebd7fa" category="list-text">應用程式一致的備份</block>
  <block id="7733cc553d118547b64c858cb4281f24" category="paragraph">資料集的損毀一致備份是指在單一時間點擷取整個資料集結構。如果資料集儲存在單一 NetApp FlexVol Volume 中、則程序很簡單；您可以隨時建立 Snapshot 。如果資料集橫跨多個磁碟區、則必須建立一致性群組（ CG ）快照。建立 CG 快照有多種選項、包括 NetApp SnapCenter 軟體、原生 ONTAP 一致性群組功能、以及使用者維護的指令碼。</block>
  <block id="32561979f55bc68c4f028fd26a9975f6" category="paragraph">當備份點還原足夠時、主要會使用損毀一致的備份。當需要更精細的恢復時、通常需要應用程式一致的備份。</block>
  <block id="367735591e5e6e04c17b7930acb29b7d" category="paragraph">「應用程式一致性」一詞通常是錯誤的。例如、將 Oracle 資料庫置於備份模式稱為應用程式一致的備份、但資料並未以任何方式保持一致或停止。資料會在整個備份過程中持續變更。相反地、大部分的 MySQL 和 Microsoft SQL Server 備份確實會在執行備份之前先將資料關閉。VMware 可能會或可能不會使某些檔案一致。</block>
  <block id="ebf90723e7659cb5381545104b618612" category="paragraph">術語「一致性群組」是指儲存陣列將多個儲存資源視為單一映像來管理的能力。例如、資料庫可能包含 10 個 LUN 。陣列必須能夠以一致的方式備份、還原及複寫這 10 個 LUN 。如果 LUN 的映像在備份時不一致、則無法還原。複寫這 10 個 LUN 需要所有複本彼此完全同步。</block>
  <block id="3f8a43f1defaa984435092f616876545" category="paragraph">討論 ONTAP 時、「一致性群組」一詞並不常使用、因為一致性一向是 ONTAP 內 Volume 和 Aggregate 架構的基本功能。許多其他儲存陣列會將 LUN 或檔案系統視為個別單元進行管理。接著可選擇性地將它們設定為「一致性群組」、以保護資料、但這是組態中的額外步驟。</block>
  <block id="74e816c3c784f5c30c79dca4590d7f59" category="paragraph">ONTAP 一向能夠擷取一致的本機和複寫資料映像。雖然 ONTAP 系統上的各種磁碟區通常並未正式描述為一致性群組、但這就是它們的名稱。該磁碟區的快照是一致性群組映像、該快照的還原是一致性群組還原、 SnapMirror 和 SnapVault 都提供一致性群組複寫。</block>
  <block id="15cc4389a08c3f4748e98622e630ad3e" category="section-title">一致性群組快照</block>
  <block id="d286b747757ef3d8d3abac27bfae65f9" category="paragraph">一致性群組快照（ CG 快照）是基本 ONTAP Snapshot 技術的延伸。標準快照作業可在單一磁碟區內建立所有資料的一致映像、但有時必須在多個磁碟區甚至跨多個儲存系統建立一致的快照集。結果是一組快照、其使用方式與只有一個個別磁碟區的快照相同。它們可用於本機資料還原、複寫以進行災難恢復、或複製為單一一致的單元。</block>
  <block id="7c199465bc6344e648e2f73c88131605" category="paragraph">CG 快照的最大已知用途是資料庫環境、其大小約為 1PB 、跨越 12 個控制器。在此系統上建立的 CG 快照已用於備份、恢復和複製。</block>
  <block id="e5c199b4a97409f33d5caae984957744" category="paragraph">大多數情況下、當資料集跨越磁碟區且必須保留寫入順序時、所選管理軟體會自動使用 CG 快照。在此情況下、無需瞭解 CG 快照的技術詳細資料。然而、在某些情況下、複雜的資料保護需求需要對資料保護和複寫程序進行詳細控制。自動化工作流程或使用自訂指令碼來呼叫 CG 快照 API 是其中的一些選項。若要瞭解最佳選項和 CG-snapshot 的角色、需要更詳細的技術說明。</block>
  <block id="cf3c30ea5c240a8aef02d240f42cdff7" category="paragraph">建立一組 CG 快照是兩個步驟：</block>
  <block id="f30455406a91bd776afbc88e60b9697e" category="list-text">在所有目標磁碟區上建立寫入屏障。</block>
  <block id="c7afe45d94f2fd172a01e851d7f92a2f" category="list-text">在圍籬狀態下建立這些磁碟區的快照。</block>
  <block id="c464d4671e489eaad9a8cbf0a8086ea9" category="paragraph">寫入隔離是連續建立的。這表示當隔離程序在多個磁碟區之間設定時、寫入 I/O 會依序凍結在第一個磁碟區上、因為它會繼續提交到稍後出現的磁碟區。這可能一開始就違反了保留寫入順序的要求、但這僅適用於非同步在主機上發出的 I/O 、不需仰賴任何其他寫入。</block>
  <block id="688656b1f8644ee299edf7be87a8fc75" category="paragraph">例如、資料庫可能會發出許多非同步資料檔案更新、並允許作業系統重新排序 I/O 、並根據其本身的排程器組態完成這些更新。這類 I/O 的順序無法保證、因為應用程式和作業系統已釋出保留寫入順序的要求。</block>
  <block id="599ce07d1bae0fa6169959e2bdb97ada" category="paragraph">以計數器為例、大部分的資料庫記錄活動都是同步的。在確認 I/O 之前、資料庫不會繼續進行記錄寫入、而且必須保留這些寫入的順序。如果記錄 I/O 到達圍籬式磁碟區、則不會予以確認、應用程式會在進一步寫入時加以封鎖。同樣地、檔案系統中繼資料 I/O 通常是同步的。例如、檔案刪除作業不得遺失。如果具有 xfs 檔案系統的作業系統刪除了檔案、而更新 xfs 檔案系統中繼資料的 I/O 則會移除位於圍籬磁碟區上的該檔案參照、則檔案系統活動就會暫停。這可確保 CG 快照作業期間檔案系統的完整性。</block>
  <block id="0f0c0f05310f9cf257d65bfd936f15c5" category="paragraph">在目標磁碟區之間設定寫入屏障之後、就可以開始建立快照。由於磁碟區的狀態會從相關寫入點凍結、因此不需要同時精確建立快照。為了防範建立 CG 快照的應用程式中的瑕疵、初始寫入屏障包含可設定的逾時時間、 ONTAP 會在定義的秒數後自動釋放隔離功能並繼續寫入處理。如果所有快照都是在逾時期間發生之前建立的、則產生的一組快照是有效的一致性群組。</block>
  <block id="df4925d1c6c3f3258e80ff35ce62b17d" category="section-title">相關寫入順序</block>
  <block id="6c78ee478b93fbb573157b85fb1114db" category="paragraph">從技術觀點來看、一致性群組的關鍵在於保留寫入順序、特別是根據寫入順序。例如、寫入 10 個 LUN 的資料庫會同時寫入所有 LUN 。許多寫入都是以非同步方式發出、這表示完成的順序不重要、實際完成的順序會因作業系統和網路行為而異。</block>
  <block id="69d87c00869001f3f06ad4a1494eac21" category="paragraph">某些寫入作業必須存在於磁碟上、資料庫才能繼續進行其他寫入作業。這些關鍵寫入作業稱為「相關寫入」。後續寫入 I/O 則取決於磁碟上是否有這些寫入資料。這 10 個 LUN 的任何快照、恢復或複寫都必須確保相關寫入順序受到保證。檔案系統更新是寫入順序相關寫入的另一個範例。必須保留檔案系統變更的順序、否則整個檔案系統可能會毀損。</block>
  <block id="74fbae5d0b3c16e1774c5f4dce2c1c36" category="section-title">策略</block>
  <block id="53e858edb9bd9ff3f9ead52cebf5731d" category="paragraph">以快照為基礎的備份主要有兩種方法：</block>
  <block id="f87f61f625a005bd32c53f808d235eea" category="list-text">快照保護的熱備份</block>
  <block id="c81725eb350a685210d69762bd5d725d" category="paragraph">資料庫的損毀一致備份是指在單一時間點擷取整個資料庫結構、包括資料檔案、重做記錄和控制檔。如果資料庫儲存在單一 NetApp FlexVol Volume 中、則程序很簡單；您可以隨時建立 Snapshot 。如果資料庫橫跨磁碟區、則必須建立一致性群組（ CG ）快照。建立 CG 快照有多種選項、包括 NetApp SnapCenter 軟體、原生 ONTAP 一致性群組功能、以及使用者維護的指令碼。</block>
  <block id="c32eba270db95747b471fd53e203a47b" category="paragraph">當備份點還原足夠時、主要會使用損毀一致的 Snapshot 備份。在某些情況下可以套用歸檔記錄檔、但如果需要更精細的時間點還原、則最好使用線上備份。</block>
  <block id="82cc23cd5dc667cc9fb78ff6e76ac15b" category="paragraph">快照型線上備份的基本程序如下：</block>
  <block id="dbaf4855045e45fbcf678fa4cd1ab2db" category="list-text">將資料庫放入<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> 模式。</block>
  <block id="c3e07fb8aef84ef3d94e3f9d5376c091" category="list-text">建立所有託管資料檔案的磁碟區快照。</block>
  <block id="2d0e58ff1a25bd9fd8a85ad8ce6f2665" category="list-text">結束<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> 模式。</block>
  <block id="4196c5674aaa9e4317b2b4c54f94a905" category="list-text">執行命令<block ref="9d2840394bc37850da4e360dbf60c0dc" prefix=" " category="inline-code"></block> 強制記錄歸檔。</block>
  <block id="f2736e795871e2fc2d36addb9436f337" category="list-text">為所有託管歸檔記錄的磁碟區建立快照。</block>
  <block id="f24880a3fe8b242fdd1aba5a2d11196f" category="paragraph">此程序會產生一組快照、其中包含備份模式中的資料檔案、以及在備份模式中產生的重要歸檔記錄。這是恢復資料庫的兩項需求。控制檔等檔案也應受到保護、以方便使用、但唯一的絕對需求是保護資料檔案和歸檔記錄。</block>
  <block id="0c32649da44277db19fcfa3fe4dac28f" category="paragraph">雖然不同的客戶可能有非常不同的策略、但幾乎所有這些策略最終都是以下列相同原則為基礎。</block>
  <block id="88f451afed04f47352987f617f805826" category="section-title">快照型還原</block>
  <block id="c092a9763068c8382be82f9c77bb9658" category="paragraph">在設計 Oracle 資料庫的 Volume 配置時、第一個決定是是否使用 Volume NetApp SnapRestore （ VBSR ）技術。</block>
  <block id="15a0b8dc4d1b340d403bf6515f7e61b8" category="paragraph">Volume 型 SnapRestore 可讓磁碟區立即還原至較早的時間點。由於磁碟區上的所有資料都已還原、因此 VBSR 可能不適用於所有使用案例。例如、如果整個資料庫（包括資料檔案、重做記錄和歸檔記錄）儲存在單一磁碟區上、且此磁碟區使用 VBSR 還原、則資料會遺失、因為較新的歸檔記錄和重做資料會被捨棄。</block>
  <block id="e63c0ca12b07a654ccadd92527a95c47" category="paragraph">還原不需要 VSR 。許多資料庫都可以使用檔案型單一檔案 SnapRestore （ SFSR ）來還原、或只是將檔案從快照複製回作用中的檔案系統。</block>
  <block id="2093e578085fede0f022c4efdb79c336" category="paragraph">當資料庫非常大或必須盡快恢復時、最好使用 VBSR 、而使用 VSR 需要隔離資料檔案。在 NFS 環境中、指定資料庫的資料檔案必須儲存在專用的磁碟區中、而這些磁碟區不會受到任何其他類型的檔案污染。在 SAN 環境中、資料檔案必須儲存在專用 FlexVol 磁碟區上的專用 LUN 中。如果使用 Volume Manager （包括 Oracle 自動儲存管理 [AS] ）、則磁碟群組也必須專用於資料檔案。</block>
  <block id="b38bd603a952c93872eae2ea858cb15f" category="paragraph">以這種方式隔離資料檔案、可讓檔案還原至較早的狀態、而不會損壞其他檔案系統。</block>
  <block id="5755a6275c3ecd99e8159efc58a8ff6c" category="section-title">Snapshot保留</block>
  <block id="957abb72f2db3a20e0b570a5fa3a1dcc" category="paragraph">對於 SAN 環境中具有 Oracle 資料的每個 Volume<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 應設為零、因為在 LUN 環境中保留快照空間並不實用。如果百分比保留設為 100 、則具有 LUN 的磁碟區快照需要在磁碟區中有足夠的可用空間、但不包括快照保留空間、以吸收所有資料 100% 的營業額。如果將百分比保留設為較低的值、則需要相對較小的可用空間、但它一律會排除快照保留。這表示 LUN 環境中的快照保留空間會被浪費。</block>
  <block id="d5a06adf11e69f265f3ee3277212764e" category="paragraph">在 NFS 環境中、有兩個選項：</block>
  <block id="7631336a8e2e03f6ac500c145445b2d7" category="list-text">設定<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 根據預期的快照空間使用量。</block>
  <block id="acc4c5d06fc4a9ac93880c9c2d0a6e76" category="list-text">設定<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 以歸零並統整管理作用中和快照空間使用量。</block>
  <block id="44806986c5abfcd6261803f4f75a7b56" category="paragraph">使用第一個選項、<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 設為非零值、通常約 20% 。然後、使用者就會隱藏此空間。不過、此值並不會限制使用率。如果具有 20% 保留的資料庫擁有 30% 的營業額、則快照空間可能會超出 20% 保留空間的範圍、並佔用無保留空間。</block>
  <block id="c8910acb0bfa30f82b423ff09a9710ca" category="paragraph">將保留設定為 20% 等值的主要優點是驗證某些空間永遠可供快照使用。例如、保留 20% 的 1TB 磁碟區只允許資料庫管理員（ DBA ）儲存 800GB 的資料。此組態保證至少有 200GB 的空間可供快照使用。</block>
  <block id="be233226a8cb890c0a8bbf041c06ac6b" category="paragraph">何時<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 設為零、則使用者可以使用磁碟區中的所有空間、以提供更好的可見度。DBA 必須瞭解、如果他 / 她看到 1TB 的磁碟區運用快照、則這 1TB 的空間會在使用中資料和 Snapshot 週轉之間共享。</block>
  <block id="b10efee713968b90d211d08ec8345d20" category="paragraph">終端使用者之間的選項 1 和選項 2 之間沒有明確的偏好設定。</block>
  <block id="8112d08173571f2d01372cadea3ea76d" category="section-title">ONTAP 和第三方快照</block>
  <block id="0cc082f7cc7618a904f6cde556295cbd" category="paragraph">Oracle Doc ID 604683.1 說明第三方快照支援的需求、以及備份與還原作業的多種選項。</block>
  <block id="130a02f8381e6c54b2ea07d2bdaf6f0b" category="paragraph">第三方廠商必須保證公司的快照符合下列要求：</block>
  <block id="97eb59a0f249226523b31dd52d557e00" category="list-text">快照必須與 Oracle 建議的還原與還原作業整合。</block>
  <block id="083e9332dc2b6bf064139ac2e670eee9" category="list-text">快照必須在快照點保持一致的資料庫損毀。</block>
  <block id="9dae8634b638a6949dab0f7eaf7988bd" category="list-text">快照中的每個檔案都會保留寫入順序。</block>
  <block id="7bc868657652757ca8505ddcd297456f" category="paragraph">ONTAP 和 NetApp Oracle 管理產品符合這些要求。</block>
  <block id="9e19caeb431a5e29a1a63e3cee4b36c9" category="doc">使用 ONTAP 保護 Oracle 資料</block>
  <block id="6f1383567177df0041e76e845c3629f2" category="paragraph">最重要的關鍵任務資料可在資料庫中找到。</block>
  <block id="848aab87f65bfade12f80d4e864ec046" category="paragraph">企業無法在沒有資料存取權的情況下運作、有時資料會定義業務。此資料必須受到保護；然而、資料保護不只是確保可用的備份、還要快速可靠地執行備份、而且還要安全地儲存。</block>
  <block id="28a0304f97f876b27cf541f4ad9a30d7" category="paragraph">資料保護的另一面是資料恢復。當資料無法存取時、企業就會受到影響、而且可能無法運作、直到資料還原為止。此程序必須快速且可靠。最後、大多數資料庫都必須防範災難、這表示必須維護資料庫的複本。複本必須是最新的。複本也必須快速且簡單、才能使其成為完全運作的資料庫。</block>
  <block id="3d601b26d05eac41fc6a7eba92fdc8b9" category="admonition">本文件取代先前發佈的技術報告 _TR-4591 ： Oracle 資料保護：備份、還原及複寫。 _</block>
  <block id="21d28aa03f67eb242b1c95a6a0594ff5" category="section-title">規劃</block>
  <block id="0bf5784d6c307e4ee0371d46053937c0" category="summary">Oracle 效能測試</block>
  <block id="355ba59494fea8b20be391a73cc755eb" category="paragraph">準確測試資料庫儲存效能是極為複雜的主題。需要瞭解下列問題：</block>
  <block id="b57041cc3b57577b5c21eff44739e3f9" category="list-text">IOPS 與處理量</block>
  <block id="236e7fd957ada95e8094e302623980d3" category="list-text">前景與背景 I/O 作業之間的差異</block>
  <block id="902f90cc4ab59808cac5606f767f61c4" category="list-text">延遲對資料庫的影響</block>
  <block id="196198dbaa1d1ea17cfc478fbb2f419f" category="list-text">許多作業系統和網路設定也會影響儲存效能</block>
  <block id="5ff18eadb2ef3fc20e13bed3e5b61d79" category="paragraph">此外、還有非儲存資料庫工作要考量。最佳化儲存效能並不會帶來實用效益、因為儲存效能不再是效能的限制因素。</block>
  <block id="32a993d3f497a6dd4392d3348b05ebc3" category="list-text">網路頻寬是效能限制的常見來源。例如、旋轉式磁碟解決方案通常是資料庫效能的瓶頸、因為 I/O 延遲非常高。當 All Flash 陣列移除延遲限制時、障礙會頻繁移轉至網路。在虛擬化環境和刀鋒系統中、這一點尤其顯著、因為這些環境和刀鋒系統的真正網路連線能力難以視覺化。如果由於頻寬限制而無法充分利用儲存系統本身、這可能會使效能測試變得複雜。</block>
  <block id="8caa382fb0f5f7a8279424d306dd003d" category="list-text">由於 All Flash 陣列的延遲大幅改善、因此一般無法將 All Flash 陣列與含有旋轉磁碟的陣列進行效能比較。測試結果通常沒有意義。</block>
  <block id="bc2b8b37bdda467f2ce639ab28bf4646" category="list-text">將尖峰 IOPS 效能與 All Flash 陣列進行比較通常並不實用、因為資料庫不受儲存 I/O 限制例如、假設一個陣列可維持 500K 的隨機 IOPS 、而另一個陣列則可維持 300K 。如果資料庫花費 99% 的時間處理 CPU 、這種差異在現實世界中是不相關的。工作負載永遠不會使用儲存陣列的完整功能。相反地、尖峰 IOPS 功能在整合平台中可能非常重要、而在整合平台中、儲存陣列預期會載入至尖峰容量。</block>
  <block id="0c2cbb26e6baa58b7d3a3309f95a2786" category="list-text">請務必在任何儲存測試中考慮延遲和 IOPS 。市面上許多儲存陣列都宣稱 IOPS 極高、但延遲卻使這些 IOPS 在這類層級上無法使用。使用 All Flash Array 的典型目標是 1 毫秒標記。更好的測試方法不是測量最大可能的 IOPS 、而是判斷儲存陣列在平均延遲大於 1 毫秒之前可以維持多少 IOPS 。</block>
  <block id="e6d8362588e550c19912b0f3f0e1a129" category="section-title">Oracle 自動工作負載儲存庫與基準測試</block>
  <block id="d035df494751722dd56d4cf4a8d1f795" category="paragraph">Oracle 效能比較的黃金標準是 Oracle 自動工作負載儲存庫（ AWR ）報告。</block>
  <block id="95f7e55383674168e90b01b708bc88db" category="paragraph">有多種類型的 AWR 報告。從儲存點來看、執行所產生的報告<block ref="5053a9940effa118d38161a53f3b80f8" prefix=" " category="inline-code"></block> Command 是最全面且最有價值的命令、因為它針對特定資料庫執行個體、並包含一些詳細的分佈圖、可根據延遲來中斷儲存 I/O 事件。</block>
  <block id="7b79802e5668e6e5b990081db481505d" category="paragraph">比較兩個效能陣列的理想方法是在每個陣列上執行相同的工作負載、並產生精確鎖定工作負載的 AWR 報告。在執行時間極長的工作負載中、可以使用包含開始和停止時間的單一 AWR 報告、但最好將 AWR 資料分成多份報告。例如、如果批次工作從午夜執行至上午 6 點、請建立一系列從午夜– 1 點、上午 1 點– 2 點開始的一小時 AWR 報告。</block>
  <block id="e39ecb86ad7d25413ba8ad2976fd3e4a" category="paragraph">在其他情況下、應最佳化非常簡短的查詢。最佳選項是以查詢開始時建立的 AWR 快照為基礎的 AWR 報告、以及在查詢結束時建立的第二個 AWR 快照。否則資料庫伺服器應保持安靜、以將會使分析中查詢活動模糊的背景活動降至最低。</block>
  <block id="2fe7152c186ec1b5b0451e13ec8b968b" category="admonition">如果無法取得 AWR 報告、 Oracle 狀態報告是一個很好的替代方案。它們包含與 AWR 報告相同的大部分 I/O 統計資料。</block>
  <block id="8b8c73ac7e509a897688356d1d283d75" category="section-title">Oracle AWR 與疑難排解</block>
  <block id="42a92c79ee82f4343e7d65f2f1cf2dd2" category="paragraph">AWR 報告也是分析效能問題的最重要工具。</block>
  <block id="ad5387afbab7c506c781c8b12b0a4b24" category="paragraph">與基準測試一樣、效能疑難排解也需要您精確測量特定工作負載。如果可能、請在向 NetApp 支援中心回報效能問題、或與 NetApp 或合作夥伴客戶團隊合作、討論新解決方案時提供 AWR 資料。</block>
  <block id="6471146c0e33e2a8ec8a5c6635c837bc" category="paragraph">提供 AWR 資料時、請考量下列需求：</block>
  <block id="5c3ba265890805919f93c246b3f8d2d6" category="list-text">執行<block ref="5053a9940effa118d38161a53f3b80f8" prefix=" " category="inline-code"></block> 產生報告的命令。輸出可以是文字或 HTML 。</block>
  <block id="25db65f9a36910f3e488a8b7407130de" category="list-text">如果使用 Oracle Real Application Clusters （ RAC ）、請為叢集中的每個執行個體產生 AWR 報告。</block>
  <block id="96d55341f8208c60720e68b3155f3aa1" category="list-text">鎖定問題存在的特定時間。AWR 報告的最長可接受使用時間通常為一小時。如果問題持續數小時、或涉及多小時作業、例如批次工作、請提供多個一小時的 AWR 報告、涵蓋整個分析期間。</block>
  <block id="4533b15b837909c68a0171d2638494d2" category="list-text">如有可能、請將 AWR 快照時間間隔調整為 15 分鐘。此設定可執行更詳細的分析。這也需要額外執行<block ref="5053a9940effa118d38161a53f3b80f8" prefix=" " category="inline-code"></block> 提供每 15 分鐘間隔的報告。</block>
  <block id="97eb6d04cc93934c1be4ab95054cd0b0" category="list-text">如果問題是非常短的執行查詢、請根據作業開始時建立的 AWR 快照、以及作業結束時建立的第二個 AWR 快照、提供 AWR 報告。否則、資料庫伺服器應保持安靜、以將會使分析中作業的活動受到影響的背景活動減至最低。</block>
  <block id="5186f459ce7d75e587a083bcb7c5927a" category="list-text">如果在特定時間回報效能問題、但未在其他時間回報、請提供額外的 AWR 資料、以展現良好的效能來進行比較。</block>
  <block id="108a72dad388aa310cc52ee3bac7d1cc" category="section-title">calibr_IO</block>
  <block id="f1c07dfccef6a6c47a5ccef938e10e3d" category="paragraph">。<block ref="108a72dad388aa310cc52ee3bac7d1cc" prefix=" " category="inline-code"></block> 絕對不可使用命令來測試、比較或基準測試儲存系統。如 Oracle 文件所述、本程序會校正儲存設備的 I/O 功能。</block>
  <block id="872892cce56a2665ad7ceecc44b38166" category="paragraph">校準與基準測試不同。此命令的目的是發佈 I/O 、藉由最佳化發行給主機的 I/O 層級、協助校正資料庫作業並改善其效率。因為執行的 I/O 類型<block ref="108a72dad388aa310cc52ee3bac7d1cc" prefix=" " category="inline-code"></block> 作業並不代表實際的資料庫使用者 I/O 、結果無法預測、而且經常無法重現。</block>
  <block id="e66807fad19acd41db50eedff918a4dd" category="section-title">SLOB2</block>
  <block id="0a6192ff5412539c31db2c7a98f408b3" category="inline-link-macro"><block ref="0a6192ff5412539c31db2c7a98f408b3" category="inline-link-rx"></block></block>
  <block id="d1f6fb23f52090ffd944dc54549735b8" category="paragraph">SLOB2 是愚蠢的小 Oracle 基準測試工具、已成為評估資料庫效能的首選工具。這是由 Kevin Closson 開發的、可在取得 <block ref="3ccce0719b1965cd915da75778e4e706" category="inline-link-macro-rx"></block>。安裝和設定需要幾分鐘的時間、它使用實際的 Oracle 資料庫來在使用者可定義的資料表空間上產生 I/O 模式。這是少數幾種可用的測試選項之一、可將全快閃陣列與 I/O 飽和它也有助於產生更低層級的 I/O 、以模擬低 IOPS 但對延遲敏感的儲存工作負載。</block>
  <block id="baffd8ac40ca7b966340e7b257b4c7b4" category="section-title">交換台工作台</block>
  <block id="905a59d6f73f4e2aea1dc232a3bcd195" category="paragraph">交換基準台可用於測試資料庫效能、但使用交換基準台的方式會對儲存造成壓力、這是非常困難的。NetApp 尚未從 SwingWorkbench 中看到任何測試結果、這些測試產生足夠的 I/O 、使其在任何 AFF 陣列上都成為重大負載。在有限的情況下、訂單輸入測試（ OET ）可用於從延遲點評估儲存設備。這在資料庫對於特定查詢具有已知延遲相依性的情況下很有用。必須注意確保主機和網路已正確設定、以實現 All Flash 陣列的延遲潛力。</block>
  <block id="e3cf940afa524b20b15c43b20405be77" category="section-title">HammerDB</block>
  <block id="5c9408da71d2ff7554b9fd11add795cf" category="paragraph">HammerDB 是一種資料庫測試工具、可模擬 TPC-C 和 TPC-H 基準測試等。建構足夠大的資料集以正確執行測試可能需要很長時間、但它可以是評估 OLTP 和資料倉儲應用程式效能的有效工具。</block>
  <block id="7e1ad070b7fff621d9d64a71cec87684" category="section-title">Orion</block>
  <block id="56fedcbec2842fb62a743c5f84311597" category="paragraph">Oracle Orion 工具通常與 Oracle 9 搭配使用、但並未加以維護、以確保與各種主機作業系統的變更相容。由於與作業系統和儲存組態不相容、因此很少與 Oracle 10 或 Oracle 11 搭配使用。</block>
  <block id="38622bf572fa7bec2dc7f3915ebd345f" category="paragraph">Oracle 重新編寫了該工具，默認情況下，該工具與 Oracle 12c 一起安裝。雖然本產品已經過改良、並使用許多與實際 Oracle 資料庫相同的呼叫、但它並未使用 Oracle 所使用的相同程式碼路徑或 I/O 行為。例如、大部分的 Oracle I/O 都是同步執行、這表示資料庫會暫停、直到 I/O 作業在前景完成為止。只是以隨機 I/O 淹沒儲存系統、並不是真正的 Oracle I/O 複製、也無法提供直接的儲存陣列比較方法、也無法測量組態變更的影響。</block>
  <block id="bb68dfada5ca20e256bbd3ffbbfab9e6" category="paragraph">也就是說、 Orion 有一些使用案例、例如一般測量特定主機網路儲存組態的最大可能效能、或是測量儲存系統的健全狀況。仔細測試後、只要參數包括 IOPS 、處理量和延遲的考量、並嘗試忠實複寫真實的工作負載、就能設計出可用的 Orion 測試來比較儲存陣列或評估組態變更的影響。</block>
  <block id="6b64090d226d30776368e89b08c7c71b" category="summary">適用於 Oracle 資料庫的 WAFL 對齊</block>
  <block id="03a35ba2b6191f8cfbd1cca378eefc91" category="doc">Oracle 資料庫的 WAFL 對齊驗證</block>
  <block id="219900dcd21cee2f958254a708ad36f6" category="paragraph">正確的 WAFL 對齊對於良好的效能至關重要。雖然 ONTAP 以 4KB 單位管理區塊、但這並不表示 ONTAP 以 4KB 單位執行所有作業。事實上、 ONTAP 支援不同大小的區塊作業、但基礎會計是由 WAFL 以 4KB 為單位進行管理。</block>
  <block id="5d3a5c290e14d74acf49b20d15120886" category="paragraph">「對齊」一詞是指 Oracle I/O 與這些 4KB 單元的相對應方式。最佳效能要求 Oracle 8KB 區塊位於磁碟機上的兩個 4KB WAFL 實體區塊上。如果區塊偏移 2KB 、則此區塊會位於一半的 4KB 區塊、一個獨立的完整 4KB 區塊、然後是第三個 4KB 區塊的一半。這種安排會導致效能降低。</block>
  <block id="0073ce99d632b066d5ac09a4ad0cf7fc" category="paragraph">對齊並不涉及 NAS 檔案系統。Oracle 資料檔案會根據 Oracle 區塊的大小、與檔案的開頭對齊。因此、 8KB 、 16KB 和 32KB 的區塊大小一律會對齊。所有區塊作業都會從檔案開頭偏移、單位為 4 KB 。</block>
  <block id="d7f7edd61ab216efc34578584a7d0e7c" category="paragraph">相反地、 LUN 在啟動時通常會包含某種驅動程式標頭或檔案系統中繼資料、以建立偏移。對齊在現代作業系統中很少是個問題、因為這些作業系統是專為可能使用原生 4KB 磁碟區的實體磁碟機所設計、因此也需要將 I/O 與 4KB 邊界對齊才能獲得最佳效能。</block>
  <block id="38b3d1cd67903560954ad297a92e3de1" category="paragraph">不過、有一些例外情況。資料庫可能已從未針對 4KB I/O 最佳化的舊版作業系統移轉、或是在建立分割區時發生使用者錯誤、可能導致偏移量、而大小單位不是 4KB 。</block>
  <block id="612eeadd26ceeace7b043d37f8e24b1f" category="paragraph">下列範例僅適用於 Linux 、但程序可適用於任何作業系統。</block>
  <block id="1d5b772bea21e5e949413e09eedf17de" category="section-title">一致</block>
  <block id="594b0fc1af44897ff4b26f2e6b866685" category="paragraph">以下範例顯示單一磁碟分割的單一 LUN 對齊檢查。</block>
  <block id="dc2c18402c86861702fc1d94a6495ac3" category="paragraph">首先、建立使用磁碟機上所有可用分割區的分割區。</block>
  <block id="adff8cc6319e96d2685fd082a5aa043c" category="paragraph">您可以使用下列命令以數學方式檢查對齊方式：</block>
  <block id="4bc7aba328a710bb7d0935cf830634aa" category="paragraph">輸出顯示單位為 512 位元組、且分割區的開頭為 32 個單位。總共 32 x 512 = 16 、 834 位元組、這是 4KB WAFL 區塊的整數倍數。此分割區已正確對齊。</block>
  <block id="dd343941469b5360af52eb1b94fe5de6" category="paragraph">若要驗證正確的對齊方式、請完成下列步驟：</block>
  <block id="7d84e72acd05d0c93d99e414f5b092b5" category="list-text">識別 LUN 的通用唯一識別碼（ UUID ）。</block>
  <block id="92af2a93f00a6297c490ba0be5fd7a8a" category="list-text">進入 ONTAP 控制器上的節點 Shell 。</block>
  <block id="5274579d5eff6fe6d1e8ecbf54e84993" category="list-text">在第一步中識別的目標 UUID 上開始收集統計資料。</block>
  <block id="52df0a2ea976123bf02330300b2392e3" category="list-text">執行一些 I/O請務必使用<block ref="3c908d68ba53922b92c5595b72fa011c" prefix=" " category="inline-code"></block> 用於確保 I/O 同步且無緩衝的引數。</block>
  <block id="fac8a5b490ea29eca93ec213d79e6ff2" category="admonition">請務必小心使用此命令。反轉<block ref="39c8942e1038872a822c0dc75eedbde3" prefix=" " category="inline-code"></block> 和<block ref="8bf8854bebe108183caeb845c7676ae4" prefix=" " category="inline-code"></block> 引數會破壞資料。</block>
  <block id="4f7dce34a21e3de727f3e3ad05e6e7d8" category="list-text">停止統計資料並檢視對齊分佈圖。所有 I/O 都應位於<block ref="c6bd178b372b0ddd17fff48819badc6a" prefix=" " category="inline-code"></block> 貯體、表示 I/O 與 4KB 區塊邊界對齊。</block>
  <block id="5df81374c01d1b7c20fe8cb3883117eb" category="section-title">未對齊</block>
  <block id="5ff266dadf965b3c304513f516a13c12" category="paragraph">以下範例顯示 I/O 未對齊：</block>
  <block id="25be03b87e6a5d8170ce85b16ea506ab" category="list-text">建立不符合 4KB 邊界的分割區。這不是現代作業系統的預設行為。</block>
  <block id="4adda0e871000c2b13a4faef6ce4e21b" category="paragraph">錯誤的對齊是顯而易見的。I/O 大多落在 * 之中 <block ref="66c8d76cad709856ccec680cab8ab35a" prefix="*" category="inline-code"></block> 符合預期偏移的貯體。建立分割區時、它會比最佳化的預設值更進一步移入 512 個位元組、這表示長條圖偏移 512 個位元組。</block>
  <block id="b53cb977228ac351c16dfacc3c427a99" category="paragraph">此外<block ref="20e637b3ddd562732de038fba736c7ee" prefix=" " category="inline-code"></block> 統計資料為非零、這表示執行的 I/O 並未填滿整個 4KB 區塊。</block>
  <block id="d3d92f87c5235ad11c8bc69e85fb2fd0" category="section-title">重作記錄</block>
  <block id="162b54d51a30629d78e153f8da201780" category="paragraph">此處說明的程序適用於資料檔案。Oracle 重做記錄和歸檔記錄檔有不同的 I/O 模式。例如、重做記錄是單一檔案的循環覆寫。如果使用預設的 512 位元組區塊大小、寫入統計資料看起來會像這樣：</block>
  <block id="d36dbaa617441d3308f5a9b50cb6f5ca" category="paragraph">I/O 會分散到所有分佈式分佈區、但這並不是效能考量。不過、重做記錄率極高可能會因為使用 4KB 區塊大小而受惠。在這種情況下、最好確定重做記錄 LUN 已正確對齊。不過、這對於資料檔案對齊的良好效能並不重要。</block>
  <block id="f64f1c647516f5a47c00be152fdbf488" category="summary">Oracle 和過時的 NFSv3 鎖定</block>
  <block id="91d9710c9fee248ae3e9c4b810ae704f" category="doc">過時的 NFSv3 鎖定和 Oracle 資料庫</block>
  <block id="3f9e1e3abd12ad7445baea4b681b9ceb" category="paragraph">如果 Oracle 資料庫伺服器當機、則重新啟動時可能會發生過時的 NFS 鎖定問題。請仔細注意伺服器上的名稱解析設定、以避免此問題。</block>
  <block id="288ebefc25180862eb0448b786b1b9fc" category="paragraph">產生此問題的原因是建立鎖定和清除鎖定會使用兩種稍微不同的名稱解析方法。涉及兩個過程： Network Lock Manager （ NLM ）和 NFS 用戶端。NLM 使用<block ref="e5caaf154dfeed411b9eec65b903a22a" prefix=" " category="inline-code"></block> 以決定主機名稱、而<block ref="d49331f31f40041ebcee19fca74fd9d4" prefix=" " category="inline-code"></block> 程序用途<block ref="330c4316ae6124616389eb1ca9912f7a" prefix=" " category="inline-code"></block>。這些主機名稱必須相符、作業系統才能正確清除過時的鎖定。例如、主機可能正在尋找擁有的鎖定<block ref="c7169a6dd344d0f0a38071a1262e4973" prefix=" " category="inline-code"></block>但鎖定已由主機登錄為<block ref="0c32c65f5ac66d0bdb4e63bd5fde7f75" prefix=" " category="inline-code"></block>。如果<block ref="330c4316ae6124616389eb1ca9912f7a" prefix=" " category="inline-code"></block> 不會傳回與相同的值<block ref="5c020b5bb8d1ce1ace51c2a2f4c06fc2" prefix=" " category="inline-code"></block>，則鎖定釋放程序未成功。</block>
  <block id="19b9a1f540971d74c69042125bab2abc" category="paragraph">下列範例指令碼會驗證名稱解析是否完全一致：</block>
  <block id="ee04b3fa3b28391874763596275e09c9" category="paragraph">如果<block ref="b64c6f211add16fd66ac17ef14c2a2b4" prefix=" " category="inline-code"></block> 不符<block ref="4040592cec1880aa70936989f05e7c31" prefix=" " category="inline-code"></block>、可能是過時的鎖定。例如、此結果顯示潛在問題：</block>
  <block id="2b500e5914ea5a219ade17dea0808f51" category="paragraph">解決方案通常是透過變更主機出現在中的順序來找到<block ref="ad942c725cd0cae65ca4c63717ec464c" prefix=" " category="inline-code"></block>。例如、假設 hosts 檔案包含下列項目：</block>
  <block id="22b58ec1cec48707dfc018e6e216e966" category="paragraph">若要解決此問題、請變更完整網域名稱和簡短主機名稱出現的順序：</block>
  <block id="e357ccd0745db58f22ea5c0947b613ee" category="paragraph"><block ref="330c4316ae6124616389eb1ca9912f7a" prefix="" category="inline-code"></block> 現在傳回短<block ref="c7169a6dd344d0f0a38071a1262e4973" prefix=" " category="inline-code"></block> 主機名稱、符合的輸出<block ref="4040592cec1880aa70936989f05e7c31" prefix=" " category="inline-code"></block>。因此、鎖定會在伺服器當機後自動清除。</block>
  <block id="547b870352d8464aadbe7bee63d6f3d1" category="summary">資料庫虛擬化簡介</block>
  <block id="ea4c55be196897a16d86999f5c16d582" category="doc">虛擬化</block>
  <block id="9e28dbd7a4f5940eeaf6d3893c5c4b1f" category="section-title">儲存簡報</block>
  <block id="151ae53a4100e0a6e83bde4d78083f81" category="list-text">iSCSI LUN 由虛擬機器上的 iSCSI 啟動器管理、而非 Hypervisor</block>
  <block id="36f9cea3dc0f65698a9fbe15460591c1" category="list-text">* 可攜性。 * VM 擁有其檔案系統時、移動 Oracle 環境的程序會變得更簡單。檔案系統可在虛擬化與非虛擬化的來賓作業系統之間輕鬆移動。</block>
  <block id="f114856edc6cd8d6a9add5ec3f67656f" category="section-title">半虛擬化驅動程式</block>
  <block id="beeb10ceee6c9aabe178fb51edea7d22" category="paragraph">為了達到最佳效能、使用半虛擬化網路驅動程式至關重要。使用資料存放區時、需要半虛擬化 SCSI 驅動程式。半虛擬化的裝置驅動程式可讓來賓更深入地整合至 Hypervisor 、而非模擬的驅動程式、在該驅動程式中、 Hypervisor 會花費更多的 CPU 時間來模擬實體硬體的行為。</block>
  <block id="7c5996fc15a24ce96b30160b60ac2b96" category="section-title">過度使用 RAM</block>
  <block id="5bccdd812c4af1cb5b9e36ddce656b60" category="paragraph">過度使用 RAM 意味著在不同主機上設定的虛擬化 RAM 多於實體硬體上的虛擬化 RAM 。否則可能會造成非預期的效能問題。虛擬化資料庫時、 Oracle SGA 的基礎區塊不得由 Hypervisor 交換至儲存設備。這樣做會導致效能結果極不穩定。</block>
  <block id="be493f1fc0b02ae45602c7c13f7b5dc7" category="summary">TR-4792 提供在採用 NVIDIA 圖形處理單元（ GPU ）和虛擬化軟體的 VMware Horizon 環境中、將 NetApp HCI 615C 用於 3D 圖形工作負載的指引。</block>
  <block id="ff1d278a485c443dc5d8fc9f10f1a702" category="doc">NetApp HCI for virtual desktop Infrastructure with VMware Horizon 7 - 利用 3D 圖形為進階使用者提供強大功能</block>
  <block id="e3162938e0d7b1bbc74111cc5b5871c5" category="paragraph">TR-4792 提供在採用 NVIDIA 圖形處理單元（ GPU ）和虛擬化軟體的 VMware Horizon 環境中、使用 NetApp H615C 運算節點來處理 3D 圖形工作負載的指引。它也提供 H615C 的 SPECviewperf 13 初步測試結果。</block>
  <block id="1de37c09602b46db5de57a946efe2768" category="paragraph"><block ref="1de37c09602b46db5de57a946efe2768" category="inline-link-macro-rx"></block></block>
  <block id="93b94e62ad8cb02a1d1a7b0944a5445d" category="summary">本文件討論ONTAP VMware vSphere的產品安全性功能。</block>
  <block id="57a033c33a8be6110be46b2914cc4989" category="doc">搭配 ONTAP 使用 vVols</block>
  <block id="69556d50c944e0a07ade0bea62f078a3" category="paragraph">將 VVols 搭配 ONTAP 使用的關鍵在於 VASA Provider 軟體、此軟體是 VMware vSphere 虛擬應用裝置 ONTAP 工具的一部分。</block>
  <block id="5e484430124a3d64541b75bbf3c8f529" category="paragraph">ONTAP 工具也包括 vCenter UI 擴充、 REST API 伺服器、適用於 VMware Site Recovery Manager 的儲存複寫介面卡、監控和主機組態工具、以及一系列可協助您更妥善管理 VMware 環境的報告。</block>
  <block id="21247c4392dc3c243f693dbf5b762553" category="section-title">產品與文件</block>
  <block id="4fc5e15c4dc0d227bc5f8f26e4337083" category="paragraph">ONTAP FlexClone 授權（隨附於 ONTAP One ）和 ONTAP 工具應用裝置是唯一需要搭配 NetApp ONTAP 使用 vVols 的額外產品。ONTAP 工具的最新版本是以單一統一應用裝置的形式提供、可在 ESXi 上執行、提供以前三種不同應用裝置和伺服器的功能。對於 vVols 、使用 ONTAP 工具 vCenter UI 延伸或 REST API 作為 ONTAP 與 vSphere 功能的一般管理工具和使用者介面、以及提供特定 vVols 功能的 VASA 供應商、是非常重要的。SRA 元件包含在傳統資料存放區中、但 VMware Site Recovery Manager 不會將 SRA 用於 vVols 、而是在 SRM 8.3 及更新版本中實作新服務、利用 VVols 複寫的 VASA 提供者。</block>
  <block id="bf03408d75f93f6e28c07c3c2300b98a" category="section-title">使用 iSCSI 或 FCP 時的 ONTAP 工具 VASA Provider 架構</block>
  <block id="94ef809dc16e728151bda996f8b4f8aa" category="inline-image-macro">ONTAP 工具 VASA 供應商架構、 240</block>
  <block id="d78de3410d86d345a548abdf67aff375" category="paragraph"><block ref="d78de3410d86d345a548abdf67aff375" category="inline-image-macro-rx" type="image"></block></block>
  <block id="5e5421e75636200787a4449a2cdaa1f1" category="section-title">產品安裝</block>
  <block id="3ef3033a2b9a744a1e4e7e93fa01f909" category="paragraph">若要進行新的安裝、請將虛擬應用裝置部署到 vSphere 環境中。目前版本的 ONTAP 工具會自動向 vCenter 註冊、並預設啟用 VASA Provider 。除了 ESXi 主機和 vCenter Server 資訊外、您還需要應用裝置的 IP 位址組態詳細資料。如前所述、 VASA Provider 要求 ONTAP FlexClone 授權已安裝在您計畫用於 VVols 的任何 ONTAP 叢集上。此應用裝置內建監控程式、可確保可用度、最佳實務做法是設定 VMware High Availability 及選擇性的容錯功能。如需其他詳細資料、請參閱第 4.1 節。請勿將 ONTAP 工具應用裝置或 vCenter Server 應用裝置（ VCSA ）安裝或移至 vVols 儲存設備、因為這可能會導致應用裝置無法重新啟動。</block>
  <block id="6a5c862f634c8967f7246f42eb9de6e1" category="paragraph">使用 NetApp 支援網站 （ NSS ）上可供下載的升級 ISO 檔案、即可支援 ONTAP 工具的就地升級。請依照部署與設定指南的指示來升級應用裝置。</block>
  <block id="3c07c9b4b562a16890d9fee571f0441e" category="inline-link">VMware vSphere ONTAP 工具規模調整指南</block>
  <block id="e4e51979718d88ce483f9477be981a76" category="paragraph">如需調整虛擬應用裝置規模及瞭解組態限制、請參閱本知識庫文章：<block ref="a75738ed95b0811ed0edd1b8ef0d9568" category="inline-link-rx"></block></block>
  <block id="72333dadacbc964761fb14f718f6d411" category="section-title">產品文件</block>
  <block id="e0644c46fdc2ced2c094f7db15e15a8a" category="paragraph">下列文件可協助您部署 ONTAP 工具。</block>
  <block id="09e308ed60d47b80b6cd16eb233f1bb9" category="inline-link">如需完整的文件儲存庫與擴大機； #44 ；請造訪 docs.netapp.com 的連結</block>
  <block id="7f21741a70426baea3ee41488da86af4" category="paragraph"><block ref="56b49132b20e341764c8aa067751e8a5" category="inline-link-rx"></block></block>
  <block id="be11c74c1dd7f307bb80183a90dc2067" category="section-title">開始使用</block>
  <block id="7d0ee6fed10d3d4e5c9ee496729ab519" category="inline-link">版本資訊</block>
  <block id="2645deadffb8af180b8a35da3d034ad8" category="list-text"><block ref="2645deadffb8af180b8a35da3d034ad8" category="inline-link-rx"></block></block>
  <block id="b1555cd6358e57b76c72e343dbe31846" category="inline-link">瞭解適用於 VMware vSphere 的 ONTAP 工具</block>
  <block id="a0aaeda90fe2ef02fba791bc7c35645c" category="list-text"><block ref="a0aaeda90fe2ef02fba791bc7c35645c" category="inline-link-rx"></block></block>
  <block id="e695b432b77d6bddfcb785c76f5e5442" category="inline-link">VMware工具快速入門ONTAP</block>
  <block id="324b0410f22fb210bbf88e1ee7e97428" category="list-text"><block ref="324b0410f22fb210bbf88e1ee7e97428" category="inline-link-rx"></block></block>
  <block id="3d7fe3e43f9f24fffe5ed0d546d12f13" category="inline-link">部署ONTAP 各種工具</block>
  <block id="354336d78d1f0a156dcd5221d341dfd0" category="list-text"><block ref="354336d78d1f0a156dcd5221d341dfd0" category="inline-link-rx"></block></block>
  <block id="a2fa58344be7fbd9a2be0320a8df0f77" category="inline-link">升級ONTAP 功能</block>
  <block id="33a77e1014f1325d6ba19639a6c95d48" category="list-text"><block ref="33a77e1014f1325d6ba19639a6c95d48" category="inline-link-rx"></block></block>
  <block id="21e2a89d708329706ec6ed3fc989a1f6" category="section-title">使用ONTAP VMware工具</block>
  <block id="91a9cfdbaaa44e0a9ad72e92533f763f" category="inline-link">配置傳統資料存放區</block>
  <block id="f27fe8f858d8a91950e214753b95722c" category="list-text"><block ref="f27fe8f858d8a91950e214753b95722c" category="inline-link-rx"></block></block>
  <block id="fc7d7e475ac8c3868d7426bb41df9b09" category="inline-link">配置vVols資料存放區</block>
  <block id="0c2552c3930f472b2d120f30d7aa0415" category="list-text"><block ref="0c2552c3930f472b2d120f30d7aa0415" category="inline-link-rx"></block></block>
  <block id="317bbf73ff27c5f981628c8fb83ebf22" category="inline-link">設定角色型存取控制</block>
  <block id="644ae78061acbb2254be4de3ea454b06" category="list-text"><block ref="644ae78061acbb2254be4de3ea454b06" category="inline-link-rx"></block></block>
  <block id="48bc2d028cb2a507ef974230ca3ba793" category="inline-link">設定遠端診斷</block>
  <block id="fc0330812838aba14025bd70d41b943d" category="list-text"><block ref="fc0330812838aba14025bd70d41b943d" category="inline-link-rx"></block></block>
  <block id="641e9457539249e880725760f91d5ee2" category="inline-link">設定高可用度</block>
  <block id="5027a18a60c68e05df84cd699af74497" category="list-text"><block ref="5027a18a60c68e05df84cd699af74497" category="inline-link-rx"></block></block>
  <block id="04edeb5424c826c14a69edb777edf395" category="section-title">保護及管理資料存放區</block>
  <block id="e17534281670c5ea4e8d55420a63c98f" category="inline-link">保護傳統的資料存放區</block>
  <block id="c8ac931d575d89c007212a35c8dde74c" category="list-text"><block ref="8f91d2113ff32de18906bad1cd446b0d" category="inline-link-rx"></block> 使用 SRM</block>
  <block id="bff05cbbc19cad2bd10b9fe25dc34a1b" category="inline-link">保護 vVols 型虛擬機器</block>
  <block id="710b15d782f0c2c0411066b86644a12d" category="list-text"><block ref="7741c74d7508dc983fa4af0dff0bdda1" category="inline-link-rx"></block> 使用 SRM</block>
  <block id="5267febc97a2cc385cc5c73995dc64df" category="inline-link">監控傳統的資料存放區和虛擬機器</block>
  <block id="bac3b262bb348a54f9986c2b5dbf6024" category="list-text"><block ref="bac3b262bb348a54f9986c2b5dbf6024" category="inline-link-rx"></block></block>
  <block id="3123ece3c3b36f605758cb0c9a28f904" category="inline-link">監控vVols資料存放區和虛擬機器</block>
  <block id="75c07b623699e1947d011983a7823584" category="list-text"><block ref="75c07b623699e1947d011983a7823584" category="inline-link-rx"></block></block>
  <block id="73751ced5959ea3089346b01d42dde76" category="paragraph">除了產品文件之外、還有支援知識庫文章、這些文章可能很有用。</block>
  <block id="dd5138e8a4207a5b2fde43b411a4b5e1" category="section-title">Vasa Provider Dashboard</block>
  <block id="6da01a643ea28efe37fa2d6fd06a634b" category="paragraph">VASA Provider 包含儀表板、內含個別 vVols VM 的效能與容量資訊。這些資訊直接來自 VVol 檔案和 LUN 的 ONTAP 、包括前 5 名虛擬機器的延遲、 IOPS 、處理量和正常運作時間、以及前 5 名資料存放區的延遲和 IOPS 。使用 ONTAP 9.7 或更新版本時、預設會啟用此功能。擷取並顯示在儀表板中的初始資料可能需要 30 分鐘。</block>
  <block id="9b78e1fecb2bcc40733f2180691c7507" category="section-title">ONTAP 工具 vVols 儀表板</block>
  <block id="4adf016da96258b45a1cf762298729b5" category="inline-image-macro">ONTAP 工具 vVols 儀表板、 400</block>
  <block id="73c1e14ddf3f32984f869ac3f122b2ca" category="paragraph"><block ref="73c1e14ddf3f32984f869ac3f122b2ca" category="inline-image-macro-rx" type="image"></block></block>
  <block id="cd47dd01745339787e4c7300389401f2" category="section-title">最佳實務做法</block>
  <block id="9ae938622297e9d4b14dd0006a8f0bf4" category="paragraph">* 限制 *</block>
  <block id="b4f52a4fd0b07c9d904b95fc98a1cd45" category="inline-link">組態最大值</block>
  <block id="bc8259e306c73b2969e7ac6297000e64" category="paragraph">一般而言、 ONTAP 支援 VMware 所定義的 VVols 限制（請參閱已發佈<block ref="a6efdd9b1a19df6105024b4869e0582b" category="inline-link-rx"></block>）。下表摘要列出 VVols 大小和數量的特定 ONTAP 限制。請務必檢查<block ref="bb9c67b5a4c15a85b5e6aa6c9afd0285" category="inline-link-rx"></block> 以獲得 LUN 和檔案數量和大小的更新限制。</block>
  <block id="9b7ad553354519b31ec860eef39e5f6b" category="paragraph">* ONTAP VVols 限制 *</block>
  <block id="130b78bfd6c9b050a912fec77e285e3f" category="cell">容量/功能</block>
  <block id="6231ad61105cd983d3f0042762d3233d" category="cell">SAN （ SCSI 或 NVMe of ）</block>
  <block id="75d4e7871261a858356a58d682ab71de" category="cell">VVols 大小上限</block>
  <block id="9cfd7100738cee4daf7acd5e01d31e14" category="cell">62 TiB*</block>
  <block id="9a728251ad1e90577975ae9395374772" category="cell">每個 FlexVol Volume 的最大 VVols 數</block>
  <block id="021bbc7ee20b71134d53e20206bd6feb" category="cell">1024</block>
  <block id="46ba990c143630f55072434a6ea958c0" category="cell">20 億</block>
  <block id="cdbcf58620f0b4b0bbf3291386a99407" category="cell">每個 ONTAP 節點的 VVols 數目上限</block>
  <block id="342264031889898ec1a553b4dd58d98c" category="cell">最多 12288**</block>
  <block id="659e5faa0bdb08327ba0719230e95be2" category="cell">500 億</block>
  <block id="43b49f27d93c6f55f54a68e8983d5479" category="cell">每個 ONTAP 配對的最大 VVols 數</block>
  <block id="3941694d19c2d1fc406f055ab62cb9eb" category="cell">高達 24576 個 **</block>
  <block id="d6b3e65f296fd23975dd6f1a915c4b22" category="cell">每個 ONTAP 叢集的 VVols 數量上限</block>
  <block id="2702ff8627a3990fc940d6f53463925e" category="cell">高達 98,304**</block>
  <block id="4f0c25d6c688cf50460d11fecaa97fa8" category="cell">沒有特定的叢集限制</block>
  <block id="855ecc47bb0d239e1fdf6fee84e24c75" category="cell">QoS 物件上限（共享原則群組和個別 VVols 服務層級）</block>
  <block id="26890bd9dcb27c05f1ab5bcc859501b8" category="cell">12 、 000 至 ONTAP 9.3 ； 40 、 000 、含 ONTAP 9.4 及更新版本</block>
  <block id="0e38f856cb713ce9eea79fa1c6b7dc32" category="list-text">大小限制是根據執行 ONTAP 9.12.1P2 及更新版本的 ASA 系統或 AFF 和 FAS 系統而定。</block>
  <block id="d27c43bb3cdcbfa3852bb91192ffb849" category="list-text">SAN vVols （ NVMe 命名空間或 LUN ）的數量會因平台而異。請務必檢查<block ref="bb9c67b5a4c15a85b5e6aa6c9afd0285" category="inline-link-rx"></block> 以獲得 LUN 和檔案數量和大小的更新限制。</block>
  <block id="72e0ee397942f7233122887584f94b8b" category="paragraph">搭配 vSphere 使用 ONTAP vVols 非常簡單、並遵循已發佈的 vSphere 方法（請參閱您的 ESXi 版本的 VMware 文件中的「在 vSphere 儲存環境下使用虛擬磁碟區」）。以下是一些與 ONTAP 一起考量的額外實務做法。</block>
  <block id="83583580d98b69cb8317f9b285f3c8df" category="cell">* 將 ONTAP 工具用於 VMware vSphere 的 UI 延伸或 REST API 、以佈建 vVols 資料存放區 * * 和傳輸協定端點 *</block>
  <block id="9507d4f97aceb8d05fc962dd53f082af" category="cell">雖然可以使用一般 vSphere 介面建立 vVols 資料存放區、但使用 ONTAP 工具會視需要自動建立傳輸協定端點、並使用 ONTAP 最佳實務做法並符合您定義的儲存功能設定檔來建立 FlexVol 磁碟區。只要在主機 / 叢集 / 資料中心上按一下滑鼠右鍵、然後選取 ONTAP tools_ 和 _Provision datastority_ 即可。您只需在精靈中選擇所需的 vVols 選項即可。</block>
  <block id="e8d5f9dc0bff953a9e59755813c7e8bf" category="cell">* 切勿將 ONTAP 工具應用裝置或 vCenter Server Appliance （ VCSA ）儲存在他們正在管理的 VVols 資料存放區。 *</block>
  <block id="c6ac0465bff03857ee851d98f6bd782b" category="cell">如果您需要重新開機設備、這可能會導致「雞和蛋的情況」、因為它們在重新開機時無法重新連結自己的 vVols 。您可以將它們儲存在由不同 ONTAP 工具和 vCenter 部署所管理的 vVols 資料存放區。</block>
  <block id="ab8d352870fb5334773c7177d3d5dcd1" category="cell">* 避免在不同的 ONTAP 版本中執行 vVols 作業。 *</block>
  <block id="8b2bcef781b7e1f6d64739147d50aae7" category="cell">支援的儲存功能（例如 QoS 、特性設定等）已在 VASA Provider 的不同版本中有所變更、有些則視 ONTAP 版本而定。在 ONTAP 叢集中使用不同版本、或在具有不同版本的叢集之間移動 vVols 、可能會導致非預期行為或法規遵循警示。</block>
  <block id="b2da0eca57c759eff034e6fe26f153e6" category="cell">* 使用 NVMe / FC 或 FCP for vVols 之前、請先將光纖通道架構分區。 *</block>
  <block id="cd7bf0e1e61341c1aa3fa23401af8a27" category="inline-image-macro">單一啟動器分區、包含四個節點、 400</block>
  <block id="51591d05b7e084ba8e5ae7f63172177e" category="inline-link">_TR-4080 現代 SAN ONTAP 9_ 的最佳實務做法</block>
  <block id="c1723e6a0e1d3dd28232b33e0cb6e61d" category="inline-link">_TR-4684 使用 NVMe 來實作和設定現代化 SAN</block>
  <block id="9a36c8f0464a7ffce114044f1859c7ff" category="cell">* 根據您的需求規劃您的支援 FlexVols 。 *</block>
  <block id="03d2e894fa9a05efefa4e8d6b2008a19" category="cell">您可以將多個備份磁碟區新增至 vVols 資料存放區、以便在 ONTAP 叢集上分散工作負載、支援不同的原則選項、或增加允許的 LUN 或檔案數量。不過、如果需要最高的儲存效率、請將所有的備份磁碟區放在單一集合體上。或者、如果需要最大的複製效能、請考慮使用單一 FlexVol 磁碟區、並將範本或內容庫保留在相同的磁碟區中。VASA Provider 將許多 VVols 儲存作業卸載至 ONTAP 、包括移轉、複製和快照。在單一 FlexVol 磁碟區內完成此作業時、會使用節省空間的檔案複本、而且幾乎可以立即使用。當跨 FlexVol 磁碟區執行此作業時、複本會快速可用、並使用即時重複資料刪除和壓縮功能、但在背景工作使用背景重複資料刪除和壓縮在磁碟區上執行之前、最大的儲存效率可能無法恢復。視來源和目的地而定、部分效率可能會降低。</block>
  <block id="80b15469535d95a1690f308427545c7e" category="cell">* 讓儲存功能設定檔（ SCP ）保持簡單。 *</block>
  <block id="33e2905cb722c14575a9bff81ba78b39" category="cell">避免將功能設定為任何、以指定不需要的功能。這可將選擇或建立 FlexVol 磁碟區時發生的問題減至最低。例如、在 VASA Provider 7.1 及更早版本中、如果將壓縮保留在預設的 SCP 設定「否」、則會嘗試停用壓縮、即使在 AFF 系統上也一樣。</block>
  <block id="5a6d5fdddf6fbd82f1952b532b03c9ef" category="cell">* 使用預設的 SCP 做為範例範本來建立您自己的範本。 *</block>
  <block id="ee3cbda1c3c4a14ae024478c7ada6d11" category="cell">* 遵循所有通訊協定最佳實務做法。 *</block>
  <block id="6a2c1ac1da51eca0c1a65afffab8dfab" category="inline-image-macro">透過 NFS v3500 使用 vVols 進行網路組態</block>
  <block id="6cacb3f1edd09835a2ad07d72f488e2a" category="paragraph">NetApp ONTAP 軟體在過去二十多年來一直是 VMware vSphere 環境的領先儲存解決方案、並持續新增創新功能來簡化管理、同時降低成本。</block>
  <block id="918febfed3d070cf1250909e5cdcf31d" category="paragraph">本文件涵蓋適用於 VMware vSphere 虛擬磁碟區（ VVols ）的 ONTAP 功能、包括最新的產品資訊和使用案例、以及最佳實務做法和其他資訊、可簡化部署並減少錯誤。</block>
  <block id="c7448b194ba68bddce48f1d11d5d7db7" category="admonition">本文件將先前發佈的技術報告 _TR-4400: VMware vSphere 虛擬磁碟區（ vVols ）取代為 NetApp ONTAP</block>
  <block id="d30f04665be7a6d9663004b1b5e61a9a" category="paragraph">最佳實務做法是輔助其他文件、例如指南和相容性清單。這些技術是根據實驗室測試和NetApp工程師與客戶廣泛的現場經驗所開發。它們可能不是唯一可行或受支援的實務做法、但通常是最簡單的解決方案、可滿足大多數客戶的需求。</block>
  <block id="b010d2e253827dbb44b7ba4e1332e24e" category="admonition">本文件已更新、納入 vSphere 8.0 更新 1 中新增的 vVols 功能、 ONTAP 工具 9.12 版本支援這些功能。</block>
  <block id="cc713c330b9c4e00d3ed7233bc54a889" category="section-title">虛擬磁碟區（ vVols ）概觀</block>
  <block id="64f0863a7fb5f52a7ac6a911e1ad6862" category="paragraph">NetApp 於 2012 年開始與 VMware 合作、為 vSphere 5 支援 vSphere API for Storage Aware （ VASA ）。此早期的 VASA Provider 允許定義設定檔中的儲存功能、以便在資源配置時用來篩選資料存放區、並在之後檢查原則是否符合規定。隨著時間演進、新增新功能以實現更多自動化資源配置、並新增虛擬磁碟區或 vVols 、其中個別的儲存物件用於虛擬機器檔案和虛擬磁碟。這些物件可以是 LUN 、檔案、現在也可以是 vSphere 8 ： NVMe namespaces.NetApp 與 VMware 密切合作、成為 2015 年 vSphere 6 隨附的 vVols 參考合作夥伴、再次成為 vSphere 8 中使用 NVMe over Fabric 的 vVols 設計合作夥伴。NetApp 持續強化 vVols 、以充分利用 ONTAP 的最新功能。</block>
  <block id="cbf0aa9daeb855e4eace1a3bdc474ce2" category="paragraph">有幾個元件需要注意：</block>
  <block id="e2f6b83160ea0712fbc59dd84410c4b2" category="cell">* VASA Provider*</block>
  <block id="919601826e1d58bccaaab76d787871d2" category="cell">這是處理 VMware vSphere 與儲存系統之間通訊的軟體元件。對於 ONTAP 、 VASA Provider 會在名為 ONTAP tools for VMware vSphere 的應用裝置（簡稱 ONTAP 工具）中執行。ONTAP 工具也包括 vCenter 外掛程式、適用於 VMware Site Recovery Manager 的儲存複寫介面卡（ SRA ）、以及用於建置自己自動化的 REST API 伺服器。ONTAP 工具在 vCenter 中設定及登錄後、就不再需要直接與 ONTAP 系統互動、因為幾乎所有的儲存需求都可以直接從 vCenter UI 中進行管理、或透過 REST API 自動化來進行管理。</block>
  <block id="05ad8543ff165c6b8cd0cc5e976d3245" category="cell">* 傳輸協定端點（ PE ） *</block>
  <block id="3b2cd9018385f55c53c9a8b756df8bb5" category="cell">傳輸協定端點是 ESXi 主機和 vVols 資料存放區之間 I/O 的 Proxy 。ONTAP VASA Provider 會自動建立這些 LUN 、每個 VVols 資料存放區的 FlexVol 磁碟區一個傳輸協定端點 LUN （大小為 4 MB ）、或是在資料存放區中主控 FlexVol 磁碟區的儲存節點上、每個 NFS 介面（ LIF ）一個 NFS 裝載點。ESXi 主機直接裝載這些傳輸協定端點、而非個別的 vVol LUN 和虛擬磁碟檔案。不需要管理 VASA Provider 自動建立、掛載、卸載及刪除的傳輸協定端點、以及任何必要的介面群組或匯出原則。</block>
  <block id="d3f051e8316cfd36651af1e65be24a75" category="cell">* 虛擬傳輸協定端點（ VPE ） *</block>
  <block id="71afca0aa1a505ea2ac3ce5a1a681549" category="paragraph">vSphere 8 的新功能是、搭配 vVols 使用 NVMe over Fabrics （ NVMe of ）時、 ONTAP 中不再有傳輸協定端點的概念。相反地、只要第一個虛擬機器開機、 ESXi 主機就會為每個 ANA 群組自動產生一個虛擬 PE 。ONTAP 會自動為資料存放區所使用的每個 FlexVol 磁碟區建立全日空群組。</block>
  <block id="8202498953d2ebcf9968c37a7e47f4f6" category="paragraph">使用 NVMe for VVols 的另一個優點是、 VASA Provider 不需要任何繫結要求。而是由 ESXi 主機根據 VPE 在內部處理 vVol 繫結功能。這可減少 vVol 綁定風暴對服務造成影響的機會。</block>
  <block id="70532c0374111d897ef1176b34b6396c" category="inline-link">NVMe 和虛擬磁碟區</block>
  <block id="50ec55042a7f4e8c2c66219ac096cfb3" category="inline-link">vmware.com</block>
  <block id="113c9d4e642d1ba4cc469267fb7fd0de" category="paragraph">如需詳細資訊、請參閱<block ref="f8d477cd77073d731aafe4f52026608a" category="inline-link-rx"></block> 開啟<block ref="1f1565cca975c4a703345d21e7f273b8" category="inline-link-rx"></block></block>
  <block id="61def0b14af00df4eb90bcd79d858a8b" category="cell">* 虛擬磁碟區資料存放區 *</block>
  <block id="b945cda41d7a84e7152e09343a17cbe6" category="cell">虛擬 Volume 資料存放區是 VVols 容器的邏輯資料存放區呈現、由 VASA Provider 建立和維護。該容器代表從 VASA Provider 管理的儲存系統所配置的儲存容量集區。ONTAP 工具支援將多個 FlexVol 磁碟區（稱為備份磁碟區）分配至單一 VVols 資料存放區、這些 VVols 資料存放區可跨越 ONTAP 叢集中的多個節點、將 Flash 和混合式系統結合在一起、提供不同的功能。管理員可以使用資源配置精靈或 REST API 來建立新的 FlexVol Volume 、或選擇預先建立的 FlexVol Volume 來備份儲存區（如果有的話）。</block>
  <block id="c25d2cc7c6540f6ac98af67455eecc39" category="cell">* 虛擬磁碟區（ vVols ） *</block>
  <block id="9664cdf7951789389813facac649fec1" category="cell">VVols 是儲存在 vVols 資料存放區中的實際虛擬機器檔案和磁碟。使用術語 vVol （奇異）是指單一特定檔案、 LUN 或命名空間。ONTAP 會根據資料存放區使用的傳輸協定、建立 NVMe 命名空間、 LUN 或檔案。有幾種不同類型的 vVols ；最常見的是組態（中繼資料檔案）、資料（虛擬磁碟或 VMDK ）和交換（在 VM 開機時建立）。受 VMware VM 加密保護的 VVols 屬於其他類型。VMware VM 加密不應與 ONTAP Volume 或 Aggregate 加密混淆。</block>
  <block id="937251054fa0c1a7b946f8928cc857b9" category="section-title">原則型管理</block>
  <block id="34d2b7d8b570ede7a638d070656b7b81" category="paragraph">VMware vSphere API for Storage Aware （ VASA ）可讓 VM 管理員輕鬆使用所需的任何儲存功能來配置 VM 、而無需與儲存團隊互動。在 VASA 之前、 VM 管理員可以定義 VM 儲存原則、但必須與儲存管理員合作、以識別適當的資料存放區、通常是使用文件或命名慣例。有了 VASA 、具有適當權限的 vCenter 管理員就能定義一系列儲存功能、 vCenter 使用者隨後可以使用這些功能來配置 VM 。VM 儲存原則與資料存放區儲存功能設定檔之間的對應可讓 vCenter 顯示相容資料存放區清單以供選擇、並可啟用其他技術、例如 Aria （前身為 vRealize ） Automation 或 Tanzu Kubernetes Grid 、以自動從指派的原則中選取儲存區。這種方法稱為儲存原則型管理。雖然儲存功能設定檔和原則也可用於傳統的資料存放區、但我們的重點是 vVols 資料存放區。</block>
  <block id="631bdc7de6608fd57c3fa0b397c3c26f" category="paragraph">有兩個要素：</block>
  <block id="a156a7f38a3727ce705b5466eb11e0bf" category="cell">* 儲存功能設定檔（ SCP ） *</block>
  <block id="43a258e66ca875fa9c5d3e35e06ba2b7" category="cell">儲存功能設定檔（ SCP ）是一種儲存範本形式、可讓 vCenter 管理員定義所需的儲存功能、而無需實際瞭解如何在 ONTAP 中管理這些功能。採用範本樣式的方法、讓管理員能夠以一致且可預測的方式輕鬆提供儲存服務。SCP 中說明的功能包括效能、傳輸協定、儲存效率及其他功能。具體功能因版本而異。使用 vCenter UI 中的 ONTAP Tools for VMware vSphere 功能表來建立這些工具。您也可以使用 REST API 來建立 CDP 。您可以選擇個別功能來手動建立這些功能、或是從現有（傳統）資料存放區自動產生。</block>
  <block id="8f50a0757d99fe5dd0df8d19478d4921" category="cell">* VM 儲存原則 *</block>
  <block id="f99c5cf9298b040025bd3dfe966cb86e" category="cell">VM 儲存原則是在 vCenter 的原則和設定檔下建立。對於 vVols 、請使用 NetApp vVols 儲存類型供應商的規則來建立規則集。ONTAP 工具提供簡化的方法、讓您只需選取一個 SCP 、而非強制您指定個別規則。</block>
  <block id="5dda8b04866334dc92ee08001b15701a" category="paragraph">如上所述、使用原則有助於簡化資源配置磁碟區的工作。只要選取適當的原則、 VASA Provider 就會顯示支援該原則的 VVols 資料存放區、並將 VVol 放入符合法規的個別 FlexVol 磁碟區（圖 1 ）。</block>
  <block id="2ce0d6ec59cca7e0b6e0bdc389301e63" category="section-title">使用儲存原則部署 VM</block>
  <block id="e0795f8b847058e171dec5a519757ece" category="image-alt">使用儲存原則部署虛擬機器</block>
  <block id="f0d0f0a6174a5a9dde27782042e22ccf" category="paragraph">VM 佈建完成後、 VASA Provider 將繼續檢查法規遵循狀況、並在備用磁碟區不再符合原則時、在 vCenter 中警示 VM 管理員（圖 2 ）。</block>
  <block id="941431bc1cecb0ec5e89e78e9a5a96fc" category="section-title">VM 儲存原則法規遵循</block>
  <block id="bfd6dec22a6a1724ff1b67f1f289cdfc" category="image-alt">虛擬機器儲存原則符合性</block>
  <block id="e08bc5b354c3e8058003a662e0f7cade" category="section-title">NetApp VVols 支援</block>
  <block id="234ad0324c313ec05d0fa6fe8d430967" category="paragraph">NetApp ONTAP 自 2012 年首次推出 VASA 規格以來、就一直提供支援。雖然其他 NetApp 儲存系統可能支援 VASA 、但本文件著重於目前支援的 ONTAP 9 版本。</block>
  <block id="7b02ea300aef2e0bff0d7f6111053284" category="section-title">NetApp ONTAP</block>
  <block id="4d53a8e49ac64213ffccdd970a35171e" category="paragraph">除了 AFF 、 ASA 和 FAS 系統上的 ONTAP 9 、 NetApp 還支援 ONTAP Select 上的 VMware 工作負載、採用 VMware Cloud on AWS 的 ONTAP 上的 Amazon FSX 、採用 Azure VMware 解決方案的 Azure NetApp Files 、使用 Google Cloud 的 Cloud Volumes Service VMware Engine 、以及 Equinix 中的 NetApp 私有儲存設備、 但具體功能可能會因服務供應商和可用的網路連線而異。也可從 vSphere 來賓存取儲存在這些組態中的資料、以及 Cloud Volumes ONTAP 。</block>
  <block id="9fe1fd556b933358881222d5c3da127c" category="paragraph">在發佈時、超大規模環境僅限於傳統的 NFS v3 資料存放區、因此 VVols 僅適用於內部部署 ONTAP 系統、或雲端連線系統、這些系統提供內部部署系統的完整功能、例如由全球各地的 NetApp 合作夥伴和服務供應商代管的系統。</block>
  <block id="274bc582ca884fc158ea9ac9f79f9067" category="inline-link">產品文件ONTAP</block>
  <block id="5ca60fe92dec435059ba5acefa4ce2c9" category="paragraph">_ 如需 ONTAP 的詳細資訊、請參閱<block ref="8a9b15dc18a16e0b1acfa438e27f6aa6" category="inline-link-rx"></block>_</block>
  <block id="3dffa984dadf9ff0006ee9cebd3b04b9" category="inline-link">TR-4597</block>
  <block id="9a03bb7ec5329e35d98c7b12b63c4df0" category="paragraph">_ 如需 ONTAP 和 VMware vSphere 最佳實務做法的詳細資訊、請參閱<block ref="fc9815e7b1405959c49ad47e9a23e3a5" category="inline-link-rx"></block>_</block>
  <block id="d3fb76da5fbbcd6fa32e40910b5b9a47" category="section-title">搭配 ONTAP 使用 vVols 的優點</block>
  <block id="d0f004282063136e91d76d1d43d7c95f" category="paragraph">當 VMware 在 2015 年推出 VVols 支援 VASA 2.0 時、他們將其描述為「整合與管理架構、為外部儲存設備（ SAN/NAS ）提供全新的作業模式」。 此作業模式可提供多項優點、搭配 ONTAP 儲存設備使用。</block>
  <block id="6a74f7c0a9021e009a9c030e54084978" category="paragraph">如第 1.2 節所述、原則型管理可讓 VM 使用預先定義的原則進行佈建及後續管理。這有助於 IT 作業的多種方式：</block>
  <block id="e0eb51b6d319e14c2fbfc1f628021a26" category="list-text">* 提高速度。 * ONTAP 工具不需要 vCenter 管理員與儲存團隊一起開啟儲存資源配置活動的問題單。不過、 vCenter 和 ONTAP 系統上的 ONTAP 工具 RBAC 角色仍可允許個別的團隊（例如儲存團隊）、或是由同一個團隊進行個別活動、只要有需要、就能限制特定功能的存取。</block>
  <block id="3f4dbd6687bd0d55bf69fe5fdd0137c4" category="list-text">* 更聰明的資源配置。 * 儲存系統功能可透過 VASA API 公開、讓資源配置工作流程能夠充分利用進階功能、而無需 VM 管理員瞭解如何管理儲存系統。</block>
  <block id="a13fcc9220d042cae454e9ac073636ca" category="list-text">* 更快的資源配置。 * 可在單一資料存放區中支援不同的儲存功能、並根據 VM 原則自動選擇適合的 VM 。</block>
  <block id="eb4c052226108afebf26e670208b9a55" category="list-text">* 避免錯誤。 * 儲存和 VM 原則是事先開發的、並可視需要套用、而無需每次佈建 VM 時都自訂儲存設備。當儲存功能從定義的原則中移出時、就會發出法規遵循警報。如前所述、 SCP 可讓初始資源配置可預測且可重複執行、而 VM 儲存原則則以 SCP 為基礎、則可確保正確放置。</block>
  <block id="9c520768a1d84268417335cf19a423b9" category="list-text">* 更好的容量管理。 * VASA 和 ONTAP 工具可讓您視需要將儲存容量向下檢視至大量的彙總層級、並在容量開始不足時提供多層警示。</block>
  <block id="f9878e32fdf258284c007eaae38773cd" category="section-title">現代化 SAN 上的 VM 精細管理</block>
  <block id="7e673a7c12cc256f29bcd7b2028d9d5a" category="paragraph">使用光纖通道和 iSCSI 的 SAN 儲存系統是 VMware 首次支援 ESX 的系統、但它們缺乏從儲存系統管理個別 VM 檔案和磁碟的能力。而是配置 LUN 並由 VMFS 管理個別檔案。這使得儲存系統難以直接管理個別 VM 儲存效能、複製和保護。VVols 提供 ONTAP 強大、高效能的 SAN 功能、讓使用 NFS 儲存設備的客戶能夠享有更精細的儲存空間。</block>
  <block id="25a46370807e0eab0dfe3853abfb9b6e" category="paragraph">現在、使用適用於 VMware vSphere 9.12 及更新版本的 vSphere 8 和 ONTAP 工具、 Vols 對於舊版 SCSI 型傳輸協定所使用的相同精細控制功能現在也可在採用 NVMe over Fabrics 的現代化光纖通道 SAN 中使用、以在規模上獲得更高的效能。有了 vSphere 8.0 更新 1 、現在可以使用 vVols 部署完整的端點對端 NVMe 解決方案、而無需在 Hypervisor 儲存堆疊中進行任何 I/O 轉譯。</block>
  <block id="f61f57f748f5f0b52c7f11f1f1bd43f0" category="section-title">更強大的儲存卸載功能</block>
  <block id="911fa02c34dda38cd69be06e524ed9d0" category="inline-link">效率保證</block>
  <block id="3170031d77f241bc872afcb490c0a806" category="paragraph">雖然 VAAI 提供多種卸載至儲存設備的作業、但 VASA Provider 仍會解決一些落差。SAN VAAI 無法將 VMware 託管的快照卸載至儲存系統。NFS VAAI 可以卸載 VM 託管的快照、但儲存原生快照對 VM 有限制。由於 VVols 使用個別 LUN 、命名空間或檔案來儲存虛擬機器磁碟、因此 ONTAP 可以快速有效地複製檔案或 LUN 、以建立不再需要差異檔案的 VM 精細快照。NFS VAAI 也不支援卸載熱（開啟電源） Storage VMotion 移轉的複製作業。當使用 VAAI 搭配傳統 NFS 資料存放區時、必須關閉虛擬機器電源、以允許移轉卸載。ONTAP 工具中的 VASA Provider 可提供近乎即時且具儲存效率的複本、以進行熱移轉和冷移轉、也支援近乎即時的 vVols 跨磁碟區移轉複本。由於這些顯著的儲存效率效益、您可能可以在中充分利用 vVols 工作負載<block ref="9d1af7a9d4f98887e53c1a9bedbce044" category="inline-link-rx"></block> 方案。同樣地、如果使用 VAAI 的跨磁碟區複製無法滿足您的需求、您可能會因為 vVols 複製體驗的改善而解決您的業務挑戰。</block>
  <block id="a8567b4dc683947384ef2e1dd0fc6ac1" category="section-title">vVols 的常見使用案例</block>
  <block id="48e535b80538b088fd868fde9372715c" category="paragraph">除了這些優點之外、我們也會看到 vVol 儲存設備的常見使用案例：</block>
  <block id="441f01ec38e91fad1b235a0e7422a178" category="list-text">* 隨選虛擬機器資源配置 *</block>
  <block id="bd652a918164d8fa5176b5f9b92c2e61" category="list-text">私有雲或服務供應商 IaaS 。</block>
  <block id="fddccd9595370687015a5ab02bcff60f" category="list-text">透過 Aria （前身為 vRealize ）套件、 OpenStack 等、充分運用自動化與協調功能</block>
  <block id="4fbc1141a40f5259e3ab1545de52b1ea" category="list-text">* 一流磁碟（ FCD ） *</block>
  <block id="e83f2e4e8676ee8faac4d6af599fd7e7" category="list-text">VMware Tanzu Kubernetes Grid [TKG] 持續磁碟區。</block>
  <block id="b2b81490f2245d3d566e0ccc6a29cfc2" category="list-text">透過與 VMDK 生命週期管理功能相隨的方式、提供 Amazon EBS 般的服務。</block>
  <block id="2511e4e8cbb72027ae20f24008d4b939" category="list-text">* 隨需提供暫存虛擬機器 *</block>
  <block id="eeb1044cc319a5d53503e45dbf762291" category="list-text">測試 / 開發實驗室</block>
  <block id="858d314810762abccaa7baf230e3dc18" category="list-text">訓練環境</block>
  <block id="ab7bbc294bf0f0354980a3014e8f4219" category="section-title">vVols 的常見優點</block>
  <block id="ccd6ea8c57e93a5401d07aab9c60f371" category="paragraph">在充分發揮其優勢時（例如在上述使用案例中）、 vVols 提供下列具體改善：</block>
  <block id="13491b3af50183642ea0035b2d1f95f9" category="list-text">在單一磁碟區內或 ONTAP 叢集中的多個磁碟區之間快速建立複本、相較於傳統的 VAAI 複本、這是一項優勢。而且儲存效率也很高。磁碟區內的複製作業會使用 ONTAP 檔案複製、就像 FlexClone 磁碟區一樣、而且只會儲存來源 vVol 檔案 /LUN/ 命名空間的變更。因此、為了生產或其他應用程式的目的而建立的長期虛擬機器會迅速建立、佔用最少空間、並可從虛擬機器層級保護（使用適用於 VMware vSphere 的 NetApp SnapCenter 外掛程式、 VMware 託管快照或 VADP 備份）和效能管理（搭配 ONTAP QoS ）中獲益。</block>
  <block id="1c21847cdc5616af138ba0c03aad7adb" category="list-text">VVols 是搭配 vSphere CSI 使用 TKG 時的理想儲存技術、可提供由 vCenter 管理員管理的獨立儲存類別和容量。</block>
  <block id="d5f068caef73978a5483badd927a7e98" category="list-text">Amazon EBS 類似的服務可透過 FCD 提供、因為 FCD VMDK 就像名稱所示、是 vSphere 中的一流公民、生命週期可獨立管理、與可能附加的虛擬機器分開管理。</block>
  <block id="7e7040600922b2a78715f856613a3c08" category="doc">保護 vVols</block>
  <block id="de92c927f248723e4668aec459709995" category="section-title">Vasa Provider 高可用度</block>
  <block id="f4d4cb8868f07cad16bd7de7e36c5201" category="paragraph">NetApp VASA Provider 與 vCenter 外掛程式和 REST API 伺服器（先前稱為虛擬儲存主控台 [VSC] ）及儲存複寫介面卡一起執行、是虛擬應用裝置的一部分。如果 VASA Provider 不可用、則使用 vVols 的 VM 將繼續執行。但是、無法建立新的 vVols 資料存放區、而且 VVols 無法由 vSphere 建立或繫結。這表示無法開啟使用 vVols 的虛擬機器、因為 vCenter 將無法要求建立交換 vVol 。而且執行中的 VM 無法使用 VMotion 移轉至其他主機、因為 VVols 無法繫結至新主機。</block>
  <block id="3958bf41787d7fcc6a9f8dd9348c947f" category="paragraph">Vasa Provider 7.1 及更新版本支援新功能、確保服務在需要時可用。其中包括監控 VASA Provider 和整合式資料庫服務的新看門狗程序。如果偵測到故障、它會更新記錄檔、然後自動重新啟動服務。</block>
  <block id="1acc458c695b0d3dfbf588309801fda2" category="paragraph">vSphere 管理員必須使用相同的可用度功能來設定進一步的保護、以保護其他關鍵任務 VM 免於軟體、主機硬體和網路中的故障。虛擬應用裝置不需要額外的組態即可使用這些功能、只要使用標準 vSphere 方法進行設定即可。NetApp 已測試並支援這些解決方案。</block>
  <block id="ff43afff832597ff45e5abeab2826ccf" category="inline-link">適用於 VMware vSphere 的 ONTAP 工具文件（設定 ONTAP 工具的高可用度）</block>
  <block id="d516ca4c9c18446a82d9fc9ee85bd955" category="paragraph">vSphere High Availability 可輕鬆設定為在發生故障時、在主機叢集中的其他主機上重新啟動 VM 。vSphere 容錯功能可建立次要 VM 、以持續複寫、並可隨時接管、進而提供更高的可用度。如需這些功能的詳細資訊、請參閱<block ref="b6d78cbf1d5afb52929c529b32a350ad" category="inline-link-rx"></block>以及 VMware vSphere 文件（請在 ESXi 和 vCenter Server 下尋找 vSphere 可用度）。</block>
  <block id="97ba24d475ff6fdc7743099992cc301f" category="paragraph">ONTAP 工具 VASA Provider 會即時自動備份 VVols 組態至託管 ONTAP 系統、其中 VVols 資訊儲存在 FlexVol Volume 中繼資料中。如果 ONTAP 工具應用裝置因任何原因而無法使用、您可以輕鬆快速地部署新的工具並匯入組態。如需 VASA Provider 恢復步驟的詳細資訊、請參閱本知識庫文章：</block>
  <block id="6799b6ec743f9159edf3b43790210a11" category="inline-link">如何執行 VASA Provider 災難恢復解決方案指南</block>
  <block id="9462790a7557a7eb2fe9daad4b875817" category="paragraph"><block ref="9462790a7557a7eb2fe9daad4b875817" category="inline-link-rx"></block></block>
  <block id="029a7740ecd792264454f9dbe194e980" category="section-title">VVols 複寫</block>
  <block id="c7b26217fd0c9041b6f779a0f669de5c" category="paragraph">許多 ONTAP 客戶使用 NetApp SnapMirror 將傳統的資料存放區複寫到次要儲存系統、然後在發生災難時使用次要系統來恢復個別 VM 或整個站台。在大多數情況下、客戶都會使用軟體工具來管理這項作業、例如 NetApp SnapCenter 外掛程式 for VMware vSphere 等備份軟體產品、或是 VMware 的 Site Recovery Manager （搭配 ONTAP 工具中的儲存複寫介面卡）等災難恢復解決方案。</block>
  <block id="bc6303e4538280b1b01d45a5f7d20039" category="paragraph">這項軟體工具需求對於管理 vVols 複寫更為重要。雖然有些方面可以由原生功能進行管理（例如、 VMware 託管的 vVols 快照會卸載到 ONTAP 、而會使用快速、有效率的檔案或 LUN 複本）、但一般而言、管理複寫和還原需要協調。VVols 的中繼資料受到 ONTAP 和 VASA Provider 的保護、但在次要站台使用時需要額外處理。</block>
  <block id="c6a26835eb364bad22b16cb127b74135" category="paragraph">ONTAP 工具 9.7.1 搭配 VMware Site Recovery Manager （ SRM ） 8.3 版本、新增了災難恢復與移轉工作流程協調的支援、充分利用 NetApp SnapMirror 技術。</block>
  <block id="2803a799fd66056eff404a17ba640c2b" category="paragraph">在 ONTAP 工具 9.7.1 的初始版 SRM 支援中、必須預先建立 FlexVols 並啟用 SnapMirror 保護、才能將它們作為 VVols 資料存放區的備份磁碟區。從 ONTAP 工具 9.10 開始、不再需要此程序。您現在可以將 SnapMirror 保護新增至現有的備份磁碟區、並更新您的 VM 儲存原則、以利用與 SRM 整合的災難恢復、移轉協調和自動化功能、來善用原則型管理。</block>
  <block id="8142fcf496d02a58ce02a17558db863e" category="paragraph">目前、 VMware SRM 是 NetApp 唯一支援的 vVols 災難恢復與移轉自動化解決方案、 ONTAP 工具會先檢查是否存在已在 vCenter 註冊的 SRM 8.3 或更新版本伺服器、然後再允許您啟用 vVols 複寫、 雖然您可以利用 ONTAP 工具 REST API 來建立自己的服務。</block>
  <block id="7d8e8eced8d8b1a50f20640ffb5d363a" category="section-title">使用 SRM 複寫 VVols</block>
  <block id="4d30574e6d5bc9a71718858eeb30774c" category="inline-image-macro">VVols 與 SRM 複寫、 300</block>
  <block id="5844b0ec1ad8db5185ec67effeb9a7b7" category="paragraph"><block ref="5844b0ec1ad8db5185ec67effeb9a7b7" category="inline-image-macro-rx" type="image"></block></block>
  <block id="c95aede1de7a41511c9d962deba49054" category="section-title">MetroCluster 支援</block>
  <block id="3f15bb720adb42bd521a2ce1cb3a2974" category="paragraph">雖然 ONTAP 工具無法觸發 MetroCluster 切轉、但它確實支援採用統一 vSphere 都會儲存叢集（ VMSC ）組態的 NetApp MetroCluster 系統來支援 VVols 備份磁碟區。MetroCluster 系統的移轉是以正常方式處理。</block>
  <block id="cde16c5ee89c209c821e120caf65bb81" category="paragraph">雖然 NetApp SnapMirror Business Continuity （ SM-BC ）也可作為 VMSC 組態的基礎、但 VVols 目前不支援這項功能。</block>
  <block id="c859f5cd725cb2d1b163e4b066bede9a" category="paragraph">如需 NetApp MetroCluster 的詳細資訊、請參閱以下指南：</block>
  <block id="e5e0fb3ae5564674a6548ade7c601578" category="inline-link">_TR-4689 MetroCluster IP 解決方案架構與設計 _</block>
  <block id="e64de4e49a37e62ff7f8c37e859bbeb9" category="paragraph"><block ref="e64de4e49a37e62ff7f8c37e859bbeb9" category="inline-link-rx"></block></block>
  <block id="0229efec9dc9b9a7fdf144b025157176" category="inline-link">_TR-4705 NetApp MetroCluster 解決方案架構與設計 _</block>
  <block id="6aee4b78ffdfaf193918978472d660a7" category="paragraph"><block ref="6aee4b78ffdfaf193918978472d660a7" category="inline-link-rx"></block></block>
  <block id="876341bac548f230eb390348e8b075ad" category="inline-link">VMware KB 2031038 VMware vSphere 支援 NetApp MetroCluster _</block>
  <block id="5e68486fffeebad2ed145408dc250367" category="paragraph"><block ref="5e68486fffeebad2ed145408dc250367" category="inline-link-rx"></block></block>
  <block id="50c323f7050912164118ba47eab75888" category="section-title">VVols 備份總覽</block>
  <block id="6751e706567f4773c4f3138b4de51a0f" category="paragraph">有幾種方法可以保護 VM 、例如使用客體內備份代理程式、將 VM 資料檔案附加至備份 Proxy 、或使用定義的 API （例如 VMware VADP ）。VVols 可以使用相同的機制來保護、許多 NetApp 合作夥伴也支援 VM 備份、包括 vVols 。</block>
  <block id="416d27c872769e934ac8a49ec98ccb53" category="paragraph">如前所述、 VMware vCenter 託管快照會卸載至節省空間且快速的 ONTAP 檔案 /LUN 複本。這些資料可用於快速手動備份、但 vCenter 最多可限制為 32 個快照。您可以使用 vCenter 拍攝快照、並視需要進行還原。</block>
  <block id="8f3d5ae5bd7d8922841975ccd84b8526" category="paragraph">從 SnapCenter Plugin for VMware vSphere （ SCV ） 4.6 開始、搭配 ONTAP 工具 9.10 及更新版本使用時、新增了對使用 ONTAP FlexVol Volume 快照的 vVols 型虛擬機器的損毀一致備份與還原支援、並支援 SnapMirror 和 SnapVault 複寫。每個磁碟區最多可支援 1023 個快照。此外、選擇控制閥也可以使用 SnapMirror 搭配鏡射儲存庫原則、在次要磁碟區上儲存更多快照、並保留更長的時間。</block>
  <block id="1429a9379faa8e82f8b198e93eebdf61" category="paragraph">vSphere 8.0 支援是採用分離式本機外掛程式架構的 4.7 號選擇控制閥推出的。vSphere 8.0U1 支援已新增至 4 號選擇控制閥 4.8 、該選擇控制閥已完全移轉至新的遠端外掛程式架構。</block>
  <block id="de1d77d00dae616276b6ceb6296a18f2" category="section-title">適用於 VMware vSphere 的 VVols Backup 搭配 SnapCenter 外掛程式</block>
  <block id="02f41838319aab980999b60967d7fd53" category="paragraph">有了 NetApp SnapCenter 、您現在可以根據標籤和 / 或資料夾、為 vVols 建立資源群組、以自動利用 ONTAP 的 FlexVol 快照來執行 vVols 型 VM 。這可讓您定義備份與還原服務、以便在虛擬機器在環境中動態佈建時、自動保護這些虛擬機器。</block>
  <block id="4549a2943666c4815098331d30a872da" category="paragraph">適用於 VMware vSphere 的 SnapCenter 外掛程式部署為登錄為 vCenter 擴充功能的獨立應用裝置、可透過 vCenter UI 或 REST API 進行管理、以實現備份與還原服務自動化。</block>
  <block id="26e2418d177df1dddb008e455ce28752" category="section-title">架構SnapCenter</block>
  <block id="3b345c0fb5d2f0451ef84d991b21dcac" category="inline-image-macro">SnapCenter 架構、 300</block>
  <block id="af9bca7d8452705ba7f607cd036dba01" category="paragraph"><block ref="af9bca7d8452705ba7f607cd036dba01" category="inline-image-macro-rx" type="image"></block></block>
  <block id="c32197281aa44f57ae568a9a42c7b3b6" category="paragraph">由於其他 SnapCenter 外掛程式在撰寫本文時尚未支援 vVols 、因此我們將著重於本文中的獨立部署模型。</block>
  <block id="6750052f2c0fb06d80a8efd7cb871190" category="paragraph">由於 SnapCenter 使用 ONTAP FlexVol 快照、因此 vSphere 上不會產生任何額外負荷、也不會像傳統 VM 使用 vCenter 託管快照時所見到的效能損失。此外、由於選擇控制閥的功能是透過 REST API 公開、因此使用 VMware Aria Automation 、 Ansible 、 Terraform 等工具、以及幾乎任何其他能夠使用標準 REST API 的自動化工具、都能輕鬆建立自動化工作流程。</block>
  <block id="0c889d77d71512ceb7241bd0f6d6ca23" category="inline-link">REST API總覽</block>
  <block id="35eab4195b135718da016e20979f9031" category="paragraph">如需SnapCenter 有關靜態API的資訊、請參閱<block ref="33852d6f529e96c0b816da3945bcb1e5" category="inline-link-rx"></block></block>
  <block id="4ee2d383554981f4ea8eff4f35db6832" category="inline-link">VMware vSphere REST API的VMware外掛程式SnapCenter</block>
  <block id="63ae61e98eec102c39264a819a3c522e" category="paragraph">如需SnapCenter VMware vSphere REST API的靜態外掛程式資訊、請參閱<block ref="40a6c7462de67e21480b7a31e406f8f9" category="inline-link-rx"></block></block>
  <block id="bdf03d5c2a7086b6c916dc96d06a0a6c" category="paragraph">下列最佳實務做法可協助您充分發揮 SnapCenter 部署的效益。</block>
  <block id="60af6a4208b610da54a63a7e3658d5a5" category="list-text">選擇控制閥同時支援 vCenter Server RBAC 和 ONTAP RBAC 、並包含預先定義的 vCenter 角色、這些角色會在登錄外掛程式時自動為您建立。您可以深入瞭解受支援的 RBAC 類型<block ref="a8ef9d6a500bd8288101245a3828ddb1" category="inline-link-rx"></block></block>
  <block id="0ed0835259b5b8c4b0f0910e7bfe2b17" category="list-text">使用 vCenter UI 、使用所述的預先定義角色指派最低權限的帳戶存取權<block ref="17b3487f3493b9c198e03f92348bfca0" category="inline-link-rx"></block>。</block>
  <block id="d53326766687d6bc7fa2e28ee177e809" category="list-text">如果您在 SnapCenter 伺服器上使用選擇控制閥、則必須指派 _SnapCenterAdmin_ 角色。</block>
  <block id="61ba6cb0b6021c205d41ed7f6fc1eb71" category="list-text">ONTAP RBAC 是指用於新增及管理選擇控制閥所使用儲存系統的使用者帳戶。ONTAP RBAC 不適用於 vVols 型備份。深入瞭解 ONTAP RBAC 和選擇控制閥<block ref="e4e865178d3962f87ac5cef3d6d68942" category="inline-link-rx"></block>。</block>
  <block id="1c89ba258526186ea0ec98325b61371b" category="list-text">使用 SnapMirror 將備份資料集複寫到第二個系統、以取得來源磁碟區的完整複本。如前所述、您也可以使用鏡射資料保險箱原則、以長期保留備份資料、而不受來源磁碟區快照保留設定影響。vVols 支援這兩種機制。</block>
  <block id="9792eeb3b91469abf77746b005d82d77" category="list-text">由於選擇控制閥也需要 VMware vSphere 的 ONTAP 工具才能使用 vVols 功能、因此請務必檢查 NetApp 互通性對照表工具（ IMT ）以瞭解特定版本的相容性</block>
  <block id="71c989bd68059e2ddfa4200c60b736c7" category="list-text">如果您在 VMware SRM 中使用 vVols 複寫、請注意您的原則 RPO 和備份排程</block>
  <block id="604eb779cbb9af378f7bda71633b5b31" category="list-text">使用保留設定來設計備份原則、以符合組織定義的還原點目標（ RPO ）</block>
  <block id="067ff91a08d3ff453b59d81993b96182" category="list-text">在資源群組上設定通知設定、以便在執行備份時收到狀態通知（請參閱下方圖 10 ）</block>
  <block id="c3add00693172bbbb4dd864bf0ad9116" category="section-title">資源群組通知選項</block>
  <block id="c728df76dc3609672a7969e320e39e32" category="inline-image-macro">資源群組通知選項、 300</block>
  <block id="45281309785094533b5880fe6d0fd1ea" category="paragraph"><block ref="45281309785094533b5880fe6d0fd1ea" category="inline-image-macro-rx" type="image"></block></block>
  <block id="6eae9510711f8df8f55a15e1761875d9" category="section-title">使用這些文件開始使用選擇控制閥</block>
  <block id="235a656535515ab3518937c09836e60d" category="inline-link">深入瞭SnapCenter 解VMware vSphere的功能</block>
  <block id="79eb02d2a96cc634df87bec5bd511bbe" category="paragraph"><block ref="79eb02d2a96cc634df87bec5bd511bbe" category="inline-link-rx"></block></block>
  <block id="04e7bb0411c1c8f56ca4fc8000c62ad8" category="inline-link">部署SnapCenter VMware vSphere的VMware vCenter外掛程式</block>
  <block id="d4ba0aa084ae1145248006481c881d29" category="paragraph"><block ref="d4ba0aa084ae1145248006481c881d29" category="inline-link-rx"></block></block>
  <block id="231cf4c70d866b616c21baddaeed0696" category="doc">疑難排解</block>
  <block id="9d2169c1c2855b78a7aeaa4f42d27dc7" category="section-title">NetApp 支援網站</block>
  <block id="ed9018b2e8611a3d2c03bb6a205b9715" category="inline-link">VMware vSphere適用的工具ONTAP</block>
  <block id="890eb741924c425abbb11e4618560181" category="paragraph">除了 NetApp 虛擬化產品的各種知識庫文章之外、 NetApp 支援網站 也提供方便的登陸頁面<block ref="6e90053136fd326e5d581844ca21966d" category="inline-link-rx"></block> 產品。此入口網站提供 NetApp 社群文章、下載、技術報告及 VMware 解決方案討論的連結。您可以在以下網址取得：</block>
  <block id="fff460b039580a1bd42725a397b4c8be" category="inline-link">NetApp 支援網站</block>
  <block id="897515b5a8a03f8d5cbed44fd47ef9f3" category="paragraph"><block ref="897515b5a8a03f8d5cbed44fd47ef9f3" category="inline-link-rx"></block></block>
  <block id="4020fd07f5ee2361dd23956e6a334ffd" category="paragraph">其他解決方案文件可於此處取得：</block>
  <block id="503a41e1e31e362793f7e86af9102c41" category="inline-link">_NetApp 虛擬化解決方案 _</block>
  <block id="33d455bce1363bad4500664eb6208860" category="paragraph"><block ref="33d455bce1363bad4500664eb6208860" category="inline-link-rx"></block></block>
  <block id="baf17f6d2396be5fd3676baf863a331f" category="section-title">產品疑難排解</block>
  <block id="9d6d7fa1a5253698556ac2b0cda2207d" category="paragraph">ONTAP 工具的各種元件（例如 vCenter 外掛程式、 VASA Provider 和儲存複寫介面卡）都會記錄在 NetApp 文件儲存庫中。不過、每個都有一個知識庫的個別小節、可能有特定的疑難排解程序。這些解決了 VASA Provider 可能遇到的最常見問題。</block>
  <block id="ae2a93a809929192ecc7b468f234af84" category="section-title">Vasa Provider UI 問題</block>
  <block id="92a2b5cb9c6906035c2864fa225e1940" category="inline-link">文章</block>
  <block id="69aecee18a55993c779487758eb051cc" category="paragraph">vCenter vSphere Web Client 偶爾會遇到與 Serenity 元件有關的問題、導致無法顯示 VASA Provider for ONTAP 功能表項目。請參閱部署指南或本知識庫中的解決 VASA Provider 註冊問題<block ref="c8979f1604396ce5570d07774ba255f0" category="inline-link-rx"></block>。</block>
  <block id="03cc611b90575ea37b55959adaa1c754" category="section-title">VVols 資料存放區資源配置失敗</block>
  <block id="281b890be0e8280eea1aebb82de90961" category="paragraph">有時 vCenter 服務在建立 vVols 資料存放區時可能會逾時。若要修正此問題、請重新啟動 VMware-SPS 服務、然後使用 vCenter 功能表（ Storage &gt; New Datastore ）重新掛載 vVols 資料存放區。本節內容涵蓋《管理指南》中 vCenter Server 6.5 的 VVols 資料存放區資源配置失敗。</block>
  <block id="3152add163cd8aaf116a259d85ebf8fb" category="section-title">升級 Unified Appliance 無法掛載 ISO</block>
  <block id="ffaa56a3f5a1157f2eb3955773bb41da" category="paragraph">由於 vCenter 發生錯誤、用於將 Unified Appliance 從一個版本升級至下一個版本的 ISO 可能無法掛載。如果 ISO 能夠附加至 vCenter 中的應用裝置、請遵循此知識庫中的程序<block ref="9839383ed04f777c0132b57ad0cb14ac" category="inline-link-rx"></block> 以解決此問題。</block>
  <block id="cacba1b456347ce8f32c7f5ed0d81e64" category="doc">部署 VVols Storage</block>
  <block id="2a5f3dc8d46246216b293c9e41979269" category="paragraph">對於使用 ONTAP 用於傳統資料存放區的現有 vSphere 環境、可能不需要前兩個步驟。您可能已經使用 ONTAP 工具來管理、自動化及報告 VMFS 或傳統 NFS 型儲存設備。以下章節將詳細說明這些步驟。</block>
  <block id="841db3655338a0c3dc36cf2761bfdafd" category="list-text">建立儲存虛擬機器（ SVM ）及其傳輸協定組態。您將選擇 NVMe / FC 、 NFSv3 、 NFSv4.1 、 iSCSI 、 FCP 、 或是混合使用這些選項。您可以使用 ONTAP 系統管理員精靈或叢集 Shell 命令列。</block>
  <block id="10818a8ad4f650a48d78d728278d4cb3" category="list-text">每個節點至少有一個 LIF 用於每個交換器 / 架構連線。最佳做法是為 FCP 、 iSCSI 或 NVMe 型傳輸協定、每個節點建立兩個以上的資料傳輸協定。</block>
  <block id="612705dd95888cdc6345d01c93c84c39" category="list-text">現在可以建立磁碟區、但讓 _ 資源存放區 _ 精靈建立磁碟區比較簡單。此規則的唯一例外是、您打算將 vVols 複寫搭配 VMware Site Recovery Manager 使用。使用現有的 FlexVol 磁碟區與現有的 SnapMirror 關係、更容易設定。請注意、不要在任何磁碟區上啟用用於 VVols 的 QoS 、因為這是由 SPBM 和 ONTAP 工具管理的。</block>
  <block id="16421df834af873175559b678c2b3cd9" category="list-text">使用從 NetApp 支援網站 下載的 OVA 部署適用於 VMware vSphere 的 ONTAP 工具。</block>
  <block id="8bdb69b5934ff84bbaafd84585965a90" category="list-text">為您的環境設定 ONTAP 工具。</block>
  <block id="dd07accb290c9c1e3900692630a70767" category="list-text">將 ONTAP 叢集新增至 _Storage Systems_ 下的 ONTAP 工具</block>
  <block id="731ce7392ae254e2050191ae92cafb14" category="list-text">雖然 ONTAP 工具和 SRA 同時支援叢集層級和 SVM 層級認證、但 VASA Provider 僅支援儲存系統的叢集層級認證。這是因為許多用於 vVols 的 API 只能在叢集層級上使用。因此、如果您打算使用 vVols 、則必須使用叢集範圍認證來新增 ONTAP 叢集。</block>
  <block id="869ce78032d85111f09ceb58bdb59a36" category="list-text">如果 ONTAP 資料生命期與 VMkernel 介面卡位於不同的子網路上、則必須將 VMkernel 介面卡子網路新增至 ONTAP 工具的「設定」功能表中的「所選子網路」清單。根據預設、 ONTAP 工具僅允許本機子網路存取、以保護您的儲存流量。</block>
  <block id="5a6d084090f063797fc6b863d2817d98" category="list-text">ONTAP 工具隨附數個預先定義的原則、這些原則可以使用或查看 <block ref="434866eb159632a70c4db034544336ef" category="inline-xref-macro-rx"></block> 以取得建立 SCP 的指引。</block>
  <block id="ef51190e4c839596248fc4173ed12a3c" category="list-text">使用 vCenter 中的 ONTAP tools_ 功能表來啟動 _Provision datastority_ 精靈。</block>
  <block id="66edaf6f622057aeadab950977c1f3e8" category="list-text">提供有意義的名稱、並選取所需的傳輸協定。您也可以提供資料存放區的說明。</block>
  <block id="d22d6de0c8f11375907a1c10d8d0f251" category="list-text">選取一個或多個要由 VVols 資料存放區支援的 SCP 。這會篩選出任何無法符合設定檔的 ONTAP 系統。從產生的清單中、選取所需的叢集和 SVM 。</block>
  <block id="6a016a18a0c20e3b805cd9b8e713fb3e" category="list-text">使用精靈為每個指定的 FlexVol 建立新的磁碟區、或選取適當的選項按鈕來使用現有的磁碟區。</block>
  <block id="2527effe721902a77755b8d628fdad93" category="list-text">從 vCenter UI 的 _Policies and Profiles_ 功能表、為每個要在資料存放區中使用的 SCP 建立 VM 原則。</block>
  <block id="642dadaf5095b4c11730dca0ffcb0d27" category="list-text">選擇「 NetApp.Cluster.Data.ONTAP.VP.VVOL 」儲存規則集。「 NetApp.Cluster.Data.ONTAP.VP.VASA10 」儲存規則集適用於對非 VVols 資料存放區的 SPBM 支援</block>
  <block id="c9565e0957e6e02cf12aef618bd30c3f" category="list-text">建立 VM 儲存原則時、您將依名稱指定儲存功能設定檔。在此步驟中、您也可以使用複寫索引標籤來設定 SnapMirror 原則比對、並使用標記索引標籤來設定標籤型比對。請注意、標記必須已建立、才能選取。</block>
  <block id="af70f7acdeed8e2a702372f9bc85d960" category="list-text">建立 VM 、在 Select Storage 下選取 VM Storage Policy 和相容的資料存放區。</block>
  <block id="3db9849d9f30bfc6e05c4e0b36d28848" category="section-title">將 VM 從傳統資料存放區移轉至 vVols</block>
  <block id="7be42b7840cc093ce6d05a247df8e63d" category="paragraph">將 VM 從傳統資料存放區移轉至 vVols 資料存放區、就像在傳統資料存放區之間移動 VM 一樣簡單。只要選取虛擬機器、然後從「動作」清單中選取「移轉」、然後選取移轉類型 _ 僅變更儲存設備 _ 即可。移轉複本作業將會隨 vSphere 6.0 及更新版本卸載、以便將 SAN VMFS 移轉至 vVols 、但不會從 NAS VMDK 移轉至 vVols 。</block>
  <block id="58f2a764a13ec89d3c5ead5343e75637" category="section-title">使用原則管理 VM</block>
  <block id="4b746813f1085683be4f71c8affea233" category="paragraph">若要利用原則型管理來自動化儲存資源配置、我們需要：</block>
  <block id="10b68fb9cbee818a044f91644423640c" category="list-text">使用儲存功能設定檔（ FlexVol ）定義儲存設備的功能（ ONTAP 節點和 Volume ）。</block>
  <block id="2e415dc7a6f21b4fd03f963858c9f680" category="list-text">建立對應至定義的 CDP 的 VM 儲存原則。</block>
  <block id="67c819108c4ef294ac28a51197046dfc" category="paragraph">NetApp 已從 VASA Provider 7.2 開始簡化功能與對應、並在更新版本中持續改善。本節著重於這種新方法。早期版本支援更多功能、並允許將其個別對應至儲存原則、但不再支援此方法。</block>
  <block id="0bd86c4955ab0bdce52b49644ce9396d" category="section-title">ONTAP 工具版本的儲存功能設定檔功能</block>
  <block id="4a6af8a6e216dcc53a63f04143c13222" category="cell">* SCP 功能 *</block>
  <block id="048424cc97a54b673c837ee7d4c19de0" category="cell">* 能力價值 *</block>
  <block id="098e77f7c5d9e0c2ad5454817edf0767" category="cell">* 支援的版本 *</block>
  <block id="28f44037af103f0c930309365629f8ef" category="cell">*附註*</block>
  <block id="d031377688b064b729a0cc60fb7fbbff" category="cell">*壓縮*</block>
  <block id="cc6aee5037bdc5b051433a266ec7d4a3" category="cell">是、否、任何</block>
  <block id="7778bddb1c205e9f74d08bd30be0aca3" category="cell">AFF 在 7.2 及更新版本中為必填項目。</block>
  <block id="221baf8ad30299306e725e4fb395bf34" category="cell">*重複資料刪除*</block>
  <block id="6868f879256c802b106616a006671848" category="cell">7.2 及更新版本的 AFF 適用的調查。</block>
  <block id="504897d4a6b59afadffd3cf9e5d3ea85" category="cell">*加密*</block>
  <block id="95fddd53c531d6efe15e3ac7ace1d9eb" category="cell">7.2 及更新版本</block>
  <block id="b3870ec121aeafa2e7ca8cb3894c0e3a" category="cell">選取 / 建立加密的 FlexVol Volume 。需要 ONTAP 授權。</block>
  <block id="e2dcc78cf70dac34550234c95443ac37" category="cell">*最大IOPS *</block>
  <block id="b78a981cc40fc4e66208bf5ee6d1a1eb" category="cell">&lt;number&gt;</block>
  <block id="130b32bc15d3fbe6d2e80ecda94135cc" category="cell">7.1 及更高版本、但差異</block>
  <block id="c0f84018aff4ff4a1cf4012a8b82e509" category="cell">在 QoS 原則群組（適用於 7.2 及更新版本）下列出。請參閱 <block ref="8fdd8868d80d04eecf1b4189862f536c" category="inline-xref-macro-rx"></block> 以取得更多資訊。</block>
  <block id="993c56850c1da5de36e798b0c5a72513" category="cell">*特性*</block>
  <block id="8485fa08bf8c556b7b2275349d11eb05" category="cell">A FF 、 FAS</block>
  <block id="c0acd03e8ba6b951b8c6dff3e95b9560" category="cell">FAS 也包含其他非 AFF 系統、例如 ONTAP Select 。AFF 包含 ASA 。</block>
  <block id="dce365633ffb688b7532470dfaf4e118" category="cell">*傳輸協定*</block>
  <block id="7cff0b96b4a6467ea880f49dd365a81f" category="cell">NFS 、 NFS 4.1 、 iSCSI 、 FCP 、 NVMe / FC 、 任何</block>
  <block id="be18de5e88c84ba55eeb5bc42cca4c0d" category="cell">7.1 及更早版本、 9.10 及更高版本</block>
  <block id="cfca0bc0c0b481555ba52be1f4e21da6" category="cell">7.2.9.8 實際上是「任何」。從 9.10 開始、 NFS 4.1 和 NVMe / FC 已新增至原始清單。</block>
  <block id="3dd301ae5682df79e8687ead5b6a3ddf" category="cell">* 空間保留（精簡配置） *</block>
  <block id="03868a080fbf4cdbc006da45e13cfad7" category="cell">薄、厚、（任何）</block>
  <block id="0a74dc1caf6ce891d5cbd3878cae2221" category="cell">除了差異、一切都是如此</block>
  <block id="4b370bcc260aa96e343bbb24d3af2cc5" category="cell">在 7.1 及更早版本中稱為精簡配置、也允許任何的值。7.2.7.2.7.2.7.2.7.2.7.2.7.所有版本預設為精簡。</block>
  <block id="40e2e283d064264dd51846580adb367d" category="cell">*分層政策*</block>
  <block id="06b815f81a7e7aceb1489e3888fb9534" category="cell">任何、無、快照、自動</block>
  <block id="00917abc35f0d57db6562a886997c4e8" category="cell">適用於 FabricPool ：需要 AFF 或 ASA 搭配 ONTAP 9.4 或更新版本。除非使用內部部署的 S3 解決方案（如 NetApp StorageGRID ）、否則建議僅使用 Snapshot 。</block>
  <block id="ffb0d092d584c15937dfacd5be3c684a" category="section-title">建立儲存功能設定檔</block>
  <block id="ad0b6bb809400347fc4806f18385015c" category="paragraph">NetApp VASA Provider 隨附數個預先定義的 SCP 。您可以使用 vCenter UI 手動建立新的 SCP 、或使用 REST API 透過自動化建立新的 SCP 。透過在新設定檔中指定功能、複製現有的設定檔、或從現有的傳統資料存放區自動產生設定檔。這是使用 ONTAP 工具下的功能表來完成的。使用 _Storage Capability Profiles_ 建立或複製設定檔、並使用 _Storage Mapping_ 自動產生設定檔。</block>
  <block id="62351556db3b0f6f13da226ca3e2df24" category="section-title">適用於 ONTAP 工具 9.10 及更新版本的儲存功能</block>
  <block id="14b49e2a6b56b1177a77be03a29dfc83" category="inline-image-macro">「適用於 ONTAP 工具 9.10 及更新版本的儲存功能」、 300</block>
  <block id="2a53cbcd07a15d9f13f0cc630c7cc44d" category="paragraph"><block ref="2a53cbcd07a15d9f13f0cc630c7cc44d" category="inline-image-macro-rx" type="image"></block></block>
  <block id="12bb128f53dfaac0a251798e4b4e6954" category="paragraph"><block ref="12bb128f53dfaac0a251798e4b4e6954" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4e6d46028a015a7f3860fc8fdf214b3c" category="paragraph"><block ref="4e6d46028a015a7f3860fc8fdf214b3c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="64ca5ade59a3a7351134cf0db3a8e06a" category="paragraph"><block ref="64ca5ade59a3a7351134cf0db3a8e06a" category="inline-image-macro-rx" type="image"></block></block>
  <block id="2c8f597441425c22b4ae09f872f8bcc4" category="paragraph"><block ref="2c8f597441425c22b4ae09f872f8bcc4" category="inline-image-macro-rx" type="image"></block></block>
  <block id="fd59d4e26c472ef1e14cadb688283604" category="paragraph"><block ref="fd59d4e26c472ef1e14cadb688283604" category="inline-image-macro-rx" type="image"></block></block>
  <block id="049b6d7b78dd8ffebadb5a0be2261637" category="paragraph">* 建立 VVols 資料存放區 *
建立必要的 SCP 之後、就可以使用它們來建立 vVols 資料存放區（也可以選用資料存放區的 FlexVol 磁碟區）。以滑鼠右鍵按一下您要建立 VVols 資料存放區的主機、叢集或資料中心、然後選取 ONTAP tools_ &gt; _Provision Datastority_ 。選取一個或多個要由資料存放區支援的 FlexVol 、然後從現有的 FlexVol Volume 和 / 或為資料存放區配置新的 Volume 中進行選取。最後、為資料存放區指定預設的 SCP 、用於未依原則指定 SCP 的 VM 、以及交換 VVols （這些不需要高效能儲存）。</block>
  <block id="a4332a81dbc3a9888be608dea640cd3d" category="section-title">建立 VM 儲存原則</block>
  <block id="b4f6f65777757af7630fae901718e51e" category="paragraph">較早的版本類似、但如所述 <block ref="68072d20e775e4558feadbec7ba8f768" category="inline-xref-macro-rx"></block>、您的選項可能有所不同。</block>
  <block id="52896487a6472798e1d6cbc9a95ec51e" category="section-title">使用 ONTAP 工具 VASA Provider 9.10 建立 VM 儲存原則</block>
  <block id="c0c5e719ad5439106e5a00588402f206" category="inline-image-macro">使用 ONTAP 工具建立 VM 儲存原則 VASA Provider 9.10"300</block>
  <block id="378e30f2a60dc28c4afc9ae4f11a39e1" category="paragraph"><block ref="378e30f2a60dc28c4afc9ae4f11a39e1" category="inline-image-macro-rx" type="image"></block></block>
  <block id="95ac22478e141fde0d2878c71530a13a" category="section-title">使用 ONTAP 工具 9.10 及更新版本進行效能管理</block>
  <block id="c153012a9aa13e8ed8ce3f3e471a70b4" category="list-text">ONTAP 工具 9.10 使用自己的平衡放置演算法、將新的 vVol 置於 vVols 資料存放區內的最佳 FlexVol Volume 中。放置方式是根據指定的 SCP 和相符的 FlexVol 磁碟區。如此可確保資料存放區和備份儲存設備符合指定的效能需求。</block>
  <block id="e65bde48b0a84fcc60d957de90c3a128" category="list-text">變更效能功能（例如最小和最大 IOPS ）需要特別注意特定組態。</block>
  <block id="c43f1c590aab42b849ee038e863a567d" category="list-text">* 可以在 SCP 中指定最小和最大 IOPS * 、並在 VM 原則中使用。</block>
  <block id="404e0fefd61512a9f144586382a62641" category="list-text">變更 SCP 中的 IOPS 不會變更 vVols 上的 QoS 、直到編輯 VM 原則、然後重新套用至使用它的 VM 為止（請參閱 <block ref="2358041c73953300d39d98366deee80d" category="inline-xref-macro-rx"></block>）。或是使用所需的 IOPS 建立新的 SCP 、並變更原則以使用它（並重新套用至 VM ）。一般而言、建議您只為不同的服務層級定義個別的 SCP 和 VM 儲存原則、並只需變更 VM 上的 VM 儲存原則即可。</block>
  <block id="0e05d638b7a9c7a5c32e6c22679eeb82" category="list-text">AFF 和 FAS 身分具有不同的 IOPs 設定。最小值和最大值均可在 AFF 上使用。不過、非 AFF 系統只能使用最大 IOPs 設定。</block>
  <block id="97659fa3c3a5aaf088f6020a38faf086" category="list-text">在某些情況下、可能需要在原則變更後移轉 vVol （手動或由 VASA Provider 和 ONTAP 自動移轉）：</block>
  <block id="81c975fc79a19102fa04ad9c49f7538b" category="list-text">有些變更不需要移轉（例如變更最大 IOPS 、可立即套用至 VM 、如上所述）。</block>
  <block id="a426b56f86a12c200f3484efb990e81f" category="list-text">如果儲存 vVol 的目前 FlexVol Volume 不支援原則變更（例如、平台不支援要求的加密或分層原則）、您將需要在 vCenter 中手動移轉 VM 。</block>
  <block id="7de504873f20af5c8ce6dadd2f79b29a" category="list-text">ONTAP 工具會使用目前支援的 ONTAP 版本來建立個別的非共用 QoS 原則。因此、每個個別的 VMDK 都會收到自己的 IOP 分配。</block>
  <block id="63a33ddbd2c3ccd2daac06020248049f" category="section-title">重新套用 VM 儲存原則</block>
  <block id="d0f5986c3378364e5cb0eda0e98fd0fd" category="inline-image-macro">「重新套用 VM 儲存原則」、 300</block>
  <block id="2a8c2026166e178134c7e19c2f4a2c15" category="paragraph"><block ref="2a8c2026166e178134c7e19c2f4a2c15" category="inline-image-macro-rx" type="image"></block></block>
  <block id="50b6e1c7f2e81842d993d8ce88acc979" category="summary">支援所有用於虛擬化的主要儲存傳輸協定、例如適用於SAN環境的iSCSI、Fibre Channel（FC）、Fibre Channel over Ethernet（FCoE）或Non-volatile Memory Express over Fibre Channel（NVMe / FC）、以及用於來賓連線的NFS（v3和v4.1）、以及SMB或S3。ONTAP客戶可以自由挑選最適合其環境的產品、並視需要在單一系統上結合各種通訊協定。</block>
  <block id="ee8cc65cae83009c275cd4748f4c58ae" category="doc">適用於VMware的虛擬化工具ONTAP</block>
  <block id="0894f8dfb7dd501a78dc2416b7b90c2a" category="paragraph">NetApp提供數種獨立式軟體工具、可搭配ONTAP 使用以管理您的虛擬化環境。</block>
  <block id="236e1a1bf6abf86968baf738af47b78c" category="paragraph">下列工具隨ONTAP 附於VMware授權中、不需額外付費。請參閱圖1、瞭解這些工具如何在vSphere環境中共同運作。</block>
  <block id="f364e3337f5237c93d7b5439c82d444b" category="paragraph">VMware vSphere的VMware vSphere工具是一套搭配vSphere使用VMware vCenter儲存設備的工具。ONTAP ONTAPvCenter外掛程式先前稱為虛擬儲存主控台（VSC）、可簡化儲存管理與效率功能、增強可用度、並降低儲存成本與營運成本、無論您使用SAN或NAS。它採用最佳實務做法來配置資料存放區、並針對NFS和區塊儲存環境最佳化ESXi主機設定。為獲得所有這些效益、NetApp建議您在ONTAP 使用vSphere搭配執行ONTAP VMware軟體的系統時、將這些VMware不完整的工具當作最佳實務做法。其中包括伺服器應用裝置、vCenter的使用者介面擴充、VASA Provider及儲存複寫介面卡。幾乎所有的功能都可以透過簡單的REST API來自動化、而大多數的現代化自動化工具都能耗用這些API ONTAP 。</block>
  <block id="0b266371a133b176a2ee883ccf72b46c" category="list-text">* vCenter UI延伸功能* ONTAP 此功能可簡化營運團隊和vCenter管理員的工作。*此功能可在vCenter UI中、直接使用易於使用的內容相關功能表來管理主機和儲存設備、資訊入口小程式和原生警示功能、以利簡化工作流程。</block>
  <block id="e08c666b5127e745f8aacbacfce37dcf" category="list-text">*適用於ONTAP VMware的VASA Provider for Sfor Sfor the。*適用於ONTAP VMware的VASA Provider支援VMware vStorage API for Storage Aware（VASA）架構。它是ONTAP VMware vSphere的VMware vSphere配套工具、可做為單一虛擬應用裝置、方便部署。VASA Provider將vCenter Server與ONTAP VMware連線、以協助資源配置及監控VM儲存設備。它可支援VMware虛擬磁碟區（vVols）、管理儲存功能設定檔和個別VM vVols效能、以及監控容量和設定檔法規遵循的警示。</block>
  <block id="1c7bb8764fc089dda8481678ad1ea0b5" category="list-text">*儲存複寫介面卡。* SRA與VMware Site Recovery Manager（SRM）搭配使用、可在正式作業與災難恢復站台之間管理資料複寫、並在不中斷營運的情況下測試DR複本。它有助於自動化探索、還原及重新保護等工作。其中包括適用於Windows SRM伺服器和SRM應用裝置的SRA伺服器應用裝置和SRA介面卡。</block>
  <block id="a1c13ec555198266776a3a7b904810dd" category="paragraph">下圖說明ONTAP vSphere的各項功能。</block>
  <block id="f7e876d450acee7c9ed7b18438440fb2" category="paragraph"><block ref="f7e876d450acee7c9ed7b18438440fb2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="dd55e255500b9ec15305dc69dfa0e15b" category="section-title">適用於VMware VAAI的NFS外掛程式</block>
  <block id="4fbfd4c228f22ff3f2841908e853d895" category="paragraph">適用於VMware VAAI的NetApp NFS外掛程式是ESXi主機的外掛程式、可讓ESXi主機在ONTAP 支援VMware的NFS資料存放區時、使用VAAI功能。它支援複製卸載、以進行複製作業、保留大型虛擬磁碟檔案的空間、以及快照卸載。將複本作業卸載到儲存設備並不一定能更快完成、但它確實能降低網路頻寬需求、並卸載CPU週期、緩衝區和佇列等主機資源。您可以使用ONTAP VMware vSphere的支援功能、在ESXi主機上安裝外掛程式、或是在支援的情況下安裝vSphere Lifecycle Manager（vLCM）。</block>
  <block id="00cdd3f66e02711548cf72d579ec0df8" category="summary">利用此功能、您可以建立可套用至多個工作的備份原則。SnapCenter這些原則可定義排程、保留、複寫及其他功能。它們持續允許選用 VM 一致的快照、利用 Hypervisor 的能力來在拍攝 VMware 快照之前、先關閉 I/O 。</block>
  <block id="f1d1eddd608fe98b6fa2bc3436ce81d0" category="doc">儲存原則型管理和 vVols</block>
  <block id="2bdce8d6813e7a3d93783119529cf146" category="paragraph">VMware vSphere API for Storage感知（VASA）可讓儲存管理員輕鬆設定具有明確定義功能的資料存放區、並讓VM管理員在需要時使用這些功能來配置VM、而不需要彼此互動。</block>
  <block id="871db14a81b3510676400538c6f07073" category="paragraph">請看一下這種方法、瞭解它如何簡化虛擬化儲存作業、並避免許多瑣碎的工作。</block>
  <block id="ad0bd815b4fb6f01acc94f160af3dca7" category="paragraph">在VASA之前、VM管理員可以定義VM儲存原則、但他們必須與儲存管理員合作、以識別適當的資料存放區、通常是使用文件或命名慣例。有了VASA、儲存管理員可以定義一系列的儲存功能、包括效能、分層、加密及複寫。一組磁碟區或一組磁碟區的功能稱為儲存功能設定檔（scp）。</block>
  <block id="44d75bdf4feecabe2de10427870ae623" category="paragraph">SCP 支援虛擬機器資料 VVols 的最低和 / 或最高 QoS 。只AFF 有在不支援的系統上才支援最低QoS。VMware vSphere的VMware vSphere工具包含儀表板、可顯示VM精細的效能、以及在VMware系統上用於vVols的邏輯容量。ONTAP ONTAP</block>
  <block id="4240fa68f6d9919e6d039c4038175025" category="paragraph">下圖說明ONTAP VMware vSphere 9.8 vVols儀表板的各項功能。</block>
  <block id="d3fcb217aa8b45eb8a95f8958c1f7746" category="paragraph"><block ref="d3fcb217aa8b45eb8a95f8958c1f7746" category="inline-image-macro-rx" type="image"></block></block>
  <block id="50e0e66922b3b12510a128829d1fdc70" category="paragraph">定義儲存功能設定檔之後、就可以使用識別其需求的儲存原則來配置VM。VM儲存原則與資料存放區儲存功能設定檔之間的對應、可讓vCenter顯示相容資料存放區清單以供選擇。這種方法稱為儲存原則型管理。</block>
  <block id="794b6e2fc393d40a552fc58975920cb0" category="paragraph">VASA提供查詢儲存設備的技術、並將一組儲存功能傳回vCenter。VASA廠商供應商會提供儲存系統API與架構之間的轉譯、以及vCenter所瞭解的VMware API。NetApp 的 VASA Provider for ONTAP 是 ONTAP 工具的一部分、適用於 VMware vSphere 應用裝置 VM 、 vCenter 外掛程式則提供介面、可配置及管理 vVol 資料存放區、並可定義儲存功能設定檔（ CDP ）。</block>
  <block id="dad160104969c39365dd2cd4c98dd300" category="inline-link">TR-4400</block>
  <block id="79f0d5feb7ec25a16c407f3f585eabb2" category="paragraph">支援VMFS和NFS vVol資料存放區。ONTAP將vVols與SAN資料存放區搭配使用、可帶來NFS的部分效益、例如VM層級的精細度。以下是一些最佳實務做法、您可以在中找到更多資訊<block ref="4f23d4db151ca74200684ac8aef53fed" category="inline-link-rx"></block>：</block>
  <block id="bd490c925219bcb312338a370589bf70" category="list-text">VVol資料存放區可由FlexVol 多個叢集節點上的多個支援功能區所組成。最簡單的方法是單一資料存放區、即使磁碟區具有不同的功能也一樣。SPBM可確保VM使用相容的Volume。然而、這些磁碟區必須全部屬於ONTAP 單一的一套功能、並使用單一傳輸協定來存取。每個節點的每個傳輸協定只需一個LIF就足夠了。避免在ONTAP 單一VVol資料存放區中使用多個版本的支援、因為儲存功能可能因版本而異。</block>
  <block id="0cc956d6da91fefae9dad9b2c8c9519b" category="list-text">使用ONTAP VMware vSphere外掛程式的VMware vCenter工具來建立及管理VVol資料存放區。除了管理資料存放區及其設定檔之外、它還會自動建立傳輸協定端點、以便在需要時存取vVols。如果使用LUN、請注意LUN PE是使用LUN ID 300以上的LUN來對應。確認 ESXi 主機進階系統設定<block ref="ce913b4e625461a33f54f9e4ac38c2d7" prefix=" " category="inline-code"></block> 允許大於 300 的 LUN ID 號碼（預設值為 1,024 ）。若要執行此步驟、請在 vCenter 中選取 ESXi 主機、然後選取「設定」索引標籤、再選取「尋找」<block ref="ce913b4e625461a33f54f9e4ac38c2d7" prefix=" " category="inline-code"></block> 在進階系統設定清單中。</block>
  <block id="fac85f355a1eb47127ef1b94e7603924" category="list-text">請勿安裝或移轉VASA Provider、vCenter Server（應用裝置或Windows）或ONTAP VMware vSphere的各種支援工具到vVols資料存放區、因為這些工具彼此相依、因此在停電或其他資料中心中斷時、您無法管理這些工具。</block>
  <block id="dd76252ea7a50def2a98f218cb1505b4" category="inline-link">知識庫文章</block>
  <block id="15ef75dd3d20b8278c16cd01a708e13e" category="list-text">定期備份VASA Provider VM。至少要為包含 VASA Provider 的傳統資料存放區建立每小時快照。如需保護及恢復VASA Provider的詳細資訊、請參閱此<block ref="9d642870dca1748c69f7aa0b6fb95a89" category="inline-link-rx"></block>。</block>
  <block id="2d2d2e356f9ab117b7d2a58d42cc5988" category="paragraph">下圖顯示vVols元件。</block>
  <block id="6aadcb77504dae1dbfed2e4d1c969158" category="paragraph"><block ref="6aadcb77504dae1dbfed2e4d1c969158" category="inline-image-macro-rx" type="image"></block></block>
  <block id="7be2e69e5d19c282db8d81c60a51c862" category="summary">本頁說明在ONTAP VMware vSphere環境中實作NetApp解決方案的最佳實務做法。</block>
  <block id="d3ba101543fc97ba1dd9272c87bf65da" category="doc">虛擬磁碟區（vVols）與儲存原則型管理（SPBM）</block>
  <block id="a42f13867ea459821488608dc4d1b7c4" category="paragraph">NetApp是VMware在開發vSphere虛擬磁碟區（vVols）方面的早期設計合作夥伴、為vVols和VMware vSphere API提供架構輸入和早期支援、以提高儲存感知（VASA）的能力。這種方法不僅將 VM 精細儲存管理帶入 VMFS 、也支援透過儲存原則型管理（ SPBM ）來自動化儲存資源配置。</block>
  <block id="ce09fc365ce48a9d89c0fdb5222c3909" category="paragraph">SPBM提供一個架構、可在虛擬化環境可用的儲存服務與透過原則配置的儲存元素之間、做為抽象層。此方法可讓儲存架構設計師設計具有不同功能的儲存資源池、讓VM管理員輕鬆使用。接著系統管理員可以根據已配置的儲存資源池來比對虛擬機器工作負載需求、以便精細控制每個VM或虛擬磁碟層級的各種設定。</block>
  <block id="2902acda09b9786460c2dd928a2d8f1a" category="paragraph">這個解決方案是VVols擴充儲存產業的領導廠商、可在單一叢集內支援數十萬個vVols、而企業陣列和小型Flash陣列廠商則支援每個陣列數千個vVols。ONTAPNetApp也透過即將推出的VVols 3.0支援功能、推動VM精細管理的演進。</block>
  <block id="fda9c21a4aefd4a1f42ad0b195e6ef0a" category="inline-link">TR-4400: VMware vSphere虛擬Volume ONTAP with VMware</block>
  <block id="69173613658292fc2adeb513b12f29ca" category="admonition">如需VMware vSphere虛擬磁碟區、SPBM及ONTAP VMware的詳細資訊、請參閱<block ref="354226c2546b1aed39f1c0c484e6a98a" category="inline-link-rx"></block>。</block>
  <block id="61823c0f572643e0ce2e4edcb74cae51" category="paragraph">使用快照快速複製 VM 或資料存放區、而不會影響效能、然後使用 SnapMirror 將其傳送至次要系統、以提供長期的異地資料保護。這種方法只儲存變更的資訊、可將儲存空間和網路頻寬減至最低。</block>
  <block id="0aef2da721f0ab14676f8d6ffb9e7e8c" category="inline-link">建議</block>
  <block id="022e604112aa3d1870f0da5e7806f48b" category="paragraph">利用此功能、您可以建立可套用至多個工作的備份原則。SnapCenter這些原則可定義排程、保留、複寫及其他功能。它們持續允許選用 VM 一致的快照、利用 Hypervisor 的能力來在拍攝 VMware 快照之前、先關閉 I/O 。不過、由於VMware快照的效能影響、除非您需要靜止客體檔案系統、否則一般不建議使用這些快照。請改用快照來提供一般保護、並使用 SnapCenter 外掛程式等應用程式工具來保護交易資料、例如 SQL Server 或 Oracle 。這些快照與 VMware （一致性）快照不同、適合長期保護。  VMware快照僅供參考<block ref="75f5ad475d959e2ecb55267e1a9a54f1" category="inline-link-rx"></block> 因效能和其他影響而短期使用。</block>
  <block id="26aae91a7d92b32a60b1fbc86c29ee81" category="paragraph">這些外掛程式提供延伸功能、可在實體和虛擬環境中保護資料庫。有了vSphere、您可以使用它們來保護SQL Server或Oracle資料庫、其中資料儲存在RDM LUN、iSCSI LUN直接連線至來賓作業系統、或VMDK或NFS資料存放區上的VMDK檔案。外掛程式可指定不同類型的資料庫備份、支援線上或離線備份、以及保護資料庫檔案和記錄檔。除了備份與還原之外、外掛程式也支援複製資料庫以供開發或測試之用。</block>
  <block id="1556ba0bf6ea4783cda0ff40e96f0265" category="paragraph">下圖說明SnapCenter 了一套功能性部署的範例。</block>
  <block id="54ee9d8cd5db70a761321f3e7d168445" category="paragraph"><block ref="54ee9d8cd5db70a761321f3e7d168445" category="inline-image-macro-rx" type="image"></block></block>
  <block id="6c1bef29e8dc34a00e17b06c221d5efe" category="paragraph">如需增強的災難恢復功能、請考慮搭配ONTAP VMware Site Recovery Manager使用NetApp SRA for VMware。除了支援將資料存放區複寫至DR站台之外、它也能透過複製複寫的資料存放區、在DR環境中進行不中斷營運的測試。SRA內建自動化功能、可在故障解決後、輕鬆從災難中恢復並重新保護正式作業。</block>
  <block id="650062685b0df8284f1b87f62fa3f9f3" category="inline-link">TR-4128</block>
  <block id="886a3fd32ec402d87ea2b090f8f701b2" category="paragraph">最後、若要獲得最高層級的資料保護、請考慮使用NetApp MetroCluster VMware vSphere Metro Storage Cluster（VMSC）組態。VMSC是VMware認證的解決方案、結合了同步複寫與陣列式叢集、提供高可用度叢集的相同優勢、但分散在不同站台、以防止站台災難發生。NetApp MetroCluster 解決方案提供具成本效益的組態、可讓您以透明的方式從任何單一儲存元件故障中恢復同步複寫、並在發生站台災難時提供單一命令恢復功能。VMSC的詳細說明請參閱<block ref="737e6eedc4568d5bb72c6a6cf1fe681a" category="inline-link-rx"></block>。</block>
  <block id="d336a329d910c32fb90337a372f596fc" category="summary">NetApp ONTAP 解決方案是VMware vSphere環境的領導級儲存解決方案、已有將近二十年的歷史、持續增加創新功能來簡化管理、同時降低成本。本文件介紹ONTAP vSphere的解決方案、包括最新的產品資訊和最佳實務做法、以簡化部署、降低風險及簡化管理。</block>
  <block id="92515b597b8c0784d6000b89ee47c5fd" category="doc">統一化儲存設備</block>
  <block id="8b02311a9d2f587eb4c447455c3df68f" category="paragraph">執行ONTAP 此軟體的系統以多種重要方式統一化。</block>
  <block id="7242358e2514a48e7044717140cacb4b" category="paragraph">這種方法原本是指在單一儲存系統上同時支援NAS和SAN傳輸協定、ONTAP 而除了在NAS中的原始優勢、它仍是SAN的領導平台。</block>
  <block id="4947dc197f31edea82b3fdab9dc68fdc" category="paragraph">儲存虛擬機器（SVM）是一種邏輯架構、可讓用戶端存取執行ONTAP 此軟體的系統。SVM可透過邏輯介面（LIF）、透過多種資料存取傳輸協定同時提供資料。SVM透過NAS傳輸協定（例如CIFS和NFS）提供檔案層級的資料存取、並透過SAN傳輸協定（例如iSCSI、FC/FCoE和NVMe）提供區塊層級的資料存取。SVM可同時為SAN和NAS用戶端獨立提供資料。</block>
  <block id="d6154a0901f9ca6bb5d8fb15c113581e" category="paragraph"><block ref="d6154a0901f9ca6bb5d8fb15c113581e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3c46d272642e0999c025f67e9de315c9" category="paragraph">在vSphere環境中、這種方法也可能代表虛擬桌面基礎架構（VDI）的統一化系統、以及虛擬伺服器基礎架構（VSI）。執行ONTAP VMware軟體的系統通常比傳統企業陣列便宜、但在同一個系統中擁有進階的儲存效率功能來處理VDI。此外、從SSD到SATA、還能統一化各種儲存媒體、並將這些媒體輕鬆延伸到雲端。ONTAP無需購買單一 Flash 陣列即可獲得效能、 SATA 陣列可用於歸檔、而獨立的系統則可用於雲端。將它們緊密連結在一起。ONTAP</block>
  <block id="e9e0f5f2c513c7138ea70b4c929d6fef" category="inline-link">儲存虛擬化</block>
  <block id="54c9439ad8fb4842a5a86c34d2401e36" category="admonition">如需有關SVM、統一化儲存設備和用戶端存取的詳細資訊、請參閱<block ref="2843f934dec816d79f9c394ad0533c28" category="inline-link-rx"></block> 在VMware的VMware®文件中心。ONTAP</block>
  <block id="400cc516a4a40acd605aef2cfd4ba4c0" category="doc">VMware Storage Distributed Resource Scheduler</block>
  <block id="6e210af5c49ef2b81c06b57f989ed5c6" category="paragraph">VMware儲存分散式資源排程器（SDR）是vSphere功能、可根據目前的I/O延遲和空間使用量、將VM放置在儲存設備上。</block>
  <block id="e7649bfbacc438bf8e20ba3564db4bdd" category="paragraph">接著、它會在資料存放區叢集中的資料存放區之間（也稱為Pod）、在不中斷營運的情況下移動VM或VMDK、並選取將VM或VMDK置於資料存放區叢集中的最佳資料存放區。資料存放區叢集是類似資料存放區的集合、從 vSphere 管理員的觀點來看、這些資料存放區會彙總成單一使用量單位。</block>
  <block id="5735cfd4d72f50fd28717ac30361b503" category="paragraph">將SDR搭配適用於ONTAP VMware vSphere的NetApp VMware版資訊工具使用時、您必須先使用外掛程式建立資料存放區、使用vCenter建立資料存放區叢集、然後將資料存放區新增至其中。建立資料存放區叢集之後、可直接從「詳細資料」頁面上的資源配置精靈、將其他資料存放區新增至資料存放區叢集。</block>
  <block id="b028cce2007c32457c41f20d2954c0c2" category="paragraph">SDR的ONTAP 其他最佳實務做法包括：</block>
  <block id="d11eff5be5178b7ba95b06270611ffc8" category="list-text">叢集中的所有資料存放區都應該使用相同類型的儲存設備（例如SAS、SATA或SSD）、無論是所有VMFS或NFS資料存放區、都具有相同的複寫和保護設定。</block>
  <block id="76db7ce67615bbc16da685df79ed0aa9" category="list-text">請考慮在預設（手動）模式下使用SDR。此方法可讓您檢閱建議、並決定是否要套用建議。請注意VMDK移轉的下列影響：</block>
  <block id="97f4ed95cb52bb29629002a25cb5039f" category="list-text">當SDR在資料存放區之間移動VMDK時、ONTAP 任何從還原複製或重複資料刪除所節省的空間都會遺失。您可以重新執行重複資料刪除、以重新獲得這些節約效益。</block>
  <block id="38f492286c3edf236c76e993ce0f0bf2" category="list-text">在 SDR 移動 VMDK 之後、 NetApp 建議在來源資料存放區重新建立快照、因為其他情況下空間會被移動的 VM 鎖定。</block>
  <block id="09a99cbc4fb85d10c7af970e79032a05" category="list-text">在同一個集合體上的資料存放區之間移動VMDK並沒有什麼好處、而且SDR無法看到可能共用該集合體的其他工作負載。</block>
  <block id="09b616c445ab7efa8240062532e526e4" category="doc">VMware vSphere 搭配 ONTAP</block>
  <block id="48e29772cebbf1133d022577e278d5c1" category="admonition">本文件取代先前發佈的技術報告 _TR-4597 ： VMware vSphere for ONTAP _</block>
  <block id="bfa7e7fc7c6bf4cc4e4c5c74b09763eb" category="paragraph">最佳實務做法是輔助其他文件、例如指南和相容性清單。這些技術是根據實驗室測試和NetApp工程師與客戶廣泛的現場經驗所開發。它們可能不是每個環境中唯一能運作的支援實務做法、但通常是最簡單的解決方案、能滿足大多數客戶的需求。</block>
  <block id="9ed4a475dd3705157a9fed8811f63ce2" category="inline-link">NetApp 互通性對照表工具</block>
  <block id="e08175c6fa64cba68719dea85ebd9d34" category="inline-link">VMware相容性指南</block>
  <block id="c7e9d53e7f1a53451fa25cb6340fbf6f" category="paragraph">本文件著重於在 vSphere 7.0 或更新版本上執行的 ONTAP （ 9.x ）最新版本中的功能。請參閱<block ref="37aa2814221d042697a27bc81e148f64" category="inline-link-rx"></block> 和<block ref="e1593898142109fc8cd8025356d3f312" category="inline-link-rx"></block> 以取得與特定版本相關的詳細資料。</block>
  <block id="74587fa4ad90f8713c0446529a3670e0" category="section-title">為何ONTAP 選擇適用於vSphere的呢？</block>
  <block id="a110ecc6d4ce7014019c560e5fedf572" category="paragraph">有許多理由讓成千上萬的客戶選擇 ONTAP 作為 vSphere 的儲存解決方案、例如支援 SAN 和 NAS 傳輸協定的統一儲存系統、使用節省空間的快照功能提供強大的資料保護功能、以及豐富的工具來協助您管理應用程式資料。使用與Hypervisor分開的儲存系統、您可以卸載許多功能、並將vSphere主機系統的投資效益最大化。這種方法不僅能確保主機資源專注於應用程式工作負載、也能避免儲存作業對應用程式造成隨機效能影響。</block>
  <block id="0f50acddbdbb9aa9712a471f2276e655" category="paragraph">搭配vSphere使用VMware是一項絕佳組合、可降低主機硬體與VMware軟體的費用。ONTAP您也可以透過一致的高效能、以較低的成本保護資料。由於虛擬化工作負載是行動工作負載、因此您可以使用Storage VMotion、在VMFS、NFS或vVols資料存放區之間移動VM、探索不同的方法、所有這些都在同一個儲存系統上。</block>
  <block id="90977175b761542615a11f2b96cc4cbd" category="paragraph">以下是客戶今日重視的關鍵因素：</block>
  <block id="442c1f0ac31c3d71b638125e0a8b51da" category="list-text">*統一化儲存設備。*執行ONTAP 此功能的系統以多種重要方式統一化。這種方法原本是指NAS和SAN兩種傳輸協定、ONTAP 而除了NAS的原始優勢之外、它仍是SAN的領導平台。在vSphere環境中、這種方法也可能代表虛擬桌面基礎架構（VDI）的統一化系統、以及虛擬伺服器基礎架構（VSI）。執行ONTAP VMware軟體的系統通常比傳統企業陣列便宜、但在同一個系統中擁有進階的儲存效率功能來處理VDI。此外、從SSD到SATA、還能統一化各種儲存媒體、並將這些媒體輕鬆延伸到雲端。ONTAP無需購買單一 Flash 陣列即可獲得效能、 SATA 陣列可用於歸檔、而獨立的系統則可用於雲端。將它們緊密連結在一起。ONTAP</block>
  <block id="0ce37df1cd9b66a2abde8244f17fc051" category="list-text">* 虛擬磁碟區和儲存原則型管理。 * NetApp 是 VMware 早期開發 vSphere 虛擬磁碟區（ VVols ）的設計合作夥伴、為 vVols 和 VMware vSphere API for Storage Aware （ VASA ）提供架構輸入和早期支援。這種方法不僅能為 VMFS 帶來精細的 VM 儲存管理、也支援透過儲存原則型管理來自動化儲存資源配置。此方法可讓儲存架構設計師設計具有不同功能的儲存資源池、讓VM管理員輕鬆使用。這個解決方案是VVol擴充儲存產業的領導廠商、可在單一叢集內支援數十萬個vVols、而企業陣列和小型Flash陣列廠商則可支援每個陣列數千個vVols。ONTAPNetApp也透過即將推出的VVols 3.0支援功能、推動精細VM管理的演進。</block>
  <block id="9eeea06a6a7f860f801343c04af5d7d2" category="list-text">* 儲存效率。 * 雖然 NetApp 是第一批為正式作業工作負載提供重複資料刪除技術的公司、但這項創新技術並不是這方面的第一項或最後一項。它從快照開始、這是一種不具效能影響的空間效率資料保護機制、搭配 FlexClone 技術、可立即製作 VM 的讀取 / 寫入複本、以供正式作業和備份使用。NetApp繼續提供內嵌功能、包括重複資料刪除、壓縮及零區塊重複資料刪除、讓昂貴的SSD發揮最大的儲存容量。最近、利用壓縮技術、將較小的I/O作業和檔案封裝到磁碟區塊中的功能更為豐富。ONTAP這些功能的結合、讓客戶看到VSI的節約效益高達5：1、VDI的節約效益高達30：1。</block>
  <block id="bb73602f3344c326a7b63c94db24362a" category="list-text">*混合雲*無論是用於內部部署的私有雲、公有雲基礎架構、或是結合兩者最佳功能的混合雲、ONTAP 均可利用此解決方案協助您打造資料架構、以簡化及最佳化資料管理。從高效能All Flash系統開始著手、然後將它們與磁碟或雲端儲存系統結合、以提供資料保護和雲端運算。您可以選擇Azure、AWS、IBM或Google雲端、以最佳化成本並避免受限。視需要運用OpenStack和Container技術的進階支援。NetApp也提供雲端型備份（SnapMirror Cloud、Cloud Backup Service VMware及Cloud Sync VMware）、以及FabricPool 適用於VMware的儲存分層與歸檔工具（VMware®）ONTAP 、協助降低營運成本、並充分運用雲端的廣泛應用。</block>
  <block id="7a61ec7965eebc0b5486cb78f096c770" category="list-text">*及更多資訊。*善用NetApp AFF Sa系列陣列的極致效能、加速虛擬化基礎架構、同時管理成本。使用橫向擴充ONTAP 的叢集、享受完全不中斷營運的體驗、從維護到升級、到儲存系統的完整更換。使用NetApp加密功能保護閒置資料、無需額外成本。透過精細的服務品質功能、確保效能符合業務服務層級。它們都是業界領先的企業資料管理軟體 ONTAP 所提供的各種功能的一部分。</block>
  <block id="6104c8ef7be4222a76596ab6a22bb422" category="doc">建議的ESXi主機和其他ONTAP 功能設定</block>
  <block id="0416d04b345b434b120840c30ddaf0a1" category="paragraph">NetApp已開發出一套ESXi主機多重路徑和HBA逾時設定、可根據ONTAP NetApp測試、以正確的方式執行功能。使用ONTAP VMware vSphere的VMware VMware vSphere的VMware VMware Infrastructure可輕鬆設定這些功能。在「摘要」儀表板中、按一下「主機系統」入口小程式中的「編輯設定」、或在vCenter中的主機上按一下滑鼠右鍵、然後瀏覽ONTAP 至「VMware工具」&gt;「設定建議值」。以下是9.8版目前建議的主機設定。</block>
  <block id="678582eb0cbbe0e063e618d230b63223" category="cell">*主機設定*</block>
  <block id="dfe49b73bd7e747701b49f9ed21ea2d6" category="cell">* NetApp推薦價值*</block>
  <block id="edceae57d92287f4f6200f94d3259cd0" category="cell">*需要重新開機*</block>
  <block id="dc3a6955a23583876d020db0f6b80d4d" category="cell">* ESXi進階組態*</block>
  <block id="73663d0d00956f0632e4ae75d811d53f" category="cell">VMFS3.HardwareAcceleratedLocking</block>
  <block id="59b1aceaef0203fdc32e11df232b16e6" category="cell">保留預設值（ 1 ）</block>
  <block id="bafd7322c6e97d25b6299b5d6fe8920b" category="cell">否</block>
  <block id="1b50110aedae4d8d2043a4eb9beb20af" category="cell">VMFS3.EnablBlockDelete</block>
  <block id="5d1b81f1885499e392018ebd7124ad37" category="inline-link-macro">VMware KB 2007427</block>
  <block id="3aca64366573d9850e0148ce2a38164c" category="cell">保留預設值（ 0 ）、但可視需要進行變更。
如需詳細資訊、請參閱 <block ref="68c2cf0ecb6a1c6abaf6e56c035d5866" category="inline-link-macro-rx"></block></block>
  <block id="316084648bbafe451240702bd19c6ee9" category="cell">VMFS3.EnableVMFS6 取消對應</block>
  <block id="befd90cd01403237f6fdf296822efbee" category="inline-link-macro">VMware vSphere API ：陣列整合（ VAAI ）</block>
  <block id="e385d2442208cc1e23ca841b1f217380" category="cell">保留預設值（ 1 ）
如需詳細資訊、請參閱 <block ref="d124e203790e5f214a195f69cd068c6d" category="inline-link-macro-rx"></block></block>
  <block id="571cc1d48c6d1ff3cf7e3a54cb035753" category="cell">* NFS 設定 *</block>
  <block id="c3b49a515dd0046685e06092642aa139" category="cell">net.TcpipHeapSize.</block>
  <block id="875f6b98e20edfecb56f9013d00987f6" category="cell">vSphere 6.0或更新版本、設定為32。
所有其他NFS組態、設定為30</block>
  <block id="93cba07454f06a4a960172bbd6e2a435" category="cell">是的</block>
  <block id="504e96cc79e7efe30a8271cea152d9d1" category="cell">net.TcpipHeapMax</block>
  <block id="a8af33a99dd728969fd947da27a2f69f" category="cell">大多數vSphere 6.x版本的設定為512MB。
若為6.5U3、6.7U3及7.0或更新版本、則設為1024MB。</block>
  <block id="5f1e7b6431061565550e292d05c73588" category="cell">NFS.MaxVolumes</block>
  <block id="e787d5b0d643685421632a1af3914963" category="cell">vSphere 6.0 或更新版本、設定為 256
所有其他 NFS 組態、設為 64 。</block>
  <block id="3058676a1cf088aa4a73312ac36f2a58" category="cell">NFS41.MaxVolumes</block>
  <block id="62c07f94c64184ee5d530e4c0917093f" category="cell">vSphere 6.0 或更新版本、設定為 256 。</block>
  <block id="e18600af98c17fae10fdba0dc89979ed" category="cell">NFS.MaxQuesteepeth1^</block>
  <block id="be7707fa525d0124489c9fe3072f78de" category="cell">vSphere 6.0或更新版本、設定為128</block>
  <block id="18e1fb6924459470760771b20ab0c379" category="cell">NFS.HeartbeatMaxFailures</block>
  <block id="138989cbe5dd3a4997662e0f65c17878" category="cell">所有NFS組態皆設為10</block>
  <block id="1aa26eb281359ba3b9a9a4b83a09ed46" category="cell">NFS.Heartbeat頻率</block>
  <block id="7ea6e8664542e3beb1aea10425efb4db" category="cell">針對所有 NFS 組態設定為 12</block>
  <block id="eb4182715f8cde98563dc59ea36461d3" category="cell">NFS.Heartbeattimeout</block>
  <block id="45aa5481fa55802a29a96aefd2f5dab1" category="cell">針對所有 NFS 組態設定為 5 。</block>
  <block id="54a08b15243d9078d3b5a47f8242da6f" category="cell">SUNPC。MaxConnPerIP</block>
  <block id="9a9ccbecb3f315797ff8e709d85a0e18" category="cell">vSphere 7.0 或更新版本、設定為 128 。</block>
  <block id="c0b3fd5512c2093847f753f398290f30" category="cell">* FC/FCoE設定*</block>
  <block id="2e556ad678160413b32dcca55c7d1f5f" category="cell">路徑選擇原則</block>
  <block id="fb62337a3ef32f4701b639339a4ceb33" category="cell">使用具有ALUA的FC路徑時、設定為RR（循環配置資源）。所有其他組態皆設為「固定」。
將此值設為RR有助於在所有主動/最佳化路徑之間提供負載平衡。
固定值適用於舊版非ALUA組態、有助於防止Proxy I/O換句話說、它有助於在Data ONTAP 以7-Mode運作的環境中、讓I/O不再移至高可用度（HA）配對的其他節點</block>
  <block id="117704664d6cada78ac3107380f63d23" category="cell">disk.QFullSampleSize.</block>
  <block id="0e82e1f81de2159b0e9bee0b7be00dc9" category="cell">所有組態皆設為32。
設定此值有助於避免I/O錯誤。</block>
  <block id="f66a3c183f0e736240b77f8b755c880e" category="cell">disk.QFullThreshold</block>
  <block id="bdd8c1d08eabb5e1923ed8f0c4b10ba4" category="cell">所有組態均設為8。
設定此值有助於避免I/O錯誤。</block>
  <block id="19c08de7404551288e1274186e039ef4" category="cell">Emulex FC HBA逾時</block>
  <block id="b4dbfc2d52627e923cbb563a31ff756d" category="cell">使用預設值。</block>
  <block id="d46cddda4da7ec11f17472d11df95b68" category="cell">QLogic FC HBA逾時</block>
  <block id="19b5aaf3e2cb86809996ca63a2a416b0" category="cell">* iSCSI設定*</block>
  <block id="2aa077454308383f1e82025427cd7362" category="cell">所有iSCSI路徑均設為RR（循環配置資源）。
將此值設為RR有助於在所有主動/最佳化路徑之間提供負載平衡。</block>
  <block id="0340eb1bcbfc6cd3c62b8a878d8d643b" category="cell">所有組態皆設為32。
設定此值有助於避免I/O錯誤</block>
  <block id="891c10448731ad57490b9a932dabfff8" category="inline-link-macro">VMware KB 86331</block>
  <block id="2c572e3c397fe100b075a09359c9cc23" category="admonition">1 -使用VMware vSphere ESXi 7.0.1和VMware vSphere ESXi 7.0.2時、NFS進階組態選項MaxQuesteDepth可能無法如預期運作。請參閱 <block ref="861055760f3cd527823fd34a49459992" category="inline-link-macro-rx"></block> 以取得更多資訊。</block>
  <block id="fb55ee99c04280ac638757869929785d" category="paragraph">建立完等量磁碟區和LUN時、也會指定特定的預設設定：ONTAP ONTAP FlexVol</block>
  <block id="3f7502a5f109d7a73706aba1c0741a4b" category="cell">*《*》工具* ONTAP</block>
  <block id="485577e97e8efcd504fc8e8b13e613f1" category="cell">*預設設定*</block>
  <block id="5938fe448c8661febcef3f4e779e3adb" category="cell">Snapshot保留（-%快照空間）</block>
  <block id="cfcd208495d565ef66e7dff9f98764da" category="cell">0%</block>
  <block id="7218aec62575561a6de1cae8d5658390" category="cell">部分保留（-分數保留）</block>
  <block id="3a7e09ff0fa38663ffe6d91324ea75d9" category="cell">存取時間更新（-atime-update）</block>
  <block id="f8320b26d30ab433c5a54546d21f414c" category="cell">錯</block>
  <block id="e93200d5b0d16915bf04236790544b2f" category="cell">最小預先讀取（-min-readahead）</block>
  <block id="c877d89702fdd14e51b02028a20c7d07" category="cell">排程快照</block>
  <block id="fd18465573ec21a6218982055981f6b1" category="cell">儲存效率</block>
  <block id="00d23a76e43b46dae9ec7aa9dcbebb32" category="cell">已啟用</block>
  <block id="f65fd63b63c9e9f25bf6bc141e83de34" category="cell">Volume保證</block>
  <block id="c2410aebdf425dabcc65e546e506b03e" category="cell">無（精簡配置）</block>
  <block id="f97c03bf3e9580446d70d479f5aad1e0" category="cell">Volume自動調整大小</block>
  <block id="d89f4f8b1d7c18847b88b46142f61535" category="cell">大幅縮減</block>
  <block id="ace72ec54e17777d27eb8bdb9d57e782" category="cell">LUN空間保留</block>
  <block id="b9f5c797ebbf55adccdd8539a65a0241" category="cell">已停用</block>
  <block id="514aa7792a71ab4ab677eb2385131aae" category="cell">LUN空間配置</block>
  <block id="dbe1e98b00264bd496095ed5c95f9350" category="section-title">效能的多重路徑設定</block>
  <block id="de9f44b08eec22d6b405acff2c925d56" category="paragraph">雖然目前未由可用的 ONTAP 工具進行設定、 NetApp 仍會建議下列組態選項：</block>
  <block id="840731ae1cb9e4b23e19f645ab018b6f" category="inline-link">2069356</block>
  <block id="5073fc9da327263a7db04fd449991e6a" category="list-text">在高效能環境中或使用單一LUN資料存放區測試效能時、請考慮將循環配置資源（VMW_PSP_RR）路徑選擇原則（PSP）的負載平衡設定、從預設的IOPS設定1000變更為1。請參閱VMware KB<block ref="f3f4762788a6845119bdb5b9c9179bda" category="inline-link-rx"></block> 以取得更多資訊。</block>
  <block id="1ea3eb55b985cf75e100607ee8bd935d" category="inline-link">路徑選取外掛程式和原則</block>
  <block id="249afbf456bd04d574e8d362d5bf133c" category="list-text">在vSphere 6.7 Update 1中、VMware為Round Robin PSP引進新的延遲負載平衡機制。新選項會在選取I/O最佳路徑時、考量I/O頻寬和路徑延遲在具有非等效路徑連線的環境中使用IT、例如某個路徑上的網路躍點比另一個路徑多、或是使用NetApp All SAN Array系統時、您可能會受益匪淺。請參閱<block ref="f5ecc69f2970e2e9c8638ad278ec38f7" category="inline-link-rx"></block> 以取得更多資訊。</block>
  <block id="01d954fb2edbf283d121f0651b04de83" category="section-title">其他文件</block>
  <block id="40db5019ed68654f4eb2cf21ec5021db" category="inline-link">搭配 ONTAP 使用 VMware vSphere 7.x</block>
  <block id="30d85838b9488ee908d075559c8978cd" category="inline-link">搭配 ONTAP 使用 VMware vSphere 8.x</block>
  <block id="000c9205416c1ea85f6841a7ca379c17" category="inline-link">如需更多詳細資料、請參閱適用於 ESXi 7.x with ONTAP 的 NVMe 主機組態</block>
  <block id="5a27e6dbe6279e323aec51d205b2b455" category="inline-link">如需更多詳細資料、請參閱適用於 ESXi 8.x 與 ONTAP 的 NVMe 主機組態</block>
  <block id="842acd8b4932f6c9329df8e0fefe8b9b" category="paragraph">對於帶有 vSphere 7 的 FCP 和 iSCSI 、詳細資料請參閱<block ref="f3eae508de4d3c1748a9c65337197b21" category="inline-link-rx"></block>
對於帶有 vSphere 8 的 FCP 和 iSCSI 、詳細資料請參閱<block ref="3f8db75ee0177b85df9cdf31ddb51abe" category="inline-link-rx"></block>
如需使用 vSphere 7 的 NVMe 、請參閱<block ref="6c040a6e611e78bb9d0ad92946e613ea" category="inline-link-rx"></block>
如需使用 vSphere 8 的 NVMe 、請參閱<block ref="030788e4c7bbe3137759b534ea62d7d9" category="inline-link-rx"></block></block>
  <block id="99a66df20e19a8e18fae37a7f714750a" category="doc">虛擬機器與資料存放區複製</block>
  <block id="fe12a277656562082ad50b980c227a84" category="paragraph">在vSphere中、您可以複製VM、虛擬磁碟、vVol或資料存放區。複製之後、通常可透過自動化程序、進一步自訂物件。vSphere同時支援完整複本複本複本複本、以及連結的複本、可在其中分別追蹤原始物件的變更。</block>
  <block id="883a97a36ab0c59ec785b03161a1cc32" category="paragraph">連結的複本非常適合用來節省空間、但會增加vSphere處理VM的I/O量、進而影響該VM的效能、甚至可能影響整個主機的效能。這就是 NetApp 客戶經常使用儲存系統型複本來充分發揮兩者優勢的原因：有效使用儲存設備並提高效能。</block>
  <block id="17e1a153b5d05c5a642c93ba9ce3c6de" category="paragraph">下圖說明ONTAP 了還原複製。</block>
  <block id="8ee3cd3dba25fb32f1bc38cb528ac998" category="paragraph"><block ref="8ee3cd3dba25fb32f1bc38cb528ac998" category="inline-image-macro-rx" type="image"></block></block>
  <block id="76ee7355875ad5e9f56186ff7da961f6" category="paragraph">複製可ONTAP 透過多種機制卸載至執行支援軟體的系統、通常是VM、vVol或資料存放區層級。其中包括：</block>
  <block id="d957242cd67db8ffccec78d93c14449d" category="list-text">VVols使用NetApp vSphere API for Storage Aware（VASA）Provider。  ONTAP 複本可用於支援 vCenter 管理的 vVol 快照、這些快照的空間效率極低、而且 I/O 效果極低、可用來建立和刪除這些快照。  也可以使用vCenter複製VM、這些VM也會卸載到ONTAP VMware、無論是在單一資料存放區/ Volume內、或是在資料存放區/磁碟區之間。</block>
  <block id="059e5a6b7f963e9876ba0129dc1b667d" category="list-text">使用vSphere API進行vSphere複製與移轉–陣列整合（VAAI）。VM複製作業可在ONTAP SAN和NAS環境中卸載至VMware（NetApp提供ESXi外掛程式來啟用VAAI for NFS）。  vSphere僅卸載NAS資料存放區中的冷（關機）VM作業、而熱VM（複製與儲存vMotion）上的作業也會卸載用於SAN。根據來源、目的地及安裝的產品授權、使用最有效率的方法。ONTAPVMware Horizon View也會使用此功能。</block>
  <block id="a603c207c7b5801942ff108502676c12" category="list-text">SRA（與VMware Site Recovery Manager搭配使用）。在此、複本可用來在不中斷營運的情況下測試災難恢復複本的還原。</block>
  <block id="bb300d356d258c084dbe5da2ca367e08" category="list-text">使用SnapCenter NetApp工具（如VMware）進行備份與恢復。VM複製可用來驗證備份作業、以及掛載VM備份、以便複製個別檔案。</block>
  <block id="524b5b8bc03312baeafbea86df667c4b" category="paragraph">VMware、NetApp及協力廠商工具可叫用不需載入的複製。ONTAP卸載至ONTAP 不完整的複本有多項優點。在大多數情況下、它們都能節省空間、只需要儲存設備來變更物件；讀取和寫入時不會產生額外的效能影響、在某些情況下、透過在高速快取中共用區塊來改善效能。此外、也會從ESXi伺服器卸載CPU週期和網路I/O。使用FlexClone授權、在傳統資料存放區內使用FlexVol 實體磁碟區的複本卸載作業既快速又有效率、但FlexVol 在各個實體磁碟區之間的複本可能會較慢。如果您將VM範本保留為複製來源、請考慮將其放在資料存放區磁碟區內（使用資料夾或內容程式庫來組織它們）、以獲得快速且具空間效益的複本。</block>
  <block id="f3968368501d882b3969da59138db6e2" category="paragraph">您也可以直接複製ONTAP 實體內部的磁碟區或LUN、以複製資料存放區。有了NFS資料存放區、FlexClone技術就能複製整個Volume、而且可從ONTAP VMware匯出該實體複本、並由ESXi作為另一個資料存放區來掛載。對於VMFS資料存放區、ONTAP VMware可以複製一個或整個Volume內的LUN、包括其中的一個或多個LUN。包含VMFS的LUN必須對應至ESXi啟動器群組（igroup）、然後由ESXi重新簽名、才能掛載並作為一般資料存放區使用。在某些臨時使用案例中、可以掛載複製的VMFS、而無需重新簽名。複製資料存放區之後、就可以登錄、重新設定及自訂其中的VM、就像是個別複製的VM一樣。</block>
  <block id="2d506b6088a383ccf08479b0f80c0ff4" category="paragraph">在某些情況下、您可以使用額外的授權功能來強化複製功能、例如SnapRestore 針對備份或FlexClone的功能。這些授權通常包含在授權套裝組合中、不需額外付費。vVol 複製作業需要 FlexClone 授權、也必須支援 vVol 的託管快照（從 Hypervisor 卸載至 ONTAP ）。FlexClone授權也能在資料存放區/磁碟區內使用時、改善特定的VAAI型複本（建立即時、節省空間的複本、而非區塊複本）。  SRA也會在測試災難恢復複本的恢復時使用此複本、SnapCenter 而使用此複本來執行複製作業、並瀏覽備份複本來還原個別檔案。</block>
  <block id="5dd57c2a315d3af44c2eb40eefc47111" category="doc">網路組態</block>
  <block id="66507f357c74ee12194270cfe053b98d" category="paragraph">以下是幾點需要考量的事項：</block>
  <block id="7c4904daaa282388097ad83bf382e1a5" category="list-text">如果您的網路需要並支援巨型框架、尤其是使用iSCSI時、可以使用巨型框架。如果使用、請確定在儲存設備和ESXi主機之間的路徑中、所有網路裝置、VLAN等上的設定都相同。否則、您可能會看到效能或連線問題。MTU也必須在ESXi虛擬交換器、VMkernel連接埠、以及每ONTAP 個節點的實體連接埠或介面群組上設定相同。</block>
  <block id="8b6e7f43d1d697e8f99164f0aa2ab1b6" category="inline-link">TR-4182</block>
  <block id="3745abd352adaa2cdec42c798060eef6" category="list-text">NetApp僅建議停用ONTAP 叢集內叢集網路連接埠上的網路流量控制。對於用於資料流量的其餘網路連接埠、NetApp並未提出其他最佳實務做法建議。您應視需要啟用或停用。請參閱<block ref="bdfb81665a0ef86d871a52c0e6ebc591" category="inline-link-rx"></block> 以取得流程控制的更多背景資訊。</block>
  <block id="730a8287f758961d602b1b050bbe2751" category="list-text">當ESXi和ONTAP VMware ESXi儲存陣列連接至乙太網路儲存網路時、NetApp建議將這些系統連接的乙太網路連接埠設定為快速擴充樹狀傳輸協定（RSTP）邊緣連接埠、或使用Cisco PortFast功能。NetApp建議在使用Cisco PortFast功能的環境中、啟用跨距樹狀結構PortFast主幹功能、並在ESXi伺服器或ONTAP VMware®儲存陣列上啟用802.1Q VLAN主幹連線。</block>
  <block id="ac4976538e1fc8726f77afc202561afc" category="list-text">NetApp建議下列連結集合最佳實務做法：</block>
  <block id="301c77ecc6cdfa6ebde6c8164cffae0c" category="list-text">使用交換器、在兩個不同的交換器機箱上支援連接埠的連結集合、使用多機箱連結集合群組方法、例如 Cisco 的 Virtual PortChannel （ VPC ）。</block>
  <block id="19d137845c7f6687c99b386dfad0aa97" category="list-text">除非您使用已設定LACP的DVSwitches 5.1或更新版本、否則請停用連接至ESXi的交換器連接埠LACP。</block>
  <block id="30254a2bb3e4b3b958b06d08c724e7db" category="list-text">使用LACP建立鏈路集合體、以動態ONTAP 多重模式介面群組搭配IP雜湊、以利支援靜態儲存系統。</block>
  <block id="d608421cceb8e4c584a2a32d9127879e" category="list-text">在ESXi上使用IP雜湊群組原則。</block>
  <block id="2432030fc6183a1a6c52cf5e93f3e9ae" category="paragraph">下表提供網路組態項目的摘要、並指出套用設定的位置。</block>
  <block id="7d74f3b92b19da5e606d737d339a9679" category="cell">項目</block>
  <block id="1aa66ef3a8e34a7a538960a80d2e1e31" category="cell">ESXi</block>
  <block id="bbc155fb2b111bf61c4f5ff892915e6b" category="cell">交換器</block>
  <block id="6c3a6944a808a7c0bbb6788dbec54a9f" category="cell">節點</block>
  <block id="0b7e67b6cdcf0432b624d53588d520fb" category="cell">SVM</block>
  <block id="75ba8d70e3692ba200f0e0df37b4d2ae" category="cell">IP 位址</block>
  <block id="ee6c0f25c2881cc69947a2ef23be5b8c" category="cell">VMkernel</block>
  <block id="e11f298a5bd5344d2d975b5157c27b69" category="cell">否*</block>
  <block id="d6f0876f76c273b8962b749c36153157" category="cell">連結集合體</block>
  <block id="fabd320b3b2249377e53e93099e27657" category="cell">虛擬交換器</block>
  <block id="b1b40427c8eb8d0a083ddb16e250325b" category="cell">否*</block>
  <block id="9881f82f0dd89588831f9d1682bd5492" category="cell">VLAN</block>
  <block id="5fc0d231160fa9650ea5c877f146bbe6" category="cell">VMkernel和VM連接埠群組</block>
  <block id="39a3e05f380e583ae2887c79c7443f11" category="cell">流程控制</block>
  <block id="220071ab44b426f80ef21f1c552c363c" category="cell">NIC</block>
  <block id="6f2c08412f489e52a17a30217f50b3c1" category="cell">跨距樹狀結構</block>
  <block id="4b1c0df98ba3f3d1681c3c3dbdc97746" category="cell">MTU（用於巨型框架）</block>
  <block id="7d6feaf896df4a937157d4ee5b91f4e1" category="cell">虛擬交換器與VMkernel連接埠（9000）</block>
  <block id="0110e50bd8629573701e73a4ba8b056f" category="cell">是（設為上限）</block>
  <block id="061ff5255adf00e4ae68469f43a7bf55" category="cell">有（9000）</block>
  <block id="bcc0e5a3e08cd34e80692195d056b06d" category="cell">容錯移轉群組</block>
  <block id="a4d1a66a448e327c12d3e287098a31d5" category="cell">是（建立）</block>
  <block id="465d5674eb6808b997037470f4dace73" category="cell">是（選取）</block>
  <block id="ba78d695573c8d4f1205452c675fa539" category="paragraph">* SVM lifs連接到具有VLAN、MTU及其他設定的連接埠、介面群組或VLAN介面。不過、這些設定不會在SVM層級進行管理。</block>
  <block id="50ecdab93bf5a2f1bfb4cd8f81b9bd3d" category="paragraph">這些裝置擁有自己的IP位址進行管理、但這些位址並未用於ESXi儲存網路環境。</block>
  <block id="efd0bde36323238fec688b9cdf0c75a3" category="section-title">SAN（FC、FCoE、NVMe/FC、iSCSI）、RDM</block>
  <block id="29cdd488736a6111699f7348320bbed7" category="paragraph">在vSphere中、有三種使用區塊儲存LUN的方法：</block>
  <block id="8982d243303f9d1a8c2470b7d55278e6" category="list-text">使用VMFS資料存放區</block>
  <block id="9a0098c8c1be287e8d1da1aaf3bd2e59" category="list-text">使用原始裝置對應（RDM）</block>
  <block id="93e209176746ac6f25c618631a02643b" category="list-text">由軟體啟動器從VM客體作業系統存取及控制的LUN</block>
  <block id="c25dc676ca39a05ee6067ac9a50dbce0" category="paragraph">VMFS是高效能的叢集式檔案系統、可提供共用儲存資源池的資料存放區。VMFS資料存放區可設定LUN、使用NVMe / FC傳輸協定存取的FC、iSCSI、FCoE或NVMe命名空間來存取。VMFS可讓叢集中的每個ESX伺服器同時存取傳統LUN。支援的最大LUN大小通常為16TB；因此、使用四個16TB LUN（所有SAN陣列系統支援的最大VMFS LUN大小為64TB）、即可建立最大大小為64TB的VMFS 5資料存放區（請參閱本節的第一個表格）ONTAP 。由於VMware不具備小型的個別佇列深度、所以在VMware中、VMFS資料存放區的擴充程度比傳統陣列架構的擴充程度更高、而且相對簡單。ONTAP ONTAP</block>
  <block id="43f67f108e50dab0978a343603cbfec9" category="paragraph">vSphere內建多個儲存裝置路徑的支援功能、稱為原生多重路徑（NMP）。NMP可偵測支援儲存系統的儲存類型、並自動設定NMP堆疊以支援使用中儲存系統的功能。</block>
  <block id="6bf646772584de04f877d166e564b5ff" category="paragraph">NMP和NetApp ONTAP 的支援非對稱邏輯單元存取（ALUA）、可協調最佳化和非最佳化的路徑。在本功能中、ALUA最佳化路徑會使用主控所存取LUN的節點上的目標連接埠、遵循直接資料路徑。ONTAP預設會在vSphere和ONTAP VMware中同時開啟ALUA。NMP 將 ONTAP 叢集識別為 ALUA 、並使用 ALUA 儲存陣列類型外掛程式 <block ref="d4f7bd3bf4872a2f8cd0cbe400fb23d0" prefix="(" category="inline-code"></block>）並選取循環路徑選擇外掛程式 <block ref="4646bb781f9a95f64c182af129e43c7c" prefix="(" category="inline-code"></block>）。</block>
  <block id="b284ee628d89c3e804c4def2a90f0520" category="paragraph">ESXi 6最多可支援256個LUN、並可支援多達1、024條通往LUN的總路徑。ESXi不會看到任何超出這些限制的LUN或路徑。假設LUN數量上限、則路徑限制允許每個LUN有四個路徑。在更大ONTAP 的實體叢集中、可以在LUN限制之前達到路徑限制。為了解決此限制、ONTAP 支援8.3版及更新版本中的選擇性LUN對應（SLM),</block>
  <block id="8466b1e5abb4751e931c5feb1af4e469" category="inline-link">TR-4080</block>
  <block id="e9e7de5d01d51034d9114fd8f16c9144" category="paragraph">對於向指定LUN通告路徑的節點、SLM會有限制。NetApp最佳實務做法是每個SVM每個節點至少有一個LIF、並使用SLM來限制通告給裝載LUN及其HA合作夥伴之節點的路徑。雖然存在其他路徑、但預設不會通告這些路徑。您可以使用新增和移除在SLMs中的報告節點引數來修改通告的路徑。請注意、在8.3之前的版本中建立的LUN會通告所有路徑、而且必須加以修改、才能只向主機HA配對通告路徑。如需更多關於SLM,請參閱第5.9節<block ref="c6b12416d518b4689065ffe16afe88db" category="inline-link-rx"></block>。先前的連接埠集方法也可用於進一步減少LUN的可用路徑。PortSets可減少igroup中的啟動器可透過哪些可見路徑來查看LUN、進而提供協助。</block>
  <block id="4157f0c23fc104508f492dc846f187f3" category="list-text">根據預設、會啟用SLM.除非您使用連接埠集、否則不需要額外的組態。</block>
  <block id="597f1433ad810b3b86c7ae0f8f95afa8" category="list-text">對於在 Data ONTAP 8.3 之前建立的 LUN 、請執行手動套用 SLM<block ref="886fd385b633a0746a8a08f8f00c67cd" prefix=" " category="inline-code"></block> 用於移除 LUN 報告節點、並限制 LUN 存取 LUN 所屬節點及其 HA 合作夥伴的命令。</block>
  <block id="43919b4d4d6d446ed498e26bff62db84" category="paragraph">區塊傳輸協定（iSCSI、FC和FCoE）使用LUN ID和序號以及唯一名稱來存取LUN。FC和FCoE使用全球名稱（WWNN和WWPN）、iSCSI則使用iSCSI合格名稱（IQN）。儲存設備內部的LUN路徑對區塊傳輸協定毫無意義、而且不會出現在傳輸協定的任何位置。因此、只包含LUN的磁碟區根本不需要內部掛載、而包含資料存放區所用LUN的磁碟區則不需要使用交會路徑。NVMe子系統ONTAP 的運作方式類似。</block>
  <block id="ed0e76ed86e852bd7317a09d856ec4e8" category="paragraph">其他應考慮的最佳實務做法：</block>
  <block id="93586ad57931e0f16fff61cdba9d77df" category="list-text">請確定ONTAP 已為叢集中每個節點上的每個SVM建立邏輯介面（LIF）、以達到最大可用度和行動性。最佳實務做法是每個節點使用兩個實體連接埠和LIF、每個光纖使用一個連接埠。ONTAPALUA可用來剖析路徑、識別作用中最佳化（直接）路徑、以及作用中未最佳化路徑。ALUA用於FC、FCoE和iSCSI。</block>
  <block id="b3cebb7381bddbabb1e950a46d264190" category="list-text">對於iSCSI網路、當存在多個虛擬交換器時、請在不同的網路子網路上使用多個VMkernel網路介面搭配NIC群組。您也可以使用多個實體NIC來連接至多個實體交換器、以提供HA並提高處理量。下圖提供多重路徑連線的範例。在靜態中ONTAP 、設定單一模式介面群組以容錯移轉兩個或多個連結連接至兩個或多個交換器、或使用LACP或其他連結集合技術搭配多重模式介面群組、以提供HA及連結集合的優點。</block>
  <block id="2968b9f3c141bf23bc73d0e6e15a174a" category="list-text">如果 ESXi 中使用挑戰握手驗證傳輸協定（ CHAP ）進行目標驗證、則也必須使用 CLI 在 ONTAP 中進行設定 <block ref="199c9b970eacf1c35d84a383b7ceb210" prefix="(" category="inline-code"></block>）或使用 System Manager （在 Storage （儲存） &gt; SVM （ SVM ） &gt; SVM Settings （ SVM 設定） &gt; Protocols （傳輸協定） &gt; iSCSI （ iSCSI ）下編輯啟動器安全性）。</block>
  <block id="d31f2e075df4ca75ca0874fa08f74b12" category="list-text">使用VMware vSphere的VMware vCenter工具來建立及管理LUN和群組。ONTAP外掛程式會自動決定伺服器的WWPN、並建立適當的igroup。它也會根據最佳實務做法來設定LUN、並將其對應至正確的igroup。</block>
  <block id="de78559e8aed2cd62fbf852f73dc58c2" category="inline-link">實體與虛擬相容模式</block>
  <block id="905221150fdd103b5241870a0a1f2c42" category="list-text">請謹慎使用 RDM 、因為它們可能較難管理、而且也會使用路徑、而路徑的限制如前所述。支援這兩種LUN ONTAP<block ref="27e1f8e5a88cfbb2836b083145b004c9" category="inline-link-rx"></block> RDM。</block>
  <block id="636da39a2033c6179a718983c5ce1222" category="inline-link">NVMe / FC主機組態指南ONTAP</block>
  <block id="81ef6507a13da5635951bc5b533deb59" category="inline-link">TR-4684</block>
  <block id="15483b0826bb9a4b11d1c89af2029c5c" category="list-text">如需更多關於將NVMe/FC搭配vSphere 7.0使用的資訊、請參閱此<block ref="6b4ed262d14e47ef641cd57b65c32c38" category="inline-link-rx"></block> 和<block ref="7a29b2f31035a451d5b068728d2b79a7" category="inline-link-rx"></block>下圖說明從vSphere主機到ONTAP VMware LUN的多重路徑連線能力。</block>
  <block id="f9fd9ea22ea7a2e8ec9e95254a449831" category="paragraph"><block ref="f9fd9ea22ea7a2e8ec9e95254a449831" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f2a693e1f056b96566c4551fcab418f2" category="paragraph">vSphere可讓客戶使用企業級NFS陣列、同時存取ESXi叢集中所有節點的資料存放區。如資料存放區一節所述、在使用NFS搭配vSphere時、會有一些易於使用和儲存效率可見度的優點。</block>
  <block id="743fa5a7bc7d4ba215b096e34779d298" category="paragraph">搭配ONTAP vSphere使用VMware NFS時、建議採用下列最佳實務做法：</block>
  <block id="c05061b6d3055b83136fa96cb38f0f9a" category="list-text">在叢集中的每個節點上、為每個SVM使用單一邏輯介面（LIF）ONTAP 。不再需要過去針對每個資料存放區的LIF建議。雖然直接存取（同一個節點上的 LIF 和資料存放區）是最佳的選擇、但別擔心間接存取、因為效能影響通常很小（微秒）。</block>
  <block id="7b997b3be9c993d49799dd9d71d8c3f6" category="list-text">VMware自VMware Infrastructure 3以來就一直支援NFSv3。vSphere 6.0新增對NFSv4.1的支援、可啟用某些進階功能、例如Kerberos安全性。NFSv3使用用戶端鎖定功能時、NFSv4.1會使用伺服器端鎖定功能。雖然可以透過這兩種傳輸協定匯出一個資料區、但ESXi只能透過一個傳輸協定掛載。ONTAP此單一傳輸協定掛載並不排除其他ESXi主機透過不同版本掛載相同的資料存放區。請務必指定要在掛載時使用的傳輸協定版本、以便所有主機使用相同版本、因此鎖定樣式相同。請勿在主機之間混合使用NFS版本。如有可能、請使用主機設定檔檢查是否符合規定。</block>
  <block id="ae4c5baa79e370d8f601cc7082f8123e" category="list-text">由於NFSv3與NFSv4.1之間沒有自動資料存放區轉換、因此請建立新的NFSv4.1資料存放區、並使用Storage VMotion將VM移轉至新的資料存放區。</block>
  <block id="8065bff4940ae8d7161f926b0df47ac4" category="inline-link">NetApp互通性對照表工具</block>
  <block id="1479ddf58c038ab7d220ff734c74deaf" category="list-text">請參閱中的NFS v4.1互通性表附註<block ref="8813559f5b95abb5411182be29200aff" category="inline-link-rx"></block> 支援所需的特定ESXi修補程式層級。</block>
  <block id="24aaa4a688e881fa13d31656a85d40a9" category="list-text">NFS匯出原則用於控制vSphere主機的存取。您可以將一個原則與多個磁碟區（資料存放區）搭配使用。使用NFSv3時、ESXi會使用sys（UNIX）安全樣式、並需要root掛載選項來執行VM。在現階段、此選項稱為超級使用者、使用超級使用者選項時、不需要指定匿名使用者ID。ONTAP請注意、匯出具有不同值的原則規則<block ref="ea72d12ecaa06afdb0c8a3b15e485e95" prefix=" " category="inline-code"></block> 和<block ref="df809a941c1287d18c08bb5927b639dc" prefix=" " category="inline-code"></block> 可能會導致SVM發現ONTAP 問題、因為使用這些功能。以下是範例原則：</block>
  <block id="69abbd5c7cd9c1b3828b9aa5a894ff47" category="list-text">用戶端配對規格：192．168．42．21</block>
  <block id="bd6cc42f9cd65cca72cbd56d2f4bf43d" category="list-text">RO存取規則：系統</block>
  <block id="581c470a5099548fc9865a4bab8761f8" category="list-text">RW 存取規則</block>
  <block id="0bbc71e6a4ea49af70dd616d3807e524" category="list-text">匿名 UID</block>
  <block id="59d5d8c898df18115bd4ced36c6bc0de" category="list-text">超級使用者：sys</block>
  <block id="6670a317619282ec228a9ef492af0a76" category="list-text">NFS資料存放區磁碟區是從SVM的根磁碟區連結而來、因此ESXi也必須能夠存取根磁碟區、才能瀏覽及掛載資料存放區磁碟區。根 Volume 和資料存放區磁碟區交會嵌套的任何其他磁碟區的匯出原則、都必須包含 ESXi 伺服器授予其唯讀存取權的規則或規則。以下是根 Volume 的範例原則、也使用 VAAI 外掛程式：</block>
  <block id="8c93fb3ff528165613797962f5a0ed9c" category="list-text">存取傳輸協定：NFS（包括nfs3和nfs4）</block>
  <block id="80e6a4f964e826c69c1c62bd5ea67590" category="list-text">RW存取規則：Never（root Volume的最佳安全性）</block>
  <block id="f96625174b4a06d13267f9b0a5a96d59" category="list-text">超級使用者：sys（也適用於採用VAAI的根Volume）</block>
  <block id="4c571520a8128d1692fc709ffbfb2b1e" category="list-text">使用ONTAP VMware vSphere的VMware Infrastructure（最重要的最佳實務做法）：</block>
  <block id="b8d278c6184cb65727ca5ae729db92d7" category="list-text">使用VMware vSphere的VMware VMware VMware vSphere功能來配置資料存放區、因為它能自動簡化匯出原則的管理。ONTAP</block>
  <block id="23aa7b9aeed3fba2a1ec43e630313af7" category="list-text">使用外掛程式為VMware叢集建立資料存放區時、請選取叢集而非單一ESX伺服器。此選項會觸發IT自動將資料存放區掛載至叢集中的所有主機。</block>
  <block id="e4e62770daaf9887c7868fbc8e248a4b" category="list-text">使用外掛程式掛載功能、將現有的資料存放區套用至新的伺服器。</block>
  <block id="928562eb576ed6ae31cb1a149d3e751a" category="list-text">如果不使用ONTAP VMware vSphere的VMware vSphere功能、請針對所有伺服器或需要額外存取控制的每個伺服器叢集、使用單一匯出原則。</block>
  <block id="7bccab0fa4c0864835c645c9fde7ebf6" category="list-text">雖然供應彈性的Volume命名空間結構、可利用交會在樹狀結構中排列磁碟區、但這種方法對vSphere沒有任何價值。ONTAP無論儲存設備的命名空間階層為何、它都會在資料存放區根目錄中為每個VM建立一個目錄。因此、最佳實務做法是將vSphere磁碟區的交會路徑掛載到SVM的根磁碟區、這就是ONTAP VMware vSphere的VMware vSphere功能如何配置資料存放區。沒有巢狀結點路徑也表示除了根磁碟區之外、沒有任何磁碟區相依於任何磁碟區、即使是刻意將磁碟區離線或銷毀、也不會影響其他磁碟區的路徑。</block>
  <block id="ea6fc1288f1d3b21238d29ff28cb867a" category="list-text">對於NFS資料存放區上的NTFS分割區、4K區塊大小是可以的。下圖說明從vSphere主機連線至ONTAP VMware NFS資料存放區的能力。</block>
  <block id="16c864cb4f3b00c59e1124932e49f342" category="paragraph"><block ref="16c864cb4f3b00c59e1124932e49f342" category="inline-image-macro-rx" type="image"></block></block>
  <block id="e54433644e830ed1503561b778e9ded4" category="paragraph">下表列出NFS版本及支援的功能。</block>
  <block id="9fb9dac7513c7ef8452aade8a52ad40d" category="cell">vSphere功能</block>
  <block id="5b12ee0369243579651edca43ff65c85" category="cell">NFSv3.</block>
  <block id="de841868c2911da76b8ae2da9fa3166d" category="cell">NFSv4.1</block>
  <block id="64e3cc476958b05086721cd6070004cf" category="cell">vMotion與Storage vMotion</block>
  <block id="05807e454c19f244770adae059b3c330" category="cell">高可用度</block>
  <block id="45a75e44a713fdf94dbf1dbaa0749188" category="cell">容錯能力</block>
  <block id="f1e3446c69e4d87279ff7863482f9dcb" category="cell">DRS</block>
  <block id="6ca09f98e8925b2cb78bbf24eccc0186" category="cell">主機設定檔</block>
  <block id="ec8420797e3b089812499cce4047ded8" category="cell">儲存DRS</block>
  <block id="7c19bf1cbe62a87a42857ef0b4fe22ae" category="cell">儲存I/O控制</block>
  <block id="56d43ad1a280ada5e16fd2960ae44b32" category="cell">SRM</block>
  <block id="d595c8f30866b71ea121ced5cde66b1d" category="cell">虛擬磁碟區</block>
  <block id="6ad5114acf73f68a85c72f11646920cb" category="cell">硬體加速（VAAI）</block>
  <block id="ad37ded9046268d8e5ea7cb253bb5dda" category="cell">Kerberos驗證</block>
  <block id="45701e6ef9bc09dca07f8f4abe661dc6" category="cell">是（vSphere 6.5及更新版本增強支援AES、krb5i）</block>
  <block id="76969a36155d2f41fc6cc3bd3faff244" category="cell">多重路徑支援</block>
  <block id="8a18e0a50dc5755c294477cb16507a6c" category="doc">FlexGroups</block>
  <block id="f9ac230f370c7937167d25093c4ce9b9" category="paragraph">此功能可簡化大型資料存放區的建立作業、並自動建立多個組成磁碟區、以發揮整個系統的最大效能。FlexGroup ONTAP利用vSphere的功能將VMware支援功能用於單一、可擴充的vSphere資料存放區、並具備完整的VMware叢集功能。FlexGroup ONTAP</block>
  <block id="6829bc8d3038be0130fd2b409ad5e560" category="paragraph">除了針對vSphere工作負載進行廣泛的系統測試之外、ONTAP 還為FlexGroup VMware資料存放區新增了複本卸載機制。這會使用改良的複製引擎、在背景中的成員之間複製檔案、同時允許存取來源和目的地。根據規模、當需要時、多個複本會使用可立即使用且節省空間的檔案複本。</block>
  <block id="760383437e8e5cbe4a2560753da783fb" category="paragraph">此外、針對VMware vSphere儀表板和VM報告、還新增檔案型效能指標（IOPS、處理量和延遲）、這些指標可在VMware vSphere儀表板和VM報告的「參考」工具中檢視。ONTAP FlexGroup ONTAPVMware vSphere外掛程式的支援功能也可讓您使用最大和/或最小IOPS的組合來設定服務品質（QoS）規則。ONTAP這些設定可以跨資料存放區中的所有VM進行設定、也可以針對特定VM個別設定。</block>
  <block id="50783a97403d748762dff691da2d3723" category="paragraph">以下是NetApp開發的其他一些最佳實務做法：</block>
  <block id="d190c5fcdf8146c1dd7aad1140be4e64" category="list-text">使用FlexGroup 預設的資源配置。建議使用VMware vSphere的VMware vSphere功能、因為它能在vSphere中建立及掛載功能、但可能會使用VMware System Manager或命令列來滿足特殊需求。ONTAP FlexGroup ONTAP即使如此、仍會使用預設值、例如每個節點的組成成員數目、因為這是vSphere測試過的項目。</block>
  <block id="9f3fa65c2cc36eabd2228b984c30c5e1" category="list-text">調整FlexGroup VMware資料存放區規模時、請記住FlexGroup 、此功能包含FlexVol 多個較小的、可建立較大命名空間的支援區。因此、請將資料存放區的大小調整為最大虛擬機器的8倍以上。例如、如果您的環境中有6TB的VM、FlexGroup 請將該資料存放區的大小調整至不小於48TB。</block>
  <block id="5fbee6b763967c822bb1e4a31665b11d" category="list-text">允許FlexGroup 執行功能以管理資料存放區空間。vSphere資料存放區已測試過自動調整規模與彈性調整。如果資料存放區接近完整容量、請使用ONTAP VMware vSphere的VMware vCenter功能或其他工具來調整FlexGroup VMware Volume的大小。如果容量允許、則可將資料夾（VM）內的檔案優先順序設定為相同的組成要素、藉此平衡各成員的容量和inode。FlexGroup</block>
  <block id="b48b55db402c8085e1d333cad214232b" category="list-text">VMware與NetApp目前不支援通用的多重路徑網路方法。對於NFSv4.1、NetApp支援pNFS、而VMware則支援工作階段主幹連線。NFSv3不支援多個實體路徑通往磁碟區。針對使用VMware vSphere的VMware 9.8、我們建議的最佳實務做法是讓VMware vSphere的VMware vSphere使用VMware vSphere的VMware Tools進行單一掛載、因為間接存取的影響通常很小（微秒）FlexGroup ONTAP ONTAP 。您可以使用循環 DNS 、在 FlexGroup 的不同節點上、將 ESXi 主機分散到不同的動態層級、但這需要在沒有適用於 VMware vSphere 的 ONTAP 工具的情況下、建立和掛載 FlexGroup 。因此效能管理功能將無法使用。</block>
  <block id="f5f11bb6aa98d02453eca36d5d1d2e19" category="list-text">vSphere資料存放區支援已在9.8版中測試高達1500部VM。FlexGroup</block>
  <block id="f48591b3ae898f29a551a2995a7dcfe8" category="list-text">使用適用於VMware VAAI的NFS外掛程式進行複本卸載。請注意FlexGroup 、ONTAP 雖然在VMware資料存放區內強化複製功能、但在FlexVol 將VM複製到VMware和/或FlexGroup VMware磁碟區之間時、與ESXi主機複本相比、VMware不提供顯著的效能優勢。</block>
  <block id="57a0d1deb8da99d321814990d26d21ed" category="list-text">使用VMware vSphere 9.8的支援功能、使用VMware vSphere 9.8的支援指標（儀表板和VM報告）來監控各個VM的效能、以及管理個別VM上的QoS。ONTAP FlexGroup ONTAP目前無法透過ONTAP REST指令或API取得這些指標。</block>
  <block id="ad971da24ec0a38449ebf31e4e2c9332" category="list-text">QoS（最大/最小IOPS）可在個別VM或資料存放區中的所有VM上設定。在所有VM上設定QoS會取代任何個別VM設定。設定未來不會延伸至新的或移轉的VM；您可以在新的VM上設定QoS、或是將QoS重新套用至資料存放區中的所有VM。</block>
  <block id="3c9d41390700cbdfb2c273f00df0d6fd" category="list-text">VMware vSphere 4.4版的支援VMware vSphere的子外掛程式、可在主儲存系統的VMware資料存放區中備份及還原VM。SnapCenter FlexGroup雖然SnapMirror可手動用於將FlexGroup 某個不間斷資料複製到二線系統、但4號選擇控制閥並不會管理二線複本。</block>
  <block id="be0ec3d9251292dd856ea0924ecc6873" category="doc">服務品質（QoS）</block>
  <block id="8fdd6138f63aa45f1c51b48d9a01b19d" category="paragraph">處理量限制可在部署前控制未知工作負載或測試工作負載、以確保不會影響其他工作負載。它們也可用於在識別出高效能工作負載之後加以限制。也支援以IOPS為基礎的最低服務層級、以提供一致的效能、適用於ONTAP VMware的SAN物件、以及ONTAP 支援VMware的NAS物件。</block>
  <block id="3e4a2dc31acddb628ba286d25b1bd36e" category="paragraph">有了NFS資料存放區、QoS原則可套用至FlexVol 整個VMware磁碟區或其中的個別VMDK檔案。使用ONTAP 使用VMware LUN的VMFS資料存放區時、QoS原則可套用至FlexVol 包含LUN或個別LUN的VMware磁碟區、但不能套用個別VMDK檔案、因為ONTAP VMware對VMFS檔案系統沒有任何認知。使用vVols時、可使用儲存功能設定檔和VM儲存原則、在個別VM上設定最低和/或最高QoS。</block>
  <block id="534ecd446aac2f9c809eef9064f44aab" category="paragraph">物件的QoS最大處理量限制可設定為Mbps和/或IOPS。如果兩者皆使用、ONTAP 則由支援執行第一個上限。工作負載可以包含多個物件、QoS原則也可以套用至一或多個工作負載。當原則套用至多個工作負載時、工作負載會共用原則的總限制。不支援巢狀物件（例如、磁碟區內的檔案無法各自擁有自己的原則）。QoS最低值只能以IOPS設定。</block>
  <block id="040f184b126879657b253b6d258661d9" category="paragraph">下列工具目前可用於管理ONTAP 不實的QoS原則、並將其套用至物件：</block>
  <block id="de134183bea5df515a6756a539ce6f18" category="list-text">CLI ONTAP</block>
  <block id="6ad5e0a20f49ad6a370454bb3afc9a9e" category="list-text">系統管理程式ONTAP</block>
  <block id="8e23e05fc0865e950d6a3581e0dd8ce9" category="list-text">OnCommand Workflow Automation</block>
  <block id="5ecb6b24c169667ff1a176768115659e" category="list-text">Active IQ Unified Manager</block>
  <block id="8cc4e713850f67a131e9dbf8b997f61e" category="list-text">NetApp PowerShell Toolkit for ONTAP</block>
  <block id="fcdb48d0d22627e4910a8352c80bd87a" category="list-text">VMware vSphere VASA Provider適用的工具ONTAP</block>
  <block id="e6defd03e0f49585b6d47614713e97f7" category="paragraph">若要將QoS原則指派給NFS上的VMDK、請注意下列準則：</block>
  <block id="10509998e8d4c4d7be30fc1d0b6b2a1e" category="list-text">原則必須套用至<block ref="a1bb63c284b58c32f1afb554a12e3e9a" prefix=" " category="inline-code"></block> 其中包含實際的虛擬磁碟映像、而非<block ref="aa26c73336ecfd98ed727b3e249c7f90" prefix=" " category="inline-code"></block> （虛擬磁碟描述元檔案）或<block ref="092eb4dd2ca488962f4c22b3e8cc4ca0" prefix=" " category="inline-code"></block> （ VM 描述元檔案）。</block>
  <block id="2175e0e29bc4b213fa8b9c7afd591b6b" category="list-text">請勿將原則套用至其他 VM 檔案、例如虛擬交換檔案 <block ref="aa33c3c1850a3f99cec7426e2c411d08" prefix="(" category="inline-code"></block>）。</block>
  <block id="8230e9b5c1e9862fedb2c69f7cc5d3d1" category="list-text">使用 vSphere Web 用戶端尋找檔案路徑（資料存放區 &gt; 檔案）時、請注意它會結合的資訊<block ref="f149d7424e10a266ec998ca5b32b81bb" prefix=" " category="inline-code"></block> 和<block ref="4a78be158c13cd6b2dc2100a80bb7070" prefix=" " category="inline-code"></block> 只要顯示一個檔案、其中包含的名稱即可<block ref="4a78be158c13cd6b2dc2100a80bb7070" prefix=" " category="inline-code"></block> 但是的大小<block ref="f149d7424e10a266ec998ca5b32b81bb" prefix=" " category="inline-code"></block>。新增<block ref="4fc4e556dbb9dcede037ccd80fabd784" prefix=" " category="inline-code"></block> 輸入檔案名稱以取得正確路徑。</block>
  <block id="1d4614aca13104c98d5d8cc2d415b941" category="paragraph">若要將QoS原則指派給LUN、包括VMFS和RDM、ONTAP 顯示為Vserver的SVM、LUN路徑和序號、可從ONTAP VMware vSphere的「VMware vSphere的VMware vSphere」（VMware vSphere）「VMware vCenter工具」首頁上的「儲存系統」功能表取得。選取儲存系統（ SVM ）、然後選取相關物件 &gt; SAN 。  使用ONTAP 其中一項功能來指定QoS時、請使用此方法。</block>
  <block id="cc97a1a52adc0bd6f188de1545eea887" category="paragraph">利用ONTAP VMware vSphere或Virtual Storage Console 7.1及更新版本的VMware vSphere或Virtual Storage Console 7.1工具、可輕鬆將最大和最小QoS指派給VVol型VM。為 vVol 容器建立儲存功能設定檔時、請在效能功能下指定最大和 / 或最小 IOPS 值、然後使用 VM 的儲存原則參考此 SCP 。建立VM或將原則套用至現有VM時、請使用此原則。</block>
  <block id="421c9efa4ff1b039a5378be7bc1e2e49" category="paragraph">使用VMware vSphere 9.8及更新版本的VMware vSphere 9.8版的VMware VMware vCenter資料存放區提供增強的QoS功能。FlexGroup ONTAP您可以輕鬆地在資料存放區或特定VM的所有VM上設定QoS。如FlexGroup 需詳細資訊、請參閱本報告的「參考資料」一節。</block>
  <block id="77bb2ba950959bd3f1c55da523ace0be" category="section-title">QoS和VMware SIOC ONTAP</block>
  <block id="b2e21dac6070ea83831ff6521a66a447" category="paragraph">VMware vSphere儲存I/O控制（SIOC）是相輔相成的技術、vSphere和儲存管理員可以搭配使用、來管理執行VMware軟體之系統上所託管vSphere VM的效能。ONTAP ONTAP每個工具都有自己的優點、如下表所示。由於VMware vCenter和ONTAP VMware vCenter的範圍不同、有些物件可由一個系統來查看和管理、而非由另一個系統來管理。</block>
  <block id="5ad234cb2cde4266195252a23ca7d84e" category="cell">屬性</block>
  <block id="b8b8d1ba8fa345f03438a90f29af5784" category="cell">QoS ONTAP</block>
  <block id="c2a4cb962db2a4a6782b69864f0e411c" category="cell">VMware SIOC</block>
  <block id="aa628d5a66888444926b4dc042458200" category="cell">當作用中時</block>
  <block id="688b10fcfff927dee65634e3b3636064" category="cell">原則永遠處於作用中狀態</block>
  <block id="a981c4aa67c29ff2d36fc614d8b28808" category="cell">存在爭用時作用中（超過臨界值的資料存放區延遲）</block>
  <block id="f46e64a82c96db56f3d6657d4fb53f00" category="cell">單位類型</block>
  <block id="878b4223bb85b95d8caf0429d9406cd5" category="cell">IOPS、Mbps</block>
  <block id="3e189a34f422a141311dad231f9ad5b5" category="cell">IOPS、共享</block>
  <block id="7367a0ec46339213625cbc77d56a9572" category="cell">vCenter或應用程式範圍</block>
  <block id="1faff19290bb64ce8ff6bc1220496881" category="cell">多個vCenter環境、其他Hypervisor和應用程式</block>
  <block id="1e664a3cc0ab109fcabcc81b488cebb1" category="cell">單一vCenter伺服器</block>
  <block id="ebccc9f5c939841d86e5382988dfcc47" category="cell">在VM上設定QoS？</block>
  <block id="cddd0980ce99890d2ea90288f6b03117" category="cell">僅NFS上的VMDK</block>
  <block id="928629d8a2a889f5274cad9940a06da0" category="cell">NFS或VMFS上的VMDK</block>
  <block id="305e85b992089534091855224f60cf75" category="cell">設定LUN上的QoS（RDM）？</block>
  <block id="e798014243cf5682e7fb3aaf4ee7cecf" category="cell">在LUN（VMFS）上設定QoS？</block>
  <block id="9cd021ea9d3c88de723fe9a2e50a2380" category="cell">在Volume（NFS資料存放區）上設定QoS？</block>
  <block id="c352b53c32380efcf4436926da6d0414" category="cell">在SVM（租戶）上設定QoS？</block>
  <block id="5dad340ee8f9e8fa9b65bf86a9fd5341" category="cell">以原則為基礎的方法？</block>
  <block id="b31c76176f26196c6379a9bcce212d99" category="cell">是；可由原則中的所有工作負載共用、或完全套用至原則中的每個工作負載。</block>
  <block id="1ff33557bad923d68973872cacf2e43a" category="cell">是、使用vSphere 6.5及更新版本。</block>
  <block id="d5f1465492190ee9d30a09b36f64f4b7" category="cell">需要授權</block>
  <block id="4cec76d82991abd453484c23f7e3788a" category="cell">隨附ONTAP 於此功能</block>
  <block id="6bb36803f4670824ff9ebdf665654829" category="cell">Enterprise Plus</block>
  <block id="d4d4b5b65bebf236590d70c702a6ba6b" category="paragraph">VMware儲存分散式資源排程器（SDR）是vSphere功能、可根據目前的I/O延遲和空間使用量、將VM放置在儲存設備上。接著、它會在資料存放區叢集中的資料存放區之間（也稱為Pod）、在不中斷營運的情況下移動VM或VMDK、並選取將VM或VMDK置於資料存放區叢集中的最佳資料存放區。資料存放區叢集是類似資料存放區的集合、從 vSphere 管理員的觀點來看、這些資料存放區會彙總成單一使用量單位。</block>
  <block id="01e838e1c124042f75adb374a81f72a6" category="paragraph">VMware vSphere API for Storage感知（VASA）可讓儲存管理員輕鬆設定具有明確定義功能的資料存放區、並讓VM管理員在需要時使用這些功能來配置VM、而不需要彼此互動。請看一下這種方法、瞭解它如何簡化虛擬化儲存作業、並避免許多瑣碎的工作。</block>
  <block id="0ce8b0e3e0d7dc7f39c62fb74a28b3bf" category="section-title">雲端移轉與備份</block>
  <block id="4fe11b4a91ff38ec9933009a15dd5b0b" category="paragraph">另一ONTAP 項優勢是廣泛支援混合雲、將內部部署私有雲中的系統與公有雲功能合併在一起。以下是一些可搭配vSphere使用的NetApp雲端解決方案：</block>
  <block id="e18ab5f123ad4ce169202479f07f3f0f" category="list-text">* 雲端 Volume 。 * NetApp Cloud Volumes Service for Amazon Web Services 或 Google Cloud Platform 和 Azure NetApp Files for anf 可在領先業界的公有雲環境中、提供高效能、多重傳輸協定的託管儲存服務。VMware Cloud VM來賓可以直接使用。</block>
  <block id="9625e7e8b7b951b4ac75beee0139b407" category="list-text">*《NetApp》資料管理軟體可在您選擇的雲端上、為您的資料提供控制、保護、靈活度及效率。Cloud Volumes ONTAP Cloud Volumes ONTAPNetApp是以NetApp解決方案儲存軟體為建置基礎的雲端原生資料管理軟體。Cloud Volumes ONTAP ONTAP搭配Cloud Manager一起使用、即可部署Cloud Volumes ONTAP 及管理包含ONTAP 內部部署的各種系統的不二執行個體。利用先進的 NAS 和 iSCSI SAN 功能、搭配整合式資料管理、包括快照和 SnapMirror 複寫。</block>
  <block id="2a11701c0c01affc0ce96eb0d0c16ed9" category="list-text">* Cloud Services。*使用Cloud Backup Service NetApp或SnapMirror Cloud、利用公有雲儲存設備保護內部部署系統的資料。可協助您在NAS、物件儲存區和物件儲存區之間移轉及保持資料同步。Cloud Sync Cloud Volumes Service</block>
  <block id="99c6c4d349151c1f4a6694e424aef741" category="inline-link">儲存更多 VM 快照</block>
  <block id="01fa297dbdab5aceb83a45a98161efe0" category="list-text">* FabricPool 《*》FabricPool *《*》*《*》提供快速且簡單的ONTAP 資料分層功能。冷區塊可移轉至公有雲或私有 StorageGRID 物件存放區中的物件存放區、並在再次存取 ONTAP 資料時自動重新叫用。或是將物件層用作SnapVault 已由效益管理的資料的第三層保護。您可以使用這種方法<block ref="60d027dbb3c3f076cbb70c6b246eb433" category="inline-link-rx"></block> 在一線ONTAP 和/或二線的不二元儲存系統上。</block>
  <block id="1a7072854c9dd945a98f4314b3f77408" category="list-text">*《*》。*使用NetApp軟體定義的儲存設備、將您的私有雲端延伸至遠端設施和辦公室、您可以使用《》來支援區塊和檔案服務、以及您在企業資料中心擁有的相同vSphere資料管理功能。ONTAP Select ONTAP Select</block>
  <block id="79aec220098057ef8c0e46281a45d6c2" category="paragraph">在設計VM型應用程式時、請考慮未來的雲端行動力。例如、應用程式和資料檔案不會放在一起、而是使用個別的LUN或NFS匯出來匯出資料。這可讓您將VM和資料分別移轉至雲端服務。</block>
  <block id="af63597853dc0983258c8f86a12aae0b" category="section-title">vSphere資料加密</block>
  <block id="63a07ab9352c9297cea3894d6cd41c3f" category="paragraph">如今、透過加密保護閒置資料的需求與日俱增。雖然最初的重點是財務和醫療資訊、但無論資訊儲存在檔案、資料庫或其他資料類型中、都越來越有興趣保護所有資訊。</block>
  <block id="f131c8f285a9ebc44140235877aecbe5" category="paragraph">執行ONTAP 此軟體的系統可透過閒置加密、輕鬆保護任何資料。NetApp儲存加密（NSE）使用自我加密的磁碟機ONTAP 搭配使用、以保護SAN和NAS資料。NetApp也提供NetApp Volume Encryption和NetApp Aggregate Encryption、這是一種簡單、以軟體為基礎的方法、可加密任何磁碟機上的磁碟區。此軟體加密不需要特殊的磁碟機或外部金鑰管理員、 ONTAP 客戶可免費使用。您可以在不中斷用戶端或應用程式的情況下升級及開始使用、而且它們已通過FIPS 140-2第1級標準驗證、包括內建金鑰管理程式。</block>
  <block id="937a352e0f824ff55e4cd50c8e3b051e" category="paragraph">有幾種方法可以保護在VMware vSphere上執行的虛擬化應用程式資料。其中一種方法是在客體作業系統層級使用VM內部的軟體來保護資料。vSphere 6.5等較新的Hypervisor現在也支援VM層級的加密、這是另一種替代方案。不過、NetApp軟體加密既簡單又簡單、而且具有下列優點：</block>
  <block id="6eda79cc710edc32583cf567b00e7672" category="list-text">*對虛擬伺服器CPU沒有影響。*某些虛擬伺服器環境需要其應用程式的每個可用CPU週期、但測試顯示、Hypervisor層級加密需要高達5倍的CPU資源。即使加密軟體支援 Intel 的 AES-NI 指令集來卸載加密工作負載（如同 NetApp 軟體加密一樣）、由於新的 CPU 與舊版伺服器不相容、因此這種方法可能不可行。</block>
  <block id="6abee98aea26f85e6f0fe8d4db70f998" category="list-text">*隨附機上金鑰管理程式。* NetApp軟體加密包含內建金鑰管理程式、不需額外付費、因此無需購買和使用複雜的高可用度金鑰管理伺服器、即可輕鬆開始使用。</block>
  <block id="c216121021de8554d33503ef6616b256" category="list-text">*對儲存效率沒有影響。*目前廣泛使用重複資料刪除與壓縮等儲存效率技術、是以具成本效益的方式使用Flash磁碟媒體的關鍵。不過、加密資料通常無法進行重複資料刪除或壓縮。NetApp硬體與儲存加密的運作層級較低、可充分運用領先業界的NetApp儲存效率功能、不像其他方法。</block>
  <block id="5f9aa8333f218d1c21e67c8608a48672" category="list-text">*輕鬆進行資料存放區精細加密。*有了NetApp Volume Encryption、每個磁碟區都能獲得自己的AES 256位元金鑰。如果您需要變更、只要使用一個命令即可。如果您有多個租戶、或需要證明不同部門或應用程式的獨立加密、這種方法非常適合。這種加密是在資料存放區層級進行管理、比管理個別VM容易得多。</block>
  <block id="de2b3baa1cd4980c36e8bbf7c827ae0c" category="paragraph">開始使用軟體加密非常簡單。安裝授權之後、只要指定通關密碼、即可設定內建金鑰管理程式、然後建立新的磁碟區、或是執行儲存端磁碟區移轉、即可啟用加密功能。NetApp正致力於在未來的VMware工具版本中、為加密功能提供更多整合式支援。</block>
  <block id="c95fa5b56a01e5c1a80c540c1ab1a750" category="paragraph">利用VMware Infrastructure、您可以清楚掌握虛擬基礎架構中的虛擬機器、並監控及疑難排解虛擬環境中的儲存與效能問題。Active IQ Unified Manager</block>
  <block id="be75250c2f30870dc1e359b4ade2a767" category="paragraph">典型的虛擬基礎架構部署ONTAP 在整個運算、網路和儲存層之間、有許多不同的元件。VM應用程式中的任何效能延遲都可能是因為各個元件在各個層面上所面臨的延遲問題。</block>
  <block id="d1734f6f2e65a1488896f74695db5254" category="paragraph">下列螢幕快照顯示Active IQ Unified Manager 「VMware虛擬機器」檢視畫面。</block>
  <block id="8aa017c9f67ad32dd7301ecf52b61d72" category="paragraph"><block ref="8aa017c9f67ad32dd7301ecf52b61d72" category="inline-image-macro-rx" type="image"></block></block>
  <block id="2118336fa447fcc0f213cb8c40c516af" category="paragraph">Unified Manager會在拓撲檢視中呈現虛擬環境的底層子系統、以判斷運算節點、網路或儲存設備是否發生延遲問題。此檢視也會強調導致效能延遲的特定物件、以便採取補救步驟並解決根本問題。</block>
  <block id="d8a78b994fcd4e04901203a2e7bc6414" category="paragraph">下列螢幕快照顯示AIQUM擴充拓撲。</block>
  <block id="e9659be2b7d3d69eccdb443ed2acec75" category="paragraph"><block ref="e9659be2b7d3d69eccdb443ed2acec75" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f02207fb26160d7e47cf5ea35d07df03" category="doc">資料存放區與傳輸協定</block>
  <block id="af8dcb8c7a1e8b7e614e570806d8dcee" category="paragraph">使用七種傳輸協定將VMware vSphere連接至執行ONTAP VMware軟體的系統上的資料存放區：</block>
  <block id="a7c815fafe60ae637d38216fa6300395" category="list-text">FCP</block>
  <block id="14eae6ee278098bfad4f8a10fd6c1195" category="list-text">FCoE</block>
  <block id="26bcb9f1cb6f391f4b2c18e676bb458d" category="list-text">NVMe / FC</block>
  <block id="8b7c42123642e2e4ea7dd426aeb2de58" category="list-text">NVMe / TCP</block>
  <block id="e4e1c13bb0b14f6cb7608cbecea948ef" category="list-text">iSCSI</block>
  <block id="f7d773fd2896401c143676940bc001fc" category="list-text">NFS v3</block>
  <block id="0b99b245267ef194ca3b9f6e694b0983" category="list-text">NFS v4.1</block>
  <block id="cfa070ed8af17c3125cfd1530fbd387a" category="paragraph">FCP、FCoE、NVMe/FC、NVMe/TCP和iSCSI是區塊傳輸協定、使用vSphere虛擬機器檔案系統（VMFS）將VM儲存在ONTAP 包含ONTAP FlexVol 在一個EesfVolume中的SesfLUN或NVMe命名空間內。請注意、從vSphere 7.0開始、VMware不再支援正式作業環境中的軟體FCoE。NFS是一種檔案傳輸協定、可將VM放入資料存放區（只是ONTAP 指不需要VMFS的功能）。SMB（CIFS）、iSCSI、NVMe / TCP或NFS也可直接從客體作業系統使用到ONTAP 不支援。</block>
  <block id="2b19cb432f68f1ba3dc7b0f175a14778" category="inline-link">VMware 組態上限</block>
  <block id="f8ca1b19553d4c965e40e9eeb1eb5aca" category="paragraph">下表提供 vSphere 支援的傳統資料存放區功能與 ONTAP 。此資訊不適用於vVols資料存放區、但通常適用於使用支援ONTAP 的版本資訊的vSphere 6.x及更新版本。您也可以諮詢<block ref="61b579b455015dfa2bbf16bf62f07f93" category="inline-link-rx"></block> 以確認特定vSphere版本的特定限制。</block>
  <block id="9da73946f1bc3be4a41898d06c9d2e8b" category="cell">功能/特色</block>
  <block id="c982f804d02e2d7e937f125d2cac1024" category="cell">FC/FCoE</block>
  <block id="6151632541dcd80356c6c76b34d69d0c" category="cell">NVMe</block>
  <block id="520d0db389f362bf79ef56ca0af3dcab" category="cell">格式</block>
  <block id="99a3142584ca8ad0a3afadeaa6f2ef69" category="cell">VMFS或原始裝置對應（RDM）</block>
  <block id="26aae26f61844ac20ab7b04ba6f5c515" category="cell">VMFS或RDM</block>
  <block id="18263a30df8afc60a733e59c60676ac0" category="cell">VMFS</block>
  <block id="382b0f5185773fa0f67a8ed8056c7759" category="cell">不適用</block>
  <block id="8dc6d0c66219ddb809322c0d248e55e6" category="cell">資料存放區或LUN的最大數量</block>
  <block id="aa23f9914ce1939ea7a4d479edfdc915" category="cell">每個主機有1024個LUN</block>
  <block id="1af3b27207afc48a363629a315d76b59" category="cell">每個伺服器有1024個LUN</block>
  <block id="0705fd627c25b5fba17cd9a022ed7d72" category="cell">每個伺服器256個Namespeces</block>
  <block id="2774ddb6f193789c5d9a480b9e53a38d" category="cell">256 個掛載
預設 NFS 。最大磁碟區為8。使用VMware vSphere的VMware vSphere功能將其提升至256個。ONTAP</block>
  <block id="51c0dc217976e27de06e262947947a62" category="cell">最大資料存放區大小</block>
  <block id="856c997f909830b8249756c07dc9452b" category="cell">64TB</block>
  <block id="8e5d3a4b085389c59a1a7af7c4067a9b" category="cell">100TB FlexVol 以上的穩定區塊（含FlexGroup 不穩定區）</block>
  <block id="b4fb1d41fedaec79072964cbb4d16e3d" category="cell">最大資料存放區檔案大小</block>
  <block id="d10549beb2f7bd1e91e5ef8965edd84a" category="cell">62TB</block>
  <block id="18301e675ce7d51c23071d7b135edbdc" category="cell">62TB 、含 ONTAP 9.12.1P2 及更新版本</block>
  <block id="9aa56a79640231adaec83bc53e59c929" category="cell">每個LUN或檔案系統的最佳佇列深度</block>
  <block id="c7dfde106afbb4e1d55096403af252e0" category="cell">64-256</block>
  <block id="ca6e77250a239af7b4aed9a1ac058825" category="cell">自動協商</block>
  <block id="bad19bc2587cd465cab5cec5a13aa306" category="cell">請參閱中的NFS.MaxQuestue深度<block ref="0391a4aaf03ed2bf80fb4efb215797d0" category="inline-link-rx"></block>。</block>
  <block id="edc5121cb9b42a76b718b8ece9d67437" category="paragraph">下表列出支援的VMware儲存相關功能。</block>
  <block id="6c1a84b789b54fd42511ce582be94d21" category="cell">vMotion</block>
  <block id="e95b58d02782c970bb339c6cc587ff39" category="cell">Storage VMotion</block>
  <block id="0486e0e3dc3e86859f43b6d8e32b8071" category="cell">VMware HA</block>
  <block id="8be6bd7f20474cbefdd496cb9fd495ca" category="cell">儲存分散式資源排程器（SDR）</block>
  <block id="4244919a64848265426dfd82a14f8248" category="cell">啟用資料保護（VADP）的VMware vStorage API備份軟體</block>
  <block id="28c2f8ab9cdbf296aa4261bc3c58ba0d" category="cell">VM內的Microsoft叢集服務（Microsoft Cluster Service、英文）或容錯移轉叢集</block>
  <block id="01a9a3b8d0fcae3055dc91935e8ec6c6" category="cell">是*</block>
  <block id="aa7f77e663b832d5b0e544c5511e680c" category="cell">不支援</block>
  <block id="aa18abedec09bd4f85e612c307e2eaa6" category="cell">容錯能力</block>
  <block id="bfd52522de4ac6efd6f680e0e754eeb5" category="cell">Site Recovery Manager</block>
  <block id="d6407966cf588d8d78d4f7e65f1ea6fd" category="cell">僅適用於v3 *</block>
  <block id="17d495427086fa21259b9df40b27e00a" category="cell">精簡配置的VM（虛擬磁碟）</block>
  <block id="4ee7af004efef335d6a14c60ee758f5e" category="cell">是的
此設定是不使用 VAAI 時、 NFS 上所有 VM 的預設值。</block>
  <block id="13bc264ff420559de4156ec40980a4b9" category="cell">VMware原生多重路徑</block>
  <block id="50ed43e1a7a22335069a344bc706b600" category="cell">是、使用新的高效能外掛程式（HPP）</block>
  <block id="a06819d91a165d0491c5816c54b41234" category="paragraph">下表列出支援ONTAP 的功能不完整的儲存管理功能。</block>
  <block id="f8d61013f1a3bbf1342f4ced3279c7cf" category="cell">重複資料刪除技術</block>
  <block id="72167540968147afed9deb59f0e9fe00" category="cell">節省陣列成本</block>
  <block id="9a5473a6abaea16b736f096913a749be" category="cell">資料存放區的節約效益</block>
  <block id="6cd880eabbec3488232c6cba3fbcf998" category="cell">資源隨需配置</block>
  <block id="5caeb11c4ed379b808d7f7cdca7cfbf0" category="cell">資料存放區或RDM</block>
  <block id="8a5227cc82d14862956938caffc1acf2" category="cell">資料存放區</block>
  <block id="b71ba22dcd42deceac87150206f7bd12" category="cell">調整資料存放區大小</block>
  <block id="c6b792bfd7aac8067d36337e67d11545" category="cell">僅成長</block>
  <block id="29e23534878bb63341e0b689426b7fb0" category="cell">擴充、自動擴充及縮減</block>
  <block id="76021405cc62a4b8c542e7f65e3d24ed" category="cell">適用於Windows、Linux應用程式（客體內）的列舉外掛程式SnapCenter</block>
  <block id="c0b3c629432c82a9e8500242abb35eaf" category="cell">使用ONTAP VMware vSphere的VMware VMware vSphere的支援工具來監控及主機組態</block>
  <block id="5a915a8215e9a66bcff0f034e8adff18" category="cell">使用ONTAP VMware vSphere的VMware vSphere的VMware工具進行資源配置</block>
  <block id="6495c7cda42bf1b80bc1c2af6166ef58" category="paragraph">下表列出支援的備份功能。</block>
  <block id="ad336d1fccea3e918d07055edac855a3" category="cell">ONTAP 快照</block>
  <block id="bf22a1b5bc2b72a75825094826a942de" category="cell">SRM支援複寫備份</block>
  <block id="60d3f7d9f265eb34e826da352cb545be" category="cell">Volume SnapMirror</block>
  <block id="fabf31a57c142c986c5d88cb089b3d7b" category="cell">VMDK映像存取</block>
  <block id="40b655e79545b3922b8095be28d59428" category="cell">啟用VADP的備份軟體</block>
  <block id="8215e73d220182794dfbd75ad494c727" category="cell">啟用VADP的備份軟體、vSphere Client和vSphere Web Client資料存放區瀏覽器</block>
  <block id="d7605580ecad0fcb4528789d74cdcad5" category="cell">VMDK檔案層級存取</block>
  <block id="906ece32da286d6c4b323bc0d6443b7c" category="cell">啟用VADP的備份軟體、僅限Windows</block>
  <block id="d17e2fa63a62622f88bf170612132383" category="cell">啟用VADP的備份軟體和協力廠商應用程式</block>
  <block id="4e3d259d82a536e12c5c9c948b62e26a" category="cell">NDMP精細度</block>
  <block id="90d45e02e50c81603c36a4e4ad3649d9" category="cell">資料存放區或 VM</block>
  <block id="8339c514e73f5cced3b83d504d60441b" category="inline-link">Windows Server容錯移轉叢集的設定</block>
  <block id="45f7e6f7f6f0f4093754d7d48810e17f" category="paragraph">* NetApp建議將來賓iSCSI用於Microsoft叢集、而非在VMFS資料存放區中使用支援多寫入器的VMDK。Microsoft和VMware完全支援這種方法、ONTAP 提供優異的靈活度搭配使用VMware（SnapMirror至ONTAP 內部部署或雲端的等化系統）、易於設定和自動化、SnapCenter 並可透過VMware加以保護。vSphere 7新增叢集式VMDK選項。這與啟用多寫入器的VMDK不同、因為VMDK需要透過FC傳輸協定呈現資料存放區、而且此傳輸協定已啟用叢集式VMDK支援。其他限制也適用。請參閱 VMware 的<block ref="b158594c147457b5b6417413cb30f800" category="inline-link-rx"></block> 組態準則文件。</block>
  <block id="e2bd40041a6472b580305ce9017b0b2e" category="paragraph">*使用NVMe與NFS v4.1的資料存放區需要vSphere複寫。SRM不支援陣列型複寫。</block>
  <block id="54b3e11ce37eaaa9884f4086e72dd2be" category="section-title">選擇儲存傳輸協定</block>
  <block id="4bbd62e7748dbf2416c644698342b5f9" category="paragraph">執行ONTAP 支援所有主要儲存傳輸協定的系統、因此客戶可以根據現有和規劃的網路基礎架構和員工技能、選擇最適合自己環境的系統。NetApp測試通常顯示以類似線路速度執行的傳輸協定之間沒有什麼差異、因此最好將重點放在網路基礎架構和員工能力上、而不只是原始傳輸協定效能。</block>
  <block id="0212b4e8bc965dcd8a7ff771dd96bf21" category="paragraph">下列因素可能有助於考量選擇傳輸協定：</block>
  <block id="0425ddb6dbbe7f13280e19e1f925b0a8" category="list-text">*目前的客戶環境。*雖然IT團隊通常擅長管理乙太網路IP基礎架構、但並非所有人都擅長管理FC SAN架構。但是、使用非專為儲存流量設計的通用 IP 網路可能無法正常運作。請考量您所擁有的網路基礎架構、任何計畫性的改善、以及員工管理這些基礎架構的技能和可用度。</block>
  <block id="774f1348caf3e145710073eb634c4fa1" category="list-text">*易於設定。*除了FC架構的初始組態設定（額外的交換器和纜線、分區、以及HBA和韌體的互通性驗證）之外、區塊傳輸協定也需要建立及對應LUN、以及由客體作業系統探索及格式化。NFS磁碟區建立及匯出之後、便會由ESXi主機掛載並準備好使用。NFS沒有特殊的硬體限制或韌體可管理。</block>
  <block id="bf5169ce5bb544313eaf17435f756da2" category="list-text">*易於管理。*有了SAN傳輸協定、如果需要更多空間、就必須採取幾個步驟、包括擴充LUN、重新掃描以探索新的大小、然後擴充檔案系統）。雖然可以擴充LUN、但減少LUN的大小並不可行、而且恢復未使用的空間可能需要額外的心力。NFS可輕鬆調整規模或縮減規模、儲存系統也能自動調整大小。SAN透過客體作業系統修剪/取消對應命令提供空間回收、讓刪除檔案的空間可以傳回陣列。NFS資料存放區的這類空間回收較為困難。</block>
  <block id="530c759326761c6ac026b313985b255f" category="list-text">*儲存空間的透明度。*在NFS環境中、儲存使用率通常比較容易查看、因為精簡配置可立即回收節約效益。同樣地、相同資料存放區中的其他VM或其他儲存系統磁碟區也可立即使用重複資料刪除和複製的節約效益。NFS資料存放區的VM密度通常也較高、可減少資料存放區的管理數量、進而改善重複資料刪除的節約效益、並降低管理成本。</block>
  <block id="16ee928b12bc598bf52b0f312879ec95" category="section-title">資料存放區配置</block>
  <block id="b8c499c7b537f5bd4e51b0a6d6a1e9d0" category="list-text">部署vSphere搭配ONTAP 使用不間斷的NFS資料存放區、可實現高效能且易於管理的實作、提供VM對資料存放區的比率、而這些比率無法透過區塊型儲存傳輸協定取得。此架構可減少相關資料存放區數量、使資料存放區密度增加十倍。雖然較大的資料存放區可提升儲存效率並提供營運效益、但請考慮使用至少四個資料存放區FlexVol （VMware Volume）、將VM儲存在單ONTAP 一的VMware控制器上、以從硬體資源中獲得最大效能。此方法也可讓您建立具有不同恢復原則的資料存放區。根據業務需求、部分備份或複寫的頻率可能會比其他更高。由於資料存放區FlexGroup 是依設計進行擴充、因此不需要使用多個資料存放區來提升效能。</block>
  <block id="e15ed0ec7af4278259b7618024b3e7ce" category="list-text">NetApp 建議對大多數 NFS 資料存放區使用 FlexVol Volume 。從 ONTAP 9.8 FlexGroup 磁碟區開始、也支援作為資料存放區使用、一般建議在某些使用案例中使用。一般不建議使用其他 ONTAP 儲存容器、例如 qtree 、因為目前 VMware vSphere 的 ONTAP 工具或 VMware vSphere 的 NetApp SnapCenter 外掛程式都不支援這些容器。也就是說、將資料存放區部署為單一磁碟區中的多個 qtree 、對於高度自動化的環境來說可能很有用、因為資料存放區層級配額或 VM 檔案複本可以讓環境受益。</block>
  <block id="dc4d78be836807b32c7ef7f42028b1ef" category="list-text">適用於不只FlexVol 4TB、更能滿足8TB的需求。這種規模對於效能、管理簡易性和資料保護來說、是一個很好的平衡點。從小規模開始（例如4TB）、視需要擴充資料存放區（最高100TB）。較小的資料存放區可更快從備份或災難後恢復、並可在叢集之間快速移動。請考慮使用ONTAP 不同步自動調整大小、以便在使用空間變更時自動擴充及縮小磁碟區。VMware vSphere資料存放區資源配置精靈的「VMware vSphere資料存放區資源配置精靈」預設會針對新的資料存放區使用自動調整大小。ONTAP您可以使用System Manager或命令列、進一步自訂「成長」和「縮減」臨界值、以及最大和最小大小。</block>
  <block id="964a81e46088ae1cc6306072464a9d73" category="list-text">此外、VMFS資料存放區也可以設定LUN、以供FC、iSCSI或FCoE存取。VMFS可讓叢集中的每個ESX伺服器同時存取傳統LUN。VMFS資料存放區的大小最多可達64TB、最多可包含32個2TB LUN（VMFS 3）或單一64TB LUN（VMFS 5）。大部分系統的LUN大小僅為16TB、ONTAP All SAN陣列系統的LUN大小上限為12TB。因此、在ONTAP 大多數的不實系統上、可使用四個16TB LUN來建立最大大小的VMFS 5資料存放區。雖然多個LUN的高I/O工作負載（使用高階FAS 的功能或AFF 功能性系統）可獲得效能優勢、但由於建立、管理及保護資料存放區LUN的管理複雜度增加、以及提高可用度風險、因此這項優勢已被抵銷。NetApp一般建議針對每個資料存放區使用單一大型LUN、而且只有在需要超越16TB資料存放區的情況下才需要跨距。與NFS一樣、請考慮使用多個資料存放區（Volume）、在單ONTAP 一的VMware控制器上發揮最大效能。</block>
  <block id="c74cab014e402128efd8102b941c0b0c" category="list-text">老舊的客體作業系統（OS）需要與儲存系統一致、才能獲得最佳效能和儲存效率。然而、Microsoft和Linux經銷商（例如Red Hat）所支援的現代化作業系統不再需要調整、以使檔案系統分割區與虛擬環境中基礎儲存系統的區塊保持一致。如果您使用的是可能需要調整的舊作業系統、請在NetApp支援知識庫中搜尋文章、使用「VM對齊」、或向NetApp銷售或合作夥伴聯絡人索取TR-3747的複本。</block>
  <block id="8c761039ef4dd69451490b849ace1f82" category="list-text">避免在來賓作業系統中使用重組公用程式、因為這不會帶來效能效益、也會影響儲存效率和快照空間使用量。也請考慮在客體作業系統中關閉虛擬桌面的搜尋索引。</block>
  <block id="14abb814748566a24367c4459a54840b" category="list-text">以創新的儲存效率功能引領業界、讓您充分發揮可用磁碟空間的效益。ONTAP利用預設的即時重複資料刪除與壓縮技術、支援更高的效率。AFF資料會在集合體中的所有磁碟區中進行重複資料刪除、因此您不再需要將類似的作業系統和類似的應用程式群組在單一資料存放區中、以達到最大的節約效益。</block>
  <block id="446548f2b1301893641e29657fc7fe53" category="inline-link-macro">Oracle資料庫ONTAP</block>
  <block id="6cda576d2fd323c1a728b7ac67d6034f" category="list-text">一流磁碟（或改良的虛擬磁碟）可讓vCenter管理的磁碟獨立於vSphere 6.5及更新版本的VM。雖然主要是由API管理、但在vVols上也很實用、尤其是由OpenStack或Kubernetes工具管理時。支援的項目包括ONTAP VMware ONTAP vSphere的VMware vSphere的支援功能和VMware vSphere的支援功能。</block>
  <block id="71318121439b39fdf872bb0bd57494f2" category="section-title">資料存放區與VM移轉</block>
  <block id="e8824ce2062c6d1fc536163f7b8940bd" category="paragraph">將VM從另一個儲存系統上的現有資料存放區移轉至ONTAP 支援區時、請謹記以下幾項實務做法：</block>
  <block id="73b729fbc964c7d78dd90b64aaaeb785" category="list-text">使用Storage VMotion將大部分虛擬機器移至ONTAP VMware。這種方法不僅不中斷虛ONTAP 擬機器的執行、還能讓諸如即時重複資料刪除和壓縮等儲存效率功能、在資料移轉時處理資料。請考慮使用vCenter功能從清單清單清單中選取多個VM、然後在適當的時間排程移轉（按一下「Actions」（動作）時使用Ctrl鍵）。</block>
  <block id="e512c890754c686d8deccac97d84a290" category="list-text">雖然您可以仔細規劃移轉至適當的目的地資料存放區、但通常較容易大量移轉、然後視需要組織。如果您有特定的資料保護需求、例如不同的 Snapshot 排程、您可能會想要使用此方法來引導您移轉至不同的資料存放區。</block>
  <block id="616b2180a0659911fed5aa758dba722c" category="list-text">大多數VM及其儲存設備可能會在執行（Hot）時移轉、但從其他儲存系統移轉附加（非資料存放區）儲存設備（例如ISO、LUN或NFS磁碟區）可能需要冷移轉。</block>
  <block id="fbb88da5639930a05f510729e473a216" category="inline-link">TR-4534</block>
  <block id="096f2185af16e07c387a7fbe50df957a" category="list-text">需要更謹慎移轉的虛擬機器包括使用附加儲存設備的資料庫和應用程式。一般而言、請考慮使用應用程式的工具來管理移轉。對於Oracle、請考慮使用Oracle工具（例如RMAN或ASM）來移轉資料庫檔案。請參閱<block ref="6b3f565e7a7ce633fa62f4114c295216" category="inline-link-rx"></block> 以取得更多資訊。同樣地、對於SQL Server、請考慮使用SQL Server Management Studio或NetApp工具、例如SnapManager 適用於SQL Server或SnapCenter VMware。</block>
  <block id="09485b54473eee31422696bf0217d714" category="paragraph">搭配執行ONTAP VMware vCenter軟體的系統使用vSphere時、最重要的最佳實務做法是安裝及使用ONTAP VMware vSphere外掛程式（前身為虛擬儲存主控台）的VMware VMware vSphere資訊工具。無論使用SAN或NAS、此vCenter外掛程式都能簡化儲存管理、提升可用度、並降低儲存成本和營運成本。它採用最佳實務做法來配置資料存放區、並針對多重路徑和HBA逾時最佳化ESXi主機設定（如附錄B所述）。由於它是 vCenter 外掛程式、因此可用於所有連線至 vCenter 伺服器的 vSphere Web 用戶端。</block>
  <block id="9fb2cc2ced88ce872ef16c37d8284360" category="paragraph">外掛程式也能協助您在ONTAP vSphere環境中使用其他的功能。它可讓您安裝適用於 VMware VAAI 的 NFS 外掛程式、以便將複本卸載至 ONTAP 進行虛擬機器複製作業、保留大型虛擬磁碟檔案的空間、以及 ONTAP 快照卸載。</block>
  <block id="9baea886f208a41896164d4ade5b3fde" category="paragraph">一般而言、NetApp建議在ONTAP vCenter內使用VMware vSphere的VMware vCenter功能的VMware vCenter功能、來配置傳統和vVols資料存放區、以確保遵循最佳實務做法。</block>
  <block id="6161d374e9022f89382fd63b4be15aa1" category="section-title">一般網路</block>
  <block id="f0cd6847f2a7a0773ad0b58d0f9dc67d" category="paragraph">使用vSphere搭配執行ONTAP VMware軟體的系統時、設定網路設定很簡單、而且類似於其他網路組態。以下是幾點需要考量的事項：</block>
  <block id="c7949782ad094d3ffc126bee722642a3" category="list-text">使用交換器、透過 Cisco 的 Virtual PortChannel （ VPC ）等多機箱連結集合群組方法、在兩個獨立的交換器機箱上支援連接埠的連結集合。</block>
  <block id="9dc1904e0c3ace141704b477cd9b345d" category="inline-link">網路管理</block>
  <block id="68ecdb0d7a96e68318a53d12e9fab5b5" category="list-text">使用 LACP 為具有連接埠或 IP 雜湊的動態多重模式介面群組的 ONTAP 儲存系統建立連結集合體。請參閱<block ref="b87480ad0ff34784c4be1445a72a3aaf" category="inline-link-rx"></block> 以取得進一步指引。</block>
  <block id="3b407fe7c9654197902b1dd26af6dc81" category="list-text">在 ESXi 上使用靜態連結集合（例如、 EtherChannel ）和標準 vSwitch 、或是搭配 vSphere Distributed Switch 使用 LACP 型連結集合時、請使用 IP 雜湊成組原則。如果未使用連結集合、請改用「根據來源虛擬連接埠 ID 建立路由」。</block>
  <block id="ee1ef6cf0f3971b44eb2abcac958fb8d" category="section-title">資料量FlexGroup</block>
  <block id="bf985cdd1506d49ea0773c8997e0b723" category="paragraph">ONTAP 9.8 在 vSphere 中新增對 FlexGroup Volume 資料存放區的支援、並支援適用於 VMware vSphere 的 ONTAP 工具和適用於 VMware vSphere 的 SnapCenter 外掛程式。此功能可簡化大型資料存放區的建立作業、並自動建立多個組成磁碟區、以發揮整個系統的最大效能。FlexGroup ONTAP如果您需要具備完整 ONTAP 叢集功能的單一可擴充 vSphere 資料存放區、或是擁有可從全新 FlexGroup 複製機制獲益的大型複製工作負載、請將 FlexGroup 與 vSphere 搭配使用。</block>
  <block id="83bcea036e70c0f011b083b2325b7a4b" category="paragraph">除了針對vSphere工作負載進行廣泛的系統測試之外、ONTAP 還為FlexGroup VMware資料存放區新增了複本卸載機制。這會使用更新的複本引擎、使用前幾個複本在每個組成 Volume 中填入本機快取。然後使用此本機快取、根據需要快速產生 VM 複本。</block>
  <block id="dd9bd4a686bdeb1c7f11dc3cd0cda75f" category="paragraph">請考慮下列案例：</block>
  <block id="6b277580cb59b13790b36344e827e22f" category="list-text">您已經建立了 8 個組成要素的新 FlexGroup</block>
  <block id="32efd8b10cc3b73c344f4c7e6c4b741e" category="list-text">新 FlexGroup 的快取逾時設定為 160 分鐘</block>
  <block id="879f959734466d50681eae9b95e7e591" category="paragraph">在此案例中、要完成的前 8 個複本將為完整複本、而非本機檔案複本。在 160 秒逾時過期之前、對該 VM 進行任何額外的複製、都會以循環方式使用每個組成要素內部的檔案複製引擎、以建立幾乎立即的複本、並在組成的磁碟區之間平均分配。</block>
  <block id="b368b4dbd46dd778776d405dc46d2033" category="paragraph">Volume 接收的每個新複製工作都會重設逾時。如果範例 FlexGroup 中的組成磁碟區在逾時之前未收到複製要求、則會清除該特定 VM 的快取、而且需要再次填入該磁碟區。此外、如果原始複本的來源變更（例如、您已更新範本）、則每個成分的本機快取都會失效、以避免任何衝突。快取是可調整的、可設定以符合您環境的需求。</block>
  <block id="0f98175ace2dd0d56e47961b22b2544b" category="paragraph">在無法充分利用 FlexGroup 快取、但仍需要快速跨磁碟區複製的環境中、請考慮使用 vVols 。使用 vVols 進行跨磁碟區複製的速度比使用傳統資料存放區快得多、而且不依賴快取。</block>
  <block id="189aae773e13462525f07e99fcd9e90f" category="inline-link">VAAI ：快取如何與 FlexGroup 磁碟區搭配運作？</block>
  <block id="718103d957da7fb9e8210a49a85aedab" category="paragraph">如需搭配 VAAI 使用 FlexGroups 的詳細資訊、請參閱知識庫文章：<block ref="23db52497ce446299e31ecc0b7572649" category="inline-link-rx"></block></block>
  <block id="eafcbe529f542610c50d02e4a2fffcd6" category="paragraph">ONTAP 9.8 也為 FlexGroup Volume 檔案新增檔案型效能指標（ IOPS 、處理量和延遲）、這些指標可在 ONTAP 工具中檢視、以取得 VMware vSphere 儀表板和 VM 報告。VMware vSphere外掛程式的支援功能也可讓您使用最大和/或最小IOPS的組合來設定服務品質（QoS）規則。ONTAP這些設定可以跨資料存放區中的所有VM進行設定、也可以針對特定VM個別設定。</block>
  <block id="b8c631b88d7be5f1105be2f8c7ff3213" category="list-text">使用 FlexGroup Volume 資源配置預設值。建議使用VMware vSphere的VMware vSphere功能、因為它能在vSphere中建立及掛載功能、但可能會使用VMware System Manager或命令列來滿足特殊需求。ONTAP FlexGroup ONTAP即使如此、也請使用預設值、例如每個節點的組成成員數目、因為這是 vSphere 最徹底的測試結果。也就是說、非預設的設定、例如變更成分的數量或位置、仍受到完整支援。</block>
  <block id="301593c45668093a7eb242d138c597a3" category="list-text">調整 FlexGroup 型資料存放區的規模時、請記住、 FlexGroup 包含多個較小的 FlexVol 磁碟區、可建立較大的命名空間。因此、當使用八個組成要素的 FlexGroup 時、請確定資料存放區大小至少是最大虛擬機器的 8 倍。例如、如果您的環境中有6TB的VM、FlexGroup 請將該資料存放區的大小調整至不小於48TB。</block>
  <block id="04cc9e0b9478cc704d42735886027630" category="list-text">使用適用於VMware VAAI的NFS外掛程式進行複本卸載。請注意、雖然如前所述、在 FlexGroup 資料存放區內增強複製功能、但在 FlexVol 和 / 或 FlexGroup 磁碟區之間複製 VM 時、 ONTAP 並未提供與 ESXi 主機複本相比的顯著效能優勢。因此、在決定使用 VAAI 或 FlexGroups 時、請考慮您的複製工作負載。修改組成磁碟區的數量是最佳化 FlexGroup 型複製的一種方法。如同調整快取逾時。</block>
  <block id="b9e0a0134c0815e50bb71d8dd7e367b6" category="list-text">QoS（最大/最小IOPS）可在個別VM或資料存放區中的所有VM上設定。在所有VM上設定QoS會取代任何個別VM設定。設定未來不會延伸至新的或移轉的VM；您可以在新的VM上設定QoS、或是將QoS重新套用至資料存放區中的所有VM。如果 VM 移轉至另一個資料存放區、則 FlexGroup QoS 原則也不會遵循該 VM 。這與 vVols 形成對照、 vVols 可在移轉至其他資料存放區時、維持其 QoS 原則設定。</block>
  <block id="1133ff8355478000111c8b1969e32770" category="list-text">SnapCenter Plug-in for VMware vSphere 4.4 版及更新版本支援在主要儲存系統上的 FlexGroup 資料存放區中備份及還原 VM 。4.6 號選擇控制閥增加了對 FlexGroup 型資料存放區的 SnapMirror 支援。</block>
  <block id="ce4df831657d2621e80bbef9271c33cd" category="summary">隨著舊有虛擬應用裝置的移轉、ONTAP VMware的功能豐富、限制更高、並提供全新vVols支援。</block>
  <block id="45b1565c472fff4046d0f7ddbe1342f2" category="doc">SRM和ONTAP VMware Tools的新功能</block>
  <block id="116d20fc387d73c8e4a86e7998913947" category="section-title">vSphere和Site Recovery Manager的最新版本</block>
  <block id="57359b8d2b77ce83f2e854fdd323377f" category="paragraph">隨着 SRM 8.7 及更新版本以及 9.12 及更新版本的 ONTAP 工具的發佈、您現在可以保護在 VMware vSphere 8 更新 1 上執行的 VM 。</block>
  <block id="96ca6fcc2ffdab3c06d0875be8d4fe29" category="paragraph">NetApp已與VMware建立了近二十年的深厚合作關係、並致力於盡快提供最新版本的支援。請務必查看NetApp互通性對照表工具IMT （NetApp Interoperability Matrix Tool、簡稱「參考資訊」）、以取得最新的合格軟體組合。</block>
  <block id="4ada3eb5b908caaedb757052562dfcf5" category="inline-link-macro"><block ref="4ada3eb5b908caaedb757052562dfcf5" category="inline-link-rx"></block></block>
  <block id="0a0a2a299629bed81a283fcd3b7833e9" category="paragraph">NetApp IMT 位於 <block ref="83e08b5e992bc41d59feec38bb24f26d" category="inline-link-macro-rx"></block>。</block>
  <block id="9d6e1631f68d52fd0f82222bf276cdc4" category="section-title">VVols 支援（以及為何儲存原則型管理（ SPBM ）至關重要、即使使用 SRM 亦然）</block>
  <block id="b0b7bc3c901f340c708b7560d1f2b7e1" category="paragraph">從 8.3 版本開始、 SRM 現在支援以儲存原則為基礎的複寫管理（ SPBM ）、利用 vVols 和陣列型複寫功能、針對使用 iSCSI 、 FCP 和 NFS v3 的資料存放區進行複寫。為達成此目標、 SRM 伺服器已更新為包含新的 SRM vVols 提供者服務、此服務會針對 VASA 相關工作、與 vCenter 伺服器的 SMS 服務進行通訊。</block>
  <block id="4567f5576b4577c63b126cac3f6aa5fa" category="paragraph">此架構的一項優點是不再需要SRA、因為所有的工作都是使用VASA來處理。</block>
  <block id="e04031e1cecdb6732f91d44b204dbcf3" category="paragraph">SPBM是vSphere工具箱中功能強大的工具、可在私有雲和混合雲環境中、透過自動化架構、提供簡化、可預測且一致的儲存服務供使用。從根本上說、SPBM可讓您定義符合多元客戶群需求的服務類別。SRM現在可讓您針對需要健全的業界標準災難恢復協調與自動化的關鍵工作負載、向客戶展示複寫功能。</block>
  <block id="1b6204fa76bd422416757c4e2d6187bd" category="paragraph">使用 FCP 或 iSCSI 的 VVols 架構範例：</block>
  <block id="6f1ad7cac2af0e3b92a3936efc393a0e" category="paragraph"><block ref="6f1ad7cac2af0e3b92a3936efc393a0e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="9abbd7aed7e9791d9c52e8e17f34a756" category="section-title">支援應用裝置型 SRM 伺服器</block>
  <block id="925c477f139cce0692e13946a7f75eac" category="paragraph">除了舊版的Windows平台之外、現在還支援以pherton OS為基礎的SRM伺服器。</block>
  <block id="62c2c4203aebe081ddbc6cdd489f8ad7" category="paragraph">您現在可以安裝SRA介面卡、無論您偏好的SRM伺服器類型為何。</block>
  <block id="7cb1700928c008eb817bc79250cc9002" category="section-title">支援IPv6</block>
  <block id="ea9aacd1495949730de8eeab11e66459" category="paragraph">現在支援IPv6、但有下列限制：</block>
  <block id="d6d7f3d43de975c07655ebba1936867a" category="list-text">vCenter 6.7或更新版本</block>
  <block id="eb26ee1a20fe3dbde98204ec8b3ab838" category="list-text">不支援SRM 8.2（8.1、8.3和8）。支援4個）</block>
  <block id="918d32b75f0ab883abba3a8dc0c3ae8d" category="inline-link">互通性對照表工具</block>
  <block id="02e7e71042609d3158020ab7befe45c6" category="list-text">請檢查<block ref="218f4ad7153f69cdc5467065434cd2f0" category="inline-link-rx"></block> 以取得最新的合格版本。</block>
  <block id="e887aed8f9c3dbecd37e8896d96b6637" category="section-title">提升效能</block>
  <block id="2a71574e89a69c8218fbac3f604b5728" category="paragraph">營運效能是執行SRM工作的關鍵需求。為了滿足現代 RTO 和 RPO 的需求、採用 ONTAP 工具的已新增三項改良功能。</block>
  <block id="bd403c539a0c414afacd7477bf3d311f" category="list-text">*支援並行重新保護作業。*第一次於SRA 9.2.1中推出、啟用此功能可讓您同時在兩個以上的恢復計畫上執行重新保護、進而縮短容錯移轉或移轉後重新保護資料存放區所需的時間、並保留在RTO和RPO參數範圍內。</block>
  <block id="f63b947f655a5aee2cf69d4f30d7f96b" category="list-text">*《支援工具》9.8新增了一種僅限NAS的最佳化模式。*當您使用SVM範圍的帳戶、並僅使用NFS型資料存放區連線至VMware叢集時、您可以啟用僅限NAS的最佳化模式、在支援的環境中達到尖峰效能。ONTAP ONTAP</block>
  <block id="c82379d922d9cdc55fa21affe9f9b8bf" category="list-text">* ONTAP 工具 9.12 增加了對 ONTAP SnapMirror 快速重新同步功能的支援。 * 這可在需要重新計算儲存效率後、快速重新同步鏡像。此功能預設不會使用、但可在大型環境中啟用、而大型環境中的傳統重新同步需要太長時間或逾時。</block>
  <block id="4a4842d7448ef71eb69b013e560b18bb" category="section-title">擴充性更高</block>
  <block id="26738e8d40ae8035805f13bdbf185c30" category="paragraph">搭配SRM 8.3及更新版本使用時、可支援多達500個保護群組（PG）的支援工具SRA。ONTAP</block>
  <block id="96cb4d41ca97bd9d3d446984d3170a57" category="paragraph">SnapMirror Synchronous（SM-S）搭配ONTAP 了一套功能、可提供大量精細零RPO資料複寫解決方案、適合任務關鍵型應用程式、這項功能值得期待且期待已久。SM - S需要ONTAP 使用VMware工具9.8或更新版本。</block>
  <block id="b9832b10a87d0c3793ed3b413ee1d839" category="section-title">REST API支援</block>
  <block id="0065ce57adc813187a8e9c640ba6223a" category="paragraph">SRA伺服器組態現在可由REST API管理。我們新增了 Swagger UI 來協助您建置自動化工作流程、您可以在 ONTAP 工具應用裝置上找到<block ref="579ce3ee0a7c1521f3dce6a507ea64a0" prefix=" " category="inline-code"></block>。</block>
  <block id="dcaf091737df278b1b4bdd2e37c10a75" category="summary">自ONTAP 2002年推出現代化資料中心以來、NetApp功能一直是VMware vSphere環境的領先儲存解決方案、並持續增加創新功能、以簡化管理、同時降低成本。</block>
  <block id="0a0e655ee9ba6467857ebf014a268f29" category="doc">VMware Site Recovery Manager 搭配 NetApp ONTAP</block>
  <block id="5bdb12cbb14efa98a61e7c5e3b4de108" category="admonition">本文件取代先前發佈的技術報告 _TR-4900: VMware Site Recovery Manager with ONTAP</block>
  <block id="e3445c3aa798f5ad98665e33d34dd952" category="paragraph">最佳實務做法是輔助其他文件、例如指南和相容性工具。這些技術是根據實驗室測試和NetApp工程師與客戶廣泛的現場經驗所開發。在某些情況下、建議的最佳實務做法可能不適合您的環境；不過、它們通常是最簡單的解決方案、能滿足大多數客戶的需求。</block>
  <block id="10b8f80c23f8a44dfa6b10ae56d7dbe9" category="paragraph">本文件著重於最新版 ONTAP 9 的功能、這些功能搭配適用於 VMware vSphere 9.12 的 ONTAP 工具（包括 NetApp 儲存複寫介面卡 [SRA] 和 VASA Provider [VP] ）、以及 VMware Site Recovery Manager 8.7 。</block>
  <block id="c40f8c2af56356193284f6b46865d954" category="section-title">為何ONTAP 要搭配SRM使用此功能？</block>
  <block id="36c28121fc6c9b02a38c0b6c92654e9a" category="paragraph">NetApp資料管理平台採用ONTAP VMware軟體、是SRM最廣泛採用的儲存解決方案之一。理由十分豐富：安全、高效能、統一化的傳輸協定（ NAS 與 SAN 一起）資料管理平台、提供業界定義的儲存效率、多租戶、服務控制品質、節省空間的快照資料保護、以及使用 SnapMirror 進行複寫。所有這些工具都能運用原生混合式多雲端整合技術來保護VMware工作負載、並在彈指之間提供大量的自動化與協調工具。</block>
  <block id="2242b80f4627736a48c4c9a36b7428f6" category="paragraph">當您使用 SnapMirror 進行陣列型複寫時、您將會充分利用 ONTAP 最成熟的技術之一。SnapMirror可讓您享有安全且高效率的資料傳輸優勢、只複製變更的檔案系統區塊、而非複製整個VM或資料存放區。即使是這些區塊、也能善用空間節約效益、例如重複資料刪除、壓縮及壓縮等。現代化ONTAP 的支援系統現在使用獨立於版本的SnapMirror、讓您能夠靈活選擇來源和目的地叢集。SnapMirror已真正成為最強大的災難恢復工具之一。</block>
  <block id="36b04390d6103d8075862e4b825a485e" category="paragraph">無論您使用傳統NFS、iSCSI或光纖通道附加資料存放區（現在支援vVols資料存放區）、SRM都能提供強大的第一方產品、充分發揮ONTAP 災難恢復或資料中心移轉規劃與協調的最佳功能。</block>
  <block id="5d111e8a6885460b43ecf1f7abb6377e" category="section-title">SRM如何運用ONTAP VMware®</block>
  <block id="16d4ec242c9f020f3a1fade311c776ed" category="paragraph">SRM利用ONTAP VMware ONTAP vSphere的進階資料管理技術與VMware vSphere的VMware vSphere工具整合、此虛擬應用裝置包含三個主要元件：</block>
  <block id="d54038ba1f2a04a5b5f26c96627ae3e7" category="list-text">vCenter外掛程式先前稱為虛擬儲存主控台（VSC）、可簡化儲存管理與效率功能、增強可用度、並降低儲存成本與營運成本、無論您使用SAN或NAS。它採用最佳實務做法來配置資料存放區、並針對NFS和區塊儲存環境最佳化ESXi主機設定。為獲得所有這些好處、NetApp建議您在使用vSphere搭配執行ONTAP VMware軟體的系統時、使用此外掛程式。</block>
  <block id="a106bb15d6dc2b11535ed4fefc81fbf4" category="list-text">VASA Provider for ONTAP VMware vStorage API for Storage感知（VASA）架構。VASA Provider將vCenter Server與ONTAP VMware連線、以協助資源配置及監控VM儲存設備。它可支援VMware虛擬磁碟區（vVols）、並管理儲存功能設定檔（包括vVols複寫功能）和個別VM vVols效能。它也提供監控容量和設定檔法規遵循的警示。搭配SRM使用時、VASA Provider ONTAP for VMware可支援vVols型虛擬機器、而不需要在SRM伺服器上安裝SRA介面卡。</block>
  <block id="f2007951062862f5f0d593acbb23bcb4" category="list-text">SRA與SRM搭配使用、可管理傳統VMFS與NFS資料存放區的正式作業與災難恢復站台之間的VM資料複寫、也可用於災難恢復複本的不中斷測試。它有助於自動化探索、還原及重新保護等工作。其中包括適用於Windows SRM伺服器和SRM應用裝置的SRA伺服器應用裝置和SRA介面卡。</block>
  <block id="8ccaa60ee78ecc93c4870b3b2ad15284" category="paragraph">在SRM伺服器上安裝並設定SRA介面卡、以保護VASA Provider設定中的非vVols資料存放區和/或啟用vVols複寫之後、即可開始設定vSphere環境進行災難恢復。</block>
  <block id="0a1e25166326359cd5f50d0ab83e6a37" category="paragraph">SRA與VASA Provider提供SRM伺服器的命令與控制介面、可管理ONTAP 包含VMware虛擬機器（VM）的VMware FlexVols、以及保護它們的SnapMirror複寫。</block>
  <block id="38db855935949f86c5db7bfe7d49873e" category="paragraph">從SRM 8.3開始、SRM伺服器引進新的SRM vVols Provider控制路徑、讓它能與vCenter伺服器通訊、並透過該路徑與VASA Provider通訊、而不需要SRA。如此一來、SRM伺服器就能比ONTAP 以往更深入地控制這個叢集、因為VASA提供完整的API來進行緊密耦合的整合。</block>
  <block id="1c27364cc3705aff403c6ef131c347ff" category="paragraph">SRM 可以使用 NetApp 專屬的 FlexClone 技術、在不中斷營運的情況下測試您的災難恢復計畫、在災難恢復站台上為受保護的資料存放區建立近乎即時的複本。SRM會建立沙箱以安全地進行測試、讓組織和客戶在發生真正災難時受到保護、讓您對組織在災難期間執行容錯移轉的能力充滿信心。</block>
  <block id="04a8f82007ed4bec45053912a49b6f85" category="paragraph">如果發生真正的災難、甚至是計畫性的移轉、SRM可讓您透過最終的SnapMirror更新（如果您選擇這樣做）、將任何最後一分鐘的變更傳送至資料集。然後中斷鏡射、並將資料存放區掛載至DR主機。此時、您的VM可以根據預先規劃的策略、以任何順序自動開機。</block>
  <block id="b2560426a08ae6ceb167dad2bfb5e8ae" category="section-title">SRM搭配ONTAP 功能完善和其他使用案例：混合雲和移轉</block>
  <block id="ed4c730bd8636c27d3eaa876c63b3d45" category="inline-link">Equinix的NetApp私有儲存設備</block>
  <block id="b422e05bc5c6f52208b66ff51d718b9d" category="paragraph">與ONTAP 本地儲存選項相比、將SRM部署與豐富的資料管理功能整合、可大幅提升擴充性與效能。除此之外、它還能帶來混合雲的靈活度。混合雲可將未使用的資料區塊從高效能陣列分層、到您偏好的超大規模擴充系統（FabricPool 例如NetApp Sirse-）、藉此節省成本StorageGRID 。您也可以使用ONTAP Select SnapMirror來搭配使用Cloud Volumes ONTAP 以軟體定義的功能、或是使用功能（CVO）或雲端型DR的邊緣型系統<block ref="37a666d3a37f1c4a8c4c8dba379664a4" category="inline-link-rx"></block> 適用於Amazon Web Services（AWS）、Microsoft Azure和Google Cloud Platform（GCP）、可在雲端中建立完全整合的儲存設備、網路和運算服務堆疊。</block>
  <block id="87a7b114355b836acefe833c497611bb" category="paragraph">接著、您可以在雲端服務供應商的資料中心內執行測試容錯移轉、因為 FlexClone 的儲存佔用空間接近零。保護組織的成本現在比以往更低。</block>
  <block id="12d0cbcf61df7df30bf9b020f6fbb051" category="paragraph">SRM也可利用SnapMirror、將VM從一個資料中心有效地傳輸到另一個資料中心、甚至是同一個資料中心內、無論您是自己、或是透過任何數量的NetApp合作夥伴服務供應商、來執行計畫性的移轉作業。</block>
  <block id="160f88ca0bed5b24e94c809f4e22f1e7" category="summary">在流程9中ONTAP 、叢集管理員可以看到叢集的實體元件、但使用叢集的應用程式和主機無法直接看到這些元件。</block>
  <block id="89fafdb11a7e8cd8abebb1d4df053dad" category="doc">複寫拓撲</block>
  <block id="be01acd2f018d38f9446f06b99ee4a2a" category="paragraph">在流程9中ONTAP 、叢集管理員可以看到叢集的實體元件、但使用叢集的應用程式和主機無法直接看到這些元件。實體元件提供一個共享資源集區、用於建構邏輯叢集資源。應用程式和主機只能透過含有磁碟區和LIF的SVM存取資料。</block>
  <block id="7758fc02779ee5917b0a09ee22b52221" category="paragraph">在VMware vCenter Site Recovery Manager中、每個NetApp SVM都被視為陣列。SRM支援特定的陣列對陣列（或SVM對SVM）複寫配置。</block>
  <block id="58c0b55a67f4331cc49b073a7183e06c" category="paragraph">單一VM無法在多個SRM陣列上擁有資料（虛擬機器磁碟（VMDK）或RDM）、原因如下：</block>
  <block id="880aeda0b58c0b30120b6319ae5f3beb" category="list-text">SRM只能看到SVM、而非個別的實體控制器。</block>
  <block id="6f55124e085dbeb640e4cb8ad2c97905" category="list-text">SVM可控制橫跨叢集中多個節點的LUN和磁碟區。</block>
  <block id="39d9903201320a83d45d3b36d512f051" category="cell">最佳實務做法</block>
  <block id="d86019fe4ba86b184ac71cf24a22f0c6" category="cell">若要判斷可支援性、請謹記此規則：若要使用SRM和NetApp SRA來保護VM、VM的所有部分都必須只存在於一個SVM上。此規則同時適用於受保護的站台和恢復站台。</block>
  <block id="2e4472d35f80aa8b7eca52ae3dd43dc6" category="section-title">支援的SnapMirror配置</block>
  <block id="d070ad9d8397892aa7f317cbb9046661" category="paragraph">下圖顯示了SRM和SRA支援的SnapMirror關係配置案例。複寫磁碟區中的每個VM在每個站台只擁有一個SRM陣列（SVM）上的資料。</block>
  <block id="39d3085abe6ccb914d8535de8a5f3e37" category="paragraph"><block ref="39d3085abe6ccb914d8535de8a5f3e37" category="inline-image-macro-rx" type="image"></block></block>
  <block id="1ae7670cf947a397bdf6a882fbcc912a" category="paragraph"><block ref="1ae7670cf947a397bdf6a882fbcc912a" category="inline-image-macro-rx" type="image"></block></block>
  <block id="111d3212464dba203cbd675a0338dcbc" category="paragraph"><block ref="111d3212464dba203cbd675a0338dcbc" category="inline-image-macro-rx" type="image"></block></block>
  <block id="c5dc3a606b05b41db22793ed3c1a72db" category="paragraph"><block ref="c5dc3a606b05b41db22793ed3c1a72db" category="inline-image-macro-rx" type="image"></block></block>
  <block id="86cf5bd2bdb1b1d67f8f907f41099509" category="section-title">支援的Array Manager配置</block>
  <block id="aacc8f18d659f75715d91a983e872233" category="paragraph">當您在SRM中使用陣列型複寫（ABR）時、保護群組會隔離為單一陣列配對、如下面的快照所示。在此案例中、<block ref="129864522ed0e4ac80f306ecfa130ef7" prefix=" " category="inline-code"></block> 和<block ref="ec87aa7f4c8e70a139fd988f87b6549f" prefix=" " category="inline-code"></block> 與我們合作<block ref="387d04b65848414d4697f145a3782f90" prefix=" " category="inline-code"></block> 和<block ref="58bdbfcb72c2dd3d883a7ca754443a4c" prefix=" " category="inline-code"></block> 在恢復站點上。不過、您只能在建立保護群組時、從兩個陣列配對中選取一個。</block>
  <block id="68a1b289711a591ed50627014cd01ce9" category="paragraph"><block ref="68a1b289711a591ed50627014cd01ce9" category="inline-image-macro-rx" type="image"></block></block>
  <block id="1ceb46f3e1c6c7995de4ec5f05601227" category="section-title">不支援的配置</block>
  <block id="611b9b35ac984f20e6594baec9181dbf" category="paragraph">不受支援的組態在個別VM擁有的多個SVM上有資料（VMDK或RDM）。在下列圖中所示的範例中、<block ref="df777c4d2477e55571925353ce589f7e" prefix=" " category="inline-code"></block> 無法使用 SRM 進行保護設定、原因是<block ref="df777c4d2477e55571925353ce589f7e" prefix=" " category="inline-code"></block> 在兩個 SVM 上有資料。</block>
  <block id="5c251a65e8394fbeaf104ba1a1cad2e1" category="paragraph"><block ref="5c251a65e8394fbeaf104ba1a1cad2e1" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f5f5fe64e0e9d0ae7ce2a0777d0ccf62" category="paragraph"><block ref="f5f5fe64e0e9d0ae7ce2a0777d0ccf62" category="inline-image-macro-rx" type="image"></block></block>
  <block id="69851ac8c2fa81b32799efc8522798d5" category="paragraph">任何將個別NetApp磁碟區從一個來源SVM複寫到同一個SVM或不同SVM中的多個目的地的複寫關係、都稱為SnapMirror連出。SRM不支援連出。在下圖所示範例中、<block ref="df777c4d2477e55571925353ce589f7e" prefix=" " category="inline-code"></block> 無法在 SRM 中進行保護設定、因為它會與 SnapMirror 一起複寫到兩個不同的位置。</block>
  <block id="688890bdbdfd2d73a05a09883f3c4b40" category="paragraph"><block ref="688890bdbdfd2d73a05a09883f3c4b40" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3f88384b0d5cdcdc25895c644126c1b0" category="section-title">SnapMirror串聯</block>
  <block id="7ebde774ad43c45667d5544308a6d688" category="paragraph">SRM不支援SnapMirror關係的串聯、在這種關係中、來源磁碟區會複寫到目的地磁碟區、而目的地磁碟區也會使用SnapMirror複寫到另一個目的地磁碟區。在下圖所示的案例中、SRM無法用於任何站台之間的容錯移轉。</block>
  <block id="2990fc44e9ba827a397e96e1c278a02a" category="paragraph"><block ref="2990fc44e9ba827a397e96e1c278a02a" category="inline-image-macro-rx" type="image"></block></block>
  <block id="8bd15e818d377a0a5cf6ebc429555f79" category="section-title">SnapMirror與SnapVault</block>
  <block id="d440734d1f5d9c6e59aa97f7cbbcd525" category="paragraph">NetApp SnapVault 解決方案軟體可在NetApp儲存系統之間、以磁碟形式備份企業資料。可在同一個環境中共存的VMware vCenter和SnapMirror、不過SRM僅支援SnapMirror關係的容錯移轉。SnapVault</block>
  <block id="7878dfbf4b6ad3bc60d095cf89d79202" category="admonition">NetApp 支援<block ref="e7d3e049f94ce3ff8a47f209f012173d" prefix=" " category="inline-code"></block> 原則類型。</block>
  <block id="883e69a285ae2d5fd23c80cd29285804" category="paragraph">為了執行效能提升8.2、從一開始就重建了這個系統。SnapVault ONTAP儘管以前Data ONTAP 的使用者應該會發現相似點、SnapVault 但本版的VMware已經做出重大的改善。其中一項重大進展是SnapVault 、能夠在傳輸過程中維持主要資料的儲存效率。</block>
  <block id="9bc21373e0e299579a7ac86dcd4f513d" category="paragraph">架構上的一項重要變更是SnapVault 、在ONTAP Volume層級進行的不只是qtree層級的不完整複寫、7-Mode SnapVault 的情況就是如此。這項設定表示SnapVault 、來源的不景點必須是一個Volume、而且該Volume必須複寫到SnapVault 自己的Volume上的不二系統。</block>
  <block id="d447048519c85a2fb3bea0790cd109fb" category="paragraph">在使用 SnapVault 的環境中、會在主要儲存系統上建立特別命名的快照。根據實作的組態而定、命名快照可由 SnapVault 排程或 NetApp Active IQ Unified Manager 等應用程式在主要系統上建立。然後，在主系統上創建的命名快照將被複制到 SnapMirror 目標，並從該目的地將其保存到 SnapVault 目的地。</block>
  <block id="5dd37b7cd36f7d38ba2e6a63c603be4c" category="paragraph">您可以在串聯組態中建立來源Volume、將磁碟區複寫到DR站台的SnapMirror目的地、然後從該磁碟區保存到SnapVault 一個目的地。來源Volume也可建立在連出關係中、其中一個目的地是SnapMirror目的地、另一個目的地SnapVault 是一個目的地。不過、SRA不會在SnapVault 發生SRM容錯移轉或複寫反轉時、自動重新設定「還原」關係、以使用SnapMirror目的地Volume作為資料庫的來源。</block>
  <block id="5bc66b9c84b3f7cc0b375e729376b68d" category="inline-link">TR-4015《SnapMirror組態最佳實務指南ONTAP 》（英文）。</block>
  <block id="0d510e96259254d285c6aaeb8458f45d" category="paragraph">如需SnapMirror和SnapVault 適用於ONTAP SnapMirror的更新資訊、請參閱<block ref="32e7c991f675bf983c547a2a174c2caf" category="inline-link-rx"></block></block>
  <block id="75f8a2d99eea9f336120aec69d8c1010" category="cell">如果SnapVault 在同一個環境中使用了VMware vCenter和SRM、NetApp建議使用SnapMirror SnapVault 來進行還原串聯組態、SnapVault 以便從DR站台的SnapMirror目的地執行還原備份。發生災難時、此組態會使主要站台無法存取。將SnapVault 還原目的地保留在恢復站台、可在SnapVault 容錯移轉後重新設定還原功能、SnapVault 以便在恢復站台上操作時繼續執行還原備份。</block>
  <block id="e082a67e3ddd7f4f92096536440cbb34" category="paragraph">在VMware環境中、每個資料存放區都有通用唯一識別碼（UUID）、而且每個VM都有唯一的託管物件ID（MOID）。在容錯移轉或容錯回復期間、SRM不會維護這些ID。由於SRM在容錯移轉期間不會維護資料存放區UUID和VM MOID、因此在SRM容錯移轉之後、任何依賴這些ID的應用程式都必須重新設定。例如NetApp Active IQ Unified Manager 解決方案就是應用程式、它可協調SnapVault vSphere環境中的功能複寫。</block>
  <block id="657a41cce55646ab17754ac1427970af" category="paragraph">下圖說明SnapMirror至SnapVault SnapMirror串聯組態。如果該站台位於DR站台或第三站台、但不受主站台中斷影響、則可重新設定環境、以便在容錯移轉後繼續備份。SnapVault</block>
  <block id="b56afb9a43332c671116b9fa3d597867" category="paragraph"><block ref="b56afb9a43332c671116b9fa3d597867" category="inline-image-macro-rx" type="image"></block></block>
  <block id="e068178460f103498576eac8ddb7fb82" category="paragraph">下圖說明使用SRM將SnapMirror複寫還原回主要站台之後的組態。環境也經過重新設定、SnapVault 使目前的SnapMirror來源產生了不支援的資料。此設定為SnapMirror SnapVault 的橫向風扇組態。</block>
  <block id="0ffa07ffd89b136d0ed8f2ac5ebcabb8" category="paragraph"><block ref="0ffa07ffd89b136d0ed8f2ac5ebcabb8" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b4607a4ee7e1830ab6ba0007df206956" category="paragraph">在SRM執行容錯回復並第二次反轉SnapMirror關係之後、正式作業資料就會回到主要站台。此資料現在的保護方式與容錯移轉至DR站台之前相同、透過SnapMirror和SnapVault 還原備份。</block>
  <block id="63fd1f18d5d53fa97fd05a7fd96090b4" category="section-title">在Site Recovery Manager環境中使用qtree</block>
  <block id="2d88570ceb2de0d8699a068b0140454b" category="paragraph">qtree是允許應用NAS檔案系統配額的特殊目錄。利用SnapMirror複寫的磁碟區中、能夠建立qtree和qtree。ONTAP不過、SnapMirror不允許複寫個別qtree或qtree層級的複寫。所有SnapMirror複寫僅位於磁碟區層級。因此、NetApp不建議搭配SRM使用qtree。</block>
  <block id="345cb3f040f9f7f3f1a4261ed260aa79" category="section-title">混合式FC與iSCSI環境</block>
  <block id="a60b166c2b69b4fdfbb733dc2193668a" category="paragraph">藉由支援的SAN傳輸協定（FC、FCoE和iSCSI）ONTAP 、支援的LUN服務、也就是能夠建立LUN並將其對應至連接的主機。由於叢集由多個控制器組成、因此有多個邏輯路徑是由多重路徑I/O管理、可通往任何個別LUN。主機上使用非對稱邏輯單元存取（ALUA）、以便選取LUN的最佳化路徑、並使其成為資料傳輸的作用中路徑。如果任何LUN的最佳化路徑有所變更（例如、因為包含的磁碟區已移動）、ONTAP 則針對此變更、支援不中斷地自動辨識及調整。如果最佳化路徑無法使用、ONTAP 則不中斷營運地切換至任何其他可用路徑。</block>
  <block id="b9921ac732e72656bc2836f83bb09522" category="paragraph">VMware SRM和NetApp SRA支援在一個站台使用FC傳輸協定、在另一個站台使用iSCSI傳輸協定。不過、它不支援在同一個ESXi主機或同一個叢集中的不同主機上混合使用FC附加資料存放區和iSCSI附加資料存放區。SRM不支援此組態、因為在SRM容錯移轉或測試容錯移轉期間、SRM會在要求中包含ESXi主機中的所有FC和iSCSI啟動器。</block>
  <block id="fccd44a96243e459128798803dca70aa" category="cell">SRM和SRA支援受保護站台與恢復站台之間的混合FC和iSCSI傳輸協定。不過、每個站台只能設定一個FC或iSCSI傳輸協定、而非在同一個站台設定兩個傳輸協定。如果要求在同一個站台同時設定FC和iSCSI傳輸協定、NetApp建議某些主機使用iSCSI、而其他主機則使用FC。在此情況下、NetApp也建議設定SRM資源對應、以便將VM設定為容錯移轉至一組主機或另一組主機。</block>
  <block id="963739e9818c0bf4d8959b5cdf6a7956" category="summary">使用vVols複寫時、SRM內部的工作流程與SRA和傳統資料存放區使用的工作流程大不相同。</block>
  <block id="56687c1a324f03f5d1429500efea710e" category="doc">使用vVols複寫時疑難排解SRM</block>
  <block id="14acf40cbe69d8682b4c844ac7fbf7f6" category="paragraph">使用vVols複寫時、SRM內部的工作流程與SRA和傳統資料存放區使用的工作流程大不相同。例如、沒有Array Manager概念。因此、<block ref="0ec64480a9620a1430c0ae1b6603ea01" prefix=" " category="inline-code"></block> 和<block ref="ba6c59072f543cb828e47d5bac560371" prefix=" " category="inline-code"></block> 從未見過命令。</block>
  <block id="ef74d715544e3b067a6bec3218ac5044" category="paragraph">疑難排解時、瞭解下列新工作流程會有所助益：</block>
  <block id="47f0942d341ee10381b2eff35089d75d" category="list-text">查詢複製對等方：探索兩個故障網域之間的複寫合約。</block>
  <block id="136a299aae29998a147852cb0cba5b4a" category="list-text">查詢FaultDomain：探索故障網域階層。</block>
  <block id="c071098c5df923c31f6245e4db2f3861" category="list-text">查詢複製群組：探索來源或目標網域中的複寫群組。</block>
  <block id="792cfe9ad3a3dc8528080a262e92989a" category="list-text">SyncReplicationGroup：在來源與目標之間同步資料。</block>
  <block id="39afb1e1e3b180a6230e07bb8571667e" category="list-text">查詢點時間複本：探索目標上的時間點複本。</block>
  <block id="9fb25fe2ff084dc9ccfb99eaccba7212" category="list-text">testFailoverReplicationGroupStart：開始測試容錯移轉。</block>
  <block id="bd4e1dacaca4c37a53b5286b6ae0239d" category="list-text">testFailoverReplicationGroupStop：結束測試容錯移轉。</block>
  <block id="887f376a43cf9de1d6e14a8d69e588f6" category="list-text">促銷複製群組：將目前正在測試的群組推廣至正式作業。</block>
  <block id="17ab16c5c0786ff381e6a085318bad9b" category="list-text">PrepareFailoverReplicationGroup：準備災難恢復。</block>
  <block id="665dd64ebcc4016bda94e0e8020d8c8e" category="list-text">容錯移轉複製群組：執行災難恢復。</block>
  <block id="6936cf00e30b7cd4421225113a023c3e" category="list-text">混響複寫群組：啟動反轉複寫。</block>
  <block id="61ac8950a043e6998b458d4f8171154c" category="list-text">queryMatchingContainer：尋找容器（連同主機或複寫群組）、以特定原則來滿足資源配置要求。</block>
  <block id="05c9efdc056d2af4640bc441ab61b53a" category="list-text">查詢資源中繼資料：從VASA提供者探索所有資源的中繼資料、可傳回資源使用率做為查詢配對Container功能的答案。</block>
  <block id="01fa56986f885c588b1be8c206623de8" category="paragraph">設定vVols複寫時最常見的錯誤是無法發現SnapMirror關係。這是因為磁碟區和SnapMirror關係是在ONTAP 不屬於「需求工具」範圍的情況下建立。因此、最佳實務做法是在ONTAP 嘗試建立複寫的vVols資料存放區之前、務必確認SnapMirror關係已完全初始化、並在兩個站台上執行「ReDiscovery工具」中的重新探索。</block>
  <block id="3e4627f6667f830baceaaf35890b575a" category="summary">若要深入瞭解本文所述資訊、請檢閱下列文件和/或網站。</block>
  <block id="092bf78f9c97ba171b8232ddff585392" category="doc">其他資訊</block>
  <block id="7d5b957cd473f6eaf5ad335a9c63c4ff" category="paragraph">若要深入瞭解本文所述資訊、請檢閱下列文件和 / 或網站：</block>
  <block id="ccc4b678df8ad6453b7f71661f118ae1" category="inline-link"><block ref="ccc4b678df8ad6453b7f71661f118ae1" category="inline-link-rx"></block></block>
  <block id="b17e2a7e5f42c90b40de5971850339ae" category="list-text">TR-4597：VMware vSphere ONTAP for VMware
<block ref="5938ff9651f6c5e53544676ba8504afc" category="inline-link-rx"></block></block>
  <block id="7d9ee37e3155d571b441d63bcbc54709" category="inline-link"><block ref="7d9ee37e3155d571b441d63bcbc54709" category="inline-link-rx"></block></block>
  <block id="52c629361849219069b336f56f1556d0" category="list-text">TR-4400: VMware vSphere虛擬Volume ONTAP with VMware
<block ref="b7bf139d6051615d8c8e01b6b63dacc3" category="inline-link-rx"></block></block>
  <block id="18df8e05a5400abd9d0980b1c5bc9ef3" category="list-text">TR-4015《SnapMirror組態最佳實務指南ONTAP 》（英文）
<block ref="e361bd9d6f7b20da762bc23fcb3d09c2" category="inline-link-rx"></block></block>
  <block id="cbe2f6eb2a73f4a2c871a06264f10dc7" category="inline-link"><block ref="cbe2f6eb2a73f4a2c871a06264f10dc7" category="inline-link-rx"></block></block>
  <block id="249b98331fa56dc46bf6ba51dc6c39d5" category="list-text">RBAC使用者建立工具ONTAP 以供參考
<block ref="6b15b91279acfce2bbee060bdb17db43" category="inline-link-rx"></block></block>
  <block id="c88037eb28ae3cceb0e32c2cd3c322d7" category="inline-link"><block ref="c88037eb28ae3cceb0e32c2cd3c322d7" category="inline-link-rx"></block></block>
  <block id="1a57e0f74e725c1a5e2d53b4d4b4460d" category="list-text">VMware vSphere資源的相關工具ONTAP
<block ref="80c496cd9ab75e5683007d8f66ca6fbf" category="inline-link-rx"></block></block>
  <block id="9aa6e8f8fac5c131e5924ee033660d29" category="inline-link"><block ref="9aa6e8f8fac5c131e5924ee033660d29" category="inline-link-rx"></block></block>
  <block id="91a48e1708df22b7464bced79c745ad2" category="list-text">VMware Site Recovery Manager文件
<block ref="92ad802ced4838839b492be6d0bf427d" category="inline-link-rx"></block></block>
  <block id="c9dd6bad4c7d561872f2e2d498a990bf" category="inline-link">互通性對照表工具IMT （不含）</block>
  <block id="97cd1357ea4a16b44bd9e360127a1a9d" category="paragraph">請參閱<block ref="99cfde592e1d7fa7832b186d73ee4002" category="inline-link-rx"></block> 在 NetApp 支援網站上，驗證您的特有環境是否支援本文件中所述的明確產品與功能版本。NetApp IMT 解決方案定義了可用於建構NetApp支援組態的產品元件和版本。具體結果取決於每位客戶依照已發佈規格所安裝的產品。</block>
  <block id="1f82b18dcba5f32a085bc502cdd0c6b7" category="summary">利用NetApp技術、儲存虛擬機器（SVM）的概念可在安全的多租戶環境中提供嚴格的區隔。ONTAP</block>
  <block id="7520e12a140ccf3de279fe2fd48889e4" category="doc">部署最佳實務做法</block>
  <block id="1b4574c516231b685bb37b013b789b06" category="section-title">適用於SMT的SVM配置與區隔</block>
  <block id="446e04546ec0567eeeeef8e07368ab40" category="paragraph">利用NetApp技術、儲存虛擬機器（SVM）的概念可在安全的多租戶環境中提供嚴格的區隔。ONTAP某個SVM上的SVM使用者無法從另一個SVM存取或管理資源。如此一ONTAP 來、您就能為不同的業務單位建立獨立的SVM、以便在同一個叢集上管理自己的SRM工作流程、進而提升整體儲存效率、進而充分運用此項技術。</block>
  <block id="f98c1d223f34b2fdaf90eab1a3bc6a25" category="paragraph">考慮ONTAP 使用SVM範圍的帳戶和SVM管理生命體來管理功能、不僅能改善安全控管、也能提升效能。使用SVM範圍的連線時、效能自然會更高、因為SRA不需要處理整個叢集中的所有資源、包括實體資源。而是只需要瞭解抽象化至特定SVM的邏輯資產。</block>
  <block id="849d4d5e8a5d5b2747d8375d2ec03b29" category="paragraph">僅使用NAS傳輸協定（無法存取SAN）時、您甚至可以設定下列參數來使用新的NAS最佳化模式（請注意、此名稱是如此、因為SRA和VASA在應用裝置中使用相同的後端服務）：</block>
  <block id="05f551a655f40911851a53ba0c721997" category="list-text">登入控制面板、網址為<block ref="501a3478972ee5e3d6f109bdc0514bdc" prefix=" " category="inline-code"></block> 然後按一下「網路型 CLI 介面」。</block>
  <block id="b0cc185c73ca964d1429a601551c68f5" category="list-text">執行命令<block ref="4f35e9b3adeccfaf0287d002b134221c" prefix=" " category="inline-code"></block>。</block>
  <block id="5f7e35f90689bef91afe9f01257c61ac" category="list-text">執行命令<block ref="aa610e3ab4e5162f432950793f30a387" prefix=" " category="inline-code"></block>。</block>
  <block id="ba2a1e4d95dc56709260e82cca20a789" category="list-text">執行命令<block ref="6d83e9fce5e947159c3c34b9f499e80e" prefix=" " category="inline-code"></block>。</block>
  <block id="2d14ca751c8ce5a724606e4f75f02c50" category="section-title">部署ONTAP vVols的各種功能與考量</block>
  <block id="fa3a193f1892cf0f45f4a95a35aa3c4b" category="paragraph">如果您打算搭配vVols使用SRM、則必須使用叢集範圍認證和叢集管理LIF來管理儲存設備。這是因為VASA供應商必須瞭解基礎實體架構、才能滿足VM儲存原則所需的原則。例如、如果您的原則需要All Flash儲存設備、則VASA Provider必須能夠查看哪些系統是Flash。</block>
  <block id="31d279d1cc3bc5a4281567ba697f678d" category="paragraph">另一個部署最佳實務做法是、切勿將ONTAP 您的VMware Tools應用裝置儲存在其所管理的vVols資料存放區。這可能會導致您無法開啟VASA供應商的電源、因為您無法為應用裝置建立切換VVol、因為應用裝置離線。</block>
  <block id="97399fb37deca0d463aa5c7dc8d064a6" category="section-title">管理ONTAP 功能的最佳實務做法</block>
  <block id="18f8b81b7fb7ea92f333e127583df17c" category="paragraph">如前所述、您可以ONTAP 使用叢集或SVM範圍內的認證和管理生命體來管理等叢集。為了達到最佳效能、您可能想要在不使用 vVols 時、考慮使用 SVM 範圍的認證。不過、在這樣做的過程中、您應該瞭解某些需求、而且您確實會失去某些功能。</block>
  <block id="fec05e53ca7d96aaf3e4c1a1b2502bea" category="list-text">預設的vsadmin SVM帳戶沒有執行ONTAP 各項功能工作所需的存取層級。因此、您需要建立新的SVM帳戶。</block>
  <block id="d508cbe8ee8a3aa0f975b96403baf33c" category="list-text">如果您使用的是 ONTAP 9.8 或更新版本、 NetApp 建議您使用 ONTAP 系統管理員的使用者功能表、以及 ONTAP 工具應用裝置上的 JSON 檔案來建立 RBAC 最低權限使用者帳戶<block ref="137f8d4bb89dcc34c3bfe48f2a61c95e" prefix=" " category="inline-code"></block>。使用您的系統管理員密碼下載Json檔案。這可用於SVM或叢集範圍內的帳戶。</block>
  <block id="a7a83b5e4f375c0585588b9c7ff92219" category="inline-link">NetApp 支援網站工具箱</block>
  <block id="fdfe9ba9104df6a32fff0f859291ea3c" category="paragraph">如果您使用ONTAP 的是32個以上版本的版本、則應使用中提供的RBAC使用者建立工具（RUC）<block ref="bdbf96c18cf8ac76d01fba7057b81b87" category="inline-link-rx"></block>。</block>
  <block id="ea7a3d08d55dc3e8ecf89d2a5d5e302d" category="list-text">由於vCenter UI外掛程式、VASA Provider和SRA伺服器都是完全整合的服務、因此您必須以在vCenter UI中新增儲存設備以供ONTAP 支援VMware工具的相同方式、將儲存設備新增至SRM的SRA介面卡。否則、SRA伺服器可能無法辨識透過SRA介面卡從SRM傳送的要求。</block>
  <block id="b473de4177eeaa79a66448798a446db3" category="list-text">使用SVM範圍認證時、不會執行NFS路徑檢查。這是因為實體位置從SVM邏輯上抽象化。不過這並不是令人擔心的問題、因為使用ONTAP 間接路徑時、現代的功能不再受到明顯的效能下降影響。</block>
  <block id="6e62430b92a7c5a0b8512436b163a10d" category="list-text">可能不會報告儲存效率所節省的Aggregate空間。</block>
  <block id="93d86aa51e0909549d1b1210f887aef3" category="list-text">在支援的情況下、無法更新負載共用鏡像。</block>
  <block id="647d380b52e259fe7ed2e2582bc54b27" category="list-text">可能無法在ONTAP 以SVM範圍認證來管理的各種系統上執行EMS記錄。</block>
  <block id="c5cd657df037c277c37216b73efb0b08" category="summary">如有可能、請務必使用ONTAP 「資訊工具」來配置資料存放區和磁碟區。這可確保磁碟區、交會路徑、LUN、igroup、匯出原則、 和其他設定均以相容的方式進行設定。</block>
  <block id="d3b26e9021e83573a3d2a9050400a33a" category="doc">營運最佳實務做法</block>
  <block id="4d15db58f26b374b36c283df6b5a5fc1" category="paragraph">當ONTAP 透過SRA使用陣列型複寫時、SRM支援iSCSI、Fibre Channel及NFS版本3 with VMware®9。SRM不支援使用傳統或vVols資料存放區的NFS 4.1版陣列型複寫。</block>
  <block id="61f54ceeb0338787a2ee2d801cbc62cd" category="paragraph">若要確認連線能力、請務必確認您可以從目的地ONTAP 叢集掛載並卸載DR站台上的新測試資料存放區。測試您要用於資料存放區連線的每個傳輸協定。最佳實務做法是使用ONTAP 「VMware工具」來建立測試資料存放區、因為它是依照SRM的指示來執行所有資料存放區自動化作業。</block>
  <block id="0ac3e8abbf45a28af68d22b0f59a973e" category="paragraph">每個站台的SAN傳輸協定應該是同質的。您可以混合使用NFS和SAN、但SAN傳輸協定不應在站台內混合使用。例如、您可以在站台A中使用FCP、而在站台B中使用iSCSI您不應在站台A同時使用FCP和iSCSI原因是SRA不會在恢復站台建立混合式igroup、而且SRM不會篩選指派給SRA的啟動器清單。</block>
  <block id="62a631034cae40cfcee909c69c12c5b3" category="paragraph">NetApp ONTAP 9 可設定為自動移除快照、以在自動調整大小無法提供足夠的緊急容量時、在空間不足的情況下保留正常運作時間。此功能的預設設定不會自動刪除 SnapMirror 所建立的快照。如果刪除 SnapMirror 快照、則 NetApp 無法針對受影響的磁碟區進行反向和重新同步複寫。若要防止 ONTAP 刪除 SnapMirror 快照、請設定 Snapshot 自動刪除功能以嘗試。</block>
  <block id="63b6c8d5e17ef7185a34c4ddd86f9d19" category="inline-link-macro">設定磁碟區以自動擴充或縮減</block>
  <block id="a1874a28c8389c5c687d10167e80dc1f" category="paragraph">Volume 自動調整大小應設為<block ref="4d200fce73a8e1cc965cfc2c43343824" prefix=" " category="inline-code"></block> 適用於包含 SAN 資料存放區和的磁碟區<block ref="d89f4f8b1d7c18847b88b46142f61535" prefix=" " category="inline-code"></block> 適用於 NFS 資料存放區。深入瞭解 <block ref="ebd664f1c7cf128a3758282775d35e72" category="inline-link-macro-rx"></block>。</block>
  <block id="e401bd7c98141814eaf5528ddb318da6" category="section-title">儲存原則型管理（ SPBM ）和 VVols</block>
  <block id="b180e7f35111dca8acd6c56cdbcabb3e" category="paragraph"><block ref="b180e7f35111dca8acd6c56cdbcabb3e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="be41c3baf700984021c43e2e6b661b0a" category="paragraph">以下螢幕快照提供「建立VM儲存原則」精靈中所顯示的SnapMirror排程範例。</block>
  <block id="43c130b36e9e2b3d61409aa974f89fc7" category="paragraph"><block ref="43c130b36e9e2b3d61409aa974f89fc7" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f6292d9eb6ea467a3c3560a65b7f63b5" category="paragraph">支援將故障切換至不同儲存設備的功能。ONTAP例如、系統可能會從ONTAP Select 位於邊緣位置的停止執行、到AFF 核心資料中心的故障轉移。無論儲存設備的相似性為何、您都必須針對啟用複寫的VM儲存原則、設定儲存原則對應和反轉對應、以確保恢復站台所提供的服務符合期望和要求。下列螢幕擷取畫面會強調顯示原則對應範例。</block>
  <block id="783a951245ce43eb84161804072a38c6" category="paragraph"><block ref="783a951245ce43eb84161804072a38c6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="1eb90dc8f7adfd00c74af3b815e2ac15" category="section-title">為vVols資料存放區建立複寫的磁碟區</block>
  <block id="dd5e006520a09e3975e52f6fb8991fd2" category="paragraph"><block ref="dd5e006520a09e3975e52f6fb8991fd2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="550d51e15336d4a33bcbb0f26a6810f7" category="paragraph">在vVols和SRM方面、請務必謹慎處理。請勿在同一個vVols資料存放區中混用受保護和未受保護的VM。原因是當您使用SRM容錯移轉至DR站台時、只有屬於保護群組的VM才會在DR中上線。因此、當您重新保護（將SnapMirror從災難恢復還原至正式作業）時、可能會覆寫未容錯移轉的VM、並可能包含寶貴的資料。</block>
  <block id="6d717f70d89096b731dfc63d7a1379e1" category="section-title">關於陣列配對</block>
  <block id="2219228418c053eb593ce0a1f318da47" category="paragraph">在SRM中設定陣列配對時、您應該一律以新增至ONTAP 「VMware工具」的相同方式、在SRM中新增這些配對、也就是說、它們必須使用相同的使用者名稱、密碼和管理LIF。這項需求可確保SRA與陣列正常通訊。下列螢幕快照說明ONTAP 叢集在「叢集工具」中的顯示方式、以及如何將其新增至陣列管理程式。</block>
  <block id="7ec48584a43ed8a9b1dda55398d97cf4" category="paragraph"><block ref="7ec48584a43ed8a9b1dda55398d97cf4" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3b34135c8c4d2b14ceb7ebf595f00193" category="section-title">關於複寫群組</block>
  <block id="6be59afd3c8bb91501f55a7e77ebe794" category="paragraph">複寫群組包含一起還原的虛擬機器邏輯集合。這個功能可讓VASA Provider自動為您建立複寫群組。ONTAP由於SnapMirror複寫是在磁碟區層級進行、因此一個磁碟區中的所有VM都位於相同的複寫群組中。ONTAP</block>
  <block id="c727c1020d3128dd7495a6e3e6f23736" category="paragraph">複寫群組的最後一個考量是、每個群組的本質都是一個邏輯一致性群組（請勿與SRM一致性群組混淆）。這是因為磁碟區中的所有VM都會使用相同的快照一起傳輸。因此、如果您有必須彼此一致的VM、請考慮將它們儲存在同FlexVol 一個地方。</block>
  <block id="9f8a350a2113ea4be6b4e5e5112514a3" category="section-title">關於保護群組</block>
  <block id="df77671ab2743af7f1d1457c200eb12c" category="paragraph">保護群組會將虛擬機器和資料存放區定義為群組、這些群組會從受保護的站台一起還原。受保護站台是指在正常穩定狀態作業期間、保護群組中設定的VM存在的位置。請務必注意、雖然SRM可能會針對保護群組顯示多個陣列管理程式、但保護群組無法跨越多個陣列管理程式。因此、您不應該跨不同SVM上的資料存放區跨VM檔案。</block>
  <block id="b148467d645c3613c1c7a2607764c515" category="section-title">關於恢復計畫</block>
  <block id="fd28cd9834ad3aa213c4fec2881064b5" category="paragraph">恢復計畫會定義在相同程序中恢復哪些保護群組。您可以在相同的恢復計畫中設定多個保護群組。此外、若要啟用更多執行恢復計畫的選項、可在多個恢復計畫中加入單一保護群組。</block>
  <block id="77aa84394124509e5e4006dcfd18789f" category="paragraph">恢復計畫可讓SRM管理員定義恢復工作流程、將VM指派給優先順序群組、從1（最高）指派至5（最低）、預設值為3（中）。在優先順序群組中、可設定VM以因應相依性。</block>
  <block id="030d749269f8866de516a551b0286001" category="paragraph">NetApp強烈建議您與應用程式團隊合作、瞭解容錯移轉案例中所需的作業順序、並據此建構您的恢復計畫。</block>
  <block id="cebb1167d3e78885137c837f0abf8026" category="section-title">測試容錯移轉</block>
  <block id="6ae8acfc86f5df3426d525fb95767506" category="paragraph">NetApp也建議偶爾確認來賓應用程式功能、尤其是在重新設定VM儲存設備之後。</block>
  <block id="bd47371bcd8b3d08d6b4b15481b08d93" category="paragraph">執行測試還原作業時、會在ESXi主機上為VM建立私有測試球型網路。不過、此網路不會自動連線至任何實體網路介面卡、因此無法在ESXi主機之間提供連線功能。為了在DR測試期間允許在不同ESXi主機上執行的VM之間進行通訊、會在DR站台的ESXi主機之間建立實體私有網路。若要驗證測試網路是否為私有網路、可以實體分隔測試網路、或使用VLAN或VLAN標記來分隔測試網路。此網路必須與正式作業網路隔離、因為在恢復VM時、無法將其置於可能與實際正式作業系統衝突的IP位址正式作業網路上。在SRM中建立恢復計畫時、所建立的測試網路可選取為私有網路、以便在測試期間連接VM。</block>
  <block id="2be58fc410ddf2ba9c350135a617944a" category="paragraph">在測試通過驗證且不再需要之後、請執行清除作業。執行清除功能會將受保護的VM恢復至初始狀態、並將恢復計畫重設為「就緒」狀態。</block>
  <block id="6f07b53963ee80903f0f13654de2cc3a" category="section-title">容錯移轉考量</block>
  <block id="9d33d94019b4a595a1ea232926a4da1b" category="paragraph">除了本指南所述的作業順序之外、還有其他幾個考量因素是站台容錯移轉。</block>
  <block id="74abdd5cb502cd65bcf1d7ca484ab0c2" category="paragraph">您可能必須面對的一個問題是站台之間的網路差異。某些環境可能會在主要站台和DR站台上使用相同的網路IP位址。這項功能稱為「延伸虛擬LAN（VLAN）」或「延伸網路設定」。其他環境可能需要在主要站台使用不同的網路IP位址（例如不同的VLAN）、相對於DR站台。</block>
  <block id="9b8890fe5b1ab29543118b12a7bd0a07" category="inline-link-macro">支援 SRM 的 NSX-T 選項</block>
  <block id="25154023650451d6cc971fc54bff8898" category="paragraph">VMware提供多種方法來解決此問題。例如VMware NSS-T Data Center等網路虛擬化技術、會從作業環境的第2層到第7層、將整個網路堆疊抽象化、以提供更多可攜的解決方案。深入瞭解 <block ref="3e6a2bd8e1acf69d423b7944c6543271" category="inline-link-macro-rx"></block>。</block>
  <block id="b56336aa967325217297d8725b64eb0b" category="inline-link-macro">VMware 文件</block>
  <block id="d32598436410006707b2ad1d79395f02" category="paragraph">若要設定SRM將不同的網路設定套用到多個VM、而不需要編輯恢復計畫中每個VM的內容、VMware提供一種稱為DR-IP-customizer的工具。如需瞭解如何使用此公用程式、請參閱 <block ref="837c7339284b78d4fd5550c5d0fb1a68" category="inline-link-macro-rx"></block>。</block>
  <block id="3c8c527afa8ce5009c8f707f7fd4fabf" category="section-title">重新保護</block>
  <block id="3b496038cb575fc404f8b0783e570f7a" category="paragraph">恢復之後、恢復站台將成為新的正式作業站台。由於恢復作業中斷了SnapMirror複寫、因此新的正式作業站台不會受到任何未來災難的保護。最佳實務做法是在恢復後立即將新的正式作業站台保護到另一個站台。如果原始正式作業站台可運作、VMware管理員可以將原始正式作業站台當作新的恢復站台、以保護新正式作業站台、有效反轉保護方向。只有在非災難性故障時、才能使用重新保護功能。因此、原始vCenter Server、ESXi伺服器、SRM伺服器及對應的資料庫最終必須可還原。如果無法使用、則必須建立新的保護群組和新的恢復計畫。</block>
  <block id="2bf236f8aceaaff2b305848df524c42e" category="paragraph">容錯回復作業基本上是以不同於以往的方向進行容錯移轉。最佳實務做法是在嘗試容錯回復之前、或是在容錯移轉至原始站台之前、先確認原始站台是否恢復為可接受的功能層級。如果原始站台仍遭入侵、您應該延遲容錯回復、直到故障獲得充分補救為止。</block>
  <block id="cb03753531bad31391d7156433b98ae6" category="paragraph">另一個容錯回復最佳做法是在完成重新保護後、在執行最終容錯回復之前、一律執行測試容錯移轉。如此可驗證原始站台上的系統是否能夠完成作業。</block>
  <block id="900a3b65ea54b6dcff72ed0d6ac66fdf" category="section-title">重新保護原始網站</block>
  <block id="12d059a2c7519f2e3497b30a71121503" category="paragraph">在容錯回復後執行重新保護、基本上會使環境回到最初的狀態、並再次從正式作業站台執行SnapMirror複寫至還原站台。</block>
  <block id="1a79eb278bc02ebdbd2ab32925e316f6" category="paragraph">使用適用於ONTAP VMware vSphere的NetApp支援軟體工程技術、採用下列安全開發活動：</block>
  <block id="39e5fc9eb192f011ab14dae6c2974c4e" category="list-text">*威脅建模。*威脅建模的目的是在軟體開發生命週期初期、發現某項功能、元件或產品的安全性瑕疵。威脅模式是對影響應用程式安全性的所有資訊的結構化呈現。基本上、它是透過安全性觀點來檢視應用程式及其環境。</block>
  <block id="9f16ab3a50bca32d19c4729319035c8d" category="list-text">*動態應用程式安全性測試（dast）。*這項技術的設計、是為了偵測應用程式在執行狀態下的易受影響狀況。Dast會測試開放Web應用程式的公開HTTP和HTML介面。</block>
  <block id="267bed0525e4dab477e4c24ca5a1794e" category="list-text">*協力廠商程式碼貨幣。*在開放原始碼軟體（開放原始碼軟體）的軟體開發過程中、您必須解決與產品內建的任何開放原始碼軟體相關的安全性弱點。這是一項持續努力、因為新的開放源碼版本可能隨時都有新發現的弱點報告。</block>
  <block id="db7bc87c89c1ee76d313865a32fc0e06" category="list-text">*弱點掃描。*弱點掃描的目的是在NetApp產品中發現常見且已知的安全性弱點之後、再將弱點發佈給客戶。</block>
  <block id="1a4c104571630526efc77b84e82380fe" category="list-text">*滲透測試。*滲透測試是評估系統、Web應用程式或網路以找出攻擊者可能利用的安全性弱點的程序。NetApp的滲透測試（筆測試）是由一群獲核准且值得信賴的第三方公司進行。其測試範圍包括利用精密的利用方法或工具、對類似於惡意入侵者或駭客的應用程式或軟體發動攻擊。</block>
  <block id="7e98fc3ea1ec077cfd1727a58e9c9020" category="section-title">產品安全功能</block>
  <block id="85d61648687f15050da0b86741b90358" category="paragraph">適用於VMware vSphere的NetApp ONTAP 產品組合工具在每個版本中均包含下列安全功能。</block>
  <block id="dff88c2ef0b49b09246ffd6f9ec55195" category="list-text">*登入橫幅。* SSH預設為停用、如果從VM主控台啟用、則僅允許一次性登入。使用者在登入提示中輸入使用者名稱後、會顯示下列登入橫幅：</block>
  <block id="399875025e8e96cc13102a4dd72f2434" category="paragraph">*警告：*禁止未經授權存取本系統、並依法律予以起訴。存取本系統即表示您同意、若懷疑有未獲授權的使用情形、您的行動可能受到監控。</block>
  <block id="2d8330ed99c80a842ffbd1362e038e5e" category="paragraph">使用者透過 SSH 通道完成登入後、會顯示下列文字：</block>
  <block id="677528ad13d460c058ac50e8a62092cf" category="list-text">*角色型存取控制（RBAC）。* ONTAP 有兩種RBAC控制項與VMware Tools相關聯：</block>
  <block id="ac38773d017495a97d5b88f242578cb8" category="list-text">原生vCenter Server權限</block>
  <block id="c2e2fce3a995f59900d7afbbe58683f5" category="inline-link">此連結</block>
  <block id="31cedac82fef311cb790a12f96897223" category="list-text">vCenter外掛程式特定權限。如需詳細資訊、請參閱<block ref="e5f6920797dbff91ef59367270a82669" category="inline-link-rx"></block>。</block>
  <block id="5d32469f8a65b884a8f70abf95fe485a" category="list-text">*加密的通訊通道。*所有外部通訊都是透過使用TLS 1.2版的HTTPS進行。</block>
  <block id="600d4f98483fae8e58054f976d7e0c0e" category="list-text">*最小的連接埠曝光。*只有必要的連接埠會在防火牆上開啟。</block>
  <block id="0406f8902379502d1eba01f043c232b7" category="paragraph">下表說明開放連接埠的詳細資料。</block>
  <block id="69fc9fe9cbb7709e97a433352aecf77d" category="cell">TCP v4/v6連接埠#</block>
  <block id="02674a4ef33e11c879283629996c8ff8" category="cell">方向</block>
  <block id="86408593c34af77fdd90df932f8b5261" category="cell">功能</block>
  <block id="0c95054981de037de06e544a52eb3613" category="cell">8143.</block>
  <block id="a8e6fe5b9e68f30a146cefebaa7edcc3" category="cell">傳入</block>
  <block id="d16c4afdc5f340936b747baf91efc843" category="cell">用於REST API的HTTPS連線</block>
  <block id="5bd529d5b07b647a8863cf71e98d651a" category="cell">8043.</block>
  <block id="1f4deeb2f64336d4ff65ea3d2b4ffe2f" category="cell">HTTPS連線</block>
  <block id="cb4b69eb9bd10da82c15dca2f86a1385" category="cell">9060</block>
  <block id="5852f8019b572f4cdef5bab783fa799f" category="cell">HTTPS連線
用於透過 https 連線的 SOAP
此連接埠必須開啟、才能讓用戶端連線至 ONTAP 工具 API 伺服器。</block>
  <block id="b6d767d2f8ed5d21a44b0e5886680cb9" category="cell">22</block>
  <block id="f4e339608b243f9b57b78ffaf061b498" category="cell">SSH（預設為停用）</block>
  <block id="d82d678e9583c1f5f283ec56fbf1abb7" category="cell">9080</block>
  <block id="ef34781e03f49b5db5dd8fa267c4c41b" category="cell">HTTPS連線- VP和SRA -僅從回送進行內部連線</block>
  <block id="a44ba9086b2b83ccf2baf7c678723449" category="cell">9083.</block>
  <block id="fe01ac95967cd8cb5f5b5669b685277a" category="cell">HTTPS 連線： VP 與 SRA
用於透過 https 連線的 SOAP</block>
  <block id="abea47ba24142ed16b7d8fbf2c740e0d" category="cell">1162</block>
  <block id="4a0724da5c6f4e4817663ae822550800" category="cell">VP SNMP設陷封包</block>
  <block id="5cce8dede893813f879b873962fb669f" category="cell">1527.</block>
  <block id="91c15b8eb529bf2100c10383d1010a1e" category="cell">僅限內部使用</block>
  <block id="60135f95267c6e0711bf5a2858dfff2f" category="cell">僅在此電腦與本身之間的外部連線不接受（僅限內部連線）</block>
  <block id="13f3cf8c531952d72e5847c4183e6910" category="cell">443..</block>
  <block id="1ef2b5426b0824e93e33753fa87ddbf5" category="cell">雙向</block>
  <block id="e4b8a8d8761aab7733e317b585d5d606" category="cell">用於連線ONTAP 至叢集</block>
  <block id="bf6184406d1e18fffc86ecf770fbb391" category="inline-link">知識庫文章</block>
  <block id="fedac49792829de4ff38fcf7a3846faa" category="list-text">*支援憑證授權單位（CA）簽署的憑證。* ONTAP VMware vSphere的各種工具支援CA簽署的憑證。請參閱<block ref="0903a062b2072644a9b744a7fece4216" category="inline-link-rx"></block> 以取得更多資訊。</block>
  <block id="9fca19988370da2a459b24505e9d23d5" category="list-text">*稽核記錄。*您可以下載支援套裝組合、而且內容極為詳細。使用者登入和登出活動會記錄在個別的記錄檔中。ONTAPVASA API呼叫會記錄在專屬的VASA稽核記錄（本機CXF.log）中。</block>
  <block id="7d60a2806aedd934b75cce55d6693689" category="list-text">*密碼原則。*遵循下列密碼原則：</block>
  <block id="f82f7513742f08b9d2784923213bdc75" category="list-text">密碼不會記錄在任何記錄檔中。</block>
  <block id="83040c348e071499488a8128db207545" category="list-text">密碼不會以純文字形式傳達。</block>
  <block id="bc319862df3312f423a50fece7730db9" category="list-text">密碼是在安裝程序本身期間設定的。</block>
  <block id="853c2ea85b86882d0ea73b606a9800a4" category="list-text">密碼歷程記錄是可設定的參數。</block>
  <block id="b3d3877bc96752ae50a409c72597d47a" category="list-text">密碼最短使用期限設為24小時。</block>
  <block id="fb0bdec50022a37424a405b53da7c9c8" category="list-text">密碼欄位的自動完成功能已停用。</block>
  <block id="3a04f054be8ad983ea82fd5079519810" category="list-text">利用SHA256雜湊功能、將所有儲存的認證資訊加密。ONTAP</block>
  <block id="46e61d6e7c848d43ddcede8efd36c3d8" category="doc">SnapCenter 外掛程式 VMware vSphere</block>
  <block id="ae9e79ac4b60eba67cf1c7508417b42c" category="paragraph">適用於VMware vSphere軟體工程的NetApp SnapCenter 支援外掛程式使用下列安全開發活動：</block>
  <block id="b25a1098aff7d0c5ee590f1e1a114bb9" category="list-text">*動態應用程式安全性測試（dast）。*專為偵測應用程式執行狀態中的易受影響狀況而設計的技術。Dast會測試開放Web應用程式的公開HTTP和HTML介面。</block>
  <block id="6cc1fee6b4fc48755d78e93170bbed93" category="list-text">*協力廠商程式碼貨幣。*在開發軟體及使用開放原始碼軟體（開放原始碼軟體）的過程中、必須解決與產品整合的開放原始碼軟體（開放原始碼軟體）相關的安全性弱點。這是一項持續努力、因為開放源碼軟體會元件的版本可能隨時報告新發現的弱點。</block>
  <block id="87bd0fb9b4198f33535e0e1888a809f5" category="list-text">*滲透測試。*滲透測試是評估系統、Web應用程式或網路以找出攻擊者可能利用的安全性弱點的程序。NetApp的滲透測試（筆測試）是由一群獲核准且值得信賴的第三方公司進行。其測試範圍包括利用精密的利用方法或工具、對惡意入侵者或駭客等應用程式或軟體發動攻擊。</block>
  <block id="e3a3be4b4b04c5e0b6a5f1b5ea388380" category="list-text">*產品安全性事件回應活動。*安全性弱點會在公司內部和外部發現、如果無法及時解決、可能會對NetApp的聲譽造成嚴重風險。為了推動此程序、產品安全性事件回應團隊（PSIRT）會報告並追蹤弱點。</block>
  <block id="e91db3b3278f7bd95cc704d74c5c9597" category="paragraph">適用於VMware vSphere的NetApp SnapCenter VMware vCenter外掛程式在每個版本中都包含下列安全功能：</block>
  <block id="4abd7d1d5d223683d3346671efb7e89c" category="list-text">*受限的Shell存取。* SSH預設為停用、且只有在從VM主控台啟用時、才允許一次性登入。</block>
  <block id="8c264fa5ca2c588d960d98bd30cbc897" category="list-text">*登入橫幅中的存取警告。*使用者在登入提示中輸入使用者名稱後、會顯示下列登入橫幅：</block>
  <block id="0d6633ada3a9803e206b2359d859e892" category="paragraph">使用者透過SSH通道完成登入後、會顯示下列輸出：</block>
  <block id="83e463bb73b12d9ca6e419327073c8a4" category="list-text">*角色型存取控制（RBAC）。*有兩種RBAC控制項與NetApp ONTAP 支援工具相關：</block>
  <block id="b883bf79639dfce77e395b8458ee69e4" category="list-text">原生vCenter Server權限。</block>
  <block id="721796b1cb3468f0daf819180184d460" category="inline-link">角色型存取控制（RBAC）</block>
  <block id="1d08c46b7567a29be0690a92b9722a58" category="list-text">VMware vCenter外掛程式特定權限。如需詳細資訊、請參閱<block ref="f351263ad3706bd0a472039400dece78" category="inline-link-rx"></block>。</block>
  <block id="acab4c655c4a7b4db67fc07e22b86222" category="list-text">*加密的通訊通道。*所有外部通訊都是使用TLS透過HTTPS進行。</block>
  <block id="47a37e2d5fc8b7c936ad9b2b7a569a08" category="paragraph">下表提供開放連接埠詳細資料。</block>
  <block id="10bd16a816f831080065e807daa36a9a" category="cell">TCP v4/v6連接埠號碼</block>
  <block id="edf0320adc8658b25ca26be5351b6c4a" category="cell">8144.</block>
  <block id="d4a973e303ec37692cc8923e3148eef7" category="cell">8080</block>
  <block id="2c25c3d66f80eeaa8d6e5a144c6f942e" category="cell">用於OVA GUI的HTTPS連線</block>
  <block id="14b3e670eec63cc0cc456fd904bbfbd9" category="cell">SSH（預設為停用）</block>
  <block id="16fc18d787294ad5171100e33d05d4e2" category="cell">3306.</block>
  <block id="4cbf9c234f6b34c242a110cb993252bd" category="cell">MySQL（僅限內部連線；預設為停用外部連線）</block>
  <block id="29ab4efbdb7c727c81ee1382593bc5e2" category="cell">Ngin像（資料保護服務）</block>
  <block id="89f152cad33314315b4995ed1ca71535" category="inline-link">如何建立及/或將SSL憑證匯入SnapCenter VMware vSphere（選擇控制器）的VMware外掛程式</block>
  <block id="450adc59e39f23172756ac9369494a2d" category="list-text">*支援憑證授權單位（CA）簽署的憑證。* SnapCenter VMware vSphere的支援外掛程式支援CA簽署憑證的功能。請參閱<block ref="9f83d87d5d9f604d96288df21d450fac" category="inline-link-rx"></block>。</block>
  <block id="05a1aa8021df4579874c4eeb8788e5c9" category="list-text">*密碼原則。*下列密碼原則有效：</block>
  <block id="2c87609dbbc3630573c64e271de8207d" category="list-text">所有認證資訊均使用SHA256雜湊來儲存。</block>
  <block id="0f1a6fa0a65f9d5c3c4a16b070104d7a" category="list-text">*基本作業系統映像*。*本產品隨附適用於OVA的Debian基礎作業系統、存取受限且停用Shell存取。如此可減少攻擊佔用空間。每SnapCenter 個發行版基礎作業系統都會更新最新的安全修補程式、以達到最大的安全覆蓋範圍。</block>
  <block id="83cd5867ba912e517fa1100299fd1cf3" category="paragraph">NetApp針對SnapCenter VMware vSphere應用裝置開發有關VMware vSphere外掛程式的軟體功能與安全性修補程式、然後將其作為套裝軟體平台發佈給客戶。由於這些應用裝置包括特定的Linux子作業系統相依性、以及我們的專屬軟體、因此NetApp建議您不要變更子作業系統、因為這會對NetApp應用裝置造成重大影響。這可能會影響NetApp支援應用裝置的能力。NetApp建議測試及部署我們最新的應用裝置程式碼版本、因為這些版本已發行以修補任何與安全性相關的問題。</block>
  <block id="1bc6cee680286aae1b12889369b7f18a" category="summary">ONTAP 上的 MySQL</block>
  <block id="dac8ea4fbfd87a535663c227b91f50e3" category="doc">I/O 排程器</block>
  <block id="215dca219378b291ae287eb076489fdd" category="paragraph">Linux 核心可讓您以低層級控制 I/O 排程封鎖裝置的方式。</block>
  <block id="dc36d23ef487690f1698c69d9e49cee2" category="paragraph">Linux 各版本的預設值差異極大。MySQL 建議您使用<block ref="722d122e81cbbe543bd5520bb8678c0e" prefix=" " category="inline-code"></block> 或是<block ref="30e482a8ab57cfc19075dece53b0a56b" prefix=" " category="inline-code"></block> 在 Linux 上具有原生非同步 I/O （ AIO ）的 I/O 排程器。一般而言、 NetApp 客戶和內部測試都能透過 NoOps 獲得更好的結果。</block>
  <block id="6def78482bd1915cb81f0f5c19ee8fe6" category="paragraph">MySQL 的 InnoDB 儲存引擎使用 Linux 上的非同步 I/O 子系統（原生 AIO ）來執行預先讀取和寫入資料檔案頁面的要求。此行為由控制<block ref="2c03186a22d036ce7dad84be5de2f2ce" prefix=" " category="inline-code"></block> 組態選項、預設為啟用。有了原生的整合式全功能電腦、 I/O 排程器的類型對 I/O 效能有更大的影響。執行效能標竿、判斷哪一個 I/O 排程器可為您的工作負載和環境提供最佳結果。</block>
  <block id="e7b09beaf26efc7d8bee91786cf794b5" category="paragraph">如需設定 I/O 排程器的指示、請參閱相關的 Linux 和 MySQL 文件。</block>
  <block id="6e8775bd755a8835ce86806d669677ea" category="doc">儲存組態</block>
  <block id="2f09ac000b4a1808cb795b7bdbb20ecc" category="doc">InnoDB_log_file_size</block>
  <block id="b8674b2897b288ca55b74328df4780b3" category="paragraph">為 InnoDB 記錄檔大小選取適當的大小、對於寫入作業以及在伺服器當機後擁有適當的還原時間都很重要。</block>
  <block id="b61bad6f7bf48bf9abda0c86c9beed79" category="paragraph">由於有這麼多交易登入檔案、因此記錄檔大小對於寫入作業非常重要。修改記錄時、變更不會立即回寫到表格區。相反地、變更會記錄在記錄檔的結尾、而且頁面會標示為「髒污」。InnoDB 使用其記錄檔將隨機 I/O 轉換成連續 I/O</block>
  <block id="e87d83a3c0af4df83efb4784b5182f8f" category="paragraph">當記錄檔已滿時、會依序將不完整頁面寫入資料表空間、以釋放記錄檔中的空間。例如、假設某個伺服器在交易過程中當機、而且寫入作業只會記錄在記錄檔中。伺服器必須經過復原階段、記錄檔中記錄的變更會重新播放、才能重新上線。記錄檔中的項目越多、伺服器恢復所需的時間就越長。</block>
  <block id="8321756b7fedf72543a1b0917bf92613" category="paragraph">在此範例中、記錄檔大小會同時影響還原時間和寫入效能。為記錄檔大小選擇正確的數字時、請平衡恢復時間與寫入效能。一般而言、 128M 和 512M 之間的任何項目都是物超所值的。</block>
  <block id="d4ae77cd65c244ceb4277b27553d6931" category="doc">ONTAP 上的 MySQL 資料庫</block>
  <block id="598132a821e8cc696fbbae934047d991" category="paragraph">MySQL 及其變種、包括 MariaDB 和 Percona MySQL 、是全球最受歡迎的資料庫。</block>
  <block id="478f00c3805e92ad9e8a7cd4f335a020" category="admonition">ONTAP 和 MySQL 資料庫上的本文件取代先前發佈的 _TR-4722 ： NetApp ONTAP 最佳實務做法的 MySQL 資料庫。 _</block>
  <block id="35701e1bcd40c8e1a520fc33d0e14842" category="doc">InnoDB_Flush 方法</block>
  <block id="138738e11d5fda5c496edaa92e32e158" category="paragraph">InnoDB_flush_method 參數指定 InnoDB 如何開啟及排清記錄檔和資料檔。</block>
  <block id="c262c8cd82b96f69fbbc058d7a35683b" category="section-title">最佳化</block>
  <block id="d1e67ebe6122765789852eb430c42c75" category="paragraph">在 InnoDB 最佳化中、如果適用、設定此參數會調整資料庫效能。</block>
  <block id="51ca63a7fb332d4d18e7139ea5787c50" category="paragraph">下列選項用於透過 InnoDB 排清檔案：</block>
  <block id="a9b8d4c72b58a9554274cba7904d47e2" category="list-text"><block ref="e590322920bebc1156ab585bd6597d76" prefix="" category="inline-code"></block>。InnoDB 使用<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> 系統呼叫以清除資料和記錄檔。此選項為預設設定。</block>
  <block id="8198b1fd4bf2fafa4f4e8ffb4a8ac900" category="list-text"><block ref="a48be70a21bca2cf4b3e481efed66ae4" prefix="" category="inline-code"></block>。InnoDB 使用<block ref="a48be70a21bca2cf4b3e481efed66ae4" prefix=" " category="inline-code"></block> 用於打開和刷新日誌文件和 fsync （）以刷新數據文件的選項。InnoDB 不使用<block ref="a48be70a21bca2cf4b3e481efed66ae4" prefix=" " category="inline-code"></block> 直接來說、因為 UNIX 的許多種類都有問題。</block>
  <block id="f89f9147df5dde99a7944d2028b59e7e" category="list-text"><block ref="6a334fd488ef92b18584207148410cc4" prefix="" category="inline-code"></block>。InnoDB 使用<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> 選項（或<block ref="42d27f470f62deaad644fef8618b59bb" prefix=" " category="inline-code"></block> 在 Solaris 上）開啟資料檔案及使用<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> 清除資料和記錄檔。此選項可在某些版本的 GNU/Linux 、 FreeBSD 和 Solaris 上使用。</block>
  <block id="5e90100e134d805a66f8cda2e73f5298" category="list-text"><block ref="d66655d6d13113f23421f282ed1eaeb7" prefix="" category="inline-code"></block>。InnoDB 使用<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> 排清 I/O 時的選項；不過、它會跳過<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> 之後進行系統通話。此選項不適用於某些類型的檔案系統（例如 XFS ）。如果您不確定檔案系統是否需要<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> 系統呼叫（例如為了保留所有檔案中繼資料）使用<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> 選項。</block>
  <block id="c680d437163cc6bab4f9bdb35c3073d0" category="section-title">觀察</block>
  <block id="907dee0040812e8e7d1fd00b870b5063" category="paragraph">在 NetApp 實驗室測試中、<block ref="e590322920bebc1156ab585bd6597d76" prefix=" " category="inline-code"></block> 預設選項用於 NFS 和 SAN 、與相較之下、這是一項很棒的效能改進工具<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block>。使用「齊平」方法時為<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> 使用 ONTAP 時、我們觀察到用戶端會以序列方式、在 4096 區塊的邊界寫入大量的單位位元組寫入資料。這些寫入會增加網路延遲並降低效能。</block>
  <block id="2f0b9319cf6d59e07ea4b1ef65a12be1" category="doc">open_file_limits</block>
  <block id="11e52b21a9795b7dcf947027b0ec5d01" category="paragraph">。<block ref="2f0b9319cf6d59e07ea4b1ef65a12be1" prefix=" " category="inline-code"></block> 參數決定作業系統允許 mysqld 開啟的檔案數目。</block>
  <block id="e0732f22b2900006e8fcb6367fd162f7" category="paragraph">此參數在執行階段的值是系統允許的實際值、可能與您在伺服器啟動時指定的值不同。在 MySQL 無法變更開啟檔案數量的系統上、此值為 0 。有效<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 此值是根據系統啟動時指定的值（如果有）和的值而定<block ref="0bc91339c0d774f560a9a38fc9dfac30" prefix=" " category="inline-code"></block> 和<block ref="023a3b50ddf424c9a1d51984190a0c92" prefix=" " category="inline-code"></block> 使用這些公式：</block>
  <block id="6b840ff0a7667f4642a0844269657fc4" category="list-text">10 +<block ref="0bc91339c0d774f560a9a38fc9dfac30" prefix=" " category="inline-code"></block> + <block ref="023a3b50ddf424c9a1d51984190a0c92" prefix="(" category="inline-code"></block> x 2 ）</block>
  <block id="d3de183489c20b8efa2947eeff3028d7" category="list-text"><block ref="0bc91339c0d774f560a9a38fc9dfac30" prefix="" category="inline-code"></block> x 5.</block>
  <block id="2c08922fbaba089e7c2982df43fd352a" category="list-text">如果為正、則作業系統限制</block>
  <block id="8ca153937fcbdf56497ad779a91f31d1" category="list-text">如果作業系統限制為無限：<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 在啟動時指定值；若無、則指定值為 5 、 000</block>
  <block id="98038bb4026a70f5ee4041522c6eebe4" category="paragraph">伺服器會嘗試使用這四個值的最大值來取得檔案描述元數目。如果無法取得這麼多描述元、伺服器會嘗試取得系統允許的數量。</block>
  <block id="3ee58d04a0dc9b2551698643e0421005" category="doc">InnoDB_LRU_SCAN_depth</block>
  <block id="29d0f4f8b383d39e73abd11ac73ca28a" category="paragraph">。<block ref="3ee58d04a0dc9b2551698643e0421005" prefix=" " category="inline-code"></block> 參數會影響 InnoDB 緩衝區集區之排清作業的演算法和啟發性。</block>
  <block id="eeb16232629bd788f0d29c104105bba2" category="paragraph">此參數主要是效能專家調校 I/O 密集工作負載的興趣所在。對於每個緩衝區集區執行個體、此參數會指定最少使用（ LRU ）頁面清單中、頁面清理程式執行緒應繼續掃描的程度、以尋找要清除的髒頁面。此背景作業每秒執行一次。</block>
  <block id="39359bf2914e4e1cf84a9dea580fd20a" category="paragraph">您可以上下調整值、將可用頁數降至最低。請勿將此值設定得比所需值高得多、因為掃描可能會產生重大的效能成本。此外、請考慮在變更緩衝區集區執行個體數目時調整此參數、因為<block ref="f2c8312d381c16c6c95a727c3f61a4c7" prefix=" " category="inline-code"></block> 定義頁面清理程式執行緒每秒執行的工作量。</block>
  <block id="513a275422fae2456617321a2f3fc0af" category="paragraph">小於預設值的設定適用於大部分的工作負載。只有在典型工作負載下有備用 I/O 容量時、才考慮增加此值。相反地、如果寫入密集的工作負載使 I/O 容量飽和、請降低該值、尤其是當您擁有大型緩衝區集區時。</block>
  <block id="62812b938ba1113b81bd7f612ad0e6f8" category="doc">InnoDB_緩 衝區 _Pool_size</block>
  <block id="d7a8b502d05f5e477158eb80c1fb8dae" category="paragraph">InnoDB 緩衝資源池是任何調校活動中最重要的部分。</block>
  <block id="5cb6c45d18482180f34ae727b53379fb" category="paragraph">InnoDB 在很大程度上仰賴緩衝區集區來快取索引和資料、調適性雜湊索引、插入緩衝區、以及許多內部使用的其他資料結構。緩衝區集區也會緩衝資料的變更、這樣就不需要立即對儲存設備執行寫入作業、進而改善效能。緩衝區集區是 InnoDB 的一部分、必須據此調整其大小。設定緩衝區集區大小時、請考量下列因素：</block>
  <block id="03f07291794c3b9cb00d04cb9f30be81" category="list-text">若為僅 InnoDB 的專用機器、請將緩衝區集區大小設為 80% 以上的可用 RAM 。</block>
  <block id="7b0119b7fa59f87d23d5c65da456b226" category="list-text">如果不是 MySQL 專用伺服器、請將 RAM 大小設為 50% 。</block>
  <block id="a6a9695e1464f5554c0006c55facfadf" category="doc">檔案描述元</block>
  <block id="8e222c68dd214db9f8a1b5b572ee6267" category="paragraph">它會使用它們來開啟新的連線、將資料表儲存在快取中、建立暫時資料表來解決複雜的查詢、以及存取持續性的查詢。如果 mysqld 在需要時無法開啟新檔案、它就能停止正常運作。此問題的常見症狀是錯誤 24 「開啟的檔案太多」。 mysqld 可以同時開啟的檔案描述元數量是由定義的<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 設定在組態檔案中的選項 <block ref="86d0d007043d911697753b35e2c18f35" prefix="(" category="inline-code"></block>）。但是<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 也取決於作業系統的限制。這種相依性會使設定變數變得更複雜。</block>
  <block id="07561a91f81dfe3c8e4364aac8bdbea4" category="paragraph">MySQL 無法設定<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 選項高於下所指定的選項<block ref="dd1c6d8164dfd1cee0afa39b177e843b" prefix=" " category="inline-code"></block>。因此、您必須在作業系統層級明確設定這些限制、才能讓 MySQL 視需要開啟檔案。檢查 Linux 檔案限制的方法有兩種：</block>
  <block id="84e705ac120a887df441f4161dc29409" category="list-text">。<block ref="2eabb4efed7dffb32ea1170eab71b798" prefix=" " category="inline-code"></block> 命令會快速為您提供所允許或鎖定參數的詳細說明。執行此命令所做的變更並非永久性變更、將會在系統重新開機後清除。</block>
  <block id="a4c404dc92855948bc4c007a86091dbe" category="list-text">變更為<block ref="b803f460349bd101b1de260021ef0e60" prefix=" " category="inline-code"></block> 檔案是永久性的、不受系統重新開機影響。</block>
  <block id="cbcab8220d4ffddbdc44f9936125d83d" category="paragraph">請務必同時變更使用者 mysql 的硬限制和軟限制。以下摘錄來自組態：</block>
  <block id="97dc47f90c600a96fac6642560ffaceb" category="paragraph">同時、請在中更新相同的組態<block ref="90f16be5b82ca0aa94088c89fe00b3dd" prefix=" " category="inline-code"></block> 以完全使用開放式檔案限制。</block>
  <block id="395ec860c9530814e94538b7121a8319" category="doc">InnoDB_Flush 記錄 _AT_TRx_Commit</block>
  <block id="2f2c7742844f13de59d435b9099c78cc" category="paragraph">當資料發生變更時、變更不會立即寫入儲存設備。</block>
  <block id="0b36b8f791a48c7b4692e7df069dabc8" category="paragraph">而是記錄在記錄緩衝區中、這是 InnoDB 分配給記錄在記錄檔中的緩衝區變更的記憶體部分。InnoDB 會在交易提交、緩衝區滿時、或每秒一次（以先發生的事件為準）、將緩衝區排清至記錄檔。控制此程序的組態變數是 InnoDB_Flush 記錄 _AT_TRx_Commit 。價值選項包括：</block>
  <block id="280a38864b81c14ba3db52801e087ed0" category="list-text">當您設定時<block ref="cab9a35054c49f0ba619a6e6943f461b" prefix=" " category="inline-code"></block>、 InnoDB 會將修改過的資料（在 InnoDB 緩衝區集區中）寫入記錄檔（ IB_logfile ）、並每秒清除記錄檔（寫入儲存區）。不過、提交交易時、它不會執行任何動作。如果發生電源故障或系統當機、則沒有任何未排清的資料可恢復、因為它不會寫入記錄檔或磁碟機。</block>
  <block id="5967bb5566cb7cd8bdb0b372ceb21565" category="list-text">當您設定時<block ref="1ab7a7611b59147e84a38b6f3e7d9d09" prefix=" " category="inline-code"></block>、 InnoDB 會將記錄緩衝區寫入交易記錄檔、並在每筆交易中將記錄檔排清至持久儲存區。例如、對於所有交易認可、 InnoDB 會寫入記錄、然後寫入儲存設備。儲存速度變慢會對效能造成負面影響、例如每秒 InnoDB 交易數會減少。</block>
  <block id="9e9b3a43cb7a1b13c5ee3f6519d7f60e" category="list-text">當您設定時<block ref="44d4dfee9b1c95f8768bec989cd3baf5" prefix=" " category="inline-code"></block>、 InnoDB 會在每次提交時將記錄緩衝區寫入記錄檔、但不會將資料寫入儲存區。InnoDB 每秒會清除一次資料。即使發生電源故障或系統當機、記錄檔中也有選項 2 資料可供使用、而且可恢復。</block>
  <block id="14f3e0328e25aa02b37bd6817a442a58" category="paragraph">如果效能是主要目標、請將值設為 2 。由於 InnoDB 每秒一次寫入磁碟機、而非每次提交交易時、效能大幅提升。如果發生停電或當機、可從交易記錄中恢復資料。</block>
  <block id="4a34cbb1957909093a2e216fc1cd0962" category="paragraph">如果資料安全是主要目標、請將值設為 1 、以便每次提交交易時、 InnoDB 都會將資料清出磁碟機。不過、效能可能會受到影響。</block>
  <block id="53be3047aa6f8a62c640cc8b4d6089c6" category="admonition">* NetApp 建議 * 將 InnoDB_Flush 日誌 _TRx_Commit 值設為 2 、以獲得更好的效能。</block>
  <block id="2199371f8380c97ad11a03fba3b501c9" category="doc">InnoDB_IO_capAC</block>
  <block id="ac165f23bb7435219b226ed6e76c5fa4" category="paragraph">在 InnoDB 外掛程式中、從 MySQL 5.7 新增名為 InnoDB_IO_capACure.</block>
  <block id="b4f38c42ef968074288f239b42e92b7f" category="paragraph">它可控制 InnoDB 執行的 IOPS 上限（包括髒頁的排清率、以及插入緩衝區 [ibuf] 批次大小）。InnoDB_IO_capAC容量 參數會根據 InnoDB 背景工作來設定 IOPS 上限、例如從緩衝區排清頁面、以及從變更緩衝區合併資料。</block>
  <block id="9679a08c293f29d9546c42207b09d418" category="paragraph">將 InnoDB_IO_capAC容量 參數設定為系統每秒可執行的 I/O 作業大約數目。理想情況下、請盡可能將設定保持在低的位置、但不要太低、讓背景活動變慢。如果設定太高、資料會從緩衝區移除、並太快插入緩衝區以供快取、以提供顯著效益。</block>
  <block id="668b6acc98c3469094062ed50b43e43a" category="admonition">* NetApp 建議 * 如果在 NFS 上使用此設定、請分析 IOPS （ Sys台 / Fio ）的測試結果、並據此設定參數。除非您在 InnoDB 緩衝資源池中看到比您想要的更多修改或不乾淨頁面、否則請使用最小的值來進行排清和清除。</block>
  <block id="038b11d42ee14bd77b6370c575c63b16" category="admonition">除非您證明較低的值不足以應付工作負載、否則請勿使用極端值、例如 20,000 或更多。</block>
  <block id="62385f5ceb285bca676cb0561555d719" category="paragraph">InnoDB_IO_capACure. 參數可規範排清率和相關 I/O</block>
  <block id="c957ef06af970a7526a73e741b47fef1" category="admonition">您可以將此參數或 InnoDB_IO_capACure_max 參數設定得太高、並以提早排清的方式浪費 I/O 作業、進而嚴重損害效能。</block>
  <block id="d32067c550345cae14e678b4def6aa22" category="doc">MySQL over SAN</block>
  <block id="b238d5dd75fe5ed855c5b3047e074050" category="paragraph">有兩個選項可以使用常見的雙磁碟區模型、來設定 MySQL 與 SAN 。</block>
  <block id="58d94bb6e53e154e2f4b16efa09f4c0d" category="paragraph">只要 I/O 和容量需求在單一 LUN 檔案系統的限制範圍內、就可以將較小的資料庫放在一對標準 LUN 上。例如、需要大約 2K 隨機 IOPS 的資料庫、可以裝載在單一 LUN 上的單一檔案系統上。同樣地、只有 100GB 大小的資料庫也能放在單一 LUN 上、而不會造成管理問題。</block>
  <block id="c33bcb4f520265bb106616e844397ffb" category="paragraph">大型資料庫需要多個 LUN 。例如、需要 10 萬 IOPS 的資料庫最可能需要至少八個 LUN 。由於磁碟機的 SCSI 通道數量不足、單一 LUN 將成為瓶頸。10TB 資料庫同樣難以在單一 10TB LUN 上進行管理。邏輯磁碟區管理程式的設計旨在將多個 LUN 的效能和容量功能結合在一起、以改善效能和管理能力。</block>
  <block id="428e88a1415b00f5eb396829b4bd9a2c" category="paragraph">在這兩種情況下、一對 ONTAP 磁碟區應該足夠。透過簡單的組態、資料檔案 LUN 會與記錄 LUN 一樣置於專用磁碟區中。在邏輯 Volume Manager 組態下、資料檔案 Volume 群組中的所有 LUN 都將位於專用磁碟區、而記錄 Volume 群組的 LUN 則位於第二個專用磁碟區。</block>
  <block id="e8c31916b755be39cb0a66804a1d8f8b" category="paragraph">* NetApp 建議 * 在 SAN 上使用兩個檔案系統進行 MySQL 部署：</block>
  <block id="fe9d8ca2c46747e16ed31f64638e66e6" category="list-text">第一個檔案系統會儲存所有 MySQL 資料、包括資料表空間、資料和索引。</block>
  <block id="04d82ed32fa1eeaa6df117c178062441" category="list-text">第二個檔案系統會儲存所有記錄（二進位記錄、慢速記錄和交易記錄）。</block>
  <block id="15bcb76b7e8b441c0d2a6e723f70c20c" category="paragraph">以這種方式分隔資料有多種原因、包括：</block>
  <block id="02774797d31a8f1c6d805860038c32a3" category="list-text">資料檔案和記錄檔的 I/O 模式各不相同。將它們區隔、就能透過 QoS 控制提供更多選項。</block>
  <block id="6cab2c793e807e2d0c57f5b0d96505c1" category="list-text">最佳化使用 Snapshot 技術需要能夠個別還原資料檔案。將資料檔案與記錄檔混合會干擾資料檔案還原。</block>
  <block id="553ad1f7b6f5cfee021e5cf56e56a289" category="list-text">NetApp SnapMirror 技術可用於為資料庫提供簡單、低 RPO 的災難恢復功能、但是資料檔案和記錄檔需要不同的複寫排程。</block>
  <block id="ff5f52a69a35dd41da3e3c4b810e4f94" category="admonition">使用這種基本的兩個磁碟區配置、以符合未來需求的解決方案、以便在需要時使用所有 ONTAP 功能。</block>
  <block id="7b755794e9de5716b2d6305bd10bee1b" category="paragraph">* NetApp 建議 * 使用 ext4 檔案系統格式化磁碟機、因為有下列功能：</block>
  <block id="fa92f58d5035dec5e24a787f76504783" category="list-text">延伸的區塊管理方法、用於日誌檔案系統（ JFS ）中的區塊管理功能、以及延伸檔案系統（ XFS ）的延遲分配功能。</block>
  <block id="a72d73cde02c10703b72dcae6bc7c812" category="list-text">ext4 允許檔案系統最多 1 個 exbibyte （ 2^60 位元組）、檔案最多 16 個 tebibytes （ 16 * 2^40 位元組）。相反地、 ext3 檔案系統僅支援 16TB 的最大檔案系統大小、最大檔案大小為 2TB 。</block>
  <block id="56b4168424fa999bc383d24daf2da4eb" category="list-text">在 ext4 檔案系統中、多區塊分配（ mballoc ）會在單一作業中為檔案分配多個區塊、而非如 ext3 中逐一分配。此組態可減少多次呼叫區塊分配器的成本、並最佳化記憶體配置。</block>
  <block id="632635d22b347f0140fb15d0eb0ed09e" category="list-text">雖然 XFS 是許多 Linux 套裝作業系統的預設值、但它以不同方式管理中繼資料、不適合某些 MySQL 組態。</block>
  <block id="aff8b2ed0a4719f014e5baeb861ea7d4" category="paragraph">* NetApp 建議 * 將 4K 區塊大小選項與 mkfs 公用程式搭配使用、以符合現有區塊 LUN 大小。</block>
  <block id="0a24d0336b7b0b29a9daa97f88499884" category="paragraph"><block ref="018d13c1d8b9abcae080b8abbc7c2d8b" prefix="" category="inline-code"></block></block>
  <block id="86fc8cb3bf2cae621315896a94b35f67" category="paragraph">NetApp LUN 以 4KB 實體區塊儲存資料、產生八個 512 位元組的邏輯區塊。</block>
  <block id="5f441ceabc94de2a9cced94d9f53a2d0" category="paragraph">如果您未設定相同的區塊大小、 I/O 將無法正確對齊實體區塊、而且可能會在 RAID 群組中的兩個不同磁碟機中寫入、導致延遲。</block>
  <block id="236ac851d05b8822524001920948f23d" category="admonition">請務必調整 I/O 、以順利進行讀寫作業。但是、當 I/O 從不在實體區塊開頭的邏輯區塊開始時、 I/O 會未對齊。I/O 作業只有在邏輯區塊（實體區塊中的第一個邏輯區塊）開始時才會對齊。</block>
  <block id="282155126a94a0702cfd80daf38d4362" category="doc">組態總覽</block>
  <block id="3225a10b07f1580f10dee4abc3779e6c" category="cell">參數</block>
  <block id="c82a6100dace2b41087ba6cf99a5976a" category="cell">價值</block>
  <block id="b10db909b8fda84e70bf9b308d0938d9" category="cell">256M</block>
  <block id="c81e728d9d4c2f636f067f89cc14862c" category="cell">2.</block>
  <block id="7ccc31934ae8244d8263d3c09bcee186" category="cell">InnoDB_doublewrite</block>
  <block id="e590322920bebc1156ab585bd6597d76" category="cell">fsync</block>
  <block id="adb0c1ec32461889a5093441599260eb" category="cell">11g</block>
  <block id="774412967f19ea61d448977ad9749078" category="cell">8192</block>
  <block id="311887a53ec7390fc383fa2ad813f012" category="cell">InnoDB_緩 衝區集區執行個體</block>
  <block id="c9f0f895fb98ab9159f51fd0297e236d" category="cell">8.</block>
  <block id="1006f82d8df7d2325439b28ea691737c" category="cell">open_file_limit</block>
  <block id="3c9b5f1cd6a030bcb7bed9eac80589fb" category="cell">65535</block>
  <block id="c9f5a4d3ede4d084dda0a788ed06783c" category="paragraph">若要設定本節所述的參數、您必須在 MySQL 組態檔（ my.cnf ）中變更這些參數。NetApp 最佳實務做法是在內部執行測試的結果。</block>
  <block id="6a554ff1dc93539a626e576bf0d28a02" category="paragraph">MySQL 資料庫的容器化日漸普及。</block>
  <block id="bcc002a9f2e2ade112438f50a6630498" category="paragraph">低層級的容器管理幾乎總是透過 Docker 來執行。OpenShift 和 Kubernetes 等容器管理平台讓大型容器環境的管理變得更簡單。容器化的優點包括成本較低、因為不需要授權 Hypervisor 。此外、容器可讓多個資料庫彼此隔離執行、同時共用相同的基礎核心和作業系統。容器可在微秒內完成佈建。</block>
  <block id="14d9b10c6196045941347a9e85704b50" category="inline-link-macro">Astra Trident文件</block>
  <block id="d4f640fe6950a1baff001f5601c7fbd7" category="paragraph">NetApp 提供 Astra Trident 、可提供進階的儲存管理功能。例如、 Astra Trident 可讓在 Kubernetes 中建立的容器自動在適當的層級上配置儲存設備、套用匯出原則、設定 NetApp Snapshot 複本原則、甚至將一個容器複製到另一個容器。如需其他資訊、請參閱 <block ref="2b8a155fc083396b96b18cee0ba5eab0" category="inline-link-macro-rx"></block>。</block>
  <block id="b8c3891a902a70c4f7f774363652f4b4" category="summary">MySQL 檔案結構</block>
  <block id="5713a921d815fd7d19875846450f8ea8" category="doc">檔案結構</block>
  <block id="4955922857da5499a2f1be602a96b0ff" category="paragraph">InnoDB 是儲存設備和 MySQL 伺服器之間的中間層、可將資料儲存到磁碟機中。</block>
  <block id="8a6fab0b8bb36427eda4071adfd7780b" category="inline-image-macro">錯誤：找不到圖形影像</block>
  <block id="5d416cf65dd1e2c908bf430f957c89f8" category="paragraph">MySQL I/O 分為兩種類型：</block>
  <block id="e8a320970c929abda9ae744b0b9e8f5f" category="list-text">隨機檔案 I/O</block>
  <block id="85430c0aa096ec282f2a14156baa312e" category="list-text">連續檔案 I/O</block>
  <block id="b7b9a4c6983139a2673988826094a3cf" category="paragraph">資料檔案會隨機讀取及覆寫、因此 IOPS 較高。因此、建議使用 SSD 儲存設備。</block>
  <block id="322f79fd77365edecd173807cb429ca2" category="paragraph">重做記錄檔和二進位記錄檔是交易記錄檔。它們會依序寫入、因此您可以在 HDD 上使用寫入快取獲得良好效能。恢復時會進行連續讀取、但很少會造成效能問題、因為記錄檔大小通常比資料檔案小、而連續讀取比隨機讀取快（發生在資料檔案上）。</block>
  <block id="a898d206a27508975fea2e241af2f04e" category="paragraph">雙寫入緩衝區是 InnoDB 的一項特殊功能。InnoDB 會先將排清的頁面寫入雙寫入緩衝區、然後將頁面寫入資料檔案的正確位置。此程序可防止頁面毀損。如果沒有雙寫入緩衝區、如果在寫入磁碟機程序期間發生電源故障、頁面可能會毀損。由於寫入雙寫入緩衝區是循序的、因此對 HDD 進行了高度最佳化。恢復時會進行連續讀取。</block>
  <block id="363512900e45bc17bdd6edfa50582862" category="paragraph">由於 ONTAP NVRAM 已提供寫入保護、因此不需要雙重寫入緩衝。MySQL 有一個參數、<block ref="02d3c518a4019ea00e34e16491d826b4" prefix=" " category="inline-code"></block>，以停用雙寫入緩衝區。此功能可大幅提升效能。</block>
  <block id="49a7df723922bddb4df4002b51087a1c" category="paragraph">插入緩衝區也是 InnoDB 的一項特殊功能。如果非唯一的次要索引區塊不在記憶體中、 InnoDB 會將項目插入插入插入緩衝區、以避免隨機 I/O 作業。插入緩衝區會定期合併到資料庫的次要索引樹中。插入緩衝區可將 I/O 要求合併至同一個區塊、以減少 I/O 作業的數量；隨機 I/O 作業可以是連續的。插入緩衝區也針對 HDD 進行了高度最佳化。連續寫入和讀取都會在正常作業期間執行。</block>
  <block id="6a0190340f27f29279bbfd319800289d" category="paragraph">復原區段以隨機 I/O 為導向。為了保證多重版本併發（ MVCC ）、 InnoDB 必須在復原區段中登錄舊影像。從復原區段讀取先前影像需要隨機讀取。如果您執行具有可重複讀取的長交易（例如 mysqldump —單一交易）或執行長查詢、可能會發生隨機讀取。因此、在這種情況下、將復原區段儲存在 SSD 上會更好。如果您只執行簡短的交易或查詢、隨機讀取並不是問題。</block>
  <block id="a27e0d4b650aa6db30fdd95b54c94b27" category="paragraph">* 由於 InnoDB I/O 特性、 NetApp 建議 * 下列儲存設計配置。</block>
  <block id="defc1bfda928f419df5e4af79c98343e" category="list-text">一個用於儲存 MySQL 的隨機和連續 I/O 導向檔案的磁碟區</block>
  <block id="7fd750411093ebd1faa0d99dd2608514" category="list-text">另一個用於儲存 MySQL 純粹循序 I/O 導向檔案的磁碟區</block>
  <block id="0561a3b014eef0e5125fa63e1626cf57" category="paragraph">此配置也能協助您設計資料保護原則與策略。</block>
  <block id="9166d970028a28a614af39e6286371b7" category="paragraph">您可以使用關閉此參數<block ref="8cafbd8d9096941261e87f4f9152ab92" prefix=" " category="inline-code"></block> 針對效能標竿、或是當您比較在意最高效能、而非資料完整性或可能的故障時。InnoDB 使用稱為雙寫入的檔案清除技術。InnoDB 在將頁面寫入資料檔案之前、會將其寫入稱為雙寫入緩衝區的鄰近區域。寫入和清除雙寫入緩衝區完成後、 InnoDB 會將頁面寫入資料檔案中的適當位置。如果作業系統或 mysqld 程序在頁面寫入期間當機、 InnoDB 之後可以在當機恢復期間、從雙寫入緩衝區找到良好的頁面複本。</block>
  <block id="3dfd4b9a526f8a8cf17021e34638b375" category="admonition">* NetApp 建議 * 停用雙寫入緩衝區。ONTAP NVRAM 的功能相同。雙重緩衝會不必要地損害效能。</block>
  <block id="dd5a2a602f713562e0f9f0fd8385660e" category="doc">MySQL over NFS</block>
  <block id="0e5e83102103fcdd25af430bf7327034" category="paragraph">MySQL 文件建議您將 NFSv4 用於 NAS 部署。</block>
  <block id="ca0d9fdc80b88e73b548638af421788f" category="section-title">ONTAP NFS 傳輸大小</block>
  <block id="efcd0ba3fcbee9896a25804677e70b4b" category="paragraph">根據預設、 ONTAP 將 NFS IO 大小限制為 64K 。使用 MySQL 資料庫的隨機 IO 使用的區塊大小要小得多、遠低於 64K 上限。大型區塊 IO 通常是平行處理的、因此 64K 最大值也不是限制。</block>
  <block id="4655f686de75b23f16d530ed7351c447" category="paragraph">有些工作負載的上限為 64K 、因此會造成限制。尤其是、如果資料庫執行的 IO 數量較少、但容量較大、例如完整表格掃描備份作業等單執行緒作業、將會更快、更有效率地執行。ONTAP 搭配資料庫工作負載的最佳 IO 處理大小為 256k 。針對下列特定作業系統所列出的 NFS 裝載選項已相應從 64K 更新至 256k 。</block>
  <block id="3ab93db30f3dded2c8d71859afbb53f6" category="admonition">切勿將 ONTAP 上允許的傳輸大小上限降至低於目前掛載之 NFS 檔案系統的 rsize/wsize 值。這可能會在某些作業系統中造成當機或甚至資料毀損。例如、如果 NFS 用戶端目前設定為 rsize/wsize 65536 、則 ONTAP 最大傳輸大小可在 65536 到 1048576 之間調整、因為用戶端本身受到限制、因此沒有任何影響。將傳輸大小上限降至 65536 以下可能會損害可用度或資料。</block>
  <block id="5ea0bb5d4dab46d7971fef94ccde9369" category="paragraph">* NetApp 推薦 *</block>
  <block id="09c6aa928c90ba68a4e03deadfeaa644" category="paragraph">設定下列 NFSv4 Fstab （ /etc/fstab ）設定：</block>
  <block id="0ae3c9648bc2d8c33fa57415604da370" category="paragraph"><block ref="a63a3dc825ff52908de7c9dfcb29ffa5" prefix="" category="inline-code"></block></block>
  <block id="3e0b2c100b093560f63ad57c6849bc8a" category="admonition">NFSv3 的常見問題是停電後鎖定的 InnoDB 記錄檔。使用時間或切換記錄檔可解決此問題。不過、 NFSv4 有鎖定作業、並追蹤開啟的檔案和委派。</block>
  <block id="62e4eb800d20b46085ccb975da78bafe" category="sidebar">ONTAP 是許多企業應用程式與資料庫技術的資料管理與資料保護基礎。下列頁面提供 ONTAP 和企業應用程式及基礎架構的最佳實務做法和實作程序指引。</block>
  <block id="78898e52fcbdc5337204a384f2456d4f" category="sidebar">Microsoft SQL Server</block>
  <block id="4f60acc41a8bf3fa75e7f74768637787" category="sidebar">Microsoft SQL Server 資料保護</block>
  <block id="b8529ff730dcf8dd2178d72de271dc4d" category="sidebar">開放原始碼資料庫</block>
  <block id="bb9a5a6fadabab849d2e87f0898d7601" category="sidebar">ONTAP 上的 MariaDB 和 MySQL</block>
  <block id="5ad2a11eceac3ebd7cbf3b534ebdb1db" category="sidebar">ONTAP 上的 PostgreSQL</block>
  <block id="c30dd1a85cf86d95b11c1a08f70130ce" category="sidebar">Oracle資料庫</block>
  <block id="4948dede9f4e7c3dfe48c38f7902f6e5" category="sidebar">ONTAP 上的 Oracle</block>
  <block id="d71074394b511143c8d1108e74a81abb" category="sidebar">Oracle 資料保護</block>
  <block id="f4d8825927d11df25770df5e00d6a52e" category="sidebar">Oracle 移轉</block>
  <block id="86083f3ea21c2385b4f013aae3c57858" category="sidebar">SAP HANA</block>
  <block id="677f2e7e550075f7bbbdac91e0918f2f" category="sidebar">SAP解決方案</block>
  <block id="1b83f2b1c0b7fb3af048c2a59624fe3b" category="sidebar">SAP HANA 搭配 AFF 和 FC</block>
  <block id="6ab3c3f05076d213f0b1feff267607c6" category="sidebar">SAP HANA 搭配 AFF 和 NFS</block>
  <block id="56079badd056a19303cc26e6a4fcc7e0" category="sidebar">VMware</block>
  <block id="f07084a11252c9bca97503ea9a627c89" category="sidebar">使用 ONTAP 的虛擬磁碟區（ VVols ）</block>
  <block id="2d90ac09cbf108bddad31dd341f8614e" category="sidebar">VMware Site Recovery Manager 搭配 ONTAP</block>
  <block id="b0dae11b82e63781abdc8f893c41b3c0" category="sidebar">企業應用程式</block>
  <block id="999bc6b18351bbe817d26f559ba408ae" category="sidebar">SAP</block>
  <block id="2d2eef88dbdd0c34bde24e2632d9944f" category="sidebar">SAP HANA 與 AnyDB</block>
  <block id="399bd1ee587245ecac6f39beaa99886f" category="sidebar">PostgreSQL</block>
  <block id="f4f70727dc34561dfde1a3c529b6205c" category="sidebar">設定</block>
  <block id="c476a4701643b158f9f5d57bcc91951d" category="sidebar">Snapshot 技術</block>
  <block id="35084d885dea7b061e6894c1cf3036d9" category="sidebar">工作負載</block>
  <block id="7d219314ccabde6609510141bb175a6c" category="sidebar">共享執行個體與專用執行個體</block>
  <block id="d5363ae19ecaede49e2ced297df7737a" category="sidebar">記憶體組態</block>
  <block id="500c09aa1bb9af431f2c18348e69bfd0" category="sidebar">tempdb 檔案</block>
  <block id="6fb6843bd9a214011969c02729c7d671" category="sidebar">儲存考量</block>
  <block id="4c5d94eb4dc4bff93f6a96a08ab7b244" category="sidebar">資料安全</block>
  <block id="cf91513c6fc63cebe4b63a6647238d6d" category="sidebar">RAID</block>
  <block id="83db97189c47f7bb4edd879e8756f6e6" category="sidebar">容量限制</block>
  <block id="4d2caccc34711835f6ff99da411ac04e" category="sidebar">儲存虛擬機器</block>
  <block id="af81930661b267e8f1e68c4d66e9ee56" category="sidebar">容錯移轉與切換</block>
  <block id="dfd1f50170457b961c15bb13ad7e3bed" category="sidebar">資料檔案和重做區塊大小</block>
  <block id="49f83bf3a15b8626eb91fde93c6b1788" category="sidebar">Oracle RAC</block>
  <block id="13d80777c8fd43e555c1f5b1b72d7ef0" category="sidebar">主機組態</block>
  <block id="7e6bb0931a72759d39514aa924b420bc" category="sidebar">AIX</block>
  <block id="6bb83af717367dd4a47f75801ae7a2b0" category="sidebar">Linux 搭配 ASMLib 和 AFD</block>
  <block id="619615da0f93507e22a6054ef2aea4f1" category="sidebar">邏輯介面</block>
  <block id="aca8e861c6f30fe2d42d0310a387312b" category="sidebar">乙太網路組態</block>
  <block id="63a5b8bd41978e8124f9ccdfa9063e9e" category="sidebar">FC SAN 組態</block>
  <block id="c3f378ef942f6bf228a43aaacc628fea" category="sidebar">LVM 分拆</block>
  <block id="254f642527b45bc260048e30704edb39" category="sidebar">組態</block>
  <block id="f3a78e25ce9f95fc3c61ccc39f32fb4d" category="sidebar">Oracle Direct NFS（DNFS）</block>
  <block id="989cefa74de0e10a575103f446258d99" category="sidebar">NFS 會租用和鎖定</block>
  <block id="0d695ec265a3b0b5e7e32e33ffe4ed22" category="sidebar">NFS 快取</block>
  <block id="eb4d10d6eda7c9266cd36c4eb0a223cf" category="sidebar">ASM 回收公用程式</block>
  <block id="297e2ac2ec0bd88ad598062f4c07ee45" category="sidebar">分層原則</block>
  <block id="9af6f452cd88c83f2bde555de8f93690" category="sidebar">傳送資料至物件存放區</block>
  <block id="08af6d4e6b562e2d0b418d7198f5a0f7" category="sidebar">從物件存放區擷取資料</block>
  <block id="02d01636975b3ae0c0ab22368cea8d54" category="sidebar">分層策略</block>
  <block id="7fbd108e1fc6910c941094e95a677878" category="sidebar">完整檔案</block>
  <block id="eb43c2427eb06b9f561363863b4a4f0b" category="sidebar">部分檔案</block>
  <block id="1afe200fa26ba361f59b603b22ad6392" category="sidebar">選取檔案</block>
  <block id="448d15345bb99c834095da225c529b8a" category="sidebar">資料可用度</block>
  <block id="5869e10a9dea6d88d61bb10040557f35" category="sidebar">資料完整性</block>
  <block id="7b68149402c05a52968bda6af0435c8a" category="sidebar">快照型線上備份</block>
  <block id="49ba0ee205d016d8236db9c1e8c130e5" category="sidebar">儲存 Snapshot 最佳化備份</block>
  <block id="2c6d98297c340e390e0783220b038545" category="sidebar">實體架構</block>
  <block id="13a854bdd11f8f57a0b25c00631f1430" category="sidebar">邏輯架構</block>
  <block id="5e7988aeba0e1d3c15c5c78a0db738d1" category="sidebar">SyncMirror</block>
  <block id="3f23f85f537c810b6eca3c767c3ff00c" category="sidebar">Oracle 容錯移轉</block>
  <block id="5783cab279142a801ff0fd0a03b607d5" category="sidebar">MetroCluster 上的單一執行個體</block>
  <block id="ea98d1b4d8c0f4b9e705df8dcdf77730" category="sidebar">SM-BC 上的單一執行個體</block>
  <block id="39520db4a78ddf352897eac9b11c5890" category="sidebar">SM-BC 上的 Oracle RAC</block>
  <block id="5ba8ee2f32815884475d1f2244ba16a6" category="sidebar">故障案例</block>
  <block id="e31593850dc03f8f10d036df5dc8633b" category="sidebar">Oracle 資料庫移轉</block>
  <block id="5102abd5a9cc202678054b832caf678d" category="sidebar">程序</block>
  <block id="1495d3ed3ebff783c0f480b583372450" category="sidebar">主機資料複本</block>
  <block id="d81ca5686c955ed50927409eb8c14bb0" category="sidebar">外部 LUN 匯入</block>
  <block id="2fea59b7e470acac5ec1589d504da14e" category="sidebar">完成</block>
  <block id="e9cc85ef98d982c3c3e53d6b82293126" category="sidebar">傳輸協定轉換</block>
  <block id="fbbd0e8905df3950eca4d1d8f55881ad" category="sidebar">其他附註</block>
  <block id="ac0465a970688dc3c326dcdd8fe2805e" category="sidebar">效能最佳化與基準測試</block>
  <block id="7cb9c3cd8b9873d39a1fe87c083cd55c" category="sidebar">過時的 NFS 鎖定</block>
  <block id="c0916addb4f26afa58c5a6df4f463fa5" category="sidebar">統一化儲存設備</block>
  <block id="c0032c6bab44eeeb6886c7a4aa67cf77" category="sidebar">虛擬化工具</block>
  <block id="1c77ac70000b6804e930748d5df7be5e" category="sidebar">虛擬磁碟區和儲存原則型管理</block>
  <block id="217601d383b816e6a2548e57b5006f92" category="sidebar">複製</block>
  <block id="8f2db90dd4a6fbd95ba8f0bc54fd6b27" category="sidebar">QoS</block>
  <block id="09b4a81ec7b05cbacc7cbfa13e006254" category="sidebar">儲存原則型管理</block>
  <block id="2e8526cbe762cb1b8393d935a3b0bf16" category="sidebar">建議設定</block>
  <block id="10a764f91b59ce3c8931d55c2fd54222" category="sidebar">部署 vVols 儲存設備</block>
  <block id="30f6724a02fc69093960468c0a2fbcd4" category="sidebar">產品安全性</block>
  <block id="3390e3575b3e341afa2b7172ff5b33a7" category="sidebar">VMware vSphere的插件SnapCenter</block>
  <block id="62a004b95946bb97541afa471dcca73a" category="sidebar">MySQL</block>
  <block id="7f1a6761f7160e33a32105202e47303b" category="sidebar">容器化</block>
  <block id="bd57f4f74ca087a92a48b23d45753729" category="paragraph">ONTAP 工具 VASA 供應商負責管理 FCP 、 iSCSI 群組、以及 ONTAP 中的 NVMe 子系統、這些子系統是以受管理 ESXi 主機的探索啟動器為基礎。不過、它並未與光纖通道交換器整合以管理分區。在進行任何資源配置之前、必須根據最佳實務做法進行分區。以下是單一啟動器分區至四個 ONTAP 系統的範例：</block>
  <block id="6b14e3f4a37881185acf7a766f8f6272" category="paragraph">單一啟動器分區：</block>
  <block id="17ccf64e30cb518fd7ca87ce752ad738" category="paragraph"><block ref="17ccf64e30cb518fd7ca87ce752ad738" category="inline-image-macro-rx" type="image"></block></block>
  <block id="58b5cd2a94730c2e044c14891f1e0e87" category="paragraph">如需更多最佳實務做法、請參閱下列文件：</block>
  <block id="fc9e4d789d968936f8ff5ae5a99847e0" category="paragraph"><block ref="fc9e4d789d968936f8ff5ae5a99847e0" category="inline-link-rx"></block></block>
  <block id="d748a2834a7220eef4ec4775a51632f9" category="paragraph"><block ref="d748a2834a7220eef4ec4775a51632f9" category="inline-link-rx"></block></block>
  <block id="4047245d73abc6e3ae8bf58ec063e52e" category="paragraph">隨附的 SCP 適用於大多數一般用途、但您的需求可能有所不同。</block>
  <block id="80dad10df0d1a031764e7c648c46aa23" category="paragraph">* 請考慮使用最大 IOPS 來控制未知虛擬機器或測試虛擬機器。 *</block>
  <block id="93e4f73afe8b787b33161ec273ca087f" category="paragraph">VASA Provider 7.1 首度提供最大 IOPS 、可將未知工作負載的 IOPS 限制在特定的 vVol 、以避免對其他更重要的工作負載造成影響。如需效能管理的詳細資訊、請參閱表 4 。</block>
  <block id="bdbd10905a1446f944699405bca52654" category="paragraph">* 確保您擁有足夠的資料生命。 *
每個 HA 配對每個節點至少建立兩個生命期。根據您的工作負載、可能需要更多資源。</block>
  <block id="4e0d7e0587bf99c9b7a64a84fd42f6bd" category="paragraph">請參閱 NetApp 和 VMware 針對您所選傳輸協定的其他最佳實務做法指南。一般而言、除了上述變更之外、沒有其他變更。</block>
  <block id="97f87e9ab1d660463c63beb8745fd9e5" category="paragraph">* 使用 vVols over NFS v2* 的網路組態範例</block>
  <block id="c80b3cc8b5013bd4039769fb0f783e60" category="paragraph"><block ref="c80b3cc8b5013bd4039769fb0f783e60" category="inline-image-macro-rx" type="image"></block></block>
  <block id="dee28dd6d1a9ef7bf399f642fd9d588f" category="section-title">NFS 傳輸大小</block>
  <block id="d8299d00f914e35b80644e5781e47a77" category="paragraph"><block ref="d8299d00f914e35b80644e5781e47a77" category="inline-image-macro-rx" type="image"></block></block>
  <block id="14ce62ac76fa34a51093e6bcf11a2fd1" category="paragraph">資料庫備份的主要考量是運用 NetApp Snapshot 技術。應用程式一致的備份和資料庫配置是達成 NetApp SnapCenter 可協調的 RTO 和 RPO 的另一個重要考量。</block>
  <block id="2c024bdc7d0e87e8ba0f473024d45a4e" category="paragraph">修改伺服器和資料庫設定有助於提升資料庫效能和效率。</block>
  <block id="861f074a1ecd9d1cc088d2fe81903565" category="paragraph"><block ref="861f074a1ecd9d1cc088d2fe81903565" category="inline-image-macro-rx" type="image"></block></block>
  <block id="710e9cd79e3865d47122a799f425b31f" category="paragraph"><block ref="710e9cd79e3865d47122a799f425b31f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="5a656ddcc72bacc3a5900c23edf7a08e" category="paragraph"><block ref="5a656ddcc72bacc3a5900c23edf7a08e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="073ce0a0568adc64d52dd9b1d8c02c54" category="paragraph"><block ref="073ce0a0568adc64d52dd9b1d8c02c54" category="inline-image-macro-rx" type="image"></block></block>
  <block id="d5e31e9b7075c2926dba10053509346b" category="paragraph">儲存效率是 RAID 、資源配置（整體配置和使用率）、鏡像和其他資料保護技術的組合。NetApp 技術（例如 Snapshot 複本、精簡配置、 FlexClone ）可最佳化基礎架構中的現有儲存設備、並延後或避免未來的儲存支出、協助創造成本效益。這些技術搭配使用越多、節省的成本就越大。</block>
  <block id="3401a9880dfc322da8a56c4d632361f6" category="paragraph"><block ref="3401a9880dfc322da8a56c4d632361f6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="87f823f4f3b4258445d5af029afe5ad9" category="paragraph"><block ref="87f823f4f3b4258445d5af029afe5ad9" category="inline-image-macro-rx" type="image"></block></block>
  <block id="9213fe9d391179276ff6c03552486255" category="paragraph"><block ref="9213fe9d391179276ff6c03552486255" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3105b4c0642b9710179c18edcf8e8718" category="paragraph"><block ref="3105b4c0642b9710179c18edcf8e8718" category="inline-image-macro-rx" type="image"></block></block>
  <block id="1a43000eb9893bff7ab7b1ce1d3fd6a8" category="paragraph"><block ref="1a43000eb9893bff7ab7b1ce1d3fd6a8" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4b7a8562c98b8c652bdfb6aa79788222" category="paragraph"><block ref="4b7a8562c98b8c652bdfb6aa79788222" category="inline-image-macro-rx" type="image"></block></block>
  <block id="25cec91f17a8619119f76c8adbace583" category="paragraph">另請參閱一節中有關壓縮區塊對齊的討論 <block ref="0faffd62be034c86d531acfee84d252e" category="inline-link-macro-rx"></block>。任何與 8KB 壓縮區塊邊界對齊的配置、也會與 4KB 邊界對齊。</block>
  <block id="38ac6f4e1538397bd4f659237ec03ebf" category="paragraph"><block ref="38ac6f4e1538397bd4f659237ec03ebf" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f01518e5f3b18a9ea241bc63a3475dbd" category="paragraph"><block ref="f01518e5f3b18a9ea241bc63a3475dbd" category="inline-image-macro-rx" type="image"></block></block>
  <block id="acce752526553bfa73c92799accd9cb8" category="summary">Oracle 資料保護總覽</block>
  <block id="deb8cb7644231cae002f5f37c725b86f" category="paragraph">遠距離移轉通常需要更具創意的方法、例如中所說明的記錄傳送程序 <block ref="86efe12ea0d3a769a4b7cfc2b6362f49" category="inline-link-macro-rx"></block>。遠距 IP 網路在任何接近 LAN 或 SAN 速度的地方、都很少會有頻寬。在某種情況下、 NetApp 協助 220 TB 資料庫進行遠距移轉、而且產生的歸檔記錄率非常高。所選的資料傳輸方法是每天運送磁帶、因為這種方法提供最大可能的頻寬。</block>
  <block id="055362c7082175c34483772a43b776cf" category="paragraph">例如、複製 10TB 資料庫通常需要大約七小時才能完成。如果企業需要中斷七小時、檔案複製是輕鬆安全的移轉選項。如果五小時不可接受、則只需簡單的記錄傳送程序（請參閱 <block ref="eee8a7589b6555fc3411165c58a62ca5" category="inline-link-macro-rx"></block>）只需最少的努力就能設定、將轉換時間縮短至約 15 分鐘。在此期間、資料庫管理員可以完成此程序。如果 15 分鐘是不可接受的、則可透過指令碼將最後的轉換程序自動化、將轉換時間縮短至幾分鐘。您可以隨時加快移轉速度、但這樣做的代價是時間和精力。轉換時間目標應以企業可接受的內容為基礎。</block>
  <block id="911e63244fc82405263306a64e535c69" category="paragraph">只有在中的步驟之後才應建立 zpool <block ref="e8673fdb712a2edcdf56742c7eec0045" category="inline-link-macro-rx"></block> 執行。如果程序未正確執行、可能會因為 I/O 對齊而導致嚴重的效能降低。ONTAP 的最佳效能要求 I/O 必須與磁碟機上的 4K 邊界對齊。在 zpool 上建立的檔案系統使用有效的區塊大小、並透過稱為的參數加以控制<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block>，您可以執行命令來檢視<block ref="1615297782a0dff59b20451e2ca97ea7" prefix=" " category="inline-code"></block>。</block>
  <block id="b2ca9da17ac7a0807fb313343c1ba9cb" category="list-text">已建立磁碟分割、並使用 33 磁區偏移值、而非預設的 32 。重複中所述的程序 <block ref="6ba0f94fdd8f9504e3fef5712023fb85" category="inline-link-macro-rx"></block>。直方圖顯示如下：</block>
  <block id="eb7f9a88026c895932f70c650c364132" category="list-text">增加 LUN 的大小</block>
  <block id="0f11c45e6e7377b9d10a93534d0fa2f3" category="list-text">將 LUN 新增至現有的磁碟區群組、並擴充內含的邏輯磁碟區</block>
  <block id="e4da750cce448393b2597f8f66086894" category="paragraph">啟動器群組（ igroup ）是 ONTAP LUN 遮罩架構的一部分。除非先授予主機存取權、否則無法存取新建立的 LUN 。這是透過建立一個 igroup 、列出應授予存取權的 FC WWN 或 iSCSI 啟動器名稱來完成。在撰寫本報告時、僅 FC LUN 支援 FLI 。不過、轉換為 iSCSI 後移轉是一項簡單的工作、如所示 <block ref="43085dc2a05784d4912331d1ed1db91d" category="inline-link-macro-rx"></block>。</block>
  <block id="525e71fb331412cd820122c3d51d453c" category="paragraph">這可讓 DBA 在資料刪除後回收儲存陣列上的空間。ONTAP 會攔截零並取消分配 LUN 的空間。回收程序非常快速、因為儲存系統中沒有寫入資料。</block>
  <block id="be17af715060572d2df93d7ffe4ce6dd" category="paragraph">可靈活建立VM和虛擬磁碟的資料存放區。ONTAP雖然ONTAP 使用VSC來配置vSphere的資料存放區時會套用許多功能不實的最佳實務做法（請參閱一節 <block ref="2e24324ebf41be836715e1e0dd648f4f" category="inline-link-macro-rx"></block>）、以下是一些額外的考量準則：</block>
  <block id="141c3dc68be34b8f11c2a120b36a1eb8" category="list-text">在某些情況下、您甚至不需要資料存放區。為獲得最佳效能與管理能力、請避免將資料存放區用於高I/O應用程式、例如資料庫和某些應用程式。相反地、請考慮使用來賓擁有的檔案系統、例如NFS或iSCSI檔案系統、由來賓或RDM管理。如需特定的應用程式指南、請參閱適用於您應用程式的NetApp技術報告。例如、 <block ref="cfa0393f870bc70fd8973ae18376facc" category="inline-link-macro-rx"></block> 提供虛擬化的相關章節、並提供實用的詳細資料。</block>
  <block id="3cd9527ff0ddb17e00c08bdb4cd1a776" category="paragraph">vSphere 中使用 VM 儲存原則來管理儲存 I/O 控制或 vSphere 加密等選用功能。它們也可與 vVols 搭配使用、將特定的儲存功能套用至 VM 。使用「 NetApp.Cluster.Data.ONTAP.VP.VVOL 」儲存類型和「 profilename 」規則、透過使用原則將特定的 SCP 套用至 VM 。請參閱連結： vmware-vols-ontap.html#Best Practices [ 透過 NFS v3 使用 vVols 的範例網路組態 ] 、以瞭解 ONTAP 工具 VASA Provider 的範例。「 NetApp.Cluster.Data.ONTAP.VP.VASA10 」儲存設備的規則將用於非 vVols 型資料存放區。</block>
  <block id="36ad91be49fdde7d3fadeba0fb782510" category="paragraph">一旦建立儲存原則、就可以在佈建新 VM 時使用、如所示 <block ref="d202b3fe265f968d81802fcec9f3c381" category="inline-link-macro-rx"></block>。有關搭配 VASA Provider 7.2 使用效能管理功能的準則、請參考 <block ref="8fdd8868d80d04eecf1b4189862f536c" category="inline-xref-macro-rx"></block>。</block>
  <block id="14bdf3569ec0024259b2b02c5a668eae" category="paragraph">何時<block ref="7ccc31934ae8244d8263d3c09bcee186" prefix=" " category="inline-code"></block> 啟用（預設）時、 InnoDB 會將所有資料儲存兩次：先儲存至雙寫入緩衝區、然後儲存至實際資料檔案。</block>
  <block id="394ad91b4701dbd32675896bed204755" category="sidebar">PostgreSQL 的主機組態</block>
  <block id="9852487272d9b2aa9026d0fddc0616fc" category="sidebar">PostgreSQL 的儲存組態</block>
  <block id="bc237072428e0e4c415160b898946d4c" category="sidebar">PostgreSQL 的資料保護</block>
  <block id="3423582eed75b4bd6632c18238fd78e4" category="sidebar">Microsoft SQL Server 的資料庫組態</block>
  <block id="6e97cf67ec5979ab5828852639efa208" category="sidebar">Microsoft SQL Server 的儲存組態</block>
  <block id="5a4517368fb2ab5498fc2108c2ea64c5" category="sidebar">Oracle 資料庫的資料庫組態</block>
  <block id="e483c0ecf3a2b1a60f886d4a5ac553ff" category="sidebar">Oracle 資料庫的主機組態</block>
  <block id="06b078afa802a679ad4694d13a8a2495" category="sidebar">Oracle 資料庫的網路組態</block>
  <block id="f1991b28c5d48cb53798755acf9dfe62" category="sidebar">Oracle 資料庫的儲存組態</block>
  <block id="ea9cdfcbfcf1906c15b6779f0f327028" category="sidebar">MySQL 的資料庫組態</block>
  <block id="308f8f580d0248ac023557cfd4b10d83" category="sidebar">MySQL 的主機組態</block>
  <block id="830f353b3e6055499fac447b16b0c935" category="sidebar">MySQL 的儲存組態</block>
  <block id="3106f8f17f2974fe05da16fb0cc50505" category="summary">ONTAP 上具有 SAN 的 PostgreSQL 資料庫</block>
  <block id="74cacb0c34a37e2859e3b054938a344d" category="doc">具有 SAN 檔案系統的 PostgreSQL</block>
  <block id="1758f5c81d60f1a0ac8600fddc99a919" category="paragraph">具有 SAN 的 PostgreSQL 資料庫通常裝載在 xfs 檔案系統上、但如果作業系統廠商支援、也可以使用其他資料庫</block>
  <block id="d73e7b56b7baa813a32c521ca074e7c4" category="paragraph">雖然單一 LUN 通常可支援高達十萬 IOPS 、但 IO 密集的資料庫通常需要使用含分段的 LVM 。</block>
  <block id="f7cc8c4234952826818ad4d0c2050ac9" category="paragraph">PostgreSQL 資料庫可以裝載在 NFSv3 或 NFSv4 檔案系統上。最佳選項取決於資料庫以外的因素。</block>
  <block id="1482c42acc1dd31ee8496c71a805e73c" category="paragraph">例如、在某些叢集式環境中、 NFSv4 鎖定行為可能較為理想。（請參閱 <block ref="bc3a7e667477b8b3590fa1451dcb924c" category="inline-link-macro-rx"></block> 如需其他詳細資料）</block>
  <block id="9674525687765646f35916d0e569eda9" category="paragraph">否則、資料庫功能應接近相同、包括效能。唯一的要求是使用<block ref="d64a84456adc959f56de6af685d0dadd" prefix=" " category="inline-code"></block> 掛載選項。這是為了確保軟性逾時不會產生無法恢復的 IO 錯誤。</block>
  <block id="0c6430fad6c643c444b5d6d52b18edb4" category="paragraph">如果選擇 NFSv4 作為傳輸協定、 NetApp 建議使用 NFSv4.1 。NFSv4.1 中的 NFSv4 傳輸協定有一些功能性增強功能、可改善 NFSv4.0 的恢復能力。</block>
  <block id="248212b04c23627e2719e106224d2eb3" category="paragraph">針對一般資料庫工作負載、請使用下列掛載選項：</block>
  <block id="9efbdff43e91279291e95690414bec95" category="paragraph">在 ONTAP 層級增加傳輸大小後、將會使用下列掛載選項：</block>
  <block id="395201f6a339cc4cf6b345e0c259f383" category="section-title">NFSv3 TCP 插槽表</block>
  <block id="1f8260aa2c5a5b35bf771c26828d2096" category="paragraph">如果 NFSv3 與 Linux 搭配使用、則正確設定 TCP 插槽表至關重要。</block>
  <block id="92d0a1aef2134a70d5c0f0279dc22ec6" category="doc">Snapshot複本</block>
  <block id="0c47b4eb567b018e3d2e5882b88eaca9" category="paragraph">儲存快照是目標資料的時間點複本。ONTAP 的實作功能包括設定各種原則、每個磁碟區最多可儲存 1024 個快照。ONTAP 中的快照具有極高的空間效率。空間只會在原始資料集變更時使用。它們也是唯讀的。快照可以刪除、但無法變更。</block>
  <block id="7986a4827296ca9cd0b991ded9f8a10d" category="paragraph">在某些情況下、可以直接在 ONTAP 上排程快照。在其他情況下、在建立快照之前、可能需要 SnapCenter 等軟體來協調應用程式或作業系統的作業。無論哪種方法最適合您的工作負載、積極的快照策略都能透過頻繁且容易存取的方式、來提供資料安全性、從開機 LUN 到關鍵任務資料庫、都能備份所有資料。</block>
  <block id="210c45246ad11e0b53bdb20b64266780" category="paragraph">* 注意 * ： ONTAP 彈性 Volume （或更簡單的）磁碟區與 LUN 並不等同。Volume 是管理容器、用於儲存檔案或 LUN 等資料。例如、資料庫可能放置在 8-LUN 等量磁碟區集上、而所有 LUN 都包含在單一磁碟區中。</block>
  <block id="ad590deba1cd4423ee565e822c3a91d1" category="paragraph">如需快照的詳細資訊、請按一下 <block ref="211d7effcac0cb0488144c6fc8b3cb7c" category="inline-link-macro-rx"></block></block>
  <block id="c4bf0f56feeec9a45e973768fbc4f47e" category="section-title">防竄改快照</block>
  <block id="d2e783db61d20da61c761d4d473bed14" category="paragraph">從 ONTAP 9.12.1 開始、快照不只是唯讀的、也可以防止意外或刻意刪除。此功能稱為防竄改快照。您可以透過快照原則設定及強制執行保留期間。產生的快照必須等到到期日才會刪除。沒有系統管理或支援中心覆寫。</block>
  <block id="38fef959179f8d3eb79a68a5ce747bdc" category="paragraph">如此可確保入侵者、惡意內部人員、甚至勒索軟體攻擊都無法入侵備份、即使備份導致存取 ONTAP 系統本身也是如此。如果結合頻繁的快照排程、就能以極低的 RPO 提供極強大的資料保護功能。</block>
  <block id="c64db0c79e66c1c0e5b932c5d2dedfea" category="paragraph">如需防竄改快照的詳細資訊、請按一下 <block ref="134603be635c039f9224bff191c6103c" category="inline-link-macro-rx"></block></block>
  <block id="a1f41e52e9ddbd9f87ecd032c237b1c0" category="section-title">SnapMirror 複寫</block>
  <block id="1bb837ddfb635c39a6c6e23d847823f9" category="paragraph">快照也可以複寫到遠端系統。這包括防竄改快照、在遠端系統上套用及強制執行保留期間。因此資料保護效益與本機快照相同、但資料位於第二個儲存陣列上。如此可確保原始陣列的毀損不會影響備份。</block>
  <block id="18d315ae923785b3f9c5234724b0ab42" category="paragraph">第二個系統也會開啟新的管理安全選項。例如、某些 NetApp 客戶會將主要和次要儲存系統的驗證認證資料加以分隔。沒有單一管理使用者可以存取這兩個系統、這表示惡意系統管理員無法刪除所有資料複本。</block>
  <block id="e805272dcce51c35975e830e5ee9ecaf" category="paragraph">如需 SnapMirror 的詳細資訊、請按一下 <block ref="9abdfd5d94773cf0a996248d1d722cac" category="inline-link-macro-rx"></block></block>
  <block id="500569e3cc0764260a592cb176921ca3" category="section-title">儲存虛擬機器</block>
  <block id="d5174dd4c760ef1a826b3e5bc22215e5" category="paragraph">新設定的 ONTAP 儲存系統類似於新佈建的 VMware ESX 伺服器、因為在建立虛擬機器之前、兩者都無法支援任何使用者。透過 ONTAP 、您可以建立儲存虛擬機器（ SVM ）、成為最基本的儲存管理單元。每個 SVM 都有自己的儲存資源、傳輸協定組態、 IP 位址和 FCP WWN 。  這是 ONTAP 多租戶的基礎。</block>
  <block id="597cb258dd509add7cd999794c60d430" category="paragraph">例如、您可以為關鍵的正式作業工作負載設定一個 SVM 、並在不同的網路區段上設定第二個 SVM 以進行開發活動。然後、您可以限制特定管理員存取正式作業 SVM 、同時讓開發人員更廣泛地控制開發 SVM 中的儲存資源。您可能也需要為財務和人力資源團隊提供第三個 SVM 、以儲存特別重要的純眼資料。</block>
  <block id="18519d16720b1e13890c2639657b5bf8" category="paragraph">如需有關 SVM 的詳細資訊、請按一下 <block ref="a06a0fd566387240178b1c926e07cb7b" category="inline-link-macro-rx"></block></block>
  <block id="7d0fc71fe28e011ca49b06214469d484" category="section-title">管理 RBAC</block>
  <block id="4f0dae2ba2fd11c533349d6ade4f81de" category="paragraph">ONTAP 提供強大的角色型存取控制（ RBAC ）功能、可用於管理登入。某些管理員可能需要完整的叢集存取權、而其他管理員可能只需要存取特定的 SVM 。進階服務台人員可能需要增加磁碟區大小的能力。因此、您可以授予系統管理使用者執行工作職責所需的存取權限、而無需再提供其他權限。此外、您可以使用來自不同廠商的 PKI 來保護這些登入安全、僅限制對 ssh 金鑰的存取、並強制執行失敗的登入嘗試鎖定。</block>
  <block id="6ae13b0198daa7d13d79a8631297e64d" category="paragraph">如需管理存取控制的詳細資訊、請按一下 <block ref="db5be08b697b5ef26e0e94da1d5f4970" category="inline-link-macro-rx"></block></block>
  <block id="671a94a08dff3cf44fad087e2346c8b0" category="section-title">Multfactor 驗證</block>
  <block id="c6595c32ea3c4aa315aa5c66b88b0a54" category="paragraph">ONTAP 和其他某些 NetApp 產品現在支援使用各種方法的多因素驗證。因此、光是使用者名稱 / 密碼就不再是安全執行緒、而沒有第二個因素的資料、例如 FOB 或智慧型手機應用程式。</block>
  <block id="945c88a63c229c39ee73ab5592b3ef63" category="paragraph">如需詳細資訊、請按一下 <block ref="03628d0cd13b6640ef56c399aa1c2070" category="inline-link-macro-rx"></block></block>
  <block id="852741d2a7fb0a8a1a5dd748dbbd6734" category="section-title">API RBAC</block>
  <block id="bbbea5fec67f15424fa77aa563754c49" category="paragraph">自動化需要 API 呼叫、但並非所有工具都需要完整的管理存取權。為了協助保護自動化系統的安全、 API 層級也提供 RBAC 。您可以將自動化使用者帳戶限制為所需的 API 呼叫。例如、監控軟體不需要變更存取權、只需要讀取存取權。配置儲存設備的工作流程不需要刪除儲存設備的能力。</block>
  <block id="97ad75902b447ba6b23cabdb10252ce8" category="paragraph">若要深入瞭解、請開始 <block ref="d3dd665f13f927a9546f36768f8407dd" category="inline-link-macro-rx"></block></block>
  <block id="cb93ad4589e6e6834d2627d2ef8c8456" category="section-title">多管理員驗證</block>
  <block id="7604bad489eaec7e27d112c63d3e2936" category="paragraph">若要進一步進行多重「因素」驗證、需要兩位不同的管理員（每位管理員都有自己的認證）來核准某些活動。這包括變更登入權限、執行診斷命令和刪除資料。</block>
  <block id="e890d04cd745ac382688bbb307655e81" category="paragraph">如需多管理驗證（ MAV ）的詳細資訊、請按一下 <block ref="88f84d4fec0424d978600980bf11baf0" category="inline-link-macro-rx"></block></block>
  <block id="b39c0496b44447232912303246b46aaa" category="paragraph">如果需要大量連續 IO 、則可依照下節所述增加 NFS 傳輸大小。</block>
  <block id="f8fd5d7386ed935c8520d4e04b029e93" category="paragraph">下列各節將說明一些重要的記憶體組態設定。</block>
  <block id="959e8f746f4ff03f6225b95cf646e65f" category="admonition">本文件取代先前發佈的技術報告 _TR-4590 ： Microsoft SQL Server 與 ONTAP 的最佳實務做法指南</block>
  <block id="1f6b7ed754cfe3488cf91c21c13ec49a" category="paragraph">保護資料庫環境是一項不只管理資料庫本身的多維工作。NetApp 提供數項獨特功能、旨在保護資料庫基礎架構的儲存層面。</block>
  <block id="15d2f797f7375b32cb5e92538291f2af" category="list-text"><block ref="15d2f797f7375b32cb5e92538291f2af" category="inline-link-rx"></block></block>
  <block id="36d72286c0ef70108b2f7791b73fdc6d" category="list-text">先前的指南建議建立 LIF 至資料位置。也就是說、務必使用實體擁有磁碟區的節點上的LIF來掛載資料存放區。這已不再是ONTAP 現今版本的更新要求。只要可能、而且如果提供叢集範圍的認證、 ONTAP 工具仍會選擇在資料的本機生命體之間平衡負載、但這並不是高可用度或高效能的需求。</block>
  <block id="aa131b86ebd9f719bab1aba612ae3c3f" category="list-text">當恢復計畫中的資料存放區數量和保護群組數量減至最少時、 SRM 會發揮最佳效能。因此、您應該考慮在受 SRM 保護的環境中最佳化虛擬機器密度、以因應 RTO 至關重要的環境。</block>
  <block id="afab42482b97a8b43c62320c373ded74" category="list-text">使用 Distributed Resource Scheduler （ DRS ）協助平衡受保護和恢復 ESXi 叢集的負載。請記住、如果您計畫進行容錯回復、當您執行重新保護之前受保護的叢集時、就會成為新的恢復叢集。DRS 有助於平衡兩個方向的放置。</block>
  <block id="8ed6c5d9143eeb92cf75bb8a08bb7819" category="list-text">儘可能避免將 IP 自訂功能與 SRM 搭配使用、因為這樣可能會增加 RTO 。</block>
  <block id="8baa3b91d59f004ee489f4f3fd3dd4e4" category="paragraph">從 SRM 8.3 開始、支援使用 vVols 資料存放區的 VM 保護。當在ONTAP 「VMware Tools設定」功能表中啟用vVols複寫時、VASA供應商會將SnapMirror排程公開給VM儲存原則、如下列螢幕擷取畫面所示。</block>
  <block id="3c1a2fd7a7a41ca20efeae84dc73ba0a" category="paragraph">以下範例顯示啟用 vVols 複寫。</block>
  <block id="fc7cd76ae57374916b5edd5a2dd19fee" category="paragraph">與先前的vVols資料存放區不同、複寫的vVols資料存放區必須從啟用複寫的開始建立、而且必須使用ONTAP 在具有SnapMirror關係的SnapMirror系統上預先建立的磁碟區。這需要預先設定叢集對等和SVM對等等項目。這些活動應由 ONTAP 管理員執行、因為這有助於在多個站台之間管理 ONTAP 系統的人員與主要負責 vSphere 作業的人員之間、嚴格區分責任。</block>
  <block id="e4ad04c89e34f6ca94c87cd68315b108" category="paragraph">這是vSphere管理員的新要求。由於建立的磁碟區超出ONTAP 了功能性測試工具的範圍、因此在ONTAP 定期排程的重新探索期間之前、系統管理員不會察覺到您所做的變更。因此、當您建立要與vVols搭配使用的Volume或SnapMirror關係時、一律執行重新探索是最佳實務做法。只要在主機或叢集上按一下滑鼠右鍵、然後選取「 NetApp ONTAP 工具」 &gt; 「更新主機和儲存資料」、如下面的螢幕擷取畫面所示。</block>
  <block id="e2e7245b1b3cf4a13a6b703ead49ebee" category="paragraph">系統會為每個陣列配對建立陣列管理程式。有了SRM和ONTAP VMware等工具、每個陣列配對都是以SVM的範圍來完成、即使您使用叢集認證資料也是如此。這可讓您根據指派給租戶的SVM進行管理、在租戶之間分割DR工作流程。您可以為指定的叢集建立多個陣列管理員、而且這些管理員可以是非對稱的。您可以在不同ONTAP 的叢集之間進行扇出或扇入。例如、您可以將叢集1上的SVMA和SVM-B複製到叢集2上的SVM-C、叢集3上的SVM-D、或反之。</block>
  <block id="3233e61306af256f9de7fd3086bc08bf" category="paragraph">複寫群組的考量因素有多種、以及如何將VM分散到FlexVol 整個流程區。將類似的 VM 分組在同一個磁碟區中、可以提高儲存效率、因為較舊的 ONTAP 系統缺乏 Aggregate 層級的重複資料刪除功能、但群組會增加磁碟區的大小、並減少磁碟區 I/O 並行處理。在現代 ONTAP 系統中、透過在同一個集合體中跨 FlexVol 磁碟區散佈 VM 、以達到最佳的效能與儲存效率平衡、進而運用彙總層級的重複資料刪除技術、並在多個磁碟區之間取得更高的 I/O 平行化。您可以將磁碟區中的虛擬機器一起還原、因為保護群組（如下所述）可以包含多個複寫群組。此配置的缺點是、磁碟區 SnapMirror 不會將 Aggregate 重複資料刪除納入考量、因此可能會多次透過線路傳輸區塊。</block>
  <block id="670ea4d89ef5c48c4f2d840baf48688c" category="paragraph">例如、您的公司可能擁有第 1 層關鍵業務應用程式、而該應用程式則仰賴 Microsoft SQL Server 來執行其資料庫。因此、您決定將虛擬機器置於優先順序群組1。在優先順序群組1中、您開始規劃訂單以啟動服務。您可能希望Microsoft Windows網域控制器在Microsoft SQL伺服器之前開機、而Microsoft SQL伺服器必須在應用程式伺服器之前上線、依此類推。您可以將所有這些 VM 新增至優先順序群組、然後設定相依性、因為相依性僅適用於指定的優先順序群組。</block>
  <block id="512ee19e5020f3ee80a9e25f3f5a6468" category="paragraph">最佳實務做法是、只要對受保護的VM儲存設備組態進行變更、就必須執行測試容錯移轉。如此可確保在發生災難時、 Site Recovery Manager 能夠在預期的 RTO 目標內還原服務。</block>
  <block id="4da3f855cd505741909cfd49d743e68e" category="paragraph">SRM也可讓您在VM恢復時變更其網路組態。此重新設定包括 IP 位址、閘道位址和 DNS 伺服器設定等設定。不同的網路設定會在個別 VM 恢復時套用到它們、您可以在恢復計畫中的 VM 內容設定中指定。</block>
  <block id="e409450ce49f3558b068c69a77a9623a" category="paragraph">在容錯回復之後、您應該向所有相關人員確認他們的服務已恢復正常、然後再重新執行「重新保護」、</block>
  <block id="a42cf9beb4788dddb7d317e05cc08e23" category="sidebar">資料庫檔案和檔案群組</block>
  <block id="8858bb6564a2efc189c9183c495ce545" category="sidebar">LUN 對齊</block>
  <block id="02bc4ad8a694d41c8b598dfbcb12f069" category="sidebar">LUN 數量和 LUN 大小</block>
  <block id="066f208a93617bd82090d42624ce63cc" category="sidebar">LUN 調整大小</block>
  <block id="9eeba6fd02cf3b6d8aee35e0ce9bf8fe" category="sidebar">LVM 分拆</block>
  <block id="183bdb28f19bee640319f68825827aea" category="sidebar">RPO 、 RTO 和 SLA</block>
  <block id="2172b5d51273924b537842b0db78bfd4" category="sidebar">備份與還原基礎知識</block>
  <block id="3403aac944f3cb6e2d2c7f7d52bc44b9" category="paragraph">隨著資料呈指數成長、企業的資料管理變得更加複雜。這種複雜性會增加授權、營運、支援和維護成本。若要降低整體 TCO 、請考慮使用可靠、高效能的後端儲存設備、從商業資料庫切換為開放原始碼資料庫。</block>
  <block id="dcac08882e3396bd30210108baa1641d" category="paragraph">ONTAP 是理想的平台、因為 ONTAP 是專為資料庫所設計。為了滿足資料庫工作負載的需求、我們特別建立了許多功能、例如隨機 IO 延遲最佳化、以提供進階服務品質（ QoS ）到基本 FlexClone 功能。</block>
  <block id="1429a98a71e16287326edd7fc1f999fd" category="paragraph">其他功能（例如不中斷升級）（包括儲存設備更換）、可確保關鍵資料庫仍可使用。您也可以透過 MetroCluster 為大型環境進行即時災難恢復、或是使用 SnapMirror 主動式同步來選擇資料庫。</block>
  <block id="8df3fb35ff15e02683bfb1bc7f852c93" category="paragraph">最重要的是、 ONTAP 提供無與倫比的效能、並能根據您的獨特需求調整解決方案的規模。我們的高階系統可提供超過 1M IOPS 、延遲時間以微秒為測量單位、但如果您只需要 10 萬次 IOPS 、您可以使用仍執行相同儲存作業系統的較小控制器來調整儲存解決方案的大小。</block>
  <block id="97b4cda00dd31f5be69440f48c4da149" category="summary">ONTAP 的 PostgreSQL 資料庫組態</block>
  <block id="c4f52498c0db572381512887d7584e53" category="summary">PostgreSQL 資料庫和儲存快照</block>
  <block id="b0792163c858a7c221b236d84619b5ef" category="summary">PostgreSQL 使用 ONTAP 來資料庫 NFS</block>
  <block id="189950ed46e5e8b7e92941531a5bb88b" category="doc">具有 NFS 檔案系統的 PostgreSQL 資料庫</block>
  <block id="504cd1fb60a8eb7918484270e743ae3a" category="summary">PostgreSQL 資料保護 P</block>
  <block id="6cabd4dcf3582d38c441228705da3bda" category="doc">PostgreSQL 資料保護</block>
  <block id="383a6a5241ecfc558b9fec1d7cff5239" category="summary">PostgreSQL 表格空間</block>
  <block id="20d0e2519b3555a0a2927c8914c17280" category="summary">PostgreSQL 資料保護軟體</block>
  <block id="29e2aec511a8e307ecceacbd86c22f14" category="summary">PostgreSQL 初始化參數</block>
  <block id="55e3f073b1864d9281d074e5b23effca" category="doc">Oracle 效能最佳化與基準測試程序</block>
  <block id="035ecd1be6cacde993302b440e396bc2" category="paragraph">大多數資料庫客戶現在都選擇 All Flash Array 、這會造成一些額外考量。例如、請考慮在雙節點 AFF A900 系統上進行效能測試：</block>
  <block id="33f545d041b93838074263c0efd2e9da" category="list-text">有了 80/20 讀取 / 寫入比率、兩個 A900 節點可在延遲甚至超過 150 μ s 標記之前、提供超過 1M 的隨機資料庫 IOPS 。這遠遠超出了大多數資料庫目前的效能需求、很難預測預期的改善。儲存設備將會大幅清除、成為瓶頸。</block>
  <block id="0445195555faac96ebff962dbff126ea" category="summary">MySQL 組態參數</block>
  <block id="c0b7708ffcd66fd65a9d2a4801091563" category="paragraph">NetApp 建議使用一些重要的 MySQL 組態參數、以獲得最佳效能。</block>
  <block id="10eb8b7e75da1815860da31490513841" category="summary">使用 NFS 的 MySQL</block>
  <block id="5249e05857621fbfae51371a73006c44" category="summary">MySQL 和 NFSv3 插槽表</block>
  <block id="d058f95e3a8d4b7b46802139d6b95982" category="paragraph">Linux 上的 NFSv3 效能取決於所呼叫的參數<block ref="453f2cc2326f82af1053f4aa4b75400b" prefix=" " category="inline-code"></block>。</block>
  <block id="bf2bdc980948fb9084a63963398846b2" category="paragraph">ONTAP 是適用於 MySQL 資料庫的理想平台、因為 ONTAP 確實是專為資料庫所設計。為了滿足資料庫工作負載的需求、我們特別建立了許多功能、例如隨機 IO 延遲最佳化、以提供進階服務品質（ QoS ）到基本 FlexClone 功能。</block>
  <block id="1b3804b7e2292e18f5e66d54f7a9fafc" category="paragraph">最重要的是、 ONTAP 提供無與倫比的效能、並能根據您的獨特需求調整解決方案的規模。我們的高階系統可提供超過 1M IOPS 、延遲時間以微秒為測量單位、但如果您只需要 10 萬次 IOPS 、您可以使用更小的控制器來調整儲存解決方案的大小、而該控制器仍可執行完全相同的儲存作業系統。</block>
  <block id="1339877637a3f7f59745a00e04f304fd" category="summary">MySQL 和 InnoDB_log_file_size</block>
  <block id="c1c4e722764621d56a075e42ce48d0c0" category="summary">MySQL 和 InnoDB_緩 衝區 Pool 大小</block>
  <block id="ae14ab6d1e5edd0e782d8897d1721eb4" category="summary">MySQL 和 InnoDB_doublewrite</block>
  <block id="689c52e3f5db5d2dafccd7d93cf1abc4" category="summary">MySQL 和 InnoDB_Fling_log_AT_TRx_commi</block>
  <block id="639600080c225673dfdfa012fdbd6146" category="summary">MySQL 和 IO 排程器</block>
  <block id="32e3724e2b54692cbef969373fbfe040" category="doc">I/O 排程器和 MySQL</block>
  <block id="72985ac51e91797345b2437088a4362e" category="summary">MySQL 搭配 SAN</block>
  <block id="d5ef0a45fe252b03f538bfd134b168db" category="summary">MySQL 和 InnoDB_LRU_SCAN_depth</block>
  <block id="df657260453f6ef228ee0ca22dd7a415" category="summary">MySQL 容器化</block>
  <block id="885b1b5a90f898c89b664ec58a42121c" category="doc">MySQL 容器化</block>
  <block id="2cbac38815d492c0afc5e7d7229601df" category="doc">MySQL 和 InnoDB</block>
  <block id="1115aaa86f0065e0a105795d33ef4731" category="summary">MySQL 檔案說明</block>
  <block id="2828450fc6669c8df75f937e227996f1" category="doc">MySQL 檔案描述元</block>
  <block id="9420010a756fb6d3ddeadfa63d2170f6" category="paragraph">若要執行、 MySQL 伺服器需要檔案描述元、而且預設值不足。</block>
  <block id="62414a5a9c0e2fc12a8d028ad29164b8" category="summary">MySQL 和 InnoDB_IO_capACure</block>
  <block id="6219c45bc8c26437c0b7e1a69d4cbe58" category="summary">MySQL 和 InnoDB_Flush 方法</block>
  <block id="35d1a5d7b12999ec27f5233dccba043f" category="summary">MySQL 和 open_file_limits</block>
  <block id="c031febc35017c70bf3b526723756b2a" category="doc">iSCSI 和 NVMe / TCP</block>
  <block id="4da35d461815e71b97bda03476e89b7b" category="paragraph">使用 iSCSI 或 NVMe / TCP 的主機可以直接連線至儲存系統、並正常運作。原因是路徑。直接連線至兩個不同的儲存控制器、會產生兩個不同的資料流路徑。遺失路徑、連接埠或控制器並不會妨礙其他路徑的使用。</block>
  <block id="40715d81cea527f13cdf470773fc3a65" category="paragraph">可以使用直接連線的 NFS 儲存設備、但有很大的限制：如果沒有大量的指令碼工作、容錯移轉將無法運作、這是客戶的責任。</block>
  <block id="d0b13bfd23c05f64222869de30f81000" category="paragraph">直接連線的 NFS 儲存設備會造成不中斷的容錯移轉複雜化、這是因為本機作業系統上會發生路由。例如、假設主機的 IP 位址為 192.168.1.1/24 、並直接連線至 IP 位址為 192.168.1.50/24 的 ONTAP 控制器。在容錯移轉期間、該位址 192.168.1.50 可以容錯移轉至其他控制器、而且主機可以使用該位址、但主機如何偵測其存在？原來的 192.168.1.1 位址仍然存在於不再連線至作業系統的主機 NIC 上。目的地為 192.168.1.5 的流量將繼續傳送至無法運作的網路連接埠。</block>
  <block id="288a0a5ebbc70fb3b968ec58d36d71ab" category="paragraph">第二個 OS NIC 可設定為 19 可以與故障的 over 192.168.1.50 位址進行通訊、但本機路由表預設會使用一個 * 且只有一個 * 位址來與 192.168.1.0/24 子網路通訊。系統管理員可以建立指令碼架構、以偵測失敗的網路連線、並變更本機路由表或使介面正常運作。具體程序取決於所使用的作業系統。</block>
  <block id="d6ce8522932df7ae76aa0b963ad9ef7d" category="paragraph">實際上、 NetApp 客戶確實有直接連線的 NFS 、但通常僅適用於容錯移轉期間 IO 暫停的工作負載。使用硬掛載時、在這類暫停期間不應有任何 IO 錯誤。IO 應該會暫停運作、直到服務還原為止、無論是透過容錯回復或手動介入、在主機上的 NIC 之間移動 IP 位址。</block>
  <block id="3436a7073ac9f4071820b6720a7789fc" category="section-title">FC Direct Connect</block>
  <block id="b7981516813a09695906aa429b07f48f" category="paragraph">無法使用 FC 傳輸協定將主機直接連接至 ONTAP 儲存系統。原因是使用 NPIV 。用於識別 FC 網路的 ONTAP FC 連接埠的 WWN 使用稱為 NPIV 的虛擬化類型。任何連接至 ONTAP 系統的裝置都必須能夠辨識 NPIV WWN 。目前沒有任何 HBA 廠商提供可安裝在能夠支援 NPIV 目標的主機上的 HBA 。</block>
  <block id="97db606ac6781989ea3b189d7be28bf2" category="inline-link-macro">直接連線網路</block>
  <block id="e817ecc2f82a2b78d828ec8704031da3" category="section-title">直接連線網路</block>
  <block id="d078ae9a339971900f939db9e82f253d" category="paragraph">儲存管理員有時偏好從組態中移除網路交換器、以簡化其基礎架構。在某些情況下可能會支援這項功能。</block>
  <block id="14a07a9c146c886f1cf8b6ebd4b2b418" category="summary">直接與 ONTAP 連線</block>
  <block id="a4e0be5abb980518338c55619fbfa4df" category="doc">與 TCP/IP 和 FC 網路直接連線</block>
  <block id="f437881fa7e42bf0e4563bbec8176f81" category="paragraph">執行ONTAP 支援功能的系統可使用ONTAP 「支援服務品質」功能、限制檔案、LUN、磁碟區或整個SVM等不同儲存物件的每秒處理量（以Mbps和/或I/O（IOPS）為單位）。</block>
  <block id="87e6f97c8ec2f31df616ef84401ffaf4" category="paragraph">有幾種疑難排解資源可提供額外資訊。</block>
  <block id="52d04863ac62a6fa67e1b49a31086928" category="paragraph">以下各節概述 VMware SRM 和 ONTAP 儲存設備的最佳作業實務做法。</block>
  <block id="30b34ee8f62b7bf57684faae3645acc4" category="summary">瞭解 vSphere Metro Storage Cluster with NetApp ONTAP</block>
  <block id="f24ef4a42850a2b3e3d77e610ae46fee" category="doc">計畫性和非計畫性事件的恢復能力</block>
  <block id="4bce11924453ef2ee7e40109f79dc66d" category="paragraph">NetApp MetroCluster 和 SnapMirror 主動同步是強大的工具、可增強 NetApp 硬體和 ONTAP ® 軟體的高可用度和不中斷營運。</block>
  <block id="52f49b6400100ac4558d31582b90ca4e" category="paragraph">這些工具可為整個儲存環境提供全站台保護、確保資料永遠可用。無論您是使用獨立式伺服器、高可用度伺服器叢集、 Docker 容器或虛擬化伺服器、 NetApp 技術都能在電力中斷、冷卻或網路連線中斷、儲存陣列關機或作業錯誤等情況下、無縫維持儲存可用度。</block>
  <block id="d267775072875ddbb24c16a41c22d8a2" category="paragraph">MetroCluster 和 SnapMirror 主動式同步提供三種基本方法、可在發生計畫性或非計畫性事件時維持資料連續性：</block>
  <block id="1d3027d09fc1db3087f05f2163af2cb7" category="list-text">備援元件、可防止單一元件故障</block>
  <block id="f3b83f3b77289efe3b53cf537b7b77f5" category="list-text">本機 HA 接管、用於影響單一控制器的事件</block>
  <block id="b6ed0cba165f6f9664dc1e57ac3419ec" category="list-text">完整的站台保護：將儲存設備和用戶端存取從來源叢集移至目的地叢集、以快速恢復服務</block>
  <block id="16afcbe8821dfa582521cd62c1ec130d" category="paragraph">這表示在單一元件故障時、作業會順暢地繼續、並在更換故障元件時自動恢復至備援作業。</block>
  <block id="8fab78e8b214cad43d962b802bf568f8" category="paragraph">除了單節點叢集（例如 ONTAP Select 等軟體定義版本）之外、所有 ONTAP 叢集都具有稱為接管和恢復的內建 HA 功能。叢集中的每個控制器都會與另一個控制器配對、形成 HA 配對。這些配對可確保每個節點都在本機上連線至儲存設備。</block>
  <block id="83e1749664841043ce8b1e894769a201" category="paragraph">接管是一種自動化程序、其中一個節點會接管另一個節點的儲存設備、以維護資料服務。GiveBack 是還原正常作業的反向程序。可以規劃接管、例如執行硬體維護或 ONTAP 升級、或是因節點緊急或硬體故障而非計畫性地進行。</block>
  <block id="834d83f4ff04b7e3948831f336559b7c" category="paragraph">在接管期間、 MetroCluster 組態中的網路附加儲存邏輯介面（ NAS 生命期）會自動容錯移轉。但是、儲存區域網路生命（ SAN 生命）不會容錯移轉；它們會繼續使用邏輯單元編號（ LUN ）的直接路徑。</block>
  <block id="0b0403a9258293da1f6a5fc84d24a18e" category="inline-link">HA配對管理總覽</block>
  <block id="df5ca9bc3ee60e70aa9fd870a1ce1065" category="paragraph">如需 HA 接管與恢復的詳細資訊、請參閱<block ref="5a72801b431f75b7489a0e7de50680bf" category="inline-link-rx"></block>。值得一提的是、這項功能並非 MetroCluster 或 SnapMirror 主動式同步的專屬功能。</block>
  <block id="cf654073ce9eb8f38d3f05292ed83cc5" category="paragraph">當某個站台離線、或是作為整個站台維護的計畫活動時、就會使用 MetroCluster 進行站台切換。其餘站台則假設擁有離線叢集的儲存資源（磁碟和集合體）、而故障站台上的 SVM 則會在災難站台上線並重新啟動、保留其完整身分以供用戶端和主機存取。</block>
  <block id="4dd2305dcb9d7412784238dd42dcdc21" category="paragraph">有了 SnapMirror 主動式同步、由於兩個複本都是同時使用的、因此您現有的主機將繼續運作。NetApp Mediator 是確保站台容錯移轉正確進行所需的工具。</block>
  <block id="823bd5c6c005e340599d915e134d851c" category="summary">VMware vSphere 解決方案概觀</block>
  <block id="be26d39d86de44047c65c1fed157d529" category="paragraph">vCenter Server Appliance （ VCSA ）是強大的集中式管理系統、也是 vSphere 的單一窗口、可讓管理員有效操作 ESXi 叢集。它有助於執行重要功能、例如 VM 資源配置、 VMotion 作業、高可用度（ HA ）、分散式資源排程器（ DRS ）、 Tanzu Kubernetes Grid 等。它是 VMware 雲端環境中的重要元件、設計時應考慮到服務可用度。</block>
  <block id="8ba8694e23f6560a60d85c4de549122b" category="section-title">vSphere 高可用度</block>
  <block id="4b5543b81af03f01e26fcb74614f7062" category="paragraph">VMware 的叢集技術可將 ESXi 伺服器分組到虛擬機器的共用資源集區中、並提供 vSphere High Availability （ HA ）。vSphere HA 可為在虛擬機器中執行的應用程式提供易於使用的高可用度。當叢集上啟用 HA 功能時、每部 ESXi 伺服器都會與其他主機保持通訊、以便在任何 ESXi 主機無回應或隔離時、 HA 叢集可在叢集中的未運作主機之間、協調在該 ESXi 主機上執行的虛擬機器的還原作業。萬一來賓作業系統發生故障、 vSphere HA 會在同一部實體伺服器上重新啟動受影響的虛擬機器。vSphere HA 可減少計畫性停機、避免非計畫性停機、並快速從停機中恢復。</block>
  <block id="01036edb3159652090a3f7149fe1ce2f" category="paragraph">vSphere HA 叢集可從故障伺服器還原 VM 。</block>
  <block id="15496c3917565cea1f21bbc7e6eba996" category="image-alt">VMSC 圖表</block>
  <block id="c1bb7aa3a002a819d935439c7e347826" category="paragraph">請務必瞭解 VMware vSphere 不知道 NetApp MetroCluster 或 SnapMirror 主動同步、並視主機和 VM 群組關聯性組態而定、將 vSphere 叢集中的所有 ESXi 主機視為 HA 叢集作業的合格主機。</block>
  <block id="dcff37ab37f2cb6a72aeb3c30e3ed5aa" category="section-title">主機故障偵測</block>
  <block id="7069d861b63dd4095cfb7b2ee30587f5" category="paragraph">建立 HA 叢集之後、叢集中的所有主機都會參與選舉、其中一部主機即成為主主機。每個從屬設備都會對主主機執行網路活動訊號、而主設備則會在所有從屬主機上執行網路活動訊號。vSphere HA 叢集的主要主機負責偵測從屬主機的故障。</block>
  <block id="73b629afd8ef39d8d0147696412538c8" category="paragraph">視偵測到的故障類型而定、在主機上執行的虛擬機器可能需要容錯移轉。</block>
  <block id="e12cf4015a45ff29f1f84ae1a3ee0390" category="paragraph">在 vSphere HA 叢集中、偵測到三種類型的主機故障：</block>
  <block id="4eac346eb6cdd3a1a98ee9bc71ebccaa" category="list-text">故障：主機停止運作。</block>
  <block id="3875a4c584a7715edf4a221ce53d45fc" category="list-text">隔離：主機會變成網路隔離。</block>
  <block id="82fba11358d642111efbcf36273159f2" category="list-text">分割區 - 主機失去與主主機的網路連線。</block>
  <block id="5f72ceebd161159fe623ff01ac0cf1b4" category="paragraph">主主機會監控叢集中的從屬主機。這種通訊是透過每秒交換網路訊號來完成。當主主機停止從從屬主機接收這些心跳時、它會在宣告主機故障之前先檢查主機的活動性。主要主機執行的活性檢查是判斷從屬主機是否與其中一個資料存放區交換活動訊號。此外、主主機會檢查主機是否回應傳送至其管理 IP 位址的 ICMP Ping 、以偵測其是否只是與主節點隔離、或完全與網路隔離。它會透過 ping 預設閘道來執行此作業。您可以手動指定一或多個隔離位址、以增強隔離驗證的可靠性。</block>
  <block id="5546466ab10e5cbfbc4b286cd60b8b4a" category="section-title">最佳實務做法 _</block>
  <block id="0456a7ce7bf92fb68980571fdd2defa1" category="paragraph">NetApp 建議指定至少兩個額外的隔離位址、而且每個位址都是站台本機位址。這將提高隔離驗證的可靠性。</block>
  <block id="19c262cd1e1bb07c491e359333f04a29" category="section-title">主機隔離回應</block>
  <block id="7a2723aad08de3c674693adf221e4a48" category="paragraph">隔離回應是 vSphere HA 中的一項設定、可決定當 vSphere HA 叢集中的主機失去管理網路連線但仍繼續執行時、在虛擬機器上觸發的動作。此設定有三個選項：「已停用」、「關機並重新啟動 VM 」和「關機並重新啟動 VM 」。</block>
  <block id="715e310d886b45856c3ab0f69b06241b" category="paragraph">「關機」比「關機」好、因為「關機」無法清除磁碟或認可交易的最新變更。如果虛擬機器在 300 秒內未關機、則會關閉電源。若要變更等待時間、請使用進階選項 das.isolationshutdowntimeout 。</block>
  <block id="620b4ae663a26c98656d1c81bec1a6c2" category="paragraph">在 HA 起始隔離回應之前、會先檢查 vSphere HA 主要代理程式是否擁有包含 VM 組態檔案的資料存放區。如果沒有、則主機不會觸發隔離回應、因為沒有主節點可重新啟動 VM 。主機會定期檢查資料存放區狀態、以判斷是否由擁有主角色的 vSphere HA 代理程式宣告。</block>
  <block id="6824ef1b1c5e58e8ea5ebc8b2cf94be2" category="paragraph">NetApp 建議將「主機隔離回應」設定為「已停用」。</block>
  <block id="6bd7b146f345eefac88b336a89aa3754" category="paragraph">如果主機與 vSphere HA 主主機隔離或分割、而主主機無法透過心跳資料存放區或 ping 進行通訊、就可能發生分割腦部狀況。主機會宣告隔離的主機當機、並在叢集中的其他主機上重新啟動 VM 。現在存在分割腦狀況、因為有兩個執行中的虛擬機器執行個體、只有其中一個執行個體可以讀取或寫入虛擬磁碟。現在可以透過設定 VM 元件保護（ VMCP ）來避免發生大腦分裂的情況。</block>
  <block id="df05a421ed8ba49f97f18dc085495ee4" category="section-title">VM 元件保護（ VMCP ）</block>
  <block id="1418d127ee81cc7f3e114029e9ba6856" category="paragraph">與 HA 相關的 vSphere 6 功能增強功能之一是 VMCP 。VMCP 針對區塊（ FC 、 iSCSI 、 FCoE ）和檔案儲存（ NFS ）、提供增強的保護、防止所有路徑中斷（ APD ）和永久裝置遺失（ PDL ）情況。</block>
  <block id="fc35e15d00ef5b037a1a56c77ef3e17c" category="section-title">永久裝置遺失（ PDL ）</block>
  <block id="967b20f28092443585be2b9649d0ba93" category="paragraph">當儲存設備永久故障或被管理性移除、且不預期返回時、會發生 PDL 狀況。NetApp 儲存陣列會向 ESXi 發出 SCSI Sense 程式碼、聲明該裝置已永久遺失。在 vSphere HA 的「故障條件和 VM 回應」區段中、您可以設定在偵測到 PDL 條件後應回應的內容。</block>
  <block id="7cf4fdbfc8e1deb9f567848f2df19e91" category="paragraph">NetApp 建議將「使用 PDL 的資料存放區回應」設定為「 * 關閉並重新啟動 VM* 」。偵測到這種情況時、將會在 vSphere HA 叢集中的健全主機上立即重新啟動 VM 。</block>
  <block id="6d623de2ea8c5007def6f2349d9ad8b9" category="section-title">所有下行路徑（ APD ）</block>
  <block id="15d2d9b1f25022e7080482582e155265" category="paragraph">當主機無法存取儲存裝置、且沒有通往陣列的路徑可用時、便會發生 APD 狀況。ESXi 認為這是裝置的暫時性問題、因此預期裝置會再次出現。</block>
  <block id="f89caca297ba86d190d90ef30c409ccf" category="paragraph">偵測到 APD 狀況時、會啟動定時器。140 秒後、 APD 條件會正式宣告、且裝置會標示為 APD 逾時。140 秒過後、 HA 會開始計算 VM 容錯移轉 APD 延遲中指定的分鐘數。指定時間過後、 HA 會重新啟動受影響的虛擬機器。您可以設定 VMCP 在需要時以不同的方式回應（停用、問題事件、或關機和重新啟動 VM ）。</block>
  <block id="8f179a61d789dab9b994ecd0ca8c53cb" category="paragraph">NetApp 建議將「使用 APD 的資料存放區回應」設定為「 * 關閉並重新啟動 VM （保守） * 」。</block>
  <block id="76d29c3c5f57a16a7f080459356c3793" category="paragraph">保守是指 HA 能夠重新啟動 VM 的可能性。如果設為保守、 HA 只會重新啟動受 APD 影響的 VM 、前提是它知道其他主機可以重新啟動。在積極的情況下、 HA 會嘗試重新啟動 VM 、即使它不知道其他主機的狀態。如果沒有可存取其所在資料存放區的主機、這可能導致 VM 無法重新啟動。</block>
  <block id="c64ef72a18526e28efe7c08b3ff3889a" category="paragraph">如果 APD 狀態已解決、且在逾時之前已還原對儲存設備的存取、則 HA 不會不必要地重新啟動虛擬機器、除非您明確將其設定為如此。如果即使環境已從 APD 條件恢復、仍需要回應、則 APD 逾時後的 APD 恢復回應應設定為重設虛擬機器。</block>
  <block id="580bc3953adcf3e3a20c5497f67f8b2c" category="paragraph">NetApp 建議將 APD 逾時後的 APD 恢復回應設定為停用。</block>
  <block id="a067a9a0e98c97f62fba4698bde30edc" category="section-title">適用於 NetApp MetroCluster 的 VMware DRS 實作</block>
  <block id="3bf3e67966e8b0e07b0812dae7b86ce7" category="paragraph">VMware DRS 是一項功能、可將叢集中的主機資源集合在一起、主要用於在虛擬基礎架構中的叢集內進行負載平衡。VMware DRS 主要會計算 CPU 和記憶體資源、以便在叢集中執行負載平衡。由於 vSphere 不知道延伸叢集、因此在負載平衡時會考慮兩個站台中的所有主機。為了避免跨站台流量、 NetApp 建議您設定 DRS 關聯性規則、以管理虛擬機器的邏輯分隔。這可確保除非發生完整的站台故障、否則 HA 和 DRS 只會使用本機主機。</block>
  <block id="b9e04f46a88c8139fbb91780a2ff9064" category="paragraph">如果您為叢集建立 DRS 關聯性規則、您可以指定 vSphere 如何在虛擬機器容錯移轉期間套用該規則。</block>
  <block id="f903d43a0acb7412db93e8201ab12be3" category="paragraph">您可以指定 vSphere HA 容錯移轉行為的規則有兩種類型：</block>
  <block id="a96c8bab3a450bb828e3093d16f7e32c" category="list-text">VM 反關聯性規則會強制指定的虛擬機器在容錯移轉動作期間保持分離。</block>
  <block id="1fa3a04279011cbc6001c96c0f6f27fb" category="list-text">VM 主機關聯性規則會在容錯移轉動作期間、將指定的虛擬機器放置在特定主機或已定義主機群組的成員上。</block>
  <block id="225e3f7204b6e5bf6cd388af7bb16eb4" category="paragraph">使用 VMware DRS 中的 VM 主機關聯性規則、可以在站台 A 和站台 B 之間有邏輯分隔、以便 VM 在主機上執行、而該主機與陣列是設定為指定資料存放區的主要讀取 / 寫入控制器。此外、 VM 主機關聯性規則可讓虛擬機器保持儲存設備的本機狀態、進而在站台之間發生網路故障時確定虛擬機器連線。</block>
  <block id="db03e2255e35df6fa9719c800850c397" category="paragraph">以下是 VM 主機群組和關聯規則的範例。</block>
  <block id="6c9bd967c46984c9e5e0d8a6e5ec81a0" category="image-alt">自動產生的電腦伺服器說明圖表</block>
  <block id="d400b2cf908bc5f979847146ff8ac816" category="paragraph">NetApp 建議實作「應該」規則、而非「必須」規則、因為在發生故障時、 vSphere HA 會違反這些規則。使用「必須」規則可能導致服務中斷。</block>
  <block id="e9503bc9ad84f6517ddc938c85541dd5" category="paragraph">服務的可用度應永遠高於效能。在完整資料中心故障的情況下、「必須」規則必須從 VM 主機關聯群組中選擇主機、而當資料中心無法使用時、虛擬機器將不會重新啟動。</block>
  <block id="b3c45603f3738ac1e1f8e1e87569c00c" category="section-title">使用 NetApp MetroCluster 實作 VMware Storage DRS</block>
  <block id="b273633ed947791e90b7b83ad1bb2021" category="paragraph">VMware Storage DRS 功能可將資料存放區集合至單一單元、並在超過儲存 I/O 控制臨界值時平衡虛擬機器磁碟。</block>
  <block id="4669dbcf4d42583b3fae1c79fa228078" category="paragraph">依預設、啟用 Storage DRS 的 DRS 叢集會啟用儲存 I/O 控制。儲存 I/O 控制功能可讓管理員控制 I/O 壅塞期間分配給虛擬機器的儲存 I/O 數量、讓更重要的虛擬機器能夠優先選擇較不重要的虛擬機器來分配 I/O 資源。</block>
  <block id="f06483bf36a941eebbb2f78a89b6bf68" category="paragraph">Storage DRS 使用 Storage VMotion 將虛擬機器移轉至資料存放區叢集中的不同資料存放區。在 NetApp MetroCluster 環境中、必須在該站台的資料存放區內控制虛擬機器移轉。例如、在站台 A 的主機上執行的虛擬機器 A 、最好能在站台 A 的 SVM 資料存放區內移轉如果無法這麼做、虛擬機器將繼續運作、但效能降低、因為虛擬磁碟讀取 / 寫入將透過站台間連結來自站台 B 。</block>
  <block id="e607d8c3dc392e521065e5494d8c85c6" category="paragraph">NetApp 建議針對儲存站台親和性建立資料存放區叢集、也就是說、站台 A 的站台親和性資料存放區不應與站台 B 具有站台親和性的資料存放區叢集混合使用</block>
  <block id="63fe88e257ae2d072b6920d6dbcf0818" category="paragraph">每當使用 Storage VMotion 新佈建或移轉虛擬機器時、 NetApp 建議手動更新這些虛擬機器的所有 VMware DRS 規則。這將確定主機和資料存放區在站台層級的虛擬機器關聯性、進而降低網路和儲存負荷。</block>
  <block id="b6cd969550b5501b0f62a149fb7964ce" category="paragraph">支援vSphere中的VMware vSphere資料存放區、以及VMware vSphere 9.8版的VMware vCenter工具。ONTAP FlexGroup ONTAP</block>
  <block id="4adcd8d9323839ff088dc4f8f0bdcce2" category="paragraph">建立 VM 的 vVols 儲存設備有幾個步驟。</block>
  <block id="2438f6a80b933cf058ad052d26ac0703" category="paragraph">複製儲存物件可讓您快速建立複本以供進一步使用、例如配置額外的VM、備份/還原作業等。</block>
  <block id="1a795345e422d7dbcca8fe38671a9371" category="summary">VMSC 設計與實作準則。</block>
  <block id="b73deaadc37ea1c7a13ad17af6730c42" category="doc">VMSC 設計與實作準則</block>
  <block id="3512760e2d3fc1a9dd2116e83bb0cada" category="paragraph">本文件概述 VMSC 搭配 ONTAP 儲存系統的設計與實作準則。</block>
  <block id="556669df5b5073ab3d2ddcf638e942d9" category="section-title">NetApp 儲存組態</block>
  <block id="7f4d4fbe08a8a895671d05c4a82b0c85" category="inline-link">資訊文件MetroCluster</block>
  <block id="002eb41870df47521a2b59424d251f60" category="inline-link">SnapMirror營運不中斷總覽</block>
  <block id="008c17a2bb74d3d9706c0f2c88499240" category="paragraph">NetApp MetroCluster 的設定指示（稱為 MCC 組態）可在以下網址取得：<block ref="2c736bccede87dae47dcf61108f083c4" category="inline-link-rx"></block>。SnapMirror 主動同步的說明也可在以下網址取得：<block ref="14203840309dd1b6e13f73373477bb9d" category="inline-link-rx"></block>。</block>
  <block id="447566f62201eb825a1f6fb7a570873f" category="paragraph">設定 MetroCluster 之後、管理就像管理傳統的 ONTAP 環境一樣。您可以使用命令列介面（ CLI ）、系統管理員或 Ansible 等各種工具來設定儲存虛擬機器（ SVM ）。設定 SVM 後、在叢集上建立邏輯介面（生命體）、磁碟區和邏輯單元編號（ LUN ）、以用於正常作業。這些物件將會使用叢集對等網路自動複寫到其他叢集。</block>
  <block id="b5486be95ed9ae2e4681a39cf8fe8041" category="inline-link">一致性群組總覽</block>
  <block id="5440d8600dfca322be65444d14c4566f" category="paragraph">如果不使用 MetroCluster 、您可以使用 SnapMirror 主動式同步功能、在不同故障網域中的多個 ONTAP 叢集之間提供資料存放區精細保護和主動式存取。SnapMirror 主動式同步會使用一致性群組、確保一或多個資料存放區之間的寫入順序一致性、您可以根據應用程式和資料存放區需求、建立多個一致性群組。一致性群組對於需要在多個資料存放區之間進行資料同步的應用程式特別有用。SnapMirror 主動式同步也支援原始裝置對應（ RDM ）和來賓 iSCSI 啟動器的來賓連線儲存設備。如需更多關於一致性群組的資訊、請參閱<block ref="8bba9b5b97dba092834d7a48a07f102d" category="inline-link-rx"></block>。</block>
  <block id="f9ac6f5e1bf01f1df914b714d5e6cb02" category="paragraph">與 MetroCluster 相比、使用 SnapMirror 主動式同步管理 VMSC 組態有一些差異。首先、這是僅限 SAN 的組態、沒有 NFS 資料存放區可以使用 SnapMirror 主動式同步進行保護。其次、您必須將兩個 LUN 複本對應到 ESXi 主機、以便它們存取兩個故障網域中的複寫資料存放區。</block>
  <block id="c972b11c861e42787c05a2ee24828e3a" category="section-title">VMware vSphere HA</block>
  <block id="57166da54d8751e1ed084f00b3f169e3" category="section-title">建立 vSphere HA 叢集</block>
  <block id="829006223e7bdcfd478d2261f1d5ac40" category="inline-link">如何在 docs.vmware.com 上的 vSphere Client 中建立和設定叢集</block>
  <block id="2bbae4763835d2e2dd123c1b4b0ae73d" category="paragraph">建立 vSphere HA 叢集是一個多步驟程序、完整記錄於<block ref="dd51ccd863dd3c9fbca770681f8e68a9" category="inline-link-rx"></block>。簡言之、您必須先建立空叢集、然後使用 vCenter 新增主機、並指定叢集的 vSphere HA 和其他設定。</block>
  <block id="d50e63b9f70efedde8dc093be8ec12b2" category="inline-link">VMware vSphere Metro儲存叢集建議實務做法</block>
  <block id="33d532b774d7b67104f4749e25ba03ef" category="paragraph">* 附註： * 本文件並無取代之處<block ref="3a8301f60ad04eb873ae8dea15ee0495" category="inline-link-rx"></block></block>
  <block id="950954623b197b80e3ebb95b0adcc3de" category="paragraph">若要設定 HA 叢集、請完成下列步驟：</block>
  <block id="1073102bd8c6cbd17340f2a19043583f" category="list-text">連線至 vCenter UI 。</block>
  <block id="ebf69ea3a3e34739bde13d589e85ef10" category="list-text">在主機和叢集中、瀏覽至您要建立 HA 叢集的資料中心。</block>
  <block id="d8fd85bbc0cd4746e5d80e291696b86c" category="list-text">以滑鼠右鍵按一下資料中心物件、然後選取新叢集。在基礎知識之下、確保您已啟用 vSphere DRS 和 vSphere HA 。完成精靈。</block>
  <block id="f2c634ca704e26f96be1723db6dda32a" category="image-alt">自動產生電腦說明的螢幕擷取畫面</block>
  <block id="f4f59bf1e324854573172ca2b5070d45" category="list-text">選取叢集、然後移至「組態」標籤。選取 vSphere HA 、然後按一下編輯。</block>
  <block id="329c69e52a7de6215aa4dbfa19940f2d" category="list-text">在 [ 主機監控 ] 下，選取 [ 啟用主機監控 ] 選項。</block>
  <block id="9fc231ac455a53f2fabc59f29ab537ad" category="list-text">在「故障與回應」標籤上、於「 VM 監控」下、選取「僅限 VM 監控」選項或「 VM 與應用程式監控」選項。</block>
  <block id="58aea8c81a7e8b8160584574af309fbb" category="list-text">在 [ 許可控制 ] 下，將 HA 接入控制選項設定為叢集資源保留；使用 50% 的 CPU/ MEM 。</block>
  <block id="d94a9f01bee7dcc2643864bf92ab4e59" category="list-text">按一下「確定」。</block>
  <block id="3f059eee365aa5c64c0be1d6dba81d69" category="list-text">選取 DRS 、然後按一下編輯。</block>
  <block id="7b5f9be03fd1421a9da56c2c7677ad69" category="list-text">除非應用程式要求、否則請將自動化層級設為手動。</block>
  <block id="a8ee10582e28e3623629963a88ff5ec9" category="image-alt">VMSC 3 5.</block>
  <block id="256164bb48582e5267e408f2e67e1939" category="inline-link">docs.vmware.com</block>
  <block id="91fb89f03b846483f7108d3f1bfb0156" category="list-text">啟用 VM 元件保護、請參閱<block ref="fc88c93ad20ad804a211f4e6fea63e56" category="inline-link-rx"></block>。</block>
  <block id="918c2d8e02dbd2c1f4cc3a0062690387" category="list-text">建議使用 MCC 的 VMSC 使用下列其他 vSphere HA 設定：</block>
  <block id="d64ed3e9c10229648e069f56e32f4c8e" category="cell">回應</block>
  <block id="f3c1d0e4118d5d9501e1a7aeed19d224" category="cell">主機故障</block>
  <block id="45d583cd5692c76d45e96536edce2a0e" category="cell">重新啟動 VM</block>
  <block id="1c3a7ae924920b573baede481becd22f" category="cell">主機隔離</block>
  <block id="2e011e74abc75a2823c627b7ee9e22a7" category="cell">永久裝置遺失（ PDL ）的資料存放區</block>
  <block id="49476a1ad365d5f8deb36464de7fe33b" category="cell">關閉並重新啟動 VM</block>
  <block id="e7bbd35db169028c75e7c8ae655bf6ae" category="cell">All Paths Down （ APD ）資料存放區</block>
  <block id="e7480b00a5e3efd904a08ca88804de45" category="cell">客人不會心碎</block>
  <block id="e8896c595f3effde37ef29d7c6233703" category="cell">重設 VM</block>
  <block id="59695df3d45a3a21b8ff0bf57fda6a2b" category="cell">VM 重新啟動原則</block>
  <block id="a150f56b87fd99bf9bf019f8447ba68b" category="cell">由虛擬機器的重要性決定</block>
  <block id="370a480458a8c63a838940f1241e14ee" category="cell">主機隔離的回應</block>
  <block id="11f30f9be08cd4f9e500290222ddc552" category="cell">關閉並重新啟動 VM</block>
  <block id="fb53fafa45c0de9bd41d368c7455c9f1" category="cell">使用 PDL 的資料存放區回應</block>
  <block id="d7c3b9f5568eb60f08076b29490afcaf" category="cell">對具有 APD 的資料存放區的回應</block>
  <block id="423b2d98eae113ae3391aa0b12f11935" category="cell">關閉並重新啟動 VM （保守）</block>
  <block id="132bbe6dbceb01227dba5ab04db7202b" category="cell">APD 的 VM 容錯移轉延遲</block>
  <block id="8d15ed7d27d83ed6229a66b1f44b7696" category="cell">3 分鐘</block>
  <block id="8c7b0644547f0ee3fe537e8ba441566d" category="cell">APD 逾時的 APD 恢復回應</block>
  <block id="4dea08318b2824f845e9b889a6e17778" category="cell">VM 監控靈敏度</block>
  <block id="f535a28adc173e28610c129d0dc578ae" category="cell">預設為高</block>
  <block id="83164803a765d1ea1f10d50dfdd26130" category="section-title">設定資料存放區以進行心跳</block>
  <block id="22c81b09ec3086b2dce8f68867a221e0" category="paragraph">當管理網路故障時、 vSphere HA 會使用資料存放區來監控主機和虛擬機器。您可以設定 vCenter 如何選取心跳資料存放區。若要設定資料存放區以進行心跳、請完成下列步驟：</block>
  <block id="64809e5386c9dc53f894f772f27d1b44" category="list-text">在資料存放區心跳區段中、從指定清單中選取使用資料存放區、並在需要時自動補充資料。</block>
  <block id="fc66ba7317ceb4220dc88aa267db085d" category="list-text">選取您要 vCenter 從兩個站台使用的資料存放區、然後按下 OK 。</block>
  <block id="1d2b14769d080b9214d9e407dfc92a64" category="section-title">設定進階選項</block>
  <block id="a22b9827e1a78c5fb9c939a78c116a05" category="paragraph">* 主機故障偵測 *</block>
  <block id="a9316d69e5abcfaffc56fc8f5e645412" category="paragraph">當 HA 叢集內的主機無法連線至網路或叢集中的其他主機時、就會發生隔離事件。根據預設、 vSphere HA 會使用其管理網路的預設閘道做為預設隔離位址。不過、您可以為主機指定其他隔離位址來執行 ping 、以判斷是否應該觸發隔離回應。新增兩個可 ping 的隔離 IP 、每個站台一個。請勿使用閘道 IP 。使用的 vSphere HA 進階設定為 das.isolationaddress 。您可以將 ONTAP 或 Mediator IP 位址用於此用途。</block>
  <block id="102d7879ceca393c309ef492c958e19d" category="inline-link">core.vmware.com</block>
  <block id="27e2292ff6db48ed2e6d50b256eae43e" category="paragraph">請參閱<block ref="43057df4f3a6b5f2fffe8b7c5a490646" category="inline-link-rx"></block> 以取得更多資訊</block>
  <block id="3f44bb4a3b9420d495e400b9afbda2c7" category="paragraph">新增稱為 das.心跳 DsPerHost 的進階設定、可能會增加心跳資料存放區的數量。使用四個心跳資料存放區（ HB DSS ）、每個站台兩個。使用「從清單中選取但輔助」選項。這是必要的、因為如果某個站台發生故障、您仍需要兩個 HB DSS 。但是、這些不需要透過 MCC 或 SnapMirror 主動同步來保護。</block>
  <block id="eaa1dfe3982e06655ce64e240c139b81" category="paragraph">適用於 NetApp MetroCluster 的 VMware DRS 關聯性</block>
  <block id="e32221c52eb3b0bbeb3ca79aad6c90f6" category="paragraph">在本節中、我們會為 MetroCluster 環境中的每個站台 \ 叢集、建立 VM 和主機的 DRS 群組。然後我們設定 VM\Host 規則、使 VM 主機與本機儲存資源的關聯性一致。例如、站台 A VM 屬於 VM 群組 sitea_vms 、站台 A 主機屬於主機群組 sitea_hosts 。接下來、在 VM\Host 規則中、我們指出 sitea_vms 應該在 sitea_hosts 中的主機上執行。</block>
  <block id="5bfa0d712f66aef47f8a2ea582bc0b72" category="list-text">NetApp 強烈建議在組 * 中的主機上運行規範 * ，而不是規範 * 必須在組 * 中的主機上運行。萬一站台 A 主機故障、站台 A 的 VM 需要透過 vSphere HA 在站台 B 的主機上重新啟動、但後者的規格不允許 HA 在站台 B 上重新啟動 VM 、因為這是硬規則。以前的規格是軟性規則、在 HA 發生時會違反、因此可提供可用度而非效能。</block>
  <block id="cc6a363013bd2a8c1e05304f1c6abd79" category="inline-link">vSphere 監控與效能</block>
  <block id="db9540392e62211ad47ebec39232329e" category="paragraph">* 附註： * 您可以建立事件型警示、在虛擬機器違反 VM-Host 關聯性規則時觸發。在 vSphere Client 中、新增虛擬機器的警示、並選取「 VM 正在違反 VM-Host Affinity Rule 」作為事件觸發程序。如需建立及編輯警示的詳細資訊、請參閱<block ref="d28eed239632aed40803fe0ed2311ba6" category="inline-link-rx"></block> 文件。</block>
  <block id="124de7d2bc72d75be9e481c1cc56ada2" category="section-title">建立 DRS 主機群組</block>
  <block id="0759e9476d3bf1868f88356025adafb2" category="paragraph">若要建立站台 A 和站台 B 專屬的 DRS 主機群組、請完成下列步驟：</block>
  <block id="a69dff3dd4b284f60243dfd62fa4e57f" category="list-text">在 vSphere Web Client 中、以滑鼠右鍵按一下資源清冊中的叢集、然後選取「設定」。</block>
  <block id="a130b4af254ead99e9ea83044e54ea1d" category="list-text">按一下 VM\Host Groups 。</block>
  <block id="1bb250fbf1946dd1bd7ad228032f8803" category="list-text">按一下「新增」</block>
  <block id="62c4d1538f957af2951f2c93ee191d0b" category="list-text">輸入群組的名稱（例如、 sitea_hosts ）。</block>
  <block id="df22605898fc890edbcb2a126aa202ce" category="list-text">從「類型」功能表中、選取「主機群組」。</block>
  <block id="57c0028584902f6cee210dcc13bc9745" category="list-text">按一下「新增」、然後從站台 A 選取所需的主機、再按一下「確定」。</block>
  <block id="583e6d8c3b1006b0561d4b360e58994f" category="list-text">重複這些步驟、為站台 B 新增另一個主機群組</block>
  <block id="18d0ad44a1e563aaf9f5871e32535a6c" category="list-text">按一下「確定」。</block>
  <block id="154964ee7fc6d3261ec55811b0ff9972" category="section-title">建立 DRS VM 群組</block>
  <block id="40c1eaba5f178f243c57b595b6af4d5e" category="paragraph">若要建立站台 A 和站台 B 專屬的 DRS VM 群組、請完成下列步驟：</block>
  <block id="9a209a741c26968fc13ed8192523df15" category="list-text">輸入群組的名稱（例如、 sitea_vms ）。</block>
  <block id="f947c7c9f173289b1c2565b3297095f0" category="list-text">從 Type （類型）功能表中、選取 VM Group （ VM 群組）。</block>
  <block id="40a2a21a084c8d16395113cb79a19ebb" category="list-text">按一下「新增」、然後從站台 A 選取所需的 VM 、再按一下「確定」。</block>
  <block id="e2e7af699096077fe178ebf021fb2273" category="section-title">建立 VM Host 規則</block>
  <block id="0a6075f3d3fdbe7c133268face0f5c82" category="paragraph">若要建立站台 A 和站台 B 特有的 DRS 關聯性規則、請完成下列步驟：</block>
  <block id="df4f9bcca0ceb7a67ba25d886a18743b" category="list-text">按一下 VM\Host Rules 。</block>
  <block id="876a25c102b5c301814921d1a9c0e625" category="list-text">輸入規則的名稱（例如、 sitea_fit射 ）。</block>
  <block id="d4b5f57f4e2bd5c357ad9b1fbdc2cf8e" category="list-text">確認已核取「啟用規則」選項。</block>
  <block id="d1169f525bd934df7f1a7e3bcf401997" category="list-text">從 Type （類型）功能表中、選取 Virtual Machines to Hosts （虛擬機器至主機）。</block>
  <block id="77328c16c697ce1d6c036c3f950e7542" category="list-text">選取 VM 群組（例如、 sitea_vms ）。</block>
  <block id="b36943ce975d4c5c6e9481a4ca396270" category="list-text">選取主機群組（例如、 sitea_hosts ）。</block>
  <block id="32fbcb32cfae9a0656233943c28f7c94" category="list-text">重複這些步驟、為站台 B 新增另一個 VM\ 主機規則</block>
  <block id="ff0ded925b170243e5154c9a687bb925" category="section-title">VMware vSphere Storage DRS for NetApp MetroCluster</block>
  <block id="b0cb5ad168b84040eff8132c70e41fdb" category="section-title">建立資料存放區叢集</block>
  <block id="488f70e76f3c9ddf155b693e31c5a1e1" category="paragraph">若要為每個站台設定資料存放區叢集、請完成下列步驟：</block>
  <block id="1dfbc2b980c0b56a5d9889c6d9a25460" category="list-text">使用 vSphere Web 用戶端、瀏覽至 HA 叢集位於 Storage 下的資料中心。</block>
  <block id="dfc332b252ad3de167b6a336d7e70d46" category="list-text">以滑鼠右鍵按一下資料中心物件、然後選取儲存 &gt; 新資料存放區叢集。</block>
  <block id="7ce7f4ad7022187801efdf33d1fab92d" category="list-text">選取「開啟 Storage DRS 」選項、然後按一下「下一步」。</block>
  <block id="6196801f8f77bab7132531adbb268512" category="list-text">將所有選項設定為「無自動化（手動模式）」、然後按一下「下一步」。</block>
  <block id="cfcdd0a8a765af314fb460ad445fb375" category="list-text">NetApp 建議您將儲存 DRS 設定為手動模式、以便系統管理員決定並控制何時需要移轉。</block>
  <block id="dfffe1ce0daeb61f9fbc153ae4945fd4" category="image-alt">自動產生文字說明的特寫</block>
  <block id="51a3bc726f294f3376fcaa12ccdf8b3b" category="list-text">確認已核取「啟用 SDR 建議的 I/O 度量」核取方塊；度量設定可以保留預設值。</block>
  <block id="829b62dbd6a4923b66591b2bff38ed5b" category="list-text">選取 HA 叢集、然後按一下「下一步」。</block>
  <block id="30fe6cfa0a4c5fb23fccfe149cefc006" category="list-text">選取屬於站台 A 的資料存放區、然後按一下「下一步」。</block>
  <block id="4ea461b22638db4c94aa076d62a2065f" category="list-text">檢閱選項、然後按一下「完成」。</block>
  <block id="7b79e97caff76847cf350f1197c49953" category="list-text">重複這些步驟以建立站台 B 資料存放區叢集、並確認只選取站台 B 的資料存放區。</block>
  <block id="d8f83b09bd6b864f22076c109cfaae66" category="section-title">vCenter Server 可用度</block>
  <block id="605b8c1efcf2de9164e5d5425c67bdcd" category="paragraph">您的 vCenter Server 應用裝置（ VCSA ）應使用 vCenter HA 加以保護。vCenter HA 可讓您在主動式被動式 HA 配對中部署兩個 VCSA 。每個故障網域各有一個。您可以在上閱讀更多有關 vCenter HA 的資訊<block ref="173ca8434bdf39dd0a60efe576d066cd" category="inline-link-rx"></block>。</block>
  <block id="2b6203f34def274ff7424bf1d64a9bca" category="paragraph">使用vSphere搭配執行ONTAP VMware軟體的系統時、設定網路設定很簡單、而且類似於其他網路組態。</block>
  <block id="70901a02a148fd2dfc1ff5736f4f5336" category="list-text">將儲存網路流量與其他網路區隔。使用專屬的VLAN或獨立的交換器來儲存、即可建立獨立的網路。如果儲存網路共用實體路徑（例如上行鏈路）、您可能需要QoS或額外的上行鏈路連接埠、以確保有足夠的頻寬。請勿將主機直接連線至儲存設備；請使用交換器來建立備援路徑、並讓 VMware HA 在不需介入的情況下運作。請參閱 <block ref="2d54da766c3f840b00eab5923273fca5" category="inline-link-macro-rx"></block> 以取得更多資訊。</block>
  <block id="ed895c1c16c46a33c1fb8d980afb4d4b" category="list-text">目前支援的所有 VMware vSphere 版本均可使用 NFS v3 和 v4.1 。正式支援 nconnect 已新增至 vSphere 8.0 更新 2 for NFS v3 。對於 NFS v4.1 、 vSphere 持續支援工作階段主幹、 Kerberos 驗證及完整性 Kerberos 驗證。請務必注意、工作階段主幹需要 ONTAP 9.14.1 或更新版本。</block>
  <block id="83d007e105712dc05dcf363c7151dba1" category="paragraph">值得注意的是、 NFSv3 和 NFSv4.1 使用不同的鎖定機制。NFSv3 使用用戶端端鎖定、而 NFSv4.1 則使用伺服器端鎖定。雖然 ONTAP 磁碟區可以透過兩種傳輸協定匯出、但 ESXi 只能透過一種傳輸協定掛載資料存放區。不過、這並不表示其他 ESXi 主機無法透過不同版本掛載相同的資料存放區。為了避免任何問題、請務必指定要在掛載時使用的通訊協定版本、確保所有主機都使用相同版本、因此使用相同的鎖定樣式。避免在主機之間混合使用 NFS 版本是非常重要的。如有可能、請使用主機設定檔來檢查法規遵循狀況。
** 由於 NFSv3 和 NFSv4.1 之間沒有自動資料存放區轉換、因此請建立新的 NFSv4.1 資料存放區、並使用 Storage VMotion 將 VM 移轉至新的資料存放區。
** 請參閱中的 NFS v4.1 互通性表附註<block ref="8813559f5b95abb5411182be29200aff" category="inline-link-rx"></block> 支援所需的特定ESXi修補程式層級。
* NFS 匯出原則用於控制 vSphere 主機的存取。您可以將一個原則與多個磁碟區（資料存放區）搭配使用。使用NFSv3時、ESXi會使用sys（UNIX）安全樣式、並需要root掛載選項來執行VM。在現階段、此選項稱為超級使用者、使用超級使用者選項時、不需要指定匿名使用者ID。ONTAP請注意、匯出具有不同值的原則規則<block ref="ea72d12ecaa06afdb0c8a3b15e485e95" prefix=" " category="inline-code"></block> 和<block ref="df809a941c1287d18c08bb5927b639dc" prefix=" " category="inline-code"></block> 可能會導致SVM發現ONTAP 問題、因為使用這些功能。以下是範例原則：
** 存取傳輸協定： nfs3.
** 用戶端比對規格： 192.168.42.21
** RO 存取規則：系統
** RW 存取規則：系統
** 匿名 UID
** 超級用戶： sys
* 如果使用 NetApp NFS 外掛程式 for VMware VAAI 、則通訊協定應設為<block ref="2521ef5d58fc027d3121662b7d8f9ac2" prefix=" " category="inline-code"></block> 匯出原則規則建立或修改時。需要 NFSv4 傳輸協定、 VAAI 複本卸載才能運作、並將傳輸協定指定為<block ref="2521ef5d58fc027d3121662b7d8f9ac2" prefix=" " category="inline-code"></block> 自動同時包含 NFSv3 和 NFSv4 版本。
* NFS 資料存放區磁碟區是從 SVM 的根磁碟區連接而成、因此 ESXi 也必須擁有根磁碟區的存取權、才能瀏覽及裝載資料存放區磁碟區。根 Volume 和資料存放區磁碟區交會嵌套的任何其他磁碟區的匯出原則、都必須包含 ESXi 伺服器授予其唯讀存取權的規則或規則。以下是根 Volume 的範例原則、也使用 VAAI 外掛程式：
** 存取傳輸協定： NFS （包括 nfs3 和 nfs4 ）
** 用戶端比對規格： 192.168.42.21
** RO 存取規則：系統
** RW 存取規則：永不（ root Volume 的最佳安全性）
** 匿名 UID
** 超級用戶： sys （ VAAI 的 root Volume 也需要）
* 使用適用於 VMware vSphere 的 ONTAP 工具（最重要的最佳實務做法）：
** 使用適用於 VMware vSphere 的 ONTAP 工具來配置資料存放區、因為它能自動簡化匯出原則的管理。
** 使用外掛程式為 VMware 叢集建立資料存放區時、請選取叢集、而非單一 ESX 伺服器。此選項會觸發IT自動將資料存放區掛載至叢集中的所有主機。
** 使用外掛裝載功能將現有的資料存放區套用至新伺服器。
** 如果不使用 ONTAP 工具來執行 VMware vSphere 、請針對所有伺服器或需要額外存取控制的每個伺服器叢集、使用單一匯出原則。
* 雖然 ONTAP 提供彈性的 Volume 命名空間結構、可利用交叉路口在樹狀結構中排列磁碟區、但這種方法對 vSphere 沒有價值。無論儲存設備的命名空間階層為何、它都會在資料存放區根目錄中為每個VM建立一個目錄。因此、最佳實務做法是將vSphere磁碟區的交會路徑掛載到SVM的根磁碟區、這就是ONTAP VMware vSphere的VMware vSphere功能如何配置資料存放區。沒有巢狀結點路徑也表示除了根磁碟區之外、沒有任何磁碟區相依於任何磁碟區、即使是刻意將磁碟區離線或銷毀、也不會影響其他磁碟區的路徑。
* 對於 NFS 資料存放區上的 NTFS 分割區、 4K 區塊大小是很好的。下圖說明從vSphere主機連線至ONTAP VMware NFS資料存放區的能力。</block>
  <block id="59cfc5aaa0678bcb883492b4397c71b8" category="cell">有（ ONTAP 9.14.1 ）</block>
  <block id="f37fed71aa90eb80f77d4f14b0ee295b" category="summary">vSphere Metro Storage 叢集搭配 NetApp ONTAP</block>
  <block id="a58c81d13cac4e9b37bba2bd7fc3a93d" category="paragraph">VMware 領先業界的 vSphere Hypervisor 可部署為稱為 vSphere Metro Storage Cluster （ VMSC ）的延伸叢集。</block>
  <block id="e5239709587bb3ebb34629be6c41ac7b" category="paragraph">NetApp ® MetroCluster ™和 SnapMirror 主動同步（以前稱爲 SnapMirror 業務連續性或 SMBC ）均支持 VMSC 解決方案，如果一個或多個故障域發生整體中斷，則可提供高級業務連續性。不同故障模式的恢復能力取決於您選擇的組態選項。</block>
  <block id="e3224e391e08365c1593c07b9fe99cfa" category="section-title">適用於 vSphere 環境的持續可用度解決方案</block>
  <block id="e724bf1a385b292b55017a9963682b40" category="paragraph">NetApp ONTAP 架構是靈活且可擴充的儲存平台、可為資料存放區提供 SAN （ FCP 、 iSCSI 和 NVMe of ）和 NAS （ NFS v3 和 v4.1 ）服務。NetApp AFF 、 ASA 和 FAS 儲存系統使用 ONTAP 作業系統來提供額外的通訊協定、以供 S3 和 SMB/CIFS 等來賓儲存設備存取。</block>
  <block id="ffa76ec5527e36c51f49fe091541cca6" category="paragraph">NetApp MetroCluster 使用 NetApp 的 HA （控制器容錯移轉或 CFO ）功能來防範控制器故障。它還包括本機 SyncMirror 技術、災難時的叢集容錯移轉（隨需控制器容錯移轉或 CFOD ）、硬體備援、以及地理區隔、以達到高可用度。SyncMirror 會將資料寫入兩個叢中、以同步鏡射 MetroCluster 組態的兩個部份資料：本機叢（位於本機櫃上）主動提供資料、而遠端叢（位於遠端機櫃上）通常不會提供資料。所有 MetroCluster 元件（例如控制器、儲存設備、纜線、交換器（與 Fabric MetroCluster 搭配使用）和介面卡）均具備硬體備援功能。</block>
  <block id="54823008c0a63d8491d2c84e13356f84" category="paragraph">NetApp SnapMirror 主動式同步可透過 FCP 和 iSCSI SAN 傳輸協定提供資料存放區精細保護、讓您只能選擇性地保護高優先順序的工作負載。它提供對本機和遠端站台的主動式存取、而 NetApp MetroCluster 則是主動式待命解決方案。目前、主動式同步是一種非對稱式解決方案、其中一端較另一端更偏好、提供更好的效能。這是使用 ALUA （非對稱邏輯單元存取）功能來達成的、此功能會自動通知 ESXi 主機偏好的控制器。不過、 NetApp 已宣佈啟用主動式同步功能、即將啟用完全對稱的存取。</block>
  <block id="d3e911c902a6b066f9c31d471d16fb21" category="paragraph">若要跨兩個站台建立 VMware HA/DRS 叢集、 ESXi 主機會由 vCenter Server Appliance （ VCSA ）使用和管理。vSphere 管理、 VMotion ® 和虛擬機器網路是透過兩個站台之間的備援網路連線。管理 HA/DRS 叢集的 vCenter Server 可連線至兩個站台的 ESXi 主機、並應使用 vCenter HA 進行設定。</block>
  <block id="da76be2bc20d4e043d9a2019b817214f" category="inline-link">如何在 vSphere Client 中建立和設定叢集</block>
  <block id="e02f3e9258a23204655bd512ec53911d" category="paragraph">請參閱<block ref="c06ae090600e7aa086edfa28514435e7" category="inline-link-rx"></block> 設定 vCenter HA 。</block>
  <block id="bdd88c75f085534f6e2cdc7726cf1dd6" category="paragraph">您也應該參閱<block ref="3a8301f60ad04eb873ae8dea15ee0495" category="inline-link-rx"></block>。</block>
  <block id="38910d3dab2318849fd5f1a1dfbe0152" category="inline-link">VMware 儲存相容性指南</block>
  <block id="eab65c9bc6c74eff9aee0d7f0c44276d" category="paragraph">vSphere Metro Storage Cluster （ VMSC ）是經過認證的組態、可保護虛擬機器（ VM ）和容器免於故障。這是透過使用延伸儲存概念和 ESXi 主機叢集來達成的、這些主機分佈在不同的故障網域、例如機架、建築物、校園或甚至城市。NetApp MetroCluster 和 SnapMirror 主動同步儲存技術可分別為主機叢集提供 RPO = 0 或近乎 RPO = 0 的保護。VMSC 組態的設計是為了確保即使完整的實體或邏輯「站台」故障、資料仍可隨時使用。在成功通過 VMSC 認證程序之後、必須通過 VMSC 組態一部分的儲存裝置認證。所有支援的儲存裝置都可以在中找到<block ref="293ceee3268d7991d7fe245e02c1c5c9" category="inline-link-rx"></block>。</block>
  <block id="838b66b875df1b432ac420a98cba3db6" category="paragraph">如果您想要更多有關 vSphere Metro Storage 叢集設計準則的資訊、請參閱下列文件：</block>
  <block id="07aaf2aebfd07b8763284018d1ebbf57" category="inline-link">VMware vSphere 支援 NetApp MetroCluster</block>
  <block id="a4a5fd5b00daf98bd381d80257378acd" category="list-text"><block ref="a4a5fd5b00daf98bd381d80257378acd" category="inline-link-rx"></block></block>
  <block id="c3dc11e39d996a00b095022f4e56583d" category="inline-link">VMware vSphere 支援 NetApp SnapMirror 業務持續運作</block>
  <block id="8f675397d9c0ef95aa8b3f0ada9d601a" category="list-text"><block ref="f53214cfd764fa0267c92323be0d7337" category="inline-link-rx"></block> （現在稱為 SnapMirror 主動同步）</block>
  <block id="ee0a206d2287c89b2a7b780e07929b81" category="paragraph">視延遲考量因素而定、 NetApp MetroCluster 可部署在兩種不同的組態中、以搭配 vSphere 使用：</block>
  <block id="b553530def78406c0977f70d5e90b9e8" category="list-text">Stretch MetroCluster</block>
  <block id="2d90abe978ed8084d304295ad0a8c8fd" category="list-text">Fabric MetroCluster</block>
  <block id="b03023e82bda6a71adc49c4834e3b6ab" category="paragraph">以下說明 Stretch MetroCluster 的高階拓撲圖。</block>
  <block id="b0c20dc8226bb49f35f0f68f7ef77bba" category="image-alt">使用 MCC 的 VMSC 圖表</block>
  <block id="119be031ef4485d20c7683d291d0e9f6" category="inline-link">本文檔MetroCluster</block>
  <block id="ad9122c6d75ebaa024669fde1c0bdfb8" category="paragraph">請參閱<block ref="d8a206747dbcec13122724b2aee18957" category="inline-link-rx"></block> 取得 MetroCluster 的特定設計與部署資訊。</block>
  <block id="b47354fcd7d17ab4fbb3283f71677efe" category="paragraph">SnapMirror 主動式同步也可透過兩種不同方式部署。</block>
  <block id="314084a577b998d8089dff72c98c58b0" category="list-text">非對稱</block>
  <block id="40e2e641bad11918585c3dd4f76c2716" category="list-text">對稱（ ONTAP 9.14.1 中的私有預覽）</block>
  <block id="b9ca5ba97cf75d3dafb51f78e073770a" category="inline-link">NetApp文件</block>
  <block id="1c71125ba0668792e46d93c17dc6c428" category="paragraph">請參閱<block ref="9ace5d3ebe2fe57037322de54ac9a869" category="inline-link-rx"></block> 取得 SnapMirror 主動同步的特定設計與部署資訊。</block>
  <block id="bca8b52c503406abc3e9e50c5352d0a2" category="paragraph">本文件介紹 VMware 領先業界的災難恢復（ DR ）軟體 VMware Site Recovery Manager （ SRM ） ONTAP 解決方案、包括最新的產品資訊和最佳實務做法、可簡化部署、降低風險並簡化後續管理。</block>
  <block id="4f46fffb0ac7017fd2b42c10d6aa03fc" category="paragraph">備份虛擬機器並快速恢復這些虛擬機器、是ONTAP vSphere的絕佳優勢之一、SnapCenter 而使用VMware vSphere的VMware vCenter外掛程式、可輕鬆管理vCenter內部的這項功能。</block>
  <block id="3a021eaaeb6692340890af4de2f7514a" category="paragraph">以下各節將超越 VMware 和 ONTAP SRM 的部署最佳實務做法。</block>
  <block id="b69cd5a82aaf0c524a71d46ec6fdd29c" category="cell">NFS v4.1 工作階段主幹需要 ONTAP 9.14.1 及更新版本</block>
  <block id="80303385ad0f7147caa1af6d2162852b" category="paragraph">外掛程式也是VASA Provider許多功能的管理介面、ONTAP 可支援vVols的儲存原則型管理。在登錄VMware vSphere的VMware vSphere基礎架構工具之後ONTAP 、請使用它來建立儲存功能設定檔、將其對應至儲存設備、並確保資料存放區在一段時間內符合設定檔的要求。VASA Provider也提供一個介面、可用來建立及管理VVol資料存放區。</block>
  <block id="d9c9eb44a58ee1ce90daa68527aa8930" category="summary">使用 MCC 的 VMSC 的失敗案例</block>
  <block id="e7c7574b0826c9074f480de76c889ba8" category="paragraph">以下各節概述 VMSC 和 NetApp MetroCluster 系統各種故障情況的預期結果。</block>
  <block id="c8a2eebb480fef69e6ed917ea7f7a9d3" category="section-title">單一儲存路徑故障</block>
  <block id="b99e8e694b032f593bbd01f6205b4a98" category="paragraph">在這種情況下、如果 HBA 連接埠、網路連接埠、前端資料交換器連接埠或 FC 或乙太網路纜線等元件故障、 ESXi 主機會將該儲存裝置的特定路徑標記為已停用。如果在 HBA/ 網路 / 交換器連接埠上提供恢復功能、就能為儲存裝置設定多個路徑、 ESXi 理想情況下會執行路徑切換。在這段期間內、虛擬機器會持續執行而不會受到影響、因為提供多條路徑可通往儲存設備、因此可確保儲存設備的可用度。</block>
  <block id="1fff6650ef9c430da0f875c203d5dab0" category="paragraph">* 附註： * 在此案例中、 MetroCluster 行為並無變更、所有資料存放區仍會保留在各自站台內。</block>
  <block id="80fc15dd1deb985234440745e8a78d4c" category="paragraph">在使用 NFS/iSCSI 磁碟區的環境中、 NetApp 建議在標準 vSwitch 中、至少為 NFS vmkernel 連接埠設定兩個網路上行鏈路、而在對應 NFS vmkernel 介面的連接埠群組中、則必須設定相同的上行鏈路。NIC 群組可在雙主動式或雙主動式待命模式中進行設定。</block>
  <block id="0c8694e8ef7f8935edbfac605753bc95" category="paragraph">此外、對於 iSCSI LUN 、必須將 vmkernel 介面繫結至 iSCSI 網路介面卡、以設定多重路徑。如需詳細資訊、請參閱 vSphere 儲存文件。</block>
  <block id="0fc808fdb968eb089fbc5124c0a8e15a" category="paragraph">在使用光纖通道 LUN 的環境中、 NetApp 建議至少有兩個 HBA 、以保證 HBA/ 連接埠層級的恢復能力。NetApp 也建議將單一啟動器分區至單一目標分區、以做為設定分區的最佳實務做法。</block>
  <block id="238c3d1c7bf8b5b42237392383a4c7ab" category="paragraph">應使用虛擬儲存主控台（ VSC ）來設定多重路徑原則、因為它會為所有新的和現有的 NetApp 儲存裝置設定原則。</block>
  <block id="217811709dfb096c78e73934de01271c" category="section-title">單一 ESXi 主機故障</block>
  <block id="93bc89a0478478dd84d8159a18f6c1a2" category="image-alt">單一主機故障。</block>
  <block id="15023af3b440b4004f509e961bfe1e30" category="paragraph">在這種情況下、如果 ESXi 主機發生故障、 VMware HA 叢集中的主節點會偵測主機故障、因為主機不再接收到網路心跳。若要判斷主機是否真的停機或只是網路分割區、主節點會監控資料存放區的訊次、如果沒有、則會 ping 失敗主機的管理 IP 位址、以執行最終檢查。如果所有這些檢查都是負數、則主節點會將此主機宣告為故障主機、而在該故障主機上執行的所有虛擬機器都會在叢集中的正常主機上重新開機。</block>
  <block id="9a11158d52f71012ae8722b09bf8bf29" category="paragraph">如果已設定 DRS VM 和主機關聯性規則（ VM 群組 sitea_vms 中的 VM 應在主機群組 sitea_hosts 中執行主機）、則 HA 主機會先檢查站台 A 的可用資源如果站台 A 沒有可用的主機、則主主機會嘗試在站台 B 的主機上重新啟動 VM</block>
  <block id="7922c92ff860eb0508dc8cc8aae3ffdd" category="paragraph">如果本機站台有資源限制、則可能會在其他站台的 ESXi 主機上啟動虛擬機器。不過、如果將虛擬機器移轉回本機站台中任何仍在運作的 ESXi 主機、而違反任何規則、則定義的 DRS VM 和主機關聯性規則將會修正。如果 DRS 設定為手動、 NetApp 建議您啟動 DRS 、並套用建議來修正虛擬機器的放置位置。</block>
  <block id="387b5a49326be3a47e081682e75e19b4" category="paragraph">在此案例中、 MetroCluster 行為並無任何變更、所有資料存放區仍會保持不變、不受其個別站台影響。</block>
  <block id="a11ffa7d20dab792fe5aa9c27017493e" category="section-title">ESXi 主機隔離</block>
  <block id="17e01652089acd413e26ea89cf98a2b8" category="image-alt">ESXi 主機隔離</block>
  <block id="8a4b746274e9d7129602d54434624806" category="paragraph">在此案例中、如果 ESXi 主機的管理網路中斷、 HA 叢集中的主節點將不會接收任何訊息、因此此主機會在網路中隔離。若要判斷它是否發生故障或只是隔離、主節點會開始監控資料存放區心跳。如果主機存在、則主機會由主節點宣告為隔離。根據設定的隔離回應、主機可能會選擇關閉、關閉虛擬機器、甚至讓虛擬機器保持開機。隔離回應的預設時間間隔為 30 秒。</block>
  <block id="a070f7923919fed39772c5d3f91bf482" category="section-title">磁碟機櫃故障</block>
  <block id="e8acf0e4f25cdd641c9a047482d56ba5" category="paragraph">在此案例中、有兩個以上的磁碟或整個機櫃發生故障。資料是從仍在運作的複合環境提供、不會中斷資料服務。磁碟故障可能會影響本機或遠端叢。由於只有一個叢處於作用中狀態、因此集合體會顯示為降級模式。更換故障磁碟後、受影響的集合體將自動重新同步以重建資料。重新同步後、集合體將自動返回正常的鏡射模式。如果單一 RAID 群組中有兩個以上的磁碟發生故障、則必須從頭重建叢。</block>
  <block id="4f90d34a41c7ebc83024a5e3ca35ff3a" category="image-alt">單一磁碟櫃故障。</block>
  <block id="8af0b36d49baf198133a234e76b06445" category="paragraph">* 注意： * 在此期間、虛擬機器 I/O 作業不會受到影響、但效能會降低、因為資料是透過 ISL 連結從遠端磁碟機櫃存取。</block>
  <block id="1c872dcd4bcebb1d7567f383901dfc0d" category="section-title">單一儲存控制器故障</block>
  <block id="68badb604dbd29653979fdc7083cbffe" category="paragraph">在這種情況下、兩個儲存控制器中的其中一個會在一個站台發生故障。由於每個站台都有 HA 配對、因此一個節點的故障會以透明方式自動觸發容錯移轉至另一個節點。例如、如果節點 A1 故障、其儲存設備和工作負載會自動傳輸至節點 A2 。虛擬機器將不會受到影響、因為所有的叢集都仍然可用。第二個站台節點（ B1 和 B2 ）不受影響。此外、 vSphere HA 將不會採取任何行動、因為叢集中的主節點仍會接收到網路心跳。</block>
  <block id="0ac25682ea568511724f2e0819127d89" category="image-alt">單一節點故障</block>
  <block id="e7b4c0523308b3fd46189b6ab4867fe5" category="paragraph">如果容錯移轉是循環災難的一部分（節點 A1 容錯移轉至 A2 ）、而且之後發生 A2 故障、或是站台 A 完全故障、則災難後的切換可能會發生在站台 B</block>
  <block id="7b590b52d9f3d4d40cda67758ff92ba1" category="section-title">交換器間連結故障</block>
  <block id="9df08f82abe35d87c6f7c96b18dab755" category="section-title">管理網路的交換器間連結故障</block>
  <block id="ed0711cbc7a050952e0e370bab079bff" category="image-alt">管理網路上的交換器間連結故障</block>
  <block id="a32c6c77bb8d407cf5825aec175bab4b" category="paragraph">在此案例中、如果前端主機管理網路的 ISL 連結失敗、站台 A 的 ESXi 主機將無法與站台 B 的 ESXi 主機通訊這會導致網路分割區、因為特定站台的 ESXi 主機將無法將網路心跳傳送至 HA 叢集中的主節點。因此、由於分割區的緣故、將會有兩個網路區段、每個區段中都會有一個主節點、可保護 VM 免於特定站台內的主機故障。</block>
  <block id="36974534f1a2014a3e7e229d795ef51b" category="paragraph">* 附註： * 在此期間、虛擬機器仍在執行中、在此案例中、 MetroCluster 行為並無變更。所有的資料存放區都會繼續保持不變、不受其個別站台影響。</block>
  <block id="628309883a8d1307131d205b200c56ae" category="section-title">儲存網路的交換器間連結故障</block>
  <block id="a9da7e2a43bcea673a22b949355e619d" category="image-alt">儲存網路的交換器間連結故障</block>
  <block id="625db96c5ee1e9b5197b6cb3c1715021" category="paragraph">在此案例中、如果後端儲存網路的 ISL 連結故障、站台 A 的主機將無法存取站台 B 的儲存磁碟區或叢集 B 的 LUN 、反之亦然。VMware DRS 規則的定義、是為了讓主機儲存站台的關聯性能讓虛擬機器在不影響站台的情況下執行。</block>
  <block id="8d9609f32cbee8fa5080f95d71a2a142" category="paragraph">在此期間、虛擬機器會繼續在各自的站台上執行、在此案例中、 MetroCluster 行為不會有任何變更。所有的資料存放區都會繼續保持不變、不受其個別站台影響。</block>
  <block id="719831bfdda20be14c04e2b165cce85e" category="paragraph">如果因為某種原因違反關聯規則（例如、 VM1 原本應從站台 A 執行、其磁碟位於本機叢集 A 節點上、而 VM1 則是在站台 B 的主機上執行）、則虛擬機器的磁碟將透過 ISL 連結遠端存取。由於 ISL 連結故障、在站台 B 執行的 VM1 將無法寫入其磁碟、因為通往儲存磁碟區的路徑已關閉、且該特定虛擬機器已關閉。在這些情況下、 VMware HA 不會採取任何行動、因為主機正在主動傳送心跳。這些虛擬機器必須在各自的站台手動關閉並開啟電源。下圖說明違反 DRS 關聯性規則的虛擬機器。</block>
  <block id="09ba89b1ea49214c15fbf8ea6f129cb0" category="image-alt">發生 ISL 故障後、違反 DRS 關聯性規則的虛擬機器無法寫入磁碟</block>
  <block id="49f26967af2ad76cacf7888cbeeb0590" category="section-title">所有交換器間故障或完整資料中心分割區</block>
  <block id="bc331d84348670dff6731555166fa378" category="paragraph">在這種情況下、站台之間的所有 ISL 連結都會中斷、而且兩個站台彼此之間會隔離。如先前的案例所述、例如管理網路和儲存網路的 ISL 故障、虛擬機器在完全 ISL 故障時不會受到影響。</block>
  <block id="a40e8cf2a5b5b1e22fec9f26cce85b9d" category="paragraph">在站台之間分割 ESXi 主機之後、 vSphere HA 代理程式會檢查資料存放區心跳、而且在每個站台中、本機 ESXi 主機將能夠將資料存放區心跳更新至各自的讀寫磁碟區 /LUN 。站台 A 中的主機會假設站台 B 中的其他 ESXi 主機故障、因為沒有網路 / 資料存放區檢測信號。站台 A 的 vSphere HA 會嘗試重新啟動站台 B 的虛擬機器、最終會失敗、因為站台 B 的資料存放區因為儲存 ISL 故障而無法存取。站台 B 也會再次出現類似的情況</block>
  <block id="3543d47d1f3a8dc6989a32f62ce3ea77" category="image-alt">所有 ISL 故障或完整的資料中心分割區</block>
  <block id="3a096ef571101010add81b37081d3276" category="paragraph">NetApp 建議判斷是否有任何虛擬機器違反 DRS 規則。從遠端站台執行的任何虛擬機器都會停機、因為它們將無法存取資料存放區、 vSphere HA 會在本機站台上重新啟動該虛擬機器。當 ISL 連結恢復上線後、在遠端站台上執行的虛擬機器將會停止運作、因為無法有兩個執行個體使用相同的 MAC 位址執行虛擬機器。</block>
  <block id="87e9384cb464ff9a4ce385fc59a178a2" category="image-alt">VM1 違反 DRS 關聯規則的資料中心分割區</block>
  <block id="0951e388ebea20c49e71af25ef84947d" category="section-title">NetApp MetroCluster 中兩個 Fabric 上的交換器間連結故障</block>
  <block id="1e9be78885a356d1a2ec0ab0d4a4cecb" category="paragraph">在一個或多個 ISL 故障的情況下、流量會繼續流經其餘的連結。如果兩個架構上的所有 ISL 都發生故障、使得儲存和 NVRAM 複寫站台之間沒有連結、則每個控制器都會繼續提供其本機資料。還原至少一個 ISL 時、所有的叢會自動重新同步。</block>
  <block id="715cbc6f6bcf5da6b73f10233847d3a1" category="paragraph">在所有 ISL 停機之後所發生的任何寫入動作、都不會鏡射到另一個站台。當組態處於此狀態時、發生災難時的切入將會遺失尚未同步的資料。在這種情況下、需要手動介入才能在進行重新操作後恢復。如果很可能在較長的時間內沒有可用的 ISL 、系統管理員可以選擇關閉所有資料服務、以避免在發生災難時發生資料遺失的風險。在至少有一個 ISL 可供使用之前、應將執行此動作的可能性與需要進行重新操作的災難可能性進行權衡。或者、如果 ISL 在串聯案例中發生故障、系統管理員可能會在所有連結失敗之前、觸發已規劃的切換至其中一個站台。</block>
  <block id="89f375bfe8be0893bf175b89ce754b8e" category="image-alt">NetApp MetroCluster 中兩個 Fabric 的交換器間連結故障。</block>
  <block id="bc813a6fdbbeebf4d230b7e33d8c3a76" category="section-title">已消除叢集連結故障</block>
  <block id="1919456d1613248a128c65a84b235fe5" category="paragraph">在對等叢集連結故障案例中、由於 Fabric ISL 仍處於作用中狀態、因此兩個站台的資料服務（讀取和寫入）都會繼續存在於兩個叢集。任何叢集組態變更（例如、新增 SVM 、在現有 SVM 中配置 Volume 或 LUN ）都無法傳播到其他站台。這些資料會保留在本機 CRS 中繼資料磁碟區中、並在還原對等叢集連結時自動傳播到其他叢集。如果必須強制切換才能還原對等叢集連結、則在切換程序中、仍在運作中的站台上、中繼資料磁碟區的遠端複寫複本會自動重新播放未完成的叢集組態變更。</block>
  <block id="77130a0b52e4379c6b6667cf7f8e155c" category="image-alt">已對等叢集連結故障</block>
  <block id="9dc32d7afddc9a265c5c2713db55fc70" category="section-title">完成站台故障</block>
  <block id="d0d6a03c382bc5412f1822e5c97d5142" category="paragraph">在完整站台 A 故障案例中、站台 B 的 ESXi 主機因為故障而無法從站台 A 的 ESXi 主機取得網路心跳。站台 B 的 HA 主機會驗證資料存放區心跳不存在、宣告站台 A 的主機故障、並嘗試重新啟動站台 B 中的站台 A 虛擬機器在此期間、儲存管理員會執行一次轉換、以恢復仍在運作的站台上故障節點的服務、該站台將還原站台 B 上站台 A 的所有儲存服務站台 A 磁碟區或 LUN 在站台 B 上可用後、 HA 主代理程式會嘗試重新啟動站台 B 中的站台 A 虛擬機器</block>
  <block id="23e5761401326cc21bcf9d108b9e3e7f" category="paragraph">如果 vSphere HA 主要代理程式嘗試重新啟動虛擬機器（包括登錄及開機）失敗、則會在延遲後重試重新啟動。重新啟動之間的延遲時間最多可設定為 30 分鐘。vSphere HA 會嘗試重新啟動這些項目、最多嘗試次數（預設為六次）。</block>
  <block id="641031c1f370e06434afd215f8610dae" category="paragraph">* 附註： * 在放置管理程式找到適當的儲存設備之前、 HA 主機不會開始重新啟動嘗試、因此在整個站台發生故障的情況下、這將是在執行切入之後。</block>
  <block id="085a4a3eba6c30fa589bfee20eb0c294" category="paragraph">如果站台 A 已切換、則可透過容錯移轉至正常運作的節點、無縫地處理其中一個仍在運作的站台 B 節點的後續故障。在這種情況下、四個節點的工作現在僅由一個節點執行。在這種情況下、恢復將包括執行恢復到本機節點的贈品。然後、當站台 A 還原時、會執行切換作業、以還原組態的穩定狀態作業。</block>
  <block id="2b9b713afb0d80ef371a0b55e58366b6" category="image-alt">完成站台故障</block>
  <block id="e6364c2f5314a32cd95be04b4c2112e6" category="paragraph">以下各節概述將 VMware vVols 與 ONTAP 儲存設備搭配使用的程序和最佳實務做法。</block>
  <block id="a9da618400fb93b20c20f5343efaefa7" category="sidebar">VMware vSphere Metro Storage Cluster with ONTAP</block>
  <block id="2f58fa882a22b5af5f0741f03abaf611" category="sidebar">vSphere Metro Storage 叢集搭配 ONTAP</block>
  <block id="4a884da785a62e8b1758932191ff42de" category="paragraph">使用 VMware 、 Oracle OLVM 或 KVM 來虛擬化資料庫、對於選擇虛擬化技術的 NetApp 客戶而言、這是越來越常見的選擇、即使是他們最關鍵的關鍵任務資料庫也一樣。</block>
  <block id="3a8ba1ff8824968961222d6b447b4973" category="section-title">支援能力</block>
  <block id="3231d83af741101eb02b16e5d7a6dffc" category="paragraph">對於 Oracle 虛擬化支援政策、尤其是 VMware 產品、存在許多誤解。聽說 Oracle 完全不支援虛擬化並不罕見。這個概念不正確、導致錯失從虛擬化中獲益的機會。Oracle Doc ID 249212.1 討論實際需求、客戶很少會將此視為疑慮。</block>
  <block id="722bd611ee4f38780607b400c8a604c0" category="paragraph">如果虛擬化伺服器發生問題、而 Oracle Support 先前不知道該問題、可能會要求客戶在實體硬體上重現問題。執行產品尖端版本的 Oracle 客戶可能不想使用虛擬化技術、因為可能會發生支援問題、但這種情況對於虛擬化客戶而言、並不是一個真正的世界、因為他們使用的是 Oracle 產品版本。</block>
  <block id="c8a4476ecddeda66dbd2c354c8fb2c6b" category="paragraph">考慮將資料庫虛擬化的客戶應根據其業務需求做出儲存決策。雖然這是所有 IT 決策的一般陳述、但資料庫專案尤其重要、因為需求的大小和範圍差異極大。</block>
  <block id="835ce293f862d9fb74e50f4cf928c56d" category="paragraph">儲存簡報有三個基本選項：</block>
  <block id="327813abbc0ae1e9d3abe282303bf00c" category="list-text">Hypervisor 資料存放區上的虛擬化 LUN</block>
  <block id="1a1af5efffda8c766ead9f73fc782e0e" category="list-text">由虛擬機器掛載的 NFS 檔案系統（非從 NFS 型資料存放區）</block>
  <block id="f9bf9489147891f7ee7ba15126a27fda" category="list-text">直接裝置對應。客戶不喜歡 VMware RDM 、但實體裝置通常與 KVM 和 OLVM 虛擬化類似。</block>
  <block id="69b0ac6bf6ea8e1ab4e4fc896294da01" category="paragraph">將儲存設備呈現給虛擬化來賓作業系統的方法通常不會影響效能。主機作業系統、虛擬化網路驅動程式和 Hypervisor 資料存放區實作均經過高度最佳化、只要遵循基本最佳實務做法、通常都能在 Hypervisor 和儲存系統之間使用所有可用的 FC 或 IP 網路頻寬。在某些情況下、使用一種儲存呈現方法比使用另一種方法來獲得最佳效能可能會稍微容易一些、但最終結果應該是可比較的。</block>
  <block id="a2e8fb5328f6558e3a119d8c224a1897" category="paragraph">決定如何將儲存設備呈現給虛擬化來賓作業系統的關鍵因素是可管理性。沒有正確或錯誤的方法。最佳方法取決於 IT 營運需求、技能和偏好。</block>
  <block id="e4919ac0a074fa1bba5303f596a5f591" category="paragraph">考量因素包括：</block>
  <block id="c422e10bbf04c180f4c47f81ed9a1f7a" category="list-text">* 透明度。 * VM 管理其檔案系統時、資料庫管理員或系統管理員更容易識別其資料的檔案系統來源。檔案系統和 LUN 的存取方式與實體伺服器的存取方式完全相同。</block>
  <block id="42de52ad09be3101fc535dea2aedce1d" category="list-text">* 一致性。 * VM 擁有其檔案系統時、使用或不使用 Hypervisor 層會影響管理能力。資源配置、監控、資料保護等程序也可在整個資產中使用、包括虛擬化和非虛擬化環境。</block>
  <block id="0562446bc5eefe9a584e23ffb3061cbf" category="paragraph">另一方面、在另一個 100% 虛擬化的資料中心中、最好還是在整個佔用空間中使用資料存放區型儲存設備、但前提是上述相同的理由（一致性）、也就是能夠使用相同的程序來進行資源配置、保護、監控和資料保護。</block>
  <block id="7269a37b557c66664c0377693f62ec8a" category="list-text">* 穩定性與疑難排解。 * VM 擁有其檔案系統時、由於整個儲存堆疊都存在於 VM 上、因此提供良好、穩定的效能與疑難排解問題變得更簡單。Hypervisor 唯一的角色是傳輸 FC 或 IP 框架。當資料存放區包含在組態中時、它會引入另一組逾時、參數、記錄檔和潛在錯誤、使組態複雜化。</block>
  <block id="c160b6d86853c20a432e2407b82866e6" category="list-text">* 廠商鎖定 * 將資料放入資料存放區後、使用不同的 Hypervisor 或將資料從虛擬化環境中移出、將變得非常困難。</block>
  <block id="a42abd01a1e0c89cfa2112dc09378967" category="list-text">* 啟用 Snapshot ： * 虛擬化環境中的傳統備份程序可能會因為頻寬相對有限而成為問題。例如、四埠 10GbE 主幹可能足以支援許多虛擬化資料庫的日常效能需求、但這類主幹可能不足以使用 RMAN 或其他需要串流完整資料複本的備份產品來執行備份。因此、日益整合的虛擬化環境需要透過儲存快照來執行備份。如此可避免僅為了支援備份時間內的頻寬和 CPU 需求而需要過度建置 Hypervisor 組態。</block>
  <block id="86c36175331b4a95c083fabdcca8b8a0" category="paragraph">使用來賓擁有的檔案系統有時會讓您更輕鬆地利用快照型備份和還原、因為需要保護的儲存物件可以更輕鬆地鎖定目標。然而、越來越多的虛擬化資料保護產品能夠與資料存放區和快照完美整合。在決定如何將儲存設備呈現給虛擬化主機之前、應充分考慮備份策略。</block>
  <block id="8c19dda4c4cab5e52edf9463f196b97d" category="section-title">資料存放區等量分割</block>
  <block id="8fa77493c52e71f201ccdb67db26446d" category="paragraph">在使用資料庫搭配資料存放區時、效能方面有一個關鍵因素需要考量、那就是分段。</block>
  <block id="53ab623a905e6ec84d908f0b99a8d1c8" category="paragraph">VMFS 等資料存放區技術可以跨越多個 LUN 、但它們不是等量磁區的裝置。LUN 會串聯。最終結果可能是 LUN 熱點。例如、典型的 Oracle 資料庫可能有 8-LUN ASM 磁碟群組。所有 8 個虛擬化 LUN 均可在 8-LUN VMFS 資料存放區上進行佈建、但無法保證資料所在的 LUN 。產生的組態可能是全部 8 個虛擬化 LUN 、佔用 VMFS 資料存放區內的單一 LUN 。這會成為效能瓶頸。</block>
  <block id="e6bb99e411f5495b03c1e0a4e75a1434" category="paragraph">通常需要分拆。有些 Hypervisor （包括 KVM ）可以使用 LVM 等量分拆來建置資料存放區、如前所述 <block ref="dd0ff2598ebb26feb9ff73a59186b79f" category="inline-link-macro-rx"></block>。有了 VMware 、架構看起來有點不同。每個虛擬化 LUN 都必須放置在不同的 VMFS 資料存放區上。</block>
  <block id="506c2c0c7f5b70af3df68c45c46f45a7" category="paragraph">例如：</block>
  <block id="6ec151851a31c86edd358bc49f80908c" category="paragraph"><block ref="6ec151851a31c86edd358bc49f80908c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="70ff2667d6b190dea65bae42217aa310" category="paragraph">這種方法的主要驅動因素不是 ONTAP 、而是因為單一 VM 或 Hypervisor LUN 可平行處理的作業數量、有固有的限制。單一 ONTAP LUN 通常支援的 IOPS 遠高於主機所能要求的 IOPS 。單一 LUN 效能限制幾乎是主機作業系統的普遍結果。結果是大多數資料庫需要 4 到 8 個 LUN 才能滿足效能需求。</block>
  <block id="59f9d8d1b212a8ff6bd3476975e17620" category="paragraph">VMware 架構需要仔細規劃其架構、以確保此方法不會遇到資料存放區和 / 或 LUN 路徑最大化問題。此外、每個資料庫都不需要一組唯一的 VMFS 資料存放區。主要需求是確保每個主機都有一組乾淨的 4 到 8 個 IO 路徑、從虛擬化 LUN 到儲存系統本身的後端 LUN 。在極少數情況下、更多的資料存取器可能對真正極致的效能需求有所助益、但 4-8 個 LUN 通常足以滿足 95% 的資料庫需求。單一 ONTAP 磁碟區包含 8 個 LUN 、可透過典型的 OS/ONTAP/ 網路組態、支援多達 250,000 個隨機 Oracle 區塊 IOPS 。</block>
  <block id="622b235a9123d972c612737c81eb55a1" category="inline-link">NFSv3 nConnect 功能搭配 NetApp 和 VMware</block>
  <block id="ee7dab8e6be0e4b3085e8fb1df295146" category="list-text">VMware 和 NetApp 目前支援從 ONTAP 9.14.1 開始的 NFSv4.1 工作階段主幹。如需特定版本詳細資料、請參閱 NetApp NFS 4.1 互通性對照表附註。NFSv3 不支援多個實體路徑到一個 Volume 、但支援從 vSphere 8.0U2 開始的 nconnect 。如需 nconnect 的詳細資訊、請參閱<block ref="2668e8271f58131cbbe97dab01f83475" category="inline-link-rx"></block>。對於採用 ONTAP 9.8 的 FlexGroup 、我們建議的最佳實務做法是讓適用於 VMware vSphere 的 ONTAP 工具建立 FlexGroup 、然後您應該將其卸載、並使用循環 DNS 重新掛載、以便在叢集之間分散負載。ONTAP 工具只會在裝載資料存放區時使用一個 LIF 。重新掛載資料存放區之後、可使用 ONTAP 工具來監控及管理資料存放區。</block>
  <block id="7564f732469e12963d8b416572cf4efb" category="section-title">什麼是 vSphere Metro Storage Cluster ？</block>
  <block id="830d984ea50f71fa76636d0524167a3a" category="doc">vSphere 資料存放區和傳輸協定功能概觀</block>
  <block id="7bbcbf5b4bf3f23dc1b710dfd65de967" category="list-text">VMware 支援從 vSphere 8.0U2 開始與 NFSv3 進行 nconnect 。如需 nconnect 的詳細資訊、請參閱<block ref="2668e8271f58131cbbe97dab01f83475" category="inline-link-rx"></block></block>
  <block id="1d1d9d816e63b6c7d3057732579e8889" category="list-text">如果使用 NetApp NFS 外掛程式 for VMware VAAI 、則通訊協定應設為<block ref="2521ef5d58fc027d3121662b7d8f9ac2" prefix=" " category="inline-code"></block> 而非<block ref="61a52f7a75745796f63ec9e3ea2547b4" prefix=" " category="inline-code"></block> 匯出原則規則建立或修改時。即使資料傳輸協定是 NFSv3 、 VAAI 複製卸載功能仍需要 NFSv4 傳輸協定才能運作。將通訊協定指定為<block ref="2521ef5d58fc027d3121662b7d8f9ac2" prefix=" " category="inline-code"></block> 包括 NFSv3 和 NFSv4 版本。</block>
  <block id="cc0f7f705e4495c607aea288505e31bf" category="sidebar">VMSC 概述</block>
  <block id="de9a829f775bc333b77fdacbc333f7a1" category="sidebar">vSphere HA 解決方案</block>
  <block id="70b29c8dabeb7a16884003c35e163f96" category="sidebar">VMSC 設計</block>
  <block id="6c4755219197ce467bf892a552c8663a" category="sidebar">VMSC 恢復能力</block>
  <block id="13376e3e9b02a56731aa64aeb10947b2" category="sidebar">使用 MCC 的 VMSC 案例</block>
</blocks>