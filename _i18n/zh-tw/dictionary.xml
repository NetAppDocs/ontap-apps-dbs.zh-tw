<?xml version="1.0" encoding="UTF-8"?>
<blocks>
  <block id="d41d8cd98f00b204e9800998ecf8427e" category="summary"></block>
  <block id="30d965eef5ba25c6b9998ae38270b43e" category="doc">法律聲明</block>
  <block id="e9c44bbfd795a5d63d74c6a77afee70d" category="paragraph">法律聲明提供版權聲明、商標、專利等存取權限。</block>
  <block id="6016a2b341113bf496b719905398ecd2" category="section-title">版權</block>
  <block id="52009bb7ee17227f566cd26a02caee56" category="inline-link-macro"><block ref="52009bb7ee17227f566cd26a02caee56" category="inline-link-rx"></block></block>
  <block id="a1a9afcf552a769c282769271829889a" category="paragraph"><block ref="a1a9afcf552a769c282769271829889a" category="inline-link-macro-rx"></block></block>
  <block id="126a02652da6de02962cf1b654fd6376" category="section-title">商標</block>
  <block id="c4ce4761e466527d26b3e3d5ed1006fd" category="paragraph">NetApp 、 NetApp 標誌及 NetApp 商標頁面上列出的標章均為 NetApp 、 Inc. 的商標。其他公司與產品名稱可能為其各自所有者的商標。</block>
  <block id="f99aa604031e5049799e73b5c3748a98" category="inline-link-macro"><block ref="f99aa604031e5049799e73b5c3748a98" category="inline-link-rx"></block></block>
  <block id="5d545fe5152641e2ebe654e336e520e5" category="paragraph"><block ref="5d545fe5152641e2ebe654e336e520e5" category="inline-link-macro-rx"></block></block>
  <block id="be89498d2f8a22ce47c02ba9795fe2af" category="section-title">專利</block>
  <block id="d0b19d36be2c5f16e9aef46c8a452d3d" category="paragraph">如需最新的 NetApp 擁有專利清單、請參閱：</block>
  <block id="88e5eabd3917048b6927c42496b98f86" category="inline-link-macro"><block ref="88e5eabd3917048b6927c42496b98f86" category="inline-link-rx"></block></block>
  <block id="dd38f906b37d412de7d1c1dcf4cbf31c" category="paragraph"><block ref="dd38f906b37d412de7d1c1dcf4cbf31c" category="inline-link-macro-rx"></block></block>
  <block id="56c34c6410dd45c5cec44149ad0ce037" category="section-title">隱私權政策</block>
  <block id="8acb58cbd50ef1b468a020ee0bd351d3" category="inline-link-macro"><block ref="8acb58cbd50ef1b468a020ee0bd351d3" category="inline-link-rx"></block></block>
  <block id="2352c4e1f4d0024ade0869e00e6243f4" category="paragraph"><block ref="2352c4e1f4d0024ade0869e00e6243f4" category="inline-link-macro-rx"></block></block>
  <block id="c0227cef6f07a8cd2ac72f2945b031aa" category="section-title">開放原始碼</block>
  <block id="9b73989307c1975dfa4d5e1581e4afe8" category="paragraph">通知檔案提供有關 NetApp 軟體所使用之協力廠商版權與授權的資訊。</block>
  <block id="253b40ae359ba25b56231803430c4873" category="section-title">ONTAP</block>
  <block id="856c8958afd787f748a4a025f649154a" category="inline-link-macro">ONTAP 9.13.1 注意事項</block>
  <block id="b22b3b2970d843f99e7e6904bea05207" category="inline-link-macro">關於此功能的注意事項ONTAP 9.12.1.1</block>
  <block id="0358f41254df2d512849db5a04b7e3d4" category="inline-link-macro">關於此功能的注意事項ONTAP 9.12.0</block>
  <block id="28f1290102a277ef2fd452d558c74219" category="inline-link-macro">ONTAP 9.11.1 注意事項</block>
  <block id="57b07f14c8eb4660f94a86d29d53362d" category="inline-link-macro">關於本產品的注意事項ONTAP 9.10.1</block>
  <block id="396712eb9c1644241047ac30619b2b3e" category="inline-link-macro">ONTAP 9.10.0 注意事項</block>
  <block id="1e6000d4849ef9f3e08d1d9908e9f163" category="inline-link-macro">關於此功能的注意事項ONTAP</block>
  <block id="6f408b9c999245c7aa32bc9cb1a020f6" category="inline-link-macro">關於本產品的注意事項ONTAP 9.8</block>
  <block id="04b0bd5b1b4d414fdde93f809162d36d" category="inline-link-macro">關於產品的注意ONTAP 事項9.7</block>
  <block id="0c1d7dffcba488555d5eb39b8991e822" category="inline-link-macro">關於此功能的注意事項ONTAP</block>
  <block id="a11ac6880e72412c0f54ae19bea3d191" category="inline-link-macro">關於本產品的注意事項ONTAP</block>
  <block id="e49c3c01b15761b5f011d0bd2a0661a3" category="inline-link-macro">關於產品的注意事項ONTAP 9.4</block>
  <block id="bf7dcf6467a8a03b05b2d37d31d6eccd" category="inline-link-macro">關於本產品的注意事項ONTAP</block>
  <block id="0328352fdfda84af6968462d1a67d3a6" category="inline-link-macro">關於此功能的注意事項ONTAP 9.2</block>
  <block id="83904100c7d6fe0102e8b2b5bd8ec4bb" category="inline-link-macro">關於此產品的注意事項ONTAP</block>
  <block id="9e476387322a5c250893cf9c5c4ce78c" category="doc">原則</block>
  <block id="b9e18a3460bc17eb9ea65b03f0167453" category="paragraph">這在資料庫中很常見。已知包含非作用中區塊的資料庫也可用於 FabricPool 分層。例如、供應鏈管理資料庫可能包含歷史資訊、這些資訊必須在必要時提供、但在正常作業期間無法存取。FabricPool 可用於選擇性地重新定位非使用中的區塊。</block>
  <block id="95e955bbbe5dd9520a6bf45b0d8a9d4c" category="paragraph">例如、在 FabricPool 磁碟區上執行的資料檔案<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 90 天的期間會保留過去 90 天內在效能層級上存取的任何區塊。然而、 90 天內未存取的任何項目都會重新移至容量層。在其他情況下、正常的應用程式活動會將正確的區塊保留在正確的層級上。例如、如果資料庫通常用於定期處理過去 60 天的資料、則會降低許多<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 可以設定期間、因為應用程式的自然活動可確保區塊不會提早重新定位。</block>
  <block id="c33af7c93d461803ceaf8531e861017d" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 原則應與資料庫一起使用。許多資料庫都有定期活動、例如季末流程或重新編製索引作業。如果這些作業的期間大於<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 可能會發生效能問題。例如、如果季度末處理需要 1TB 的資料、而這些資料原本沒有受到影響、則該資料現在可能會出現在容量層。從容量層讀取的速度通常極快、可能不會造成效能問題、但實際結果將取決於物件儲存區組態。</block>
  <block id="03431a55183cb73a12c1bbc3e1927678" category="paragraph">。<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 原則的設定應足夠高、以保留效能層上可能需要的檔案。例如、如果資料庫需要最新 60 天的資料、而且效能最佳、則需要設定<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 期間為 60 天。也可以根據檔案的存取模式來達成類似的結果。例如、如果需要最近 90 天的資料、而應用程式正在存取該 90 天的資料範圍、則資料會保留在效能層。設定<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 在資料變得不活躍之後、將會立即將資料分級至 2 天。</block>
  <block id="25d9496e96e698b08c4fc713bfc9a5ca" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 由於只有<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 原則會影響作用中檔案系統中的區塊。</block>
  <block id="55fad400d892fb6062e67904fa9be485" category="admonition">任何類型的資料存取都會重設熱圖資料。因此、資料庫完整表格掃描、甚至是讀取來源檔案的備份活動、都會因為需要而防止分層<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 從未達到臨界值。</block>
  <block id="117c4b6bad0236ab23e0fe29aead8aef" category="paragraph">雖然 LUN 調整大小是增加容量的選項、但通常最好使用 LVM 、包括 Oracle ASM 。LVM 存在的主要原因之一、是為了避免需要調整 LUN 大小。使用 LVM 時、多個 LUN 會結合在一個虛擬儲存池中。從該池中切出的邏輯卷由 LVM 管理，可以輕鬆調整大小。另一項優點是在所有可用 LUN 之間分配給定的邏輯磁碟區、以避免在特定磁碟機上出現熱點。通常可以使用 Volume Manager 將邏輯磁碟區的基礎範圍重新放置到新的 LUN 、以執行透明移轉。</block>
  <block id="4d4855a15e1f9d6fd8f8bdf1668c537e" category="doc">手動強制 NVFAIL</block>
  <block id="8772c1c8bed97f5c942657feeb8bfb6f" category="admonition">本節將進一步說明基本的 ONTAP NVFAIL 、以涵蓋 MetroCluster 專屬主題。</block>
  <block id="14d74316044293d1ebd8c5a01ff90055" category="paragraph">使用 MetroCluster 時、寫入必須登入至少一個其他控制器的本機 NVRAM 和 NVRAM 、才能被確認。此方法可確保硬體故障或停電不會導致機內 I/O 遺失如果本機 NVRAM 故障或連線至其他節點失敗、則資料將不再鏡射。</block>
  <block id="d820d86d09ea05a0de19c3aacbfb72b2" category="paragraph">如果本機 NVRAM 回報錯誤、節點會關機。當使用 HA 配對時、此關機會導致容錯移轉至合作夥伴控制器。使用 MetroCluster 時、行為取決於所選的整體組態、但可能會導致自動容錯移轉至遠端記事。無論如何、由於發生故障的控制器尚未確認寫入作業、因此不會遺失任何資料。</block>
  <block id="886174de078cee4595eb8a8d07f81703" category="paragraph">站台對站台連線故障會封鎖 NVRAM 複寫至遠端節點、這種情況更為複雜。寫入不再複寫到遠端節點、因此如果控制器發生災難性錯誤、可能會導致資料遺失。更重要的是、在這些情況下、嘗試容錯移轉至其他節點會導致資料遺失。</block>
  <block id="790ec042c9b89dac2390ea81b9c29a51" category="paragraph">控制因素是 NVRAM 是否同步。如果 NVRAM 已同步、則節點對節點容錯移轉可安全地繼續進行、而不會有資料遺失的風險。在 MetroCluster 組態中、如果 NVRAM 和基礎 Aggregate plex 同步、則在不遺失資料的情況下繼續進行轉換是安全的。</block>
  <block id="3d936bb059b98a2fc7c177d20eb755c9" category="paragraph">除非強制進行容錯移轉或切換、否則 ONTAP 不允許在資料不同步時進行容錯移轉或切換。以這種方式強制變更條件、即表示資料可能會留在原始控制器中、而且資料遺失是可以接受的。</block>
  <block id="3d37a3a8ed77bebc986238aedccecbc9" category="paragraph">如果強制進行容錯移轉或切換、則資料庫特別容易遭到毀損、因為資料庫會在磁碟上保留較大的內部資料快取。如果發生強制容錯移轉或切換、先前確認的變更將會有效捨棄。儲存陣列的內容會有效地及時向後跳轉、而且資料庫快取的狀態不再反映磁碟上資料的狀態。</block>
  <block id="7ad23b7fa394c8666b132d78a58b1987" category="paragraph">為了保護應用程式不受這種情況影響、 ONTAP 允許設定磁碟區、以針對 NVRAM 故障提供特殊保護。觸發時、此保護機制會導致磁碟區進入稱為 NVFAIL 的狀態。此狀態會導致 I/O 錯誤、導致應用程式關機、使其不使用過時的資料。資料不應遺失、因為儲存系統上仍有任何已確認的寫入資料、而資料庫則應在記錄中顯示任何已認可的交易資料。</block>
  <block id="99259586124503e22927506a7ed3738d" category="paragraph">通常的後續步驟是讓系統管理員在手動將 LUN 和磁碟區重新上線之前、先完全關閉主機。雖然這些步驟可能涉及一些工作、但這種方法是確保資料完整性的最安全方法。並非所有資料都需要這項保護、因此 NVFAIL 行為可依每個磁碟區設定。</block>
  <block id="13fbc5a220fe8007dcaea69217bba134" category="paragraph">最安全的選項是透過指定來強制轉換跨站台散佈的應用程式叢集（包括 VMware 、 Oracle RAC 及其他）<block ref="71e644310ff0f1164d905d6e80174023" prefix=" " category="inline-code"></block> 在命令列。此選項可作為緊急措施使用、以確保所有快取資料均已清除。如果主機使用的儲存資源原本位於災難性站台上、則會收到 I/O 錯誤或過時的檔案處理 <block ref="a3c6541ac12f1f06a81cc9b03e6bd094" prefix="(" category="inline-code"></block>）錯誤。Oracle 資料庫當機、檔案系統可能完全離線、或切換至唯讀模式。</block>
  <block id="dc6683d37e50abd82911fa91c036fbb2" category="paragraph">在完成重新操作之後、<block ref="6b0a5ec5ecf08db5d4b32d860214d098" prefix=" " category="inline-code"></block> 需要清除旗標、且 LUN 必須置於線上。完成此活動後、即可重新啟動資料庫。這些工作可以自動化、以降低 RTO 。</block>
  <block id="a2626552f293b2377efe829e69d14daa" category="section-title">dr-force-nvfail</block>
  <block id="f0cc4bbe3d196251009dbe9f0ac42ffc" category="paragraph">作為一般安全措施、請設定<block ref="a2626552f293b2377efe829e69d14daa" prefix=" " category="inline-code"></block> 在所有可能在正常作業期間從遠端站台存取的磁碟區上加上旗標、表示這些磁碟區是在容錯移轉之前使用的活動。此設定的結果是、選取的遠端磁碟區在進入時無法使用<block ref="6b0a5ec5ecf08db5d4b32d860214d098" prefix=" " category="inline-code"></block> 在進行重新操作時。在完成重新操作之後、<block ref="6b0a5ec5ecf08db5d4b32d860214d098" prefix=" " category="inline-code"></block> 旗標必須清除、且 LUN 必須置於線上。這些活動完成後、即可重新啟動應用程式。這些工作可以自動化、以降低 RTO 。</block>
  <block id="5f6aa76cc0fe886c07f242f921486ef7" category="paragraph">結果就像使用<block ref="71e644310ff0f1164d905d6e80174023" prefix=" " category="inline-code"></block> 手動切換的旗標。然而、受影響的磁碟區數量可能僅限於必須受到保護的磁碟區、不受具有過時快取的應用程式或作業系統的影響。</block>
  <block id="4df566a29b44806612369c0c1f67521b" category="paragraph">對於不使用的環境、有兩項關鍵需求<block ref="a2626552f293b2377efe829e69d14daa" prefix=" " category="inline-code"></block> 在應用程式磁碟區上：</block>
  <block id="aaf1cc67bd88c39a71e691d413ded49f" category="list-text">在主站台遺失後、強制進行的重新操作不得超過 30 秒。</block>
  <block id="7f9cc623e2a11875714cf4bc64f148fd" category="list-text">在維護工作期間、或是在 SyncMirror 叢或 NVRAM 複寫不同步的任何其他情況下、切勿進行切入。第一項需求可以透過使用已設定為在站台故障 30 秒內執行轉換的斷路器軟體來達成。這並不表示切入作業必須在偵測站台故障的 30 秒內執行。這表示、如果站台確認運作已過 30 秒、就不再安全地強制進行轉換。</block>
  <block id="0929cc8043c21dcf0163f06424677ede" category="paragraph">第二項需求可在已知 MetroCluster 組態不同步時停用所有自動切換功能、以部分滿足。更好的選擇是擁有可監控 NVRAM 複寫和 SyncMirror 叢的健全狀況的斷路器解決方案。如果叢集未完全同步、則斷路器不應觸發切入。</block>
  <block id="a168430c68d0310385371eabe149a118" category="paragraph">NetApp MCTB 軟體無法監控同步處理狀態、因此當 MetroCluster 因任何原因而未同步時、應該停用同步處理狀態。ClusterLion 確實包含 NVRAM 監控和叢監視功能、除非 MetroCluster 系統確認完全同步、否則可將其設定為不觸發切入。</block>
  <block id="baba038803e218b2ac3b2688bc2fd5db" category="doc">LUN 計數</block>
  <block id="b0e4db975ae00108abe9f47db9be5668" category="paragraph">LUN 是 ONTAP 上的虛擬化物件、存在於託管集合體中的所有磁碟機中。因此、 LUN 的效能不受其大小影響、因為無論選擇何種大小、 LUN 都會充分發揮彙總的效能潛力。</block>
  <block id="7235d4b71fadc2fe03d09d863c7cdd66" category="paragraph">為了方便起見、客戶可能想要使用特定大小的 LUN 。例如、如果資料庫建置在由兩個 LUN 組成的 LVM 或 Oracle ASM 磁碟群組上、每個 LUN 均為 1TB 、則該磁碟群組必須以 1TB 為增量來擴充。最好是從八個 LUN （每個 LUN 爲 500GB ）構建磁盤組，以便可以以更小的增量來增加磁盤組。</block>
  <block id="4b1ffe65479a23391a2c7f9caf467a35" category="paragraph">我們不鼓勵建立通用標準 LUN 大小的做法、因為這樣做可能會使管理變得複雜。例如、當資料庫或資料存放區的範圍介於 1TB 到 2TB 時、 100GB 的標準 LUN 大小可能運作良好、但大小為 20TB 的資料庫或資料存放區需要 200 個 LUN 。這表示伺服器重新開機時間較長、不同 UI 中需要管理的物件較多、而 SnapCenter 等產品必須在許多物件上執行探索。使用較少、較大的 LUN 可避免此類問題。</block>
  <block id="4afa3de974c36a09c2055d30989bb405" category="list-text">LUN 數量比 LUN 大小更重要。</block>
  <block id="691c70133d96d57796a9299359666f80" category="list-text">LUN 大小大多由 LUN 數需求控制。</block>
  <block id="8af9e525c143179b948a11fc382a331e" category="list-text">避免建立超過所需數量的 LUN 。</block>
  <block id="407b2218ad77513a7e3964f169d07e66" category="paragraph">與 LUN 大小不同、 LUN 數量確實會影響效能。應用程式效能通常取決於透過 SCSI 層執行平行 I/O 的能力。因此、兩個 LUN 的效能優於單一 LUN 。使用 LVM （例如 Veritas VxVM 、 Linux LVM2 或 Oracle ASM ）是提高平行度的最簡單方法。</block>
  <block id="39143fe6204f383e4ce3bb3b77926455" category="paragraph">NetApp 客戶通常從 LUN 數量增加到 16 個以上獲得最小的效益、不過測試 100% SSD 環境時、隨機 I/O 非常繁重、這已證實可進一步改善至 64 個 LUN 。</block>
  <block id="9875f7503e59521e91e519abd87f5c9e" category="paragraph">* NetApp 建議 * 下列事項：</block>
  <block id="57153ab478a4958250d76ac6bf4e3ac0" category="paragraph">一般而言、四到十六個 LUN 足以支援任何特定資料庫工作負載的 I/O 需求。由於主機 SCSI 實作的限制、少於四個 LUN 可能會造成效能限制。</block>
  <block id="de932976b195d4755fcbea64295fc7cb" category="doc">主機作業系統設定</block>
  <block id="f62cb371f65c322cd9e17a5c2cecd1c8" category="paragraph">大多數應用程式廠商文件都包含特定的 TCP 和乙太網路設定、以確保應用程式能以最佳方式運作。這些相同的設定通常足以提供最佳的 IP 型儲存效能。</block>
  <block id="ae7a0bb210cbd1edb935128116a21c55" category="section-title">乙太網路流量控制</block>
  <block id="a3c15fb208efc85bdfe72c57d56c92b8" category="paragraph">這項技術可讓用戶端要求傳送者暫時停止資料傳輸。這通常是因為接收者無法快速處理傳入的資料。一次、要求傳送者停止傳輸的中斷程度比接收者丟棄封包的中斷程度低、因為緩衝區已滿。現今作業系統中使用的 TCP 堆疊已不再如此。事實上、流量控制所造成的問題比解決的問題還多。</block>
  <block id="950d31923e253d170d6c994801ce7cec" category="paragraph">近年來、乙太網路流量控制所造成的效能問題不斷增加。這是因為乙太網路流量控制是在實體層運作。如果網路組態允許任何主機作業系統將乙太網路流量控制要求傳送至儲存系統、則所有連線的用戶端都會暫停 I/O 。由於單一儲存控制器服務的用戶端數量不斷增加、因此其中一或多個用戶端傳送流量控制要求的可能性會增加。在擁有廣泛作業系統虛擬化的客戶據點、經常會發現這個問題。</block>
  <block id="6bfd8563627c68f73c30581843441a74" category="paragraph">NetApp 系統上的 NIC 不應接收流量控制要求。實現此結果的方法因網路交換器製造商而異。在大多數情況下、可將乙太網路交換器上的流量控制設定為<block ref="a67b5ddb674c9ca32d9c9e1ca81578ee" prefix=" " category="inline-code"></block> 或<block ref="f4eb0bfa09695eb47ff4f3bd3ca4449d" prefix=" " category="inline-code"></block>，這意味着流控制請求不會轉發到存儲控制器。在其他情況下、儲存控制器上的網路連線可能不允許停用流程控制。在這些情況下、用戶端必須設定為永遠不要傳送流量控制要求、方法是變更至主機伺服器本身的 NIC 組態、或是變更主機伺服器所連接的交換器連接埠。</block>
  <block id="7496f3ff64e30d4732c2c64880faf186" category="admonition">* NetApp 建議 * 確保 NetApp 儲存控制器不會接收乙太網路流量控制封包。這通常可以透過設定控制器所連接的交換器連接埠來完成、但有些交換器硬體有限制、可能需要改用用戶端端變更。</block>
  <block id="ae6d0fc57efaf02ad7dfdacd3575e315" category="section-title">MTU 大小</block>
  <block id="ff13ea04765cd9c9aed7b839f15eb2b4" category="paragraph">使用巨型框架的結果顯示、透過降低 CPU 和網路成本、可在速度較低的網路中提供一些效能改善、但效益通常並不顯著。</block>
  <block id="ee3f364287a30ef10dfdce2f37d94ed2" category="admonition">* NetApp 建議 * 盡可能實作巨型框架、以實現任何可能的效能效益、並確保解決方案符合未來需求。</block>
  <block id="2c6ba27b7ed602a9089da6ad9f762c9a" category="paragraph">在 10Gb 網路中使用巨型框架幾乎是強制性的。這是因為大多數的 10Gb 實作都達到每秒封包數的限制、而不需要巨型框架、就能達到 10Gb 標誌。使用巨型框架可改善 TCP/IP 處理效率、因為它可讓作業系統、伺服器、 NIC 和儲存系統處理較少但較大的封包。效能的改善因 NIC 而異、但成效相當顯著。</block>
  <block id="a44be1bbfde97e4a64b50282325165e7" category="paragraph">對於巨型框架實作、通常但不正確的看法是、所有連線的裝置都必須支援巨型框架、而且 MTU 大小必須與端點對端點相符而是在建立連線時、兩個網路端點會協商最高的雙方可接受的框架大小。在一般環境中、網路交換器的 MTU 大小設為 9216 、 NetApp 控制器設為 9000 、用戶端則設為 9000 和 1514 的混合。支援 9000 MTU 的用戶端可以使用巨型框架、而只支援 1514 的用戶端可以協商較低的值。</block>
  <block id="a31484167f31e1c3f36f7cea821bc581" category="paragraph">在完全交換的環境中、這種配置的問題很少發生。不過、在沒有中繼路由器被迫分割巨型框架的路由環境中、請務必小心。</block>
  <block id="c805e9846e6fca449dbe3233cc5dbdf5" category="paragraph">* NetApp 建議 * 設定下列項目：</block>
  <block id="b4446b5ca60d915111af271495bd4c17" category="list-text">使用 1 GB 乙太網路（ GbE ）時、巨型框架是理想的選擇、但不是必要的。</block>
  <block id="5b1ea13ac12a9c8be0d09303f637dba4" category="list-text">使用 10GbE 及更快的速度、需要巨型框架才能達到最佳效能。</block>
  <block id="08a8dce78637f5dd14ed052163feb9da" category="section-title">TCP 參數</block>
  <block id="1a999618685598bee637262fe589de70" category="paragraph">三項設定通常設定錯誤： TCP 時間戳記、選擇性認可（ SACK ）和 TCP 視窗縮放。網際網路上的許多過時文件建議停用一或多個這些參數、以改善效能。這項建議在多年前就有一些優點、因為 CPU 功能較低、因此有助於盡可能降低 TCP 處理的成本。</block>
  <block id="6a594ec6f0bb742c1d2b0f631cf65ba1" category="paragraph">然而、在現代化的作業系統中、停用任何這些 TCP 功能通常會導致無法偵測的效益、同時也可能造成效能受損。在虛擬化網路環境中、效能受損的可能性特別大、因為這些功能是有效處理封包遺失和網路品質變更所必需的。</block>
  <block id="cdc44d05b1633e8a8c7835010c423dd6" category="admonition">* NetApp 建議 * 在主機上啟用 TCP 時間戳記、 SACK 和 TCP 視窗縮放功能、而且在任何目前的作業系統中、這三個參數都應該預設為開啟。</block>
  <block id="341d84aa26cb4521474864e04ea2a63b" category="inline-image-macro">錯誤：缺少圖形影像</block>
  <block id="b56265ceb6311e42003e668438136a59" category="section-title">同步複寫</block>
  <block id="0cf4a786acebd750bbfdfc4416c89406" category="section-title">儲存硬體</block>
  <block id="ea9f3de5dd21190fbc6bca180b2040f1" category="section-title">中間器ONTAP</block>
  <block id="0f54fb931dbdeea735f18a8e73f9eab5" category="doc">使用 SyncMirror 保護資料</block>
  <block id="d7023f86951b6c3c009891a468c3effd" category="paragraph">在最簡單的層級上、同步複寫表示必須先對鏡射儲存設備的兩側進行任何變更、然後才會被確認。例如、如果資料庫正在寫入記錄檔、或是正在修補 VMware 來賓作業系統、則寫入作業絕不能遺失。作爲一種協議級別，在兩個站點上的非易失性介質被認可之前，存儲系統不得確認寫入內容。只有這樣、在不遺失資料的風險下繼續作業是安全的。</block>
  <block id="eee4f7a4e0ed3a8646a97bcf3e118fb9" category="paragraph">使用同步複寫技術是設計和管理同步複寫解決方案的第一步。最重要的考量是瞭解在各種計畫性和非計畫性失敗案例中可能發生的情況。並非所有同步複寫解決方案都提供相同的功能。如果您需要提供零恢復點目標（ RPO ）的解決方案、亦即零資料遺失、則必須考慮所有故障情況。特別是、當站台之間的連線中斷而無法進行複寫時、預期會產生什麼結果？</block>
  <block id="71554672a088c43ab21c759ddd161928" category="section-title">SyncMirror 資料可用度</block>
  <block id="8646bb558f8f18a200cce2f70602627a" category="paragraph">SyncMirror 不僅可以在無法連線到遠端站台時、無縫切換至同步模式、也可以在連線恢復時、快速重新同步至 RPO = 0 狀態。遠端站台的資料過時複本也可在重新同步期間保留為可用狀態、以確保資料的本機和遠端複本隨時都存在。</block>
  <block id="1d12d7a206d9b5337ae6fa442f23d377" category="doc">僅限 Snapshot</block>
  <block id="64c29f2f2feedeb607ff588b13d9758b" category="paragraph">。<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block><block ref="964193481f440d73ce3474a7a09bc3ac" prefix=" " category="inline-code"></block> 僅適用於未與作用中檔案系統共用的區塊。它基本上會導致資料庫備份分層。在建立快照之後、區塊會成為分層的候選項目、然後區塊會被覆寫、導致區塊只存在於快照中。A 之前的延遲<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 區塊視為冷區、由控制<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 音量設定。ONTAP 9.8 的範圍為 2 至 183 天。</block>
  <block id="ebd9889c847a7a3ddeccd2717ead46f2" category="paragraph">許多資料集的變更率都很低、因此這項原則可節省的成本極低。例如、在 ONTAP 上觀察到的典型資料庫每週變更率低於 5% 。資料庫歸檔記錄檔可能佔用大量空間、但通常會繼續存在於作用中的檔案系統中、因此不會成為根據此原則分層的候選項目。</block>
  <block id="06b9281e396db002010bde1de57262eb" category="section-title">自動</block>
  <block id="ecf602bd5abbd6a605debedbb6c3d4e0" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 分層原則可將分層延伸至快照專用區塊、以及作用中檔案系統內的區塊。區塊冷卻前的延遲由控制<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 音量設定。ONTAP 9.8 的範圍為 2 至 183 天。</block>
  <block id="6256ce48698ff0bde6f818679cdfb382" category="paragraph">此方法可啟用無法與搭配使用的分層選項<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 原則。例如、資料保護原則可能需要保留 90 天的特定記錄檔。如果將冷卻期設定為 3 天、則任何超過 3 天的記錄檔都會從效能層中分層移出。此動作可釋放效能層級上的大量空間、同時仍可讓您檢視及管理完整的 90 天資料。</block>
  <block id="6adf97f83acf6453d4a6a4b1070f3754" category="section-title">無</block>
  <block id="7026ff5c5d4ab3946ff2d86f0e2cca6f" category="paragraph">。<block ref="334c4a4c42fdb79d7ebc3e73b517e6f8" prefix=" " category="inline-code"></block> 分層原則可防止任何額外的區塊從儲存層分層、但容量層中的任何資料仍會保留在容量層中、直到讀取為止。如果接著讀取區塊、則會將其拉回並放置在效能層上。</block>
  <block id="d152c7b0939fb6d35fdb0433de0d6369" category="paragraph">使用的主要原因<block ref="334c4a4c42fdb79d7ebc3e73b517e6f8" prefix=" " category="inline-code"></block> 分層原則旨在防止區塊分層、但隨著時間推移而變更原則可能會很有用。例如、假設某個特定資料集已廣泛分層至容量層、但卻產生對完整效能功能的非預期需求。可變更原則以防止任何額外的分層、並確認隨 IO 增加而讀取的任何區塊仍保留在效能層中。</block>
  <block id="b1c94ca2fbc3e78fc30069c8d0f01680" category="section-title">全部</block>
  <block id="84826d7e23dfac7549819d5115fdcedd" category="paragraph">。<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 分層原則取代了<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> 原則自 ONTAP 9.6 起。。<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> 原則僅套用至資料保護磁碟區、意指 SnapMirror 或 NetApp SnapVault 目的地。。<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 原則的功能相同、但不限於資料保護磁碟區。</block>
  <block id="10d8500e282e8bbacd668af6f773f412" category="paragraph">有了這項原則、就能立即將區塊視為酷炫、並立即分層至容量層。</block>
  <block id="ec583de0216b95bc673c84e4ec9356e6" category="paragraph">此原則特別適用於長期備份。它也可以用作階層式儲存管理（ HSM ）的形式。過去、 HSM 通常用於將檔案的資料區塊分層至磁帶、同時讓檔案本身在檔案系統上保持可見。具有的 FabricPool Volume<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 原則可讓您將檔案儲存在可見且可管理的環境中、但幾乎無需佔用本機儲存層的空間。</block>
  <block id="79768a069a539d4f130e672a660bf45f" category="doc">分區</block>
  <block id="a0bdb98e8b9da585816478d24278e42f" category="paragraph">FC 區域不得包含多個啟動器。這種安排一開始可能會運作、但啟動器之間的串擾最終會影響效能和穩定性。</block>
  <block id="8ef958d9e25538841b306960ab117626" category="paragraph">雖然在極少數情況下、來自不同廠商的 FC 目標連接埠行為造成問題、但多目標區域通常被視為安全區域。例如、避免將 NetApp 和非 NetApp 儲存陣列的目標連接埠同時納入同一區域。此外、將 NetApp 儲存系統和磁帶裝置置於同一個區域、更有可能造成問題。</block>
  <block id="642223473862db290604321fe2ebe763" category="doc">SVM</block>
  <block id="47ea917cf14ad91c68c407f90a7a189d" category="paragraph">SVM 在 ONTAP CLI 中稱為 vserver 、是基本的儲存功能單元、比較 SVM 與 VMware ESX 伺服器上的客體是很有用的。</block>
  <block id="13ce2622b2cc2118c44d3aae7df8167d" category="paragraph">與儲存架構的其他層面一樣、 SVM 和邏輯介面（ LIF ）設計的最佳選項、在很大程度上取決於擴充需求和業務需求。</block>
  <block id="8fb41a27984f0beba2e12fb920a486aa" category="paragraph">我們並未正式提供 ONTAP 的 SVM 資源配置最佳實務做法。正確的方法取決於管理和安全要求。</block>
  <block id="f4d8541bb6d07f7533a6b5aa6cfb2455" category="paragraph">大多數客戶只需操作一部主要 SVM 、即可滿足大部分的日常需求、然後針對特殊需求建立少量 SVM 。例如、您可能想要建立：</block>
  <block id="259908e9e431c0fbb9d425249ceb7930" category="list-text">由專業團隊管理的關鍵業務資料庫 SVM</block>
  <block id="0e10f2715884f3538282397d69b2cd00" category="list-text">開發群組的 SVM 已獲得完整的管理控制權、可讓他們獨立管理自己的儲存設備</block>
  <block id="7624156e307247e4ea1ec8bf574136a1" category="list-text">必須限制管理團隊的 SVM 、用於處理敏感業務資料、例如人力資源或財務報告資料</block>
  <block id="e5e09031843479ef9ef8cbbd4c2f404c" category="inline-link-macro">NetApp Hardware Universe</block>
  <block id="fb012f1e7970d8285bd5d6c5a7f7d523" category="doc">SSD 集合體、包括 AFF 系統</block>
  <block id="cb8e4651c457f71d5788f38eac01471f" category="paragraph">可用空間定義為任何不用於實際資料的空間、並包括集合體本身的未分配空間、以及組成磁碟區內的未使用空間。也必須考慮精簡配置。例如、某個磁碟區可能包含 1TB LUN 、其中只有 50% 被實際資料使用。在精簡佈建的環境中、這似乎是消耗 500GB 的空間。不過、在完全佈建的環境中、 1TB 的完整容量似乎正在使用中。500GB 的未分配空間會隱藏起來。實際資料未使用此空間、因此應納入總可用空間的計算。</block>
  <block id="d3487661d9a0702bd5915d49070f62dc" category="paragraph">NetApp 對於企業應用程式所使用的儲存系統建議如下：</block>
  <block id="678e476783bceae80094bcb4c1f32969" category="admonition">* NetApp 建議 * 至少有 10% 的可用空間。這包括所有未使用的空間、包括集合體或磁碟區內的可用空間、以及因使用完整資源配置而分配但實際資料未使用的任何可用空間。邏輯空間並不重要、問題在於實際可用的實體空間可用於資料儲存。</block>
  <block id="2171d172d184f1202a686849c85dce91" category="paragraph">10% 可用空間的建議非常保守。SSD 集合體可支援使用率更高的工作負載、而不會對效能造成任何影響。不過、隨著 Aggregate 的使用率增加、如果未仔細監控使用率、則用盡空間的風險也會增加。此外、當系統的容量達到 99% 時、可能不會導致效能降低、但在訂購額外硬體時、可能需要管理人員努力避免系統完全裝滿、而且可能需要一些時間來採購和安裝額外的磁碟機。</block>
  <block id="789243e17acb0b134f435d6c4c1350f2" category="section-title">HDD 集合體、包括 Flash Pool 集合體</block>
  <block id="0b0a68e2dedde9c0b9a3ea4276f4b85c" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 原則是最適合備份資料的原則。如此可確保在達到冷卻臨界值時、無論主要檔案系統中的檔案是否已刪除或繼續存在、都能立即分層。將所有可能需要的檔案儲存在作用中檔案系統的單一位置、也能簡化管理。沒有理由搜尋快照以找出需要還原的檔案。</block>
  <block id="11a75a1257cc68a4a46bc553dabe0c0d" category="paragraph">。<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 原則可以生效、但該原則僅適用於不在作用中檔案系統中的區塊。因此、必須先刪除 NFS 或 SMB 共用上的檔案、才能分層化資料。</block>
  <block id="b4af96e8cea99b56592db816cab30fce" category="paragraph">使用 LUN 組態時、此原則的效率會更低、因為從 LUN 刪除檔案只會從檔案系統中繼資料中移除檔案參照。LUN 上的實際區塊會一直保留到位、直到被覆寫為止。這種情況可能會造成從刪除檔案到覆寫區塊並成為分層候選項目之間的長時間延遲。移動有一些好處<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 區塊到容量層、但整體而言、備份資料的 FabricPool 管理最適合搭配使用<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 原則。</block>
  <block id="1c237d1ebcdeff13ae0145c741d9401d" category="admonition">此方法可協助使用者更有效率地管理備份所需的空間、但 FabricPool 本身並不是備份技術。將備份檔案分層至物件存放區可簡化管理、因為檔案仍可在原始儲存系統上看到、但物件存放區目的地中的資料區塊則取決於原始儲存系統。如果來源磁碟區遺失、物件儲存區資料將無法再使用。</block>
  <block id="a19665c8f7c0210f96ad2934ad0ee361" category="paragraph">在 ONTAP 系統上、儲存設備是以 4KB 為單位進行組織。資料庫或檔案系統 8KB 區塊應對應至兩個 4KB 區塊。如果 LUN 組態發生錯誤、在任一方向將對齊移至 1KB 、則每個 8KB 區塊會存在於三個不同的 4KB 儲存區塊、而非兩個。這種安排會導致延遲增加、並導致在儲存系統中執行額外的 I/O 。</block>
  <block id="211a9fe299057fe8665b591dddbac56d" category="paragraph">對齊也會影響 LVM 架構。如果在整個磁碟機裝置上定義邏輯磁碟區群組內的實體磁碟區（不建立分割區）、 LUN 上的前 4KB 區塊會與儲存系統上的前 4KB 區塊對齊。這是正確的對齊方式。磁碟分割發生問題、因為它們會移轉作業系統使用 LUN 的起始位置。只要偏移量以 4KB 的整體單位移動、 LUN 就會對齊。</block>
  <block id="e98a692d783d8d778aab49ed4c55e214" category="doc">站台故障保護： NVRAM 和 MetroCluster</block>
  <block id="186577daf29184ed8a55cf899ba2979c" category="paragraph">MetroCluster 以下列方式擴充 NVRAM 資料保護：</block>
  <block id="679f5a5873d7d3378cf4b3035fd5cb13" category="list-text">在雙節點組態中、 NVRAM 資料會使用交換器間連結（ ISL ）複寫到遠端合作夥伴。</block>
  <block id="00bec98f52b9151dd2e0c760becd4ca8" category="list-text">在 HA 配對組態中、 NVRAM 資料會同時複寫到本機合作夥伴和遠端合作夥伴。</block>
  <block id="94deccfbf8f798c1661000b27a568b18" category="list-text">寫入內容必須複寫到所有合作夥伴、才能予以確認。此架構可將 NVRAM 資料複寫至遠端合作夥伴、保護機上 I/O 不受站台故障影響。此程序不涉及磁碟機層級的資料複寫。擁有該集合體的控制器負責將資料複寫至集合體中的兩個叢集、但在站台遺失時仍必須保護資料、避免在執行中遺失 I/O 。只有當合作夥伴控制器必須接管故障控制器時、才會使用複寫的 NVRAM 資料。</block>
  <block id="996aa1ed8a906e55c7f157a1643021b7" category="section-title">站台和機櫃故障保護： SyncMirror 和叢</block>
  <block id="1c114a932963683e04dc7dece97c15c9" category="paragraph">SyncMirror 是一項鏡射技術、可增強但不取代 RAID DP 或 RAID-TEC 。它會鏡射兩個不同 RAID 群組的內容。邏輯組態如下：</block>
  <block id="b4b4f1d65cb5f1370402220b00584e79" category="list-text">磁碟機會根據位置設定成兩個集區。一個集區由站台 A 上的所有磁碟機組成、第二個集區由站台 B 上的所有磁碟機組成</block>
  <block id="418f0763b76bff8e324f1afdd5456b49" category="list-text">接著會根據鏡射的 RAID 群組集建立通用儲存池（稱為 Aggregate ）。從每個站台擷取的磁碟機數量相等。例如、 20 個磁碟機的 SyncMirror Aggregate 將由站台 A 的 10 個磁碟機和站台 B 的 10 個磁碟機組成</block>
  <block id="51bf74357f742acfa0a7cd11ce52ed7f" category="list-text">指定站台上的每組磁碟機都會自動設定為一個或多個完全備援的 RAID DP 或 RAID-TEC 群組、而不受鏡像的使用影響。在鏡射下使用 RAID 、即使在站台遺失之後、也能提供資料保護。</block>
  <block id="8a35ad1e53533c7a3a8ff427bda0deb2" category="paragraph"><block ref="8a35ad1e53533c7a3a8ff427bda0deb2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="abf64dbc3ac20af1b4a30150a016ca58" category="paragraph">上圖說明 SyncMirror 組態範例。在控制器上建立了 24 個磁碟機的集合體、其中 12 個磁碟機來自於站台 A 上配置的機櫃、 12 個磁碟機來自站台 B 上配置的機櫃磁碟機分為兩個鏡射 RAID 群組。RAID 群組 0 包含站台 A 的 6 磁碟機叢、鏡射到站台 B 的 6 磁碟機叢同樣地、 RAID 群組 1 也包含站台 A 的 6 磁碟叢叢、鏡射到站台 B 的 6 磁碟叢叢</block>
  <block id="d9945e1dbadc87ba8e52a5e69376005c" category="paragraph">SyncMirror 通常用於提供 MetroCluster 系統的遠端鏡射、每個站台都有一份資料複本。有時候、它是用來在單一系統中提供額外的備援層級。特別是提供機架層級的備援。磁碟機櫃已包含雙電源供應器和控制器、整體上比金屬板稍多、但在某些情況下、可能需要額外的保護。例如、有一位 NetApp 客戶部署 SyncMirror 、用於汽車測試期間使用的行動即時分析平台。系統分為兩個實體機架、分別隨附獨立的電源饋送和獨立的 UPS 系統。</block>
  <block id="f3495a1e6cf563a617c71164f3b11ca3" category="section-title">備援故障： NVFAIL</block>
  <block id="c7474a3ed1a224804e4741a256bdd953" category="paragraph">如前所述、寫入必須先登入本機 NVRAM 及至少一個其他控制器上的 NVRAM 、才會被確認。此方法可確保硬體故障或停電不會導致機內 I/O 遺失如果本機 NVRAM 故障或連線至其他節點失敗、則資料將不再鏡射。</block>
  <block id="4774101e81ea03c43fe20e0d7f2d21d1" category="paragraph">控制因素是 NVRAM 是否同步。如果 NVRAM 已同步、則節點對節點容錯移轉可安全地繼續進行、不會有資料遺失的風險。在 MetroCluster 組態中、如果 NVRAM 和基礎 Aggregate plex 同步、則可以安全地繼續進行轉換、而不會有資料遺失的風險。</block>
  <block id="03e97c023521445cd70307afabdcf0d5" category="paragraph">如果強制進行容錯移轉或切換、資料庫和其他應用程式尤其容易毀損、因為它們會在磁碟上保留較大的內部資料快取。如果發生強制容錯移轉或切換、先前確認的變更將會有效捨棄。儲存陣列的內容會有效地及時向後跳轉、而且快取狀態不再反映磁碟上資料的狀態。</block>
  <block id="ff7a32ed70b7df57dd29a3ed75e8c787" category="paragraph">為了避免這種情況發生、 ONTAP 允許設定磁碟區、以針對 NVRAM 故障提供特殊保護。觸發時、此保護機制會導致磁碟區進入稱為 NVFAIL 的狀態。此狀態會導致 I/O 錯誤、導致應用程式當機。這項當機會導致應用程式關機、使其不使用過時的資料。資料不應遺失、因為記錄中應存在任何已認可的交易資料。通常的後續步驟是讓系統管理員在手動將 LUN 和磁碟區重新上線之前、先完全關閉主機。雖然這些步驟可能涉及一些工作、但這種方法是確保資料完整性的最安全方法。並非所有資料都需要這項保護、因此 NVFAIL 行為可依每個磁碟區設定。</block>
  <block id="637d4b37868fb7825461df6edd674158" category="section-title">HA 配對與 MetroCluster</block>
  <block id="9d8738f531e6c6a809ba66315beaa2f4" category="paragraph">MetroCluster 提供兩種組態：雙節點和 HA 配對。雙節點組態在 NVRAM 上的運作方式與 HA 配對相同。如果發生突然故障、合作夥伴節點可以重新執行 NVRAM 資料、以確保磁碟機一致、並確保沒有遺失任何已確認的寫入資料。</block>
  <block id="936f4311b16ee4dc74a5564892f8976d" category="paragraph">HA 配對組態也會將 NVRAM 複寫到本機合作夥伴節點。簡單的控制器故障會在合作夥伴節點上重新執行 NVRAM 、而獨立 HA 配對則不使用 MetroCluster 。萬一突然完全遺失站台、遠端站台也需要 NVRAM 、才能讓磁碟機保持一致、開始提供資料。</block>
  <block id="83b6c3c3018b913ecf1aca67e0daa35e" category="paragraph">MetroCluster 的一個重要層面是、在正常作業條件下、遠端節點無法存取合作夥伴資料。每個站台基本上都是一個可假設對方站台特性的個別系統。此程序稱為「轉換」、包含計畫性的轉換、可在不中斷營運的情況下、將站台作業移轉至另一個站台。它也包括站台遺失的非計畫性情況、以及災難恢復需要手動或自動切換。</block>
  <block id="58504b36cfdfd10d5f2802d7b943a379" category="section-title">切換與切換</block>
  <block id="d505751d1708fb5d57b0e23d089507a9" category="paragraph">術語切換和切換是指在 MetroCluster 組態中、在遠端控制器之間轉換磁碟區的程序。此程序僅適用於遠端節點。在四個磁碟區組態中使用 MetroCluster 時、本機節點容錯移轉是先前所述的相同接管和恢復程序。</block>
  <block id="1127608e73df5ede22b149c8f19fc860" category="section-title">計畫性切換與切換</block>
  <block id="a6733335678588619c977608e891e54e" category="paragraph">規劃的切換或切換類似於節點之間的接管或恢復。此程序有多個步驟、可能需要幾分鐘的時間、但實際發生的是儲存設備和網路資源的多階段順暢轉換。控制傳輸的速度比執行完整命令所需的時間快得多。</block>
  <block id="4bb5647dcff332f0b53819ecd631303c" category="paragraph">接管 / 恢復與切換 / 切換回復之間的主要差異在於對 FC SAN 連線能力的影響。使用本機接管 / 恢復功能、主機會遺失通往本機節點的所有 FC 路徑、並仰賴其原生 MPIO 來切換至可用的替代路徑。連接埠不會重新定位。透過切換和切換、控制器上的虛擬 FC 目標連接埠會轉換到另一個站台。它們在 SAN 上實際上已經停用一段時間、然後重新出現在替代控制器上。</block>
  <block id="0ba902ec3f6ce91c2e801715bb8b96fa" category="section-title">SyncMirror 逾時</block>
  <block id="9c8a1814b60b84d1aa68fa7bba69138b" category="paragraph">SyncMirror 是一項 ONTAP 鏡射技術、可針對機櫃故障提供保護。當機櫃之間相隔一段距離時、就能獲得遠端資料保護。</block>
  <block id="68cf36f65a7e56ff3b6c0894be3ed9e8" category="paragraph">SyncMirror 無法提供通用同步鏡像。因此、可用度更高。有些儲存系統使用固定的全或全自動鏡射、有時稱為 Domino 模式。這種形式的鏡像在應用程式中受到限制、因為如果與遠端站台的連線中斷、所有寫入活動都必須停止。否則、寫字會存在於某個站台、但不會存在於另一個站台。一般而言、如果站台對站台連線中斷超過一段短時間（例如 30 秒）、這類環境就會設定為使 LUN 離線。</block>
  <block id="84ad4c21def9c355e80ef250d910bfa2" category="paragraph">這種行為是小型環境子集的理想選擇。不過、大多數應用程式都需要一套解決方案、能夠在正常作業條件下提供保證同步複寫、但能夠暫停複寫。站台對站台連線能力完全中斷通常被視為近乎災難的情況。一般而言、這類環境會保持在線上狀態並提供資料、直到連線能力修復或正式決定關閉環境以保護資料為止。純粹因為遠端複寫失敗而需要自動關閉應用程式、這是不尋常的。</block>
  <block id="e3bd381a7bbaee6c741aee230972acf4" category="paragraph">SyncMirror 支援同步鏡射需求、並可靈活調整逾時時間。如果與遠端控制器和 / 或叢的連線中斷、 30 秒定時器就會開始倒數。當計數器達到 0 時、會使用本機資料繼續寫入 I/O 處理。資料的遠端複本可以使用、但會在連線恢復之前、及時凍結。重新同步利用 Aggregate 層級快照、將系統儘快恢復至同步模式。</block>
  <block id="0c919cd6511df6d83b811234b0448374" category="paragraph">值得注意的是、在許多情況下、這種通用的「全或全無」 Domino 模式複寫功能更適合在應用程式層上實作。例如、 Oracle DataGuard 包括最大保護模式、可在任何情況下保證執行個體的長時間複寫。如果複寫連結失敗超過可設定的逾時時間、資料庫就會關閉。</block>
  <block id="ba92cbe464cfee8aa12c41e6aecd1071" category="section-title">使用 Fabric 附加 MetroCluster 自動進行無人值守切換</block>
  <block id="515094655d10031595da776c94b3d710" category="paragraph">自動無人值守切換（ AUSO ）是一項 Fabric 附加 MetroCluster 功能、可提供一種跨站台 HA 的形式。如前所述、 MetroCluster 有兩種類型：每個站台上只有一個控制器、或每個站台上有一個 HA 配對。HA 選項的主要優點是、計畫性或非計畫性控制器關機仍可讓所有 I/O 成為本機。單一節點選項的優勢在於降低成本、複雜度和基礎架構。</block>
  <block id="29d4da26af76b66db3a172a39edf8367" category="paragraph">AUSO 的主要價值在於改善 Fabric 附加 MetroCluster 系統的 HA 功能。每個站台都會監控相對站台的健全狀況、如果沒有節點仍可提供資料、 AUSO 就會導致快速的轉換。這種方法在每個站台只有一個節點的 MetroCluster 組態中特別有用、因為在可用度方面、它使組態更接近 HA 配對。</block>
  <block id="6b3a5f7923b2d803fd3b28c255fef420" category="paragraph">AUSO 無法在 HA 配對層級提供全方位監控。HA 配對可提供極高的可用度、因為它包含兩條備援實體纜線、可用於直接節點對節點通訊。此外、 HA 配對中的兩個節點都能存取備援迴圈上的同一組磁碟、為一個節點提供另一條路由來監控另一個節點的健全狀況。</block>
  <block id="da87dad268507a3523bc38275b1d3fbc" category="paragraph">MetroCluster 叢集存在於站台之間、節點對節點通訊和磁碟存取都仰賴站台對站台網路連線。監控叢集其餘部分的活動訊號的能力有限。AUSO 必須區分其他站台實際停機、而非因為網路問題而無法使用的情況。</block>
  <block id="e8e4f55c4203e7fb24d4543a7a0f65da" category="paragraph">因此、如果 HA 配對中的控制器偵測到因特定原因（例如系統異常）而發生的控制器故障、就會提示接管。如果連線完全中斷、也可能會提示接管、有時也稱為「失去心跳」。</block>
  <block id="91aa4ce36cb243281f3777d66c8f89e0" category="paragraph">只有在原始站台偵測到特定故障時、 MetroCluster 系統才能安全地執行自動切換。此外、擁有儲存系統所有權的控制器必須能夠保證磁碟和 NVRAM 資料同步。控制器無法保證進行變更的安全性、因為它與來源站台失去接觸、而該站台仍可運作。如需將交換作業自動化的其他選項、請參閱下一節中的 MetroCluster tiebreaker （ MCTB ）解決方案資訊。</block>
  <block id="8e7705fe4aea384d7f6a99ab6dc0f408" category="section-title">MetroCluster tiebreaker 搭配網路附加 MetroCluster</block>
  <block id="897b7698cb343dbc3452e845705ab0f3" category="inline-link">NetApp MetroCluster tiebreaker</block>
  <block id="9c093f14319e8253b8c9b37290597239" category="inline-link">NetApp 支援網站</block>
  <block id="6f29b1849750ceee5eb7f6f02d100e6b" category="paragraph">與 AUSO 的自動切換功能也相容於 MCTB 。AUSO 反應非常迅速、因為它的設計是偵測特定故障事件、然後只有在 NVRAM 和 SyncMirror 叢同步時才叫用切入。</block>
  <block id="6f5c7ae76595eca2ca83c5dd30cd8e9f" category="paragraph">相反地、斷路器位於遠端位置、因此必須等到定時器結束後才會宣告站台停機。tiebreaker 最終會偵測 AUSO 涵蓋的控制器故障類型、但一般而言、 AUSO 已經開始進行開關作業、而且可能會在 tiebreaker 運作之前完成開關作業。產生的第二個來自 tiebreaker 的切換命令將會遭到拒絕。</block>
  <block id="7110edd59c3d0f25a584723f6fea26a0" category="paragraph">此外、 MCTB 可能無法因應導致下列事件順序的滾動災難：</block>
  <block id="93d732b784eaf1a323f191e75c10f233" category="list-text">站台之間的連線中斷超過 30 秒。</block>
  <block id="81d4275cc3534a9fa8cfdcdb5172eb94" category="list-text">SyncMirror 複寫逾時、且作業會繼續在主要站台上執行、使遠端複本過時。</block>
  <block id="44441f68631008a941ce92e985131ff9" category="list-text">主站台會遺失。結果是主站台上存在未複寫的變更。因此、由於下列幾個原因、可能不希望進行任何一次的重新操作：</block>
  <block id="499527dd40fad77b119b8b33c99cd614" category="list-text">關鍵資料可能會出現在主要站台上、而且該資料最終可能會恢復。允許應用程式繼續作業的轉換作業、將會有效捨棄該關鍵資料。</block>
  <block id="86de4e3737e3d871dacf8ffef353fc31" category="list-text">當站台遺失時、使用主要站台上儲存資源的仍在運作中站台上的應用程式可能已快取資料。切入會導致資料的過時版本與快取不相符。</block>
  <block id="dbb2a01afe28c8310daf781bb80b795f" category="list-text">當發生站台遺失時、使用主要站台上儲存資源的仍在運作中站台上的作業系統、可能已快取資料。切入會導致資料的過時版本與快取不相符。最安全的選項是將斷路器設定為在偵測到站台故障時傳送警示、然後讓人員決定是否強制進行轉換。應用程式和（或）作業系統可能需要先關機、才能清除任何快取資料。此外、 NVFAIL 設定也可用於新增進一步的保護、並協助簡化容錯移轉程序。</block>
  <block id="ec6b0ea9c511479c118aa0f028f6519d" category="section-title">ONTAP Mediator 搭配 MetroCluster IP</block>
  <block id="991d7d7d7388ccdd87c65ca09aa804f2" category="paragraph">光纖連接的 MetroCluster 可直接存取位於相對站台的儲存裝置。這可讓一個 MetroCluster 控制器從磁碟機讀取心跳資料、以監控其他控制器的健全狀況。這可讓一個控制器辨識另一個控制器的故障、並執行切換。</block>
  <block id="db2e932a11478bcf14c75d38e8b9a170" category="paragraph">相反地、 MetroCluster IP 架構只會透過控制器控制器連線路由所有 I/O 、而無法直接存取遠端站台上的儲存裝置。這會限制控制器偵測故障和執行轉換的能力。因此、 ONTAP Mediator 必須作為斷路器裝置、才能偵測站台遺失並自動執行轉換。</block>
  <block id="8004e6d63f487a456290225b74768a6c" category="section-title">使用 ClusterLion 的虛擬第三站點</block>
  <block id="f1d5a7305654a402a719675fbec810e7" category="paragraph">ClusterLion 是一款先進的 MetroCluster 監控設備、可作為虛擬第三站點使用。此方法可讓 MetroCluster 安全部署在雙站台組態中、並具備全自動的轉換功能。此外、 ClusterLion 還能執行額外的網路層級監控、並執行後置作業。完整文件可從 ProLion 取得。</block>
  <block id="f8aae92ec17ec82868ef9ffc767dbd03" category="list-text">ClusterLion 設備會使用直接連接的乙太網路和序列纜線來監控控制器的健全狀況。</block>
  <block id="c5f8963a91e3d8e7ac0abda2eab9f17d" category="list-text">這兩台設備透過備援的 3G 無線連線彼此連線。</block>
  <block id="24de16a13a1b584832d19117982cbfa6" category="list-text">ONTAP 控制器的電源會透過內部中繼路由傳送。發生站台故障時、包含內部 UPS 系統的 ClusterLion 會先切斷電源連線、然後再啟動切入。此程序可確保不會發生任何大腦分割狀況。</block>
  <block id="b2bcd3c3c555e2e4f27d453de4e0f06d" category="list-text">ClusterLion 會在 30 秒 SyncMirror 逾時內執行切換、或完全不執行。</block>
  <block id="390fb5f827a3fbcdc7d05e6e7db03223" category="list-text">除非 NVRAM 和 SyncMirror 叢集的狀態同步、否則 ClusterLion 不會執行切入。</block>
  <block id="f322f850d55e87946f9660e4ccb1bbb6" category="list-text">由於 ClusterLion 只會在 MetroCluster 完全同步時執行切入、因此不需要 NVFAIL 。此組態可讓擴充 Oracle RAC 等站台跨距環境保持連線、即使在非計畫性的轉換期間亦然。</block>
  <block id="5c132e05fb0e306f56955603619de359" category="list-text">支援包括光纖連接的 MetroCluster 和 MetroCluster IP</block>
  <block id="86bcf99dbc3944da56f06b48074d09f6" category="doc">正常運作</block>
  <block id="e48472f7daf781b63506f9e296443027" category="paragraph">在正常作業中、可以從本機或遠端複本存取 LUN 。紅色線表示 ALUA 所通告的最佳化路徑、結果應該是 IO 優先傳送至此路徑。</block>
  <block id="e139a585510a502bbf1841cf589f5086" category="section-title">故障</block>
  <block id="7ed516552b652790c92df0bf237264b2" category="paragraph">如果主動鏡像複本因為計畫性或非計畫性容錯移轉而無法使用、則顯然無法再使用。然而、遠端系統已擁有通往遠端站台的同步複本和 SAN 路徑。遠端系統能夠為該 LUN 提供 IO 服務。</block>
  <block id="7388404ef116c3ff812bfd290b094d9e" category="section-title">容錯移轉</block>
  <block id="997dfe060d2107e84407cfb41e692c54" category="paragraph">容錯移轉會導致遠端複本變成使用中複本。路徑會從「 Active 」變更為「 Active/Optimized 」、 IO 也會持續提供服務、不會遺失資料。</block>
  <block id="0493d27e20d11e356e53e0a730b0ad08" category="section-title">修復</block>
  <block id="6d80a3efb80520f47b63dc279e1bea3d" category="section-title">容錯回復</block>
  <block id="d47f47372b9b94d274cceb3638b28845" category="paragraph">如果需要、管理員可以執行容錯回復、並將 LUN 的作用中複本移回原始控制器。</block>
  <block id="0c99cedb6f39d8ac16d5b4c01c162c23" category="paragraph">資料庫重做 / 交易記錄通常會產生未對齊的 I/O 、導致 ONTAP 上未對齊 LUN 的錯誤警告。</block>
  <block id="b2f7bb8e75b21ee3e883141c6ac1defe" category="paragraph">記錄會以不同大小的寫入方式、連續寫入記錄檔。不符合 4KB 界限的記錄寫入作業通常不會造成效能問題、因為下一個記錄寫入作業會完成區塊。結果是 ONTAP 幾乎能將所有寫入作業視為完整的 4KB 區塊來處理、即使某些 4KB 區塊中的資料是以兩個不同的作業來寫入。</block>
  <block id="0e635e1f8ffad809203304cf41ed45c4" category="inline-link-macro">WAFL 對齊驗證</block>
  <block id="bf837d24f10c904e697e3c0092da43b9" category="paragraph">使用公用程式（例如）來驗證對齊<block ref="40883add63f1fbabc7fe6158f93c1246" prefix=" " category="inline-code"></block> 或<block ref="1aabac6d068eef6a7bad3fdf50a05cc8" prefix=" " category="inline-code"></block> 可在定義的區塊大小下產生 I/O 。您可以使用檢視儲存系統上的 I/O 對齊統計資料<block ref="446501053769c06c565094b26d26e8ef" prefix=" " category="inline-code"></block> 命令。請參閱 <block ref="ebccec7997af507c87f985ec4ccec634" category="inline-link-macro-rx"></block> 以取得更多資訊。</block>
  <block id="b5ffbfb0c082804ad41d0f61c87525ed" category="paragraph">許多應用程式資料集都是按日期組織、而且隨著時間的演進、存取這些資料的可能性通常會越來越小。例如、某家銀行可能會有包含五年客戶對帳單的 PDF 檔案儲存庫、但只有最近幾個月是有效的。FabricPool 可用於將較舊的資料檔案重新放置到容量層。14 天的冷卻期可確保最近 14 天的 PDF 檔案仍保留在效能層級上。此外、至少每 14 天讀取一次的檔案仍會很熱、因此會保留在效能層級上。</block>
  <block id="ed7e2cc7ff107d4b2032fe65cf4e756a" category="paragraph">若要實作檔案型分層方法、您必須有已寫入且未隨後修改的檔案。。<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 原則應該設定得足夠高、以便您可能需要的檔案保留在效能層。例如、需要最近 60 天資料的資料集、且需要設定最佳效能<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 期間為 60 。也可以根據檔案存取模式來達成類似的結果。例如、如果需要最近 90 天的資料、而應用程式正在存取該 90 天的資料範圍、則資料會保留在效能層。設定<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 期間為 2 、資料變少後、系統會提示您分層。</block>
  <block id="8a467b35326e4738b1bd39865c3b21a0" category="admonition">任何類型的資料存取都會重設熱圖資料。病毒掃描、索引甚至是讀取來源檔案的備份活動、都會因為必要而防止分層<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 從未達到臨界值。</block>
  <block id="7a1920d61156abc05a60135aefe8bc67" category="doc">預設</block>
  <block id="5ba46d288640832c345e169b04a7458a" category="paragraph">所有 FabricPool 磁碟區的初始設定為<block ref="c21f969b5f03d33d43e04f8f136e7682" prefix=" " category="inline-code"></block>這表示行為是由「雲端擷取原則」所控制。「確切的行為取決於所使用的分層原則。</block>
  <block id="d556a0d2cad80695d1d803ebb49de9cd" category="section-title">讀取中</block>
  <block id="7c39eb141ca855e5a211b468bd67636c" category="paragraph">設定<block ref="d253e682212338dd6cbe577947f0511e" prefix=" " category="inline-code"></block> 對讀取會覆寫預設行為、因此讀取任何階層資料會導致資料傳回效能層。</block>
  <block id="e07df43ea07fecb178484ef278644eb2" category="paragraph">例如、在的下、一個 Volume 可能已被輕度使用了很長時間<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 分層原則和大多數區塊現在都是分層的。</block>
  <block id="98c8614a9e0467f220df33a02cf7550a" category="paragraph">如果業務發生非預期的變更、需要重複掃描部分資料以準備特定報告、則可能需要變更<block ref="d253e682212338dd6cbe577947f0511e" prefix=" " category="inline-code"></block> 至<block ref="0ba0dc933ac714a0bef4467360437336" prefix=" " category="inline-code"></block> 確保讀取的所有資料都會傳回效能層、包括依序和隨機讀取資料。這將改善連續 I/O 相對於磁碟區的效能。</block>
  <block id="3ea4ba4aadef21fbda74c9b242c99efa" category="section-title">推廣</block>
  <block id="cb674c0cbcbaa23bdd3c8e4f6182f865" category="paragraph">升級原則的行為取決於分層原則。如果分層原則是<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block>、然後設定<block ref="723c2b1883eb9949dd821267c2d1b5c7" prefix=" " category="inline-code"></block> 在下一次分層掃描時、從容量層移回所有區塊。</block>
  <block id="452d85cc34fd3a4cf55ac61e732239f4" category="paragraph">如果分層原則是<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block>，則只會傳回與作用中檔案系統相關聯的區塊。通常這不會有任何影響、因為唯一的區塊會在底下分層<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 原則將是與快照完全相關的區塊。作用中檔案系統中不會有階層式區塊。</block>
  <block id="d6269fb1a970b6c261fedbc79464b3dc" category="paragraph">然而、如果磁碟區上的資料是由 Volume SnapRestore 或快照的檔案複製作業還原、則目前使用中檔案系統可能需要一些因為只與快照相關而分層的區塊。您可能需要暫時變更<block ref="d253e682212338dd6cbe577947f0511e" prefix=" " category="inline-code"></block> 原則目標<block ref="eeefc0add5ccd6e20ac4214923d27fbc" prefix=" " category="inline-code"></block> 快速擷取所有本機需要的區塊。</block>
  <block id="6e7b34fa59e1bd229b207892956dc41c" category="section-title">永不</block>
  <block id="c45e30a0f86af155e2feb17dd7ba6e44" category="paragraph">請勿從容量層擷取區塊。</block>
  <block id="2d242bb36ec91b32005f9296ff03a912" category="doc">架構</block>
  <block id="ac30d4a74ecef302adab70e9669a4bf2" category="paragraph">FabricPool 是一項分層技術、將區塊歸類為熱區塊或冷卻區塊、並將其置於最適當的儲存層。效能層最常位於 SSD 儲存設備上、並裝載熱資料區塊。容量層位於物件存放區、並裝載 Cool 資料區塊。物件儲存支援包括 NetApp StorageGRID 、 ONTAP S3 、 Microsoft Azure Blob 儲存設備、 Alibaba 雲端物件儲存服務、 IBM 雲端物件儲存設備、 Google 雲端儲存設備和 Amazon AWS S3 。</block>
  <block id="f9f5fe2f7456d37c955f3291744c93b6" category="paragraph">有多個分層原則可供使用、可控制區塊如何分類為熱或冷區、並可針對每個磁碟區設定原則、並視需要進行變更。只有資料區塊會在效能層和容量層之間移動。定義 LUN 和檔案系統結構的中繼資料一律保留在效能層上。因此、管理作業會集中在 ONTAP 上。檔案和 LUN 與儲存在任何其他 ONTAP 組態上的資料並無不同。NetApp AFF 或 FAS 控制器會套用定義的原則、將資料移至適當的層級。</block>
  <block id="616ce0475334fe37834d13972a168ca5" category="section-title">物件存放區提供者</block>
  <block id="71e79501cc067e6b35ac3d3e97c940a4" category="paragraph">物件儲存傳輸協定使用簡單的 HTTP 或 HTTPS 要求來儲存大量的資料物件。物件儲存設備的存取必須可靠、因為 ONTAP 的資料存取取決於要求的即時服務。選項包括 Amazon S3 Standard 和 In常用 存取選項、以及 Microsoft Azure Hot 和 Cool Blob Storage 、 IBM Cloud 和 Google Cloud 。不支援 Amazon Glacier 和 Amazon Archive 等歸檔選項、因為擷取資料所需的時間可能超過主機作業系統和應用程式的容許值。</block>
  <block id="e114e830308285cd9085063fad91662c" category="paragraph">NetApp StorageGRID 也受到支援、是最佳的企業級解決方案。它是高效能、可擴充且高度安全的物件儲存系統、可為 FabricPool 資料及其他物件儲存應用程式提供地理上的備援、這些應用程式越來越可能成為企業應用程式環境的一部分。</block>
  <block id="fb318c5cd9ed18c79e1f7a298dd96665" category="paragraph">StorageGRID 也能避免許多公有雲供應商為了從服務讀取資料而收取的出口費用、進而降低成本。</block>
  <block id="119d8a1213b5b7cae4bb567153b028cf" category="section-title">資料與中繼資料</block>
  <block id="b59d6123a3191bd85fe14e57b7a01e11" category="paragraph">請注意、此處的「資料」一詞適用於實際的資料區塊、而非中繼資料。只有資料區塊是階層式的、而中繼資料則保留在效能層級中。此外、只有讀取實際的資料區塊、才能影響區塊的「熱」或「冷」狀態。只要讀取檔案的名稱、時間戳記或所有權中繼資料、就不會影響基礎資料區塊的位置。</block>
  <block id="1414cdc093d39dd56d0b0d20049e17fc" category="section-title">備份</block>
  <block id="e0b766a7a0a7633679ecddd0f78a7390" category="paragraph">雖然 FabricPool 可以大幅減少儲存佔用空間、但它本身並不是備份解決方案。NetApp WAFL 中繼資料一律保持在效能層級。如果災難性災難破壞效能層、則無法使用容量層上的資料來建立新環境、因為該環境不包含 WAFL 中繼資料。</block>
  <block id="7a25ce12890e524732cb71784b5915ab" category="paragraph">不過、 FabricPool 可以成為備份策略的一部分。例如、 FabricPool 可以使用 NetApp SnapMirror 複寫技術進行設定。每一半的鏡像都可以有自己與物件儲存目標的連線。結果是兩個資料的複本。主要複本包含效能層上的區塊、以及容量層中的相關區塊、而複本則是第二組效能和容量區塊。</block>
  <block id="82af841589057aa8922b1ac3bb4a28a4" category="doc">壓縮</block>
  <block id="e242ff0701d9ed7d8317b32fd762a100" category="paragraph">空間效率功能（例如壓縮、壓縮和重複資料刪除）的設計、是為了增加符合特定實體儲存量的邏輯資料量。結果是降低成本和管理成本。</block>
  <block id="13b992c3d358d786db03341886472c4f" category="paragraph">在高層級、壓縮是一種數學程序、可偵測及編碼資料模式、以減少空間需求。相反地、重複資料刪除功能會偵測實際重複的資料區塊、並移除額外的複本。資料實作可讓多個邏輯區塊在媒體上共用相同的實體區塊。</block>
  <block id="786d7cc1b18aa3d9c3e8d3e30865240e" category="paragraph">在提供 All Flash 儲存系統之前、以陣列為基礎的壓縮價值有限、因為大多數 I/O 密集的工作負載都需要大量磁碟來提供可接受的效能。儲存系統的容量總是比所需的容量大得多、這是大量磁碟機的副作用。固態儲存設備的興起、改變了這種情況。不再需要純粹為了獲得良好效能而大幅過度配置磁碟機。儲存系統中的磁碟機空間可與實際容量需求相符。</block>
  <block id="b207c460d31fea9e1cfab71057e8152c" category="paragraph">固態硬碟機（ SSD ）的 IOPS 容量增加、幾乎總是比旋轉硬碟機節省成本、但壓縮技術可以增加固態媒體的有效容量、進而進一步節省成本。</block>
  <block id="6296c8b7406b90d37edf269f1ea6f6ee" category="section-title">自適應壓縮</block>
  <block id="1245fef302b5da2c27766d9a98ad358c" category="paragraph">即使在以微秒為單位測量延遲的 All Flash 環境中、主動式壓縮也已針對企業工作負載進行徹底測試、且未對效能產生任何影響。有些客戶甚至報告使用壓縮技術時效能會提高、因為資料會保持在快取中的壓縮、有效增加控制器中可用的快取數量。</block>
  <block id="93e0a644c8f1b7f7f378bc071d15d1e9" category="paragraph">ONTAP 以 4KB 單位管理實體區塊。自適應壓縮使用 8KB 的預設壓縮區塊大小、也就是以 8KB 為單位壓縮資料。這與關係式資料庫最常使用的 8KB 區塊大小相符。隨著將更多資料壓縮成單一單元、壓縮演算法就會變得更有效率。32 KB 壓縮區塊大小比 8 KB 壓縮區塊單元更具空間效率。這表示使用預設 8KB 區塊大小的調適式壓縮確實會導致效率稍微降低、但使用較小的壓縮區塊大小也有很大的好處。資料庫工作負載包括大量的覆寫活動。若要覆寫 32 KB 壓縮資料區塊的 8KB 資料、必須讀回整個 32 KB 的邏輯資料、將其解壓縮、更新所需的 8 KB 區域、重新壓縮、然後將整個 32 KB 寫入磁碟機。這對儲存系統來說是非常昂貴的作業、也是因為某些競爭儲存陣列以較大的壓縮區塊大小為基礎、也會對資料庫工作負載造成重大效能損失的原因。</block>
  <block id="1f9367b7afff301ee24188d35050ae0a" category="section-title">對溫度敏感的儲存效率</block>
  <block id="02e44d620def629a6c145ccd0d9a0fd3" category="section-title">壓縮對齊</block>
  <block id="3b6e6c232a02ab9c64199eb9efae012c" category="paragraph">資料庫環境中的調適性壓縮需要考量壓縮區塊對齊。這樣做只是對隨機覆寫非常特定區塊的資料的考量。這種方法的概念與整體檔案系統對齊方式類似、檔案系統的開始必須與 4K 裝置邊界對齊、檔案系統的區塊大小必須是 4K 的倍數。</block>
  <block id="1d1a594959ec615f56516f5d0f5e8ddb" category="section-title">NFS</block>
  <block id="62a0282d39568be094470486eaf70c4f" category="section-title">SAN</block>
  <block id="14c3c56ff2a98d1a9c47b63a917f67a3" category="section-title">資料壓縮</block>
  <block id="0b01f66d49b9df153ee76048de44f6eb" category="paragraph">資料壓縮的運作方式是允許將多個邏輯區塊儲存在實體區塊內。例如、含有高度壓縮資料（例如文字或部分完整區塊）的資料庫、可能會從 8KB 壓縮至 1KB 。如果沒有壓縮、 1KB 的資料仍會佔用整個 4KB 區塊。即時資料壓縮功能可將 1KB 的壓縮資料與其他壓縮資料一起儲存在 1KB 的實體空間中。這不是一項壓縮技術、只是在磁碟機上分配空間的一種更有效率的方法、因此不應產生任何可偵測的效能影響。</block>
  <block id="83f45cad5e6f535ff10e564a526baad0" category="section-title">重複資料刪除</block>
  <block id="f591ef30da06841378ee7f595e63a93c" category="paragraph">重複資料刪除是從資料集移除重複的區塊大小。例如、如果 10 個不同的檔案中存在相同的 4KB 區塊、重複資料刪除會將所有 10 個檔案中的 4KB 區塊重新導向至相同的 4KB 實體區塊。結果是該資料的效率提升 10 ： 1 。</block>
  <block id="699c85c5df1985b2af588f9e6c1ad353" category="paragraph">VMware 來賓開機 LUN 等資料通常會極好地刪除重複資料、因為這些資料包含相同作業系統檔案的多個複本。效率達到 100 ： 1 以上。</block>
  <block id="9653a3d4907877aae00bb7d39eeec66d" category="paragraph">在某些情況下、使用 16KB 和大型區塊大小的資料庫可節省高達 15% 的空間。每個區塊的初始 4KB 包含全域唯一的標頭、最後 4KB 區塊則包含近乎獨特的標尾。內部區塊是重複資料刪除的候選項目、但實際上、這幾乎完全歸功於重複資料刪除零位資料。</block>
  <block id="32aeb47267cb2045610b468115f3ae0e" category="section-title">效率與精簡配置</block>
  <block id="3381946611f34fb44ad8a38a0c44e0a8" category="paragraph">效率功能是精簡配置的形式。例如、佔用 100GB 磁碟區的 100GB LUN 可能會壓縮至 50GB 。由於磁碟區仍為 100GB 、因此尚未實現實際節省。必須先縮小磁碟區的大小、才能將儲存的空間用於系統的其他位置。如果稍後變更為 100GB LUN 、則資料的壓縮性會降低、 LUN 的大小會增加、而且磁碟區可能會填滿。</block>
  <block id="38ef8b6f2fc332958c293d93c61d7756" category="paragraph">有些客戶偏好針對特定工作負載使用完整資源配置、或是根據既定的營運和採購實務做法。</block>
  <block id="0e7c78164adb6d4650ea685a79d8e99e" category="section-title">效率最佳實務做法</block>
  <block id="ec499ad25fa5a765ba43ec2c87819623" category="section-title">AFF 預設值</block>
  <block id="9f7127e69d50bf7b844ff3723b86fbd1" category="section-title">一般建議</block>
  <block id="4922fe547c351d6a121465da036d478e" category="list-text">如果資料不需要覆寫、例如備份或資料庫交易記錄檔、您可以在冷卻週期較短的情況下啟用 TSSE 、以達到更高的效率。</block>
  <block id="e75fd383e4106eb78482b18896975daf" category="list-text">某些檔案可能包含大量不可壓縮的資料、例如、當檔案的應用程式層級已啟用壓縮時、就會進行加密。如果上述任何情況屬實、請考慮停用壓縮、以便在包含可壓縮資料的其他磁碟區上執行更有效率的作業。</block>
  <block id="64d5def835c194cac8afe4fafded756e" category="doc">原則 - 本機快照</block>
  <block id="baa596d0db91317fa83739a95649752e" category="paragraph">FabricPool 的初始版本以備份使用案例為目標。唯一可以分層的區塊類型是不再與作用中檔案系統中的資料相關聯的區塊。因此、只能將快照資料區塊移至容量層。當您需要確保效能不受影響時、這仍然是最安全的分層選項之一。</block>
  <block id="b21eb7f0b67c3e27e915183638bf92cf" category="paragraph">有兩個選項可將非作用中的快照區塊分層到容量層。首先<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 原則僅針對快照區塊。儘管如此<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 原則包括<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 區塊、也會將區塊分層、從作用中的檔案系統中移出。這可能不理想。</block>
  <block id="eeba990304f236b36a9fec2434c77470" category="paragraph">。<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 值應設為時間週期、以便在效能層上提供還原期間所需的資料。例如、重要正式作業資料庫的大多數還原案例、都會在過去幾天的某個時間加入還原點。設定 A<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 值 3 可確保檔案的任何還原都會產生可立即提供最大效能的檔案。作用中檔案中的所有區塊仍會顯示在快速儲存設備上、而無需從容量層恢復。</block>
  <block id="baf531ed01ad56f5614e1a68e8a2e7aa" category="section-title">原則 - 複寫的快照</block>
  <block id="27e5121a4c75181022e7be2b738339d0" category="paragraph">使用 SnapMirror 或 SnapVault 複寫的僅用於恢復的快照通常應使用 FabricPool<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 原則。使用此原則、會複寫中繼資料、但所有資料區塊都會立即傳送至容量層、以獲得最大效能。大部分的恢復程序都涉及循序 I/O 、這是固有的效率。應該評估物件存放區目的地的恢復時間、但在設計完善的架構中、此恢復程序不需要比從本機資料恢復慢很多。</block>
  <block id="639e481de0ffe002bd83251b26a2540a" category="paragraph">如果複製的資料也要用於複製、則會使用<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 原則比較適當、請使用<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 包含預期在複製環境中經常使用的資料的值。例如、資料庫的作用中工作集可能包含前三天讀取或寫入的資料、但也可能包含另外 6 個月的歷史資料。如果是、則是<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> SnapMirror 目的地的原則可讓工作集在效能層上使用。</block>
  <block id="ace0bd0c1be3a9e17d9736d93e7a1da2" category="doc">IOPS QoS</block>
  <block id="786ee59e0cdaa09335e12fea3a168653" category="paragraph">具體而言、由於採用 All Flash 儲存設備的情況增加、因此能夠整合工作負載。依賴旋轉媒體的儲存陣列往往只支援有限數量的 I/O 密集工作負載、因為舊版旋轉式磁碟機技術的 IOPS 功能有限。一或兩個高作用中的資料庫會在儲存控制器達到限制之前、使基礎磁碟機飽和。這種情況已經改變。即使是功能最強大的儲存控制器、相對少數 SSD 磁碟機的效能也能達到飽和。這意味著控制器的完整功能可以充分發揮、而不會因為旋轉媒體延遲尖峰而突然降低效能。</block>
  <block id="270d79669200ef485add1ecc1833cc94" category="paragraph">舉例來說、簡單的雙節點 HA AFF A800 系統能夠在延遲超過 1 毫秒之前、提供高達 100 萬次的隨機 IOPS 服務。只有很少單一工作負載會達到這類層級。充分利用此 AFF A800 系統陣列、將需要託管多個工作負載、同時確保可預測性、這需要 QoS 控制。</block>
  <block id="4dca0c3547523a2e5bd1b8d0e2ff8de5" category="paragraph">ONTAP 中有兩種服務品質（ QoS ）： IOPS 和頻寬。QoS 控制可套用至 SVM 、磁碟區、 LUN 和檔案。</block>
  <block id="3ea539ed2021ba46a3658039e8af419f" category="paragraph">IOPS QoS 控制顯然是以指定資源的 IOPS 總計為基礎、但 IOPS QoS 的許多層面可能並不符合直覺。剛開始有幾位客戶對於達到 IOPS 臨界值時、延遲明顯增加感到困惑。延遲增加是限制 IOPS 的自然結果。從邏輯上講、它的運作方式與權杖系統類似。例如、如果包含資料檔案的特定磁碟區有 10K IOPS 限制、則每個到達的 I/O 都必須先接收權杖才能繼續處理。只要在指定的秒數內使用的權杖不超過 10K 、就不會有延遲。如果 IO 作業必須等待接收其權杖、則此等待會顯示為額外延遲。工作負載相對於 QoS 限制的推動越大、每個 IO 在佇列中等待處理的時間就越長、使用者認為延遲越高。</block>
  <block id="34a96885dd7f4501920b13026e7f2cab" category="admonition">將 QoS 控制套用至資料庫交易 / 重做記錄資料時、請務必謹慎。雖然重做記錄的效能需求通常比資料檔案低很多、但重做記錄活動卻很繁瑣。IO 會以簡短的脈衝形式發生、而顯示適合平均重做 IO 層級的 QoS 限制、對於實際需求而言可能太低。結果可能會造成嚴重的效能限制、因為每次重做記錄突增時、 QoS 都會啟動。一般而言、重作和歸檔記錄不應受到 QoS 的限制。</block>
  <block id="c79dc76371299e08f4b4ebd609314ca4" category="section-title">頻寬 QoS</block>
  <block id="b9d5c520039715de9b997c5a69f4aeaa" category="paragraph">並非所有 I/O 大小都相同。例如、資料庫可能會執行大量的小區塊讀取、導致達到 IOPS 臨界值、 但資料庫也可能執行完整的資料表掃描作業、這項作業會由極少數的大量區塊讀取所組成、佔用大量頻寬、但 IOPS 相對較少。</block>
  <block id="4930ae83bb8dd5e539dc9f7e73c6d74c" category="paragraph">同樣地、 VMware 環境在開機期間可能會產生極高的隨機 IOPS 、但在外部備份期間執行的 IO 會較少、但會較大。</block>
  <block id="eabb5a523a77d4521c12622ee9388aa6" category="paragraph">有時有效管理效能需要 IOPS 或頻寬 QoS 限制、甚至兩者都需要。</block>
  <block id="13dac55a5f26cefab26368ea5a67e29f" category="section-title">最低 / 保證的 QoS</block>
  <block id="68559688130772c84bb39b2a9ca2c2af" category="paragraph">許多客戶尋求的解決方案都包含保證的 QoS 、這比看起來更難達成、而且可能相當浪費。例如、如果要放置 10 個具有 10K IOPS 保證的資料庫、就必須針對所有 10 個資料庫同時以 10K IOPS 執行的情況來調整系統規模、總共需要 10 萬個。</block>
  <block id="c0938f706c890ea85c86388391ffad22" category="paragraph">最適合用於最低 QoS 控制的是保護關鍵工作負載。例如、假設 ONTAP 控制器的 IOPS 最高可達 50 萬、同時混合了生產與開發工作負載。您應該將 QoS 原則上限套用至開發工作負載、以防止任何指定的資料庫壟斷控制器。然後、您可以將最低 QoS 原則套用至正式作業工作負載、以確保它們在需要時隨時都能使用所需的 IOPS 。</block>
  <block id="acdda1c20fb3985ce840929f7525c803" category="section-title">調適性QoS</block>
  <block id="dd5bc58ed6ab031b170a409470d9a763" category="paragraph">調適性 QoS 是指 ONTAP 功能、其中 QoS 限制是根據儲存物件的容量而定。它很少用於資料庫、因為資料庫的大小與其效能需求之間通常沒有任何連結。大型資料庫可能幾乎無法運作、而較小的資料庫則可能是 IOPS 最密集的資料庫。</block>
  <block id="eb595833577352045f92d14ac4315ad2" category="paragraph">Adaptive QoS 對於虛擬化資料存放區非常有用、因為這類資料集的 IOPS 需求往往與資料庫的總大小相關。較新的資料存放區包含 1TB 的 VMDK 檔案、可能需要的效能約為 2TB 資料存放區的一半。Adaptive QoS 可讓您在資料存放區填入資料時、自動增加 QoS 限制。</block>
  <block id="23f3d415bb4fe6f99165df604b24da0e" category="paragraph">使用 FabricPool 分層資料集會導致主要儲存陣列與物件存放區層之間的相依性。有許多物件儲存選項可提供不同層級的可用度。請務必瞭解主要儲存陣列與物件儲存層之間可能中斷連線的影響。</block>
  <block id="7e856c11a853d276fd5d6274bf60fafd" category="paragraph">如果發給 ONTAP 的 I/O 需要容量層的資料、而 ONTAP 無法到達容量層來擷取區塊、則 I/O 最終會逾時。此逾時的影響取決於所使用的傳輸協定。在 NFS 環境中、 ONTAP 會根據傳輸協定回應 EJUKEBOX 或 EDELAY 回應。有些較舊的作業系統可能會將此視為錯誤、但 Oracle Direct NFS 用戶端目前的作業系統和修補程式層級會將此視為可重試的錯誤、並繼續等待 I/O 完成。</block>
  <block id="207d9fe0f57910936bfa043248f3afca" category="paragraph">較短的逾時時間適用於 SAN 環境。如果需要物件存放區環境中的區塊、而且無法連線兩分鐘、則會將讀取錯誤傳回主機。ONTAP 磁碟區和 LUN 保持連線、但主機作業系統可能會將檔案系統標示為處於錯誤狀態。</block>
  <block id="c9251835da8df507ca4f6ce02d4216be" category="paragraph">物件儲存連線問題<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 由於只有備份資料是階層式的、因此原則並不令人擔心。通訊問題會拖慢資料恢復速度、但不會影響使用中的資料。。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 和<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 原則允許從作用中 LUN 分層處理冷資料、這表示物件儲存區資料擷取期間發生的錯誤可能會影響資料庫可用度。採用這些原則的 SAN 部署只能搭配專為高可用度所設計的企業級物件儲存設備和網路連線使用。NetApp StorageGRID 是絕佳的選擇。</block>
  <block id="0f8062f9220efe4f38e7236fe8885379" category="paragraph">大部分的關聯式資料庫都是以交易記錄歸檔模式運作、以提供時間點還原。對資料庫所做的變更會記錄交易記錄中的變更、並保留交易記錄而不會被覆寫。結果可能需要保留大量歸檔的交易記錄檔。許多其他應用程式工作流程也有類似的例子、這些工作流程會產生必須保留的資料、但很難存取。</block>
  <block id="229384bbfb1db19c4897d87ba4b9bc2d" category="paragraph">FabricPool 透過提供整合式分層的單一解決方案來解決這些問題。檔案會儲存並保留在其一般位置、但實際上不會佔用主要陣列上的任何空間。</block>
  <block id="f60aec7aaed8420e09f17a8cfd1d7d37" category="paragraph">使用<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 幾天的原則會導致在效能層上保留最近建立的檔案（近期最可能需要的檔案）中的區塊。之後、舊檔案的資料區塊會移至容量層。</block>
  <block id="485e24df9e0ebeecf416daa6e5441bba" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 無論主要檔案系統中的記錄是否已刪除或繼續存在、都會在達到冷卻臨界值時強制執行提示分層。將所有可能需要的記錄儲存在作用中檔案系統的單一位置、也能簡化管理。沒有理由搜尋快照以找出需要還原的檔案。</block>
  <block id="bbe0132696bc482e0ba7a1f293d80083" category="paragraph">某些應用程式（例如 Microsoft SQL Server ）會在備份作業期間截斷交易記錄檔、使記錄不再位於作用中的檔案系統中。使用可節省容量<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 分層原則、但<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 原則對記錄資料並不實用、因為作用中檔案系統中應該很少會冷卻記錄資料。</block>
  <block id="0694b4972669f201ca85f9427a230208" category="doc">MetroCluster 可在 3 種不同組態中使用</block>
  <block id="948676ffa8073153cbe404795950ad85" category="list-text">HA 可與 IP 連線配對</block>
  <block id="ef012b81fd45a95681a584a59f8df77e" category="list-text">HA 可與 FC 連線配對</block>
  <block id="6ffec869ba36dff4e093b5ed8bac798a" category="list-text">單一控制器、具備 FC 連線能力</block>
  <block id="4767099b22895a8101a1cba45d8cf6e9" category="section-title">知識產權MetroCluster</block>
  <block id="adc397d87c1a7827f2df9fdd362d5ff7" category="paragraph">HA 配對 MetroCluster IP 組態每個站台使用兩或四個節點。此組態選項可增加與雙節點選項相關的複雜度和成本、但它提供重要的優點：站台內備援。簡單的控制器故障不需要透過 WAN 存取資料。透過替代本機控制器、資料存取仍保持在本機狀態。</block>
  <block id="c15560f2ae5432223c591c5f5d9db5c1" category="paragraph">大多數客戶都選擇 IP 連線、因為基礎架構需求較為簡單。過去、高速跨站台連線通常較容易使用深色光纖和 FC 交換器進行配置、但如今、高速、低延遲的 IP 電路更容易使用。</block>
  <block id="b28c5a429800ea9669a191a402a72b49" category="paragraph">由於唯一的跨站台連線適用於控制器、因此架構也更簡單。在 FC SAN 附加 MetroCluster 中、控制器會直接寫入另一個站台上的磁碟機、因此需要額外的 SAN 連線、交換器和橋接器。相反地、 IP 組態中的控制器會透過控制器寫入相對的磁碟機。</block>
  <block id="457b0075e8f0333975a8e2aaeaceb149" category="inline-link">SIP解決方案架構與設計MetroCluster</block>
  <block id="82aa44c8aa5ebe78f1496c8fc80cb954" category="paragraph">如需其他資訊、請參閱 ONTAP 正式文件和<block ref="03a3c76178d2d43147a2756857a0985e" category="inline-link-rx"></block>。</block>
  <block id="0d2d438a72f6c558744351265fa49a62" category="section-title">HA 配對 FC SAN 附加 MetroCluster</block>
  <block id="3e9133ff590581b29a911d9631ab1737" category="paragraph">HA 配對 MetroCluster FC 組態每個站台使用兩個或四個節點。此組態選項可增加與雙節點選項相關的複雜度和成本、但它提供重要的優點：站台內備援。簡單的控制器故障不需要透過 WAN 存取資料。透過替代本機控制器、資料存取仍保持在本機狀態。</block>
  <block id="4bc2926f030255369db3e4435de5c774" category="paragraph">有些多站台基礎架構並非設計用於主動式作業、而是更多用於主要站台和災難恢復站台。在這種情況下、 HA 配對 MetroCluster 選項通常較為理想、原因如下：</block>
  <block id="5f49f48dd22b405a813e2ef7cc02e9f8" category="list-text">雖然雙節點 MetroCluster 叢集是 HA 系統、但控制器意外故障或規劃的維護作業需要資料服務必須在相反的站台上線。如果站台之間的網路連線能力不支援所需的頻寬、效能就會受到影響。唯一的選項是將各種主機作業系統和相關服務容錯移轉至替代站台。HA 配對 MetroCluster 叢集可消除此問題、因為遺失控制器會導致同一個站台內的簡單容錯移轉。</block>
  <block id="0ce798a4f2e77d6aa1a6e0d718fa8e98" category="list-text">有些網路拓撲並非設計用於跨站台存取、而是使用不同的子網路或隔離的 FC SAN 。在這種情況下、雙節點 MetroCluster 叢集不再作為 HA 系統運作、因為替代控制器無法將資料提供給位於相反站台的伺服器。HA 配對 MetroCluster 選項是提供完整備援的必要條件。</block>
  <block id="098fa44ef37572e0f8ea717199ac72e6" category="list-text">如果將雙站台基礎架構視為單一的高可用度基礎架構、則雙節點 MetroCluster 組態很適合。不過、如果系統在站台故障後必須長時間運作、則最好使用 HA 配對、因為它會繼續在單一站台內提供 HA 。</block>
  <block id="ea8bb3e5a357ca97851352f6944342c9" category="section-title">雙節點 FC SAN 附加 MetroCluster</block>
  <block id="b759079fef92c80eca80e7349bf84363" category="paragraph">雙節點 MetroCluster 組態每個站台僅使用一個節點。此設計比 HA 配對選項簡單、因為要設定和維護的元件較少。此外、它也降低了佈線和 FC 交換方面的基礎架構需求。最後、它能降低成本。</block>
  <block id="bcf549481eb36a62594e938bca6a10bb" category="paragraph">這項設計的明顯影響是、控制器在單一站台上故障、表示資料可從另一個站台取得。這種限制不一定是個問題。許多企業都有多站台資料中心作業、並有延伸、高速、低延遲的網路、基本上是一個基礎架構。在這些情況下、 MetroCluster 的雙節點版本是慣用的組態。多家服務供應商目前以 PB 規模使用雙節點系統。</block>
  <block id="78558542e724655ba80fc4879399f103" category="section-title">MetroCluster 恢復功能</block>
  <block id="5427d2eb91f25a425f13544e56fb12c4" category="paragraph">MetroCluster 解決方案沒有單點故障：</block>
  <block id="6a988bf07e73bcbf69f62ce9724dd0f3" category="list-text">每個控制器都有兩條通往本機站台磁碟櫃的路徑。</block>
  <block id="2c98a75e02c6e103b43724f02e99e393" category="list-text">每個控制器都有兩條通往遠端站台磁碟機櫃的路徑。</block>
  <block id="e18f703538cd1f5af3b9185eed57b49b" category="list-text">每個控制器都有兩條通往另一個站台上控制器的路徑。</block>
  <block id="800ec0ea85a62c2fb192ac2f79ee1d02" category="list-text">在 HA 配對組態中、每個控制器都有兩條路徑通往本機合作夥伴。</block>
  <block id="a3d7a569ad6ea771a0ad9b995619251b" category="paragraph">總而言之、您可以移除組態中的任何一個元件、而不會影響 MetroCluster 提供資料的能力。這兩個選項之間恢復能力的唯一差異是 HA 配對版本在站台故障後仍是整個 HA 儲存系統。</block>
  <block id="9b4c3976d453e66a3dd22e2793fc3a8e" category="doc">空間管理</block>
  <block id="e89d3732a2fbc592923c30e54522dcdb" category="paragraph">精簡配置有多種形式、是 ONTAP 為企業應用程式環境提供的許多功能不可或缺的一部分。精簡配置也與效率技術密切相關、原因相同：效率功能可儲存比儲存系統技術更多的邏輯資料。</block>
  <block id="537642ed3bfef7f2bb3e580b3b266bd3" category="paragraph">幾乎任何快照的使用都需要精簡配置。例如、 NetApp 儲存設備上的典型 10TB 資料庫、包含約 30 天的快照。這種配置可在作用中的檔案系統中看到大約 10TB 的資料、而在快照中則有 300TB 的資料。總儲存容量為 310TB 、通常位於大約 12TB 到 15TB 的空間上。作用中資料庫消耗 10TB 、而其餘 300TB 的資料僅需要 2TB 到 5TB 的空間、因為只會儲存對原始資料所做的變更。</block>
  <block id="a19609016ad1cb6b7bae7cac796a26a4" category="paragraph">複製也是精簡配置的範例。一位主要 NetApp 客戶建立 40 個 80 TB 資料庫的複本、供開發人員使用。如果使用這些複本的 40 位開發人員都在每個資料檔案中覆寫每個區塊、則需要超過 3.2PB 的儲存空間。實際上，週轉率較低，而且由於磁碟機上只儲存變更，因此集體空間需求接近 40 TB 。</block>
  <block id="2433af6347e4871be5af0f2af0f6bd6e" category="paragraph">由於資料變更率可能會意外增加、因此精簡配置應用程式環境時必須謹慎處理。例如、如果資料庫資料表重新編製索引、或是將大規模的修補套用至 VMware 來賓系統、快照所造成的空間使用量就會迅速增加。錯誤的備份可能會在很短的時間內寫入大量資料。最後、如果檔案系統在非預期的情況下用盡可用空間、可能很難恢復某些應用程式。</block>
  <block id="5cf4dc4d1ce52ff655ea7f1157a72e2e" category="paragraph">幸運的是、這些風險可以透過仔細設定來解決<block ref="f9e1f2ea1a2becbaf82dd54e55a12e6b" prefix=" " category="inline-code"></block> 和<block ref="24d554277b3513bb6cef3f0a336725a9" prefix=" " category="inline-code"></block> 原則。如同其名稱所暗示、這些選項可讓使用者建立原則、以自動清除快照佔用的空間、或是增加磁碟區以容納額外資料。有許多選項可供選擇、需求因客戶而異。</block>
  <block id="6a28738961e6f6e4b57e4dd70c446600" category="inline-link-macro">邏輯儲存管理文件</block>
  <block id="01570cb5a3aec2324ab56e318e1de04d" category="paragraph">請參閱 <block ref="e69bd75bdb49183ee90588843edb33f4" category="inline-link-macro-rx"></block> 以完整討論這些功能。</block>
  <block id="e10d46632bc86306cf4c22633ee930ab" category="paragraph">仔細規劃 LVM 組態可提高效率、並將儲存資源配置和 LUN 調整大小的需求降至最低。當使用 Veritas VxVM 或 Oracle ASM 等 LVM 時、基礎 LUN 會分割成僅在需要時才使用的範圍。例如、如果資料集的大小從 2TB 開始、但隨時間而成長至 10TB 、則此資料集可放置在配置在 LVM 磁碟群組中的 10TB 精簡配置 LUN 上。在建立時、它只會佔用 2TB 的空間、而且只會在分配範圍以容納資料成長時、才會要求額外的空間。只要監控空間、此程序就安全無虞。</block>
  <block id="66a41fd6fc38c454973e91d92cf0e291" category="section-title">部分保留</block>
  <block id="e8a206fe65814e0ea465e32487544751" category="paragraph">「部分保留」是指磁碟區中 LUN 在空間效率方面的行為。選項<block ref="c1acac5c4332e37ec1f281fcbaf0765a" prefix=" " category="inline-code"></block> 設為 100% 、磁碟區中的所有資料在任何資料模式下都能達到 100% 的營業額、而不會耗盡磁碟區上的空間。</block>
  <block id="a3cd28aef7d0becd57b60187fdc4a24e" category="paragraph">例如、假設資料庫位於 1TB 磁碟區中的單一 250GB LUN 上。建立快照將會立即在磁碟區中保留額外的 250GB 空間、以確保磁碟區不會因任何原因而用盡空間。使用分數保留通常是浪費、因為資料庫磁碟區中的每個位元組都不太可能需要覆寫。沒有理由為永遠不會發生的事件預留空間。不過、如果客戶無法監控儲存系統中的空間使用量、而且必須確定空間永遠不會用盡、則使用快照需要 100% 的部分保留。</block>
  <block id="e30fbe8981929fb070a820a213381bab" category="section-title">壓縮與重複資料刪除</block>
  <block id="1b6e4e9a2be031edc6f3da1f559ef884" category="paragraph">壓縮和重複資料刪除都是精簡配置的形式。例如、 50TB 的資料佔用空間可能會壓縮至 30TB 、因此可節省 20TB 。為了讓壓縮產生任何效益、其中某些 20TB 必須用於其他資料、或是儲存系統必須購買的容量低於 50TB 。因此、儲存的資料量比儲存系統技術上的資料量還多。從資料觀點來看、即使磁碟機僅佔用 30TB 、資料仍有 50TB 。</block>
  <block id="dbca4bb791f36eac2c11c32f73f2b4ec" category="paragraph">資料集的可壓縮性隨時都會變更、這會導致實際空間的使用量增加。這種使用量的增加意味著、在監控和使用方面、必須像其他形式的精簡配置一樣管理壓縮<block ref="f9e1f2ea1a2becbaf82dd54e55a12e6b" prefix=" " category="inline-code"></block> 和<block ref="24d554277b3513bb6cef3f0a336725a9" prefix=" " category="inline-code"></block>。</block>
  <block id="ad241666a88b5414e8c2fe6d1cc1edb0" category="paragraph">有關壓縮和重複資料刪除的詳細資訊、請參閱連結： efficiency.html 一節</block>
  <block id="8ecfcadfebb472a089481e8554ebed87" category="section-title">壓縮與部分保留</block>
  <block id="4f8fcc146d2e8e712dcd8c56b1684fcc" category="paragraph">壓縮是一種精簡配置形式。部分保留會影響壓縮的使用、並附有一個重要附註；在建立快照之前、會保留空間。通常、只有存在快照時、部分保留才會很重要。如果沒有快照、則部分保留並不重要。這不是壓縮的情況。如果在具有壓縮功能的磁碟區上建立 LUN 、 ONTAP 會保留空間以容納快照。在組態期間、這種行為可能會令人困惑、但這是預期的。</block>
  <block id="e26f8048b4bf60dad827c5a425271361" category="paragraph">舉例來說、請考慮使用 5GB LUN 的 10GB 磁碟區、該磁碟區已壓縮至 2.5GB 、但沒有快照。請考慮以下兩種情況：</block>
  <block id="ade18971a2dab7e37335e95d81da0ef1" category="list-text">分數保留 = 100 會導致 7.5 GB 使用率</block>
  <block id="1d07b8e7c92488a55301ea201328cf35" category="list-text">部分保留量 =0 會導致使用率為 2.5GB</block>
  <block id="aa410d0e46ec94b6efcf344f0d870c1a" category="paragraph">第一個案例包括目前資料使用 2.5 GB 的空間、以及 5 GB 的空間、可在預期使用快照時、讓來源的營業額達到 100% 。第二個案例不會保留額外空間。</block>
  <block id="e79414ad391b126cc9bd53af1624c8de" category="paragraph">雖然這種情況可能令人困惑、但實際上並不可能發生。壓縮意味著精簡配置、而 LUN 環境中的精簡配置則需要部分保留。壓縮資料永遠可以被無法壓縮的東西覆寫、這表示必須精簡配置磁碟區以進行壓縮、以節省任何成本。</block>
  <block id="499a10b92cb9ca6b3412d4bf5a91a2b0" category="paragraph">* NetApp 建議 * 下列保留組態：</block>
  <block id="7f26e875cee50c1b3baf71a014043794" category="list-text">設定<block ref="c1acac5c4332e37ec1f281fcbaf0765a" prefix=" " category="inline-code"></block> 與一起進行基本容量監控時為 0<block ref="f9e1f2ea1a2becbaf82dd54e55a12e6b" prefix=" " category="inline-code"></block> 和<block ref="24d554277b3513bb6cef3f0a336725a9" prefix=" " category="inline-code"></block>。</block>
  <block id="675996bd34ec0d8c134215f5be73fb3a" category="list-text">設定<block ref="c1acac5c4332e37ec1f281fcbaf0765a" prefix=" " category="inline-code"></block> 如果沒有監控能力、或在任何情況下都無法排放空間、則達到 100 。</block>
  <block id="8ee38535add58992c14b23a6f7cf8d27" category="doc">LIF 類型</block>
  <block id="50d034374ef68094a0f6c8e8d06a77af" category="inline-link-macro">ONTAP 網路管理文件</block>
  <block id="fc25025f3f0a2afd42465a55f35c02d0" category="paragraph">本節概述 LIF 的主要設計原則。如需更完整的文件、請參閱 <block ref="a3e6361e1a52d384f542a2f2d8bc9bb1" category="inline-link-macro-rx"></block>。與資料庫架構的其他層面一樣、儲存虛擬機器（ SVM 、在 CLI 稱為 vserver ）和邏輯介面（ LIF ）設計的最佳選項、在很大程度上取決於擴充需求和業務需求。</block>
  <block id="be0801f7fb241be642bec73b799d45cb" category="paragraph">建置 LIF 策略時、請考量下列主要主題：</block>
  <block id="362c2978dddcf6988ce266d3d60f5beb" category="list-text">* 效能。 * 網路頻寬是否足夠？</block>
  <block id="cfc88efb72b2c7ea83a4a3d68b760d55" category="list-text">* 恢復能力。 * 設計中是否有任何單點故障？</block>
  <block id="af02972fd4dc1e949d800731d9518812" category="list-text">* 管理能力。 * 網路是否能不中斷地擴充？</block>
  <block id="fdcbadc80d2dd31527cc91cf81fb725d" category="paragraph">這些主題適用於端點對端點解決方案、從主機到交換器、再到儲存系統。</block>
  <block id="f45fe079103703d0b315ff2e339728fd" category="inline-link-macro">LIF 類型的 ONTAP 文件</block>
  <block id="cc4583278db25277db9ddcd781cbf992" category="paragraph">有多種 LIF 類型。 <block ref="9d27879d9d2bd4f0f081ffed63159522" category="inline-link-macro-rx"></block> 提供更完整的本主題資訊、但從功能觀點來看、生命可分為下列群組：</block>
  <block id="f34a52d788c5a4cf56d7ae8ccb85f8c2" category="list-text">* 用於管理儲存叢集的叢集與節點管理生命期 * 。</block>
  <block id="73ac4e00a9ff3caf31e6df13a6df2f78" category="list-text">* SVM 管理階層。 * 允許透過 REST API 或 ONTAPI （也稱為 ZAPI ）存取 SVM 的介面、以執行快照建立或磁碟區調整大小等功能。SnapManager for Oracle （ SMO ）等產品必須能夠存取 SVM 管理 LIF 。</block>
  <block id="b7010e46f4769f638197aa230f448ba0" category="list-text">* 資料生命。 * FC 、 iSCSI 、 NVMe / FC 、 NVMe / TCP 、 NFS 、 或 SMB/CIFS 資料。</block>
  <block id="1eb4f53fa8ee8f0954514a1b9858bf6b" category="admonition">用於 NFS 流量的資料 LIF 也可透過變更防火牆原則來進行管理<block ref="8d777f385d3dfec8815d20f7496026dc" prefix=" " category="inline-code"></block> 至<block ref="d724f231a9a7b89757c4394d6622bc47" prefix=" " category="inline-code"></block> 或其他允許 HTTP 、 HTTPS 或 SSH 的原則。這項變更可避免每部主機的組態設定、以同時存取 NFS 資料 LIF 和個別的管理 LIF 、進而簡化網路組態。儘管這兩者都使用 IP 傳輸協定、但無法同時為 iSCSI 和管理流量設定介面。iSCSI 環境需要個別的管理 LIF 。</block>
  <block id="85d465743ad38be108b50648ab283d78" category="section-title">SAN LIF 設計</block>
  <block id="8800a54085e1b2987d83537423221cf9" category="paragraph">SAN 環境中的 LIF 設計相對簡單、原因有一：多重路徑。所有現代化的 SAN 實作均可讓用戶端透過多個、不受限制的網路路徑存取資料、並選擇最佳的存取路徑或路徑。因此、 LIF 設計的效能更容易因應、因為 SAN 用戶端會在最佳可用路徑之間自動平衡 I/O 負載。</block>
  <block id="e33c923a4d6280bf6f2b2a982ff74ee3" category="paragraph">如果路徑無法使用、用戶端會自動選取不同的路徑。因此設計簡易性讓 SAN 的工作更容易管理。這並不表示 SAN 環境總是更容易管理、因為 SAN 儲存設備還有許多其他層面比 NFS 複雜得多。這只是表示 SAN LIF 設計更簡單。</block>
  <block id="9446a98ad14416153cc4d45ab8b531bf" category="section-title">效能</block>
  <block id="141614e246b14131ec01a449d61ed657" category="paragraph">在 SAN 環境中、 LIF 效能的最重要考量是頻寬。例如、雙節點 ONTAP AFF 叢集每個節點有兩個 16GB FC 連接埠、可在每個節點之間提供高達 32GB 的頻寬。</block>
  <block id="02bc0523497de72834c4c7990e32d155" category="section-title">恢復能力</block>
  <block id="01b1d8276ca14813ff4804089a9ac082" category="paragraph">AFF 儲存系統上的 SAN Lifs 不會容錯移轉。如果 SAN LIF 因控制器容錯移轉而失敗、則用戶端的多重路徑軟體會偵測路徑遺失、並將 I/O 重新導向至不同的 LIF 。使用 ASA 儲存系統時、在短暫延遲後將會容錯移轉、但這不會中斷 IO 、因為其他控制器上已經有作用中的路徑。發生容錯移轉程序是為了在所有定義的連接埠上還原主機存取。</block>
  <block id="b7c94ef25c0629a65f8a1f6ce7014d95" category="section-title">管理能力</block>
  <block id="1325935a6fa0e88cfec45038005f18e3" category="paragraph">LIF 移轉是 NFS 環境中較常見的工作、因為 LIF 移轉通常與在叢集周圍重新放置磁碟區有關。當磁碟區移轉至 HA 配對內時、無需在 SAN 環境中移轉 LIF 。這是因為在磁碟區移動完成之後、 ONTAP 會傳送路徑變更通知給 SAN 、而 SAN 用戶端會自動重新最佳化。與 SAN 的 LIF 移轉主要與重大實體硬體變更有關。例如、如果需要不中斷營運的控制器升級、則 SAN LIF 會移轉至新硬體。如果發現 FC 連接埠故障、 LIF 就可以移轉至未使用的連接埠。</block>
  <block id="dbb887b1373e51dab774976c5a556964" category="section-title">設計建議</block>
  <block id="076872b2444637e6142c3c6f0f157423" category="paragraph">NetApp 提出下列建議：</block>
  <block id="d8d6bca7c981c13479781da85883cfef" category="list-text">請勿建立超過所需的路徑。過多的路徑會使整體管理更為複雜、並可能導致部分主機上路徑容錯移轉的問題。此外、有些主機對 SAN 開機等組態有非預期的路徑限制。</block>
  <block id="bd662d86fcca370cddf188ff5378fb1b" category="list-text">極少數組態需要四條以上的路徑才能連接到 LUN 。如果擁有 LUN 的節點及其 HA 合作夥伴故障、則無法存取主控 LUN 的集合、因此限制將超過兩個節點的路徑通告至 LUN 的價值。在非主要 HA 配對的節點上建立路徑、在這種情況下並無幫助。</block>
  <block id="8873f044ab7c082f16372e4b8bdc6e03" category="list-text">雖然可視 LUN 路徑的數量可以透過選擇 FC 區域中包含哪些連接埠來進行管理、但通常較容易在 FC 區域中包含所有潛在目標點、並控制 ONTAP 層級的 LUN 可見度。</block>
  <block id="0ebc6267761306c4daefb9871a470e4b" category="list-text">在 ONTAP 8.3 及更新版本中、選擇性 LUN 對應（ SLM ）功能為預設功能。透過 SLM 、任何新的 LUN 都會自動從擁有基礎 Aggregate 的節點和節點的 HA 合作夥伴通告。這種安排可避免建立連接埠集或設定分區、以限制連接埠存取。每個 LUN 都可在最佳效能和恢復能力所需的最小節點數上使用。
* 如果必須在兩個控制器之外移轉 LUN 、則可以使用新增額外的節點<block ref="02d0bbdc14988c85bbd7994723f4dd7f" prefix=" " category="inline-code"></block> 命令，以便在新節點上通告 LUN 。這樣做會建立通往 LUN 的額外 SAN 路徑、以進行 LUN 移轉。但是、主機必須執行探索作業、才能使用新路徑。</block>
  <block id="cc4b24f288afae5889c6061466dda472" category="list-text">不要過度擔心間接流量。最好在 I/O 密集環境中避免間接流量、因為每微秒的延遲都是關鍵、但對於一般工作負載而言、可見的效能影響卻微不足道。</block>
  <block id="f54fccb82abaa995eb9f86264f431505" category="section-title">NFS LIF 設計</block>
  <block id="e68dee93f11ae71aebd7a1e4c2abfc5a" category="paragraph">與 SAN 通訊協定不同、 NFS 定義多個資料路徑的能力有限。NFSv4 的平行 NFS （ pNFS ）擴充解決了這項限制、但由於乙太網路速度已達 100GB 、而且在新增其他路徑時、很少會有價值。</block>
  <block id="391dc675ec3d853200129b799ed5923e" category="section-title">效能與恢復能力</block>
  <block id="a0bd34f908e3947aa4aba15382354836" category="paragraph">雖然測量 SAN LIF 效能主要是從所有主要路徑計算總頻寬、但判斷 NFS LIF 效能需要仔細瞭解確切的網路組態。例如、兩個 10Gb 連接埠可設定為原始實體連接埠、或是可設定為連結集合體控制傳輸協定（ LACP ）介面群組。如果將它們設定為介面群組、則可根據流量是交換還是路由、使用不同的多個負載平衡原則。最後、 Oracle Direct NFS （ DNFS ）提供目前不存在於任何 OS NFS 用戶端的負載平衡組態。</block>
  <block id="e500ca27c6b92454c989d80e0445c359" category="paragraph">與 SAN 通訊協定不同的是、 NFS 檔案系統需要在通訊協定層恢復能力。例如、 LUN 一律設定為啟用多重路徑、表示儲存系統可使用多個備援通道、每個通道都使用 FC 傳輸協定。另一方面、 NFS 檔案系統則取決於單一 TCP/IP 通道的可用度、而該通道只能在實體層受到保護。這種配置是為何存在連接埠容錯移轉和 LACP 連接埠集合等選項。</block>
  <block id="35926e2ada969ad80fd3b16c0cd7d35a" category="paragraph">在 NFS 環境中、網路傳輸協定層會同時提供效能和恢復能力。因此、這兩個主題彼此交織在一起、必須一起討論。</block>
  <block id="84f4a5dfaa9613a469cd783c353a186c" category="section-title">將生命體繫結至連接埠群組</block>
  <block id="44bfb87c11d83c1b91c3589f2081e7ca" category="paragraph">若要將 LIF 繫結至連接埠群組、請將 LIF IP 位址與一組實體連接埠建立關聯。將實體連接埠集合在一起的主要方法是 LACP 。LACP 的容錯功能相當簡單； LACP 群組中的每個連接埠都會受到監控、並在發生故障時從連接埠群組中移除。不過、對於 LACP 在效能方面的運作方式、有許多誤解：</block>
  <block id="19a43026949fb6ef1017a54cf7c94f9b" category="list-text">LACP 不需要在交換器上進行組態以符合端點。例如、 ONTAP 可設定 IP 型負載平衡、而交換器則可使用 MAC 型負載平衡。</block>
  <block id="86501252b34395de5303a65f5e9943e3" category="list-text">使用 LACP 連線的每個端點可以個別選擇封包傳輸連接埠、但無法選擇用於接收的連接埠。這表示從 ONTAP 到特定目的地的流量會連結到特定連接埠、而傳回流量可能會到達不同的介面。但這不會造成問題。</block>
  <block id="298ca40b99dd3540dcd82ba5537f3f8d" category="list-text">LACP 不會一直平均分配流量。在擁有許多 NFS 用戶端的大型環境中、通常甚至會使用 LACP 集合中的所有連接埠。不過、環境中的任何一個 NFS 檔案系統都只能使用一個連接埠的頻寬、而非整個集合。</block>
  <block id="d071b5ccd1569aace97a0b4d6c0a71ac" category="list-text">雖然 ONTAP 上有資源配置資源配置資源 LACP 原則、但這些原則並不會解決從交換器到主機的連線問題。例如、主機上有四埠 LACP 主幹的組態、 ONTAP 上有四埠 LACP 主幹的組態、仍只能使用單一連接埠讀取檔案系統。雖然 ONTAP 可以透過所有四個連接埠傳輸資料、但目前沒有任何交換器技術可以透過所有四個連接埠從交換器傳送到主機。僅使用一個。</block>
  <block id="6e9e98dfaea1ca7860606f1fc05e414a" category="paragraph">在包含許多資料庫主機的大型環境中、最常見的方法是使用 IP 負載平衡、建立一個包含適當數量 10Gb （或更快）介面的 LACP 集合體。只要有足夠的用戶端、這種方法就能讓 ONTAP 提供所有連接埠的均勻使用。當組態中的用戶端較少時、負載平衡會中斷、因為 LACP 主幹不會動態重新分配負載。</block>
  <block id="7815da600ab459d2b05c5792f2271c1a" category="paragraph">建立連線後、特定方向的流量只會放置在一個連接埠上。例如、對透過四埠 LACP 主幹連接的 NFS 檔案系統執行完整表格掃描的資料庫、只會透過一個網路介面卡（ NIC ）讀取資料。如果只有三個資料庫伺服器在這種環境中、則可能所有三個都從同一個連接埠讀取、而其他三個連接埠則處於閒置狀態。</block>
  <block id="153f704ea16440133d51b1877af2a657" category="section-title">將生命與實體連接埠繫結</block>
  <block id="70e655aa3c03f840747c5272142b3527" category="paragraph">將 LIF 繫結至實體連接埠、可更精細地控制網路組態、因為 ONTAP 系統上的指定 IP 位址一次只與一個網路連接埠相關聯。然後、可透過設定容錯移轉群組和容錯移轉原則來實現恢復能力。</block>
  <block id="218f00463f5281b8ead536582c69ac3a" category="section-title">容錯移轉原則和容錯移轉群組</block>
  <block id="0a53c26a1bc4036c84fc3b4b63542744" category="inline-link-macro">適用於容錯移轉群組和原則的 ONTAP 網路管理文件</block>
  <block id="f29ae31443947c9782482ee9683dbc0e" category="paragraph">網路中斷期間的生命行為是由容錯移轉原則和容錯移轉群組所控制。不同版本的 ONTAP 已變更組態選項。請參閱 <block ref="96c8cd47b667604fb9991ace7d2eff29" category="inline-link-macro-rx"></block> 以取得所部署 ONTAP 版本的特定詳細資料。</block>
  <block id="0f2f345dd1247ae428cee703c1bf1c84" category="paragraph">ONTAP 8.3 及更高版本可根據廣播網域來管理 LIF 容錯移轉。因此、系統管理員可以定義所有可存取指定子網路的連接埠、並允許 ONTAP 選取適當的容錯移轉 LIF 。這種方法可由部分客戶使用、但由於缺乏可預測性、因此在高速儲存網路環境中有限制。例如、環境可同時包含 1Gb 連接埠、以供例行檔案系統存取、而 10Gb 連接埠則可用於資料檔案 I/O如果兩種連接埠都存在於同一個廣播網域中、 LIF 容錯移轉可能會導致資料檔案 I/O 從 10Gb 連接埠移至 1Gb 連接埠。</block>
  <block id="ced0729d57c08312b2b12382f2147d26" category="paragraph">總而言之、請考慮下列實務做法：</block>
  <block id="57cb6a7ba8acb7faa31cc5219bae83b3" category="list-text">將容錯移轉群組設定為使用者定義。</block>
  <block id="b444855eccae552d7fb79bf3d31a4f7b" category="list-text">將儲存容錯移轉（ SFO ）合作夥伴控制器上的連接埠填入容錯移轉群組、以便在儲存容錯移轉期間、生命體跟隨集合體。如此可避免產生間接流量。</block>
  <block id="86c48b21d166ed8e440a07e1d4a0b15d" category="list-text">使用效能特性與原始 LIF 相符的容錯移轉連接埠。例如、單一實體 10Gb 連接埠上的 LIF 應包含單一 10Gb 連接埠的容錯移轉群組。四埠 LACP LIF 應容錯移轉至另一個四埠 LACP LIF 。這些連接埠將是廣播網域中定義的連接埠子集。</block>
  <block id="3e839a73f7dc1262508f23a89628ca2d" category="list-text">將容錯移轉原則設為僅限 SFO 合作夥伴。這樣做可確保 LIF 在容錯移轉期間跟隨集合體。</block>
  <block id="85e82ce4c9842f978fa774c4fe96b14c" category="section-title">自動還原</block>
  <block id="3dc8610f78478640e47688101cecbfad" category="paragraph">設定<block ref="9f1b7141f09f19c4e33409646aef43cf" prefix=" " category="inline-code"></block> 視需要設定參數。大多數客戶偏好將此參數設為<block ref="b326b5062b2f0e69046810717534cb09" prefix=" " category="inline-code"></block> 讓 LIF 還原至其主連接埠。不過、在某些情況下、客戶將此設定為「假」、表示在將 LIF 傳回其主連接埠之前、可以調查非預期的容錯移轉。</block>
  <block id="edf6d4c299bc2890ba63c7eb3ef8b4d2" category="section-title">LIF 與 Volume 比率</block>
  <block id="9c75becef8c432a0152a40c7c037a04c" category="paragraph">常見的誤解是、磁碟區和 NFS 生命體之間必須有一對一的關係。雖然在叢集中的任何位置移動磁碟區都需要此組態、但絕不會產生額外的互連流量、但絕對不需要此組態。必須考慮叢集間流量、但僅存在叢集間流量並不會造成問題。為 ONTAP 所發佈的許多基準測試主要包括間接 I/O</block>
  <block id="2b4ebcd522b07b80d3fd76b301c506e8" category="paragraph">例如、資料庫專案中包含相對少數的效能關鍵資料庫、只需要總共 40 個磁碟區、可能需要將 1 ： 1 磁碟區轉換為 LIF 策略、這種安排需要 40 個 IP 位址。然後、任何磁碟區都可以連同相關的 LIF 一起移至叢集中的任何位置、而且流量永遠是直接的、即使在微秒層級、也能將每個延遲來源減至最低。</block>
  <block id="38bad4911bcdf1117d37eb1195566f8c" category="paragraph">舉例來說、大型託管環境的管理可能更容易、因為客戶與生命的關係是一對一。隨著時間的推移、可能需要將磁碟區移轉至不同的節點、這會造成一些間接流量。但是、除非互連交換器上的網路連接埠飽和、否則效能影響應該無法偵測。如果有疑慮、可以在其他節點上建立新的 LIF 、並在下一個維護時段更新主機、以移除組態中的間接流量。</block>
  <block id="d75b0d8f723c3e97eaa4ca39630c7420" category="doc">MetroCluster 和多個集合體</block>
  <block id="df5855269b493a27a5565dfd9f2584f0" category="list-text">在正常情況下、傳入的寫入資料會同步鏡射至指定的控制器、以供其合作夥伴使用。在 NetApp MetroCluster 環境中、寫入也會鏡射到遠端控制器。除非寫入儲存在所有位置的非揮發性媒體中、否則不會對主機應用程式進行確認。</block>
  <block id="05b60db315aa45e1524b7a6ffa242fa8" category="list-text">儲存寫入資料的媒體稱為非揮發性記憶體或 NVMEM 。它有時也稱為非揮發性隨機存取記憶體（ NVRAM ）、雖然它是日誌、但仍可視為寫入快取。在正常作業中、不會讀取來自 NVMEM 的資料；只有在軟體或硬體故障時、才會用來保護資料。當資料寫入磁碟機時、資料會從系統的 RAM 傳輸、而非從 NVMEM 傳輸。</block>
  <block id="e6dd8b559da6e046f2043043a55faafc" category="list-text">在接管作業期間、高可用度（ HA ）配對中的一個節點會接管其合作夥伴的作業。切換基本上相同、但適用於遠端節點接管本機節點功能的 MetroCluster 組態。</block>
  <block id="33c0c466972aae7427262e3075a2ed07" category="paragraph">在例行維護作業期間、儲存設備接管或切換作業應該是透明的、但網路路徑變更時、操作可能會短暫暫停。然而、網路連線可能很複雜、而且容易出錯、因此 NetApp 強烈建議您在將儲存系統投入生產之前、先徹底測試接管和轉換作業。這樣做是確保正確設定所有網路路徑的唯一方法。在 SAN 環境中、請仔細檢查命令的輸出<block ref="41dc2c94e82e1c56ba876085acf5a974" prefix=" " category="inline-code"></block> 以確保所有預期的主要和次要路徑都可用。</block>
  <block id="d33ea1ad1493de23aafd480e95fea159" category="paragraph">發出強制接管或關機時、請務必小心。使用這些選項強制變更儲存組態、表示會忽略擁有磁碟機的控制器狀態、而替代節點則強制控制磁碟機。不正確地強制接管可能會導致資料遺失或毀損。這是因為強制接管或變更會捨棄 NVMEM 的內容。在接管或切換完成後、資料遺失表示儲存在磁碟機上的資料可能會從資料庫的角度還原到稍微舊的狀態。</block>
  <block id="c226371d96b605ccff84ad23db0069b8" category="paragraph">很少需要強制接管正常的 HA 配對。在幾乎所有故障情況下、節點都會關機並通知合作夥伴、以便進行自動容錯移轉。有些邊緣情況、例如發生滾動故障、節點之間的互連中斷、然後一個控制器遺失、需要強制接管。在這種情況下、節點之間的鏡像會在控制器故障之前遺失、這表示當機的控制器將不再擁有正在進行的寫入複本。然後需要強制接管、這表示資料可能會遺失。</block>
  <block id="418f81f529a577cb711b44adece1376f" category="paragraph">同樣的邏輯也適用於 MetroCluster 轉換。在正常情況下、可進行的作業幾乎透明化。然而、災難可能會導致仍在運作的站台和災難站台之間的連線中斷。從仍在運作的站台觀點來看、問題可能只是站台之間的連線中斷、而原始站台可能仍在處理資料。如果節點無法驗證主控制器的狀態、則只能強制進行移轉。</block>
  <block id="ae0c16d397348d8f8fd4e56b08b06c7c" category="paragraph">* NetApp 建議 * 採取下列預防措施：</block>
  <block id="79fd18cb18befbe5c2113757478be193" category="list-text">請務必小心、避免意外強制接管或切入。一般而言、不應強制、強制變更可能會導致資料遺失。</block>
  <block id="26cece11254903c5ba8bfdd8d54ae779" category="list-text">如果需要強制接管或移除、請確定應用程式已關機、所有檔案系統均已卸除、且邏輯 Volume Manager （ LVM ）磁碟區群組已移除。必須卸載 ASM 磁碟群組。</block>
  <block id="0b6986eb1285d28a9987ea13adbca358" category="list-text">在強制 MetroCluster 轉換的情況下、請將故障節點從所有仍在運作的儲存資源中隔離。如需詳細資訊、請參閱 MetroCluster 管理與災難恢復指南、以取得相關版本的 ONTAP 。</block>
  <block id="71303adf87737046acd4381c72151278" category="paragraph">MetroCluster 是一種同步複寫技術、可在連線中斷時切換至非同步模式。這是客戶最常提出的要求、因為保證同步複寫意味著站台連線中斷會導致資料庫 I/O 完全停止、使資料庫停止運作。</block>
  <block id="cb791a44ee361703eb7594a7932f57de" category="paragraph">透過 MetroCluster 、集合體在連線恢復後會快速重新同步。與其他儲存技術不同、 MetroCluster 在站台故障後絕不應要求完整的重新鏡射。只能運送差異變更。</block>
  <block id="c1536091d7c1ca33c9dc4dfa8c0852a2" category="paragraph">在跨集合體的資料集中、在循環災難案例中需要額外的資料恢復步驟、風險很小。具體而言、如果（ a ）站台之間的連線中斷、（ b ）連線恢復、（ c ）集合體會達到某種狀態、其中有些是同步的、有些則不是同步的、 然後（ d ）主站台會遺失、結果是無法運作的站台、而集合體彼此之間不會同步。如果發生這種情況、資料集的某些部分會彼此同步、因此無法在沒有恢復的情況下啟動應用程式、資料庫或資料存放區。如果資料集橫跨整個集合體、 NetApp 強烈建議您利用快照式備份、搭配眾多可用工具之一、在這種不尋常的情況下驗證快速的可恢復性。</block>
  <block id="a42c87064c284490a38efac4bf0b7f7f" category="paragraph">RAID 4 、 RAID 5 、 RAID 6 、 RAID DP 和 RAID-TEC 都使用同位元檢查來確保磁碟機故障不會導致資料遺失。與鏡像相比、這些 RAID 選項可提供更好的儲存使用率、但大多數 RAID 實作都有影響寫入作業的缺點。在其他 RAID 實作上完成寫入作業可能需要多個磁碟機讀取才能重新產生同位元資料、這是一種通常稱為 RAID 懲罰的程序。</block>
  <block id="3cfcf9a3299db75df9aa0e024ebef965" category="paragraph">不過、 ONTAP 並不會因此而受到此 RAID 處罰。這是因為 NetApp WAFL （隨處寫入檔案配置）與 RAID 層整合。寫入作業會整合在 RAM 中、並準備為完整的 RAID 等量磁碟區、包括同位元檢查產生。ONTAP 不需要執行讀取即可完成寫入、這表示 ONTAP 和 WAFL 可以避免 RAID 的損失。對於延遲關鍵作業（例如重作記錄）的效能不受阻礙、隨機的資料檔案寫入不會因重新產生同位元檢查而導致任何 RAID 損失。</block>
  <block id="5ff9a871332f0f82f38d880b68a9874b" category="paragraph">在統計可靠性方面、即使是 RAID DP 也能提供比 RAID 鏡射更好的保護。主要問題是 RAID 重建期間對磁碟機的需求。有了鏡射 RAID 集、當磁碟機在重建時發生故障、而在 RAID 組中重建其合作夥伴時、資料遺失的風險遠高於 RAID DP 組中發生三重磁碟機故障的風險。</block>
  <block id="12c3fe87fd5a746ce8a7cbe25dc1c25b" category="paragraph">在快閃磁碟機時代之前、使用區塊延展來協助克服旋轉磁碟機的效能限制。例如、如果作業系統需要執行 1MB 讀取作業、則從單一磁碟機讀取 1MB 的資料時、需要大量的磁碟機磁頭搜尋和讀取、因為 1MB 會緩慢傳輸。如果將 1MB 的資料分散在 8 個 LUN 上、則作業系統可能會同時執行 8 個 128K 讀取作業、並縮短完成 1MB 傳輸所需的時間。</block>
  <block id="e337352c3d57672fd08af8ba709b544f" category="paragraph">由於必須事先知道 I/O 模式、因此使用旋轉磁碟機進行分拆會更困難。如果串列區塊延展未針對真正的 I/O 模式正確調整、則等量區塊配置可能會損害效能。使用 Oracle 資料庫、特別是搭配 All Flash 組態、分拆作業更容易設定、並經證實可大幅提升效能。</block>
  <block id="7025652291dc6872022b0f79a2b2be21" category="paragraph">依預設、邏輯磁碟區管理程式（例如 Oracle ASM 等量磁碟區）不屬於原生 OS LVM 。其中有些 LUN 會將多個 LUN 連結在一起、成為串連的裝置、導致資料檔案存在於一台 LUN 裝置上、而只存在於一台 LUN 裝置上。這會造成熱點。其他 LVM 實作預設為分散式擴充。這與分拆類似、但卻是比較粗糙的。磁碟區群組中的 LUN 會切成大型片段、稱為區段、通常以百萬位元組為單位測量、然後邏輯磁碟區會分佈在這些區段中。結果是對檔案進行隨機 I/O 、應該能在 LUN 之間妥善分配、但連續 I/O 作業的效率卻不如以前那麼高。</block>
  <block id="0c2f3b2ec9d90baa0a0a0b6fb673a113" category="paragraph">效能密集的應用程式 I/O 幾乎總是（ a ）以基本區塊大小為單位、或（ b ） 1 MB 。</block>
  <block id="804d5b1f06570b4d242be0c2f0c3392c" category="paragraph">等量分配組態的主要目標是確保單一檔案 I/O 可作為單一單元執行、而多區塊 I/O 的大小應為 1MB 、可在等量磁碟區中的所有 LUN 之間平均平行處理。這表示等量磁碟區大小不得小於資料庫區塊大小、且等量磁碟區大小乘以 LUN 數量應為 1MB 。</block>
  <block id="0598f393baefd05d48b48076cc7df606" category="paragraph">下圖顯示等量磁碟區大小和寬度調校的三個可能選項。選擇 LUN 數量以滿足上述效能需求、但在所有情況下、單一等量磁碟區內的總資料為 1MB 。</block>
  <block id="0353522b39b87d54d40d3f09ec668851" category="doc">組態ONTAP</block>
  <block id="8e52de0d4b03d5fe87dc88da09616c7f" category="inline-link-macro">請按這裡。</block>
  <block id="337c62c6b6eb7319bae58701105e889c" category="doc">分層</block>
  <block id="3493794b3ccb587f71a663f51f4484ef" category="summary">ONTAP 上的 PostgreSQL 資料庫</block>
  <block id="2d3298c651b356a82db5d664ce68e65e" category="doc">原生資料保護</block>
  <block id="31c6611c8e0bd237a3ee51db1728a440" category="paragraph">儲存設計的主要層面之一、是為 PostgreSQL Volume 提供保護。客戶可以使用傾印方法或使用檔案系統備份來保護 PostgreSQL 資料庫。本節說明備份個別資料庫或整個叢集的不同方法。</block>
  <block id="9f3265914462c64fd02bc50ab4c9ebe9" category="paragraph">備份 PostgreSQL 資料有三種方法：</block>
  <block id="6b592c7950245a5a9f54d9424e851e97" category="list-text">SQL Server 傾印</block>
  <block id="c8b1fc69d12d1da6589e384671c8e82c" category="list-text">檔案系統層級備份</block>
  <block id="3c25062a0babfa1495dd604698707610" category="list-text">持續歸檔</block>
  <block id="58c132e2be12705408a7456c6183b617" category="paragraph">SQL Server 傾印方法背後的想法是使用 SQL Server 命令產生檔案、當檔案傳回伺服器時、就能像在傾印時一樣重新建立資料庫。PostgreSQL 提供公用程式<block ref="5a5149b2817f30cbb3805307f9cadae4" prefix=" " category="inline-code"></block> 和<block ref="0ead269b3d000482b5a44a1ef4e8cd54" prefix=" " category="inline-code"></block> 用於建立個別和叢集層級的備份。這些傾印都是邏輯的、而且沒有足夠的資訊可供 Wal 重新執行使用。</block>
  <block id="1d05b80fc6f199681263e063190e8325" category="paragraph">另一種備份策略是使用檔案系統層級的備份、系統管理員可在其中直接複製 PostgreSQL 用來將資料儲存在資料庫中的檔案。此方法是在離線模式下執行：必須關閉資料庫或叢集。另一種方法是使用<block ref="35679fc424d9eec0c30f38459fd9b322" prefix=" " category="inline-code"></block> 執行 PostgreSQL 資料庫的熱串流備份。</block>
  <block id="10907e7ac5ab6e5235a23898a2331b31" category="doc">ONTAP 上的 PostgreSQL 資料庫</block>
  <block id="841a21e58e7c22a71c07b89a4362d2b6" category="admonition">ONTAP 和 PostgreSQL 資料庫上的這份文件取代先前發佈的 _TR-4770 ： ONTAP 最佳實務做法的 PostgreSQL 資料庫。 _</block>
  <block id="9147e5e61a7b9260dec09f3a6eb3e5be" category="doc">快照</block>
  <block id="0b9d99167191c5d9ad23ca07bc6a9b38" category="paragraph">PostgreSQL 的 Snapshot 型備份需要為資料檔案、 Wal 檔案和歸檔的 Wal 檔案組態快照、才能提供完整或時間點還原。</block>
  <block id="8c6a53edc4449a4cc3983d47ecffa851" category="paragraph">對於 PostgreSQL 資料庫而言、快照的平均備份時間介於數秒到數分鐘之間。此備份速度比快 60 至 100 倍<block ref="35679fc424d9eec0c30f38459fd9b322" prefix=" " category="inline-code"></block> 以及其他檔案系統備份方法。</block>
  <block id="c798632224ae09152f66f60e0edc757e" category="paragraph">NetApp 儲存設備上的快照既可一致當機、也可一致應用程式。當機一致的快照是在儲存設備上建立、而不會停止資料庫、而在資料庫處於備份模式時則會建立應用程式一致的快照。NetApp 也可確保後續快照是永久遞增備份、以節省儲存成本並提高網路效率。</block>
  <block id="d0e369216eeac8de66e915909364970a" category="paragraph">由於快照速度很快、不會影響系統效能、因此您可以每天排程多個快照、而不必像其他串流備份技術一樣建立單一的每日備份。當需要還原與還原作業時、系統停機時間會減少兩項重要功能：</block>
  <block id="316eb8adba4d16a34c92eaf9db381b9e" category="list-text">NetApp SnapRestore 資料還原技術代表還原作業只需數秒即可完成。</block>
  <block id="c128c475c12703e37685edd6db8144bc" category="list-text">積極的恢復點目標（ RPO ）意味著必須套用較少的資料庫記錄、同時也加速轉送恢復。</block>
  <block id="9b9f26085ff7149d4dbb916b1db0f121" category="paragraph">若要備份 PostgreSQL 、您必須使用（一致性群組） Wal 和歸檔記錄、確保資料磁碟區同時受到保護。使用 Snapshot 技術複製 Wal 檔案時、請務必執行<block ref="a3b8c8ee15ba60bfb2b999195d2b4e7d" prefix=" " category="inline-code"></block> 清除所有必須歸檔的 Wal 項目。如果您在還原期間清除 Wal 項目、則只需要停止資料庫、卸載或刪除現有的資料目錄、並在儲存設備上執行 SnapRestore 作業。還原完成後、您可以掛載系統並將其恢復至目前狀態。對於時間點恢復、您也可以還原 Wal 和歸檔記錄檔、然後 PostgreSQL 會決定最一致的點並自動恢復。</block>
  <block id="8e8d6187572eace409fee5bf2dbb7cf9" category="paragraph">一致性群組是 ONTAP 中的一項功能、建議在有多個磁碟區掛載到單一執行個體或具有多個資料表空間的資料庫時使用。一致性群組快照可確保將所有磁碟區分組並加以保護。一致性群組可從 ONTAP 系統管理員有效管理、您甚至可以複製它來建立資料庫的執行個體複本、以供測試或開發之用。</block>
  <block id="7e7397a7b79323762c61941fc0e6b5f9" category="doc">資料保護</block>
  <block id="16a49d0bc0249ef3dd42949589a0ed4e" category="doc">表格空間</block>
  <block id="d6d544de56c329d9f68bb176c6245e7c" category="paragraph">初始化資料庫叢集時會自動建立兩個資料表空間。</block>
  <block id="6df924905e21856e4e8b8f936767cdd6" category="paragraph">。<block ref="bd676cbef0d168a62a062c8709af1824" prefix=" " category="inline-code"></block> 表空間用於共享系統目錄。。<block ref="3224684b8e7208962a73daeb0bb24110" prefix=" " category="inline-code"></block> 表空間是 template1 和 template0 資料庫的預設資料表空間。如果初始化叢集的磁碟分割或磁碟區空間不足且無法擴充、則可在不同的磁碟分割上建立資料表空間、並在重新設定系統之前使用。</block>
  <block id="364c9d7b9593277eee9477befaf9f66b" category="paragraph">大量使用的索引可以放在快速、高可用度的磁碟上、例如固態裝置。此外、儲存歸檔資料的表格、無論是極少使用或非效能關鍵、都可以儲存在成本較低、速度較慢的磁碟系統上、例如 SAS 或 SATA 磁碟機。</block>
  <block id="9bfe8d8e1117bd1d4b8597220e3f166e" category="paragraph">資料表空間是資料庫叢集的一部分、無法視為資料檔案的獨立集合。它們取決於主資料目錄中包含的中繼資料、因此無法附加至不同的資料庫叢集或個別備份。同樣地、如果您遺失資料表空間（透過檔案刪除、磁碟故障等方式）、資料庫叢集可能會變得無法讀取或無法啟動。將資料表空間放在像 RAM 磁碟一樣的暫存檔案系統上、會危及整個叢集的可靠性。</block>
  <block id="7d9573b1ed3543ec6ea42c81830dc27c" category="paragraph">建立表格後、如果要求的使用者擁有足夠的權限、則可以從任何資料庫使用表格區。PostgreSQL 使用符號連結來簡化資料表空間的實作。PostgreSQL 會在中新增一列<block ref="4a926dc6e7549c49a13755513af41e67" prefix=" " category="inline-code"></block> 表（叢集範圍表格）、並將新的物件識別碼（ OID ）指派給該列。最後、伺服器會使用 OID 在叢集與指定目錄之間建立符號連結。目錄<block ref="8e3da386e945c59fb1e1cd1d7a47697c" prefix=" " category="inline-code"></block> 包含指向叢集中定義的每個非內建表格空間的符號連結。</block>
  <block id="249fd7d68098688fab42436eed51be7d" category="doc">資料庫組態</block>
  <block id="8daf26b2c72dd18a89fa89a6b1aa988d" category="paragraph">有幾種 PostgreSQL 調校組態可以改善效能。</block>
  <block id="abb3dae412afe5c801e9ab90de71675b" category="paragraph">最常用的參數如下：</block>
  <block id="bfdf741f4acb3dfee6e87075b535610e" category="list-text"><block ref="39d79378db03fed7c5ba62efba38e327" prefix="" category="inline-code"></block>：一次擁有的最大資料庫連線數。使用此參數可限制磁碟交換並終止效能。根據應用程式需求、您也可以針對連線集區設定調整此參數。</block>
  <block id="9625e1a6f5d1f695fd1c72401afaa07e" category="list-text"><block ref="904d399f43708a8a5b6d10c1ee3f8356" prefix="" category="inline-code"></block>：提高資料庫伺服器效能的最簡單方法。對於大多數現代硬體而言、預設值為低。在部署期間、系統上的可用 RAM 約為 25% 。此參數設定會因其與特定資料庫執行個體的運作方式而異；您可能必須根據試用和錯誤來增加和減少值。不過、將其設為高可能會降低效能。</block>
  <block id="d1960c56572383fc401fec3f0b767cf9" category="list-text"><block ref="5edeed59821790d8bec6d32da26bca4c" prefix="" category="inline-code"></block>：此值告訴 PostgreSQL 的最佳化程式 PostgreSQL 有多少記憶體可用於快取資料、並有助於判斷是否使用索引。較大的值會增加使用索引的可能性。此參數應設為分配給的記憶體容量<block ref="e15ed0f69e5c2475450b97691d6a2cee" prefix=" " category="inline-code"></block> 加上可用的作業系統快取容量。此值通常超過系統總記憶體的 50% 。</block>
  <block id="508df54f84fc7abb00f3a92937ca3506" category="list-text"><block ref="1edef4d43b06d4deb28010505df5724d" prefix="" category="inline-code"></block>：此參數控制用於排序作業和雜湊表的記憶體容量。如果您在應用程式中進行大量排序、可能需要增加記憶體容量、但請謹慎。它不是系統範圍的參數、而是每次操作的參數。如果複雜查詢中有多個排序作業、則會使用多個 work_mem 記憶體單元、而多個後端也可能同時執行此作業。如果值太大、此查詢通常會引導您的資料庫伺服器進行切換。此選項先前在舊版 PostgreSQL 中稱為 sort_mem 。</block>
  <block id="59d9770060aecba84c7e8ed849b5653d" category="list-text"><block ref="65768448b4f275b95af20a317c7355a9" prefix="" category="inline-code"></block>：此參數確定在提交事務之前是否應使用 fsync （）將所有 Wal 頁面同步到磁盤。關閉它有時會改善寫入效能、並將其開啟、以提高系統當機時避免毀損的風險。</block>
  <block id="625a65dd6cef83bac66319bde3894899" category="list-text"><block ref="ff5a06a39dd6824f30a778a51cf7ea69" prefix="" category="inline-code"></block>：檢查點處理程序會將已提交的資料清除至磁碟。這涉及磁碟上的大量讀寫作業。此值以秒為單位設定、較低的值可減少損毀恢復時間、而增加的值則可減少檢查點呼叫、進而降低系統資源的負載。根據應用程式的關鍵程度、使用量、資料庫可用度、設定 checkpoint 逾時的值。</block>
  <block id="309b1036c45e7ad490448925dc4f9597" category="list-text"><block ref="6a5c0586429891e84e05d6ab15088405" prefix="" category="inline-code"></block> 和<block ref="9080796d32078fea7d191100eab64f92" prefix=" " category="inline-code"></block>：這些選項可同時用於撰寫多筆同時提交的交易、以協助改善效能。如果交易提交時有多個 command_sibliblings 物件處於作用中狀態、伺服器會等待 command_delay 微秒、嘗試一次提交多個交易。</block>
  <block id="8d5137ce002c6328c2b5f4f328662e1d" category="list-text"><block ref="fa4ca2cd95c20a44171f964fb8f5fdb9" prefix="" category="inline-code"></block>：配置流程的最佳工作人員數量。max_paralle_founds 對應可用的 CPU 數量。視應用程式設計而定、查詢可能需要較少的工作人員來執行平行作業。最好保持兩個參數的值相同、但在測試後調整值。</block>
  <block id="c8736e7ca19e9096796c624f3030dae5" category="list-text"><block ref="8dda85a5feb6de66d8f5f9a4cbdb0754" prefix="" category="inline-code"></block>：此值控制 PostgreSQL 檢視非連續磁碟讀取的方式。較高的值表示 PostgreSQL 較可能使用連續掃描、而非索引掃描、表示伺服器有快速磁碟。請在評估其他選項（例如計畫型最佳化、吸塵、索引以變更查詢或架構）之後、修改此設定。</block>
  <block id="17edf3863f12b7d9480b3336a9fca773" category="list-text"><block ref="709989c844c22473cb8406550423d39a" prefix="" category="inline-code"></block>：此參數設置 PostgreSQL 嘗試同時執行的並行磁盤 I/O 操作數。提高此值會增加任何個別 PostgreSQL 工作階段嘗試平行啟動的 I/O 作業數。允許範圍為 1 到 1 、 000 、或為零、以停用非同步 I/O 要求的發出。目前、此設定只會影響點陣圖堆疊掃描。固態硬碟（ SSD ）和其他記憶體型儲存設備（ NVMe ）通常可以處理許多並行要求、因此最佳價值可能在數百種環境中。</block>
  <block id="82b38edb10ad73f9645c5d65e73a659b" category="paragraph">如需 PostgreSQL 組態參數的完整清單、請參閱 PostgreSQL 文件。</block>
  <block id="402fbc243dbef50cd5c8e57ccbdd92f5" category="section-title">吐司</block>
  <block id="0d2b62abb26bd0b4109f5bc967250933" category="paragraph">Toast 代表「超大型屬性儲存技術」。PostgreSQL 使用固定的頁面大小（通常為 8KB ）、不允許 Tuple 跨越多個頁面。因此、無法直接儲存大欄位值。當您嘗試儲存超過此大小的資料列時、 Toast 會將大型資料欄的資料分成較小的「片段」、並將其儲存在 Toast 資料表中。</block>
  <block id="3f11f21bdc22c3c955c3f0fca39e9bc0" category="paragraph">只有在將結果集傳送至用戶端時、才會拔出（如果完全選取）已烘烤的屬性大值。表格本身比沒有任何離線儲存設備（ Toast ）時更小、可容納更多資料列到共用緩衝區快取中。</block>
  <block id="9a311ef6dad816cb7a15c0ab41920ad8" category="section-title">真空</block>
  <block id="385e23b8ebe64dfd0005f6846cc8e85e" category="paragraph">在正常的 PostgreSQL 作業中、因為更新而刪除或過時的 Tuple 不會從其表格中實際移除、直到執行真空為止。因此、您必須定期執行吸氣、尤其是在經常更新的表格上。接著必須回收它所佔用的空間、以便新列重複使用、以避免磁碟空間中斷。不過、它不會將空間傳回作業系統。</block>
  <block id="db81319c35b48ed94867775a9a1ce1d7" category="paragraph">頁面內的可用空間不會分散。真空會重新寫入整個區塊、有效地將剩餘的資料列封裝起來、並在頁面中留下一個連續的可用空間區塊。</block>
  <block id="8a5c17164c9920590fc057ee01f2fcb3" category="paragraph">相反地、使用「完全真空」技術、可以撰寫完全新版的表格檔案、而不會有任何空間。此動作可將表格大小減至最小、但可能需要很長時間。在作業完成之前、它也需要額外的磁碟空間來容納表格的新複本。例行真空的目標是避免完全真空。此程序不僅能將資料表保持在最小大小、還能維持磁碟空間的穩定狀態使用量。</block>
  <block id="61bcd96a2c1f8026527cbf2019d6e9a4" category="doc">初始化</block>
  <block id="f4f9dac58f7c47e819293af5f2dd1177" category="paragraph">您可以使用建立新的資料庫叢集<block ref="abc91e782cd3950bfa31202aff74ca69" prefix=" " category="inline-code"></block> 方案。一<block ref="abc91e782cd3950bfa31202aff74ca69" prefix=" " category="inline-code"></block> 指令碼會建立定義叢集的資料檔案、系統表格和範本資料庫（ template0 和 template1 ）。</block>
  <block id="b668460552732302350bbb840d57931c" category="paragraph">範本資料庫代表常用資料庫。其中包含系統表格、標準檢視、功能和資料類型的定義。<block ref="3865cf98fe802a965570b4a10a1d894b" prefix=" " category="inline-code"></block> 做為的引數<block ref="abc91e782cd3950bfa31202aff74ca69" prefix=" " category="inline-code"></block> 指定資料庫叢集位置的指令碼。</block>
  <block id="8fcd14822a5b94d212898fe3e006526e" category="paragraph">PostgreSQL 中的所有資料庫物件都是由各自的 OID 在內部管理。表格和索引也由個別的 OID 管理。資料庫物件與其各自的 OID 之間的關係會儲存在適當的系統目錄表格中、視物件類型而定。例如、資料庫和堆積表格的 OID 會儲存在中<block ref="d0fcebb608269edbd5d67486884ebed7" prefix=" " category="inline-code"></block> 和 "pg_class" 。您可以在 PostgreSQL 用戶端上發佈查詢來判斷 OID 。</block>
  <block id="d0e97e34fe92edd2facd0f7377b6340b" category="paragraph">每個資料庫都有自己的個別資料表和索引檔案、限制為 1GB 。每個表格都有兩個相關的檔案、分別以後綴表示<block ref="7b9b00c45b01f7b7c6d3a3c8ba2e9275" prefix=" " category="inline-code"></block> 和<block ref="a1d869a79e2f43693a6a416fcbdc2724" prefix=" " category="inline-code"></block>。它們稱為可用空間地圖和可見度地圖。這些檔案會儲存可用空間容量的相關資訊、並在表格檔案中的每個頁面上都有可見度。索引只有個別的可用空間地圖、而且沒有可見度地圖。</block>
  <block id="048a7ed79caf84bb5c725efc5f474911" category="paragraph">。<block ref="c28f4f32219f5ff99fb4b116980b8549" prefix=" " category="inline-code"></block> 目錄包含預先寫入記錄。預先寫入記錄可用來改善資料庫的可靠性和效能。每當您更新表格中的列時、 PostgreSQL 會先將變更寫入預先寫入記錄、然後將修改寫入實際的資料頁面到磁碟。。<block ref="f7223cfaa9416056a91e259e326ac5cf" prefix=" " category="inline-code"></block> 目錄通常包含數個檔案、但 initdb 只會建立第一個檔案。視需要新增額外檔案。每個 xlog 檔案長度為 16MB 。</block>
  <block id="789a6c7dd865d16eb1df122bcc5c9a3a" category="admonition">* 如果需要 NFSv4 功能、 NetApp 建議 * 使用 NFSv4.1 。NFSv4.1 中的 NFSv4 傳輸協定有一些功能性增強功能、可改善某些邊緣情況的恢復能力。</block>
  <block id="8e86e0aee135afb67c6a1d3d6e0f3306" category="inline-link-macro">NFS 傳輸大小</block>
  <block id="d84b41126744795c4ee82f7b256e7234" category="inline-link-macro">FC SAN</block>
  <block id="2c8c2171fc87c96e58fb40d8714f85cf" category="doc">PostgreSQL 架構</block>
  <block id="ee62b4420d426c21a46d892ac084872a" category="paragraph">PostgreSQL 是以用戶端和伺服器架構為基礎的 RDBMS 。PostgreSQL 執行個體稱為資料庫叢集、是資料庫的集合、而非伺服器集合。</block>
  <block id="89c30c326e106773af32af40255b92a8" category="inline-image-macro">錯誤：找不到圖形</block>
  <block id="54c2dd41fd1ad3efa25e80bee0bae549" category="paragraph">PostgreSQL 資料庫中有三個主要元素：郵政局長、前端（用戶端）和後端用戶端會傳送要求給郵政局長、其中包含 IP 傳輸協定等資訊、以及要連線的資料庫。郵政局長會驗證連線、並將其傳送至後端程序以進行進一步的通訊。後端程序會執行查詢、並將結果直接傳送至前端（用戶端）。</block>
  <block id="9f96e07bbaf7c0237047d6d0f95301a8" category="paragraph">PostgreSQL 執行個體是以多重處理模式為基礎、而非多重執行緒模式。它會為不同的工作產生多個處理程序、而且每個處理程序都有自己的功能。主要程序包括用戶端程序、 Wal 寫入程序、背景寫入程序及檢查指標程序：</block>
  <block id="6aebf901bd4be26a765c56e4133b3798" category="list-text">當用戶端（前景）程序傳送讀取或寫入要求至 PostgreSQL 執行個體時、它不會直接讀取或寫入資料至磁碟。它首先緩衝共享緩衝區和預先寫入記錄（ Wal ）緩衝區中的資料。</block>
  <block id="458239ee6c634dc5fef96f9dfab275f0" category="list-text">Wal 寫入器程序會操控共用緩衝區和 Wal 緩衝區的內容、以寫入 Wal 記錄檔。Wal 記錄檔通常是 PostgreSQL 的交易記錄檔、並依序寫入。因此、為了改善資料庫的回應時間、 PostgreSQL 會先寫入交易記錄檔、並確認用戶端。</block>
  <block id="9ec2999256fe568cd596b42e7da2cc39" category="list-text">若要將資料庫置於一致的狀態、背景寫入器程序會定期檢查共用緩衝區是否有髒頁。然後將資料排清至儲存在 NetApp 磁碟區或 LUN 上的資料檔案。</block>
  <block id="5c852dd8ba7215c01dfde8e98f6c46c6" category="list-text">checkpointer 程序也會定期執行（比背景程序更少）、並防止對緩衝區進行任何修改。它會向 Wal 寫入器程序發出訊號、將檢查點記錄寫入並清除至儲存在 NetApp 磁碟上的 Wal 記錄檔結尾。它也會向背景寫入器程序發出訊號、要求將所有髒頁寫入磁碟並清除。</block>
  <block id="0a7b1215fd0b9621d4d7300f88b2906c" category="doc">資料保護軟體</block>
  <block id="e265011e47d11db43ee112fd2fdc9d5b" category="paragraph">適用於 PostgreSQL 資料庫的 NetApp SnapCenter 外掛程式、結合 Snapshot 和 NetApp FlexClone 技術、可為您提供下列優點：</block>
  <block id="4dcdaba06a92b8fecfdc823643a71723" category="list-text">快速備份與還原。</block>
  <block id="aee746a577a1baebdc33197fb5f3a279" category="list-text">節省空間的複本。</block>
  <block id="b96bb0cd2ebc0389b6670602ac80d983" category="list-text">能夠建置快速有效的災難恢復系統。</block>
  <block id="9e060ad00fced94f2616dd71fbc49f76" category="paragraph">在下列情況下、您可能偏好選擇 NetApp 的優質備份合作夥伴、例如 Veeam Software 和 CommVault ：</block>
  <block id="0ee17b3b55ea2b0af3d90985bc347775" category="list-text">在異質環境中管理工作負載</block>
  <block id="88fbde7bbe0274fbe9e7ce01c563d03c" category="list-text">將備份儲存至雲端或磁帶、以供長期保留</block>
  <block id="445e3e0cce7f959696dde65b3be27843" category="list-text">支援多種作業系統版本和類型</block>
  <block id="21c5d67cc22beaf7d7c9c84c8deaabbe" category="paragraph">適用於 PostgreSQL 的 SnapCenter 外掛程式是社群支援的外掛程式、可在 NetApp Automation Store 取得設定與文件。透過 SnapCenter 、使用者可以遠端備份資料庫、複製及還原資料。</block>
  <block id="7d334ca369e4a752ec91b1503183f0ed" category="summary">適用於 SAP HANA 和 AnyDB 的解決方案</block>
  <block id="1ac73696f4529e3901b0d4e5430365cb" category="doc">SAP HANA 與 SAP 搭配 AnyDB</block>
  <block id="2c1b27a986b5e37a810d61f72b23ee4b" category="paragraph">設定、管理及自動化 SAP 解決方案的最佳實務做法、請參閱 NetApp SAP 解決方案頁面。</block>
  <block id="6c92285fa6d3e827b198d120ea3ac674" category="inline-link-macro">請按這裡</block>
  <block id="ee1e67308b27672a8f54eace4c615a98" category="paragraph">請按一下 <block ref="c95e4a3e1de9e00fefc4bf8a7ce42893" category="inline-link-macro-rx"></block> 以取得更多資訊。</block>
  <block id="beb3ca55ed0a53a38a2b97540b05d6e4" category="summary">ONTAP 上的 Microsoft SQL Server</block>
  <block id="7636ae91f443b605f05bed59d7d57a02" category="doc">Microsoft SQL Server 災難恢復</block>
  <block id="18c6a681ea46e1ed394e092461bb53ef" category="list-text">將包含 SQL Server 資料的磁碟區分散到叢集中的不同節點、以允許所有叢集節點共用 SnapMirror 複寫活動。此套裝作業系統可最佳化節點資源的使用。</block>
  <block id="0a01e6837f5c691536f0b6cbdd0232ec" category="inline-link-macro">TR-4015 ： ONTAP 9 的 SnapMirror 組態與最佳實務做法指南</block>
  <block id="1cca1a3fad8c6dd7e2dadbd2aa08bf07" category="paragraph">如需 SnapMirror 的詳細資訊、請參閱 <block ref="64b916f792bad525a069a243c092b62e" category="inline-link-macro-rx"></block>。</block>
  <block id="77641f4a3e4406855e878235cbd89b87" category="doc">CPU 組態</block>
  <block id="cf0e2551e639758cc3c4d82df655eccd" category="inline-link-macro">SQL Server 2022 ：現代化的資料平台</block>
  <block id="809c9e1f6ce0bc82bf42fae361c6f43e" category="paragraph">因此、若要使用所有 CPU 、您應該使用每個處理器核心授權。如需 SQL Server 授權的詳細資訊、請參閱 <block ref="457abfaf1083b1cbfc49f2783069c6cd" category="inline-link-macro-rx"></block>。</block>
  <block id="cb8d56a3511d402b7355db8502a54c5a" category="section-title">CPU 親和性</block>
  <block id="74f896768ee487acfd4c42370c202bed" category="paragraph">SQL Server 可透過兩個選項來支援處理器關聯性：</block>
  <block id="cb315fb2b62c836ba51357d46f2e8c3f" category="list-text">CPU 親和性遮罩</block>
  <block id="cb00a2408ea648cf85edfd7dbb23fbe0" category="list-text">關聯性 I/O 遮罩</block>
  <block id="49e103832576f4486179df8868372d17" category="section-title">平行度上限（ MAXDOP ）</block>
  <block id="a99f7ebb3b0f5b0ecea93ed586b2a17d" category="section-title">最大工作執行緒數</block>
  <block id="aff27140f50a549b1331add8d5025f7e" category="paragraph">當大量用戶端連線至 SQL Server 時、最大工作執行緒選項可協助最佳化效能。</block>
  <block id="decd79137325e1efbc7b994f946ea24f" category="paragraph">預設值為 0 、可讓 SQL Server 在啟動時自動設定工作執行緒數量。這適用於大多數系統。Max Worker 執行緒是進階選項、如果沒有經驗豐富的資料庫管理員（ DBA ）的協助、就不應變更。</block>
  <block id="29d04e616d2293c4c7538dd6226feac5" category="section-title">使用 SQL Server Management Studio 設定最大工作執行緒。</block>
  <block id="44dbc82801d84781083ed9e23b63be00" category="list-text">對於 &lt; 或 = 至 8 核心： tempdb 資料檔案 = 核心數</block>
  <block id="6203fcdbdad10bb603fd00edd2f0fcf5" category="list-text">若為 &gt; 8 核心： 8 個 tempdb 資料檔案</block>
  <block id="0424163d6b24f29436021dfd7072863b" category="paragraph">從 SQL Server 2016 開始、在安裝期間會自動偵測作業系統可見的 CPU 核心數量、並根據該數量、 SQL Server 會計算和設定最佳效能所需的 tempdb 檔案數量。</block>
  <block id="3b5b2ca12603a36517ce602ffe47361c" category="list-text">NetApp SnapCenter 做為備份軟體、包括：</block>
  <block id="36a92a010308100e1efc10d9eb98c369" category="list-text">適用於Microsoft Windows的解決方案SnapCenter</block>
  <block id="ec51578d7d8f930329548bf3d00d7038" category="list-text">適用於 SQL Server 的 SnapCenter 外掛程式</block>
  <block id="a6d698a68f555339f6e91957f636ad69" category="list-text">Microsoft SQL Server 架構與管理</block>
  <block id="697ea025ecb303d4f40d1bf3a8b4bde0" category="inline-link-macro">NetApp互通性對照表工具IMT （不含）</block>
  <block id="fbd4c4f9516af91c6c3cb5fa35fb5720" category="doc">Microsoft SQL Server 儲存考量</block>
  <block id="3da07c62fca4dd242f7ffcfcf72998be" category="section-title">資料儲存設計</block>
  <block id="9e45010900186b3cbbe04f954a6f3562" category="paragraph">對於不使用SnapCenter 支援功能執行備份的SQL Server資料庫、Microsoft建議將資料和記錄檔放在不同的磁碟機上。對於同時更新和要求資料的應用程式、記錄檔會密集寫入、而且資料檔（視應用程式而定）會密集讀寫。對於資料擷取、不需要記錄檔。因此、您可以從放在自己磁碟機上的資料檔案來滿足資料要求。</block>
  <block id="df018ea4abdb71f91802ea1d4fb0fb37" category="inline-link-macro">將資料和記錄檔放在不同的磁碟機上</block>
  <block id="f2f25c68d67c561be1926b4b06e676b0" category="paragraph">當您建立新資料庫時、Microsoft建議您為資料和記錄指定個別的磁碟機。若要在資料庫建立之後移動檔案、資料庫必須離線。如需更多 Microsoft 建議、請參閱 <block ref="04fab8828edf0d2e95eff3c4f124b372" category="inline-link-macro-rx"></block>。</block>
  <block id="d5350d8759b1ec84607e47908809058e" category="section-title">集合體</block>
  <block id="77f1d6b9cbcaf3663f6bdd19a821e773" category="list-text">一個大型Aggregate可讓您以最有效率的方式使用磁碟空間。</block>
  <block id="63d9962fabe500361986d05317bd65a5" category="paragraph">若要獲得高可用度（ HA ）、請將 SQL Server Always On Availability Group 次要同步複本放在 Aggregate 中的獨立儲存虛擬機器（ SVM ）上。為了進行災難恢復、請將非同步複本放在 DR 站台中屬於獨立儲存叢集的集合上、並使用 NetApp SnapMirror 技術複寫內容。NetApp 建議在集合體中至少有 10% 的可用空間、以獲得最佳的儲存效能。</block>
  <block id="c6f01c78bfe0a0a495cb5d3ed77824a9" category="section-title">磁碟區</block>
  <block id="17fce39141e6fa457c789ce2c3239b0c" category="section-title">Volume 設計考量</block>
  <block id="d1c9fdbcdbb8521971decf35c6d1c0c8" category="paragraph">在您建立資料庫 Volume 設計之前、請務必瞭解 SQL Server I/O 模式和特性的差異、視工作負載及備份與還原需求而定。請參閱下列 NetApp 建議的彈性磁碟區：</block>
  <block id="674343739e297abb52c536a453ebaad0" category="list-text">請使用 NTFS 掛載點而非磁碟機代號、以超越 Windows 中 26 個磁碟機代號的限制。使用 Volume 掛載點時、一般建議將 Volume 標籤命名為與掛載點相同的名稱。</block>
  <block id="4176288dbc134524f79476ba4e57e3aa" category="list-text">Tempdb 是 SQL Server 用來做為暫用工作區的系統資料庫、特別是用於 I/O 密集型 DBCC CHECKDB 作業。因此、請將此資料庫放在具有獨立磁碟集的專用磁碟區上。在磁碟區數是一項挑戰的大型環境中、您可以將Tempdb整合為較少的磁碟區、並在經過仔細規劃之後、將其儲存在與其他系統資料庫相同的磁碟區中。對 tempdb 的資料保護不是高優先順序、因為每次重新啟動 SQL Server 時都會重新建立此資料庫。</block>
  <block id="b703a2ceaabee81dd9dfcfb3a4b738ee" category="list-text">請確定使用者資料庫檔案和用於儲存記錄備份的記錄目錄位於不同的磁碟區、以防止保留原則在與 SnapVault 技術搭配使用時覆寫快照。</block>
  <block id="ae72f885471636cbfd0dbe902ddf24e1" category="list-text">如果您使用 DiskManager 或其他工具建立 LUN 、請確保在格式化 LUN 時、將分割區的分配單元大小設為 64K 。</block>
  <block id="ac4782a9243acaaff52164f9e47417d5" category="inline-link-macro">適用於現代 SAN 的 ONTAP 最佳實務做法下的 Microsoft Windows 和原生 MPIO</block>
  <block id="934e206705ddafc720e4a8f25a4acded" category="list-text">請參閱 <block ref="95506eaa4fca841adc20747ae4650d10" category="inline-link-macro-rx"></block> 將 Windows 上的多重路徑支援套用至 MPIO 內容中的 iSCSI 裝置。</block>
  <block id="31a8d85b6a44cffc2c7dfc6387696f31" category="section-title">記錄目錄</block>
  <block id="29766ed5967263787fface0a4ad3396f" category="paragraph">主機記錄目錄的大小計算方式如下：
主機記錄目錄大小 = （（最大 DB LDF 大小 x 每日記錄變更率 % ） x （快照保留） ÷ （ 1 - LUN 額外負荷空間 % ）
主機記錄目錄大小調整公式假設 LUN 負荷空間為 10%</block>
  <block id="31333b887781902e13c263570523ddc1" category="paragraph">將記錄目錄放在專用磁碟區或 LUN 上。主機記錄目錄中的資料量取決於備份的大小和保留備份的天數。SnapCenter 每個 SQL Server 主機只允許一個主機記錄目錄。您可以在 SnapCenter --&gt; 主機 --&gt; 組態外掛程式中設定主機記錄目錄。</block>
  <block id="e815059019027c04aa969a50787d5b34" category="paragraph">* NetApp 建議 * 下列主機記錄目錄：</block>
  <block id="07ae4edb1ccfbfe1f5da6006c95ee4a9" category="list-text">請確定主機記錄目錄未被任何其他可能毀損備份快照資料的資料類型共用。</block>
  <block id="991bd1f492a593453f65c2a23c1f1612" category="list-text">請勿將使用者資料庫或系統資料庫放置在裝載點的 LUN 上。</block>
  <block id="7b01578e73f5081fecdcc6dedf28aa3c" category="list-text">使用 SnapCenter 精靈將資料庫移轉至 NetApp 儲存設備、以便將資料庫儲存在有效位置、進而成功執行 SnapCenter 備份與還原作業。請記住、移轉程序會中斷運作、並可能導致資料庫在移轉進行中時離線。</block>
  <block id="b2d0e2f60ee139155b728ef6933efe7c" category="list-text">SQL Server 的容錯移轉叢集執行個體（ FCI ）必須符合下列條件：</block>
  <block id="863fda0972208e1e15d0c4a16d6915af" category="list-text">如果您使用容錯移轉叢集執行個體、則主機記錄目錄 LUN 必須是與要備份 SnapCenter 的 SQL Server 執行個體位於同一個叢集群組中的叢集磁碟資源。</block>
  <block id="ddb1104e1e71caabad3e7639c7675af8" category="list-text">如果您使用容錯移轉叢集執行個體、則使用者資料庫必須放置在共用 LUN 上、這些 LUN 是指派給與 SQL Server 執行個體相關聯的叢集群組的實體磁碟叢集資源。</block>
  <block id="bca5f9a18696e080113088282fe481de" category="doc">Microsoft SQL Server 記憶體組態</block>
  <block id="02578ec0e8ce2fbef37ca792fd20c289" category="section-title">最大伺服器記憶體</block>
  <block id="6e345f11e9b2856a7ac40d6cf283606b" category="paragraph">在具有多個 SQL Server 執行個體的 SQL Server 叢集上、每個執行個體可能會爭用資源。為每個 SQL Server 執行個體設定記憶體限制、有助於保證每個執行個體的最佳效能。</block>
  <block id="318b34a3511a1be6d179a73303da2077" category="admonition">* NetApp 建議 * 為作業系統保留至少 4GB 至 6GB 的 RAM 、以避免效能問題。</block>
  <block id="cd151dbdf946ad6bd27e1d55ea1cd029" category="section-title">使用 SQL Server Management Studio 調整最小和最大伺服器記憶體。</block>
  <block id="998c5e632fa0f987c20c182fc9322f67" category="section-title">不一致的記憶體存取</block>
  <block id="b3b5cd113ed637ebe6cb28eab322307a" category="section-title">索引會建立記憶體</block>
  <block id="631c6718cc62ad33b6e3b3b48d754569" category="paragraph">它控制最初分配給建立索引的最大 RAM 容量。此選項的預設值為 0 、這表示它是由 SQL Server 自動管理。不過、如果您在建立索引時遇到困難、請考慮增加此選項的值。</block>
  <block id="8c91aa3f5264c57bd2d2e66bd70f2ad1" category="section-title">每個查詢的最小記憶體</block>
  <block id="181341700086c5e2f2259774b2aaa59c" category="inline-link-macro">頁面壓縮實作</block>
  <block id="46c6aaf21d639d23d4f297a1f6922d9a" category="paragraph">資料列壓縮會變更資料儲存格式。例如、它會將整數和小數位數變更為可變長度格式、而非原生固定長度格式。它也會消除空白、將固定長度字元字串變更為可變長度格式。頁面壓縮會實作列壓縮及其他兩種壓縮策略（前置壓縮和字典壓縮）。您可以在中找到有關頁面壓縮的詳細資料 <block ref="88eab602b149fe360da37498ad5cdeae" category="inline-link-macro-rx"></block>。</block>
  <block id="0d629ff07f9214182fa91977089ff029" category="paragraph">SQL Server 2008 及更新版本的 Enterprise 、 Developer 及 Evaluation 版本目前支援資料壓縮。雖然壓縮可以由資料庫本身執行、但在 SQL Server 環境中很少會發生這種情況。</block>
  <block id="c6757fbc56df4ba20f0ef165aeb214d0" category="paragraph">以下是管理 SQL Server 資料檔案空間的建議</block>
  <block id="46344e63db1ea2128cc47543b10a0f96" category="list-text">在 SQL Server 環境中使用自動精簡配置、以提高空間使用率、並在使用空間保證功能時、降低整體儲存需求。</block>
  <block id="924e1b131d6b3a2846efd1a81de8eac1" category="list-text">對於大多數常見的部署組態、請使用自動擴充、因為儲存管理員只需要監控集合體中的空間使用量。</block>
  <block id="752d71c042ef775879f6db705ccf6b31" category="section-title">空間回收</block>
  <block id="89f8656e4e33094d6011ef9aaa8fa8de" category="paragraph">空間回收可定期啟動、以恢復 LUN 中未使用的空間。有了 SnapCenter 、您可以使用下列 PowerShell 命令來啟動空間回收。</block>
  <block id="aa864feb1e600aa376e91ac119da387b" category="paragraph">如果您需要執行空間回收、則此程序應在低活動期間執行、因為它最初會在主機上使用週期。</block>
  <block id="5c014f8939a89da0166a347a0237cf4f" category="section-title">SnapCenter</block>
  <block id="1567bc0803275089d7cbc1ffc468158c" category="inline-link-macro">TR-4714 ：使用 NetApp SnapCenter 的 SQL Server 最佳實務指南</block>
  <block id="17f58c1b5cb5feb5dcaf49ca87298c00" category="paragraph">如需適用於 SnapCenter 的 SQL Server 外掛程式的詳細資訊、請參閱 <block ref="c94de7812b9bc9ed76b3c4005974958d" category="inline-link-macro-rx"></block>。</block>
  <block id="91a7baba41dc4b5f958101b261cf179b" category="section-title">使用 T-SQL 快照保護資料庫</block>
  <block id="02e19b2989ebddca9ad3778807bdc426" category="paragraph">以下是備份工作流程範例：</block>
  <block id="bd03301405e4dd8f2460ff1788765ac4" category="list-text">使用新的備份群組和備份伺服器命令、同時在儲存磁碟區上執行多個資料庫的快照。</block>
  <block id="a3b19be7df3ddff7295558d9934cd9b6" category="list-text">執行完整備份或僅複製完整備份。這些備份也會記錄在 msdb 中。</block>
  <block id="e2d06152222f63515f4b83229cb5444c" category="list-text">使用快照完整備份後以正常串流方式進行的記錄備份、執行時間點還原。如果需要、也支援串流差異備份。</block>
  <block id="a7a2496066febda8d325e0964e434481" category="inline-link-macro">瞭解 T-SQL 快照的 Microsoft 文件</block>
  <block id="bf06f3f95c5b653499bb4ac53ba44c95" category="paragraph">若要深入瞭解、請參閱 <block ref="2ba8392a398067f6d2e5f6e4167e9d00" category="inline-link-macro-rx"></block>。</block>
  <block id="450eb6d84ec721a20f17b7778b24b457" category="doc">Microsoft SQL Server 工作負載</block>
  <block id="5306de2e4bff067a10c1c9b5aafe5920" category="paragraph">理論上、 SQL Server （ 64 位元）支援每個執行個體 32,767 個資料庫、以及 524272TB 的資料庫大小、雖然一般安裝通常有多個資料庫。不過 SQL Server 可以處理的資料庫數量取決於負載和硬體。看到 SQL Server 執行個體託管數十個、數百個甚至數千個小型資料庫、並不罕見。</block>
  <block id="9a3f42cec243006996ab4580d3ce5d56" category="paragraph">每個資料庫都包含一或多個資料檔案、以及一或多個交易記錄檔。交易記錄會儲存資料庫交易的相關資訊、以及每個工作階段所做的所有資料修改。每次修改資料時、 SQL Server 都會在交易記錄中儲存足夠的資訊、以復原（復原）或重做（重新執行）動作。SQL Server 交易記錄是 SQL Server 在資料完整性和健全性方面聲譽的重要一環。交易記錄對於 SQL Server 的原子性、一致性、隔離和耐用性（ ACID ）功能至關重要。一旦資料頁發生任何變更、 SQL Server 就會立即寫入交易記錄檔。每個 Data 操縱語言（ DML ）陳述式（例如、 SELECT 、 INSERT 、 UPDATE 或 DELETE ）都是完整的交易、而且交易記錄會確保整個以 Set 為基礎的作業都能進行、確保交易的完整性。</block>
  <block id="cbe6958e46fbab53cdbdb9deb2d75938" category="paragraph">每個資料庫都有一個主要資料檔案、預設會有 .mdf 副檔名。此外、每個資料庫都可以有次要資料庫檔案。根據預設、這些檔案的副檔名為 .NDF 。</block>
  <block id="811b578b6dfbb4a4ca16ba0c0911e3df" category="paragraph">所有資料庫檔案都會分組為檔案群組。檔案群組是邏輯單元、可簡化資料庫管理。它們允許在邏輯物件放置和實體資料庫檔案之間進行分隔。當您建立資料庫物件表格時、您可以在檔案群組中指定它們應該放置的位置、而無需擔心基礎資料檔案組態。</block>
  <block id="3ac46c2f04dec9d215efbe44d307a020" category="admonition">* NetApp 建議 * 避免將主要檔案群組用於系統物件以外的任何項目。為使用者物件建立個別的檔案群組或一組檔案群組、可簡化資料庫管理和災難恢復、尤其是大型資料庫。</block>
  <block id="e3fc56c012a5d0c9f92dff9b49bcc80d" category="paragraph">您可以在建立資料庫或將新檔案新增至現有資料庫時指定初始檔案大小和自動成長參數。SQL Server 在選擇要將資料寫入哪個資料檔案時、會使用比例填滿演算法。它會將大量資料按比例寫入檔案中的可用空間。檔案中的可用空間越大、其處理的寫入次數就越多。</block>
  <block id="91d249de86b62102d6324849de2360fe" category="admonition">* NetApp 建議 * 單一檔案群組中的所有檔案都具有相同的初始大小和自動成長參數、其成長大小以 MB 為單位定義、而非百分比。這有助於比例填滿演算法在資料檔案之間平均平衡寫入活動。</block>
  <block id="54db492ee9e4d356cc8722d1f4126f77" category="paragraph">SQL Server 一律會將交易記錄檔歸零、而且該行為無法變更。不過、您可以啟用或停用即時檔案初始化來控制資料檔案是否正在歸零。啟用即時檔案初始化有助於加速資料檔案成長、並縮短建立或還原資料庫所需的時間。</block>
  <block id="92208bd4d9c6fec3f7c1dedeca62e135" category="paragraph">與即時檔案初始化有關的安全風險較小。啟用此選項時、資料檔案的未分配部分可能會包含先前刪除的作業系統檔案資訊。資料庫管理員可以檢查這類資料。</block>
  <block id="2b222ad4000e6e966783fd7bc480180e" category="paragraph">您可以將 SA_SA_SAM_VOLUM_NAME 權限（也稱為「執行 Volume 維護工作」）新增至 SQL Server 啟動帳戶、以啟用即時檔案初始化。您可以在本機安全性原則管理應用程式（ secpol.msc ）下執行此動作、如下圖所示。開啟「執行 Volume 維護工作」權限的內容、並將 SQL Server 啟動帳戶新增至該處的使用者清單。</block>
  <block id="c622e0142ed854a10f98fcaa8b3487f8" category="paragraph">若要檢查權限是否已啟用、您可以使用下列範例中的程式碼。此程式碼會設定兩個追蹤旗標、強制 SQL Server 將其他資訊寫入錯誤記錄檔、建立小型資料庫、以及讀取記錄內容。</block>
  <block id="eba8c32bde087b29aaa1fe0d3bb32ef3" category="paragraph">如果未啟用即時檔案初始化、 SQL Server 錯誤記錄會顯示 SQL Server 除了將 ldf 記錄檔歸零之外、還會將 MDF 資料檔案歸零、如下例所示。當啟用即時檔案初始化時、它只會顯示記錄檔的零位。</block>
  <block id="37fbf1be337695452699ab9df948aa25" category="paragraph">疑難排解效能問題可能很複雜、因為您必須找出哪個執行個體是根本原因。此問題與作業系統授權和 SQL Server 授權的成本相比較。如果應用程式效能至關重要、則強烈建議使用專用執行個體。</block>
  <block id="c840abede1d1bcf78e7b3e30048c08b1" category="paragraph">Microsoft 在伺服器層級的每個核心授權 SQL Server 、而非每個執行個體授權。因此、資料庫管理員想要安裝伺服器能處理的 SQL Server 執行個體數量、以節省授權成本、這可能會導致日後發生重大效能問題。</block>
  <block id="8a77155b45f0f2313c8ebf3d755463e5" category="admonition">* NetApp 建議 * 盡可能選擇專屬的 SQL Server 執行個體、以獲得最佳效能。</block>
  <block id="df7423789cebcf51de121abdae4181c3" category="summary">ONTAP 與企業應用程式</block>
  <block id="eaf36c98b91893b7f79bd5184a23d377" category="doc">Solaris</block>
  <block id="fb04d97697a77a89d0c3f5c09cd9ba47" category="paragraph">特定於 Solaris OS 的組態主題。</block>
  <block id="eefc332f1bd0a0aa81d0ce222989294f" category="section-title">Solaris NFS 掛載選項</block>
  <block id="3e484486d582145f6d93ca5f8c71e228" category="paragraph">下表列出單一執行個體的 Solaris NFS 掛載選項。</block>
  <block id="6622c14ce91b6b9683505626a5eebdd2" category="cell">檔案類型</block>
  <block id="f18f8a29d3e2281d374f43c78cf8f0f1" category="cell">掛載選項</block>
  <block id="a45543a64530673135f37ff8f9e95e69" category="cell">ADR 首頁</block>
  <block id="93a02670f814a2df6c830194a7244ea9" category="cell"><block ref="623bbf58c0b2f552d891a1c276bcc3bc" prefix="" category="inline-code"></block></block>
  <block id="80d52d74fd5c383b43f91575d569b42c" category="cell">控制檔
資料檔案
重作記錄</block>
  <block id="73cf9d3814b8678439c37316096219b1" category="cell"><block ref="4c899c62e1ffeb12078476828bb54351" prefix="" category="inline-code"></block></block>
  <block id="72d33cb5c8b7ff5f7fd6a894094b0697" category="cell"><block ref="e1f651debac4f720c13ae930ff3ca14a" prefix="" category="inline-code"></block></block>
  <block id="3f490427e0bf55dc5c837e7b0d4c651c" category="cell"><block ref="b9ce73264210e6d0faa4115ce7525610" prefix="" category="inline-code"></block></block>
  <block id="b00b0ab6e8494db1a230bf3da7f42fd6" category="paragraph">的用途<block ref="545e1db0caafaa47ef37ce893c8fb92c" prefix=" " category="inline-code"></block> 已獲證實、可移除在儲存系統上取得和釋放鎖定的相關延遲、大幅提升客戶環境的效能。在將多個伺服器設定為掛載相同檔案系統的環境中、請謹慎使用此選項、並將 Oracle 設定為掛載這些資料庫。雖然這是非常不尋常的組態、但只有少數客戶使用。如果第二次意外啟動某個執行個體、可能會因為 Oracle 無法偵測到外部伺服器上的鎖定檔案而導致資料毀損。NFS 鎖定不會提供保護；如同 NFS 第 3 版一樣、它們只是建議事項。</block>
  <block id="f480015b57b289b7dad1473ee5c55216" category="paragraph">因為<block ref="545e1db0caafaa47ef37ce893c8fb92c" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block> 參數是互斥的、這一點很重要<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 存在於中<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 檔案就是這樣<block ref="6887bae4cda2d09a283a165c5be3f2b8" prefix=" " category="inline-code"></block> 已使用。如果沒有此參數、就會使用主機作業系統緩衝區快取、而且效能可能會受到負面影響。</block>
  <block id="5171d5dfdc21b0941b921796638c10a9" category="paragraph">下表列出了 Solaris NFS RAC 掛載選項。</block>
  <block id="38e4e10abf410c92cd13e9cb4d54ae35" category="cell"><block ref="41a82b9bd64cb001f8913a34614b00d1" prefix="" category="inline-code"></block></block>
  <block id="e72cc50c204d77a1e47f0dcc8ad28a56" category="cell">控制檔
資料檔案
重作記錄</block>
  <block id="98ee9e91a49f27abbd9dc831afa9fae5" category="cell"><block ref="f3a0fd4a197a2eae60d2ef904e5366f1" prefix="" category="inline-code"></block></block>
  <block id="f93eecf9c582d76d4e14292dc34c79f8" category="cell">CRS/ 投票</block>
  <block id="42c82995de255264e2a8690c3149c16a" category="cell">專屬<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block></block>
  <block id="b71e04a676ec52e65edb52c138f2ad98" category="cell"><block ref="ac15a7c050732bc5169b6c17ce30f859" prefix="" category="inline-code"></block></block>
  <block id="273f714e976e2a709a6abe18d34e4b61" category="cell">共享<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block></block>
  <block id="2052aa052eee25e077178cd737b68f47" category="cell"><block ref="18f533bce293643d1004086db883dd03" prefix="" category="inline-code"></block></block>
  <block id="e9d3beba8b6a40da6f8074236ca3ddbc" category="paragraph">單一執行個體與 RAC 掛載選項之間的主要差異在於新增<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block> 至掛載選項。此新增功能可停用主機作業系統快取、使 RAC 叢集中的所有執行個體都能一致地檢視資料狀態。雖然使用<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 參數<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 停用主機快取的效果相同、仍需使用<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block>。</block>
  <block id="983c4ff0cb78851d95be06277152653f" category="paragraph">原因<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 為共享的必要項目<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> 部署是為了促進檔案的一致性、例如 Oracle 密碼檔案和 spfiles 。如果 RAC 叢集中的每個執行個體都有專用的<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>，不需要此參數。</block>
  <block id="5a11994cffaa4d0a9c8594d2223e3e96" category="section-title">Solaris UFS 掛載選項</block>
  <block id="130c5ffb786e38c2e6648fd53593681a" category="paragraph">NetApp 強烈建議您使用記錄掛載選項、以便在 Solaris 主機當機或 FC 連線中斷時保留資料完整性。記錄掛載選項也可保留 Snapshot 備份的使用性。</block>
  <block id="516f7006de2e9b1f7f871d961db4a1ca" category="section-title">Solaris ZFS</block>
  <block id="a92c2c52c7360246c6da2b1169e0fa50" category="paragraph">必須仔細安裝和設定 Solaris ZFS 、才能提供最佳效能。</block>
  <block id="c9208a3ad95d5ce3d9e2ba1839426251" category="section-title">mvector</block>
  <block id="bc7e9b3c34345bf9ebe88467d6714f1b" category="paragraph">如果這項變更發生任何非預期的問題、您可以以 root 執行下列命令、輕鬆地將其還原：</block>
  <block id="6ff9f4444ac481652f4412b5e1623846" category="section-title">核心</block>
  <block id="78d06f587305b9e5481c8cf660693a61" category="paragraph">可靠的 ZFS 效能需要修補 Solaris 核心、以因應 LUN 對齊問題。此修正程式是隨 Solaris 10 中的修補程式 147440-19 和適用於 Solaris 11 的 SRU 10.5 一起推出的。只能將 Solaris 10 及更新版本與 ZFS 搭配使用。</block>
  <block id="db8880d80ab20f2f01a010e5c454f7fb" category="section-title">LUN 組態</block>
  <block id="3b296d65c0c37979abe39ac7f6d8e1d8" category="paragraph">若要設定 LUN 、請完成下列步驟：</block>
  <block id="3bdc2a5622b76404f8b0ce2fc774e69a" category="list-text">建立類型的 LUN<block ref="7bee0477f82303aa43de5d78f7b9cb05" prefix=" " category="inline-code"></block>。</block>
  <block id="c06f6c6685c06bb821295b3a6d5e580c" category="list-text">安裝所指定的適當主機公用程式套件（ Huk ） <block ref="b5b16f3cdb0eb25a282348ba54f8c677" category="inline-link-macro-rx"></block>。</block>
  <block id="33db73c9b3936cb8eaae825d3101f60c" category="inline-link-macro">最新文件</block>
  <block id="c8646086dca29c1d978ab285faa93709" category="list-text">請依照 Huk 中的說明進行操作、完全符合上述說明。以下概述基本步驟、但請參閱 <block ref="33574dfffc2cb6d01be0edb6738c51bb" category="inline-link-macro-rx"></block> 以瞭解正確的程序。</block>
  <block id="6c06455cad171d61eac3593147bd71d6" category="list-text">執行<block ref="3062dc928daa4d85f6e34b6dea110a00" prefix=" " category="inline-code"></block> 更新的公用程式<block ref="d5416d340f5bec1fcb3addb6ae7d059e" prefix=" " category="inline-code"></block> 檔案：這樣做可讓 SCSI 磁碟機正確探索 ONTAP LUN 。</block>
  <block id="7ec6668202fa9a677238143b0445102f" category="list-text">請遵循所提供的指示<block ref="3062dc928daa4d85f6e34b6dea110a00" prefix=" " category="inline-code"></block> 啟用多重路徑輸入 / 輸出（ MPIO ）的公用程式。</block>
  <block id="b53abe6c0013125abea171427b351ccc" category="list-text">重新開機。此步驟是必要步驟、以便在整個系統中辨識任何變更。</block>
  <block id="b88caedbe9708683eed783eb534ae5f6" category="list-text">分割 LUN 並確認它們已正確對齊。請參閱「附錄 B ： WAFL 校準驗證」、瞭解如何直接測試及確認校準。</block>
  <block id="a0c1c26e783204cf713b2e1f0823aab3" category="section-title">zPools</block>
  <block id="c81b8fe4a368c32102406e65fc41a227" category="inline-link-macro">LUN 組態</block>
  <block id="869dc3a8daf591c7f33e5bb32a4a63c9" category="paragraph">的價值<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 預設為 9 、表示 2^9 或 512 位元組。為了獲得最佳效能<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 值必須為 12 （ 2^12=4K ）。此值是在創建 zpool 時設置的，不能更改，這意味着 zpool 中的數據<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 除 12 個以外、應將資料複製到新建立的 zPool 、以進行移轉。</block>
  <block id="6a00a2262e030c2656588743cb031710" category="paragraph">建立 zPool 之後、請驗證的值<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 繼續之前。如果值不是 12 、則表示未正確探索到 LUN 。銷毀 zpool 、確認相關主機公用程式文件中顯示的所有步驟均已正確執行、然後重新建立 zPool 。</block>
  <block id="15ec722ce3f6694d12f89aeb5b621941" category="section-title">zPools 和 Solaris LDoms</block>
  <block id="8826ef54a7d108df25ed6921b5129cb6" category="paragraph">Solaris LDoms 還需要確保 I/O 對齊正確無誤。雖然 LUN 可能會被正確發現為 4K 裝置、但 LDOM 上的虛擬 vdsk 裝置不會繼承 I/O 網域的組態。以該 LUN 為基礎的 vdsk 預設為 512 位元組區塊。</block>
  <block id="9a984f24f825e4f0bca1f36e11acbca9" category="paragraph">需要額外的組態檔案。首先、必須針對 Oracle 錯誤 15824910 修補個別的 LDOM 、才能啟用其他組態選項。此修補程式已移轉至所有目前使用的 Solaris 版本。一旦 LDOM 獲得修補、就可以依照下列方式設定新的正確對齊 LUN ：</block>
  <block id="e0f306ab540315b015db849b1ae9099e" category="list-text">識別要在新的 zPool 中使用的 LUN 或 LUN 。在此範例中、它是 c2d1 裝置。</block>
  <block id="f469046d419183a7be08ed5a13d2c65e" category="list-text">擷取要用於 ZFS Pool 的裝置之 VDC 執行個體：</block>
  <block id="bcaa63dcd5db76bffd8b867e8720a272" category="list-text">編輯<block ref="ebceeaa7b6ce5abf6c8de7177255fef5" prefix=" " category="inline-code"></block>：</block>
  <block id="ec960a08b4666fe258b6e005064378ab" category="paragraph">這表示裝置執行個體 1 的區塊大小為 4096 。</block>
  <block id="3df4cdc476a0c3a5a930597e9d8da84c" category="paragraph">另一個範例是假設需要將 vdsk 執行個體 1 至 6 設定為 4K 區塊大小和<block ref="74a491ed941b00d0c9909d488eee67bf" prefix=" " category="inline-code"></block> 內容如下：</block>
  <block id="dfed6d8974f03c5b31f20c9c5c2bbe66" category="list-text">最終結果<block ref="3328fba80b08b36663ffae0684f6c578" prefix=" " category="inline-code"></block> 檔案應包含下列項目：</block>
  <block id="764a2caff05993fc0d3eff5de7b225e9" category="cell">注意</block>
  <block id="5c442834a7707cc96719e468c87b2ff6" category="cell">設定 VC.conf 並建立 vdsk 之後、必須重新啟動 LDOM 。無法避免此步驟。區塊大小變更只會在重新開機後生效。繼續使用 zpool 組態、並確保如前所述、移位已正確設定為 12 。</block>
  <block id="2138e0b461ac7e557539bb0b33bde81a" category="section-title">ZFS Intent Log （ ZIL ）</block>
  <block id="5477cebfd480a13008afdd16bea2b3f9" category="paragraph">一般而言、沒有理由在不同的裝置上找到 ZFS Intent Log （ ZIL ）。記錄檔可以與主集區共用空間。獨立 ZIL 的主要用途是使用缺乏現代儲存陣列寫入快取功能的實體磁碟機。</block>
  <block id="26a004aeb043de19f767bd7daa39cf2f" category="section-title">logbias</block>
  <block id="07fff183bc4c01bf9bbb21a48b389845" category="paragraph">設定<block ref="26a004aeb043de19f767bd7daa39cf2f" prefix=" " category="inline-code"></block> 託管 Oracle 資料的 ZFS 檔案系統參數。</block>
  <block id="ac01fbc5e98d6450f3b565d0617f4a55" category="paragraph">使用此參數可降低整體寫入層級。根據預設值、寫入的資料會先提交至 ZIL 、然後再提交至主儲存池。此方法適用於使用純磁碟機組態的組態、包括 SSD 型 ZIL 裝置和主儲存池的旋轉媒體。這是因為它允許在可用的最低延遲媒體上、在單一 I/O 交易中進行認可。</block>
  <block id="c6cc0f147c42f124079d7fc1a0761886" category="paragraph">使用包含其快取功能的現代化儲存陣列時、通常不需要使用此方法。在極少數情況下、可能需要在單一交易中寫入記錄檔、例如由高度集中、對延遲敏感的隨機寫入所組成的工作負載。寫入放大的形式會產生影響、因為記錄的資料最終會寫入主儲存池、導致寫入活動加倍。</block>
  <block id="92b9531657a4ce6a31c623d889a2c55d" category="section-title">直接 I/O</block>
  <block id="387f4a4c250ed7a5003f3f6a19abfd1f" category="paragraph">許多應用程式（包括 Oracle 產品）都可以啟用直接 I/O 、藉此略過主機緩衝區快取此策略無法在 ZFS 檔案系統中正常運作。雖然會略過主機緩衝區快取、但 ZFS 本身仍會繼續快取資料。使用 Fio 或 Sio 等工具執行效能測試時、這項動作可能會產生誤導性的結果、因為很難預測 I/O 是否到達儲存系統、或是是否在作業系統中本機快取。此動作也會讓使用此類模擬測試來比較 ZFS 效能與其他檔案系統的情況變得非常困難。實際上、在真實使用者工作負載下、檔案系統效能幾乎沒有任何差異。</block>
  <block id="ec79b30d56e7bae54aa7efedccc47e93" category="section-title">多個 zPools</block>
  <block id="f5aa5b31f0536ddcdb748ae360d91358" category="paragraph">必須在 zpool 層級執行快照型備份、還原、複製及歸檔 ZFS 型資料、而且通常需要多個 zPools 。zpool 類似於 LVM 磁碟群組、應使用相同的規則進行設定。例如、資料庫的配置最好是存放在資料檔案上<block ref="f1fb162e58045170396a0ac29d648fa5" prefix=" " category="inline-code"></block> 以及駐留在上的歸檔記錄、控制檔和重做記錄<block ref="92073f03d18c8eaec3eb5e0908210e1a" prefix=" " category="inline-code"></block>。此方法允許標準熱備份、將資料庫置於熱備份模式、然後是的快照<block ref="f1fb162e58045170396a0ac29d648fa5" prefix=" " category="inline-code"></block>。接著會從熱備份模式移除資料庫、強制進行記錄歸檔、並建立快照<block ref="92073f03d18c8eaec3eb5e0908210e1a" prefix=" " category="inline-code"></block> 已建立。還原作業需要卸載 zfs 檔案系統、並在執行 SnapRestore 還原作業之後、將 zPool 完全離線。然後可以重新上線並恢復資料庫。</block>
  <block id="f1110589be196c2310808482067fce1b" category="section-title">filesystemio_options</block>
  <block id="c271ff9f255f2d215054d508448781a3" category="paragraph">Oracle 參數<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 使用 ZFS 的方式不同。如果<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block> 或<block ref="6887bae4cda2d09a283a165c5be3f2b8" prefix=" " category="inline-code"></block> 使用時、寫入作業會同步並略過 OS 緩衝區快取、但讀取會由 ZFS 進行緩衝。此動作會導致效能分析方面的困難、因為有時會被 ZFS 快取攔截和服務 I/O 、使儲存延遲和總 I/O 比預期的要少。</block>
  <block id="b1fd823d262032e04291313f72be9452" category="doc">HP-UX</block>
  <block id="8ec258cd0b6ab050fc478a415a20f2e9" category="section-title">HP-UX NFS 掛載選項</block>
  <block id="7c5876d5737071c64af78562fe375386" category="paragraph">下表列出單一執行個體的 HP-UX NFS 掛載選項。</block>
  <block id="9c9fb3cc18a83e4e46165b5c3d4ce8ef" category="cell">控制檔
資料檔案
重作記錄</block>
  <block id="55b835c747261995c0e1022d234e286d" category="cell"><block ref="fa8766c679857b7d589983df0ab5bcf4" prefix="" category="inline-code"></block></block>
  <block id="189dbd39cabd57c5d2e51714d9a5b85b" category="paragraph">下表列出適用於 RAC 的 HP-UX NFS 掛載選項。</block>
  <block id="fa9da3a6a7ef8986a94c7395577c322f" category="cell"><block ref="8b080dc74532d24847a6163dcc34d93f" prefix="" category="inline-code"></block></block>
  <block id="add42ff64fa5b57e5abeab49d154a9d9" category="cell"><block ref="acdef4af05a9f0c43f72b7c600f04d62" prefix="" category="inline-code"></block></block>
  <block id="c88a7b7f83f761f7fc2979815d210140" category="cell"><block ref="d29d7b7ed8c19a99fe17fd7f3d07ea7b" prefix="" category="inline-code"></block></block>
  <block id="af8831a1b8129b099114c3237a61db88" category="paragraph">單一執行個體與 RAC 掛載選項之間的主要差異在於新增<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block> 至掛載選項。此新增功能可停用主機作業系統快取、使 RAC 叢集中的所有執行個體都能一致地檢視資料狀態。雖然使用<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 參數<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 停用主機快取的效果相同、仍需使用<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block>。</block>
  <block id="b865c6aba24c3f61595471aab993d27c" category="paragraph">原因<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 為共享的必要項目<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> 部署是為了促進檔案的一致性、例如 Oracle 密碼檔案和 spfiles 。如果 RAC 叢集中的每個執行個體都有專用的<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>，不需要此參數。</block>
  <block id="898311d838a2fa2fa41b4b52a63a7f1d" category="section-title">HP-UX VxFS 掛載選項</block>
  <block id="85b4a3d44370909d395ab8af28ff4927" category="paragraph">對於託管 Oracle 二進位檔的檔案系統、請使用下列掛載選項：</block>
  <block id="6630bbc9a901be0d038b2c39e2faf65d" category="paragraph">對於包含資料檔案、重做記錄檔、歸檔記錄檔和控制檔的檔案系統、若 HP-UX 版本不支援並行 I/O 、請使用下列掛載選項：</block>
  <block id="ed37730e0f28a631768a396e7898e197" category="paragraph">支援並行 I/O （ VxFS 5.0.1 及更新版本、或 ServiceGuard Storage Management Suite ）時、請針對包含資料檔案、重作記錄檔、歸檔記錄檔和控制檔的檔案系統、使用這些掛載選項：</block>
  <block id="f51ddb98d92e83609db075add5fba4d8" category="admonition">參數<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> 在 VxFS 環境中尤其重要。Oracle 建議在 Oracle 10g R1 及更新版本中保留此參數、除非另有特別指示。Oracle 8KB 區塊大小的預設值為 128 。如果此參數的值強制為 16 或更少、請移除<block ref="a6b02283cba560dcfdea44af66ec792c" prefix=" " category="inline-code"></block> 裝載選項、因為它可能會損害連續 I/O 效能。此步驟會損害其他效能層面、只有在的價值下才應採取<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> 必須從預設值變更。</block>
  <block id="5802d9527a43305e9e1c903bc6b5a721" category="paragraph">使用 AFD 和 ASMLib 的 Linux 作業系統專屬組態主題</block>
  <block id="2681013be5b0a9063a7ef0a8fe4d31da" category="section-title">ASMLib 區塊大小</block>
  <block id="1943673cc25055e93f0129f2baa8f499" category="paragraph">ASMLib 是選用的 ASM 管理程式庫和相關公用程式。其主要值是將 LUN 或 NFS 型檔案標記為具有人類可讀標籤的 ASM 資源。</block>
  <block id="51713fdb873939c9c333273947776b8e" category="paragraph">ASMLib 的最新版本會偵測稱為每個實體區塊指數（ LBPPBE ）的邏輯區塊的 LUN 參數。ONTAP SCSI 目標直到最近才回報此值。現在會傳回一個值、表示偏好 4KB 區塊大小。這不是區塊大小的定義、但它是使用 LBPPBE 的任何應用程式的提示、可能會更有效率地處理特定大小的 I/O 。不過、 ASMLib 會將 LBPPBE 解譯為區塊大小、並在建立 ASM 裝置時持續標記 ASM 標頭。</block>
  <block id="65242d5b49071240043eeef598415104" category="paragraph">此程序可能會以多種方式造成升級和移轉問題、全部是因為無法在同一個 ASM 磁碟群組中混合使用不同區塊大小的 ASMLib 裝置。</block>
  <block id="ea884eec0628302adc731211dc4e2cc7" category="paragraph">例如、較舊的陣列通常回報 LBPPBE 值為 0 、或根本沒有回報此值。ASMLib 會將此解譯為 512 位元組的區塊大小。較新的陣列會被解譯為具有 4KB 區塊大小。無法在同一個 ASM 磁碟群組中混合使用 512 位元組和 4KB 的裝置。這樣做會阻止用戶使用兩個陣列中的 LUN 或使用 ASM 作爲遷移工具來增加 ASM 磁盤組的大小。在其他情況下、 RMAN 可能不允許在具有 512 位元組區塊大小的 ASM 磁碟群組和具有 4KB 區塊大小的 ASM 磁碟群組之間複製檔案。</block>
  <block id="f17ff15b23b87f35906ece98842a080f" category="paragraph">首選的解決方案是修補 ASMLib 。Oracle 錯誤 ID 為 13999609 、而 Oracle 錯誤 ID 則存在於 oracleas-support-2.1.8-1 及更高版本中。此修補程式可讓使用者設定參數<block ref="442e2026c8afecc4611b52331b5d0d56" prefix=" " category="inline-code"></block> 至<block ref="b326b5062b2f0e69046810717534cb09" prefix=" " category="inline-code"></block> 在中<block ref="92a59ba9a0643a344be2d72cfd504181" prefix=" " category="inline-code"></block> 組態檔。這樣做會阻止 ASMLib 使用 LBPPBE 參數、這表示新陣列上的 LUN 現在會被辨識為 512 位元組區塊裝置。</block>
  <block id="f140ff6b2b71e70e551e39dacb9561ef" category="admonition">此選項不會變更先前由 ASMLib 戳記的 LUN 區塊大小。例如、如果具有 512 位元組區塊的 ASM 磁碟群組必須移轉至回報 4KB 區塊的新儲存系統、則選項<block ref="442e2026c8afecc4611b52331b5d0d56" prefix=" " category="inline-code"></block> 必須先設定、才能使用 ASMLib 標記新的 LUN 。  如果裝置已被 oracleasm 戳記、則必須先重新格式化、然後再重新設定新的區塊大小。首先、請使用取消設定裝置<block ref="41bd8c47b8e640da7bdb5c7dc995d435" prefix=" " category="inline-code"></block>、然後使用清除裝置的前 1GB<block ref="85c2e94baaf4d9c084e19d290907596e" prefix=" " category="inline-code"></block>。最後、如果裝置先前已分割、請使用<block ref="9a287d63dabd6fbcbbe1b12344bfe922" prefix=" " category="inline-code"></block> 命令移除過時的分割區、或只是重新開機作業系統。</block>
  <block id="75ad83418241561186f96dfed5229aaa" category="paragraph">如果無法修補 ASMLib 、可以從組態中移除 ASMLib 。這項變更會造成中斷、需要在 ASM 磁碟上加蓋戳記、並確定<block ref="0802edf7303a95bdecde832bbbe3a89c" prefix=" " category="inline-code"></block> 參數設定正確。不過、這項變更並不需要移轉資料。</block>
  <block id="ad9ac4c6d7ed2e11bdcf8c693658a482" category="section-title">ASM Filter Drive （ AFD ）區塊大小</block>
  <block id="de59cd97a61c9f9964a35d2cd8b05c88" category="paragraph">AFD 是選用的 ASM 管理程式庫、正在取代 ASMLib 。從儲存角度來看、它與 ASMLib 非常類似、但它還包含其他功能、例如能夠封鎖非 Oracle I/O 、以降低使用者或應用程式錯誤可能毀損資料的機會。</block>
  <block id="36dc27685773851e52f035f82e3deba2" category="section-title">裝置區塊大小</block>
  <block id="1ef92cf7e561e179d6079cc937b2778a" category="paragraph">如同 ASMLib 、 AFD 也會讀取 LUN 參數每個實體區塊指數（ LBPPBE ）的邏輯區塊、並依預設使用實體區塊大小、而非邏輯區塊大小。</block>
  <block id="b95ce6c503801cb15f2f9c0773c58f00" category="paragraph">如果將 AFD 新增至現有組態、而 ASM 裝置已格式化為 512 位元組區塊裝置、則可能會造成問題。AFD 驅動程式會將 LUN 辨識為 4K 裝置、而 ASM 標籤與實體裝置之間的不符將會妨礙存取。同樣地、移轉也會受到影響、因為無法在同一個 ASM 磁碟群組中混合使用 512 位元組和 4KB 的裝置。這樣做會阻止用戶使用兩個陣列中的 LUN 或使用 ASM 作爲遷移工具來增加 ASM 磁盤組的大小。在其他情況下、 RMAN 可能不允許在具有 512 位元組區塊大小的 ASM 磁碟群組和具有 4KB 區塊大小的 ASM 磁碟群組之間複製檔案。</block>
  <block id="7ef45d3a7c5fff234bf42bdf549b8339" category="paragraph">解決方案很簡單 - AFD 包含一個參數、可控制它是否使用邏輯區塊或實體區塊大小。這是影響系統上所有裝置的全域參數。若要強制 AFD 使用邏輯區塊大小、請設定<block ref="722fc896569f3d455bb5ef8f5b8c3703" prefix=" " category="inline-code"></block> 在中<block ref="dcd5fd81543c5e08e927c54e89acdd40" prefix=" " category="inline-code"></block> 檔案：</block>
  <block id="47b0d7fc4c27720c4fc326722edad27c" category="section-title">多重路徑傳輸大小</block>
  <block id="7c329811bcc7bb2f50005da5a3aff250" category="paragraph">最近的 Linux 核心變更會強制執行傳送至多重路徑裝置的 I/O 大小限制、而 AFD 則不遵守這些限制。然後會拒絕 I/O 、導致 LUN 路徑離線。結果是無法安裝 Oracle Grid 、設定 ASM 或建立資料庫。</block>
  <block id="926e4b7a2822a39a07f61474b92e9d8c" category="paragraph">解決方案是在 ONTAP LUN 的 multipath.conf 檔案中手動指定傳輸長度上限：</block>
  <block id="3d0c741146f1e8e31bc7d07128ca6e0a" category="admonition">即使目前沒有問題、如果使用 AFD 來確保未來的 Linux 升級不會意外造成問題、也應設定此參數。</block>
  <block id="d99ae60d37a12f766bc2a1f1c228fb4f" category="section-title">並行 I/O</block>
  <block id="0f3eb508f611e203aeffa91d5753648a" category="paragraph">若要在 IBM AIX 上達到最佳效能、必須同時使用 I/O如果沒有並行 I/O 、效能限制很可能是因為 AIX 執行序列化的原子 I/O 、這會產生重大的負荷。</block>
  <block id="ecdc41fc6a2adf7e41e7277e12eeb805" category="paragraph">NetApp 最初建議使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 掛載選項可強制在檔案系統上使用並行 I/O 、但此程序有缺點、不再需要。自從推出 AIX 5.2 和 Oracle 10gR1 之後、 AIX 上的 Oracle 就可以開啟個別檔案來同時執行 IO 、而不是強制在整個檔案系統上同時執行 I/O 。</block>
  <block id="445b433b62b675f0ca0bda7acb56d41b" category="paragraph">啟用並行 I/O 的最佳方法是設定<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 參數<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 至<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block>。這樣做可讓 Oracle 開啟特定檔案、以與並行 I/O 搭配使用</block>
  <block id="6206c23a0282b18352573158f9a8f9b3" category="paragraph">使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 作爲掛載選項，強制使用並行 I/O ，這可能會產生負面影響。例如、強制並行 I/O 會停用檔案系統上的預先讀取、這可能會損害 Oracle 資料庫軟體以外的 I/O 效能、例如複製檔案和執行磁帶備份。此外、 Oracle GoldenGate 和 SAP BR* Tools 等產品與使用不相容<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 裝載選項搭配特定版本的 Oracle 。</block>
  <block id="770cb9a1e9321ca3012ecbb9ec65c422" category="list-text">請勿使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 檔案系統層級的掛載選項。而是透過使用來啟用並行 I/O<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block>。</block>
  <block id="872080b7d5ec5585776f1426fb157842" category="list-text">請僅使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 如果無法設定掛載選項、則應選擇掛載選項<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block>。</block>
  <block id="0c5d86482201f32acb30cd2f7de3048f" category="section-title">AIX NFS 裝載選項</block>
  <block id="1ce07cafb2507c98c8b96ad5f35fb66a" category="paragraph">下表列出 Oracle 單一執行個體資料庫的 AIX NFS 掛載選項。</block>
  <block id="9a8f040dae3f0f15b337fe69a85239c0" category="cell"><block ref="86d38d6e2b36f6557e583e005e23d258" prefix="" category="inline-code"></block></block>
  <block id="d45a1a2afa30c30042b28f028fe75953" category="cell"><block ref="915be14765d6133923d803e1221f1513" prefix="" category="inline-code"></block></block>
  <block id="b74f5956b4bcda2de3c82ee97e192ab6" category="paragraph">下表列出 RAC 的 AIX NFS 掛載選項。</block>
  <block id="b547b55ba7f2a20602494777c5426eba" category="cell"><block ref="7e879bda961bd5b7d64d2ef4f5fb7869" prefix="" category="inline-code"></block></block>
  <block id="875abb256654bd3f6da7abcb1bd92f27" category="cell"><block ref="f93eecf9c582d76d4e14292dc34c79f8" prefix="" category="inline-code"></block></block>
  <block id="3ed8fb68917b28af138fb74ccde62e80" category="cell"><block ref="415e8eb8b9fc05cb48e633d31fd04944" prefix="" category="inline-code"></block></block>
  <block id="8102775fe4080f632332ab8d3312311a" category="paragraph">單一執行個體與 RAC 掛載選項之間的主要差異在於新增<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 至掛載選項。此新增功能可停用主機作業系統快取、使 RAC 叢集中的所有執行個體都能一致地檢視資料狀態。</block>
  <block id="1e3f10dfa324520cb7261c0da5bf6ec7" category="paragraph">雖然使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 裝載選項和<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 參數<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 停用主機快取的效果相同、仍需使用<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block>。<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 為共享的必要項目<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> 部署以促進 Oracle 密碼檔案和等檔案的一致性<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block> 參數檔。如果 RAC 叢集中的每個執行個體都有專用的<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>，則不需要此參數。</block>
  <block id="5365dd1a92461c9e6cf65017c4a11647" category="section-title">AIX jfs/JFS2 掛載選項</block>
  <block id="d7a578263480a2003f05c459a8961298" category="paragraph">下表列出 AIX jfs/JFS2 掛載選項。</block>
  <block id="0aabf727ab0a83c5f5d078e8b18445e0" category="cell">預設值</block>
  <block id="e1f651debac4f720c13ae930ff3ca14a" category="cell">Oracle_Home</block>
  <block id="27a7ffa293f5a4d2a5bb54354486dece" category="paragraph">使用 AIX 之前<block ref="b7cc91287fc99a8937a55e79376c6f54" prefix=" " category="inline-code"></block> 任何環境中的裝置（包括資料庫）都請檢查參數<block ref="9d51746070ef554ad4e93a16de4aed0f" prefix=" " category="inline-code"></block>。此參數不是 HBA 佇列深度、而是與個別主機的 SCSI 佇列深度相關<block ref="66ad66c6ace8456eae4ca6807552e54b" prefix=" " category="inline-code"></block> 效能可能太低。測試顯示最佳值為 64 。</block>
  <block id="bb79f96acbff544ded541446c9c7c894" category="doc">Microsoft Windows</block>
  <block id="14ce2582c2080a7f08fe9249f6565f40" category="paragraph">Oracle 支援搭配直接 NFS 用戶端使用 Microsoft Windows 。這項功能提供 NFS 管理效益的途徑、包括跨環境檢視檔案、動態調整磁碟區大小、以及使用較便宜的 IP 傳輸協定。如需在 Microsoft Windows 上使用 DNFS 安裝及設定資料庫的詳細資訊、請參閱正式的 Oracle 文件。不存在任何特殊的最佳實務做法。</block>
  <block id="f854b764258138b512f30be71e1c7908" category="paragraph">為達到最佳壓縮效率、請確保 NTFS 檔案系統使用 8K 或更大的分配單元。使用 4K 分配單元（通常是預設）會對壓縮效率造成負面影響。</block>
  <block id="edc9f0a5a5d57797bf68e37364743831" category="doc">Linux</block>
  <block id="dfc95ed5e895617bbd0d4b1a8bfba8ca" category="paragraph">Linux 作業系統專屬的組態主題。</block>
  <block id="5ecd4a6f4aedfdd45cce80a18b1a7942" category="section-title">插槽表格</block>
  <block id="2518e65e64213437c921c39a097db167" category="section-title">Linux NFS 裝載選項</block>
  <block id="29cd2e6d4fc96e749c4a0e622cad7f50" category="paragraph">下表列出單一執行個體的 Linux NFS 掛載選項。</block>
  <block id="9fafd031075cede0e8a5a796ec45fbff" category="paragraph">下表列出 RAC 的 Linux NFS 掛載選項。</block>
  <block id="f16135915fe2ca5c3b0d660acc0325d3" category="cell"><block ref="4c927b3193f1cd00c7cfd3ac2e7ba8ea" prefix="" category="inline-code"></block></block>
  <block id="fc1ea13514277ff14dc705f62c31c0fc" category="cell"><block ref="4d0511346ac74044d79c9bc297d59b09" prefix="" category="inline-code"></block></block>
  <block id="13c64659680c0bc3603209997cc22225" category="cell">CRS/ 投票</block>
  <block id="672c5eef2603018159295408f761324b" category="cell"><block ref="26b20bdf0b0e7d3ddef3749a70c17932" prefix="" category="inline-code"></block></block>
  <block id="f7085c7dc406f5b44813ac43c18b80c0" category="paragraph">單一執行個體與 RAC 掛載選項之間的主要差異在於新增<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 至掛載選項。此新增功能可停用主機作業系統快取、使 RAC 叢集中的所有執行個體都能一致地檢視資料狀態。雖然使用<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 參數<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 停用主機快取的效果相同、仍需使用<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block>。</block>
  <block id="d2537738f34705bc9d100925252c0102" category="paragraph">原因<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 為共享的必要項目<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> 部署是為了促進檔案的一致性、例如 Oracle 密碼檔案和 spfiles 。如果 RAC 叢集中的每個執行個體都有專用的<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>，則不需要此參數。</block>
  <block id="5084019c1051a9937b5ff77568ce579b" category="paragraph">一般而言、非資料庫檔案的掛載應該與單一執行個體資料檔案所使用的選項相同、不過特定應用程式可能有不同的需求。避免使用掛載選項<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 如果可能、因為這些選項會停用檔案系統層級的預先讀取和緩衝處理。這可能會對擷取、轉譯和載入等程序造成嚴重的效能問題。</block>
  <block id="243de27c01fea05cc58186d2e5ad1ce5" category="section-title">存取與 GetAttr</block>
  <block id="59dcf78e97c197a0f240067da57a248f" category="paragraph">有些客戶指出、存取和 GetAttr 等極高層級的其他 IOPS 、可能會主導他們的工作負載。在極端情況下、讀取和寫入等作業可低於總作業量的 10% 。這是任何包含使用的資料庫的正常行為<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 和/或<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 在 Linux 上、因為這些選項會導致 Linux 作業系統持續從儲存系統重新載入檔案中繼資料。存取和 GetAttr 等作業是從資料庫環境中的 ONTAP 快取提供服務的低影響作業。它們不應被視為真正的 IOPS 、例如讀寫、而會對儲存系統產生真正的需求。不過、這些其他 IOPS 確實會產生一些負載、尤其是在 RAC 環境中。若要解決這種情況、請啟用 DNFS 、以略過作業系統緩衝區快取、避免這些不必要的中繼資料作業。</block>
  <block id="041f371e212c70407e145ae9f752a8b4" category="section-title">Linux Direct NFS</block>
  <block id="dd2f3f344f14ae5daf12cb0a817a72e0" category="paragraph">另一個掛載選項、稱為<block ref="4740c034d97ca90a96b8050082816605" prefix=" " category="inline-code"></block>（ a ） DNFS 啟用時、需要使用、（ b ）來源磁碟區多次裝載於具有巢狀 NFS 裝載的單一伺服器（ c ）上。此組態主要出現在支援 SAP 應用程式的環境中。例如、 NetApp 系統上的單一磁碟區可能會有位於的目錄<block ref="9f9f4ccb1fc3afcbfe0cc3f5eac4332c" prefix=" " category="inline-code"></block> 再來一次<block ref="ac2f9bbcd397d8f6b39e6713658051ea" prefix=" " category="inline-code"></block>。如果<block ref="9f9f4ccb1fc3afcbfe0cc3f5eac4332c" prefix=" " category="inline-code"></block> 安裝於<block ref="9ad16912cc0ba54a259b1a15d233c264" prefix=" " category="inline-code"></block> 和<block ref="ac2f9bbcd397d8f6b39e6713658051ea" prefix=" " category="inline-code"></block> 安裝於<block ref="1da707b60c3b55bd01cb7df7c171a368" prefix=" " category="inline-code"></block>，結果是來自相同來源的巢狀 NFS 掛載。</block>
  <block id="14dd7af30f62ec838445a1e167d2aff6" category="section-title">Linux Direct NFS 和 Oracle RAC</block>
  <block id="c6a209e4ad702c6424efb7d63d76feca" category="paragraph">使用 DNFS 對 Linux 作業系統上的 Oracle RAC 有特殊的效能優勢、因為 Linux 沒有強制直接 I/O 的方法、而 RAC 需要此方法才能在節點之間保持一致。因應措施是 Linux 需要使用<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 掛載選項、會使檔案資料從作業系統快取立即過期。此選項會強制 Linux NFS 用戶端持續重新讀取屬性資料、進而損害延遲並增加儲存控制器的負載。</block>
  <block id="3070cb366c38db327b0cf057d63792c1" category="paragraph">啟用 DNFS 會略過主機 NFS 用戶端、避免此損害。多家客戶在啟用 DNFS 時、報告 RAC 叢集的效能大幅提升、 ONTAP 負載大幅降低（特別是其他 IOPS ）。</block>
  <block id="e97ab7f94d503bbec4b013b5b77118c6" category="section-title">Linux Direct NFS 和 oranfstab 檔案</block>
  <block id="f63255b70940d25581e0cf5f81dd6cd6" category="paragraph">在 Linux 上搭配多重路徑選項使用 DNFS 時、必須使用多個子網路。在其他作業系統上、可使用建立多個 DNFS 通道<block ref="54b4c4075463b2e02cd69f5cd139b5b2" prefix=" " category="inline-code"></block> 和<block ref="bbf52a1a57a4eaa83512cab68fd52b70" prefix=" " category="inline-code"></block> 可在單一子網路上設定多個 DNFS 通道的選項。不過、這在 Linux 上無法正常運作、因此可能會產生非預期的效能問題。在 Linux 中、用於 DNFS 流量的每個 NIC 都必須位於不同的子網路上。</block>
  <block id="6c5cf31ca1af553b1f4a9b99e3cb054c" category="section-title">I/O 排程器</block>
  <block id="49bb1f5f4810e5f3d32dac84bd96005d" category="paragraph">Linux 核心可讓您以低層級控制 I/O 排程封鎖裝置的方式。Linux 各版本的預設值差異極大。測試顯示、截止日期通常會提供最佳結果、但有時 NOOP 會稍微好一點。效能差異最小、但如果需要從資料庫組態擷取最大可能效能、請測試這兩個選項。在許多組態中、 CFQ 是預設值、而且已證明資料庫工作負載的效能有重大問題。</block>
  <block id="38f25b8840d56fc601af1024115764b2" category="paragraph">如需設定 I/O 排程器的指示、請參閱相關的 Linux 廠商文件。</block>
  <block id="4150162ad42bffea7bb903b4c7a4ffd9" category="section-title">多重路徑</block>
  <block id="305482bf1c318f0a9a04f94987db06b2" category="paragraph">部分客戶在網路中斷期間遭遇當機、因為多重路徑常駐程式未在其系統上執行。在最新版本的 Linux 上、作業系統的安裝程序和多重路徑常駐程式可能會讓這些作業系統容易受到此問題的影響。套件已正確安裝、但未設定為在重新開機後自動啟動。</block>
  <block id="6fb0bf499bef576f56e0fd6360eba0a6" category="paragraph">例如、 RHEL5.5 上多重路徑常駐程式的預設值可能如下所示：</block>
  <block id="31026ba0b77cbe4c9d44ed6afc859ed6" category="paragraph">您可以使用下列命令來修正此問題：</block>
  <block id="c759a9b7e4db09da8a25fb73d256f6b7" category="section-title">ASM 鏡像</block>
  <block id="f2f41836b42c08199948378b4a4a6e26" category="paragraph">ASM鏡射可能需要變更Linux多重路徑設定、以允許ASM辨識問題並切換至其他故障群組。大部分關於「不完整」的ASM組態ONTAP 都使用外部備援、這表示資料保護是由外部陣列提供、而ASM不會鏡射資料。某些站台使用具有一般備援的ASM來提供雙向鏡像、通常是跨不同站台。</block>
  <block id="25f47751ccd5df99e3c25a8eb2a21fc5" category="inline-link-macro">NetApp 主機公用程式文件</block>
  <block id="066a79b72a430b074cdc0476b67bbde3" category="paragraph">中顯示的 Linux 設定 <block ref="210658f6fe0d0061c73c19a9a6b263d1" category="inline-link-macro-rx"></block> 包含會導致 I/O 無限期佇列的多重路徑參數這表示 LUN 裝置上沒有作用中路徑的 I/O 會在 I/O 完成所需的時間內等待。這通常是很理想的做法、因為 Linux 主機會在 SAN 路徑變更完成、 FC 交換器重新開機或儲存系統完成容錯移轉所需的時間內等待。</block>
  <block id="184ea23c04f24d03fc0123bc6eb30de2" category="paragraph">這種不受限制的佇列行為會導致 ASM 鏡像發生問題、因為 ASM 必須收到 I/O 故障、才能在替代 LUN 上重試 I/O 。</block>
  <block id="5616945ee545765b51d3fe1871cff4ec" category="paragraph">在 Linux 中設定下列參數<block ref="9ac80d53ede05256c28cf9e043eb423c" prefix=" " category="inline-code"></block> 用於 ASM 鏡像的 ASM LUN 檔案：</block>
  <block id="49af3bbe0c557480960d217b217502ff" category="paragraph">這些設定會為 ASM 裝置建立 120 秒的逾時。逾時會計算為<block ref="e2f0125c5971e1ce714f86f145386ee3" prefix=" " category="inline-code"></block> *<block ref="9434de34302b4f40887a7277cf35a8fc" prefix=" " category="inline-code"></block> 秒。在某些情況下可能需要調整確切的值、但 120 秒的逾時時間應足以滿足大部分的使用需求。具體而言、 120 秒的時間應該能讓控制器接管或恢復、而不會產生 I/O 錯誤、導致故障群組離線。</block>
  <block id="dbff1dc161f3f1d61258259b3a0b549c" category="paragraph">較低<block ref="9434de34302b4f40887a7277cf35a8fc" prefix=" " category="inline-code"></block> 此值可縮短 ASM 切換至替代故障群組所需的時間、但這也會增加在維護活動（例如控制器接管）期間不必要的容錯移轉風險。仔細監控 ASM 鏡像狀態、即可降低風險。如果發生不必要的容錯移轉、只要執行重新同步的速度相對較快、鏡像就能快速重新同步。如需更多資訊、請參閱 ASM Fast Mirror Resync 上的 Oracle 說明文件、以瞭解所使用的 Oracle 軟體版本。</block>
  <block id="ec0b68df6b5a0fdd6d73ac710b9684da" category="section-title">Linux xfs 、 ext3 和 ext4 掛載選項</block>
  <block id="278230e4238d02fcb49850454e7d79e0" category="admonition">* NetApp 建議 * 使用預設掛載選項。</block>
  <block id="02a5a4d50c5112bb31ff9c94f5b47ce9" category="paragraph">ONTAP 上的許多 Oracle 客戶都使用乙太網路、 NFS 、 iSCSI 、 NVMe / TCP 的網路傳輸協定、尤其是雲端。</block>
  <block id="8a1870adbe8a237106c32d72660a9c42" category="summary">Oracle 資料庫的邏輯介面設計</block>
  <block id="f46a94d438563c03413adfec27c6bfda" category="paragraph">Oracle 資料庫需要存取儲存設備。邏輯介面（ Lifs ）是將儲存虛擬機器（ SVM ）連接到網路、然後再連接到資料庫的網路配送。需要適當的 LIF 設計、才能確保每個資料庫工作負載都有足夠的頻寬、而且容錯移轉不會導致儲存服務遺失。</block>
  <block id="f445528d334d486a14570735705e2223" category="summary">Oracle 資料庫的 FC 網路組態</block>
  <block id="92cdde4ecc529b9f9379ed2bdb6aae34" category="paragraph">為 Oracle 資料庫設定 FC SAN 主要是為了遵循日常的 SAN 最佳實務做法。</block>
  <block id="9eaca569c6f5ca3388f5613da3aa008c" category="doc">ONTAP 上的 Oracle 資料庫</block>
  <block id="528b35962f1679204260ddef6800eece" category="paragraph">ONTAP 專為 Oracle 資料庫所設計。數十年來、 ONTAP 已針對關聯式資料庫 I/O 的獨特需求進行最佳化、並特別建立多項 ONTAP 功能、以滿足 Oracle 資料庫的需求、甚至是 Oracle Inc. 本身的要求。</block>
  <block id="c9f8ef2db64ce19b15d2cc98fbd3d24c" category="admonition">本文件取代先前發佈的技術報告 _TR-3633 ： ONTAP 上的 Oracle 資料庫； TR-4591 ： Oracle 資料保護：備份、還原、複寫； TR-4592 ： MetroCluster 上的 Oracle ；以及 TR-4534 ：將 Oracle 資料庫移轉至 NetApp 儲存系統</block>
  <block id="b42ad0517ef7394f97178fb9e1de8d78" category="paragraph">除了 ONTAP 為您的資料庫環境帶來價值的許多可能方式之外、也有許多使用者需求、包括資料庫大小、效能需求和資料保護需求。NetApp 儲存設備的已知部署包括從虛擬化環境（約 6 、 000 個在 VMware ESX 下執行的資料庫）到目前規模為 996TB 且不斷成長的單一執行個體資料倉儲、應有盡有。因此、在 NetApp 儲存設備上設定 Oracle 資料庫的最佳實務做法很少。</block>
  <block id="7bf0493f27e81fe4c3740e773e137a48" category="paragraph">在 NetApp 儲存設備上操作 Oracle 資料庫的需求有兩種解決方法。首先、當有明確的最佳實務做法時、將會特別加以說明。我們將根據 Oracle 儲存解決方案架構設計師的特定業務需求、詳細說明許多設計考量。</block>
  <block id="633d94718c25247da5772ed6f2b244c9" category="summary">Oracle 儲存設備移轉簡介</block>
  <block id="08beeb11d62fd51ef2742eae3ee3719f" category="admonition">本文件取代先前發佈的技術報告 _TR-4534 ：將 Oracle 資料庫移轉至 NetApp 儲存系統</block>
  <block id="5f2a4190824fd64be3c8cabeb7dc62ff" category="paragraph">若是新的資料庫專案、這並不是問題、因為資料庫和應用程式環境都已建置就緒。然而、移轉對於業務中斷、完成移轉所需的時間、所需的技能組合、以及將風險降至最低等方面、都會帶來特殊挑戰。</block>
  <block id="a83f1ca5ad00b39773d9e6a26b0e70b2" category="section-title">指令碼</block>
  <block id="08293bec81c296b61f4a751175d9caa7" category="paragraph">本文件提供範例指令碼。這些指令碼提供自動化移轉各個層面的範例方法、以降低使用者錯誤的機率。這些指令碼可降低 IT 人員對於移轉作業的整體需求、並加速整體程序。這些指令碼都是從 NetApp 專業服務和 NetApp 合作夥伴執行的實際移轉專案中擷取而來。本文件中會顯示使用範例。</block>
  <block id="c28b52826242c7cdffe5f3ae1e917f61" category="paragraph">由於需要變更 FC 網路組態、因此無法避免在外部 LUN 匯入期間發生中斷。不過、中斷時間不一定比重新啟動資料庫環境和更新 FC 分區所需的時間長、以便將主機 FC 連線能力從外部 LUN 切換至 ONTAP 。</block>
  <block id="a2248459756ffc1877beb9b39c77668b" category="paragraph">此程序可歸納如下：</block>
  <block id="c9f77905e39abbada6c73a7a3d5f51f8" category="list-text">在外部 LUN 上執行所有 LUN 活動。</block>
  <block id="cff6e7c6c4f8dd7e57a0286f28712c58" category="list-text">將主機 FC 連線重新導向至新的 ONTAP 系統。</block>
  <block id="9fea842823b73e1eb32307ab325f170e" category="list-text">觸發匯入程序。</block>
  <block id="df814ea2bf92d4f18e72a648e93103a2" category="list-text">重新探索 LUN 。</block>
  <block id="030a5009bbe6fb141ca5863ab6c59464" category="list-text">重新啟動資料庫。</block>
  <block id="f3bb22d18791c042e889671ad1963239" category="paragraph">您不需要等待移轉程序完成。一旦開始移轉給定的 LUN 、就可以在 ONTAP 上使用、並在資料複製程序繼續進行時提供資料。所有讀取都會傳送到外部 LUN 、而且所有寫入都會同步寫入兩個陣列。複製作業非常快速、重新導向 FC 流量的負荷也很小、因此對效能的任何影響都應該是暫時性的、而且最小的。如果有疑慮、您可以延遲重新啟動環境、直到移轉程序完成、匯入關係已刪除為止。</block>
  <block id="b19e17ab765f91aa0bc0e7152f13779f" category="section-title">關閉資料庫</block>
  <block id="2869cd69e0fec20ba28a42e74afef158" category="paragraph">在本範例中、停止環境的第一步是關閉資料庫。</block>
  <block id="e20dab0880a91f5da2ea05170177576d" category="section-title">關閉網格服務</block>
  <block id="89c458e5176d6caf0690f1e61ecb0620" category="paragraph">其中一個要移轉的 SAN 型檔案系統也包含 Oracle ASM 服務。若要停止基礎 LUN 、則需要卸除檔案系統、這也意味著在此檔案系統上停止任何開啟檔案的處理程序。</block>
  <block id="49f05bf7da4eacfa4c80bb987443eb5a" category="section-title">卸除檔案系統</block>
  <block id="c5a09ac3ff0bb25c97951c7b7f815cd0" category="paragraph">如果所有程序都關閉、 umount 作業就會成功。如果權限遭拒、檔案系統上必須有鎖定的程序。。<block ref="ace112f9725b6fa0b702e6b3970b2102" prefix=" " category="inline-code"></block> 命令可協助識別這些程序。</block>
  <block id="765e13ffc3361a9fd6c6088b2603ffbf" category="section-title">停用 Volume 群組</block>
  <block id="907e5f35f70dc2f5e4b67da56381bdf4" category="paragraph">卸除指定 Volume 群組中的所有檔案系統後、即可停用該 Volume 群組。</block>
  <block id="ad80f935ccd133a802189e3c2f4421d7" category="section-title">FC 網路變更</block>
  <block id="a497da6790d9ab4bb5cce3d04b0efd2e" category="paragraph">現在可以更新 FC 區域、以移除主機對外部陣列的所有存取權、並建立對 ONTAP 的存取權。</block>
  <block id="3ef31115a10790468ad841ec2cdf566f" category="section-title">開始匯入程序</block>
  <block id="5bc309ef1913ddc70534a0a7135ba938" category="paragraph">若要啟動 LUN 匯入程序、請執行<block ref="76ffc50817aa4cd6214aa0061339fdf6" prefix=" " category="inline-code"></block> 命令。</block>
  <block id="0a10f1ad4a0b45d384c5771ec0906c4c" category="section-title">監控匯入進度</block>
  <block id="9a3a7545f4a7407ec022c4b2271e0c34" category="paragraph">您可以使用監控匯入作業<block ref="1ab15ef2c245a4434fcea3cc3149f4f4" prefix=" " category="inline-code"></block> 命令。如下所示、目前正在匯入所有 20 個 LUN 、這表示即使資料複製作業仍在進行中、仍可透過 ONTAP 存取資料。</block>
  <block id="d36f98c8a305e33483232e7b5cd90c49" category="inline-link-macro">外部 LUN 匯入：完成</block>
  <block id="a9c97f84ee4958d39ed989b3da7ed0ba" category="paragraph">如果您需要線上移轉、請繼續在新的主目錄中重新探索 LUN 、並啟動服務。</block>
  <block id="d0369936c6fe8c292874e3bc647893b8" category="section-title">掃描 SCSI 裝置變更</block>
  <block id="6d338faddede649cab4c5b498e8e4379" category="paragraph">在大多數情況下、重新探索新 LUN 最簡單的選項是重新啟動主機。這樣做會自動移除舊的過時裝置、正確探索所有新的 LUN 、並建置相關的裝置、例如多重路徑裝置。以下範例顯示出完全線上的示範程序。</block>
  <block id="3b493a859f19779c1f7db7d1951785ee" category="paragraph">注意：在重新啟動主機之前、請確定中的所有項目都已存在<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 這項參照移轉的 SAN 資源會被註解出來。如果未執行此操作、且 LUN 存取有問題、作業系統可能無法開機。這種情況不會損害資料。不過、開機進入救援模式或類似模式並修正可能非常不方便<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 如此一來、就能開機作業系統以進行疑難排解。</block>
  <block id="9d7b16568eb7edb80492b49cb02d7663" category="paragraph">本範例所使用 Linux 版本上的 LUN 可與重新掃描<block ref="b6f75508bf2af141e9de6f862662661e" prefix=" " category="inline-code"></block> 命令。如果命令成功、每個 LUN 路徑都會出現在輸出中。輸出可能很難解譯、但如果分區和 igroup 組態正確、許多 LUN 應該會顯示為包含<block ref="971c047750d8e3b03c71d24020b3816f" prefix=" " category="inline-code"></block> 廠商字串。</block>
  <block id="3384aa7c090758ad18028832967b143f" category="section-title">檢查多重路徑裝置</block>
  <block id="07a39d42e6d8cc61e0a880e43b83e2a3" category="paragraph">LUN 探索程序也會觸發多重路徑裝置的重新開發、但已知 Linux 多重路徑驅動程式偶爾會發生問題。的輸出<block ref="eeb30d005cab1d8c69785a3cd5818f55" prefix=" " category="inline-code"></block> 應檢查以驗證輸出是否如預期。例如、下列輸出顯示與相關的多重路徑裝置<block ref="971c047750d8e3b03c71d24020b3816f" prefix=" " category="inline-code"></block> 廠商字串。每個裝置有四條路徑、其中兩條優先順序為 50 、兩條優先順序為 10 。雖然確切的輸出可能會因 Linux 的不同版本而有所不同、但此輸出的外觀與預期相同。</block>
  <block id="efd921479c3d57448954050760c568ca" category="admonition">請參閱您用來驗證的 Linux 版本的主機公用程式文件<block ref="dd5ff67ba72768d33f75e645aa2b8e56" prefix=" " category="inline-code"></block> 設定正確。</block>
  <block id="28751dc1e914a778d11ca0e69613690b" category="section-title">重新啟動 LVM Volume 群組</block>
  <block id="a66a38e4056f28a310ef6d1fa8bbcc77" category="paragraph">如果正確探索到 LVM LUN 、則會發現<block ref="5239f542d8edbc4b528b1f362153c0c7" prefix=" " category="inline-code"></block> 命令應該成功。這是邏輯 Volume Manager 的價值範例。由於磁碟區群組中繼資料是寫入 LUN 本身、因此 LUN 的 WWN 變更甚至是序列號都不重要。</block>
  <block id="1d374f8de5ba1b82ab4407b8c6efbd0d" category="paragraph">作業系統掃描 LUN 、並發現 LUN 上寫入的少量資料、可將其識別為屬於的實體磁碟區<block ref="83b7788c8e4de444d6cd4c69978eaf32" prefix=" " category="inline-code"></block>。然後、它會建置所有必要的裝置。只需重新啟動 Volume 群組即可。</block>
  <block id="1f0285a57b2357507c3b77ce5130b548" category="section-title">重新掛載檔案系統</block>
  <block id="a9047d68dc7e99f553b71590cff301d6" category="paragraph">磁碟區群組重新啟動後、檔案系統可以裝入、所有原始資料均完整無缺。如前所述、即使資料複寫仍在後端群組中作用中、檔案系統仍可完全運作。</block>
  <block id="a787d65e2525ac6bc3a6328efe383b5c" category="section-title">重新掃描 ASM 設備</block>
  <block id="a25bb20f07ed95a633f623678855e8dc" category="paragraph">重新掃描 SCSI 裝置時、應已重新探索 ASMLib 裝置。重新探索可透過重新啟動 ASMLib 、然後掃描磁碟來線上驗證。</block>
  <block id="37fb12a52b4a5371c12209e89e09b04f" category="admonition">此步驟僅與使用 ASMLib 的 ASM 組態相關。</block>
  <block id="6de48f39063d81d53fd0ff3e9938af13" category="paragraph">注意：若未使用 ASMLib 、請使用<block ref="9c9f766701f811ef6f170c7a3453c53f" prefix=" " category="inline-code"></block> 裝置應已自動重新建立。不過、權限可能不正確。在 ASMLib 不存在的情況下、您必須為基礎裝置設定特殊權限。這樣做通常是透過中的特殊項目來完成<block ref="dd5ff67ba72768d33f75e645aa2b8e56" prefix=" " category="inline-code"></block> 或<block ref="ab775c875d5f89d991a670444dd32ad2" prefix=" " category="inline-code"></block> 規則、或可能同時在兩個規則集中。這些檔案可能需要更新、以反映環境中的 WWN 或序號變更、以確保 ASM 裝置仍擁有正確的權限。</block>
  <block id="08b33d6af4ec78f99dbbc3533589aafc" category="paragraph">在此範例中、重新啟動 ASMLib 並掃描磁碟時、會顯示與原始環境相同的 10 個 ASM LUN 。</block>
  <block id="17c4ae76000d9a79a56195071665af32" category="section-title">重新啟動網格服務</block>
  <block id="e8c3dc00e15826e3b77a2d41d7fde92a" category="paragraph">現在、 LVM 和 ASM 裝置已上線且可供使用、可以重新啟動網格服務。</block>
  <block id="934317e45581988a01f54761705ca58a" category="section-title">重新啟動資料庫</block>
  <block id="41475a737e947d73c674b90e78e246a0" category="paragraph">網格服務重新啟動後、即可啟動資料庫。在嘗試啟動資料庫之前、可能需要等待幾分鐘、 ASM 服務才能完全可用。</block>
  <block id="b171714b39ad4102aced4daceef8c678" category="paragraph">從主機的角度來看、移轉已完成、但在匯入關係刪除之前、仍會從外部陣列提供 I/O 。</block>
  <block id="f708d001227724fa0a8a3d57aacedb1a" category="paragraph">刪除關係之前、您必須確認所有 LUN 的移轉程序已完成。</block>
  <block id="85cf20229bc9008553794abdaed507f5" category="section-title">刪除匯入關係</block>
  <block id="b23ec325eb9c6278cb36e4c45c2c3499" category="paragraph">移轉程序完成後、請刪除移轉關係。完成後、 I/O 將由 ONTAP 上的磁碟機獨家提供。</block>
  <block id="40b98b0023a7eea7c432c29e3c44ba7d" category="section-title">取消註冊外部 LUN</block>
  <block id="5ccc14ae93ba94bd4183439a9f80f6c8" category="paragraph">最後、修改磁碟以移除<block ref="96ea0e5f46787e93e2970a086b47fdb6" prefix=" " category="inline-code"></block> 指定。</block>
  <block id="875bb561ba851d301052704e0ffb70f4" category="summary">透過記錄傳送進行 Oracle 移轉</block>
  <block id="e0f9c3b73fe5700df95f30eb98ca4034" category="doc">Oracle 記錄傳送</block>
  <block id="8e42b5809657e127c7e2d24f30bc493e" category="paragraph">使用記錄傳送進行移轉的目標是在新位置建立原始資料檔案的複本、然後建立將變更傳送到新環境的方法。</block>
  <block id="599df5f564506c95624dd78b0b75eeac" category="paragraph">一旦建立、記錄傳送和重播就能自動進行、使複本資料庫與來源保持大致同步。例如、 cron 工作可排程至（ a ）將最近的記錄複製到新位置、並（ b ）每 15 分鐘重播一次。這樣做可在轉換時將中斷次數降至最低、因為必須重播不超過 15 分鐘的歸檔記錄。</block>
  <block id="41bec1b4ddc17b3367c68a025c0ddfb9" category="paragraph">以下程序基本上也是資料庫複製作業。所示邏輯類似於 NetApp SnapManager for Oracle （ SMO ）和 NetApp SnapCenter Oracle Plug-in 內的引擎。有些客戶已使用指令碼或 WFA 工作流程中所示的程序來進行自訂的複製作業。雖然此程序比使用 SnapCenter 或 SMO 更為手冊化、但仍可輕鬆撰寫指令碼、而 ONTAP 中的資料管理 API 則可進一步簡化程序。</block>
  <block id="f0616883a5ca70aa97676de436a7fb9e" category="section-title">記錄傳送 - 檔案系統至檔案系統</block>
  <block id="8f922b64f0bc64f6bba1d555a61ee3bb" category="paragraph">本範例示範如何將名為華夫餅的資料庫從一般檔案系統移轉至位於不同伺服器上的其他一般檔案系統。它也說明 SnapMirror 可用來快速複製資料檔案、但這並不是整體程序不可或缺的一部分。</block>
  <block id="60100e1b826a4b972fc113c391f932e7" category="section-title">建立資料庫備份</block>
  <block id="80cf34e10dcfbc5e76c6b2f845f2708d" category="paragraph">第一步是建立資料庫備份。具體而言、此程序需要一組資料檔案、可用於歸檔記錄重新執行。</block>
  <block id="0ba29c6a1afacf586b03a26162c72274" category="section-title">環境</block>
  <block id="744a73803cdac4a5067725ca5814a2cf" category="section-title">還原至新環境</block>
  <block id="46228bb2ce31b0d397faad2b805e8a37" category="paragraph">現在必須在新環境中還原備份。這可以透過多種方式完成、包括 Oracle RMAN 、從備份應用程式（如 NetBackup ）還原、或是簡單複製置於熱備份模式的資料檔案。</block>
  <block id="1f255556546f1fdfb53692e41f35eb6c" category="list-text">建立新的磁碟區以接收快照資料。從初始化鏡像<block ref="937e9fa808ccfe9a4f6b004a2a7caada" prefix=" " category="inline-code"></block> 至<block ref="96f9dacb3cb1b1f6f9b4ad02992a1a0e" prefix=" " category="inline-code"></block>。</block>
  <block id="5b1944ec8c0ed933e5b2ea2e3e5fa76e" category="list-text">在 SnapMirror 設定狀態後、表示同步已完成、請特別根據所需的快照來更新鏡像。</block>
  <block id="f4d90c6c29b1f76ab9c87a9996c9751e" category="list-text">您可以透過檢視來驗證同步成功與否<block ref="31952c255e722053d4cc3f82921e95db" prefix=" " category="inline-code"></block> 鏡射磁碟區上的欄位。</block>
  <block id="0934c3fcad3065c2a479125e4a80b259" category="list-text">然後鏡射可能會中斷。</block>
  <block id="fcf1f505b94151a36eba8e1563e7176f" category="list-text">掛載新的檔案系統。使用區塊型檔案系統時、精確的程序會因使用中的 LVM 而異。必須設定 FC 分區或 iSCSI 連線。建立與 LUN 的連線後、命令如 Linux<block ref="302c49bbd5bcda5463eb5130804effc1" prefix=" " category="inline-code"></block> 可能需要探索哪些磁碟區群組或 LUN 需要正確設定、才能讓 ASM 發現。</block>
  <block id="20c4d1d4163c2463cf15ff7df6424459" category="paragraph">在此範例中、使用簡單的 NFS 檔案系統。此檔案系統可直接掛載。</block>
  <block id="b2dd88a1f03a5fb4c2e3c0d46f425161" category="section-title">建立控制檔建立範本</block>
  <block id="1c30e11140f1d0a1093bedee34eef1e4" category="paragraph">接下來必須建立控制檔範本。。<block ref="3177841b2335a6640ea3054199830f1c" prefix=" " category="inline-code"></block> 命令會建立文字命令以重新建立控制檔。在某些情況下、此功能可用於從備份還原資料庫、而且通常用於執行資料庫複製等工作的指令碼。</block>
  <block id="3f51d58ec72b9d36cb5e0636525130b5" category="list-text">以下命令的輸出用於爲遷移的數據庫重新創建控制文件。</block>
  <block id="cb395c3bf18fd427287caecc9b28058a" category="list-text">建立控制檔之後、請將檔案複製到新伺服器。</block>
  <block id="cf5c9046a3617a19c0ccc24e4cf54a33" category="section-title">備份參數檔案</block>
  <block id="0d1d1a7db58f3f93ec977733f4909f5d" category="paragraph">在新環境中也需要一個參數檔。最簡單的方法是從目前的 spfile 或 pfile 建立 pfile 。在此範例中、來源資料庫使用的是 spfile 。</block>
  <block id="051a634cb1e9a53dbf139214e1d24001" category="section-title">建立 oratab 項目</block>
  <block id="2dabc26c8b55d44e25a184ba2624eed0" category="paragraph">需要建立 oratab 項目、才能正常運作如 oraenv 等公用程式。若要建立 oratab 項目、請完成下列步驟。</block>
  <block id="87ef75141d237e3b44e8310aad8fcf19" category="section-title">準備目錄結構</block>
  <block id="12f833c44c11e6bbd970cc126bce2bcb" category="paragraph">如果所需目錄尚未存在、您必須建立它們、否則資料庫啟動程序會失敗。若要準備目錄結構、請完成下列最低需求。</block>
  <block id="60225c364a012796a6d886e8cf4ec486" category="section-title">參數檔案更新</block>
  <block id="e36ee2d9a95a6b672917862d714af383" category="list-text">若要將參數檔複製到新伺服器、請執行下列命令。預設位置為<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> 目錄。在這種情況下、 pfile 可以放在任何地方。它只是移轉程序中的中間步驟。</block>
  <block id="d437a40a59905247cfb39cf9dc9da256" category="list-text">視需要編輯檔案。例如、如果歸檔記錄位置已變更、則必須變更 pfile 以反映新位置。在此範例中、只有控制檔正在重新定位、部分是為了在記錄檔和資料檔案系統之間散佈。</block>
  <block id="55cc35656c3d28c1b3267c246b397521" category="list-text">編輯完成後、請根據此 pfile 建立 spfile 。</block>
  <block id="a833a03e6af0b969524dcccb8f296f1c" category="section-title">重新建立控制檔</block>
  <block id="74a636ee3a009f08cd5623dc8066dd09" category="paragraph">在前一個步驟中、的輸出<block ref="3177841b2335a6640ea3054199830f1c" prefix=" " category="inline-code"></block> 已複製到新伺服器。所需輸出的特定部分是<block ref="0ca1fba455d799b9a1cc2440b9ba7043" prefix=" " category="inline-code"></block> 命令。此資訊可在檔案中標記的區段下找到<block ref="9fb76d62be749cec8bdd06f46c77bf5b" prefix=" " category="inline-code"></block>。從這條線開始<block ref="13ac20c4a96b2ecfd703e831ad722907" prefix=" " category="inline-code"></block> 並應包含這個字<block ref="c3c62948f78a7ccaabb9ef2eea80a895" prefix=" " category="inline-code"></block>。結尾是分號（；）字元。</block>
  <block id="bf4b2a006646a8e77166a2a596425074" category="list-text">在此範例程序中、檔案會讀取如下內容。</block>
  <block id="a9a27c002ec883341220e267712250a7" category="list-text">視需要編輯此指令碼、以反映各種檔案的新位置。例如、已知可支援高 I/O 的某些資料檔案、可能會重新導向至高效能儲存層上的檔案系統。在其他情況下、這些變更可能純粹是因為系統管理員的理由、例如在專用磁碟區中隔離指定的 PDB 資料檔案。</block>
  <block id="2540fb1670d4f9ee8a704a7eb8d748fe" category="list-text">在此範例中<block ref="b86df74c6982de8dec7509d039294d7a" prefix=" " category="inline-code"></block> stanza 保持不變、但重做記錄會移至中的新位置<block ref="96bb85ed0fe822778c4e5a821e991ad8" prefix=" " category="inline-code"></block> 而非與歸檔登入共用空間<block ref="0e62afc91abe157ef67895cca0a7f912" prefix=" " category="inline-code"></block>。</block>
  <block id="8d47ad079859f2976fdc7ebf742f768d" category="paragraph">如果有任何檔案放錯位置或參數設定錯誤、就會產生錯誤、指出必須修正的項目。資料庫已掛載、但尚未開啟且無法開啟、因為使用中的資料檔案仍標示為處於熱備份模式。必須先套用歸檔記錄檔、才能使資料庫一致。</block>
  <block id="6b7c2d588ac708b58f7ac889090608f6" category="section-title">初始記錄複寫</block>
  <block id="2db2d3d6001a06d1a027904fa66bc78c" category="paragraph">為了使資料檔案一致、至少需要執行一項記錄回覆作業。有許多選項可供重播記錄。在某些情況下、原始伺服器上的原始歸檔記錄檔位置可以透過 NFS 共用、而且記錄回覆可以直接完成。在其他情況下、必須複製歸檔記錄。</block>
  <block id="5c394e6951584d114c6706d0768e30d7" category="paragraph">例如、簡單<block ref="8a444a43bdf534c0c6338bb7809659b3" prefix=" " category="inline-code"></block> 作業可將所有目前記錄從來源伺服器複製到移轉伺服器：</block>
  <block id="5fdb3158ed28dd3aa90b94556476b781" category="section-title">初始記錄重新播放</block>
  <block id="c2f93ef52583f81f0eba05a39483e2d8" category="paragraph">檔案在歸檔記錄位置後、可以發出命令來重新播放<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block> 接著是回應<block ref="e1f2d5134ed2543d38a0de9751cf75d9" prefix=" " category="inline-code"></block> 自動重播所有可用的記錄。</block>
  <block id="f30a45a22256018185c5d235292e4d5e" category="paragraph">最終的歸檔記錄回覆會回報錯誤、但這是正常現象。記錄會指出這一點<block ref="a84f4f3da79386c29ab6dfa560af786e" prefix=" " category="inline-code"></block> 正在尋找特定的記錄檔、但找不到該檔案。原因很可能是記錄檔尚未存在。</block>
  <block id="80bea8a60412cace54760b223b2d799e" category="paragraph">如果在複製歸檔記錄之前可以關閉來源資料庫、則此步驟只能執行一次。歸檔記錄會複製並重新播放、然後程序會直接繼續進行轉換程序、以複寫重要的重作記錄。</block>
  <block id="1e334141582a9dcb581c9b34ef2df071" category="section-title">遞增記錄複寫及重新播放</block>
  <block id="5fd2b0bf662c2b1ebdc677ea888536ce" category="paragraph">在大多數情況下、移轉作業不會立即執行。移轉程序可能在幾天甚至幾週前完成、這表示記錄必須持續運送至複本資料庫並重新執行。因此、當轉換程式到達時、必須傳輸和重播最少的資料。</block>
  <block id="0c56d82ec6857bcef5475899b9f7b5cc" category="paragraph">這樣做有許多方式可以撰寫指令碼、但其中最受歡迎的方法之一是使用 rsync 、這是通用的檔案複寫公用程式。使用此公用程式最安全的方法是將其設定為常駐程式。例如、<block ref="b31375af035ed8a698a803a491084f61" prefix=" " category="inline-code"></block> 下列檔案顯示如何建立名為的資源<block ref="260e23541ff372b9bc53b4bd3c0c38ba" prefix=" " category="inline-code"></block> 使用 Oracle 使用者認證存取、並對應至<block ref="488a4921a81e36fca411e6f13cefbbf2" prefix=" " category="inline-code"></block>。最重要的是、資源設為唯讀、可讀取正式作業資料、但不變更。</block>
  <block id="eabf1b424989b2c7113ba3a538079afa" category="paragraph">下列命令會將新伺服器的保存檔記錄目的地與 rsync 資源同步<block ref="260e23541ff372b9bc53b4bd3c0c38ba" prefix=" " category="inline-code"></block> 在原始伺服器上。。<block ref="e358efa489f58062f10dd7316b65649e" prefix=" " category="inline-code"></block> 引數<block ref="293e33723231f0504effabb52b054a31" prefix=" " category="inline-code"></block> 根據時間戳記比較檔案清單、只複製新檔案。此程序提供新伺服器的遞增更新。此命令也可在 cron 中排程為定期執行。</block>
  <block id="c775c44069da13c8f7ee5c5116e76e36" category="inline-link-macro">重播資料庫上的記錄</block>
  <block id="c3bf9b2ef3e3ae2ae6a02f7f77cfcbc6" category="paragraph">在收到記錄之後、必須重新播放記錄。前面的範例顯示使用 sqlplus 來手動執行<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block>，這是一種可以輕鬆自動化的程序。此處顯示的範例使用中所述的指令碼 <block ref="3e57a2099043fa40c58f1e0d4eed995d" category="inline-link-macro-rx"></block>。指令碼會接受指定需要重新執行作業之資料庫的引數。如此可在多資料庫移轉作業中使用相同的指令碼。</block>
  <block id="4ea2a6c39b10b3e3076f976f58a861d1" category="section-title">轉換</block>
  <block id="5de3f1ba0bbef459baa93f04f63b9ea1" category="paragraph">當您準備好切換至新環境時、必須執行最後一次同步、其中包括歸檔記錄和重做記錄。如果尚未知道原始的重做記錄位置、可以如下所示識別：</block>
  <block id="677f005cc0f8be0f891df5af72fb5688" category="list-text">關閉來源資料庫。</block>
  <block id="41b182875e12de118d17b3432cca93fa" category="list-text">使用所需的方法、在新伺服器上執行歸檔記錄的最後一次同步。</block>
  <block id="37d6d9420cef8230249e7691315f0e13" category="list-text">來源重做記錄檔必須複製到新伺服器。在此範例中、重做記錄會重新定位到新的目錄<block ref="96bb85ed0fe822778c4e5a821e991ad8" prefix=" " category="inline-code"></block>。</block>
  <block id="d0a5f1380bd67b0d0fd3bc72f22d88f2" category="list-text">在此階段、新的資料庫環境包含所有必要的檔案、使其與來源完全相同。歸檔記錄必須最後重播一次。</block>
  <block id="c2721157205b2d2e96c656c45ca72992" category="list-text">完成後、必須重新執行重作記錄。如果出現此訊息<block ref="975df7a5099101ffbe47981cd1d37c2c" prefix=" " category="inline-code"></block> 會傳回、程序成功、資料庫會同步、並可開啟。</block>
  <block id="6acab27c5f334c66f06f3f74bc62d6d8" category="section-title">記錄傳送 - ASM 至檔案系統</block>
  <block id="a67ffcc8b155bb909a6f8c5d5ba2f334" category="paragraph">本範例說明如何使用 Oracle RMAN 移轉資料庫。這與先前的檔案系統傳送檔案系統記錄檔範例非常類似、但主機看不到 ASM 上的檔案。唯一用於移轉位於 ASM 裝置上的資料的選項是重新放置 ASM LUN 、或使用 Oracle RMAN 來執行複製作業。</block>
  <block id="1c51600a778919f7f3abb5b25175220a" category="paragraph">雖然 RMAN 是從 Oracle ASM 複製檔案的必要條件、但 RMAN 的使用不限於 ASM 。RMAN 可用於從任何類型的儲存設備移轉至任何其他類型。</block>
  <block id="2cb6a5bfc4a76f651d496cddc685e078" category="paragraph">此範例顯示將名為 pake 的資料庫從 ASM 儲存設備重新放置到位於路徑上不同伺服器上的一般檔案系統<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> 和<block ref="0e62afc91abe157ef67895cca0a7f912" prefix=" " category="inline-code"></block>。</block>
  <block id="d1d789c37f1c96d0a5de07798c14fcc5" category="paragraph">第一步是建立要移轉到替代伺服器的資料庫備份。由於來源使用 Oracle ASM 、因此必須使用 RMAN 。簡單的 RMAN 備份可執行如下。此方法會建立標記備份、可在稍後的程序中由 RMAN 輕鬆識別。</block>
  <block id="ed927706d8abc2bbf3a5a8bc55e1e562" category="paragraph">第一個命令定義備份的目的地類型和要使用的位置。第二個只會啟動資料檔案的備份。</block>
  <block id="db85d05166dd65559ae5f426b51198e6" category="section-title">備份控制檔</block>
  <block id="a0b95d36955723a82dde7bbe40b6ccb9" category="paragraph">稍後的程序中需要備份控制檔<block ref="08de2bfcc2d52d5bc4f3f2dcb97558ad" prefix=" " category="inline-code"></block> 營運。</block>
  <block id="76ff543de72e62217293a1d0ceade0aa" category="paragraph">在新環境中也需要一個參數檔。最簡單的方法是從目前的 spfile 或 pfile 建立 pfile 。在此範例中、來源資料庫使用 spfile 。</block>
  <block id="d28f3a5b77909b45c50e6c711bef8b60" category="section-title">ASM 檔案重新命名指令碼</block>
  <block id="c242730c760d895368557f78141ff8b1" category="paragraph">移動資料庫時、控制檔中目前定義的數個檔案位置會變更。下列指令碼會建立 RMAN 指令碼、以簡化程序。此範例顯示的資料庫資料檔案數量極少、但資料庫通常包含數百個甚至數千個資料檔案。</block>
  <block id="359b84bcf7447a77b212e844aeaa9d89" category="inline-link-macro">ASM 至檔案系統名稱轉換</block>
  <block id="374a1a0facd7c604ac09ed0dca6efb3e" category="paragraph">此指令碼位於 <block ref="288325982fd7bee6cf9eb66ad33f6f7a" category="inline-link-macro-rx"></block> 它有兩件事。</block>
  <block id="42787fdca1cf792241ce03151ec7dbd3" category="paragraph">首先、它會建立一個參數、重新定義稱為的重做記錄位置<block ref="0f2d7ef9b967c2d9fb1ad5aa5e9eb688" prefix=" " category="inline-code"></block>。基本上是交替欄位清單。第一個欄位是目前重做記錄檔的位置、第二個欄位是新伺服器上的位置。然後重複該模式。</block>
  <block id="cf444fd96c87609516f0ad8212f41b01" category="paragraph">第二個功能是提供資料檔案重新命名的範本。指令碼會循環瀏覽資料檔案、擷取名稱和檔案編號資訊、並將其格式化為 RMAN 指令碼。然後、它會對暫存檔案執行相同的操作。結果是一個簡單的 RMAN 指令碼、可視需要加以編輯、以確保檔案還原至所需的位置。</block>
  <block id="50614366822786a4f2ee3a5065543634" category="paragraph">擷取此畫面的輸出。。<block ref="0f2d7ef9b967c2d9fb1ad5aa5e9eb688" prefix=" " category="inline-code"></block> 參數會如下所述放置在 pfile 中。RMAN 資料檔案重新命名和重複指令碼必須據此編輯、才能將資料檔案放置在所需的位置。在此範例中、所有的項目都放在中<block ref="36c3572e381980ee1f1343988ae4a955" prefix=" " category="inline-code"></block>。</block>
  <block id="e60cd818b9f7ae02a73d8b3a6ea0a809" category="paragraph">指令碼幾乎可以執行、但首先必須有目錄結構。如果所需目錄尚未存在、則必須建立這些目錄、否則資料庫啟動程序會失敗。以下範例反映最低需求。</block>
  <block id="2f2eed2ed14ba876a017aa9ea9515724" category="paragraph">下列命令是 oraenv 等公用程式正常運作所需的命令。</block>
  <block id="f34a9f7c077457a54f8838b55b9fc025" category="section-title">參數更新</block>
  <block id="fd5c3a935e7374f8b1577e73e85ef375" category="paragraph">必須更新儲存的 pfile 、以反映新伺服器上的任何路徑變更。資料檔案路徑變更是由 RMAN 複製指令碼所變更、幾乎所有資料庫都需要變更<block ref="d98137bd230dac4372cf20a2e7839463" prefix=" " category="inline-code"></block> 和<block ref="2d205df7ae2efff1576140524b40b93c" prefix=" " category="inline-code"></block> 參數。也可能有必須變更的稽核檔案位置和參數、例如<block ref="40f8833ae28ec69bcc89eb0eba090fe4" prefix=" " category="inline-code"></block> 在 ASM 之外可能無關緊要。經驗豐富的 DBA 應仔細審查建議的變更、然後再繼續。</block>
  <block id="b581dd429e9b4c24127b8940ca8e4346" category="paragraph">在此範例中、主要變更為控制檔位置、記錄歸檔目的地、以及新增<block ref="0f2d7ef9b967c2d9fb1ad5aa5e9eb688" prefix=" " category="inline-code"></block> 參數。</block>
  <block id="bbba1f65801697ba3abd94d90c83ba71" category="paragraph">確認新參數之後、必須使參數生效。存在多個選項、但大多數客戶會根據文字 pfile 建立 spfile 。</block>
  <block id="3a17a12678d74dabb1032aaf373166d8" category="section-title">啟動 nomount</block>
  <block id="a9dc570a0b3161e69edc31f3545cbf22" category="paragraph">複寫資料庫之前的最後一個步驟是啟動資料庫程序、但不要掛載檔案。在此步驟中、 spfile 可能會出現問題。如果是<block ref="357eedab214bb515c5622e275bc19cdb" prefix=" " category="inline-code"></block> 命令因參數錯誤而失敗、關機很簡單、請修正 pfile 範本、將其重新載入為 spfile 、然後再試一次。</block>
  <block id="0257eff4bf9bf0cb483f2544fd42f109" category="section-title">複製資料庫</block>
  <block id="4632b675c558eda129fe6da4fbbae2b2" category="paragraph">將先前的 RMAN 備份還原至新位置、比此程序中的其他步驟花費更多時間。必須複製資料庫、而不需變更資料庫 ID （ DBID ）或重新設定記錄。這可防止套用記錄、這是完全同步複本的必要步驟。</block>
  <block id="06206ea0cdea741420d9f7619503db89" category="paragraph">使用 RMAN AS aux 連線至資料庫、並使用在前一個步驟中建立的指令碼發出重複資料庫命令。</block>
  <block id="5ae45dfed3c4aff7fe4fd6a7e3606cb0" category="paragraph">您現在必須將變更從來源資料庫傳送至新位置。這樣做可能需要多個步驟的組合。最簡單的方法是讓來源資料庫上的 RMAN 將歸檔記錄寫入共用網路連線。如果無法使用共用位置、則另一種方法是使用 RMAN 寫入本機檔案系統、然後使用 rcp 或 rsync 複製檔案。</block>
  <block id="e355807335e5f05930a748afe1c3b23d" category="paragraph">在此範例中<block ref="45987b06d5eae35fc3e3487749a9ba27" prefix=" " category="inline-code"></block> 目錄是一種 NFS 共用、可同時用於原始和移轉的資料庫。</block>
  <block id="49fffa356bcd041918ce24ef714f3f72" category="paragraph">此處的一個重要問題是<block ref="6761e3b36547cd115b3966fcbc7192b2" prefix=" " category="inline-code"></block> 條款。備份的磁碟格式為<block ref="9ae0f22d9fa2eac270499e74092af364" prefix=" " category="inline-code"></block>，這表示您必須使用資料庫的執行緒編號、序號和啟動 ID 格式。雖然字母不同、但這與相符<block ref="03e92f2c3a8cae5315f0e42bf6acf436" prefix=" " category="inline-code"></block> pfile 中的參數。此參數也會以執行緒編號、序號和啟動 ID 的格式來指定封存記錄。最終結果是來源上的記錄檔備份使用資料庫預期的命名慣例。如此一來、就能執行像這樣的作業<block ref="81168dbef15af03d02c51a7447378e76" prefix=" " category="inline-code"></block> 更簡單、因為 sqlplus 能正確預測要重新播放的歸檔記錄名稱。</block>
  <block id="76d77393c7ffc6b0a0edd47ad09afe4d" category="paragraph">檔案在歸檔記錄位置後、可以發出命令來重新播放<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block> 接著是回應<block ref="e1f2d5134ed2543d38a0de9751cf75d9" prefix=" " category="inline-code"></block> 自動重播所有可用的記錄。參數檔目前正在將歸檔記錄導向<block ref="e421a42fc6f604fcc78707336ed222b9" prefix=" " category="inline-code"></block>但這與 RMAN 用於保存日誌的位置不匹配。在恢復資料庫之前、可依下列方式暫時重新導向位置。</block>
  <block id="0a96a4559ad3ab8c616a12a207e8daca" category="paragraph">最終的歸檔記錄回覆會回報錯誤、但這是正常現象。此錯誤表示 sqlplus 正在尋找特定的記錄檔、但找不到該檔案。原因很可能是記錄檔尚未存在。</block>
  <block id="e2a234d3299b9e66f0756db00c9ee8c7" category="paragraph">在大多數情況下、移轉作業不會立即執行。移轉程序可能在幾天甚至幾週前完成、這表示記錄必須持續運送至複本資料庫並重新執行。這樣做可確保轉換程序到達時、必須傳輸和重播最少的資料。</block>
  <block id="247e1695519da78866726a4dcb2c5252" category="paragraph">此程序很容易撰寫指令碼。例如、您可以在原始資料庫上排程下列命令、以確保用於記錄傳送的位置持續更新。</block>
  <block id="3ce19ecb7c874f75b9a46e29abe2012e" category="inline-link-macro">重播待命資料庫上的記錄</block>
  <block id="469d3082a0f3ad08223ba8fe69bf9311" category="paragraph">在收到記錄之後、必須重新播放記錄。先前的範例顯示使用 sqlplus 來手動執行<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block>可輕鬆自動化。此處顯示的範例使用中所述的指令碼 <block ref="7c7730292e0135c86626e1771f7f02ec" category="inline-link-macro-rx"></block>。指令碼會接受一個引數、指定需要重新執行作業的資料庫。此程序允許在多資料庫移轉工作中使用相同的指令碼。</block>
  <block id="15d3442f7626bb62f4b255c7ed5c5098" category="paragraph">準備好切換至新環境時、您必須執行最後一次同步。使用一般檔案系統時、由於原始的重作記錄會複製並重新播放、因此很容易確保移轉的資料庫與原始資料庫 100% 同步。使用 ASM 執行此作業的方法並不理想。只有歸檔日誌可以輕鬆地重新記錄。為了確保不會遺失任何資料、必須謹慎執行原始資料庫的最終關機。</block>
  <block id="f9952f2469fbec5fc9dca180322ff9ee" category="list-text">首先、必須將資料庫暫時禁用、確保不會進行任何變更。這種停止可能包括停用排程作業、關閉接聽程式及 / 或關閉應用程式。</block>
  <block id="58fd1c52efcde7151ac264a8f67b14ff" category="list-text">執行此步驟後、大多數 DBA 會建立一個虛擬表格、做為關機的標記。</block>
  <block id="442da9ab2cced82a6cbdd112be285bcf" category="list-text">強制記錄歸檔、以確保在歸檔記錄檔中記錄建立虛擬表格。若要這麼做、請執行下列命令：</block>
  <block id="83fce8a41250d6af49205f9659468351" category="list-text">若要複製最後一個歸檔記錄檔、請執行下列命令。資料庫必須可用、但不可開啟。</block>
  <block id="1b0e887c1394d4617c2a5243da19e44e" category="list-text">若要複製歸檔記錄檔、請執行下列命令：</block>
  <block id="86a7e05acb17098c514dd570b9220302" category="list-text">最後、在新伺服器上重播剩餘的歸檔記錄。</block>
  <block id="a430882deb5403e7b4b8061dec17cc80" category="list-text">在此階段、複寫所有資料。資料庫已準備好從待命資料庫轉換為作用中的作業資料庫、然後開啟。</block>
  <block id="077c7bcbf9a94bb62aecadc85045886e" category="list-text">確認虛擬表格是否存在、然後將其丟棄。</block>
  <block id="6130a27b8ec8ccf18e06bb3389b0fbbd" category="section-title">不中斷的重作記錄移轉</block>
  <block id="26c294f993888218237d5f9306bfcfc4" category="paragraph">有時資料庫會在整體上正確組織、但重做記錄除外。這可能是因為許多原因、其中最常見的原因與快照有關。SnapManager for Oracle 、 SnapCenter 和 NetApp Snap Creator 儲存管理架構等產品可讓您近乎即時地恢復資料庫、但前提是您必須還原資料檔案磁碟區的狀態。如果重做記錄檔與資料檔案共用空間、則無法安全執行還原、因為還原會導致重做記錄檔毀損、這可能表示資料遺失。因此、重做記錄必須重新定位。</block>
  <block id="2c56f5081b94b926c93c40f4c935a44a" category="paragraph">此程序很簡單、可在不中斷營運的情況下執行。</block>
  <block id="2986f9fe7ed4aab5aaa64c2ee9fe4841" category="section-title">目前的重做記錄組態</block>
  <block id="dd786d22c88a5f1fe0c10cfec58c1b44" category="list-text">識別重做記錄群組的數目及其各自的群組編號。</block>
  <block id="3cd0f7a32a4f5ee026702f8125f3dda7" category="list-text">輸入重做記錄檔的大小。</block>
  <block id="7c2f6ada37d59f2be0bc1a3ead80f77c" category="section-title">建立新記錄</block>
  <block id="106b215e5d87fb1256e47932f2ebf9cf" category="list-text">針對每個重做記錄、建立一個大小和成員數目相符的新群組。</block>
  <block id="0851b65f20b98420968e488fc3c0085e" category="list-text">驗證新組態。</block>
  <block id="cbccec9e0905e0b7f5cd630a3fa12f64" category="section-title">刪除舊記錄</block>
  <block id="00f63618719701ddae7fc2ff1d406ec2" category="list-text">刪除舊記錄（群組 1 、 2 和 3 ）。</block>
  <block id="f00c8361a8acc818247282bb6420a8c1" category="list-text">如果您遇到錯誤、導致無法刪除作用中記錄、請強制切換至下一個記錄檔、以釋放鎖定並強制建立全域檢查點。請參閱下列此程序範例。由於此記錄檔中仍有作用中的資料、因此拒絕嘗試丟棄位於舊位置的記錄檔群組 2 。</block>
  <block id="5d49a93437a42d2926c8be7eb3c7a56f" category="list-text">記錄歸檔之後再加上檢查點、可讓您捨棄記錄檔。</block>
  <block id="e3898c187d7edf64fc8e4d4e409fd244" category="list-text">然後從檔案系統刪除記錄。您應該非常小心地執行此程序。</block>
  <block id="dacc2a633e9981c9f91e43ac6b59e889" category="paragraph">Oracle 資料移轉可在下列三個層級中進行：資料庫、主機或儲存陣列。</block>
  <block id="5153193d50d4c628312db2d5bc0132ed" category="paragraph">不同之處在於整體解決方案的哪個元件負責移動資料：資料庫、主機作業系統或儲存系統。</block>
  <block id="cc3e73ae592a355b9beb405232d08fe2" category="paragraph">下圖顯示移轉層級和資料流的範例。在資料庫層級移轉的情況下、資料會從原始儲存系統透過主機和資料庫層移至新環境。主機層級移轉類似、但資料不會通過應用程式層、而是使用主機程序寫入新位置。最後、隨著儲存層級移轉、 NetApp FAS 系統等陣列也會負責資料移動。</block>
  <block id="204415652114bfb773b51cd76c8c692e" category="paragraph"><block ref="204415652114bfb773b51cd76c8c692e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b059e0e23ffaa8fbd97f681942ce0018" category="paragraph">資料庫層級移轉通常指透過待命資料庫傳送 Oracle 記錄以完成 Oracle 層級的移轉。主機層級的移轉是使用主機作業系統組態的原生功能來執行。此組態包括檔案複製作業、使用 CP 、 tar 和 Oracle Recovery Manager （ RMAN ）等命令、或使用邏輯 Volume Manager （ LVM ）來重新定位檔案系統的基礎位元組。Oracle 自動儲存管理（ ASM ）被歸類為主機層級功能、因為它的執行層級低於資料庫應用程式層級。ASM 取代主機上一般的邏輯磁碟區管理程式。最後、資料可以在儲存陣列層級上移轉、也就是在作業系統層級之下。</block>
  <block id="228d9e0418aa12bae73676a5743558db" category="section-title">規劃考量</block>
  <block id="ce7eea640cd6ee20e55cbe868f4026e9" category="paragraph">最佳移轉選項取決於多種因素、包括要移轉的環境規模、避免停機的需求、以及執行移轉所需的整體工作。大型資料庫顯然需要更多時間和精力來進行移轉、但這類移轉的複雜度極低。小型資料庫可以快速移轉、但如果要移轉數千個資料庫、則工作規模可能會造成複雜問題。最後、資料庫越大、業務關鍵的可能性就越大、因此需要將停機時間降至最低、同時保留一條後端路徑。</block>
  <block id="d4b9b19593598d98059aae44d6a7bbe1" category="paragraph">此處將討論規劃移轉策略的一些考量事項。</block>
  <block id="931c6f2c99380fbd899e3eaa31e97d98" category="section-title">資料大小</block>
  <block id="64e4d570abeebacf6bdcb19dfb73fcae" category="paragraph">要移轉的資料庫大小顯然會影響移轉規劃、但大小不一定會影響轉換時間。當必須移轉大量資料時、主要考量的是頻寬。複製作業通常是以高效率的連續 I/O 來執行保守估計、假設複製作業的可用網路頻寬使用率為 50% 。例如、 8GB FC 連接埠理論上可傳輸約 800MBps 。假設使用率為 50% 、則資料庫的複製速度約為 400Mbps 。因此、 10TB 資料庫可在此速率下在大約七小時內複製。</block>
  <block id="84a80a048e7abc027dd6bdce55fda9d2" category="inline-link-macro">線上資料檔案移動</block>
  <block id="1c169b76761527b28040655a783e50a2" category="section-title">資料庫計數</block>
  <block id="da3770c5d6d1215e9f2524b9d7b7c3c5" category="paragraph">在許多情況下、移動大量資料的問題並不是資料大小、而是支援資料庫的組態複雜度。只要知道必須移轉 50TB 的資料庫、就無法獲得足夠的資訊。它可以是單一 50TB 關鍵任務資料庫、 4 、 000 個舊資料庫的集合、或是正式作業和非正式作業資料的混合。在某些情況下、大部分資料是由來源資料庫的複本所組成。這些複本完全不需要移轉、因為它們可以輕鬆地重新建立、特別是當新架構設計為使用 NetApp FlexClone Volume 時。</block>
  <block id="a1739e745a7544d2432b2b990a715817" category="paragraph">在移轉規劃方面、您必須瞭解範圍內有多少資料庫、以及它們的優先順序。隨著資料庫數量的增加、偏好的移轉選項在堆疊中會較低和較低。例如、在 RMAN 和短暫停機的情況下、複製單一資料庫可能很容易。這是主機層級的複寫。</block>
  <block id="284723d6a05b50ace5e5b96c761d03ac" category="paragraph">如果有 50 個資料庫、可能會更容易避免設定新的檔案系統結構來接收 RMAN 複本、而改為將資料移到適當位置。此程序可透過利用主機型 LVM 移轉來將資料從舊 LUN 重新放置到新的 LUN 來完成。這樣做會將責任從資料庫管理員（ DBA ）團隊移轉至作業系統團隊、因此資料會以透明方式移轉至資料庫。檔案系統組態不變。</block>
  <block id="8e734da04d394519001f47f723341e9d" category="paragraph">最後、如果必須移轉 200 部伺服器上的 500 個資料庫、則可使用 ONTAP 外部 LUN 匯入（ FLI ）功能等儲存型選項來執行 LUN 的直接移轉。</block>
  <block id="39f43935349622951e0f392c83b6e736" category="section-title">重新架構需求</block>
  <block id="50f1558a3f9d47464b5d57f9d9d0f9d1" category="paragraph">一般而言、必須變更資料庫檔案配置才能運用新儲存陣列的功能、但情況並非總是如此。例如、 EF 系列 All Flash 陣列的功能主要是針對 SAN 效能和 SAN 可靠性。在大多數情況下、資料庫可以移轉至 EF 系列陣列、而無需特別考量資料配置。唯一的要求是高 IOPS 、低延遲和強大的可靠性。雖然 RAID 組態或動態磁碟集區等因素都有最佳實務做法、但 EF 系列專案很少需要對整體儲存架構進行任何重大變更、才能運用這些功能。</block>
  <block id="0e2c78f7e9948e19ccb1bf2e1b7f0faf" category="paragraph">相反地、移轉至 ONTAP 通常需要更多考量資料庫配置、以確保最終組態能提供最大價值。ONTAP 本身可為資料庫環境提供許多功能、即使沒有任何特定的架構工作也沒問題。最重要的是、當目前的硬體達到使用壽命時、它能夠不中斷地移轉至新的硬體。一般而言、移轉至 ONTAP 是您最後需要執行的移轉作業。隨後的硬體即會就地升級、資料也不會中斷營運地移轉至新媒體。</block>
  <block id="ad93bd21d59f2286385dc519fd7e39fb" category="paragraph">有了一些規劃、就能獲得更多效益。使用快照時最重要的考量事項。快照是執行近乎即時的備份、還原及複製作業的基礎。作為快照功能的範例、已知最大的用途是在 6 個控制器上的約 250 個 LUN 上執行單一資料庫 996TB 。此資料庫可在 2 分鐘內備份、 2 分鐘內還原、 15 分鐘內複製完成。其他優點包括：能夠在叢集內移動資料、以因應工作負載的變化、以及應用服務品質（ QoS ）控制來在多資料庫環境中提供良好且一致的效能。</block>
  <block id="6b48ce64da84423ce167ffb72f5f9a8b" category="inline-link-macro">Oracle 移轉程序概述</block>
  <block id="1311d3b592e4da5950e91965dac1d593" category="paragraph">QoS 控制、資料重新配置、快照和複製等技術幾乎可在任何組態中運作。不過、一般需要考慮一些方法才能最大化效益。在某些情況下、資料庫儲存配置可能需要變更設計、以最大化對新儲存陣列的投資。這類設計變更可能會影響移轉策略、因為主機型或儲存型移轉會複寫原始資料配置。完成移轉並提供針對 ONTAP 最佳化的資料配置、可能需要其他步驟。中所示的程序 <block ref="d4d5600aaaced44e203002ec1910822d" category="inline-link-macro-rx"></block> 稍後、我們將示範一些方法、讓您不只是移轉資料庫、還能以最少的心力將資料庫移轉至最佳的最終配置。</block>
  <block id="1fd9b0a8321228b5b8ad4be85e71cf64" category="section-title">轉換時間</block>
  <block id="95b9194d9f06f6f70febc87c071f3050" category="paragraph">應決定轉換期間允許的服務中斷上限。假設整個移轉程序會造成中斷、這是常見的錯誤。許多工作都可以在服務中斷開始之前完成、許多選項都能在不中斷或中斷的情況下完成移轉。即使無法避免中斷、您仍必須定義允許的服務中斷上限、因為轉換時間的持續時間因程序而異。</block>
  <block id="9cfeaf56d2fc41c2695a69adf260c3f8" category="section-title">回溯路徑</block>
  <block id="f493e16f7e2caba820eba88a1c5f82d8" category="paragraph">沒有移轉作業完全沒有風險。即使技術運作正常、使用者也永遠可能發生錯誤。與所選移轉路徑相關的風險、必須與移轉失敗的後果一併考量。例如、 Oracle ASM 的透明線上儲存移轉功能是其重要功能之一、這是最可靠的方法之一。然而、資料正以這種方法進行無法扭轉的複製。在 ASM 發生問題的極不可能發生的事件中、沒有簡單的回傳路徑。唯一的選項是還原原始環境、或使用 ASM 將移轉回復至原始 LUN 。如果系統能夠執行此類作業、則可在原始儲存系統上執行快照類型備份、將風險降至最低、但不會消除。</block>
  <block id="1886f1ab01daa4511ce537d1af675427" category="section-title">排練</block>
  <block id="dd5dac65febd7071311b1ae3be1eca90" category="paragraph">某些移轉程序必須在執行前經過完整驗證。移轉和排練轉換程序是關鍵任務資料庫的常見要求、移轉必須成功、停機時間必須降至最低。此外、使用者驗收測試通常是移轉後工作的一部分、只有在完成這些測試之後、才能將整個系統恢復正常運作。</block>
  <block id="7d06b32cdd06d27f7c62fb110d831e60" category="paragraph">如果需要排練、有幾項 ONTAP 功能可以讓流程更輕鬆。特別是、快照可以重設測試環境、並快速建立資料庫環境的多個具空間效益的複本。</block>
  <block id="440a667261bd94f099ef4dde5caf024f" category="summary">移轉個別的 Oracle 資料檔案</block>
  <block id="727bb4db430517995ca651c4f57b0c9f" category="doc">資料檔案移動</block>
  <block id="fade70b277397e039e100bf0faa98d8e" category="paragraph">單一命令即可移動個別的 Oracle 資料檔案。</block>
  <block id="50c3d56e93d52f122bab9de1f2b35780" category="paragraph">例如、下列命令會將資料檔案 IOPST.dbf 從檔案系統中移出<block ref="87941c54be03c9785752ea54ac9a2dd4" prefix=" " category="inline-code"></block> 至檔案系統<block ref="eff8b2f7c4da1cf002bdea257a43fd10" prefix=" " category="inline-code"></block>。</block>
  <block id="53784088a62519d581c3dac4640c41b5" category="paragraph">使用此方法移動資料檔案可能會很慢、但通常不應產生足夠的 I/O 、而會干擾日常資料庫工作負載。相反地、透過 ASM 重新平衡移轉可以更快執行、但卻會在資料移動時降低整體資料庫的速度。</block>
  <block id="f92065612dfd409585ca08d95cc7a4dc" category="paragraph">您可以建立測試資料檔、然後移動資料檔案、輕鬆測量移動資料檔案所需的時間。操作所耗用的時間會記錄在 v$ 工作階段資料中：</block>
  <block id="78fb69ccdf01155db62828d0bc182b84" category="paragraph">在此範例中、移動的檔案是 datafile 8 、大小為 21 GB 、需要約 6 分鐘才能移轉。所需時間顯然取決於儲存系統、儲存網路的功能、以及移轉時發生的整體資料庫活動。</block>
  <block id="593b763e01de37a327966ee1abb3f8a2" category="summary">使用主機端儲存堆疊進行 Oracle 移轉</block>
  <block id="3dc2d5f8d7209bb75e8d67aed68bc5ed" category="paragraph">如同資料庫層級的移轉、主機層的移轉也提供儲存設備廠商的不受侷連的方法。</block>
  <block id="1686ceaaa0d8fb4f9a8adb5e717b029c" category="paragraph">換句話說、有時候「只複製檔案」是最佳選擇。</block>
  <block id="d5732a4ab4c633ceb871cebdbf9ae34f" category="paragraph">雖然這種低技術方法似乎過於基本、但它確實提供了顯著的效益、因為不需要特殊軟體、而且在程序期間、原始資料仍保持安全不變。主要的限制是檔案複製資料移轉是一項破壞性程序、因為必須在複製作業開始之前關閉資料庫。沒有適當的方法可以同步處理檔案中的變更、因此檔案必須在開始複製之前完全處於禁用狀態。</block>
  <block id="706e7514bb30a289d7ce786a1a5c2ca0" category="paragraph">如果複製作業所需的關機不理想、則下一個最佳的主機型選項是使用邏輯 Volume Manager （ LVM ）。包括 Oracle ASM 在內的許多 LVM 選項都具有類似的功能、但也有一些必須考量的限制。在大多數情況下、可在不中斷或停機的情況下完成移轉。</block>
  <block id="f58e97ac8406ca3e8f0bb7a019a81985" category="section-title">檔案系統複製到檔案系統</block>
  <block id="a08ab728e75c63a41ce7571cb781cda2" category="paragraph">不應低估簡單複製作業的效用。這項作業需要在複製程序期間停機、但這是一個非常可靠的程序、不需要操作系統、資料庫或儲存系統的專門知識。此外、它也非常安全、因為它不會影響原始資料。通常、系統管理員會將來源檔案系統變更為唯讀安裝、然後重新啟動伺服器、以保證沒有任何東西會損壞目前的資料。複製程序可以撰寫指令碼、確保能以最快的速度執行、而不會發生使用者錯誤的風險。由於 I/O 類型是簡單的資料循序傳輸、因此具有極高的頻寬效率。</block>
  <block id="ba0bd93801872993ce832352dd03b56a" category="paragraph">下列範例示範安全快速移轉的一個選項。</block>
  <block id="d8cb8bcd239bbe7a2a488c1d68dbe420" category="paragraph">要移轉的環境如下：</block>
  <block id="3ffbdefc66ad1d1e707c1d6820afbdc0" category="list-text">目前的檔案系統</block>
  <block id="bdc9e98c6b17bb14a7bce916054413ba" category="list-text">新檔案系統</block>
  <block id="3b878279a04dc47d60932cb294d96259" category="section-title">總覽</block>
  <block id="e76912cd513cc8cbcabc2735b524e814" category="paragraph">資料庫可由 DBA 移轉、只需關閉資料庫並複製檔案即可、但如果必須移轉許多資料庫、或是將停機時間降至最低、則此程序很容易撰寫指令碼。使用指令碼也能降低使用者錯誤的機率。</block>
  <block id="d21aae9692f3b1d4e53fd73131414b93" category="paragraph">所示範例指令碼可自動化下列作業：</block>
  <block id="66909ae9d06bad444f5a059b8ee2cd41" category="list-text">關閉資料庫</block>
  <block id="ae737f3f8c04ccbefa99b2bbf87dccc2" category="list-text">將現有檔案系統轉換為唯讀狀態</block>
  <block id="1dd90b7b28cbd03687df6538c66ff494" category="list-text">將所有資料從來源複製到目標檔案系統、以保留所有檔案權限</block>
  <block id="741341be7809d7f5765b2352e6ab0aab" category="list-text">卸載舊的和新的檔案系統</block>
  <block id="7465bc030ca3fe236bcf3ecdf8aaebe4" category="list-text">將新檔案系統重新掛載到與先前檔案系統相同的路徑</block>
  <block id="8c4271e6faf2cea4cfc8e5b7108d8ee9" category="section-title">程序</block>
  <block id="b273f8d4284bd1f58cfbafe8065af9fa" category="list-text">關閉資料庫。</block>
  <block id="67eadd4b70772835f318e6d3027e4308" category="inline-link-macro">將檔案系統轉換為唯讀</block>
  <block id="474aae6515223cc3ba71074c9d5abcae" category="list-text">將檔案系統轉換為唯讀。如所示、使用指令碼可以更快完成這項工作 <block ref="2d6e37849c641071fe1cf71ac348d28c" category="inline-link-macro-rx"></block>。</block>
  <block id="4879ec77723fce4974f8ae2a7f87121a" category="list-text">確認檔案系統現在為唯讀。</block>
  <block id="c91e7f5dba3c873d0978f4892bf8b3f2" category="list-text">將檔案系統內容與同步<block ref="89a4551b0f29c1a652648b1cb8747021" prefix=" " category="inline-code"></block> 命令。</block>
  <block id="91e702884985853b8a7091ed5f2beceb" category="inline-link-macro">取代檔案系統</block>
  <block id="ea27cab9fe7b891870e0ce59aa34e853" category="list-text">卸載舊檔案系統、並重新放置複製的資料。如所示、使用指令碼可以更快完成這項工作 <block ref="fa3b775593af4f3de8972aced258710d" category="inline-link-macro-rx"></block>。</block>
  <block id="5fe2431acb45422c46eadf66a93851af" category="list-text">確認新檔案系統已就位。</block>
  <block id="2d53403ab873059f92ad884eb271e8dc" category="list-text">啟動資料庫。</block>
  <block id="40351c33ab81b8b374a20fd292057481" category="section-title">全自動轉換</block>
  <block id="3f70361470a11fb351c83257cd7aa63e" category="paragraph">此範例指令碼接受資料庫 SID 的引數、後面接著通用分隔的檔案系統配對。如前所示、命令發出方式如下：</block>
  <block id="5cddd7b314b7ae819e2cfcac85021426" category="paragraph">執行時、範例指令碼會嘗試執行下列順序。如果在任何步驟中遇到錯誤、它都會終止：</block>
  <block id="43d4fce7952ee09c0c8df60a17f5ea56" category="list-text">將目前的檔案系統轉換為唯讀狀態。</block>
  <block id="9d53d62d1e6dc69460f47c83e6c1919d" category="list-text">使用每個以逗號分隔的檔案系統引數配對、並將第一個檔案系統同步到第二個檔案系統。</block>
  <block id="39ff0e6dfa9915344ec96f9e78a27267" category="list-text">卸除先前的檔案系統。</block>
  <block id="e220fa2a2806386a64e9860f27372e43" category="list-text">更新<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 檔案如下：</block>
  <block id="232c2c4ddd45fc028ae13b58251c5f7e" category="list-text">請在下列位置建立備份<block ref="9eb56e72a6bb8350a1453c2762d14178" prefix=" " category="inline-code"></block>。</block>
  <block id="d5082ae73767550813688202df21bc4d" category="list-text">註解先前和新檔案系統的先前項目。</block>
  <block id="b8793b424d1738f1e00e545379867b0d" category="list-text">為使用舊掛載點的新檔案系統建立新項目。</block>
  <block id="29478980f354caa483bc0cfb827c7251" category="list-text">掛載檔案系統。</block>
  <block id="a0ec0d8bede7d9d58172084de7d5ce53" category="paragraph">下列文字提供此指令碼的執行範例：</block>
  <block id="350265a378d2cb1183cd51d56f0e5843" category="section-title">Oracle ASM spfile 和 passwd 移轉</block>
  <block id="f37bc722651f2fd86ba4da87f947c4db" category="paragraph">在完成涉及 ASM 的移轉時、有一個困難是 ASM 專屬的 spfile 和密碼檔案。根據預設、這些關鍵中繼資料檔案會建立在定義的第一個 ASM 磁碟群組上。如果必須撤出和移除特定的 ASM 磁碟群組、則必須重新放置管理該 ASM 執行個體的 spfile 和密碼檔案。</block>
  <block id="88e2a97e52f9854b59ce63e74c4b0cac" category="paragraph">另一個需要重新放置這些檔案的使用案例是在部署資料庫管理軟體時、例如 SnapManager for Oracle 或 SnapCenter Oracle 外掛程式。這些產品的其中一項功能是透過還原代管資料檔案的 ASM LUN 狀態、快速還原資料庫。這樣做需要在執行還原之前將 ASM 磁碟群組離線。只要指定資料庫的資料檔案隔離在專用的 ASM 磁碟群組中、這不是問題。</block>
  <block id="24de04443b6bdae76336fcab04ae946c" category="paragraph">當該磁碟群組也包含 ASM spfile/passwd 檔案時、唯一可以將磁碟群組離線的方法是關閉整個 ASM 執行個體。這是一項破壞性程序、也就是說、 spfile/passwd 檔案必須重新放置。</block>
  <block id="a6221bf4332cc966c69066295a843480" category="list-text">資料庫 SID = Toast</block>
  <block id="0af0da2831407b8130e7f2fabdfab87d" category="list-text">目前的資料檔案位於<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block></block>
  <block id="24aa2824a0b52b46b301afdb3af9336f" category="list-text">上目前的記錄檔和控制檔<block ref="ad6062251d172504e3b3bed3a8256a5a" prefix=" " category="inline-code"></block></block>
  <block id="bb6de9ea84381f7d01fdd038f104e4ae" category="list-text">建立為的新 ASM 磁碟群組<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block> 和<block ref="5e20ccf28224fc0cc564f9825c208dbd" prefix=" " category="inline-code"></block></block>
  <block id="8b14bd9d310bf8b211c19645576201e3" category="section-title">ASM spfile/passwd 檔案位置</block>
  <block id="7c7d8dd5d09a73f06678562b66dcdc68" category="paragraph">您可以不中斷地重新放置這些檔案。不過、為了安全起見、 NetApp 建議您關閉資料庫環境、以便確定檔案已重新放置、且組態已正確更新。如果伺服器上有多個 ASM 執行個體、則必須重複此程序。</block>
  <block id="3666b74ddcf77306328ac5d6db94fecd" category="section-title">識別 ASM 執行個體</block>
  <block id="9d19a85576af8e1b3dbd78e343a2b022" category="paragraph">根據中記錄的資料來識別 ASM 執行個體<block ref="9da4474b569071bcb2ece1d0bdfe7560" prefix=" " category="inline-code"></block> 檔案：ASM 執行個體以 + 符號表示。</block>
  <block id="3fe2dd8cf6f82ac15544fd96f9b59b28" category="paragraph">此伺服器上有一個稱為 +ASM 的 ASM 執行個體。</block>
  <block id="35a557b0490d5a93931025eaaf712cac" category="section-title">確定所有資料庫都已關閉</block>
  <block id="e6b0819ae1eca7d408a097efc2fbf2cf" category="paragraph">唯一可見的 SMON 程序應該是使用中 ASM 執行個體的 SMON 。另一個 SMON 程序的存在表示資料庫仍在執行中。</block>
  <block id="97639c779a60f010af01997e2363f4eb" category="paragraph">唯一的 SMON 程序是 ASM 執行個體本身。這表示沒有其他資料庫正在執行中、而且在不中斷資料庫作業的風險下繼續作業是安全的。</block>
  <block id="a8d157790e55d19378ddbbdfeb675ef8" category="section-title">尋找檔案</block>
  <block id="12d8c982eb4072e31ac4bfe375193160" category="paragraph">使用識別 ASM spfile 和密碼檔案的目前位置<block ref="e258dbf5114b4df07f0d9e72deb386f2" prefix=" " category="inline-code"></block> 和<block ref="bb41cdf6c9bb75ee17856f938070f23d" prefix=" " category="inline-code"></block> 命令。</block>
  <block id="bebe64e9d0d4ae3d44b4dfb3583e0109" category="paragraph">這些檔案都位於的基礎上<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 磁碟群組。</block>
  <block id="558f28628ba8ab4cb8420949524832d3" category="section-title">複製檔案</block>
  <block id="c0c2c850cb11c5bb52abbd55a9578e54" category="paragraph">使用將檔案複製到新的 ASM 磁碟群組<block ref="c0baea639672c84505e661b9e369c68a" prefix=" " category="inline-code"></block> 和<block ref="c7adee97d05083a7b65e4b6953045177" prefix=" " category="inline-code"></block> 命令。如果新磁碟群組是最近建立的、而且目前是空的、則可能需要先掛載。</block>
  <block id="3ed2faf3e1299edd7d92d6c4064f1579" category="paragraph">檔案現已從複製<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 至<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block>。</block>
  <block id="1dba5fc559232a8dae45d9f88ed36030" category="section-title">更新 ASM 執行個體</block>
  <block id="1fe2cc6cf436a4bcc6bdc41f947a416a" category="paragraph">現在必須更新 ASM 執行個體、以反映位置變更。。<block ref="c8b1affa9ec15d0c0e79347905e75d3e" prefix=" " category="inline-code"></block> 和<block ref="73fb08020d8535b4123a8968c596038c" prefix=" " category="inline-code"></block> 命令會更新啟動 ASM 磁碟群組所需的 ASM 中繼資料。</block>
  <block id="626759f91a0458b0c068cce8a05a6468" category="section-title">使用更新的檔案啟動 ASM</block>
  <block id="69f08287c6faa04381e5a05f4087abe1" category="paragraph">此時、 ASM 執行個體仍會使用這些檔案的先前位置。必須重新啟動執行個體、以強制重新讀取新位置的檔案、並釋放先前檔案上的鎖定。</block>
  <block id="5505cf0c514193b89221f1cef3004c58" category="section-title">移除舊的 spfile 和密碼檔案</block>
  <block id="8f2d3ac58be7a91f51d7ce9ffa04e397" category="paragraph">如果程序已成功執行、先前的檔案將不再鎖定、現在可以移除。</block>
  <block id="cfca2b2eb0d694e70904ec82f5d1c34e" category="section-title">Oracle ASM 至 ASM 複本</block>
  <block id="12632d520b8d9518b5622ac00dc764a8" category="paragraph">Oracle ASM 本質上是輕量的組合 Volume Manager 和檔案系統。由於檔案系統並不容易看到、因此 RMAN 必須用於執行複製作業。雖然複製型移轉程序既安全又簡單、但會造成部分中斷。可以將中斷降至最低、但不能完全消除。</block>
  <block id="152106ebb2aaa94cc87657d353331189" category="paragraph">如果您想要不中斷地移轉 ASM 型資料庫、最好的方法是利用 ASM 的功能、在移轉舊 LUN 的同時、重新平衡 ASM 擴充至新 LUN 的平衡。這樣做通常是安全且不中斷營運的、但它不提供回溯路徑。如果遇到功能或效能問題、唯一的選項是將資料移回來源。</block>
  <block id="81fe23a1ac3b2bb348e579b2c5b0f5d5" category="paragraph">您可以將資料庫複製到新位置而非移動資料、以避免此風險、避免原始資料受到影響。資料庫可以在新位置進行完整測試後再上線運作、如果發現問題、原始資料庫則可作為回復選項使用。</block>
  <block id="3028182db088e823770b3d02aa0eac9e" category="paragraph">此程序是 RMAN 的眾多選項之一。其設計允許建立初始備份的兩個步驟程序、然後透過記錄重播進行同步處理。這項程序最適合將停機時間降至最低、因為它可讓資料庫在初始基準複本期間維持運作並提供資料。</block>
  <block id="634f50a6c6f112c46150a301d749dbcb" category="section-title">複製資料庫</block>
  <block id="5f0bd85dd65afab1472713e8e034fff7" category="paragraph">Oracle RMAN 會建立目前位於 ASM 磁碟群組的來源資料庫層級 0 （完整）複本<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 移至新位置<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block>。</block>
  <block id="b51dc519efad4b151a05682b68f4b182" category="section-title">強制歸檔記錄切換</block>
  <block id="10793485747151dfa2eaddb0854c84b2" category="paragraph">您必須強制使用歸檔記錄切換、以確保歸檔記錄包含所有必要資料、使複本完全一致。如果沒有此命令、重做記錄檔中可能仍會有關鍵資料。</block>
  <block id="c55a88a6b8fdc5972d4e2a4924f93dbf" category="section-title">關閉來源資料庫</block>
  <block id="9ec82bff06c706f42a8170befdd6cf39" category="paragraph">由於資料庫已關機、並處於有限存取、唯讀模式、因此在此步驟中就會開始中斷。若要關閉來源資料庫、請執行下列命令：</block>
  <block id="6ecf02e1343e82cf0cd95d7303346ff1" category="section-title">控制檔備份</block>
  <block id="e7bc82f6d1381df55ace121dc02368e6" category="paragraph">您必須備份控制檔、以防您必須中止移轉並還原至原始儲存位置。備份控制檔的複本並非 100% 必要、但它確實讓將資料庫檔案位置重設回原始位置的程序變得更簡單。</block>
  <block id="4e7a51f2c1ee60c69cd719d415f5e87a" category="paragraph">目前的 spfile 包含對舊 ASM 磁碟群組內控制檔目前位置的參照。您必須編輯此檔案、只要編輯中繼 pfile 版本即可輕鬆完成。</block>
  <block id="253e30479f86461bc79f2fca58ee4cb1" category="section-title">更新 pfile</block>
  <block id="35db8a54b9c7581f0f77b059233cc61b" category="paragraph">更新任何參照舊 ASM 磁碟群組的參數、以反映新的 ASM 磁碟群組名稱。然後儲存更新的 pfile 。請確定<block ref="5fa1d01559c04dcdb3ba05775712b1ab" prefix=" " category="inline-code"></block> 有參數存在。</block>
  <block id="bb607fbd46f48c3a4080ecda83288b69" category="paragraph">在以下範例中、請參考<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 變更為<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block> 以黃色反白顯示。兩個主要參數是<block ref="5fa1d01559c04dcdb3ba05775712b1ab" prefix=" " category="inline-code"></block> 在正確位置建立任何新檔案的參數。</block>
  <block id="5275e85db4d606621d8f074e44b95748" category="section-title">更新 init.ora 檔案</block>
  <block id="17a2b5d1af48f7f8d1511d5372896f7a" category="paragraph">大多數以 ASM 為基礎的資料庫都使用<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 檔案位於<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> 目錄、指向 ASM 磁碟群組上的 spfile 。此檔案必須重新導向至新 ASM 磁碟群組上的位置。</block>
  <block id="6ad274256421918b584abff3b9446b09" category="paragraph">變更此檔案的方式如下：</block>
  <block id="b6638505615764c377e2cf2585993fd0" category="section-title">參數檔案重新建立</block>
  <block id="52b21c2e6103a3b8d888a4185e21a787" category="paragraph">spfile 現在已準備好由編輯的 pfile 中的資料填入。</block>
  <block id="37f4738eddd35e77d15af55a40e1ab1c" category="section-title">啟動資料庫以開始使用新的 spfile</block>
  <block id="79f8a930424fe3b21dc30a72791171d4" category="paragraph">啟動資料庫以確保它現在使用新建立的 spfile 、並正確記錄對系統參數的任何進一步變更。</block>
  <block id="231ef0ea12d142611eeea2fdfad67114" category="section-title">還原控制檔</block>
  <block id="33cdbbeabc7f2c647f20b3f8b924307f" category="paragraph">RMAN 所建立的備份控制檔也可直接還原至新 spfile 中指定的位置。</block>
  <block id="ce656b7f351ebdc7c599aff6a99e0f2a" category="paragraph">裝入資料庫並驗證新控制檔的使用。</block>
  <block id="fda1e79fe400519496075b7e2871092a" category="section-title">記錄重新播放</block>
  <block id="daaec4441f16b5bac11476d4582a296c" category="paragraph">資料庫目前使用舊位置的資料檔案。在使用複本之前、必須先進行同步處理。初始複製程序已經過時間、變更主要記錄在歸檔記錄中。這些變更會複寫如下：</block>
  <block id="fca6726270a94f51cab3142509d32919" category="list-text">執行包含歸檔記錄的 RMAN 遞增備份。</block>
  <block id="8b8a5667b011b5f37163ff4da1004343" category="list-text">重新播放記錄。</block>
  <block id="a9a62e70841c4d06dd16306a85700d36" category="section-title">啟動</block>
  <block id="8fecb0145484a35b1d9d5926c945ca30" category="paragraph">還原的控制檔仍會參照原始位置的資料檔案、也會包含複製資料檔案的路徑資訊。</block>
  <block id="f590db5fdc10f6942f7cd173c0bb578b" category="list-text">若要變更使用中的資料檔案、請執行<block ref="7705ebb59373d0b1dfc71d86ef726f93" prefix=" " category="inline-code"></block> 命令。</block>
  <block id="2c5c2b5174eafe321358329636e80f5e" category="paragraph">使用中的資料檔案現在是複製的資料檔案、但最終的重做記錄檔中可能仍有變更。</block>
  <block id="fe83c5826bec1aa20e26802fa94a4a0f" category="list-text">若要重播所有剩餘記錄、請執行<block ref="81168dbef15af03d02c51a7447378e76" prefix=" " category="inline-code"></block> 命令。如果出現此訊息<block ref="cef3519da39a73834e89a18ca91951f1" prefix=" " category="inline-code"></block> 出現時、程序成功。</block>
  <block id="15434ad90ad32205a804fe96f265b91d" category="paragraph">此程序只會變更一般資料檔案的位置。必須重新命名暫存資料檔案、但不需要複製、因為它們只是暫時性的。資料庫目前關閉、因此暫存資料檔案中沒有作用中的資料。</block>
  <block id="2a7c5560f8e4ad220c853666c46eb051" category="list-text">若要重新放置暫存資料檔案、請先識別其位置。</block>
  <block id="10b2632cf9c3bf6568b36f6a37e627c2" category="list-text">使用 RMAN 命令重新定位暫存資料檔案、為每個資料檔案設定新名稱。使用 Oracle 託管檔案（ OMF ）時、不需要完整名稱； ASM 磁碟群組已足夠。開啟資料庫時、 OMF 會連結至 ASM 磁碟群組上的適當位置。若要重新定位檔案、請執行下列命令：</block>
  <block id="2c592b1e2841899b280deafe27eeefbf" category="section-title">重做記錄移轉</block>
  <block id="3f53598059c3bf11ff505ad9dc0d6776" category="paragraph">移轉程序即將完成、但重做記錄仍位於原始 ASM 磁碟群組中。重作記錄無法直接重新定位。而是會建立新的重做記錄集、並將其新增至組態、然後刪除舊的記錄。</block>
  <block id="d54f1c98a924385411a8488657b21dad" category="list-text">針對每個重做記錄、建立具有相符組態的新群組。如果您未使用 OMF 、則必須指定完整路徑。這也是使用的範例<block ref="c9655c773db3ebd5871fbe76c0e38a52" prefix=" " category="inline-code"></block> 參數。如先前所示、此參數設為 +NEWLOGS 。此組態可讓您使用下列命令來建立新的線上記錄檔、而無需指定檔案位置、甚至是特定的 ASM 磁碟群組。</block>
  <block id="3e0c7c8ee841e9919343fe45e3e04f2d" category="list-text">開啟資料庫。</block>
  <block id="7e4b38db083a404d0d628bdb1ad83311" category="list-text">刪除舊記錄。</block>
  <block id="37e48dd687a01e58ed329feebebf3198" category="list-text">如果您遇到錯誤、導致無法刪除作用中記錄、請強制切換至下一個記錄檔、以釋放鎖定並強制建立全域檢查點。範例如下所示。嘗試丟棄位於舊位置的記錄檔群組 3 、因為此記錄檔中仍有作用中資料、因此遭到拒絕。檢查點之後的記錄封存可讓您刪除記錄檔。</block>
  <block id="79d08abfbe5fd73dc85c55cd20ad4974" category="list-text">檢閱環境、確定所有位置型參數都已更新。</block>
  <block id="799f5ce04f1d9cad4455676b2fd908d9" category="list-text">下列指令碼示範如何簡化此程序：</block>
  <block id="9867dfc0eee2725f24f86d8114c356a0" category="list-text">如果 ASM 磁碟群組已完全撤出、現在可以使用卸載<block ref="ae709dc3414219bf2c9c8abc9ff6c67a" prefix=" " category="inline-code"></block>。不過、在許多情況下、屬於其他資料庫或 ASM spfile/passwd 檔案的檔案可能仍存在。</block>
  <block id="49f8dc5754bd205ea0da17521cb89a1f" category="section-title">Oracle ASM 至檔案系統複本</block>
  <block id="0f5b1767a58e43cb548226e94441dc07" category="paragraph">Oracle ASM 至檔案系統複製程序與 ASM 至 ASM 複製程序非常類似、具有類似的優點和限制。主要差異在於使用可見檔案系統時、不同命令和組態參數的語法、而非使用 ASM 磁碟群組。</block>
  <block id="b533404c568b600f9fceddeac9253964" category="paragraph">Oracle RMAN 用於建立目前位於 ASM 磁碟群組的來源資料庫層級 0 （完整）複本<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 移至新位置<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block>。</block>
  <block id="f78b0ab71e2863c28dbe331056451135" category="paragraph">必須強制使用歸檔記錄交換器、才能確保歸檔記錄包含所有必要資料、使複本完全一致。如果沒有此命令、重做記錄檔中可能仍會有關鍵資料。若要強制使用歸檔記錄交換器、請執行下列命令：</block>
  <block id="c37c761fc28428b9ead4533aba9ee148" category="paragraph">由於資料庫已關機、並處於有限存取的唯讀模式、因此此步驟開始造成中斷。若要關閉來源資料庫、請執行下列命令：</block>
  <block id="3abd8870d8a333edcaec6a1082520c67" category="paragraph">備份控制檔、以防您必須中止移轉並還原至原始儲存位置。備份控制檔的複本並非 100% 必要、但它確實讓將資料庫檔案位置重設回原始位置的程序變得更簡單。</block>
  <block id="38825215f02e25ca63ff64387b01c1c2" category="paragraph">任何參照舊 ASM 磁碟群組的參數都應該更新、在某些情況下、當不再相關時、就會刪除。更新它們以反映新的檔案系統路徑、並儲存更新的 pfile 。請確定已列出完整的目標路徑。若要更新這些參數、請執行下列命令：</block>
  <block id="9d0dce3e570fa0ec18269ca508809401" category="section-title">停用原始的 init.ora 檔案</block>
  <block id="03dda6526778417460fd0bbb7716b373" category="paragraph">此檔案位於<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> 目錄和通常位於 pfile 中、作為指向 ASM 磁碟群組上 spfile 的指標。若要確定不再使用原始 spfile 、請重新命名。不過、請勿刪除它、因為如果必須中止移轉、就需要此檔案。</block>
  <block id="6087f741090627369fd114fbc794abc4" category="paragraph">這是重新定位 spfile 的最後一步。原始 spfile 不再使用、而且資料庫目前是使用中繼檔案啟動（但未掛載）。此檔案的內容可以寫入新的 spfile 位置、如下所示：</block>
  <block id="3f62847435205b7b2af1bd5aaf1d3277" category="paragraph">您必須啟動資料庫以釋放中繼檔案上的鎖定、並只使用新的 spfile 檔案來啟動資料庫。啟動資料庫也能證明新的 spfile 位置正確、而且其資料有效。</block>
  <block id="ea164abfd83078cd71a2f3ba5d237900" category="paragraph">已在路徑上建立備份控制檔<block ref="7a1a1280501cff0194d8ce6e351f2a2c" prefix=" " category="inline-code"></block> 請稍早在程序中進行。新的 spfile 將控制檔位置定義為 <block ref="b4d54c88ccade13a82dcaf8f7c07cac5" prefix="/" category="inline-code"></block> 和<block ref="cd300fb0386526438b368e7a6d1b8ace" prefix=" " category="inline-code"></block>。不過、這些檔案尚不存在。</block>
  <block id="f7ed72e578ca8d23dd45bfa2c0a61ed8" category="list-text">此命令會將控制檔資料還原至 spfile 中定義的路徑。</block>
  <block id="c947c89cb4c7a595782d0be73bbe8cfa" category="list-text">發出 mount 命令、以便正確探索控制檔並包含有效資料。</block>
  <block id="da4ae71a31a1286600968f8a340fddb2" category="paragraph">驗證<block ref="d98137bd230dac4372cf20a2e7839463" prefix=" " category="inline-code"></block> 參數、請執行下列命令：</block>
  <block id="c25a81770c591c46d6909aae84bf5814" category="paragraph">資料庫目前正在使用舊位置的資料檔案。在使用複本之前、必須先同步資料檔案。在初始複製程序期間已經過時間、變更主要記錄在歸檔記錄中。以下兩個步驟會複寫這些變更。</block>
  <block id="95ea23a5654037c0ab2a5418478d9da2" category="list-text">重播記錄。</block>
  <block id="e726fdb8508ef59abc6d8ef533186382" category="list-text">若要變更使用中的資料檔案、請執行<block ref="7705ebb59373d0b1dfc71d86ef726f93" prefix=" " category="inline-code"></block> 命令：</block>
  <block id="7fdba4cfea0e0d298cda23e7f46e40c4" category="list-text">雖然資料檔案應完全一致、但仍需最後一步才能重播線上重作記錄中記錄的其餘變更。使用<block ref="81168dbef15af03d02c51a7447378e76" prefix=" " category="inline-code"></block> 命令重播這些變更、並使複本 100% 與原始版本相同。不過、複本尚未開啟。</block>
  <block id="8eb94d53286760da56ca9c892a49cd8b" category="section-title">重新部署暫存資料檔案</block>
  <block id="a1e7f15bee0eaa976661307aa884fd99" category="list-text">識別仍在原始磁碟群組中使用的暫存資料檔案位置。</block>
  <block id="89b79c94ceba42d5bc646c1b4b1acd24" category="list-text">若要重新放置資料檔案、請執行下列命令。如果有許多 tempfiles 、請使用文字編輯器建立 RMAN 命令、然後剪下並貼上。</block>
  <block id="81aa65cb154a5f125bbf3ede064d4b3f" category="paragraph">移轉程序即將完成、但重做記錄仍位於原始 ASM 磁碟群組中。重作記錄無法直接重新定位。而是建立新的重做記錄集、並在刪除舊記錄之後新增至組態。</block>
  <block id="6e46687c6cc5deabe53fa42932683c4d" category="list-text">對於每個重做記錄、請使用與目前重做記錄群組相同的大小、使用新的檔案系統位置來建立新群組。</block>
  <block id="22fd48a866ce4d04edb57c15b2fad5da" category="list-text">移除仍位於先前儲存設備上的舊記錄檔群組。</block>
  <block id="94158400e59555bf69ecd550887bd9f6" category="list-text">如果遇到阻止刪除作用中記錄的錯誤、請強制切換至下一個記錄檔、以釋放鎖定並強制建立全域檢查點。範例如下所示。嘗試丟棄位於舊位置的記錄檔群組 3 、因為此記錄檔中仍有作用中資料、因此遭到拒絕。記錄歸檔之後再加上檢查點、即可刪除記錄檔。</block>
  <block id="326770a786c5933416b6a167c854e7b8" category="list-text">下列指令碼示範如何簡化此程序。</block>
  <block id="ffdcdc8ee9653232a906773fa11358fd" category="list-text">如果 ASM 磁碟群組已完全撤出、現在可以使用卸載<block ref="ae709dc3414219bf2c9c8abc9ff6c67a" prefix=" " category="inline-code"></block>。在許多情況下、屬於其他資料庫或 ASM spfile/passwd 檔案的檔案仍會存在。</block>
  <block id="3d8b8f4734039817e35d5fb6993c8d08" category="section-title">資料檔案清理程序</block>
  <block id="637607e2203ac522fc9dbc88deb6c36f" category="inline-link-macro">ASM 移轉清理</block>
  <block id="18325b8b206963bc1ae6cca25406f942" category="paragraph">根據 Oracle RMAN 的使用方式而定、移轉程序可能會導致資料檔案的語法較長或較隱密。在此所示範例中、備份是以的檔案格式執行<block ref="1da91ad80bcfeb818066022a42cde773" prefix=" " category="inline-code"></block>。<block ref="432459869b7d0085e120ec9454032267" prefix=" " category="inline-code"></block> 表示 RMAN 應為每個資料檔案建立預設的唯一名稱。結果與下列文字所示類似。資料檔案的傳統名稱會內嵌在名稱中。您可以使用中所示的指令碼方法來清除此問題 <block ref="bf0c2c579af181f7d1e4d0267c1385fe" category="inline-link-macro-rx"></block>。</block>
  <block id="5e8488a95f83d2789417a1f3298f2f31" category="section-title">Oracle ASM 重新平衡</block>
  <block id="2768938325db3a71a6713959a0f309d9" category="paragraph">如前所述、 Oracle ASM 磁碟群組可透過重新平衡程序、以透明方式移轉至新的儲存系統。總而言之、重新平衡程序需要在現有的 LUN 群組中新增大小相同的 LUN 、然後再中斷先前 LUN 的作業。Oracle ASM 會以最佳配置自動將基礎資料重新定位至新儲存設備、然後在完成時釋出舊的 LUN 。</block>
  <block id="24a638b29b3c55f26c731aa4b9943a52" category="paragraph">移轉程序使用高效率的循序 I/O 、通常不會造成任何效能中斷、但可視需要調整移轉率。</block>
  <block id="25d06b03dd002ad791b19500c58e9f72" category="section-title">識別要移轉的資料</block>
  <block id="3709d4034873467e8e6ae138da54a443" category="section-title">建立新的 LUN</block>
  <block id="32176bd565539329eafb96db9447e517" category="paragraph">建立大小相同的新 LUN 、並視需要設定使用者和群組成員資格。LUN 應顯示為<block ref="bea4821516973214973a70aea8337c38" prefix=" " category="inline-code"></block> 磁碟。</block>
  <block id="6e59535a7b8dd239c67b8d015618f5e1" category="section-title">新增 LUN</block>
  <block id="71f7e1ff1a6e075f8364d083f145b655" category="paragraph">雖然可以同時執行新增和刪除作業、但通常只需兩個步驟即可輕鬆新增 LUN 。首先、將新 LUN 新增至磁碟群組。此步驟會將一半的擴充從目前的 ASM LUN 移轉至新的 LUN 。</block>
  <block id="7989dfdf722e8bee00001dac817e4833" category="paragraph">重新平衡的力量代表資料傳輸的速度。資料傳輸的平行度越高、資料傳輸的數量就越多。執行移轉時、必須執行有效率的連續 I/O 作業、而這些作業不太可能造成效能問題。不過、若有需要、可利用調整進行中移轉的重新平衡能力<block ref="e20ea7dfbbe351f6a5275d7adc71efbd" prefix=" " category="inline-code"></block> 命令。典型移轉使用 5 個值。</block>
  <block id="2b69f08c262a142b3fb0868f4d31ab4f" category="section-title">監控作業</block>
  <block id="a5097a0967c777285f74d63bf0cc26a1" category="paragraph">可透過多種方式監控和管理重新平衡作業。在此範例中、我們使用下列命令。</block>
  <block id="5d68829c11bdb5ae7a50b847bb126d44" category="paragraph">移轉完成時、不會回報任何重新平衡作業。</block>
  <block id="957310262614cddc1992368d2d0b14b3" category="section-title">丟棄舊的 LUN</block>
  <block id="260c16583c8eb689202ed5b4a44708b1" category="paragraph">移轉作業現在已完成一半。您可能需要執行一些基本效能測試、以確保環境健全。確認之後、可藉由丟棄舊的 LUN 來重新放置其餘的資料。請注意、這不會導致 LUN 立即發行。此中斷作業會先發出 Oracle ASM 重新定位延伸、然後再釋放 LUN 。</block>
  <block id="90423249814011b02ba06afd9fb2d617" category="paragraph">可透過多種方式監控和管理重新平衡作業。在此範例中、我們使用下列命令：</block>
  <block id="1544b3a52519b3856f1f7d1e704cb56f" category="section-title">移除舊的 LUN</block>
  <block id="983d704730b30910fc03d3ed444278f0" category="paragraph">從磁碟群組移除舊 LUN 之前、您應該先對標頭狀態執行一次最後檢查。從 ASM 發佈 LUN 後、它不再列出名稱、而且標頭狀態會列為<block ref="e2ffc99cf675f5f0f1a3456438551a9a" prefix=" " category="inline-code"></block>。這表示這些 LUN 可以安全地從系統中移除。</block>
  <block id="22a67c375eff91d37f2363ea69b0c41f" category="section-title">LVM 移轉</block>
  <block id="d52f83c78118c243801797ba9b795b72" category="paragraph">此處介紹的程序顯示了以 LVM 為基礎的磁碟區群組移轉原則、稱為<block ref="ec2db4422261eae02091227fb9e53c88" prefix=" " category="inline-code"></block>。這些範例來自 Linux LVM 、但這些原則同樣適用於 AIX 、 HP-UX 和 VxVM 。精確命令可能會有所不同。</block>
  <block id="64a375907ede7a86c9e8a1b4b142f22e" category="list-text">識別目前在中的 LUN<block ref="ec2db4422261eae02091227fb9e53c88" prefix=" " category="inline-code"></block> Volume 群組。</block>
  <block id="0ae75856dd12545cdd98b8cad5c12ad8" category="list-text">建立相同或稍大實體大小的新 LUN 、並將其定義為實體磁碟區。</block>
  <block id="2426fa707e9d362c711977b79acd65bb" category="list-text">將新的磁碟區新增至磁碟區群組。</block>
  <block id="02443ebd7f86c3a688a1e3466d3f106a" category="list-text">發行<block ref="8167c9a6bd495f7ed235364201039099" prefix=" " category="inline-code"></block> 命令將每個目前 LUN 的範圍重新放置到新 LUN 。。<block ref="1b464374742cfda0167b82bc6f9462f1" prefix=" " category="inline-code"></block> 引數會監控作業的進度。</block>
  <block id="ce4a174d56245f6ba5b8808527919921" category="list-text">完成此程序後、請使用從磁碟區群組中刪除舊的 LUN<block ref="3a4d1e7b0af1cf3d80e419c09d238535" prefix=" " category="inline-code"></block> 命令。如果成功、現在即可安全地從系統移除 LUN 。</block>
  <block id="599a80136f745b38f35077e1c7eb020e" category="summary">Oracle 移轉程序</block>
  <block id="329ffa7a9038afa62748f87628b749d5" category="paragraph">Oracle 移轉資料庫有許多可用的程序。正確的選擇取決於您的業務需求。</block>
  <block id="48a2d08de8943e7ca4718c02e6b791b6" category="paragraph">在許多情況下、系統管理員和 DBA 都有自己偏好的方法來重新定位實體磁碟區資料、鏡像和磁碟鏡射、或是利用 Oracle RMAN 來複製資料。</block>
  <block id="79d01f6e7efcfef7db530c0b3c5ea516" category="paragraph">這些程序主要是為不熟悉某些可用選項的 IT 人員提供指引。此外、這些程序還說明每種移轉方法的工作、時間需求和專長類別需求。如此一來、 NetApp 和合作夥伴專業服務或 IT 管理等其他方就能更充分瞭解每個程序的要求。</block>
  <block id="5604c71a7d9ae37df511cc85052c1894" category="paragraph">建立移轉策略沒有單一最佳實務做法。建立計畫需要先瞭解可用度選項、然後選擇最符合業務需求的方法。下圖說明客戶所做的基本考量和典型結論、但並不適用於所有情況。</block>
  <block id="fa2e72668f7d48694bef3ba5474e3967" category="paragraph">例如、一個步驟會引發資料庫總大小的問題。下一步取決於資料庫是否大於或小於 1TB 。建議的步驟就是根據一般客戶實務做法提出建議。大多數客戶不會使用 DataGuard 複製小型資料庫、但有些客戶可能會使用。大多數客戶不會因為所需時間而嘗試複製 50TB 資料庫、但有些客戶可能會有足夠大的維護時間來允許這類作業。</block>
  <block id="e38af1623479eee6cfe1782df43819d3" category="paragraph">Oracle 12cR1 及更高版本可在資料庫保持連線時移動資料檔案。此外、它還能在不同的檔案系統類型之間運作。例如、資料檔案可從 xfs 檔案系統重新定位至 ASM 。由於需要個別資料檔案移動作業的數量、因此通常不會大規模使用此方法、但這是一個值得考慮的選項、因為較小的資料庫資料檔案數量較少。</block>
  <block id="5972a038819f045814401b2baea9ee09" category="paragraph">此外、單純移動資料檔案是移轉部分現有資料庫的好選項。例如、較不活躍的資料檔案可重新放置到更具成本效益的儲存設備、例如可在物件儲存區中儲存閒置區塊的 FabricPool Volume 。</block>
  <block id="fcdd0d9eae6df775f1bdc52f950a0160" category="section-title">資料庫層級移轉</block>
  <block id="2b619622b2b8505c335acc8be3a2c3fd" category="paragraph">資料庫層級的移轉意味著允許資料庫重新配置資料。具體而言、這表示記錄傳送。RMAN 和 ASM 等技術是 Oracle 產品、但為了進行移轉、它們會在主機層級運作、在主機層級複製檔案和管理磁碟區。</block>
  <block id="1048000638cc5357b8b2b36ab55cbc5a" category="section-title">記錄傳送</block>
  <block id="36f7294e33f88b462199b92362434684" category="paragraph">資料庫層級移轉的基礎是 Oracle 歸檔記錄檔、其中包含資料庫變更的記錄檔。歸檔記錄通常是備份與還原策略的一部分。恢復程序從還原資料庫開始、然後重新播放一或多個歸檔記錄檔、將資料庫恢復到所需的狀態。這項相同的基本技術可用於執行移轉、幾乎不會中斷營運。更重要的是、這項技術可在不影響原始資料庫的情況下進行移轉、並保留一條向外移轉的路徑。</block>
  <block id="d43de5ded302797939b76670bc488b51" category="paragraph">移轉程序從將資料庫備份還原至次要伺服器開始。您可以透過多種方式進行、但大多數客戶都會使用正常的備份應用程式來還原資料檔案。資料檔案還原後、使用者便可建立記錄傳送方法。目標是建立由主要資料庫所產生的持續歸檔記錄摘要、並在還原的資料庫上重新播放、使兩者都接近相同的狀態。轉換時間到達時、來源資料庫會完全關閉、最後的歸檔記錄會複製並重新播放、有時則會複製重做記錄。重做記錄也必須列入考量、因為它們可能包含已提交的部分最終交易。</block>
  <block id="f6fc42763ddbd981d5803ee6676dc7c3" category="paragraph">在傳輸和重播這些記錄之後、兩個資料庫彼此之間的一致性。此時、大多數客戶都會執行一些基本測試。如果在移轉過程中發生任何錯誤、則記錄重新執行應會報告錯誤並失敗。還是建議您根據已知的查詢或應用程式導向的活動來執行一些快速測試、以驗證組態是否最佳化。在關閉原始資料庫之前建立一個最終測試表格、以確認該表格是否存在於移轉的資料庫中、這也是常見的做法。此步驟可確保在最終記錄同步期間不會發生任何錯誤。</block>
  <block id="d8e9d23b4beb4db3da15d77542782747" category="paragraph">簡單的記錄傳送移轉作業可針對原始資料庫進行頻外設定、這對關鍵任務資料庫特別有用。來源資料庫不需要變更組態、移轉環境的還原和初始組態也不會影響正式作業。設定記錄傳送之後、它會對正式作業伺服器提出一些 I/O 需求。不過、記錄傳送是由簡單的歸檔記錄循序讀取所組成、這對正式作業資料庫效能不太可能有任何影響。</block>
  <block id="2c31403002a9f424c6ef56460c6b3715" category="paragraph">已證實、記錄傳送對於長期、高變更率的移轉專案特別有用。在某個案例中、單一 220TB 資料庫已移轉至距離約 500 英哩的新位置。變更率極高、安全性限制無法使用網路連線。記錄傳送是使用磁帶和快遞業者來執行。原始資料庫的複本最初是使用下列程序來還原。然後、快遞業者每週寄送記錄、直到最後一組磁帶送達時、記錄才會套用至複本資料庫。</block>
  <block id="b8efa655c4deb7af8a24fc241f8b53ff" category="section-title">Oracle DataGuard</block>
  <block id="d3165c4060fc6d19c0a6364e7c4580ee" category="paragraph">在某些情況下、保證提供完整的 DataGuard 環境。使用術語 DataGuard 來指稱任何記錄傳送或待命資料庫組態是不正確的。Oracle DataGuard 是管理資料庫複寫的全方位架構、但它不是複寫技術。在移轉工作中、完整的 DataGuard 環境的主要優點是能從一個資料庫透明切換到另一個資料庫。如果發現問題（例如新環境的效能或網路連線問題）、 Dataguard 也能將切換回原始資料庫。完整設定的 DataGuard 環境不僅需要設定資料庫層、也需要設定應用程式、以便應用程式能夠偵測主要資料庫位置的變更。一般而言、不需要使用 DataGuard 來完成移轉、但有些客戶內部擁有豐富的 DataGuard 專業知識、而且已經仰賴它來進行移轉工作。</block>
  <block id="f17c0a1ce359c1a6665412f89234bf41" category="section-title">重新架構</block>
  <block id="ece8d784e248d63091fc0d248cdeebc3" category="paragraph">如前所述、運用儲存陣列的進階功能有時需要變更資料庫配置。此外、從 ASM 移轉至 NFS 檔案系統等儲存傳輸協定變更、也必然會改變檔案系統配置。</block>
  <block id="71843fb61639ed5fe216bfebc85af16f" category="paragraph">記錄傳送方法（包括 DataGuard ）的主要優點之一是複寫目的地不需要與來源相符。使用記錄傳送方法從 ASM 移轉至一般檔案系統時沒有任何問題、反之亦然。您可以在目的地變更資料檔案的精確配置、以最佳化易插拔資料庫（ PDB ）技術的使用、或選擇性地設定特定檔案的 QoS 控制。換句話說、以記錄傳送為基礎的移轉程序可讓您輕鬆安全地最佳化資料庫儲存配置。</block>
  <block id="f00ec1b23f539163f4c748a85e49e2dd" category="section-title">伺服器資源</block>
  <block id="76c5d43a72d856a95b0eed94694ae696" category="paragraph">資料庫層級移轉的一項限制是需要第二部伺服器。使用第二部伺服器的方法有兩種：</block>
  <block id="6cb133f8b5045ef30c17e96ab281749e" category="list-text">您可以使用第二部伺服器作為資料庫的永久新主目錄。</block>
  <block id="f5133929790fe62dbc76a73db4c88544" category="list-text">您可以使用第二部伺服器做為暫存伺服器。在資料移轉至新儲存陣列完成並測試之後、 LUN 或 NFS 檔案系統會從暫存伺服器中斷連線、然後重新連線至原始伺服器。</block>
  <block id="48a00ba9881b62c610201cd833ee9c88" category="paragraph">第一個選項是最簡單的、但在需要非常強大伺服器的大型環境中、使用它可能不可行。第二個選項需要額外的工作、才能將檔案系統重新放置回原始位置。這可以是一項簡單的作業、使用 NFS 做為儲存傳輸協定、因為檔案系統可以從暫存伺服器卸載、然後重新掛載到原始伺服器上。</block>
  <block id="c223252c2d577984b75caddbd1dff9dc" category="paragraph">區塊型檔案系統需要額外的工作、才能更新 FC 分區或 iSCSI 啟動器。對於大多數邏輯磁碟區管理員（包括 ASM ）、 LUN 會在原始伺服器上可用後自動偵測並上線。不過、某些檔案系統和 LVM 實作可能需要更多工作才能匯出和匯入資料。確切的程序可能會有所不同、但通常很容易建立簡單且可重複的程序、以完成移轉並將資料重新存放在原始伺服器上。</block>
  <block id="2d22ab8be3661ce5dfd8c9910d1cc003" category="paragraph">雖然可以在單一伺服器環境中設定記錄傳送和複寫資料庫、但新執行個體必須具有不同的處理程序 SID 、才能重新播放記錄。您可以使用不同的 SID 、在不同的處理序識別碼集下暫時開啟資料庫、稍後再變更。然而、這樣做可能會導致許多複雜的管理活動、並使資料庫環境面臨使用者錯誤的風險。</block>
  <block id="2660e825d3a58f68aeec49e1c749f477" category="section-title">主機層級移轉</block>
  <block id="fae5bb68519bf78c1b3711566283f4ef" category="paragraph">在主機層級移轉資料是指使用主機作業系統和相關公用程式來完成移轉。此程序包括複製資料的任何公用程式、包括 Oracle RMAN 和 Oracle ASM 。</block>
  <block id="01070e0746a412afd171ccf162d3a170" category="section-title">資料複製</block>
  <block id="180e717e34d5e4bd2991c47960d00f51" category="paragraph">不應低估簡單複製作業的價值。現代化的網路基礎架構可以以每秒 GB 的速度來移動資料、而檔案複製作業則是以高效率的連續讀寫 I/O 為基礎相較於記錄傳送、主機複本作業無法避免造成更多中斷、但移轉不只是資料移動而已。通常包括網路變更、資料庫重新啟動時間和移轉後測試。</block>
  <block id="750e04d167938f35054d1c30fd06af58" category="paragraph">複製資料所需的實際時間可能並不重要。此外、複製作業會保留保證的回傳路徑、因為原始資料不會受到影響。如果在移轉過程中遇到任何問題、可以重新啟動原始資料的原始檔案系統。</block>
  <block id="5a3572c65171e06d99a4e055f9d35d32" category="section-title">重新建立平台</block>
  <block id="d123cc133e4de7ab3a4b1a5af3bf37a7" category="paragraph">重組是指 CPU 類型的變更。當資料庫從傳統的 Solaris 、 AIX 或 HP-UX 平台移轉至 x86 Linux 時、由於 CPU 架構的變更、資料必須重新格式化。SPARC 、 IA64 和 Power CPU 稱為 Big endian 處理器、而 x86 和 x86_64 架構則稱為小 endian 。因此、 Oracle 資料檔案中的某些資料會根據使用中的處理器而有不同的訂購方式。</block>
  <block id="6a03806f9c4b1f0048478bab7863fd2c" category="paragraph">傳統上、客戶都使用 DataPump 跨平台複寫資料。datapump 是一種公用程式、可建立特殊類型的邏輯資料匯出、以便更快地匯入目的地資料庫。因為它會建立資料的邏輯複本、所以 DataPump 會將處理器位準的相依性留在背後。有些客戶仍使用資料平台來重新建立平台、但 Oracle 11g 提供更快速的選項：跨平台可攜式表格空間。這項進階功能可將資料表空間轉換成不同的 endian 格式。這是一種實體轉型、效能優於 DataPump 匯出、它必須將實體位元組轉換為邏輯資料、然後再轉換回實體位元組。</block>
  <block id="713bf8ff4ea4c4ece861f3345e15e3ea" category="paragraph">關於 DataPump 和可攜式資料表空間的完整討論不在 NetApp 文件的範圍之內、但 NetApp 根據我們協助客戶移轉至具有新 CPU 架構的新儲存陣列記錄的經驗、提供一些建議：</block>
  <block id="86b0ebca28354c7f55b4cc2fe79bee0e" category="list-text">如果使用 DataPump 、則應在測試環境中測量完成移轉所需的時間。客戶有時會對完成移轉所需的時間感到驚訝。這種非預期的額外停機可能會造成中斷。</block>
  <block id="8a592f25a72fd6f3718b1b01869ade30" category="list-text">許多客戶誤以為跨平台可攜式資料表空間不需要資料轉換。當使用具有不同序位元組的 CPU 時、會使用 RMAN<block ref="31168275dcaac634489082b54c4c66d0" prefix=" " category="inline-code"></block> 必須事先對資料檔案執行作業。這不是即時操作。在某些情況下、轉換程序可以透過在不同資料檔案上執行多個執行緒來加速、但無法避免轉換程序。</block>
  <block id="db7b3f86f4c9a2a6a76adac81614c03b" category="section-title">邏輯 Volume Manager 導向的移轉</block>
  <block id="86586aa50b0df80a7c68bcd3e86c8606" category="paragraph">LVMS 的運作方式是將一組或多個 LUN 拆分為一般稱為擴充的小型單元。然後將擴充集區用作建立邏輯磁碟區的來源、這些邏輯磁碟區基本上是虛擬化的。此虛擬化層以各種方式提供價值：</block>
  <block id="68d083c44669b8b20f0421b0389c6ded" category="list-text">邏輯磁碟區可以使用從多個 LUN 擷取的範圍。在邏輯磁碟區上建立檔案系統時、它可以使用所有 LUN 的完整效能功能。此外、它也能提升磁碟區群組中所有 LUN 的平均載入速度、提供更可預測的效能。</block>
  <block id="10d1e748082641ce33e82f457cabcbe7" category="list-text">您可以新增邏輯磁碟區、並在某些情況下移除範圍、以調整其大小。在邏輯磁碟區上調整檔案系統大小通常不會中斷營運。</block>
  <block id="5efed6e7bf2fda8321882aff35768721" category="list-text">透過移動基礎範圍、邏輯磁碟區可以不中斷地移轉。</block>
  <block id="96371ba57b3d2f331cc9bd7b5e34708b" category="paragraph">使用 LVM 移轉的運作方式有兩種：移動範圍或鏡射 / 去除範圍。LVM 移轉使用高效率的大型區塊連續 I/O 、而且很少會造成任何效能問題。如果這確實是問題、通常有節流 I/O 速率的選項。如此可增加完成移轉所需的時間、同時減輕主機和儲存系統的 I/O 負擔。</block>
  <block id="28084a93e6570f55c3923991e269816e" category="section-title">鏡射與鏡射</block>
  <block id="f5b05967100f74bb14ae26d5021ef4e3" category="paragraph">某些 Volume 管理程式（例如 AIX LVM ）可讓使用者指定每個範圍的複本數量、並控制裝載每個複本的裝置。移轉作業是透過取得現有的邏輯磁碟區、將基礎範圍鏡射到新磁碟區、等待複本同步、然後丟棄舊複本來完成。如果需要返回路徑、可以在放置鏡射複本之前建立原始資料的快照。或者、您也可以在強制刪除內含的鏡像複本之前、暫時關閉伺服器以遮罩原始 LUN 。這樣做會在資料的原始位置保留可恢復的資料複本。</block>
  <block id="7151373ff69a9fafa4a579b40282beeb" category="section-title">擴展移轉</block>
  <block id="682ba6adb168511d03877bdbf940a0b7" category="paragraph">幾乎所有的 Volume 管理程式都允許移轉擴充、有時也有多個選項。例如、某些 Volume 管理程式可讓管理員將特定邏輯磁碟區的個別擴充區從舊儲存區重新定位到新儲存區。Volume 管理程式（例如 Linux LVM2 ）提供<block ref="8167c9a6bd495f7ed235364201039099" prefix=" " category="inline-code"></block> 命令、可將指定 LUN 裝置上的所有延伸重新定位至新 LUN 。移除舊 LUN 之後、即可將其移除。</block>
  <block id="8c232bd157fb78062260d11e1ec3fc2c" category="admonition">作業的主要風險是從組態中移除舊的、未使用的 LUN 。變更 FC 分區和移除過時的 LUN 裝置時、必須格外小心。</block>
  <block id="41175a8b2053bedbf868e340edf92f55" category="section-title">Oracle 自動儲存管理</block>
  <block id="dce3f0c1b1c85aaee6448197054602d1" category="paragraph">Oracle ASM 是結合邏輯 Volume Manager 與檔案系統的產品。在較高層級、 Oracle ASM 會將 LUN 集合起來、分成小的分配單元、並將其呈現為稱為 ASM 磁碟群組的單一磁碟區。ASM 也能透過設定備援層級來鏡射磁碟群組。磁碟區可以是無鏡射（外部備援）、鏡射（正常備援）或三向鏡射（高備援）。設定備援層級時、請務必謹慎、因為建立後無法變更。</block>
  <block id="d0ac5c14a6207835f733f4366345089d" category="paragraph">ASM 也提供檔案系統功能。雖然檔案系統無法直接從主機看到、但 Oracle 資料庫仍可在 ASM 磁碟群組上建立、移動及刪除檔案與目錄。此外、您也可以使用 asmcmd 公用程式來瀏覽結構。</block>
  <block id="e72c9da30cbec4daedddc9b6e6fdf03b" category="paragraph">與其他 LVM 實作一樣、 Oracle ASM 也會在所有可用 LUN 之間、對每個檔案的 I/O 進行分拆和負載平衡、以最佳化 I/O 效能。其次、基礎擴充可重新定位、以便同時調整 ASM 磁碟群組的大小和移轉。Oracle ASM 會透過重新平衡作業來自動化程序。新的 LUN 會新增至 ASM 磁碟群組、而舊的 LUN 會被丟棄、這會觸發磁碟群組中的磁碟區重新配置及後續刪除已清空的 LUN 。此程序是最獲證實的移轉方法之一、而 ASM 提供透明移轉的可靠性、可能是最重要的功能。</block>
  <block id="d4ad443888b51ec4e13912c45da68f76" category="admonition">由於 Oracle ASM 的鏡射層級是固定的、因此無法搭配鏡射和鏡射移轉方法使用。</block>
  <block id="048429277e643e20907317612c1f3318" category="section-title">儲存層級移轉</block>
  <block id="623bb7ffbb3730716ea39b5086d26f18" category="paragraph">儲存層級移轉是指在應用程式和作業系統層級以下執行移轉。過去、這有時是指使用專門的裝置來複製網路層級的 LUN 、但現在這些功能在 ONTAP 中是原生的。</block>
  <block id="794cb725c5631ad99b5b7c000307f0df" category="section-title">SnapMirror</block>
  <block id="963ce762febea70d619f1fd5c114d85c" category="paragraph">使用 NetApp SnapMirror 資料複寫軟體、幾乎可以通用地從 NetApp 系統之間移轉資料庫。此程序包括為要移轉的磁碟區設定鏡射關係、允許它們進行同步處理、然後等待轉換時間。當來源資料庫到達時、即會關閉、執行最後一個鏡像更新、而且鏡像也會中斷。然後、複本磁碟區就可以開始使用、方法是掛載包含的 NFS 檔案系統目錄、或是探索包含的 LUN 並啟動資料庫。</block>
  <block id="1871452e5ea7e53152b5c874a12a890b" category="paragraph">在單一 ONTAP 叢集中重新放置磁碟區並不視為移轉作業、而是例行作業<block ref="0fc2ecb8aa71bddc595fbc39f593496a" prefix=" " category="inline-code"></block> 營運。SnapMirror 用作叢集中的資料複寫引擎。此程序完全自動化。當磁碟區的屬性（例如 LUN 對應或 NFS 匯出權限）與磁碟區本身一起移動時、無需執行其他移轉步驟。重新配置不會中斷主機作業。在某些情況下、必須更新網路存取、以確保以最有效率的方式存取新重新部署的資料、但這些工作也不會中斷營運。</block>
  <block id="19fee3ea4b7f4472b5c1853122e8f47b" category="section-title">外部 LUN 匯入（ FLI ）</block>
  <block id="a73cf458eed5aeff5c15aa5d70298cce" category="paragraph">FLI 是一項功能、可讓執行 8.3 或更高版本的 Data ONTAP 系統從另一個儲存陣列移轉現有 LUN 。此程序很簡單： ONTAP 系統會分區到現有的儲存陣列、就像是任何其他 SAN 主機一樣。然後 Data ONTAP 控制所需的舊版 LUN 、並移轉基礎資料。此外、匯入程序會在資料移轉時使用新 Volume 的效率設定、也就是說、資料可以在移轉過程中內嵌進行壓縮及刪除重複資料。</block>
  <block id="0ee4b09881406835f151f103412a2f1e" category="paragraph">Data ONTAP 8.3 中首次實作的 FLI 僅允許離線移轉。這是非常快速的傳輸、但仍表示在移轉完成之前、 LUN 資料無法使用。線上移轉是在 Data ONTAP 8.3.1 中推出。這類移轉可讓 ONTAP 在傳輸過程中提供 LUN 資料、將中斷情形減至最低。當主機重新分區以透過 ONTAP 使用 LUN 時、會發生短暫的中斷。不過、一旦進行這些變更、資料就會再次存取、並在整個移轉程序中保持可存取的狀態。</block>
  <block id="19d95ee75467fc2f9a06d150cc99d944" category="paragraph">讀取 I/O 會透過 ONTAP 代理、直到複製作業完成為止、而寫入 I/O 會同步寫入外部和 ONTAP LUN 。這兩個 LUN 複本會以這種方式保持同步、直到系統管理員執行完整的轉換程式來釋放外部 LUN 、而不再複寫寫入內容。</block>
  <block id="5caad387757ca99ada41709ce30a31a5" category="paragraph">FLI 的設計可與 FC 搭配使用、但如果您想要變更為 iSCSI 、則可在移轉完成後、輕鬆將移轉的 LUN 重新對應為 iSCSI LUN 。</block>
  <block id="7fa6cfc683e0f5f9e3a79f6be14e23f4" category="paragraph">FLI 的功能包括自動對齊偵測與調整。在這種情況下、「對齊」一詞是指 LUN 裝置上的分割區。最佳效能需要將 I/O 與 4K 區塊對齊。如果分割區的偏移量不是 4K 的倍數、效能就會受到影響。</block>
  <block id="7b4ef266729f1ddfbc724cad17af4efc" category="paragraph">第二個對齊層面無法透過調整分割區偏移（檔案系統區塊大小）來修正。例如、 ZFS 檔案系統通常預設為 512 位元組的內部區塊大小。其他使用 AIX 的客戶偶爾會建立具有 512 或 1 、 024 位元組區塊大小的 JFS2 檔案系統。雖然檔案系統可能會與 4K 邊界對齊、但在該檔案系統中建立的檔案不會受到影響、效能也會受到影響。</block>
  <block id="1d6b28ed67b1d554df806b0b5a020711" category="paragraph">在此情況下不應使用 FLI 。雖然資料在移轉後仍可存取、但結果是檔案系統的效能嚴重限制。一般而言、任何支援 ONTAP 上隨機覆寫工作負載的檔案系統、都應該使用 4K 區塊大小。這主要適用於資料庫資料檔案和 VDI 部署等工作負載。區塊大小可使用相關的主機作業系統命令來識別。</block>
  <block id="4941562ef813562e0d6aaef673158b99" category="paragraph">例如、在 AIX 上、可以使用檢視區塊大小<block ref="10c9a985c983a826424b496a708263ec" prefix=" " category="inline-code"></block>。使用 Linux 、<block ref="ba5265473f00b27178098cc38d3aef24" prefix=" " category="inline-code"></block> 和<block ref="1f8a87190704df357c64a49aee936874" prefix=" " category="inline-code"></block> 可用於<block ref="310201b6353c5f38bc039e0e51b079d3" prefix=" " category="inline-code"></block> 和<block ref="5382133ffbecb9bce9d47f2e44327b16" prefix=" " category="inline-code"></block>。與<block ref="8cbc6ba7c8bba133ce2bc44780d88742" prefix=" " category="inline-code"></block>、命令是<block ref="1615297782a0dff59b20451e2ca97ea7" prefix=" " category="inline-code"></block>。</block>
  <block id="033a4cb04b5225e2b7cf966f2ce16598" category="paragraph">控制區塊大小的參數為<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 而且通常預設值為 9 ，即 2^9 或 512 位元組。為了獲得最佳效能<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 值必須為 12 （ 2^12=4K ）。此值是在創建 zpool 時設置的，不能更改，這意味着使用的數據 zpool<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 除 12 個以外、應將資料複製到新建立的 zPool 、以進行移轉。</block>
  <block id="8bd9661d8c8eb9924c62b8242191af4e" category="paragraph">Oracle ASM 沒有基本區塊大小。唯一的要求是必須正確對齊 ASM 磁碟所在的磁碟分割區。</block>
  <block id="ea7f7e1e8119ee64585b6173afe720e8" category="section-title">7-Mode Transition Tool</block>
  <block id="75df51cc2f43b8dde951695f97b838c0" category="paragraph">7-Mode Transition Tool （ 7MTT ）是一種自動化公用程式、用於將大型 7-Mode 組態移轉至 ONTAP 。大多數資料庫客戶發現其他方法都比較容易、部分原因是他們通常會依資料庫來移轉環境資料庫、而非重新配置整個儲存設備佔用空間。此外、資料庫通常只是較大型儲存環境的一部分。因此、資料庫通常會個別移轉、其餘的環境則可以使用 7MTT 進行移轉。</block>
  <block id="85fd7dcbc2206c27059ae7f88712154d" category="paragraph">有少數客戶擁有專為複雜資料庫環境設計的儲存系統。這些環境可能包含許多磁碟區、快照和許多組態詳細資料、例如匯出權限、 LUN 啟動器群組、使用者權限和輕量型目錄存取傳輸協定組態。在這種情況下、 7MTT 的自動化功能可簡化移轉作業。</block>
  <block id="2c87fbdecbf0dfe299f9f89958d61085" category="paragraph">7MTT 可在下列兩種模式中的其中一種運作：</block>
  <block id="dc818e71a5519d1b99c7e996cf21fd74" category="list-text">* 複製型轉換（ CBT ） * 7MTT 搭配 CBT 、可從新環境中現有的 7 模式系統設定 SnapMirror 磁碟區。資料同步後、 7MTT 會協調轉換程序。</block>
  <block id="453bbc96e365e25cc2d091dced3565a6" category="list-text">* 複製 - 自由轉換（ CFT ）。 * 採用 CFT 的 7MTT 是根據現有 7-Mode 磁碟櫃的原位轉換而定。不會複製任何資料、也可以重複使用現有的磁碟櫃。保留現有的資料保護與儲存效率組態。</block>
  <block id="16262236c3981cb3310b9320b5a67fd0" category="paragraph">這兩種選項的主要差異在於：無複製轉換是一種非常有效的方法、其中所有連接至原始 7-Mode HA 配對的磁碟櫃都必須重新放置到新環境中。沒有選項可以移動一部分機櫃。複製型方法可讓選取的磁碟區移動。此外、由於可重新儲存磁碟櫃和轉換中繼資料所需的連結、因此也可能會有較長的轉換時間、且無需複製。根據現場經驗、 NetApp 建議允許 1 小時重新配置及重新配置磁碟櫃、 15 分鐘至 2 小時的中繼資料轉換時間。</block>
  <block id="795bbfbd054829fad905065087ba2d5a" category="paragraph">從資料庫和主機的觀點來看、不需要採取任何特殊步驟。更新 FC 區域並在 ONTAP 上提供 LUN 之後、 LVM 應該能夠從 LUN 讀取 LVM 中繼資料。此外、這些磁碟區群組也可以開始使用、無需進一步的組態步驟。在極少數情況下、環境可能會包含硬編碼的組態檔案、其中包含先前儲存陣列的參考資料。例如、內含的 Linux 系統<block ref="dd5ff67ba72768d33f75e645aa2b8e56" prefix=" " category="inline-code"></block> 參考指定裝置 WWN 的規則必須更新、以反映 FLI 所做的變更。</block>
  <block id="9e7ddc2ddefcd6f202fb11a82a80bc7e" category="admonition">如需支援組態的相關資訊、請參閱 NetApp 相容性對照表。如果您的環境未包含在內、請聯絡 NetApp 代表以取得協助。</block>
  <block id="0f5b3758229b3e28c8605b6c42398115" category="paragraph">此範例顯示 Linux 伺服器上代管的 ASM 和 LVM LUN 移轉。其他作業系統支援 FLI 、雖然主機端命令可能不同、但原則相同、 ONTAP 程序相同。</block>
  <block id="f1036cd97e461d07351c9df32fc5948d" category="section-title">識別 LVM LUN</block>
  <block id="88f7413f9621a816ee3d370703168647" category="paragraph">準備的第一步是識別要移轉的 LUN 。在此所示範例中、會在裝載兩個 SAN 型檔案系統<block ref="572f241ef88fdb17d16eba97133d861f" prefix=" " category="inline-code"></block> 和<block ref="d14bc7787c7396144583e99a7df52f67" prefix=" " category="inline-code"></block>。</block>
  <block id="ecad615a52fda392a9b7c1075d2cb2c5" category="paragraph">Volume 群組的名稱可以從裝置名稱中擷取、該名稱使用格式（ Volume 群組名稱） - （邏輯磁碟區名稱）。在這種情況下、會呼叫 Volume 群組<block ref="bb97320b8c517da828eae4ec543113db" prefix=" " category="inline-code"></block>。</block>
  <block id="b08986bb1757d5ae8de06d523c71803d" category="paragraph">。<block ref="f1e2c495108b111c930735e3a0f9a04e" prefix=" " category="inline-code"></block> 命令可用於識別支援此 Volume 群組的 LUN 、如下所示。在這種情況下、共有 10 個 LUN 組成<block ref="bb97320b8c517da828eae4ec543113db" prefix=" " category="inline-code"></block> Volume 群組。</block>
  <block id="8b47fac6803dfff2e8d2cdad6f297cfa" category="section-title">識別 ASM LUN</block>
  <block id="a23d0124954ecdbfe9d0f3aceb9e17a2" category="paragraph">ASM LUN 也必須移轉。若要以 sysasm 使用者的身分從 sqlplus 取得 LUN 和 LUN 路徑的數目、請執行下列命令：</block>
  <block id="918841992da84786f00de7c4c7d83dbf" category="paragraph">目前環境包含 20 個要移轉的 LUN 。更新目前的 SAN 、讓 ONTAP 能夠存取目前的 LUN 。資料尚未移轉、但 ONTAP 必須從目前的 LUN 讀取組態資訊、才能為該資料建立新的主目錄。</block>
  <block id="5816768a5d83977f34ffa5025c14f430" category="paragraph">AFF/FAS 系統上至少必須將一個 HBA 連接埠設定為啟動器連接埠。此外、必須更新 FC 區域、讓 ONTAP 能夠存取外部儲存陣列上的 LUN 。某些儲存陣列已設定 LUN 遮罩、限制哪些 WWN 可以存取指定的 LUN 。在這種情況下、 LUN 遮罩也必須更新、才能授予 ONTAP WWN 存取權。</block>
  <block id="030a992b1340f67584d67ef6230e9adf" category="paragraph">完成此步驟後、 ONTAP 應能使用檢視外部儲存陣列<block ref="d90ba20b63acab53952d68665c50ec47" prefix=" " category="inline-code"></block> 命令。它傳回的關鍵欄位是用來識別系統上外部 LUN 的首碼。在以下範例中、為外部陣列上的 LUN<block ref="25103eba8d70e82b5bd837be0d2f63c4" prefix=" " category="inline-code"></block> 在 ONTAP 中使用前置碼顯示<block ref="6b35470d99880c4630ed3ca7b4c842e7" prefix=" " category="inline-code"></block>。</block>
  <block id="c1a0f5174323df40a8b659eb65ac5155" category="section-title">識別外部陣列</block>
  <block id="6c1b8919e2e706972b3ec48cb7f014ba" category="section-title">識別外部 LUN</block>
  <block id="63841e312d3a8531331e35bd826268d1" category="paragraph">可以通過傳送來列出 LUN<block ref="907702f5103a7823393b8dd296a75c26" prefix=" " category="inline-code"></block> 至<block ref="242f4ce1948273386f8bb487bdd3732f" prefix=" " category="inline-code"></block> 命令。移轉程序期間會多次參照傳回的資料。</block>
  <block id="e5e94f7e2098883f0d621e064b1104f4" category="section-title">將外部陣列 LUN 登錄為匯入候選項目</block>
  <block id="c968ec41c1c0c449b0263962966d8293" category="paragraph">外部 LUN 一開始會歸類為任何特定的 LUN 類型。在匯入資料之前、必須將 LUN 標記為外部、因此是匯入程序的候選項目。將序號傳送至即可完成此步驟<block ref="93c633f7fa188f1b27df574c0e5e929a" prefix=" " category="inline-code"></block> 命令、如下列範例所示。請注意、此程序只會將 LUN 標記為 ONTAP 中的外部。不會將任何資料寫入外部 LUN 本身。</block>
  <block id="33380a523841f23815f2f83c9de1a628" category="section-title">建立磁碟區以裝載移轉的 LUN</block>
  <block id="2c2ba8ca6bdd77da1da981b91a3fae4a" category="paragraph">需要一個磁碟區來裝載移轉的 LUN 。確切的 Volume 組態取決於運用 ONTAP 功能的整體計畫。在此範例中、 ASM LUN 會放置在一個磁碟區中、而 LVM LUN 則放置在第二個磁碟區中。這樣做可讓您將 LUN 當作個別群組來管理、例如分層、建立快照或設定 QoS 控制。</block>
  <block id="8bc7d64e68e4be8f4908effd57293a2a" category="paragraph">設定<block ref="fb983ebeedc63d8723c0d4aa558a4c02" prefix=" " category="inline-code"></block>。移轉程序可能包括大量資料流動。因此、如果快照是意外建立的、可能會大幅增加空間使用量、因為快照中會擷取不需要的資料。</block>
  <block id="8c0675d07e44f55f1f5aa6d45abe0cdb" category="section-title">建立 ONTAP LUN</block>
  <block id="0b799020dac78a5e12a3d1a6400fd0c8" category="paragraph">建立磁碟區之後、必須建立新的 LUN 。一般而言、建立 LUN 需要使用者指定 LUN 大小之類的資訊、但在此情況下、外部磁碟引數會傳遞給命令。因此、 ONTAP 會從指定的序號複寫目前的 LUN 組態資料。它也會使用 LUN 幾何資料和分割表格資料來調整 LUN 對齊、並建立最佳效能。</block>
  <block id="5272a1dc3854f1eddc353c8073234e03" category="paragraph">在此步驟中、序號必須與外部陣列交叉參照、以確保正確的外部 LUN 與正確的新 LUN 相符。</block>
  <block id="f6ee70ec9fce7bd34fa5a33d8969fb5e" category="section-title">建立匯入關係</block>
  <block id="94700a911b95416221efe4064acbc2ba" category="paragraph">LUN 現已建立、但尚未設定為複寫目的地。在執行此步驟之前、必須先將 LUN 離線。這項額外步驟旨在保護資料不受使用者錯誤影響。如果 ONTAP 允許在線上 LUN 上執行移轉、可能會造成打字錯誤、導致覆寫作用中資料。強制使用者先將 LUN 離線的額外步驟、有助於確認使用正確的目標 LUN 做為移轉目的地。</block>
  <block id="85255e52054af9c6ffd3c4e79c723a34" category="paragraph">LUN 離線後、您可以將外部 LUN 序號傳送至、以建立匯入關係<block ref="04c2f87857699971f5aedd525e65690a" prefix=" " category="inline-code"></block> 命令。</block>
  <block id="8e3c921431d2b7f66fa0cc85f3ae5c9d" category="paragraph">建立所有匯入關係之後、即可將 LUN 重新上線。</block>
  <block id="ea382cbfdb353cee0cf25eaae9bba150" category="section-title">建立啟動器群組</block>
  <block id="152c4728a5fb152525a639439b9d7cb9" category="inline-link-macro">傳輸協定轉換</block>
  <block id="298a1c3c736859f2cfa3cb8eb1f3fdcc" category="paragraph">在此範例中、會建立一個 igroup 、其中包含兩個 WWN 、對應於主機 HBA 上可用的兩個連接埠。</block>
  <block id="4f6f03762bfcdc7174cdd30240ce45b3" category="section-title">將新 LUN 對應至主機</block>
  <block id="c22fee2d07a149be91ae1ae2ada1cb57" category="paragraph">在建立 igroup 之後、 LUN 會對應至定義的 igroup 。這些 LUN 僅適用於此 igroup 中包含的 WWN 。NetApp 假設移轉程序目前階段主機尚未分區至 ONTAP 。這一點很重要、因為如果主機同時分區到外部陣列和新的 ONTAP 系統、則可能會在每個陣列上發現具有相同序號的 LUN 。這種情況可能導致多重路徑故障或資料受損。</block>
  <block id="ecca392290c36269e0489c0b1cf36f50" category="summary">用於自動化 Oracle 移轉作業的範例指令碼</block>
  <block id="fc53c036602508ed6c2afc18e2fbdf51" category="doc">範例指令碼</block>
  <block id="6f78af00b87bcad5d08c95c7b6066ad0" category="paragraph">提供的指令碼是如何為各種作業系統和資料庫工作撰寫指令碼的範例。這些都是依現狀供應。如果特定程序需要支援、請聯絡 NetApp 或 NetApp 經銷商。</block>
  <block id="3146889e40b3ca2b78c56a19178bff84" category="section-title">資料庫關機</block>
  <block id="5b98b9877c0c74dc3a3daf46cf943d3f" category="paragraph">下列 Perl 指令碼會採用 Oracle SID 的單一引數、並關閉資料庫。它可以以 Oracle 使用者或 root 身分執行。</block>
  <block id="7df41a3619af59182fb5df6d1920d11a" category="section-title">資料庫啟動</block>
  <block id="57249fb9cdac8ddc9ea8843636c4e088" category="section-title">將檔案系統轉換為唯讀</block>
  <block id="f2977a22ba44544ca8921e2d75bce435" category="paragraph">下列指令碼會採用檔案系統引數、並嘗試將其卸除並重新掛載為唯讀。在移轉過程中、這樣做非常有用、因為必須將檔案系統保留在可複寫資料的位置、但必須保護其免於意外損壞。</block>
  <block id="4eac395595a8d266839db0b88fae31e4" category="section-title">取代檔案系統</block>
  <block id="988d7030a130298e1641007b5b0aae20" category="paragraph">下列指令碼範例用於將一個檔案系統取代為另一個檔案系統。因爲它編輯了 /etc/fstab 文件，所以它必須以 root 身份運行。它接受新舊檔案系統的單一逗號分隔引數。</block>
  <block id="149c75d086adf78a50a16bcb5e349158" category="list-text">若要取代檔案系統、請執行下列指令碼：</block>
  <block id="67a4c588434c781febb12c165c3e860a" category="paragraph">以本指令碼的使用範例為例、假設中的資料<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> 移轉至<block ref="27df80f143a5812bda1553d09c712efc" prefix=" " category="inline-code"></block> 和<block ref="0e62afc91abe157ef67895cca0a7f912" prefix=" " category="inline-code"></block> 移轉至<block ref="1c988fc7a325635f00f9b55992128a08" prefix=" " category="inline-code"></block>。執行此工作最簡單的方法之一、就是使用簡單的檔案複製作業、將新裝置重新放置回原始安裝點。</block>
  <block id="4a3d90c30a5e921650fe8ad0decf4827" category="list-text">假設舊的和新的檔案系統存在於中<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 檔案如下：</block>
  <block id="4588a4e3d2f8d0f7c036f59c1be2163f" category="list-text">執行時、此指令碼會卸載目前的檔案系統、並以新的：</block>
  <block id="2d808cb44231d0a80164567e7220fc44" category="list-text">指令碼也會更新<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 請據此歸檔。在此處所示範例中、包含下列變更：</block>
  <block id="840967a448e36b9efeaacf7673f825aa" category="section-title">自動化資料庫移轉</block>
  <block id="1107dd36fe8ba0c18ea8abc8734986e2" category="paragraph">此範例示範如何使用關機、啟動及檔案系統置換指令碼來完全自動化移轉。</block>
  <block id="36881541e7d9c7bced65fcac337ac327" category="section-title">顯示檔案位置</block>
  <block id="1e9a1acc40d4943a73e6865cdebaf560" category="paragraph">此指令碼會收集許多重要的資料庫參數、並以易讀的格式列印。此指令碼在檢閱資料配置時非常實用。此外、指令碼也可以修改以供其他用途使用。</block>
  <block id="6172b49b7fdf806b59af0aeef8de71e3" category="section-title">ASM 移轉清理</block>
  <block id="dd8d75d6766af495b5442e67eb27d387" category="section-title">ASM 至檔案系統名稱轉換</block>
  <block id="abc3fc91423668bb4bd49e6e837fa3e4" category="section-title">在資料庫上重新播放記錄</block>
  <block id="cc7b9a518bb2532f61662a9893248133" category="paragraph">此指令碼接受 Oracle SID 的單一引數、用於處於掛載模式的資料庫、並嘗試重新播放所有目前可用的歸檔記錄。</block>
  <block id="2a5bd3a209a1ed33b81c5306780227ce" category="section-title">在待命資料庫上重新播放記錄</block>
  <block id="ea7bebed0b4151a9b28acbde55fc0eb3" category="paragraph">此指令碼與前述指令碼相同、但其設計用於待命資料庫。</block>
  <block id="2adcfd589637337984e39e94dd14ae33" category="paragraph">變更用於存取 LUN 的傳輸協定是常見的需求。</block>
  <block id="38fe6838f11a6023172d11d806adbfcf" category="paragraph">在某些情況下、它是將資料移轉至雲端的整體策略的一部分。TCP/IP 是雲端的傳輸協定、從 FC 變更為 iSCSI 可讓您更輕鬆地移轉至各種雲端環境。在其他情況下、 iSCSI 可能需要善用 IP SAN 降低的成本。有時候、移轉可能會使用不同的傳輸協定作為臨時措施。例如、如果外部陣列和 ONTAP 型 LUN 無法共存於同一個 HBA 上、您可以使用足夠長的 iSCSI LUN 、從舊陣列複製資料。然後、您可以在從系統移除舊 LUN 之後、將其轉換回 FC 。</block>
  <block id="832c81bd0db3ad98a3804ff5ce996a58" category="paragraph">下列程序示範從 FC 轉換至 iSCSI 的過程、但整體原則適用於從 iSCSI 轉換至 FC 的反轉過程。</block>
  <block id="e21180783b17ea695cf9275fce8a0bc7" category="section-title">安裝 iSCSI 啟動器</block>
  <block id="0e1ddcc32a3ef636c9ca084a3d7706f5" category="paragraph">大多數作業系統預設都包含軟體 iSCSI 啟動器、但如果不包含軟體 iSCSI 啟動器、則可輕鬆安裝。</block>
  <block id="289fe013df899f5f74fb362d4efcdd5d" category="section-title">識別 iSCSI 啟動器名稱</block>
  <block id="8242e97b190184a6c7b8ec96c5662886" category="paragraph">在安裝過程中會產生唯一的 iSCSI 啟動器名稱。在 Linux 上、它位於<block ref="22565a44e8f73044eb2029acbb069639" prefix=" " category="inline-code"></block> 檔案：此名稱用於識別 IP SAN 上的主機。</block>
  <block id="721a96eb0b922b337fa815839839b328" category="section-title">建立新的啟動器群組</block>
  <block id="cda1311d977b7b77ad3aebe4a813b3bd" category="paragraph">啟動器群組（ igroup ）是 ONTAP LUN 遮罩架構的一部分。除非先授予主機存取權、否則無法存取新建立的 LUN 。此步驟的完成方法是建立一個 igroup 、列出需要存取的 FC WWN 或 iSCSI 啟動器名稱。</block>
  <block id="6548788f050643897f7354b6df4488db" category="paragraph">在此範例中、會建立包含 Linux 主機 iSCSI 啟動器的 igroup 。</block>
  <block id="da8490d81c1ef6b559b09c2ab94631d2" category="section-title">關閉環境</block>
  <block id="0bf211160ad57fedca3499176f213b11" category="paragraph">變更 LUN 傳輸協定之前、必須完全禁用 LUN 。任何要轉換的 LUN 上的資料庫都必須關機、檔案系統必須卸載、而且必須停用磁碟區群組。使用 ASM 時、請確定已卸除 ASM 磁碟群組、並關閉所有網格服務。</block>
  <block id="2ba1c509ee5f5e31f05b24aed2d23054" category="section-title">從 FC 網路取消對應 LUN</block>
  <block id="2f9e42c479a76dd54d7946c181049dd4" category="paragraph">LUN 完全禁用後、請從原始 FC igroup 移除對應。</block>
  <block id="5f889f52ef85be290c3e5c0211bbb8fa" category="section-title">將 LUN 重新對應至 IP 網路</block>
  <block id="4ac84701530b31d8d33d9aa742715d25" category="paragraph">將每個 LUN 的存取權授予新的 iSCSI 型啟動器群組。</block>
  <block id="3d59eaa280c8b75d8e997eac2cf5b3e6" category="section-title">探索 iSCSI 目標</block>
  <block id="981b782c3eacf8b87d8231b887873f03" category="paragraph">iSCSI 探索分為兩個階段。第一是探索目標、這與探索 LUN 不同。。<block ref="f88921f58beaaae5bcb9dffac54bf5ad" prefix=" " category="inline-code"></block> 下列命令會探查指定的入口網站群組<block ref="24e12535882a30ad33a21d76d76bd0ff" prefix=" " category="inline-code"></block> 並儲存提供 iSCSI 服務的所有 IP 位址和連接埠清單。在這種情況下、預設連接埠 3260 上有四個 iSCSI 服務的 IP 位址。</block>
  <block id="0ab5dd035c7f92f4dce1026744c01604" category="admonition">如果無法到達任何目標 IP 位址、此命令可能需要幾分鐘的時間才能完成。</block>
  <block id="1dba8f39914c5f44e3cb635e7ac7563e" category="section-title">探索 iSCSI LUN</block>
  <block id="68307bef4b9dc4071d875a0c2aadd321" category="paragraph">發現 iSCSI 目標後、請重新啟動 iSCSI 服務以探索可用的 iSCSI LUN 、並建置相關裝置、例如多重路徑或 ASMLib 裝置。</block>
  <block id="25d811252f87ae85dda97f2ab9dd1f3a" category="section-title">重新啟動環境</block>
  <block id="8a9aae851d31dae8baf96171f114955e" category="paragraph">重新啟動 Volume 群組、重新掛載檔案系統、重新啟動 RAC 服務等、以重新啟動環境。為了預防這種情況、 NetApp 建議您在轉換程序完成後重新啟動伺服器、以確保所有組態檔案都正確無誤、並移除所有過時的裝置。</block>
  <block id="00f4c8378b0bf837cee4b0aed8886f31" category="paragraph">注意：在重新啟動主機之前、請確定中的所有項目都已存在<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 這項參照移轉的 SAN 資源會被註解出來。如果未執行此步驟、且 LUN 存取有問題、則可能是無法開機的作業系統。此問題不會損壞資料。不過、開機進入救援模式或類似模式進行修正可能會非常不方便<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 這樣就能啟動作業系統、開始進行疑難排解工作。</block>
  <block id="08e3cfb3c3dfa08d34bcbbfe07fe5f28" category="paragraph">安全有效地管理多個 Oracle 資料庫、需要有效的 QoS 策略。原因在於現代儲存系統的效能功能不斷提升。</block>
  <block id="3408fe4b6e4b2ed9366356f08e3b9ab0" category="summary">Oracle 資料庫與儲存效率</block>
  <block id="151654fbc652cca26707bd7a060073d3" category="doc">Oracle 資料庫與 ONTAP 效率功能</block>
  <block id="4564218d346b0ef8263512ebe659337d" category="paragraph">ONTAP 空間效率功能已針對 Oracle 資料庫進行最佳化。在幾乎所有情況下、最佳方法是在啟用所有效率功能的情況下、保留預設值。</block>
  <block id="794c6d3bb54da92d9a4a4022bc5c4e94" category="summary">RAID 和 Oracle 資料庫</block>
  <block id="e959fe6bb794f67f31a0d4e6bc5d5bf4" category="paragraph">RAID 是指使用備援功能來保護資料、避免磁碟機遺失。</block>
  <block id="b60b0e7c75501fe2f322675f2e6da6d7" category="paragraph">在設定用於 Oracle 資料庫和其他企業應用程式的 NetApp 儲存設備時、偶爾會出現 RAID 層級的問題。許多舊版 Oracle 儲存陣列組態的最佳實務做法都包含使用 RAID 鏡射和 / 或避免使用特定類型 RAID 的警告。雖然這些來源提出有效點、但這些來源不適用於 RAID 4 、以及 ONTAP 中使用的 NetApp RAID DP 和 RAID-TEC 技術。</block>
  <block id="6de6bcceac7c1a53ecb774d42b8d5c9a" category="summary">Oracle 與 ONTAP 精簡配置</block>
  <block id="26c71bfc140fc9f2d56f83f7aedffd53" category="paragraph">簡化 Oracle 資料庫的資源配置需要仔細規劃、因為結果是在儲存系統上設定的空間比實際可用的空間更多。這項工作非常值得、因為正確完成後、可大幅節省成本、並改善管理能力。</block>
  <block id="c9a6446e7a1a2aa2d3d06c76b3dd02ae" category="summary">Oracle 資料庫的 SVM 資源配置</block>
  <block id="eaa6380760494a867d1be23523aaba3e" category="doc">Oracle 資料庫與儲存虛擬機器</block>
  <block id="ffa2dec61afa63c15c9906328e62e2e8" category="paragraph">Oracle 資料庫儲存管理集中在儲存虛擬機器（ SVM ）上</block>
  <block id="ba0fd7b6bfa61ad7f7ad5326a0934d01" category="summary">需要瞭解儲存設備接管和切入功能、才能確保 Oracle 資料庫作業不會因這些作業而中斷。此外、如果不正確使用、接管和切入作業所使用的引數可能會影響資料完整性。</block>
  <block id="999548558d2844d78a3b5f9186c231a4" category="summary">資料庫與 ONTAP 儲存容量與可用空間</block>
  <block id="360612d74cdd78953036946ec943f795" category="paragraph">使用可預測、可管理的高效能企業儲存設備來管理資料庫或其他企業應用程式、需要磁碟機上的一些可用空間來進行資料和中繼資料管理。所需的可用空間量取決於使用的磁碟機類型和業務程序。</block>
  <block id="d3cc759510a3aba837fc8efeb2e24b91" category="doc">DB_FILE_multimblock_read_count</block>
  <block id="32faf0a922da10425f2be9f86a5f5e18" category="paragraph">。<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> 參數控制 Oracle 在連續 I/O 期間讀取為單一作業的 Oracle 資料庫區塊數量上限</block>
  <block id="36cb03af3dc688208e0e94fda31ca7a4" category="paragraph">不過、此參數不會影響 Oracle 在任何及所有讀取作業期間讀取的區塊數、也不會影響隨機 I/O只有連續 I/O 的區塊大小會受到影響。</block>
  <block id="2565c992b3732464484104f4c846d9b4" category="paragraph">Oracle 建議使用者不要設定此參數。如此可讓資料庫軟體自動設定最佳值。這通常表示此參數設為可產生 1MB I/O 大小的值。例如、 1MB 讀取 8KB 區塊需要 128 個區塊才能讀取、因此此參數的預設值為 128 。</block>
  <block id="0fd26e725a6c1a81508e013094776e2c" category="paragraph">NetApp 在客戶站台上觀察到的大多數資料庫效能問題、都涉及此參數的設定不正確。使用 Oracle 版本 8 和 9 變更此值的理由是正確的。因此、參數可能會在不知情的情況下出現在中<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 檔案、因為資料庫已就地升級至 Oracle 10 及更新版本。傳統設定為 8 或 16 、而預設值為 128 、會大幅損害連續 I/O 效能。</block>
  <block id="3f594bb922365c7a9f095f44822fa22e" category="admonition">* NetApp 建議 * 設定<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> 參數不應出現在中<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 檔案：NetApp 從未遇到過變更此參數可改善效能的情況、但在許多情況下、它會對連續 I/O 處理量造成明顯損害。</block>
  <block id="0eec903bb9d87349e379892ca99ef9ec" category="paragraph">Oracle RAC 是一款叢集軟體產品、內含多種類型的內部活動訊號處理程序、可監控叢集的健全狀況。</block>
  <block id="7c13d022c9fda6e792c4349a043a6c74" category="inline-link-macro">遺失計數</block>
  <block id="bab4ae46619fcbbb84e3375ef205e61c" category="admonition">中的資訊 <block ref="9cd17d807316d35ef47b12cbecab4ec8" category="inline-link-macro-rx"></block> 本節包含使用網路儲存設備的 Oracle RAC 環境的重要資訊、在許多情況下、需要變更預設 Oracle RAC 設定、以確保 RAC 叢集在網路路徑變更和儲存設備容錯移轉 / 切換作業之後仍能順利運作。</block>
  <block id="0494651671c3dc7f1ccdf99a4368a2cf" category="section-title">磁碟逾時</block>
  <block id="1973cfff3b7c6d828ede9d420b8481b5" category="paragraph">主要儲存相關 RAC 參數為<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block>。此參數控制投票檔案 I/O 必須完成的臨界值。如果是<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block> 超過參數、 RAC 節點就會從叢集中移出。此參數的預設值為 200 。此值應足以用於標準儲存設備接管和恢復程序。</block>
  <block id="4aa33fc988e36b9531d36da80d35ec2f" category="paragraph">NetApp 強烈建議您在將 RAC 組態投入生產之前、先徹底測試這些組態、因為許多因素會影響接管或恢復作業。除了完成儲存容錯移轉所需的時間之外、連結集合化控制傳輸協定（ LACP ）變更也需要額外的時間才能傳播。此外、 SAN 多重路徑軟體必須偵測 I/O 逾時、然後在替代路徑上重試。如果資料庫處於極活躍狀態、則必須在處理投票磁碟 I/O 之前、先佇列並重新嘗試大量 I/O 。</block>
  <block id="655a10764a0781d26dca3bfb939457b7" category="paragraph">如果無法執行實際的儲存接管或恢復、則可以在資料庫伺服器上進行纜線拉出測試來模擬影響。</block>
  <block id="b2a9e8dd67b2d9a7333cb2c2495c2aa5" category="list-text">離開<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block> 預設值為 200 的參數。</block>
  <block id="971a52f4b805c654dd133cf142457c53" category="list-text">務必徹底測試 RAC 組態。</block>
  <block id="cd7a91511dbfbe5c79de12fa7d394dc0" category="paragraph">。<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 參數通常只會影響 RAC 節點之間的網路心跳。預設值為 30 秒。如果網格二進位檔位於儲存陣列上、或作業系統開機磁碟機不是本機磁碟機、此參數可能會變得很重要。這包括 FC SAN 上具有開機磁碟機的主機、 NFS 開機作業系統、以及位於虛擬化資料存放區（例如 VMDK 檔案）上的開機磁碟機。</block>
  <block id="9c1fd24d7d8e04847dadb944a6643121" category="paragraph">如果因儲存接管或恢復而中斷開機磁碟機的存取、網格二進位位置或整個作業系統可能會暫時停止運作。ONTAP 完成儲存作業所需的時間、以及作業系統變更路徑和恢復 I/O 所需的時間、可能會超過<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 臨界值。因此、節點會在連線到開機 LUN 或網格二進位檔恢復後立即停止。在大多數情況下、會發生遷離和後續重新開機、而不會出現記錄訊息來指出重新開機的原因。並非所有組態都會受到影響、因此請在 RAC 環境中測試任何 SAN 開機、 NFS 開機或資料存放區型主機、以便在與開機磁碟機的通訊中斷時、 RAC 保持穩定。</block>
  <block id="2b875dbca82565f3d7e2fa51633bc2c9" category="paragraph">非本機開機磁碟機或非本機檔案系統代管的情況<block ref="ff4a008470319a22d9cf3d14af485977" prefix=" " category="inline-code"></block> 二進位檔案<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 需要變更以符合<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block>。如果變更此參數、請進行進一步測試、以識別對 RAC 行為的任何影響、例如節點容錯移轉時間。</block>
  <block id="08d7a86ed9292993deaa28bee18d5ce5" category="list-text">離開<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 參數的預設值為 30 、除非符合下列其中一項條件：</block>
  <block id="5b46e861366ffd98cd94c26abf2bf550" category="list-text"><block ref="ff4a008470319a22d9cf3d14af485977" prefix="" category="inline-code"></block> 二進位檔位於網路附加磁碟機上、包括 NFS 、 iSCSI 、 FC 和資料存放區型磁碟機。</block>
  <block id="7ace6d79e63cb29c86093526fbddf845" category="list-text">作業系統是 SAN 開機。</block>
  <block id="985511d6258bbf659d35bd76e0b0cea1" category="list-text">在這種情況下、請評估網路中斷對 OS 或的存取造成的影響<block ref="9599929f8663b5e2093f7bc5cb20b0c2" prefix=" " category="inline-code"></block> 檔案系統。在某些情況下、這類中斷會導致 Oracle RAC 精靈停止運作、進而導致<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block>根據的逾時和遷離。逾時預設為 27 秒、即的值<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 減號<block ref="c9333b0a26b9f9e9fd808e6238d613b0" prefix=" " category="inline-code"></block>。在這種情況下、請增加<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 200 比對<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block>。</block>
  <block id="a3f7c31b8d967e0ac9f9dd30fc81c061" category="paragraph">Oracle 初始化參數<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 控制非同步和直接 I/O 的使用</block>
  <block id="d1fa3441fd96418a75a509ac2907d644" category="paragraph">與一般的看法相反、非同步和直接 I/O 並不相互排斥。NetApp 發現、在客戶環境中、此參數經常設定錯誤、而這種錯誤設定直接導致許多效能問題。</block>
  <block id="0775b72ddf51e2a16e466ee2df8f75ab" category="paragraph">非同步 I/O 表示 Oracle I/O 作業可以平行化。在各種作業系統上均可使用非同步 I/O 之前、使用者已設定數個 dbwriter 程序、並變更伺服器程序組態。透過非同步 I/O 、作業系統本身就能以高效率且平行的方式代表資料庫軟體執行 I/O 。此程序不會讓資料面臨風險、而且關鍵作業（例如 Oracle 重做記錄）仍會同步執行。</block>
  <block id="6b72950206966c1983e559eb6886ec69" category="paragraph">直接 I/O 會略過作業系統緩衝區快取。UNIX 系統上的 I/O 通常會流經作業系統緩衝區快取。這對不維護內部快取的應用程式很有用、但 Oracle 在 SGA 中擁有自己的緩衝區快取。在幾乎所有情況下、最好是啟用直接 I/O 並將伺服器 RAM 分配給 SGA 、而非仰賴作業系統緩衝區快取。Oracle SGA 更有效率地使用記憶體。此外、當 I/O 流經作業系統緩衝區時、它會受到額外處理、因此會增加延遲。當低延遲是關鍵需求時、在大量寫入 I/O 時、延遲特別明顯。</block>
  <block id="d8590a940a5bb30d8a845f4359f3c779" category="paragraph">的選項<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 是：</block>
  <block id="0aea10c6719256027228a859db38f291" category="list-text">* 非同步 * 。 * Oracle 將 I/O 要求提交給作業系統以進行處理。此程序可讓 Oracle 執行其他工作、而非等待 I/O 完成、進而增加 I/O 平行化。</block>
  <block id="00cb0cc309682c42b3b936a19a042434" category="list-text">*directio.* Oracle 直接針對實體檔案執行 I/O 、而非透過主機作業系統快取來路由 I/O 。</block>
  <block id="f9941e1b6cc84711e95db0e757efc36a" category="list-text">* 無。 * Oracle 使用同步和緩衝 I/O在此組態中、選擇共享與專用伺服器程序與 dbWriters 數量更為重要。</block>
  <block id="f0939ff6231565c83c5c8c9ce1eddc9d" category="list-text">*setall.* Oracle 同時使用非同步和直接 I/O在幾乎所有情況下、都是使用<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block> 是最佳的。</block>
  <block id="8647b2eaf101a9425f69e6f2e67aeb9d" category="admonition">。<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 參數在 DNFS 和 ASM 環境中無效。使用 DNFS 或 ASM 時、會自動同時使用非同步和直接 I/O</block>
  <block id="6dd5604aa0be2956f8b1b41c74fa648e" category="paragraph">有些客戶過去曾遇到非同步 I/O 問題、尤其是先前的 Red Hat Enterprise Linux 4 （ RHEL4 ）版本。網際網路上有些過時的建議仍建議避免非同步 IO 、因為資訊過時。在所有目前的作業系統上、非同步 I/O 都是穩定的。沒有理由停用它、作業系統沒有已知的錯誤。</block>
  <block id="1ea377466376b194b2d1bfc3ab2fa4c4" category="paragraph">如果資料庫已使用緩衝 I/O 、則直接 I/O 的交換器也可能需要變更 SGA 大小。停用緩衝 I/O 可消除主機作業系統快取為資料庫提供的效能優勢。將 RAM 新增回 SGA 可修復此問題。最終結果應該是 I/O 效能的改善。</block>
  <block id="787b3d8b62af05ac3efd1c9ca7a8fc7e" category="paragraph">雖然 Oracle SGA 使用 RAM 幾乎比使用 OS 緩衝區快取更好、但可能無法判斷最佳值。例如、最好在資料庫伺服器上使用具有極小型 SGA 大小的緩衝 I/O 、其中有許多間歇性作用中的 Oracle 執行個體。這種配置可讓所有執行中的資料庫執行個體靈活使用作業系統上的剩餘可用 RAM 。這是非常不尋常的情況、但在某些客戶據點已發現這種情況。</block>
  <block id="d4157ab77eb31459bd406aa0f873e20c" category="admonition">* NetApp 建議 * 設定<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 至<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block>但請注意、在某些情況下、遺失主機緩衝區快取可能需要增加 Oracle SGA 。</block>
  <block id="f8b42f9efd1a05ede10b0e0c11dfa8b0" category="paragraph">ONTAP 內部使用可變的區塊大小、這表示 Oracle 資料庫可以設定任何所需的區塊大小。不過、檔案系統區塊大小可能會影響效能、在某些情況下、較大的重做區塊大小可能會改善效能。</block>
  <block id="0944aedb4703c4a5e94fb90de9d7a22f" category="section-title">資料檔案區塊大小</block>
  <block id="cc4662c047050e0082701ce6f052dcb7" category="paragraph">部分作業系統提供多種檔案系統區塊大小選擇。對於支援 Oracle 資料檔案檔案的檔案系統、使用壓縮時區塊大小應為 8KB 。不需要壓縮時、可以使用 8KB 或 4KB 的區塊大小。</block>
  <block id="e1a001cf8c7e2072c7a44ee65e8fee11" category="paragraph">如果資料檔案放在具有 512 位元組區塊的檔案系統上、則可能會有未對齊的檔案。根據 NetApp 建議、 LUN 和檔案系統可能已正確對齊、但檔案 I/O 可能未對齊。這種錯誤的調整會導致嚴重的效能問題。</block>
  <block id="9514c8638f798f68108498dd218ec793" category="paragraph">支援重做記錄的檔案系統必須使用重做區塊大小的倍數。這通常需要重做記錄檔系統和重做記錄本身都使用 512 位元組的區塊大小。</block>
  <block id="cac7d87a1164763b666ca7d02109d153" category="section-title">重做區塊大小</block>
  <block id="fa06b9584ea36af182742c07894220f0" category="paragraph">重做率極高時、 4KB 區塊大小可能會執行得更好、因為重做率較高、可在較少且更有效率的作業中執行 I/O 。如果重做速率大於 50Mbps 、請考慮測試 4KB 區塊大小。</block>
  <block id="781000593b4913b5625dd5ed9eebe87e" category="paragraph">在具有 4KB 區塊大小和許多極小型交易的檔案系統上、使用 512 位元組區塊大小的重做記錄檔來識別資料庫中的一些客戶問題。將多個 512 位元組的變更套用到單一 4KB 檔案系統區塊所涉及的額外負荷、導致效能問題、而這些問題已透過將檔案系統變更為使用 512 位元組的區塊大小來解決。</block>
  <block id="a02416fde36b174cf1196213fcf1bef6" category="admonition">* NetApp 建議 * 除非相關客戶支援或專業服務組織建議您變更重做區塊大小、否則請勿變更重做區塊大小、否則變更將以正式產品文件為基礎。</block>
  <block id="65a6ece62f52a5e2ff74baaae821ae86" category="paragraph">災難恢復是指在發生災難性事件（例如破壞儲存系統甚至整個站台的火災）之後還原資料服務。</block>
  <block id="e168b3b0b2f075f39012df52c5ea3c0a" category="admonition">本文件取代先前發佈的技術報告 _TR-4591 ： Oracle Data Protection _ 和 _TR-4592 ： Oracle on MetroCluster 。 _</block>
  <block id="a91982f09e6a0341a90dae002865ea11" category="paragraph">當然、災難恢復可以透過使用 SnapMirror 簡單複寫資料來完成、許多客戶會在每小時更新鏡射複本。</block>
  <block id="ad2c5e9521f13e89cd84fdd65ec96c7d" category="paragraph">MetroCluster 指的是硬體組態中的 ONTAP 、其中包括低階同步鏡射儲存設備和許多其他功能。MetroCluster 等整合式解決方案可簡化現今複雜的橫向擴充資料庫、應用程式及虛擬化基礎架構。它以一個簡單的中央儲存陣列取代多種外部資料保護產品和策略。它也能在單一叢集式儲存系統中提供整合式備份、還原、災難恢復和高可用度（ HA ）。</block>
  <block id="4278792a47efb1e599476fe07109dca4" category="inline-link-macro">MetroCluster 上的 Oracle RAC</block>
  <block id="d12be40db836559c628e8024f5d6ff56" category="paragraph">瞭解 Oracle 資料庫在 MetroCluster 環境中的運作方式、需要對 MetroCluster 系統的實體設計進行一些說明。</block>
  <block id="5e33c0d8a2417ce5fb6e7a211ad063bb" category="admonition">本文件取代先前發佈的技術報告 _TR-4592 ： Oracle on MetroCluster 。 _</block>
  <block id="37fa92fc2662529308c62c84eb1b38ea" category="paragraph">瞭解 Oracle 資料庫在 MetroCluster 環境中的運作方式需要對 MetroCluster 系統的邏輯功能進行一些說明。</block>
  <block id="2623b589ddbc1cdb6184ba32aa06e83f" category="inline-link-macro">NVFAIL</block>
  <block id="a4feacea8b05d0f24e5a4612a164a055" category="paragraph">通常的最佳實務做法仍適用、如果您的需求只需要 RPO = 0 資料保護、則 MetroCluster 會滿足您的需求。然而、大多數客戶不僅使用 MetroCluster 來保護 RPO =0 資料、還能在災難期間改善 RTO 、並在站台維護活動中提供透明的容錯移轉。</block>
  <block id="3ff8bcf18c694581aa25b0a347508e0f" category="section-title">使用預先設定的作業系統進行容錯移轉</block>
  <block id="442f34633164f1be348a442b2c62d29d" category="list-text">強制 MetroCluster 進行重新操作</block>
  <block id="e081e79ea1b1040c51d4a452e46de76d" category="list-text">執行 FC LUN 探索（僅限 SAN ）</block>
  <block id="e60946bf73021e18706a6ac33386b376" category="paragraph">實際的啟動程序很簡單。LUN 探索等命令每個 FC 連接埠只需要幾個命令。檔案系統掛載只不過是<block ref="19822b1b15d9eefc54c07ab49f87b100" prefix=" " category="inline-code"></block> 只需一個命令、即可在 CLI 上啟動和停止資料庫和 ASM 。如果在切換之前、磁碟區和檔案系統並未在災難恢復站台上使用、則無需設定<block ref="3b93661df04b698b1340ff2da3238d16" prefix=" " category="inline-code"></block> 在磁碟區上。</block>
  <block id="486eed21f55b6fb544db5504294592e6" category="section-title">使用虛擬化作業系統進行容錯移轉</block>
  <block id="bf65e943f86f26b49698bfdac9b95f81" category="paragraph">資料庫環境的容錯移轉可延伸至包含作業系統本身。理論上、此容錯移轉可以使用開機 LUN 來完成、但通常是使用虛擬化的作業系統來完成。此程序類似於下列步驟：</block>
  <block id="7c37589384e83d2b43bba430c18a45aa" category="list-text">裝載託管資料庫伺服器虛擬機器的資料存放區</block>
  <block id="3d4d04d6cdab90b7ca0deb0344f04eec" category="list-text">啟動虛擬機器</block>
  <block id="c702c387f07bcb4f18482e68d69a155a" category="paragraph">SyncMirror 是 MetroCluster 系統的 Oracle 資料保護基礎、是最大效能的橫向擴充同步鏡射技術。</block>
  <block id="9028b52caaa7bdbfb9be779eeb1fe00e" category="summary">Oracle Extended RAC with MetroCluster</block>
  <block id="4d4d8a609e5b2ac58e622eb1e90f9e39" category="paragraph">許多客戶透過在各個站台之間延伸 Oracle RAC 叢集來最佳化 RTO 、進而實現完全主動式的組態。整體設計變得更複雜、因為它必須包含 Oracle RAC 的仲裁管理。此外、從兩個站台存取資料、這表示強制轉換可能會導致使用過時的資料複本。</block>
  <block id="89ffaa1a7d089080e9a1ce912bb8c2d3" category="paragraph">雖然兩個站台上都有資料複本、但只有目前擁有 Aggregate 的控制器才能提供資料。因此、使用擴充的 RAC 叢集時、遠端節點必須透過站台對站台連線來執行 I/O 。結果會增加 I/O 延遲、但這種延遲通常不是問題。RAC 互連網路也必須延伸至站台、這表示無論如何都需要高速、低延遲的網路。如果增加的延遲確實造成問題、則叢集可以主動被動方式運作。接著、需要將 I/O 密集作業導向至擁有該集合體的控制器本機的 RAC 節點。然後、遠端節點會執行較輕的 I/O 作業、或純粹作為暖待機伺服器使用。</block>
  <block id="f441d5fdc388f3419fb87e071534f3ce" category="inline-link-macro">Oracle RAC 搭配 ONTAP</block>
  <block id="58285fb769eb7fb05ab12d9e0efb3e50" category="section-title">雙站台組態</block>
  <block id="af1184f29d838fbfec8d5b5bf5225f66" category="paragraph">雙站台擴充 RAC 組態可提供雙主動式資料庫服務、可在不中斷營運的情況下、在許多（但並非全部）災難案例中順利運作。</block>
  <block id="7544489c7854fcae445508015240a865" category="section-title">RAC 投票檔案</block>
  <block id="8b6e46422f88dab6ea82f2dbcadfc76b" category="paragraph">在 MetroCluster 上部署擴充 RAC 時、首先應考慮仲裁管理。Oracle RAC 有兩種機制可管理仲裁：磁碟心跳和網路心跳。磁碟心跳會使用投票檔案來監控儲存設備存取。只要基礎儲存系統提供 HA 功能、單一投票資源就足以搭配單一站台 RAC 組態。</block>
  <block id="fafd618b82d1827eeb8197e1c38722bc" category="paragraph">在早期版本的 Oracle 中、投票檔案會放置在實體儲存裝置上、但在目前版本的 Oracle 中、投票檔案會儲存在 ASM 磁碟群組中。</block>
  <block id="aeab2391a07321ac474989b9c9047226" category="admonition">NFS 支援 Oracle RAC 。在網格安裝程序期間、會建立一組 ASM 程序、將用於網格檔案的 NFS 位置顯示為 ASM 磁碟群組。此程序對終端使用者來說幾乎透明、安裝完成後不需要持續進行 ASM 管理。</block>
  <block id="42aca4aae768d5ec1cb0c50d41b7b8b7" category="paragraph">雙站台組態的第一項需求是確保每個站台都能以保證不中斷災難恢復程序的方式存取超過半數的投票檔案。這項工作在投票檔案儲存在 ASM 磁碟群組之前很簡單、但現在管理員必須瞭解 ASM 備援的基本原則。</block>
  <block id="60a723853bb2c173648452baf2199e73" category="paragraph">ASM 磁碟群組有三種備援選項<block ref="6a21b6995a068148bbb65c8f949b3fb2" prefix=" " category="inline-code"></block>、<block ref="fea087517c26fadd409bd4b9dc642555" prefix=" " category="inline-code"></block>和<block ref="8d966b2253a917086c8604959e152243" prefix=" " category="inline-code"></block>。換句話說、非鏡射、鏡射和 3 向鏡射。名為的較新選項<block ref="09d2bd168181f1e64c2b1651a80a8aa8" prefix=" " category="inline-code"></block> 也可以使用、但很少使用。備援裝置的備援層級和放置位置可控制故障情況發生的情況。例如：</block>
  <block id="32cdeb2c0245b51a0b590e6054f03c21" category="list-text">將投票檔案放在上<block ref="d4f266c5956ee60df748738c483f3dc0" prefix=" " category="inline-code"></block> 與<block ref="6a21b6995a068148bbb65c8f949b3fb2" prefix=" " category="inline-code"></block> 如果站台間連線中斷、備援資源保證可收回一個站台。</block>
  <block id="a549b4f1fc0c2d14bc333c70bbde73dc" category="list-text">將投票檔案放在上<block ref="d4f266c5956ee60df748738c483f3dc0" prefix=" " category="inline-code"></block> 與<block ref="fea087517c26fadd409bd4b9dc642555" prefix=" " category="inline-code"></block> 如果站台間連線中斷、每個站台只有一個 ASM 磁碟的備援功能可確保兩個站台的節點遷離、因為兩個站台都不會有大部分的仲裁。</block>
  <block id="c15f1c43a368db0ab3dde90eca52582d" category="list-text">將投票檔案放在上<block ref="d4f266c5956ee60df748738c483f3dc0" prefix=" " category="inline-code"></block> 與<block ref="8d966b2253a917086c8604959e152243" prefix=" " category="inline-code"></block> 當兩個站台都可以運作且彼此可連線時、一個站台上有兩個磁碟和另一個站台上的單一磁碟的備援功能可讓雙主動式作業運作。但是、如果單一磁碟站台與網路隔離、則該站台會被逐出。</block>
  <block id="478ced47a1ea1d6f0db02af749bfdaec" category="section-title">RAC 網路心跳</block>
  <block id="2432333dc52d6150fb3d58051bc8b0c2" category="paragraph">Oracle RAC 網路活動訊號可監控叢集互連中的節點可連性。若要保留在叢集中、節點必須能夠連絡其他節點的一半以上。在雙站台架構中、此需求會為 RAC 節點數建立下列選項：</block>
  <block id="3e36a59c8a51ee9cc2cba0e7051ed35f" category="list-text">如果每個站台放置相同數量的節點、則會在網路連線中斷時、在某個站台上造成遷離。</block>
  <block id="4955aede919912b3c62fadbc1039671b" category="list-text">在另一個站台上放置 N 個節點、在另一個站台上放置 N+1 個節點、可確保站台之間的連線中斷、導致站台的網路仲裁中剩餘節點數量較多、而節點移出數量較少的站台。</block>
  <block id="80bd651a66488201c928634689e2e5cc" category="paragraph">在 Oracle 12cR2 之前、無法控制哪一方在站台遺失時會發生遷離。當每個站台的節點數量相等時、會由主要節點控制遷離、這通常是第一個要開機的 RAC 節點。</block>
  <block id="d128c05245b2e633856a5061db176b7e" category="paragraph">Oracle 12cR2 引進節點加權功能。這項功能可讓管理員更有效地控制 Oracle 如何解決大腦分裂狀況。例如、下列命令可設定 RAC 中特定節點的偏好設定：</block>
  <block id="104c5747f0d9dbb47b0d09953c709a8d" category="paragraph">重新啟動 Oracle 高可用度服務後、組態如下所示：</block>
  <block id="693cce334ab6658c73ea67674775156b" category="paragraph">節點<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> 現已指定為關鍵伺服器。如果兩個 RAC 節點是隔離的、<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> 生存、和<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block> 被逐出。</block>
  <block id="386839b09451962d03e26b7bbfabce74" category="admonition">如需完整詳細資料、請參閱 Oracle 白皮書《 Oracle Clusterware 12c Release 2 Technical Overview 》。」</block>
  <block id="11f65689342acc8f71c8014eeb7945ee" category="paragraph">對於 12cR2 之前的 Oracle RAC 版本、可透過檢查 CRS 記錄來識別主節點、如下所示：</block>
  <block id="c8b8cd80b31dac17fb85459c341042bd" category="paragraph">此記錄表示主節點為<block ref="c81e728d9d4c2f636f067f89cc14862c" prefix=" " category="inline-code"></block> 和節點<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> ID 為<block ref="c4ca4238a0b923820dcc509a6f75849b" prefix=" " category="inline-code"></block>。這意味著<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> 不是主節點。您可以使用命令確認主節點的身分識別<block ref="08e7c60bbf8289a563b25cc033d431f7" prefix=" " category="inline-code"></block>。</block>
  <block id="fdf6179b59d3f4873b042609a5f09bc4" category="paragraph">識別碼為的節點<block ref="c81e728d9d4c2f636f067f89cc14862c" prefix=" " category="inline-code"></block> 是<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block>，這是主節點。在每個站台上節點數量相等的組態中、站台為<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block> 如果這兩組因為任何原因而失去網路連線、則該站台仍可生存。</block>
  <block id="f2932b43ad604fa01d57212558608ed6" category="paragraph">識別主節點的記錄項目可能會超出系統的使用期限。在這種情況下、可以使用 Oracle 叢集登錄（ OCR ）備份的時間戳記。</block>
  <block id="50cd29958db0c1dcb6505d470f553e54" category="paragraph">此範例顯示主節點是<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block>。它也表示主節點的變更來源<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> 至<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block> 5 月 4 日下午 2 ： 05 至 21 ： 39 之間。這種識別主節點的方法只有在也檢查了 CRS 記錄檔時才安全使用、因為主節點可能自上一次的 OCR 備份後變更。如果發生此變更、則應可在 OCR 記錄中看到。</block>
  <block id="df044a3c3d7f7f244db7c42b347b9a90" category="paragraph">大多數客戶選擇單一投票磁碟群組來服務整個環境、以及每個站台上相同數量的 RAC 節點。磁碟群組應放置在包含資料庫的網站上。結果是連線中斷會導致遠端站台被逐出。遠端站台將不再擁有仲裁、也無法存取資料庫檔案、但本機站台會繼續如常運作。連線恢復後、遠端執行個體即可重新上線。</block>
  <block id="84a24276bfdfbe485b9d961c1a57a830" category="paragraph">發生災難時、需要進行轉換、才能讓資料庫檔案和投票磁碟群組在正常運作的網站上線。如果災難允許 AUSO 觸發切換、則不會觸發 NVFAIL 、因為已知叢集處於同步狀態、且儲存資源正常上線。AUSO 是一項非常快速的作業、應在完成之前完成<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block> 期間過期。</block>
  <block id="6244ee13e435dcc768edbc9b0b38b73e" category="paragraph">由於只有兩個站台、因此無法使用任何類型的自動外部中斷軟體、這表示強制切換必須是手動操作。</block>
  <block id="568c8c12fdb7c74f65125732ee717ad3" category="section-title">三站台組態</block>
  <block id="2c7696fb04f52eb5687d059415066fa7" category="paragraph">擴充的 RAC 叢集可更輕鬆地建構三個站台。裝載 MetroCluster 系統每一半的兩個站台也支援資料庫工作負載、而第三個站台則是資料庫和 MetroCluster 系統的斷路器。Oracle tiebreaker 組態可能只需在第三站台上放置用於投票的 ASM 磁碟群組成員、也可能在第三站台上加入作業執行個體、以確保 RAC 叢集中有奇數個節點。</block>
  <block id="6265611ca77e9ad52249c5fdd4780da9" category="admonition">有關在擴展 RAC 配置中使用 NFS 的重要信息，請參閱 Oracle 文檔中的“ quorum failure group （仲裁故障組）”。總而言之、 NFS 掛載選項可能需要修改以包含軟選項、以確保主仲裁資源所在的第三站台連線中斷、不會使主 Oracle 伺服器或 Oracle RAC 程序掛起。</block>
  <block id="d84d0eea463e72a6e15018c70a45af46" category="doc">Oracle 、 MetroCluster 和 NVFAIL</block>
  <block id="9dc6a9986107298da2a22e7c5a3efb00" category="summary">MetroCluster 上的 Oracle 單一執行個體</block>
  <block id="f8b28e31633ae72c2971ee8b815ed4af" category="paragraph">如前所述、 MetroCluster 系統的存在並不一定會新增或變更任何操作資料庫的最佳實務做法。目前在客戶 MetroCluster 系統上執行的大多數資料庫都是單一執行個體、並遵循 Oracle on ONTAP 文件中的建議。</block>
  <block id="f4872c843923dd8d8731ef66462b5a99" category="paragraph">SyncMirror 在災難恢復站點上提供資料的同步複本、但要讓資料可用、則需要作業系統和相關應用程式。基本自動化可大幅改善整體環境的容錯移轉時間。例如 Veritas Cluster Server （ VCS ）等叢集件產品通常用於在站台之間建立叢集、而且在許多情況下、容錯移轉程序可以使用簡單的指令碼來驅動。</block>
  <block id="c50820a41eb4f23d0a3acc1eeddb391b" category="paragraph">如果主節點遺失、叢集軟體（或指令碼）會設定為在替代站台上線資料庫。其中一個選項是建立預先設定為 NFS 或 SAN 資源的備用伺服器、以供組成資料庫。如果主站台發生故障、叢集軟體或指令碼替代方案會執行類似下列的一系列動作：</block>
  <block id="2a6f458321ddf666cb0c876ee39255f3" category="list-text">掛載檔案系統和 / 或掛載 ASM 磁碟群組</block>
  <block id="3dee93bd9bc9b8b50dcdd2066a86009f" category="list-text">啟動資料庫</block>
  <block id="620515885465a26daea6cc6441403e34" category="paragraph">此方法的主要需求是在遠端站台上執行作業系統。它必須預先設定 Oracle 二進位檔、這也表示 Oracle 修補等工作必須在主要站台和待命站台上執行。或者、 Oracle 二進位檔可鏡射至遠端站台、並在宣告災難時掛載。</block>
  <block id="edb5332feef69c0aa60ea10ed5d31a9f" category="list-text">手動啟動資料庫、或將虛擬機器設定為自動啟動資料庫、例如 ESX 叢集可能跨越站台。在發生災難時、虛擬機器可在移至災難恢復站台後上線。只要主控虛擬化資料庫伺服器的資料存放區在災難發生時並未使用、就不需要設定<block ref="3b93661df04b698b1340ff2da3238d16" prefix=" " category="inline-code"></block> 在相關的磁碟區上。</block>
  <block id="64bba30b717cb45555458da4fed880a1" category="paragraph">幾乎每個應用程式都需要資料複寫。</block>
  <block id="25fb1fa02f326334533a22c105ad3e69" category="paragraph">在最基本的層級上、複寫可能是指將儲存在異地磁帶上的複本、或是將應用程式層級複寫到待命位置。災難恢復是指在發生災難性服務中斷時、使用這些複本複本將服務上線。</block>
  <block id="eab6cb3a1168ef2311865e6155b8272c" category="paragraph">ONTAP 提供多種複寫選項、可因應儲存陣列本身的各種需求、滿足各種需求。這些選項包括簡單地將備份複寫到遠端站台、直到在同一個平台上同時提供災難恢復和高可用度的同步全自動化解決方案。</block>
  <block id="32df0c1cabf839652741a56bdaac7def" category="paragraph">適用於應用程式的主要 ONTAP 複寫技術是 NetApp SnapMirror 和 NetApp SyncMirror 技術。這些不是附加產品、而是完全整合至 ONTAP 、只要簡單新增授權金鑰就能啟動。儲存層級複寫也不是唯一的選項。應用程式層級的複寫、例如搭配 Oracle DataGuard 、也能整合至以 ONTAP 為基礎的資料保護策略。</block>
  <block id="a2259fa074bae962e46ca7fc7aa31be1" category="paragraph">正確的選擇取決於特定的複寫、恢復和保留需求。</block>
  <block id="0d3b37ff5855bf299f3c4a154373c1e2" category="section-title">ONTAP SnapMirror</block>
  <block id="296e89e943f5160d338484b3b705a44e" category="paragraph">SnapMirror 是 NetApp 非同步複寫解決方案、非常適合用來保護大型、複雜且動態的資料集、例如資料庫及其相關應用程式。其主要值如下：</block>
  <block id="d9f36dae2818ace926c4259271530724" category="list-text">* 管理能力。 * SnapMirror 易於設定及管理、因為它是儲存軟體的原生部分。不需要附加產品。複寫關係可在幾分鐘內建立、並可直接在儲存系統上管理。</block>
  <block id="8f761eff026903aa0140319f597d1fb0" category="list-text">* 簡易性。 * 複寫是以 FlexVol 磁碟區為基礎、這些磁碟區是 LUN 或檔案的容器、會以單一一致群組的形式複寫。</block>
  <block id="8b737d6a9db3de6436966db508cb51d4" category="list-text">* 效率。 * 建立初始複寫關係後、只會複寫變更。此外、還會保留重複資料刪除和壓縮等效率功能、進一步減少必須傳輸至遠端站台的資料量。</block>
  <block id="0783dadb67ff77ed26bbfc5d80fa0cbd" category="list-text">* 靈活度。 * 鏡像可以暫時中斷、以便測試災難恢復程序、然後輕鬆地重新建立鏡像、而不需要進行完整的重新鏡像。只有變更的資料必須套用、才能使鏡射恢復同步。鏡像也可以還原、以便在災難結束後、原始站台恢復運作後、能夠快速重新同步。最後、複寫資料的讀寫複本可供測試與開發。</block>
  <block id="8a00f09d8937e890f2cfb4d7acf72733" category="paragraph">ONTAP 提供數種不同的複寫技術、但最靈活的是 SnapMirror 、這是一個 Volume 對 Volume 的非同步鏡射選項。</block>
  <block id="80c8fae3d0b5dd100cc984d9ba3eced7" category="paragraph">如前所述、 FlexVol Volume 是管理 Snapshot 型備份和 SnapRestore 型還原的基本單位。FlexVol Volume 也是 SnapMirror 型複寫的基本單元。第一步是建立來源 Volume 到目的地 Volume 的基準鏡射。初始化此鏡射關係之後、所有後續作業都會以複寫變更的資料為基礎。</block>
  <block id="c1020b1755f65f23643158ce6a4d22cc" category="paragraph">從恢復的角度來看、 SnapMirror 的主要價值如下：</block>
  <block id="50bde20b37cd4d57fbff2b95f2f8ec97" category="list-text">SnapMirror 作業很容易理解、而且可以輕鬆自動化。</block>
  <block id="66162be45733f65fee4abb22e989eb78" category="list-text">SnapMirror 複本的簡單更新只需要複寫差異變更、減少頻寬需求、並允許更頻繁的更新。</block>
  <block id="a3b4fbe416387a4991ccaa8b325a68be" category="list-text">SnapMirror 非常精細。它是以簡單的磁碟區對磁碟區關係為基礎、可建立數百個分別管理的複本和複寫間隔。複寫不一定是一體適用的。</block>
  <block id="4e3785883ef3ccad9938d7e35e493057" category="list-text">鏡射方向可以輕鬆反轉、同時保留僅根據變更更新關係的能力。這可在主站台在發生停電等災難後恢復服務後、提供快速的容錯回復功能。只有變更必須同步回來源。</block>
  <block id="8b8325381cf528eff12c1e678a3112f9" category="list-text">鏡像可以輕鬆中斷並有效地重新同步、以便進行災難恢復程序的排練。</block>
  <block id="b1f45b7d95bfc815351fb649fa94b671" category="list-text">SnapMirror 以完整區塊層級複寫模式運作、不僅能複寫磁碟區中的資料、也能複寫快照。此功能可在災難恢復站點上提供資料複本和完整的備份集。</block>
  <block id="ffafd9ae31dee51209961eb2453ac806" category="paragraph">SnapMirror 以版本彈性模式運作、可複寫特定快照、讓主要和次要站台的保留時間不同。</block>
  <block id="974658d7ac018cb945e78365b0a760fb" category="section-title">SnapMirror同步</block>
  <block id="ffbf9d0ce29a631b6eae8b22c41ec95e" category="paragraph">SnapMirror Synchronous （ SM-S ）是 SnapMirror 的增強功能、可提供 RPO = 0 同步複寫。它最常用於儲存架構、只有資料的子集需要同步鏡射。</block>
  <block id="e8a45c4c0391895df78421904703c933" category="paragraph">SM-S 可在兩種稍微不同的模式下運作： Sync 和 StrictSync 。</block>
  <block id="15a4e16195fb9d30c5df0e11df5c2166" category="paragraph">在「同步」模式中、變更會先複寫、然後才會被確認。只要複寫作業正常、就能保證 RPO 為零。如果無法複寫變更、則 SM-S 可以結束同步模式、並允許作業繼續。這允許在正常情況下使用 RPO=0 、但如果複寫目的地無法使用、資料處理程序不會完全停止。</block>
  <block id="115455025d4664c0dd6deaaf3c1fc93c" category="paragraph">StrictSync 保證 RPO=0 。複寫變更失敗會導致 I/O 錯誤、這通常會導致應用程式關機。</block>
  <block id="1b1ea0d1ad6e5cfb06253a14fcdcfe71" category="inline-link">TR-4733</block>
  <block id="9ccd61d6efc86cc37743fdff385832e8" category="paragraph">如需 SM-S 的完整說明、請參閱<block ref="4459b84726c651a8047a6486e87e48fb" category="inline-link-rx"></block> 以及正式的 ONTAP 文件。新版 ONTAP 會持續新增功能。</block>
  <block id="6165c4352e1504dbaeef34d0cc50c187" category="section-title">一致性群組</block>
  <block id="0651e813e385dbd62a9bca9baee23c6c" category="paragraph">ONTAP 可建立一致性群組快照、從 9.13.1 開始、 ONTAP 可複寫磁碟區群組（請記住、 ONTAP 術語中的磁碟區不是 LUN 、而是由一或多個檔案或 LUN 組成的管理容器）、作為一致的群組。</block>
  <block id="455c7758003d6ebd974e8858f5ef1d7d" category="paragraph">因此、您可以複寫多個 Volume 資料集、並確保所有磁碟區都一致。除此之外、這還能「中斷鏡射並移轉」災難恢復作業、而不需要額外的應用程式或資料庫還原步驟。</block>
  <block id="c44a2da164b7b770fce6338a987670ee" category="section-title">MetroCluster 與 SyncMirror</block>
  <block id="b1a1cfbf3988d8abdfdedaabc1742ae9" category="paragraph">MetroCluster 也是同步複寫解決方案、適用於大規模的關鍵任務工作負載。複寫是以 SyncMirror 為基礎。在最簡單的層面、 SyncMirror 會在兩個不同位置建立兩組完整的 RAID 保護資料。它們可能位於資料中心內的鄰近房間、也可能位於相距數公里的地方。</block>
  <block id="89b8adf28db7abb0febecafdca5871ad" category="paragraph">SyncMirror 與 ONTAP 完全整合、運作速度剛剛高於 RAID 層級。因此、所有常見的 ONTAP 功能、例如 Snapshot 複本、 SnapRestore 和 NetApp FlexClone 、都能順暢運作。它仍是 ONTAP 、只是包含額外的同步資料鏡射層。</block>
  <block id="75c677fa68f5d15c17efbf6fd1fe1765" category="paragraph">管理 SyncMirror 資料的 ONTAP 控制器集合稱為 NetApp MetroCluster 組態。MetroCluster 的主要用途是在各種典型和災難恢復故障情況下、提供對同步鏡射資料的高可用度存取。</block>
  <block id="af845652f0234e1f71bc37e241ab63dc" category="paragraph">MetroCluster 和 SyncMirror 的資料保護主要價值如下：</block>
  <block id="9ab80c5e33e343c3415c21be433c4447" category="list-text">在正常作業中、 SyncMirror 可在不同位置提供保證同步鏡射。寫入作業在兩個站台的非揮發性媒體上都存在之前、才會被確認。</block>
  <block id="680ccf94624c9f922ed236c8cc0c1af2" category="list-text">如果站台之間的連線失敗、 SyncMirror 會自動切換至非同步模式、以保留主要站台提供資料、直到連線恢復為止。還原後、它會有效率地更新主要站台上累積的變更、以提供快速重新同步。不需要完全重新初始化。</block>
  <block id="c18ec55908c635b68abe8c6edbf6476e" category="paragraph">SnapMirror 也與以 SyncMirror 為基礎的系統完全相容。例如、主要資料庫可能是在分散在兩個地理站台的 MetroCluster 叢集上執行。此資料庫也可以將備份複寫到第三個站台、做為長期歸檔、或是在 DevOps 環境中建立複本。</block>
  <block id="3a8111f0b903472ec78531619bf984f6" category="paragraph">Oracle 資料庫的複寫程序基本上與備份程序相同。主要需求是、構成可恢復備份的快照必須複寫到遠端儲存系統。</block>
  <block id="c62b3abab4fdbaf8f0a84e8c3559b5fd" category="paragraph">如先前在本機資料保護文件中所述、可利用熱備份程序或快照最佳化備份來建立可恢復的備份。</block>
  <block id="3d8f8c6a5c90bcd85a22fbd17390a864" category="inline-link-macro">資料配置</block>
  <block id="f3f227cc5c07a040d61c36679053a58a" category="paragraph">假設資料檔案封裝在專用磁碟區中、下一個問題是如何管理重做記錄檔、歸檔記錄檔和控制檔。最簡單的方法是將所有這些資料類型放入單一磁碟區。其優點是複寫的重做記錄檔、歸檔記錄檔和控制檔都能完全同步。不需要進行不完整的還原或使用備份控制檔、不過也可以針對其他可能的還原案例、建立備份控制檔指令碼。</block>
  <block id="927992cbeccc8211e382c97e81514ef9" category="section-title">兩個 Volume 配置</block>
  <block id="fe1cf96940a710dc95fd30bbb7533b52" category="paragraph">下圖顯示最簡單的配置。</block>
  <block id="57f1db4bdf2ce49a98f375d8393f02bf" category="paragraph">這是最常見的方法。從 DBA 的觀點來看、在同一個磁碟區上共同找出所有重做記錄和歸檔記錄複本似乎不太常見。但是、當檔案和 LUN 仍位於相同的基礎磁碟機集上時、分離功能並不會提供更多額外的保護。</block>
  <block id="bc46e4831ef5654d084e456c4c544a42" category="section-title">三個 Volume 配置</block>
  <block id="f6e969769d9d166122489505d676769b" category="paragraph">有時候、由於資料保護考量或需要在控制器之間散佈重做記錄 I/O 、因此需要分離重做記錄。如果是這樣、則下圖所示的三個磁碟區配置將用於複寫、同時仍可避免執行不完整還原或依賴備份控制檔的任何需求。</block>
  <block id="4957c2feaa2cb72d80a0ab65228ad43f" category="paragraph">如此一來、重做記錄和控制檔就能在來源上的各組磁碟軸和控制器之間串列。不過、歸檔記錄和一組控制檔和重做記錄檔仍可在與歸檔記錄同步的狀態下複寫。</block>
  <block id="39128da64bc55500b4b11391aa54a011" category="paragraph">在此模型中、重做記錄 B 磁碟區不會複寫。</block>
  <block id="c0ce858e99375deac8274c96b7e5d0ee" category="section-title">災難恢復程序—熱備份</block>
  <block id="6993729228512b7e23e3ff3ec9099f33" category="paragraph">若要使用熱備份來執行災難恢復、請使用下列基本程序：</block>
  <block id="ee68e5b99222bbc29a480fcb0d1d6ee2" category="section-title">先決條件</block>
  <block id="41bde9c586a860264c425700c48bd375" category="list-text">Oracle 二進位檔安裝在災難恢復伺服器上。</block>
  <block id="cebf7cec81152da2cadffd580d81937f" category="list-text">中列出資料庫執行個體<block ref="2c0b0433aa1c96a2be6f40d9e71bc6af" prefix=" " category="inline-code"></block>。</block>
  <block id="17f8e5eda67237f2ca94c7dcce3e4022" category="list-text">。<block ref="76a2173be6393254e72ffa4d6df1030a" prefix=" " category="inline-code"></block> 和<block ref="6b2f852f7f63f2e5d4be597bbca97bb6" prefix=" " category="inline-code"></block> 或<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block> 例如、執行個體必須在中<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> 目錄。。</block>
  <block id="645a84975202e30700b572b49a5ee29d" category="section-title">災難恢復</block>
  <block id="25d18766964d7515e1f5acd893094f6e" category="list-text">中斷資料檔案和一般記錄磁碟區的鏡射。</block>
  <block id="8fc655e4752d521563db3bfa138ba62e" category="list-text">將資料檔案磁碟區還原為資料檔案的最新熱備份快照。</block>
  <block id="68a9c75816a16f6d4f7572fe287961bf" category="list-text">如果使用 SAN 、請啟動 Volume 群組和 / 或掛載檔案系統。</block>
  <block id="312007510a0f0dc7878d4ed6a7a01554" category="list-text">將歸檔記錄重播至所需的點。</block>
  <block id="e54b793d8bfa83bbb1bd965992c3474e" category="list-text">如果需要完整還原、請重新播放目前的重做記錄。</block>
  <block id="72e5734d53581f86093de5c97d8a3a24" category="paragraph">使用 NFS 可大幅簡化程序、因為可隨時將資料檔案和記錄檔的 NFS 檔案系統掛載到災難恢復伺服器上。當鏡射中斷時、它會變成讀取 / 寫入。</block>
  <block id="de4735bc5bbfdcae3d690313c739ad67" category="section-title">災難恢復程序：快照最佳化備份</block>
  <block id="6b2b8ef11e5ded8a083372ba49d488d2" category="paragraph">從快照最佳化備份中還原、幾乎與熱備份還原程序完全相同、變更如下：</block>
  <block id="af1e49e7bc2b25ce36bd93df09433fb4" category="list-text">將資料檔案磁碟區還原至目前記錄磁碟區複本之前建立的快照。</block>
  <block id="5e09669c98226c5d3a748f7e0f0333ad" category="paragraph">這些差異可簡化整體還原程序、因為當資料庫處於熱備份模式時、不需要確定已在來源上正確建立快照。災難恢復程序是以災難恢復站台上快照的時間戳記為基礎。建立快照時的資料庫狀態並不重要。</block>
  <block id="81d6beef7eaf28bbce692d4b59888f3e" category="section-title">使用熱備份快照進行災難恢復</block>
  <block id="dc711b77f0d6a9c9ccf88b424509440a" category="paragraph">這是以熱備份快照複寫為基礎的災難恢復策略範例。它也可作為簡單且可擴充的本機備份策略範例。</block>
  <block id="edaef18e1c956b9284405fd664c4ca4a" category="paragraph">範例資料庫位於基本的雙磁碟區架構上。<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> 包含資料檔案和<block ref="894db1fc1592356880976f1b92c3e6a2" prefix=" " category="inline-code"></block> 用於組合的重做記錄檔、歸檔記錄檔和控制檔。</block>
  <block id="fc0e7b6cd7cd15929987b1429d1c3a7e" category="paragraph">需要兩個排程、一個用於夜間資料檔案備份、另一個用於記錄檔備份。這些時間分別稱為午夜和 15 分鐘。</block>
  <block id="44c0956347a70c78d2124c1041321049" category="paragraph">然後在快照原則中使用這些排程<block ref="44dc83cda2d6b3ce99cc25803e824061" prefix=" " category="inline-code"></block> 和<block ref="9b055600529d69c4ae0d2a9408dc7aa3" prefix=" " category="inline-code"></block>，如下所示：</block>
  <block id="180e86b8e3c5049779c98c2c1006bb15" category="paragraph">最後、這些快照原則會套用至磁碟區。</block>
  <block id="2887f2c14c7efbc97d53ac2f914c5657" category="paragraph">這會定義磁碟區的備份排程。資料檔案快照會在午夜建立、並保留 60 天。記錄磁碟區包含以 15 分鐘為間隔建立的 72 個快照、可增加長達 18 小時的涵蓋範圍。</block>
  <block id="e1e5ef0e7100311d950b4ffebe040670" category="paragraph">然後、確定資料庫在建立資料檔案快照時處於熱備份模式。這是使用一個小型指令碼來完成的、該指令碼會接受一些在指定的 SID 上啟動和停止備份模式的基本引數。</block>
  <block id="683cdd7abd993faf3ace355cd6870b6f" category="paragraph">此步驟可確保資料庫在午夜快照周圍的四分鐘時間內處於熱備份模式。</block>
  <block id="ccff7eb3ad0059a184886709c87f4889" category="paragraph">複寫到災難恢復站台的設定如下：</block>
  <block id="42d3752a745fb0cdae528f6cc425b569" category="paragraph">記錄 Volume 目的地每 15 分鐘更新一次。這可提供約 15 分鐘的 RPO 。確切的更新時間間隔會因更新期間必須傳輸的資料總量而稍有不同。</block>
  <block id="e272424001d72919ad498e0e9d3c2cc4" category="paragraph">datafile Volume 目的地每六小時更新一次。這不會影響 RPO 或 RTO 。如果需要災難恢復、則第一步是將資料檔案磁碟區還原回熱備份快照。更新時間間隔越頻繁的目的、是要讓此磁碟區的傳輸率更順暢。如果每天排程更新一次、則必須一次傳輸當天累積的所有變更。隨著更新次數增加、變更會在一天內逐步複寫。</block>
  <block id="ce176ff569d716c1fa73d0754aba684b" category="paragraph">如果發生災難、第一步是中斷兩個磁碟區的鏡射：</block>
  <block id="4b9cdb6e2096c0828aeccd2ee5eecf42" category="paragraph">複本現在是讀寫的。下一步是驗證記錄磁碟區的時間戳記。</block>
  <block id="b4d461e48f5be5d08f677045d11e8200" category="paragraph">最新的記錄磁碟區複本是 3 月 14 日 13:30 。</block>
  <block id="96f75a4b63f4377efdf64d571d71caec" category="paragraph">接著、識別在記錄磁碟區狀態之前立即建立的熱備份快照。這是必要的、因為記錄重新執行程序需要在熱備份模式中建立的所有歸檔記錄。因此、記錄磁碟區複本必須比熱備份映像舊、否則它不會包含所需的記錄。</block>
  <block id="d358e4eb10a2f4e0b591e16941d7782c" category="paragraph">最近建立的快照是<block ref="c001e27abf0e66d13790bb8a7e00da54" prefix=" " category="inline-code"></block>。這是資料檔案的最新熱備份映像、然後還原如下所示：</block>
  <block id="d2037035a976c9be71cf6f372300c8c3" category="paragraph">在這個階段、資料庫現在已準備好進行還原。如果這是 SAN 環境、下一步將包括啟動 Volume 群組和掛載檔案系統、這是一項輕鬆自動化的程序。由於此範例使用 NFS 、檔案系統已掛載並變成讀寫、因此在鏡射中斷時無需再掛載或啟動。</block>
  <block id="2edce22eade45b42bc6b2665057fa082" category="paragraph">現在可以將資料庫還原到所需的時間點、或是針對複寫的重做記錄複本進行完整還原。此範例說明歸檔記錄、控制檔和重做記錄 Volume 的組合值。由於不需要仰賴備份控制檔或重設記錄檔、因此恢復程序會大幅簡化。</block>
  <block id="51f74a82c7125b3b288755b6668091b1" category="section-title">利用快照最佳化備份進行災難恢復</block>
  <block id="3680a4757ddad43934237ab6a0ca955c" category="paragraph">使用快照最佳化備份的災難恢復程序與熱備份災難恢復程序幾乎相同。與熱備份快照程序一樣、它基本上也是本機備份架構的延伸、其中的備份會複寫以用於災難恢復。以下範例顯示詳細的組態和還原程序。此範例也指出熱備份與快照最佳化備份之間的主要差異。</block>
  <block id="330dadae5e2585726f41ed1f90e88f9f" category="paragraph">範例資料庫位於基本的雙磁碟區架構上。<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> 包含資料檔案、和<block ref="894db1fc1592356880976f1b92c3e6a2" prefix=" " category="inline-code"></block> 用於組合的重做記錄檔、歸檔記錄檔和控制檔。</block>
  <block id="1669f47e046ce7e069e9d143f42e025d" category="paragraph">需要兩個排程：一個用於夜間資料檔案備份、另一個用於記錄檔備份。這些時間分別稱為午夜和 15 分鐘。</block>
  <block id="ef4adcab3e9bd572d0670f9f2073c311" category="paragraph">這可控制磁碟區的最終備份排程。快照會在午夜建立並保留 60 天。記錄磁碟區包含以 15 分鐘為間隔建立的 72 個快照、最多可增加 18 小時的涵蓋範圍。</block>
  <block id="f9d5149b630a43ff5996adc26c6e1f08" category="paragraph">記錄 Volume 目的地每 15 分鐘更新一次。這會提供約 15 分鐘的 RPO 、而精確的更新間隔會因更新期間必須傳輸的資料總量而稍有不同。</block>
  <block id="992398ebd9e9f825f0aa4415519abdba" category="paragraph">datafile Volume 目的地每 6 小時更新一次。這不會影響 RPO 或 RTO 。如果需要災難恢復、您必須先將資料檔案磁碟區還原回熱備份快照。更新時間間隔越頻繁的目的、是要讓此磁碟區的傳輸率更順暢。如果每天排程一次更新、則必須一次傳輸當天累積的所有變更。隨著更新次數增加、變更會在一天內逐步複寫。</block>
  <block id="9e85b8590ac2f9ff5ebc8d1def51ae82" category="paragraph">如果發生災難、第一步是中斷所有磁碟區的鏡射：</block>
  <block id="fd2834dcadb39f00eb897fdcdc07a03d" category="paragraph">最新的記錄磁碟區複本是 3 月 14 日 13 ： 30 。接著、識別在記錄磁碟區狀態之前立即建立的資料檔案快照。這是必要的、因為記錄重新執行程序需要從快照之前的所有歸檔記錄檔到所需的還原點。</block>
  <block id="810e47566b9cd5aa3b28e6514ec95735" category="paragraph">最近建立的快照是<block ref="c001e27abf0e66d13790bb8a7e00da54" prefix=" " category="inline-code"></block>。還原此快照。</block>
  <block id="87d83a0406ac6622efcdf91c42784ecd" category="paragraph">資料庫現在已準備就緒、可進行還原。如果這是 SAN 環境、您就可以啟動 Volume 群組並掛載檔案系統、這是一項輕鬆自動化的程序。不過、本範例使用 NFS 、因此檔案系統已掛載、並變成讀寫、因此在鏡像毀損時無需再掛載或啟動。</block>
  <block id="7a2e97f17454be76b7e522ce612ff961" category="paragraph">現在可以將資料庫還原到所需的時間點、或是針對複寫的重做記錄複本進行完整還原。此範例說明歸檔記錄、控制檔和重做記錄 Volume 的組合值。恢復程序大幅簡化、因為不需要仰賴備份控制檔或重設記錄檔。</block>
  <block id="5eda890cc07e4b7cd409730d8af8ddc3" category="paragraph">一致性群組複寫可以簡單地透過 SnapMirror 排程單一磁碟區的複寫。這包括資料檔案、控制檔、歸檔記錄檔和重做記錄檔。每次 SnapMirror 更新都會在目的地站台上建立新的資料庫複本、並透過中斷鏡射來保持一致並準備好啟動。</block>
  <block id="89cb1432594ce7c25dadf229401874e7" category="paragraph">如果資料庫必須橫跨多個磁碟區、則需要一致性群組快照（ CG-snapshot ）。</block>
  <block id="f96b125d1bacc785389957041be148e9" category="paragraph">在區塊層級複寫模式中搭配 SnapMirror 使用時、這項策略的另一個優點是完整複寫來源儲存系統上的所有快照。除了災難恢復複本之外、還會複寫完整的備份補充。</block>
  <block id="77fda44088666155052f9d4224878cbc" category="summary">Oracle 歸檔記錄分層</block>
  <block id="8625af69ad0b5f76799d87df777e3c86" category="paragraph">FabricPool 最重要的用途可能是提高已知冷資料的效率、例如資料庫交易記錄。</block>
  <block id="a98d546484d238b37b7e2584ae8d399d" category="summary">Oracle 備份分層</block>
  <block id="9f409a250e4be99904c9e90259cb747d" category="paragraph">傳統應用程式備份包括 Oracle Recovery Manager 等產品、可在原始資料庫之外建立檔案型備份。</block>
  <block id="4627801bdbb24a1991e64f30a2d80cb1" category="paragraph">ONTAP 提供四項原則、可控制效能層上的 Oracle 資料如何成為移轉至容量層的候選對象。</block>
  <block id="2eea2725f31529888b5e57b36492819f" category="paragraph">雖然 FabricPool 分層是在區塊層級運作、但在某些情況下、它可用於提供檔案層級的分層。</block>
  <block id="f935a501eae76f9c13d430bc3879cd0d" category="paragraph">由於 FabricPool 是在區塊層級運作、因此可能變更的檔案可以部分分層化為物件儲存、而部分保留在效能層級上。</block>
  <block id="cc4e17c26faf6b70b383529b6215ba0f" category="doc">物件存放區存取中斷</block>
  <block id="ec35a176f3e7c086273baee0c7f374d5" category="paragraph">瞭解 FabricPool 分層對 Oracle 和其他資料庫的影響、需要瞭解低階 FabricPool 架構。</block>
  <block id="6edf1821ddc55278229c2156f42905f0" category="paragraph">分層原則可控制哪些 Oracle 資料庫區塊從效能層分層分層到容量層。擷取原則可控制已階層的區塊讀取時所發生的情況。</block>
  <block id="d01cbb2be77343ccdb1d3372c4b9891e" category="summary">Oracle 資料庫 LUN 規模調整和 LUN 數量準則</block>
  <block id="51f96d1f8b50084e3a2ddc21ceef8b2f" category="paragraph">選擇最佳 LUN 大小和要使用的 LUN 數量、對於 Oracle 資料庫的最佳效能和管理性至關重要。</block>
  <block id="3d1bd23e74923cdc48fe992d0687809f" category="summary">Oracle 資料庫和 NFS 會租用和鎖定</block>
  <block id="cec6f8a988408ba212798e1cc32658c7" category="paragraph">NFSv3 無狀態。這實際上意味著 NFS 伺服器（ ONTAP ）無法追蹤哪些檔案系統是掛載的、由誰掛載、或哪些鎖定是真的就位。</block>
  <block id="7c96331bd03e63c4eb3505c526b42244" category="paragraph">ONTAP 確實有一些功能會記錄掛載嘗試、因此您可以知道哪些用戶端可能正在存取資料、而且可能會出現諮詢鎖定、但這項資訊並不保證 100% 完整。無法完成、因為追蹤 NFS 用戶端狀態並非 NFSv3 標準的一部分。</block>
  <block id="20733ad7135aa0ede95fd8637fe05cf6" category="section-title">NFSv4 狀態</block>
  <block id="3f7c11f662fc6e07a91179fdf2322ef5" category="paragraph">相反地、 NFSv4 是有狀態的。NFSv4 伺服器會追蹤哪些用戶端正在使用哪些檔案系統、哪些檔案存在、哪些檔案和 / 或檔案區域被鎖定等 這表示 NFSv4 伺服器之間需要定期通訊、才能保持狀態資料最新。</block>
  <block id="6f7e4a1e570f45fa3db0b8a0ed80a38f" category="paragraph">NFS 伺服器所管理的最重要狀態是 NFSv4 鎖定和 NFSv4 租賃、它們彼此之間有很大的關聯。您必須瞭解每個項目本身的運作方式、以及它們彼此之間的關係。</block>
  <block id="0d55fd4062f29237d0fb3b7f666fb8eb" category="section-title">NFSv4 鎖定</block>
  <block id="bf4139ff42e411ae5483e062387b3f70" category="paragraph">有了 NFSv3 、鎖定是建議事項。NFS 用戶端仍可修改或刪除「鎖定」檔案。NFSv3 鎖本身不會過期、必須將其移除。這會造成問題。例如、如果叢集式應用程式會建立 NFSv3 鎖定、而其中一個節點發生故障、您該怎麼做？您可以在仍在運作的節點上對應用程式進行編碼、以移除鎖定、但您如何知道這是安全的？可能是「故障」節點可以運作、但無法與叢集的其他部分通訊？</block>
  <block id="11d1c33ac6b190a233c00cdbdd6a355b" category="paragraph">有了 NFSv4 、鎖定的持續時間有限。只要持有鎖定的用戶端繼續與 NFSv4 伺服器簽入、就不允許其他用戶端取得這些鎖定。如果用戶端無法使用 NFSv4 進行存回、伺服器最終會撤銷鎖定、而其他用戶端則能要求並取得鎖定。</block>
  <block id="c17985911e0182dc5e96c4d60aadf139" category="section-title">NFSv4 租賃</block>
  <block id="596bcfef3aaccfe299bb45a969afcaf0" category="paragraph">NFSv4 鎖定與 NFSv4 租用相關聯。當 NFSv4 用戶端與 NFSv4 伺服器建立連線時、它會取得租用。如果用戶端取得鎖定（鎖定類型眾多）、則鎖定會與租用相關聯。</block>
  <block id="b5248856b1835e14738aa32e053e30e0" category="paragraph">此租用具有定義的逾時時間。根據預設、 ONTAP 會將逾時值設為 30 秒：</block>
  <block id="7e2a66190f452806ac1183721a43eaa1" category="paragraph">這表示 NFSv4 用戶端需要每 30 秒與 NFSv4 伺服器簽入一次、才能續約。</block>
  <block id="809c552ae0a4d377e87f495b4e3ac62b" category="paragraph">租賃會自動由任何活動續約、因此如果用戶端正在工作、就不需要執行額外作業。如果某個應用程式變得很安靜、而且沒有真正的工作、則需要改為執行某種保持活動狀態的作業（稱為順序）。基本上只是說：「我還在這裏、請重新整理我的租約。」</block>
  <block id="70cb78bb7e91dcafab559f9b72e40bb6" category="paragraph">NFSv3 無狀態。這並不需要用戶端的通訊。NFSv4 可設定狀態、一旦租用期間結束、租用即會過期、鎖定會被撤銷、而鎖定的檔案會提供給其他用戶端使用。</block>
  <block id="2ee5d81cfa6306ae71ce534ed9b31431" category="paragraph">有了 NFSv3 、您可以四處移動網路纜線、重新啟動網路交換器、進行組態變更、並確保不會發生任何問題。應用程式通常只會耐心等待網路連線再次運作。</block>
  <block id="8900ff182e4197f8eb2acd7d2b7fd902" category="paragraph">有了 NFSv4 、您有 30 秒的時間（除非您已在 ONTAP 中增加該參數的值）來完成工作。如果您超過此上限、您的租約將會逾時。這通常會導致應用程式當機。</block>
  <block id="ffa8c7744b3e2d43b18c67aec0fe7743" category="paragraph">舉例來說、如果您有 Oracle 資料庫、而且網路連線中斷（有時稱為「網路分割區」）超過租用逾時、您就會使資料庫當機。</block>
  <block id="33b9897348039594b4b17bf1e1629c74" category="paragraph">以下是 Oracle 警示記錄中發生這種情況的範例：</block>
  <block id="85608585bf8e790a579c49ba9af705c6" category="paragraph">如果您查看系統記錄檔、您應該會看到以下幾個錯誤：</block>
  <block id="e19b338de53dada4cf4da3837aaba76d" category="paragraph">記錄訊息通常是問題的第一個徵象、而非應用程式凍結。通常、在網路中斷期間、您完全看不到任何內容、因為程序和作業系統本身都遭到封鎖、無法嘗試存取 NFS 檔案系統。</block>
  <block id="7a3c8c17a9dd10fa565f79e0ebb5bba7" category="paragraph">網路重新運作後、就會出現錯誤。在上述範例中、一旦重新建立連線、作業系統就會嘗試重新取得鎖定、但時間太晚了。租約已到期、鎖定已移除。這會導致一個錯誤、該錯誤會傳播到 Oracle 層、並導致警示記錄中出現訊息。根據資料庫的版本和組態、您可能會看到這些模式的變化。</block>
  <block id="4bec5e793e34a5819aefb68e4f65db26" category="paragraph">總之、 NFSv3 可容忍網路中斷、但 NFSv4 更敏感、並規定了一段定義的租用期。</block>
  <block id="069de2d717910b2677190b9a9b5ed1cf" category="paragraph">如果無法接受 30 秒的逾時、該怎麼辦？如果您管理一個動態變化的網路、在其中重新啟動交換器或重新放置纜線、導致網路偶爾中斷、該怎麼辦？您可以選擇延長租用期、但是否需要說明 NFSv4 寬限期。</block>
  <block id="4b84416146795544deb5c9de89187f91" category="section-title">NFSv4 寬限期</block>
  <block id="7d98e091c5f7be92cd5fb85b985d8d20" category="paragraph">如果 NFSv3 伺服器重新開機、幾乎可以立即為 IO 服務。它並未維持任何形式的用戶端狀態。結果是、 ONTAP 接管作業通常似乎接近即時。當控制器準備好開始提供資料時、就會傳送 ARP 給網路、以表示拓撲的變化。客戶端通常幾乎立即檢測到這種情況，數據恢復流動。</block>
  <block id="173d4fd05086441236dbee4710639d10" category="paragraph">不過 NFSv4 會短暫暫停。這只是 NFSv4 運作方式的一部分。</block>
  <block id="21483115213b27583a07dc2ca994671c" category="paragraph">NFSv4 伺服器需要追蹤租用、鎖定、以及使用何種資料的人員。如果 NFS 伺服器出現問題並重新開機、或停電一段時間、或在維護活動期間重新啟動、則會導致租約 / 鎖定、而其他用戶端資訊也會遺失。伺服器需要先找出哪個用戶端正在使用哪些資料、才能恢復作業。這就是寬限期的開始。</block>
  <block id="09b6f386094bd895d3c9694f28bfdf65" category="paragraph">如果您突然關閉 NFSv4 伺服器的電源、當恢復 IO 時、嘗試恢復 IO 的用戶端會收到回應、基本上說：「我遺失了租用 / 鎖定資訊。您是否要重新登錄鎖定？」 這就是寬限期的開始。ONTAP 預設為 45 秒：</block>
  <block id="e4f8aa90af36d76254e2f02e56232aed" category="paragraph">結果是、在重新啟動之後、控制器會暫停 IO 、而所有用戶端都會回收租用和鎖定。寬限期結束後、伺服器將恢復 IO 作業。</block>
  <block id="bb2b26fdcb4e947cda6f8e38724ecfc9" category="section-title">租用逾時與寬限期比較</block>
  <block id="c4fb6f7d31d205bc07dbff47d0ae4bb3" category="summary">Oracle Direct NFS</block>
  <block id="1bd6ec1185ba67395dc6f9cd2b458ec8" category="paragraph">Oracle 資料庫可使用 NFS 的方式有兩種。</block>
  <block id="96997ca5c577dd19a3ba5f7ff771f27a" category="paragraph">首先、它可以使用以作業系統一部分的原生 NFS 用戶端所掛載的檔案系統。這有時稱為核心 NFS 或 kNFS 。NFS 檔案系統是由 Oracle 資料庫安裝及使用、與任何其他應用程式使用 NFS 檔案系統的方式完全相同。</block>
  <block id="95c17c63df7ceea39a175b1d96955bb7" category="paragraph">第二種方法是 Oracle Direct NFS （ DNFS ）。這是在 Oracle 資料庫軟體中實作 NFS 標準。它不會改變 DBA 設定或管理 Oracle 資料庫的方式。只要儲存系統本身有正確的設定、就應該對 DBA 團隊和終端使用者透明使用 DNFS 。</block>
  <block id="43539d2fca21e5b644484efb94614a7b" category="paragraph">啟用 DNFS 功能的資料庫仍會掛載一般的 NFS 檔案系統。資料庫開啟後、 Oracle 資料庫會開啟一組 TCP/IP 工作階段、並直接執行 NFS 作業。</block>
  <block id="26e7ebad3936387b4b3f7c4f5688ef27" category="section-title">Direct NFS</block>
  <block id="6d431a52c8a41a7c2335f98e2ae8c454" category="paragraph">Oracle Direct NFS 的主要值是略過主機 NFS 用戶端、並直接在 NFS 伺服器上執行 NFS 檔案作業。啟用它只需要變更 Oracle 磁碟管理程式（ ODM ）程式庫。Oracle 說明文件中提供此程序的說明。</block>
  <block id="8401d91735209aeccbe56f33b4e2db73" category="paragraph">使用 DNFS 可大幅提升 I/O 效能、並降低主機和儲存系統的負載、因為 I/O 是以最有效率的方式執行。</block>
  <block id="b0dedecb00787180a9e0c657cfb278c9" category="paragraph">此外、 Oracle DNFS 還包含 * 選項 * 、可用於網路介面多重路徑和容錯功能。例如、兩個 10Gb 介面可以結合在一起、以提供 20Gb 的頻寬。如果某個介面發生故障、則會在另一個介面上重試 I/O 。整體作業與 FC 多重路徑非常類似。多重路徑在數年前是最常見的標準、那就是 1 個乙太網路。10Gb NIC 足以應付大多數 Oracle 工作負載、但如果需要更多 10Gb NIC 、則可加以連結。</block>
  <block id="11e50b3c816105439151db3a3b4fdda3" category="paragraph">使用 DNFS 時、必須安裝 Oracle Doc 1495104.1 中所述的所有修補程式。如果無法安裝修補程式、則必須評估環境、確保該文件中所述的錯誤不會造成問題。在某些情況下、無法安裝所需的修補程式會導致無法使用 DNFS 。</block>
  <block id="8f98002fee392ad6151679875de1a7cc" category="paragraph">請勿將 DNFS 用於任何類型的循環名稱解析、包括 DNS 、 DDNS 、 NIS 或任何其他方法。這包括 ONTAP 中可用的 DNS 負載平衡功能。當使用 DNFS 的 Oracle 資料庫將主機名稱解析為 IP 位址時、後續查詢時不得變更。這可能會導致 Oracle 資料庫當機、並可能導致資料毀損。</block>
  <block id="e80ad3efb180dc2d016b27506b7b24ce" category="section-title">直接 NFS 和主機檔案系統存取</block>
  <block id="4c38a8c0a49e721bf2a378d0b4fb2010" category="paragraph">使用 DNFS 有時會導致依賴掛載在主機上的可見檔案系統的應用程式或使用者活動發生問題、因為 DNFS 用戶端會從主機作業系統不定期存取檔案系統。DNFS 用戶端可以在不瞭解作業系統的情況下建立、刪除及修改檔案。</block>
  <block id="c03389fdb295f2acb079603123e6d0e3" category="paragraph">使用單一執行個體資料庫的掛載選項時、會啟用檔案和目錄屬性的快取、這也表示目錄內容會快取。因此、 DNFS 可以建立檔案、而且在作業系統重新讀取目錄內容和讓使用者看到檔案之前、會有短暫的延遲。這通常不是問題、但在極少數情況下、 SAP BR*Tools 等公用程式可能會發生問題。如果發生這種情況、請變更掛載選項、以使用 Oracle RAC 的建議來解決此問題。這項變更會導致停用所有主機快取。</block>
  <block id="a370a203383b565c3fb746c1c2e1a64b" category="paragraph">只有在使用（ a ） DNFS 時才變更掛載選項、且（ b ）檔案可見度延遲所造成的問題。如果未使用 DNFS 、在單一執行個體資料庫上使用 Oracle RAC 掛載選項會導致效能降低。</block>
  <block id="22a7a03175addfd9aa5b1fa2c351e833" category="summary">Oracle 資料庫的 NFS 組態</block>
  <block id="6cb2edd2369a17890dce007723d98a6f" category="paragraph">NetApp 已提供企業級 NFS 儲存設備超過 30 年、由於其簡易性、隨著雲端型基礎架構的推向、其使用量也不斷增加。</block>
  <block id="0f8a941fcc56687ad8e3914162c19a41" category="section-title">NFS 版本</block>
  <block id="d0972be450ccf257fb73d4878bce204e" category="paragraph">NetApp 必須支援作業系統 NFS 用戶端。</block>
  <block id="7722a2ae10cef9bccea115dfdfe78a99" category="list-text">NFSv3 支援符合 NFSv3 標準的作業系統。</block>
  <block id="a3550edc6962850398d217f78cc4ad0d" category="list-text">Oracle DNFS 用戶端支援 NFSv3 。</block>
  <block id="89c45ebba54478419aa679a7ece8593d" category="list-text">所有遵循 NFSv4 標準的作業系統都支援 NFSv4 。</block>
  <block id="471ff51c89daf6e35e8e2b5111039744" category="inline-link-macro">NetApp IMT</block>
  <block id="8594659e8c4292db778973052a30ab86" category="list-text">NFSv4.1 和 NFSv4.2 需要特定的作業系統支援。請參閱 <block ref="d98f827de8e80b3365d5f4160c243cdc" category="inline-link-macro-rx"></block> 適用於支援的作業系統。</block>
  <block id="d1eb4c2a4d74705a5aa7945f734eff7c" category="list-text">Oracle DNFS 支援 NFSv4.1 需要 Oracle 12.2.0.2 或更高版本。</block>
  <block id="d8bacc1a7a9d6baaeb962e367920593b" category="inline-link-macro">NetApp 支援對照表</block>
  <block id="f16dcce07ca44aa38c7ebe3016b981b2" category="admonition">。 <block ref="f1e4f72fb4419d4270270c5ed1e0d9f6" category="inline-link-macro-rx"></block> 對於 NFSv3 和 NFSv4 、不包含特定的作業系統。一般支援所有遵守 RFC 的作業系統。搜尋線上 IMT 以取得 NFSv3 或 NFSv4 支援時、請勿選取特定的作業系統、因為不會顯示任何相符項目。一般原則隱含支援所有作業系統。</block>
  <block id="26ed9768d6a659a9768842d903d0025f" category="section-title">Linux NFSv3 TCP 插槽表</block>
  <block id="c56ec9836fbbd9c0a426a40fc71c265c" category="paragraph">TCP 插槽表是與主機匯流排介面卡（ HBA ）佇列深度相當的 NFSv3 。這些表格可控制任何時間都可以處理的NFS作業數量。預設值通常為16、這對於最佳效能而言太低。相反的問題發生在較新的Linux核心上、這會自動將TCP插槽表格限制增加到要求使NFS伺服器飽和的層級。</block>
  <block id="5270700baa50d07af667096293a27564" category="paragraph">為了達到最佳效能並避免效能問題、請調整控制 TCP 插槽表的核心參數。</block>
  <block id="5b29db1d99e19013580fa375a5f87fa5" category="paragraph">執行<block ref="1a1e44f7a3390ed4647a7d5b7e8b08ed" prefix=" " category="inline-code"></block> 並觀察下列參數：</block>
  <block id="8821adf56df4952370cfaa57ccaac68d" category="paragraph">所有 Linux 系統都應該包括在內<block ref="c5f48b899461d4c2b9ddc0b24ea87744" prefix=" " category="inline-code"></block>但只有部分包含在內<block ref="6f72acaebcb9a0de6696aaf3508a6144" prefix=" " category="inline-code"></block>。兩者都應設為 128 。</block>
  <block id="3a954c4e5e8d5ac3af590651efc5a2cb" category="cell">若未設定這些參數、可能會對效能造成重大影響。在某些情況下、效能會受到限制、因為 Linux 作業系統沒有發出足夠的 I/O在其他情況下、隨著 Linux 作業系統嘗試發出的 I/O 數量超過可服務的數量、 I/O 延遲也會增加。</block>
  <block id="837f157b2f309f5415420467f7643e3a" category="section-title">ADR 和 NFS</block>
  <block id="c0e7bb1383be0bf1268d1d70280bef6d" category="paragraph">部分客戶回報的效能問題是由於中的資料 I/O 過多所造成<block ref="18ca3ed022c239421418de608ceb49c5" prefix=" " category="inline-code"></block> 位置。問題通常不會在累積許多效能資料之前發生。I/O 過多的原因不明、但此問題似乎是 Oracle 處理程序重複掃描目標目錄以進行變更所致。</block>
  <block id="99be2ae95d50120a7c33c818afda1834" category="paragraph">移除<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和/或<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 掛載選項可執行主機作業系統快取、並降低儲存 I/O 層級。</block>
  <block id="8950578c587f9503f949dfc6a274b611" category="admonition">* NetApp 建議 * 不要放置<block ref="18ca3ed022c239421418de608ceb49c5" prefix=" " category="inline-code"></block> 檔案系統上的資料<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 或<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 因為效能問題很可能會發生。獨立<block ref="18ca3ed022c239421418de608ceb49c5" prefix=" " category="inline-code"></block> 如有必要、請將資料移至不同的掛載點。</block>
  <block id="cdb92b4a73ae99cde4df55c06e20dd3c" category="section-title">NFS-rootonly 和 mount-rootonly</block>
  <block id="c1f0a21ee026237bef11139a30b07040" category="paragraph">ONTAP 包含一個稱為的 NFS 選項<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block> 控制伺服器是否接受來自高連接埠的 NFS 流量連線。為了安全起見、只有 root 使用者可以使用低於 1024 的來源連接埠來開啟 TCP/IP 連線、因為這類連接埠通常是保留給作業系統使用、而非使用者處理程序。此限制有助於確保 NFS 流量來自實際的作業系統 NFS 用戶端、而非模擬 NFS 用戶端的惡意程序。Oracle DNFS 用戶端是 userspace 驅動程式、但程序是以 root 執行、因此通常不需要變更的值<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block>。連線是從低連接埠建立。</block>
  <block id="832b4524bcec11d28ca777ef9cdb4084" category="paragraph">。<block ref="eb6c1a5ecd1e17d4cd46fa5c9d415816" prefix=" " category="inline-code"></block> 選項僅適用於 NFSv3 。它控制是否從大於 1024 的連接埠接受 RPC 掛載呼叫。使用 DNFS 時、用戶端會再次以 root 執行、因此能夠開啟低於 1024 的連接埠。此參數無效。</block>
  <block id="57c47a1451485bec1ebb060afdf65cb4" category="paragraph">透過 NFS 4.0 及更高版本開啟與 DNFS 連線的程序不會以 root 執行、因此需要 1024 以上的連接埠。。<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block> 參數必須設為停用、 DNFS 才能完成連線。</block>
  <block id="4dd73247734d116e5039cc04c4979f2c" category="paragraph">如果<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block> 啟用時、結果會在掛載階段開啟 DNFS 連線時暫停。sqlplus 輸出類似於以下內容：</block>
  <block id="f62d72479920ff0f8dc9a3ca6f301b5d" category="paragraph">參數可變更如下：</block>
  <block id="47fc6c6691aed3ba0dbdc66c7896c61b" category="admonition">在極少數情況下、您可能需要將 NFS-rootonly 和 mount-rootonly 都變更為停用。如果伺服器正在管理大量的 TCP 連線、則可能沒有低於 1024 的連接埠可用、而且作業系統必須使用較高的連接埠。需要變更這兩個 ONTAP 參數、才能完成連線。</block>
  <block id="10b4eb170fe7bd035f21e7d863796683" category="section-title">NFS 匯出原則：超級使用者和 setuid</block>
  <block id="98bfec37486e95443730cc3d462022fb" category="paragraph">如果 Oracle 二進位檔位於 NFS 共用區、則匯出原則必須包含超級使用者和 setuid 權限。</block>
  <block id="3c0699ba2c56cb17c145bbda5580ed67" category="paragraph">用於一般檔案服務（例如使用者主目錄）的共享 NFS 匯出通常會佔用 root 使用者。這表示已掛載檔案系統的主機上 root 使用者的要求、會重新對應為具有較低權限的不同使用者。這有助於防止特定伺服器上的根使用者存取共用伺服器上的資料、進而保護資料安全。在共享環境中， setuid 位元也可能是安全性風險。setuid 位元可讓處理程序以不同於使用者的身分執行、而非以使用者的身分執行指令。例如、 root 擁有的 Shell 指令碼搭配 setuid 位元、會以 root 執行。如果其他使用者可以變更該 Shell 指令碼、任何非 root 使用者都可以透過更新指令碼、以 root 身分發出命令。</block>
  <block id="e341736b7d51c23cb7ef95615832e502" category="paragraph">Oracle 二進位檔包含 root 擁有的檔案、並使用 setuid 位元。如果在 NFS 共用上安裝 Oracle 二進位檔、匯出原則必須包含適當的超級使用者和 setuid 權限。在以下範例中、這兩項規則都包含在內<block ref="1efaeada4e3307369aca511f5da0498a" prefix=" " category="inline-code"></block> 及許可<block ref="0baea2f0ae20150db78f58cddac442a9" prefix=" " category="inline-code"></block> （ root ）使用系統驗證來存取 NFS 用戶端。</block>
  <block id="f1a0fa258c785ac546835a1a75017faf" category="section-title">NFSv4/4.1 組態</block>
  <block id="52f9ad2e353a42e61d9bf7dd9f59d0cb" category="paragraph">對於大多數應用程式、 NFSv3 和 NFSv4 之間的差異很小。應用程式 I/O 通常是非常簡單的 I/O 、而且不會從 NFSv4 中提供的某些進階功能中獲得顯著效益。較高版本的 NFS 不應從資料庫儲存的角度視為「升級」、而應視為包含其他功能的 NFS 版本。例如、如果需要 Kerberos 隱私模式（ krb5p ）的端點對端安全性、則需要 NFSv4 。</block>
  <block id="a1dc4350330c061ae52050f5a3400e25" category="section-title">NFSv4 網域</block>
  <block id="c30669603c950b31f6093d8beaf8060a" category="paragraph">NFSv4/4.1 組態的完整說明已超出本文件的範圍、但常見的問題之一是網域對應不相符。從系統管理員的角度來看、 NFS 檔案系統的行為似乎正常、但應用程式會報告某些檔案的權限和 / 或 setuid 錯誤。在某些情況下、系統管理員不正確地判斷應用程式二進位檔的權限已受損、並在實際問題是網域名稱時執行 chown 或 chmod 命令。</block>
  <block id="f0c6c8a632eeaa954640907ee1da277d" category="paragraph">NFSv4 網域名稱是在 ONTAP SVM 上設定：</block>
  <block id="97a98ebe6ac1f4a8eaf69158419dd818" category="paragraph">主機上的 NFSv4 網域名稱是在中設定<block ref="60969252b5b8391a3378335ae420d2e8" prefix=" " category="inline-code"></block></block>
  <block id="4ade50e8135e817e75aa3086851eaaa8" category="paragraph">網域名稱必須相符。如果沒有、則會在中顯示類似下列的對應錯誤<block ref="452905a167cf4509fd08acb964fdb20c" prefix=" " category="inline-code"></block>：</block>
  <block id="c0eb73bb35a4c58d87b330cd00f1986a" category="paragraph">應用程式二進位檔（例如 Oracle 資料庫二進位檔）包含 root 擁有的具有 setuid 位元的檔案、這表示 NFSv4 網域名稱不相符會導致 Oracle 啟動失敗、並會發出呼叫檔案擁有權或權限的警告<block ref="dd440398b298ff16eb1188ba8afca6df" prefix=" " category="inline-code"></block>、位於<block ref="002f94d606ac06f290f33a5fcc67b264" prefix=" " category="inline-code"></block> 目錄。其內容應如下所示：</block>
  <block id="21cc6f8790de2a7022b344914915604e" category="paragraph">如果此檔案的擁有權為 nobody 、則可能是 NFSv4 網域對應問題。</block>
  <block id="203f1cdb2421d34e9eb7391e03ffcaf6" category="paragraph">若要修正此問題、請參閱<block ref="60969252b5b8391a3378335ae420d2e8" prefix=" " category="inline-code"></block> 根據 ONTAP 上的 vv4 識別碼網域設定來建立檔案、並確保檔案一致。如果沒有、請進行必要的變更、然後執行<block ref="1c7ebfbcaa2681599e41320ed491ca91" prefix=" " category="inline-code"></block>，然後等待一段時間讓變更傳播。接著、檔案擁有權應正確辨識為 root 。如果使用者嘗試執行<block ref="05f0da969f2e0e6ecf3ab445e1e665ad" prefix=" " category="inline-code"></block> 在 NFS 網域設定修正之前、可能需要在這個檔案上執行<block ref="05f0da969f2e0e6ecf3ab445e1e665ad" prefix=" " category="inline-code"></block> 再一次。</block>
  <block id="748f6387bf49161b9a69b7bfd691dcd2" category="paragraph">如果存在下列任一掛載選項、則會停用主機快取：</block>
  <block id="9f75df502ef11eaef4292c94110cb673" category="paragraph">這些設定可能會嚴重影響軟體安裝、修補及備份 / 還原作業的速度。在某些情況下、尤其是叢集式應用程式、這些選項是必要的、因為必須在叢集中的所有節點之間提供快取一致性。在其他情況下、客戶誤用這些參數、結果是不必要的效能損害。</block>
  <block id="8d23519d53d6611bc42fef8dc4a432df" category="paragraph">許多客戶在安裝或修補應用程式二進位檔時、會暫時移除這些掛載選項。如果使用者在安裝或修補程序過程中確認沒有其他處理程序正在使用目標目錄、則可安全地執行此移除。</block>
  <block id="f73bede4039d47664f70de3c2d1f2b46" category="summary">適用於 Oracle 資料庫的 LVM 等量磁碟區組態</block>
  <block id="1b5681ffc153e25d2a48ae3f3f01b9f5" category="paragraph">LVM 分拆是指在多個 LUN 之間分配資料。如此一來、許多資料庫的效能大幅提升。</block>
  <block id="358b9a846de3e04b423c68bac9bc6d53" category="summary">LUN 與 Oracle 資料庫一致</block>
  <block id="3e00e4d28b17eedd6f6c2c38233e06a8" category="paragraph">LUN 對齊是指針對基礎檔案系統配置最佳化 I/O 。</block>
  <block id="a6c7e85d51ae3b98197ceb3eafa3686a" category="inline-link-macro">效率</block>
  <block id="6e2524d5663b2bdc0c7985fa3e57cc55" category="section-title">錯誤對齊警告</block>
  <block id="79e721357e358d77c4700c25c863fc37" category="inline-link">SAN主機組態ONTAP</block>
  <block id="268b1da3f1ff11d32e385d0223101718" category="paragraph">在 Solaris 環境中進行對齊更為複雜。請參閱<block ref="2d33e0364c07dc165b4079892340d4fe" category="inline-link-rx"></block> 以取得更多資訊。</block>
  <block id="6d017248f1e4f0ec7e2cd19d967b6bee" category="cell">在 Solaris x86 環境中、由於大多數組態都有多層分割區、因此請格外注意正確的對齊方式。Solaris x86 分割區磁碟片通常位於標準主開機記錄分割區表格的上方。</block>
  <block id="b1230060a0220caf9d68d64b9dd85e6f" category="summary">使用 Oracle 的 NFS 傳輸大小</block>
  <block id="fabe34ed4a5e432f4d1c4f6584956d8d" category="doc">Oracle 資料庫的 NFS 傳輸大小</block>
  <block id="1e207db9a7c8127a6c43c771b89254fb" category="paragraph">根據預設、 ONTAP 將 NFS I/O 大小限制為 64K 。</block>
  <block id="72d22e3b9af95e272859e64eb1d82df7" category="paragraph">大多數應用程式和資料庫的隨機 I/O 使用的區塊大小要小得多、遠低於 64K 的最大值。大型區塊 I/O 通常是平行處理的、因此 64K 的最大值也不是取得最大頻寬的限制。</block>
  <block id="ebf61afddb34d070825eb696bea48813" category="paragraph">有些工作負載的上限為 64K 、因此會造成限制。特別是、如果資料庫執行的 I/O 數量較少、但容量較大、則備份或還原作業或資料庫完整表格掃描等單執行緒作業、會更快、更有效率地執行。ONTAP 的最佳 I/O 處理大小為 256k 。</block>
  <block id="b0a5b394f3a29e64573049cda19fbacc" category="paragraph">指定 ONTAP SVM 的最大傳輸大小可變更如下：</block>
  <block id="b070b82d66be7116d5fd6dfd8172351b" category="cell">切勿將 ONTAP 上允許的傳輸大小上限降至低於目前掛載之 NFS 檔案系統的 rsize/wsize 值。這可能會在某些作業系統中造成當機或甚至資料毀損。例如、如果 NFS 用戶端目前設定為 rsize/wsize 65536 、則 ONTAP 最大傳輸大小可在 65536 到 1048576 之間調整、因為用戶端本身受到限制、因此沒有任何影響。將傳輸大小上限降至 65536 以下可能會損害可用度或資料。</block>
  <block id="8eb703f2756cafd21dbac4f23c0d6416" category="paragraph">啟用即時壓縮時、 ONTAP 可有效移除寫入檔案或 LUN 的歸零區塊。Oracle ASM 回收公用程式（ ASRU ）等公用程式的運作方式是將零寫入未使用的 ASM 範圍。</block>
  <block id="9de53c14f2bae0c5d4b6e19be495ee94" category="paragraph">從資料庫的角度來看、 ASM 磁碟群組包含零、讀取 LUN 的這些區域會產生零串流、但 ONTAP 不會將零儲存在磁碟機上。而是進行簡單的中繼資料變更、在內部將 LUN 的歸零區域標記為任何資料的空白。</block>
  <block id="06348c6e795160187e298a91b25a37a3" category="paragraph">由於類似的原因、涉及零位資料的效能測試無效、因為零區塊實際上並未在儲存陣列內以寫入方式處理。</block>
  <block id="cee584f1e6223f6dbb73c0d64d599228" category="admonition">使用 ASRU 時、請確定已安裝所有 Oracle 建議的修補程式。</block>
  <block id="17ff263bc6eb701aecb8e79f9ef53efd" category="summary">使用 Oracle 資料庫調整 LUN 和 LVM 大小</block>
  <block id="ff15e8b125dae74c1231f09380e48886" category="paragraph">當 SAN 型檔案系統達到容量上限時、有兩個選項可以增加可用空間：</block>
  <block id="4182200437c090276a01ad8ca54076b0" category="summary">設定 NVFAIL 以保護 Oracle 資料庫</block>
  <block id="60e002164f8988e984cf4a95b240f19d" category="doc">Oracle 和 NVFAIL</block>
  <block id="370bdf5dd39278264774ea595054e243" category="paragraph">NVFAIL 是 ONTAP 中的一項功能、可確保災難性容錯移轉案例期間的完整性。</block>
  <block id="80250c1f1d70fc693877be6f22cc134e" category="paragraph">資料庫在儲存設備容錯移轉事件期間容易受損、因為它們會維持大型內部快取。如果災難性事件需要強制 ONTAP 容錯移轉或強制 MetroCluster 切換、無論整體組態的健全狀況為何、都可能會有效捨棄先前確認的變更。儲存陣列的內容會及時向後跳轉、而且資料庫快取的狀態不再反映磁碟上資料的狀態。這種不一致會導致資料毀損。</block>
  <block id="68114defc717054e7e3b02df438cdbe1" category="paragraph">快取可能發生在應用程式或伺服器層。例如、 Oracle Real Application Cluster （ RAC ）組態、主站台和遠端站台上的伺服器都處於作用中狀態、可在 Oracle SGA 中快取資料。強制切入作業會導致資料遺失、因此資料庫可能會發生毀損、因為儲存在 SGA 中的區塊可能與磁碟上的區塊不符。</block>
  <block id="162de6d405c04ce8f152f1d246ed9187" category="paragraph">較不明顯的快取用途是在作業系統檔案系統層。來自掛載 NFS 檔案系統的區塊可能會快取到作業系統中。或者、以位於主要站台上的 LUN 為基礎的叢集式檔案系統、可以掛載到遠端站台的伺服器上、然後再次快取資料。在這些情況下、 NVRAM 故障或強制接管或強制性的作業系統、可能會導致檔案系統毀損。</block>
  <block id="04ca8d9ad570a3bdf1d76e23bc108ae5" category="paragraph">ONTAP 使用 NVFAIL 及其相關設定、保護資料庫和作業系統不受此案例影響。</block>
  <block id="82ef718f4ebe0c276814ee3d51e33361" category="doc">SnapRestore</block>
  <block id="863696626734d6591db8be57b41c7eec" category="paragraph">NetApp SnapRestore 技術可從快照快速還原 ONTAP 中的資料。</block>
  <block id="9099b669f87419bc03914f11f5779c60" category="paragraph">當關鍵資料集無法使用時、關鍵業務營運就會中斷。磁帶可能會中斷、甚至是從磁碟型備份還原、在網路上傳輸速度可能會很慢。SnapRestore 可提供近乎即時的資料集還原功能、避免這些問題。即使是 PB 規模的資料庫、只要花幾分鐘的時間就能完全還原。</block>
  <block id="b02fb7dec22d0e276ca01cc60b9efb48" category="paragraph">SnapRestore 有兩種形式：檔案 /LUN 型和磁碟區型。</block>
  <block id="520e4b70b10aa2755a82b77e438a510f" category="list-text">無論是 2TB LUN 或 4KB 檔案、個別檔案或 LUN 都能在數秒內還原。</block>
  <block id="45e8a84fe4ac58c8b30a7bdaf17c0b7f" category="list-text">無論是 10GB 或 100TB 的資料、檔案或 LUN 的容器都能在數秒內還原。</block>
  <block id="4be4677be8cd434956b9b9af515b971a" category="paragraph">「檔案或 LUN 的容器」通常指的是 FlexVol Volume 。例如、您可以在單一磁碟區中擁有 10 個組成 LVM 磁碟群組的 LUN 、或是一個磁碟區可以儲存 1000 位使用者的 NFS 主目錄。您可以將整個磁碟區還原為單一作業、而不需為每個個別檔案或 LUN 執行還原作業。此程序也適用於包含多個磁碟區的橫向擴充容器、例如 FlexGroup 或 ONTAP 一致性群組。</block>
  <block id="55abea92d64d6738f9e0ed48799696e7" category="paragraph">ONTAP 僅允許唯讀存取快照資料、但可透過 SnapRestore 重新啟動資料。快照會重新啟用為資料的讀寫檢視、並將資料恢復至先前的狀態。SnapRestore 可以在磁碟區或檔案層級運作。這項技術基本上相同、但行為上有一些小差異。</block>
  <block id="f10f2af75e2770a8ed3c2fde594e986d" category="section-title">Volume SnapRestore</block>
  <block id="ca9846346bc3b03cdec10f9fff456866" category="paragraph">Volume 型 SnapRestore 會將整個資料量傳回至較早的狀態。這項作業不需要資料移動、也就是說還原程序基本上是即時的、雖然 API 或 CLI 作業可能需要幾秒鐘的時間才能處理。還原 1GB 的資料並不比還原 1PB 的資料複雜或耗時。這項功能是許多企業客戶移轉至 ONTAP 儲存系統的主要原因。即使是最大的資料集、也能以秒為單位提供 RTO 。</block>
  <block id="627436e77bb011a6a312ae87b12f98ea" category="paragraph">Volume 型 SnapRestore 的缺點之一、是因為磁碟區內的變更會隨時間累積。因此、每個快照和作用中檔案資料都取決於到該點之前的變更。將磁碟區還原為較早的狀態、表示捨棄所有後續對資料所做的變更。然而、不太明顯的是、這包括後續建立的快照。這並不總是理想的。</block>
  <block id="5c956f2c1cfc5b9e5bac32ad1acba314" category="paragraph">例如、資料保留 SLA 可能會指定每晚備份 30 天。將資料集還原至五天前以 Volume SnapRestore 建立的快照、將會捨棄前五天建立的所有快照、違反 SLA 。</block>
  <block id="8bf9e697004f47ed6133aef724a8a42c" category="paragraph">有許多選項可解決此限制：</block>
  <block id="ad3b75456e625de5fe347fb918f59a22" category="list-text">資料可從先前的快照複製、而非執行整個 Volume 的 SnapRestore 。此方法最適合較小的資料集。</block>
  <block id="90541eb74c7c56cadc2f90ec6fb6f0c0" category="list-text">您可以複製快照、而非還原快照。此方法的限制在於來源快照是複本的相依性。因此、除非也刪除複本、或將其分割成一個不同的 Volume 、否則無法將其刪除。</block>
  <block id="ab6045d3463c0f68ce2fa405dce9d554" category="list-text">使用檔案型 SnapRestore 。</block>
  <block id="7f7599a8b92846b691484dc91e090164" category="section-title">File SnapRestore</block>
  <block id="f03eebe4f07d362dbfe4c1d4e76c724d" category="paragraph">檔案型 SnapRestore 是更精細的快照型還原程序。個別檔案或 LUN 的狀態會還原、而非還原整個磁碟區的狀態。不需要刪除快照、此作業也不需要對先前的快照建立任何相依性。檔案或 LUN 會立即在作用中磁碟區中可用。</block>
  <block id="e432fdcc277fc74a1b2b94cfeec8a7d2" category="paragraph">SnapRestore 還原檔案或 LUN 時不需要移動資料。不過、需要進行一些內部中繼資料更新、以反映檔案或 LUN 中的基礎區塊現在同時存在於快照和作用中磁碟區中。不應影響效能、但此程序會封鎖快照的建立、直到快照完成為止。根據還原的檔案總大小、處理速度約為 5Gbps （ 18TB/ 小時）。</block>
  <block id="45c46768a1cb073f0d13245a0dc816f2" category="paragraph">正確的企業資料保護架構、取決於資料保留、可恢復性、以及各種事件中斷的容忍度等業務需求。</block>
  <block id="46e1b2893bdb002c0ede448cbfe1cb14" category="paragraph">例如、請考慮範圍內的應用程式、資料庫和重要資料集數量。為單一資料集建立備份策略、以確保符合典型 SLA 的要求相當簡單、因為沒有太多物件需要管理。隨著資料集數量增加、監控作業變得更複雜、系統管理員可能不得不花費更多時間來解決備份故障。當環境達到雲端與服務供應商的規模時、需要完全不同的方法。</block>
  <block id="b70d233428e03d072b1134a97d853ab2" category="paragraph">資料集大小也會影響策略。例如、由於資料集太小、因此有許多選項可用於 100GB 資料庫的備份與還原。只要使用傳統工具從備份媒體複製資料、通常就能提供足夠的恢復 RTO 。100TB 資料庫通常需要完全不同的策略、除非 RTO 允許多天中斷、否則傳統的複製備份與還原程序可能是可以接受的。</block>
  <block id="64848fee9c168231f5d0f13322ed0a87" category="paragraph">最後、除了備份與還原程序本身之外、還有其他因素。例如、是否有支援關鍵生產活動的資料庫、使恢復成為僅由熟練的 DBA 執行的罕見事件？或者、資料庫是否是大型開發環境的一部分、而在大型開發環境中、恢復是經常發生的事、並由一群通才的 IT 團隊負責管理？</block>
  <block id="e26b57887de9a65c0316a87d49bf6c44" category="section-title">快照是否為備份？</block>
  <block id="c3fd105ab426caff0a0ade2e93476543" category="paragraph">人們普遍反對使用快照做為資料保護策略、因為「真實」資料和快照資料位於同一個磁碟機上。遺失這些磁碟機將會導致主要資料和備份遺失。</block>
  <block id="12d1adb01d24027626b2a47660fb5b81" category="paragraph">這是一項有效的考量。本機快照是用於日常備份與還原需求、在這方面、快照是備份。在 NetApp 環境中、將近 99% 的還原案例都仰賴快照來滿足最嚴苛的 RTO 需求。</block>
  <block id="fc34c9966c8ecb7307468637d9e79933" category="paragraph">然而、本機快照不應是唯一的備份策略、因此 NetApp 提供 SnapMirror 複寫等技術、可快速有效地將快照複寫至一組不同的磁碟機。在架構正確的解決方案中、快照加上快照複寫功能可將磁帶的使用降至最低、甚至是每季歸檔、或完全消除。</block>
  <block id="1ea948130a9dbbc02e3a80648a99ff57" category="section-title">一致性群組備份</block>
  <block id="9b234a126e57777ab83807827d4e7078" category="paragraph">一致性群組備份包括在單一時間點擷取資料集（或多個資料集）的狀態。例如、這包括所有資料庫元件、例如資料檔案、記錄檔、以及與資料庫直接相關的其他檔案。這幾乎適用於所有關聯式資料庫產品、包括 Oracle RDBMS 、 Microsoft SQL Server 、 SAP HANA 、 PostgreSQL 、 MySQL 和 MariaDB 。使用一致性群組備份來保護 VMware 組態的做法類似、也就是在單一時間點內擷取所有的資料存放區、以及可能的 ESX 開機 LUN 。</block>
  <block id="5a1f7038c74e54c08669efa6722f1091" category="paragraph">建立這樣的一致性群組快照、基本上就是模擬當機、這就是為什麼這類備份經常稱為損毀一致的備份。有時候、對於支援恢復案例有疑慮、但請務必瞭解、通常不需要任何恢復程序。當應用程式在還原一致性群組備份之後啟動時、會執行一般的記錄還原程序、檔案系統日誌重新播放、以及其他工作、以重播備份點正在執行中的任何 I/O 。然後應用程式會照常啟動。</block>
  <block id="aebdbddec25f7eba6434244a989fb659" category="paragraph">基本上、任何能夠承受停電或伺服器當機而不毀損資料的應用程式、都能以這種方式受到保護。許多不同廠商的同步與非同步鏡射產品、可保護大量應用程式、也能證明這項工作的成效。如果災難突然發生在主要站台、則複本站台會在發生災難時、包含原始環境的一致映像。再一次、不需要特殊的恢復程序。</block>
  <block id="e085ffefd89f8fb66260a9720e3fb6f8" category="paragraph">此方法的 RPO 通常僅限於備份點。一般而言、單一磁碟區快照的最小 RPO 是一小時。例如、 48 小時快照加上 30 天夜間快照是合理的、不需要保留過多的快照。不到一小時的 RPO 就變得更難達成、建議您先諮詢 NetApp 專業服務部門、瞭解環境、規模及資料保護需求。</block>
  <block id="1fe119a790b393b7dd7e79b63f15f52b" category="paragraph">RTO 通常可在數秒內測量。應用程式會關閉、磁碟區會還原、應用程式也會重新啟動。</block>
  <block id="444cd304758b7607c8f7a3f627a5bc1f" category="paragraph">最簡單的方法是將所有檔案或 LUN 放在單一磁碟區一致性群組中、以便直接在 ONTAP 中排程快照建立。如果資料集必須跨越多個磁碟區、則需要一致性群組快照（ CG-snapshot ）。這可以使用系統管理員或 RESTful API 呼叫來設定、而且 SnapCenter 能夠在已定義的磁碟區清單上建立簡單的一致性群組快照。</block>
  <block id="689b0155b42a554594a44cddc736eb67" category="section-title">複寫與災難恢復架構</block>
  <block id="1749d12df3df2319d3eee218a277ff83" category="inline-link-macro">MetroCluster</block>
  <block id="f443592081a2b3ddc55b94abe49ba128" category="paragraph">災難恢復 RPO 受限於可用的網路頻寬和受保護資料的總大小。建立初始基準傳輸之後、更新僅以變更的資料為基礎、這通常是資料佔用空間總量的低百分比、但確實存在例外情況。</block>
  <block id="89e87a831dae60244ba34496d70fd45d" category="paragraph">例如、每週變更率為 10% 的 10TB 資料庫、在總變更中、平均每小時約為 6GB 。10 Gb 的連線能力、此資料庫需要大約六分鐘的時間才能傳輸。變更率會因資料庫變更率的波動而異、但整體而言、 15 分鐘的更新間隔、因此應可達成 15 分鐘的 RPO 。如果有 100 個這樣的資料庫、則需要 600 分鐘才能傳輸資料。因此、一小時的 RPO 是不可能的。同樣地、單一資料庫的複本、每週變更率為 10% 、大小為 100TB 、無法在一小時內可靠地更新。</block>
  <block id="3c886a803aef21f5ac9f7bcea7408cbb" category="paragraph">其他因素可能會影響複寫作業、例如複寫作業的額外負荷和限制。不過、單一磁碟區複寫策略的整體規劃可根據可用頻寬進行、複寫 RPO 一般可達一小時。不到一小時的 RPO 變得更難達成、只能在諮詢 NetApp 專業服務之後才能執行。在某些情況下、 15 分鐘的時間是可行的、因為站台對站台網路連線能力非常好。不過、整體而言、當需要一小時以下的 RPO 時、多重 Volume 記錄重播架構會產生更好的結果。</block>
  <block id="5e2cbdd214e7a73bca1af8ed5cc04626" category="paragraph">災難恢復案例中的 RTO 與一致性群組複寫功能非常出色、通常從儲存點算起、以秒為單位。最直接的方法是中斷鏡射、資料庫已準備就緒、可以開始運作。資料庫啟動時間通常約為 10 秒、但有大量記錄交易的大型資料庫可能需要幾分鐘的時間。</block>
  <block id="1c18c939e73ddb1ceee34e8a33079d1a" category="paragraph">判斷 RTO 的最重要因素不是儲存系統、而是執行 RTO 的應用程式和主機作業系統。例如、複寫的資料可在一秒或兩秒內提供、但這只代表資料。此外、還必須有正確設定的作業系統、並具備應用程式二進位檔、才能使用資料。</block>
  <block id="6fab898feea25b9d7fd4477911b90b31" category="paragraph">在某些情況下、客戶已預先準備好災難恢復執行個體、並在作業系統上預先探索到儲存設備。在這些情況下、啟動災難恢復案例只需要中斷鏡射並啟動應用程式即可。在其他情況下、作業系統和相關應用程式可能會與資料庫一起鏡射、做為 ESX 虛擬機器磁碟（ VMDK ）。在這些案例中、 RPO 是由客戶投資多少自動化來快速啟動 VMDK 、以便啟動應用程式所決定。</block>
  <block id="c7d5d755b896edf43189fbb020202913" category="paragraph">保留時間部分由快照限制控制。例如、 ONTAP 中的磁碟區限制為 1024 個快照。在某些情況下、客戶會使用多工複寫來增加限制。例如、如果需要 2000 天的備份、則可以將來源複寫到兩個磁碟區、並在其他日期進行更新。這需要增加所需的初始空間、但與傳統的備份系統相比、它仍然是更有效率的方法、而傳統的備份系統則需要多個完整備份。</block>
  <block id="7ec0f114b69016879106b5018cdf10b9" category="section-title">單一磁碟區一致性群組</block>
  <block id="cd70f3e596e275fe80fbbe5d7858ce1a" category="paragraph">最簡單的方法是將所有檔案或 LUN 放在單一磁碟區一致性群組中、以便直接在儲存系統上排程 SnapMirror 和 SnapVault 更新。不需要外部軟體。</block>
  <block id="909e8df57072d0b3c6d7d64b11acb571" category="section-title">多磁碟區一致性群組</block>
  <block id="c7371eded617935ace6c71a33cfbf3fd" category="paragraph">當資料庫必須跨越磁碟區時、需要一致性群組快照（ CG-snapshot ）。如前所述、這可以使用系統管理員或 RESTful API 呼叫來設定、而且 SnapCenter 能夠在已定義的磁碟區清單上建立簡單的一致性群組快照。</block>
  <block id="9c991b38c054d7bec0632efd6667540c" category="paragraph">另外還有一項考量、就是使用多個 Volume 一致的快照來進行災難恢復。執行多個磁碟區的更新時、可能會在傳輸仍在進行中時發生災難。結果是一組不一致的磁碟區。如果發生這種情況、某些磁碟區必須還原為較早的快照狀態、才能提供一致當機且可供使用的資料庫映像。</block>
  <block id="fad8a5f46ebd89f74383b461e32dd6b9" category="section-title">災難恢復：啟動</block>
  <block id="5ac319591298468b0af89c2c469201f8" category="paragraph">啟動災難恢復複本的程序取決於儲存類型。有了 NFS 、檔案系統就可以預先掛載到災難恢復伺服器上。它們處於唯讀狀態、當鏡射中斷時會變成讀寫狀態。如此可提供極低的 RPO 、而且整體災難恢復程序更可靠、因為需要管理的零件較少。</block>
  <block id="b829fc11ff11b57af8d4632d38d7d7e8" category="paragraph">在災難恢復變得更複雜時啟動 SAN 組態。最簡單的選項通常是暫時中斷鏡像並掛載 SAN 資源、包括探索 LVM 組態（包括 Oracle 自動儲存管理 [ASM/] 等應用程式特定功能）、以及新增項目至 /etc/fstab 。</block>
  <block id="335a5796fb106a877544d121062534be" category="paragraph">結果是目標伺服器知道 LUN 裝置路徑、磁碟區群組名稱和其他裝置路徑。然後可以關閉這些資源、然後還原鏡像。結果是伺服器處於可快速將應用程式上線的狀態。啟動磁碟區群組、掛載檔案系統、或啟動資料庫和應用程式的步驟都能輕鬆自動化。</block>
  <block id="b1a175c5f42da29f6c27f4ea29684b63" category="paragraph">必須謹慎確保災難恢復環境是最新的。例如、新的 LUN 可能會新增至來源伺服器、這表示必須在目的地預先探索新的 LUN 、以確保災難恢復計畫能如預期般運作。</block>
  <block id="90426ba53f908049843b3ea392578d04" category="doc">Oracle 災難恢復</block>
  <block id="2a4fa9d9434561574119e3086112023f" category="paragraph">使用單一快照來保護資料檔案、歸檔記錄檔、重做記錄檔和控制檔是一種有效的備份、還原和複寫方法。  不過、 RPO 僅限於備份本身的點。適用於一小時或更長的 RPO 。如果資料庫跨越磁碟區、則需要使用先前討論的工具之一來建立 CG 快照。</block>
  <block id="93310f4cebc752304c164f00d67e0bca" category="paragraph">例如、整個資料庫可以位於單一磁碟區、其快照排程如下：</block>
  <block id="a33821be4b3522d65daed1ec317299f6" category="list-text">72 小時快照</block>
  <block id="0eea0679ac7bf43c19d603cd78e81de9" category="list-text">30 個夜間快照</block>
  <block id="c4546c401776d279c5577011584577fa" category="list-text">12 個月快照</block>
  <block id="b63db1b650d128c342617b377baf928a" category="paragraph">這可在前 72 小時的滾動期間提供 1 小時的 RPO 、以及額外的夜間和每月備份。單一磁碟區或一組 CG 快照也可包含多個資料庫或應用程式檔案、以便在大型環境中提供一致的備份。</block>
  <block id="686540783626106489734a1990d4930d" category="paragraph">ONTAP 旨在提供最大的 Oracle 資料庫可用度。ONTAP 高可用度功能的完整說明不在本文件的範圍之內。然而、與資料保護一樣、在設計資料庫基礎架構時、對此功能的基本瞭解非常重要。</block>
  <block id="b049fcbe8198301adc6bf87634a02845" category="section-title">HA 配對</block>
  <block id="1a7c11d1e2d03d3d1b57cff284ebd761" category="paragraph">高可用度的基本單位是 HA 配對。每對都包含備援連結、可支援將資料複寫到 NVRAM 。NVRAM 不是寫入快取。控制器內的 RAM 會做為寫入快取。NVRAM 的用途是暫時記錄資料、以防止發生非預期的系統故障。在這方面、它與資料庫重做記錄類似。</block>
  <block id="cd2e54027dfcfeddd07ddd580db527c0" category="paragraph">NVRAM 和資料庫重做記錄都可用來快速儲存資料、讓資料的變更能夠儘快提交。磁碟機（或資料檔案）上的持續資料更新直到稍後在 ONTAP 和大多數資料庫平台上稱為檢查點的程序期間才會進行。正常作業期間不會讀取 NVRAM 資料或資料庫重做記錄。</block>
  <block id="4e044ec0c36e513506c77c0a97d53539" category="paragraph">如果控制器突然故障、可能會有擱置中的變更、這些變更儲存在 NVRAM 中、但尚未寫入磁碟機。合作夥伴控制器會偵測故障、控制磁碟機、並套用儲存在 NVRAM 中的必要變更。</block>
  <block id="310e46747ebab6a43d5a15998f6e2b33" category="section-title">接管與恢復</block>
  <block id="1d739263e44469ad28f77fe7329fa78d" category="paragraph">接管與恢復是指在 HA 配對中的節點之間轉移儲存資源責任的程序。接管和恢復有兩個層面：</block>
  <block id="f2d43d90397aa8140414437eda14febb" category="list-text">管理可存取磁碟機的網路連線能力</block>
  <block id="6e1c794c81468e3286a23138460bb3fb" category="list-text">管理磁碟機本身</block>
  <block id="89d3f6c60c53a11e16a6756bde03ca00" category="paragraph">支援 CIFS 和 NFS 流量的網路介面、都是設定在主位置和容錯移轉位置。接管包括將網路介面移至與原始位置位於同一子網路的實體介面上的暫存主目錄。贈品包括將網路介面移回其原始位置。您可以視需要調整確切行為。</block>
  <block id="108018656caf59cc565f1172047dab38" category="paragraph">支援 SAN 區塊傳輸協定（例如 iSCSI 和 FC ）的網路介面不會在接管和恢復期間重新定位。而是應使用包含完整 HA 配對的路徑來佈建 LUN 、以產生主要路徑和次要路徑。</block>
  <block id="80795d5dd590e432b4f5945aba47caf4" category="admonition">您也可以設定其他控制器的路徑、以支援在較大叢集中的節點之間重新放置資料、但這並不屬於 HA 程序的一部分。</block>
  <block id="aae63904d16fd1c522dc5ff53eb695b5" category="paragraph">接管與恢復的第二個層面是磁碟擁有權的轉移。確切的程序取決於多種因素、包括接管 / 恢復的原因、以及發出的命令列選項。目標是盡可能有效率地執行作業。雖然整體程序可能需要幾分鐘的時間、但磁碟機的實際擁有權從節點移轉至節點的時間通常只需幾秒鐘。</block>
  <block id="61775b9e8f759f26eafd6b03448d1f30" category="section-title">接管時間</block>
  <block id="3224b51e62790c4ce988d8c1876fb36e" category="paragraph">主機 I/O 在接管和恢復作業期間會短暫暫停 I/O 、但在正確設定的環境中不應發生應用程式中斷。I/O 延遲的實際轉換程序通常是以秒為單位來測量、但主機可能需要額外的時間來識別資料路徑的變更並重新提交 I/O 作業。</block>
  <block id="40f291752a9848bfecb7264cfd9aa8ee" category="paragraph">中斷的性質取決於傳輸協定：</block>
  <block id="cb44db7841f8fb68230a260c4c68bfe0" category="list-text">支援 NFS 和 CIFS 流量的網路介面會在移轉至新實體位置後、向網路發出位址解析傳輸協定（ ARP ）要求。這會導致網路交換器更新其媒體存取控制（ MAC ）位址表、並繼續處理 I/O在計畫性接管和恢復的情況下、中斷通常以秒為單位來衡量、在許多情況下都無法偵測到。有些網路可能會較慢、無法完全辨識網路路徑的變更、有些作業系統可能會在很短的時間內排入大量 I/O 、因此必須重新嘗試。這可能會延長恢復 I/O 所需的時間</block>
  <block id="6a410522094e0b0f874dab5784e81ab8" category="list-text">支援 SAN 通訊協定的網路介面不會轉換到新位置。主機作業系統必須變更使用中的路徑。主機觀察到 I/O 暫停的情形取決於多種因素。從儲存系統的角度來看、無法提供 I/O 的時間只有幾秒鐘。不過、不同的主機作業系統可能需要額外的時間、才能讓 I/O 逾時、再重試。較新的作業系統更能更快辨識路徑變更、但較舊的作業系統通常需要 30 秒才能辨識變更。</block>
  <block id="cabc4f9cda7d4bfb99181166c863a374" category="paragraph">下表顯示儲存系統無法將資料提供給應用程式環境的預期接管時間。在任何應用程式環境中都不應發生任何錯誤、而是在 IO 處理過程中、接管應該會顯示為短暫的暫停。</block>
  <block id="c8984126713ed072b9cb0a44a162be4d" category="cell">AFF</block>
  <block id="b7b46ce5d1a547db89c0bc615ff272a5" category="cell">ASA</block>
  <block id="ed3467fac861f6a32cd66093ac415805" category="cell">計畫性接管</block>
  <block id="57a915dfa0e8469b25c1b8b947f7ee2c" category="cell">15 秒</block>
  <block id="cd5dce62294e9a79e9c2165ee0903f5f" category="cell">6-10 秒</block>
  <block id="cbfdbb11fd5eab0d9fdd078ae66a1c69" category="cell">2-3 秒</block>
  <block id="1a066f0304c1d3a279466c70359c5103" category="cell">非計畫性接管</block>
  <block id="0f4a6e109a34d3483995e427b6581130" category="cell">30 秒</block>
  <block id="dbfb054670bc82c6e08a7e101c0f0ef4" category="paragraph">ONTAP 內的邏輯資料保護包含三項關鍵需求：</block>
  <block id="b6cc6762545d78ab663e39c37d172bd2" category="list-text">資料必須受到保護、以免資料毀損。</block>
  <block id="e7c7e14f4b6ca1b3ae32b2279243dba6" category="list-text">資料必須受到保護、避免磁碟機故障。</block>
  <block id="1168469b387027a850496f6cac9f3529" category="list-text">資料變更必須受到保護、以免遺失。</block>
  <block id="864a6ca5da4b36656beba11c90f4c4e5" category="paragraph">以下各節將討論這三項需求。</block>
  <block id="a05b54004946aa523bfe7c1e92a52f52" category="section-title">網路毀損： Checksum</block>
  <block id="ed95581a613a4f19be367c10cd063cc2" category="paragraph">最基本的資料保護層級是 Checksum 、這是儲存在資料旁的特殊錯誤偵測程式碼。在網路傳輸期間、會使用 Checksum 和（在某些情況下）多個 Checksum 來偵測資料毀損。</block>
  <block id="c1343e51090396cf011509389bc0adab" category="paragraph">例如、 FC 框架包含稱為循環備援檢查（ CRC ）的校驗和形式、以確保有效負載不會在傳輸過程中毀損。傳輸器會同時傳送資料和資料的 CRC 。FC 訊框的接收器會重新計算接收資料的 CRC 、以確保其符合傳輸的 CRC 。如果新計算的 CRC 與附加至框架的 CRC 不相符、則資料會毀損、 FC 框架會遭到捨棄或拒絕。iSCSI I/O 作業包括 TCP/IP 層和乙太網路層的校驗和、此外、為了提供額外的保護、也可在 SCSI 層提供選用的 CRC 保護。TCP 層或 IP 層偵測到線路上的任何位元毀損、導致封包重新傳輸。與 FC 一樣、 SCSI CRC 中的錯誤也會導致作業遭到捨棄或拒絕。</block>
  <block id="1f08639c540e47068c16c3ac48ea7bbe" category="section-title">磁碟機毀損： Checksum</block>
  <block id="c5d50bc8d916a4b26166bbda091cd6d4" category="paragraph">Checksum 也可用來驗證儲存在磁碟機上的資料完整性。寫入磁碟機的資料區塊會以 Checksum 功能儲存、產生與原始資料相關的不可預測數字。從磁碟機讀取資料時、會重新計算總和檢查碼、並與儲存的總和檢查碼進行比較。如果不相符、則資料已毀損、必須由 RAID 層還原。</block>
  <block id="8edc44db01815f20f6508db8b5630cfe" category="section-title">資料毀損：寫入遺失</block>
  <block id="972eab86b2aecd693914feabc5a3b65c" category="paragraph">最難偵測的毀損類型之一是遺失或錯誤寫入。確認寫入後、必須將其寫入正確位置的媒體。就地資料毀損使用儲存在資料中的簡單檢查碼、相當容易偵測。但是、如果寫入資料只是遺失、則先前版本的資料可能仍然存在、而且總和檢查碼是正確的。如果寫入放置在錯誤的實體位置、則相關的 Checksum 將再次對儲存的資料有效、即使寫入已銷毀其他資料。</block>
  <block id="53830741c46fbc560962b086f582e79a" category="paragraph">這項挑戰的解決方案如下：</block>
  <block id="656d064400822ca2ffb25f52c9fc95db" category="list-text">寫入作業必須包含中繼資料、以指出寫入的預期位置。</block>
  <block id="37a60b1c7392a26270880a361f85db55" category="list-text">寫入作業必須包含某種版本識別碼。</block>
  <block id="4275b2e68761baa23b112833facf4ca1" category="paragraph">ONTAP 寫入區塊時、會包含區塊所屬的資料。如果後續讀取識別出某個區塊、但中繼資料指出該區塊在位置 456 找到時屬於位置 123 、則表示該寫入已放錯位置。</block>
  <block id="009b13bf07c7db21c1e4769526e60694" category="paragraph">更難偵測完全遺失的寫入。這項說明非常複雜、但基本上 ONTAP 是以寫入作業導致磁碟機上兩個不同位置的更新方式來儲存中繼資料。如果寫入遺失、後續的資料讀取和相關中繼資料會顯示兩個不同的版本識別。這表示磁碟機未完成寫入。</block>
  <block id="3b04a99c209a31ad69e7865ea94e5c94" category="paragraph">遺失或放錯位置的寫入毀損極少發生、但隨著磁碟機持續成長、資料集也逐漸擴充至 EB 規模、風險也會增加。任何支援資料庫工作負載的儲存系統都應包含遺失寫入偵測。</block>
  <block id="e978ccc010ec4d37148d52e2fbf439dd" category="section-title">磁碟機故障： RAID 、 RAID DP 和 RAID-TEC</block>
  <block id="a9fffaaf2b1b518afb56ef273736c0c2" category="paragraph">如果發現磁碟機上的資料區塊毀損、或整個磁碟機故障且完全無法使用、則必須重新建立資料。這是在 ONTAP 中使用同位元磁碟機來完成的。資料會在多個資料磁碟機之間進行等量分割、然後產生同位元檢查資料。這會與原始資料分開儲存。</block>
  <block id="54abdf00b7122c16619266482eb09f43" category="paragraph">ONTAP 最初使用 RAID 4 、每組資料磁碟機使用單一同位元檢查磁碟機。結果是群組中的任何一個磁碟機都可能發生故障、而不會導致資料遺失。如果同位元磁碟機故障、則沒有資料受損、也可以建構新的同位元磁碟機。如果單一資料磁碟機故障、其餘磁碟機可與同位元磁碟機搭配使用、以重新產生遺失的資料。</block>
  <block id="6d1ccb512ce2b25e53d90e6d8d459e18" category="paragraph">當磁碟機很小時、同時發生兩個磁碟機故障的統計機率可忽略不計。隨著磁碟機容量的增加、磁碟機故障後重建資料所需的時間也隨之增加。這增加了第二個磁碟機故障會導致資料遺失的時間。此外、重建程序也會在正常運作的磁碟機上建立許多額外的 I/O 。隨著磁碟機老化、導致第二個磁碟機故障的額外負載風險也會增加。最後、即使持續使用 RAID 4 、資料遺失的風險並未增加、資料遺失的後果也會更加嚴重。在 RAID 群組故障時遺失的資料越多、還原資料所需的時間就越長、業務中斷也就越長。</block>
  <block id="caef9e75bcd55d5a9a4ec855b5a6385c" category="paragraph">這些問題導致 NetApp 開發 NetApp RAID DP 技術、這是 RAID 6 的變體。此解決方案包含兩個同位元檢查磁碟機、表示 RAID 群組中的任何兩個磁碟機都可能發生故障、而不會造成資料遺失。磁碟機的大小持續成長、最終導致 NetApp 開發 NetApp RAID-TEC 技術、引進第三個同位元磁碟機。</block>
  <block id="704c2697ee323569003b7b7ea203ae0f" category="paragraph">某些歷史資料庫最佳實務做法建議使用 RAID-10 、也稱為等量鏡射。因為有多個雙磁碟故障案例、因此資料保護功能比 RAID DP 更少、而在 RAID DP 中則沒有。</block>
  <block id="3d0147402d7506d1d3a5227fe447427a" category="paragraph">由於效能考量、有些歷史資料庫最佳實務做法表示 RAID-10 較 RAID-4/5/6 選項更為偏好。這些建議有時是指 RAID 罰款。雖然這些建議一般都是正確的、但不適用於在 ONTAP 中實作 RAID 。效能考量與同位元重生有關。在傳統的 RAID 實作中、處理資料庫執行的例行隨機寫入作業需要多個磁碟讀取才能重新產生同位元資料並完成寫入。其懲罰定義為執行寫入作業所需的額外讀取 IOPS 。</block>
  <block id="84ff015d2df40fc0ebb34485173f39e4" category="paragraph">ONTAP 不會發生 RAID 損失、因為寫入會分段在記憶體中產生同位元檢查、然後以單一 RAID 等量磁碟寫入磁碟。完成寫入作業不需要讀取。</block>
  <block id="b7fe11ecbd8b434a231195335b4894ac" category="paragraph">總而言之、相較於 RAID 10 、 RAID DP 和 RAID-TEC 可提供更多可用容量、更好的磁碟機故障防護、而且不會犧牲效能。</block>
  <block id="e5e0dc0629a299f8e56ebe7de38f49f9" category="section-title">硬體故障保護： NVRAM</block>
  <block id="1db5fde40e489d805029f9d5be6375e7" category="paragraph">任何服務資料庫工作負載的儲存陣列、都必須儘快服務寫入作業。此外、寫入作業也必須受到保護、避免因電源故障等非預期事件而遺失。這表示任何寫入作業都必須安全地儲存在至少兩個位置。</block>
  <block id="ff540b857af868ec85f8f53ddc1f1bd1" category="paragraph">AFF 和 FAS 系統仰賴 NVRAM 來滿足這些需求。寫入程序的運作方式如下：</block>
  <block id="049f2df0de743a6be8d3ec69864f234a" category="list-text">傳入寫入資料儲存在 RAM 中。</block>
  <block id="976be2293c2f4499d079224003644acf" category="list-text">必須對磁碟上的資料所做的變更、會同時記入本機節點和合作夥伴節點上的 NVRAM 。NVRAM 不是寫入快取、而是類似資料庫重做記錄的日誌。在正常情況下、系統不會讀取。它僅用於恢復、例如在 I/O 處理期間發生電源故障後。</block>
  <block id="8ae87ed4a421bec56e020cd0e83bd748" category="list-text">然後寫入會被確認給主機。</block>
  <block id="3a7682bcbb490353074b5ee69e18f01c" category="paragraph">此階段的寫入程序從應用程式的角度來看已完成、而且資料會受到保護、不會遺失、因為資料會儲存在兩個不同的位置。最後、變更會寫入磁碟、但此程序會從應用程式的觀點超出頻外、因為它會在寫入確認之後發生、因此不會影響延遲。此程序再次類似於資料庫記錄。對資料庫的變更會盡快記錄在重做記錄檔中、然後將變更確認為已認可。資料檔案的更新會在稍後進行、不會直接影響處理速度。</block>
  <block id="c17f09622da5f1e0064f7b6a65cb8b01" category="paragraph">如果控制器發生故障、合作夥伴控制器會取得所需磁碟的所有權、並重新執行 NVRAM 中記錄的資料、以恢復發生故障時正在執行的任何 I/O 作業。</block>
  <block id="24e6592d53b3bd56ed8827d2f51bb1ab" category="section-title">硬體故障保護： NVFAIL</block>
  <block id="7965eb54acae120d25d0c77b012b8f90" category="paragraph">如前所述、寫入必須先登入本機 NVRAM 及至少一個其他控制器上的 NVRAM 、才會被確認。此方法可確保硬體故障或停電不會導致機內 I/O 遺失如果本機 NVRAM 故障或連線至 HA 合作夥伴失敗、則無法再鏡射此傳輸中的資料。</block>
  <block id="307b6d3e63c12ada7fbcf75cdda0b574" category="paragraph">如果本機 NVRAM 回報錯誤、節點會關機。此關機會導致容錯移轉至 HA 合作夥伴控制器。由於發生故障的控制器尚未確認寫入作業、因此不會遺失任何資料。</block>
  <block id="6e0c6c8fe69a50581a4ac18acb2c04dd" category="paragraph">除非強制容錯移轉、否則 ONTAP 不允許在資料不同步時進行容錯移轉。以這種方式強制變更條件、即表示資料可能會留在原始控制器中、而且資料遺失是可以接受的。</block>
  <block id="a3961862ed464a06ef6fa4e23935fef2" category="paragraph">如果強制容錯移轉、則資料庫特別容易受損、因為資料庫會在磁碟上保留大量的內部資料快取。如果發生強制容錯移轉、先前確認的變更將會有效捨棄。儲存陣列的內容會有效地及時向後跳轉、而且資料庫快取的狀態不再反映磁碟上資料的狀態。</block>
  <block id="b46ce3019d702ee3ece327e5df990be0" category="paragraph">為了保護資料不受這種情況影響、 ONTAP 允許設定磁碟區、以針對 NVRAM 故障提供特殊保護。觸發時、此保護機制會導致磁碟區進入稱為 NVFAIL 的狀態。此狀態會導致 I/O 錯誤、導致應用程式關機、使其不使用過時的資料。資料不應遺失、因為儲存陣列上應該存在任何已確認的寫入資料。</block>
  <block id="322e1f85910dfc206274f8bd58a54a9d" category="list-text">指定站台上的每組磁碟機都會自動設定為一個或多個完全備援的 RAID-DP 或 RAID-TEC 群組、而不受鏡像的使用影響。即使在站台遺失之後、也能提供持續的資料保護。</block>
  <block id="dee2dfce5ab0c47301b3c12970a57aa6" category="paragraph">上圖說明 SyncMirror 組態範例。在控制器上建立了 24 個磁碟機的集合體、其中 12 個磁碟機來自於站台 A 上配置的機櫃、 12 個磁碟機來自於站台 B 上配置的機櫃磁碟機分為兩個鏡射 RAID 群組。RAID 群組 0 包括站台 A 上的 6 磁碟機叢、鏡射到站台 B 上的 6 磁碟機叢同樣地、 RAID Group 1 也包含站台 A 的 6 磁碟叢、鏡射到站台 B 的 6 磁碟叢叢</block>
  <block id="4fbc0abe91c0c1381d0a742f58b4e537" category="paragraph">SyncMirror 通常用於提供 MetroCluster 系統的遠端鏡射、每個站台都有一份資料複本。有時候、它是用來在單一系統中提供額外的備援層級。特別是提供機架層級的備援。磁碟機櫃已包含雙電源供應器和控制器、整體上比金屬板稍多、但在某些情況下、可能需要額外的保護。例如、有一位 NetApp 客戶部署 SyncMirror 、用於汽車測試期間使用的行動即時分析平台。系統由獨立的 UPS 系統提供獨立的電源供應器、分為兩個實體機架。</block>
  <block id="0cac56685de94a3ef0e1fd2bfca0c112" category="paragraph">對於習慣使用 Oracle RMAN 串流備份的 DBA 來說、檢查和主題特別重要、因為它們會移轉至快照型備份。RMAN 的一項功能是在備份作業期間執行完整性檢查。雖然這項功能有一些價值、但其主要優點是資料庫並未用於現代化的儲存陣列。當實體磁碟機用於 Oracle 資料庫時、幾乎可以確定磁碟機老化時最終會發生毀損、這是由真正儲存陣列中的陣列型校驗和所解決的問題。</block>
  <block id="8b7b33533c2b36c157a0a482bdd52a8e" category="paragraph">Oracle 資料檔案和重做記錄架構也設計成即使在極端情況下、也能提供最高程度的資料完整性。在最基本的層級、 Oracle 區塊幾乎包含每個 I/O 的 Checksum 和基本邏輯檢查如果 Oracle 尚未當機或將資料表空間離線、則資料會保持不變。資料完整性檢查的程度可調整、 Oracle 也可設定為確認寫入。因此、幾乎所有的當機和故障情況都可以恢復、而且在極罕見的不可恢復情況下、系統會立即偵測到毀損。</block>
  <block id="4066c36b811913c85aa86346e30cee4d" category="paragraph">大多數使用 Oracle 資料庫的 NetApp 客戶在移轉至快照型備份後、都會停止使用 RMAN 和其他備份產品。仍有一些選項可讓 RMAN 使用 SnapCenter 執行區塊層級的還原。然而、日常使用的 RMAN 、 NetBackup 及其他產品只會偶爾用於建立每月或每季的歸檔複本。</block>
  <block id="d0cf0e689669c61d564607d2ef7deb79" category="paragraph">有些客戶選擇執行<block ref="d308cbfce7e270e5b41a84d84385645f" prefix=" " category="inline-code"></block> 定期對現有資料庫執行完整性檢查。NetApp 不鼓勵這種做法、因為它會產生不必要的 I/O 負載。如上所述、如果資料庫先前沒有遇到問題、就有可能發生<block ref="d308cbfce7e270e5b41a84d84385645f" prefix=" " category="inline-code"></block> 偵測問題接近零、此公用程式會在網路和儲存系統上產生非常高的連續 I/O 負載。除非有理由相信存在毀損、例如暴露於已知的 Oracle 錯誤、否則沒有理由執行<block ref="d308cbfce7e270e5b41a84d84385645f" prefix=" " category="inline-code"></block>。</block>
  <block id="431bbcf828b8d3513280cb1207824991" category="doc">Oracle Storage Snapshot 最佳化備份</block>
  <block id="c9447fe684870cf68e9cb4f23f44db43" category="paragraph">雖然 DBA 較熟悉熱備份還原程序、但很長一段時間以來、它仍能使用資料庫處於熱備份模式時未建立的快照。恢復期間、 Oracle 10g 和 11g 需要額外的手動步驟、才能使資料庫保持一致。使用 Oracle 12c 、<block ref="a84f4f3da79386c29ab6dfa560af786e" prefix=" " category="inline-code"></block> 和<block ref="075b7d3bd3bbe7767f7ef62f430bc22b" prefix=" " category="inline-code"></block> 包含額外的邏輯、可在非熱備份模式的資料檔案備份上重播歸檔記錄。</block>
  <block id="5c7dba68615d3fa5c4c90a36dab57bcb" category="paragraph">如前所述、復原快照型熱備份需要兩組資料：</block>
  <block id="50a7086972cada154c8164dc1c6b3539" category="list-text">在備份模式下建立的資料檔案快照</block>
  <block id="c72d009669a638aab75c21a28a2101de" category="list-text">資料檔案處於熱備份模式時所產生的歸檔記錄</block>
  <block id="b8de4b1201e5595bc3de878f2bf59d9b" category="paragraph">在還原期間、資料庫會從資料檔案讀取中繼資料、以選取所需的歸檔記錄進行還原。</block>
  <block id="66ee0a6fd90f3cfab8320e1de1341cbd" category="paragraph">儲存快照最佳化的還原需要稍微不同的資料集、才能達到相同的結果：</block>
  <block id="6030a1d9761fca3806ef0a0329438071" category="list-text">資料檔案的快照、加上一種識別快照建立時間的方法</block>
  <block id="4e822d4c19600b654f176d335c158829" category="list-text">從最新資料檔案檢查點的時間到快照的確切時間、都會歸檔記錄檔</block>
  <block id="604432b50055c69f34df17a8ed5befb5" category="paragraph">在還原期間、資料庫會從資料檔案讀取中繼資料、以識別所需的最早歸檔記錄。可以執行完整或時間點恢復。執行時間點還原時、必須知道資料檔案快照的時間。指定的恢復點必須在快照建立時間之後。NetApp 建議您在快照時間中加入至少幾分鐘、以因應時鐘變化。</block>
  <block id="08bfe39c49a2dc07b08bd2ccd77d8281" category="paragraph">如需完整的詳細資料、請參閱 Oracle 各版本的 Oracle 12c 說明文件中有關「使用儲存 Snapshot 最佳化進行恢復」主題的 Oracle 文件。此外、請參閱 Oracle 文件 ID 文件 ID 604683.1 、瞭解 Oracle 協力廠商快照支援。</block>
  <block id="d22a890163762fcf7a4cb7605c29b7e6" category="section-title">資料配置</block>
  <block id="6a7fc1f74262f6973420f4fc849ba7f7" category="paragraph">最簡單的配置是將資料檔案隔離為一個或多個專用磁碟區。它們必須不受任何其他檔案類型的污染。這是為了確保資料檔案磁碟區可以透過 SnapRestore 作業快速還原、而不會破壞重要的重做記錄檔、控制檔或歸檔記錄檔。</block>
  <block id="ff6fb5d2136ab516e182f4b23f45886d" category="paragraph">SAN 對專用磁碟區內的資料檔案隔離有類似的需求。在 Microsoft Windows 等作業系統中、單一磁碟區可能包含多個資料檔案 LUN 、每個 LUN 都有 NTFS 檔案系統。在其他作業系統中、通常也會有邏輯 Volume Manager 。例如、使用 Oracle ASM 時、最簡單的選項是將磁碟群組限制在單一磁碟區、以便作為一個單元進行備份和還原。如果基於效能或容量管理的理由而需要額外的磁碟區、則在新磁碟區上建立額外的磁碟群組、將可更輕鬆地進行管理。</block>
  <block id="a06956ba6de69aec2dc2b015074e5821" category="paragraph">如果遵循這些準則、則可直接在 ONTAP 上排程快照、而無需執行一致性群組快照。原因是快照最佳化備份不需要同時備份資料檔案。</block>
  <block id="9e422c12420f1bd8c73e3c0f63da55e9" category="paragraph">在 ASM 磁碟群組等情況下、會發生複雜的情況、而 ASM 磁碟群組會分散在不同的磁碟區中。在這種情況下、必須執行 CG 快照、以確保 ASM 中繼資料在所有組成磁碟區之間一致。</block>
  <block id="7a7969d6a47ed242c25f6a38f2da0e36" category="paragraph">[ 注意 ] 確認 ASM spfile 和 passwd 檔案不在主控資料檔案的磁碟群組中。這會影響選擇性還原資料檔案和僅還原資料檔案的能力。</block>
  <block id="12eb3ceede91a01c74368e0fab03dbe4" category="section-title">本機恢復程序— NFS</block>
  <block id="e1a03fcc478ae212f07b5044b11ff369" category="paragraph">此程序可以手動或透過 SnapCenter 等應用程式來驅動。基本程序如下：</block>
  <block id="abb0083d6ab87bbe9d906632fea121ae" category="list-text">在所需還原點之前、立即將資料檔案磁碟區復原至快照。</block>
  <block id="3450fe1e1eea00fa55cfb5cb835a3d80" category="paragraph">此程序假設所需的歸檔記錄檔仍存在於作用中的檔案系統中。如果沒有、則必須還原歸檔記錄、或<block ref="075b7d3bd3bbe7767f7ef62f430bc22b" prefix=" " category="inline-code"></block> 或<block ref="a84f4f3da79386c29ab6dfa560af786e" prefix=" " category="inline-code"></block> 可導向至中的資料<block ref="a15da8cecb1f1192c4d913b8ba676121" prefix=" " category="inline-code"></block> 目錄。</block>
  <block id="e43e33171833b26f6b024d28cb8b1afd" category="paragraph">此外、對於較小的資料庫、終端使用者可以直接從中復原資料檔案<block ref="a15da8cecb1f1192c4d913b8ba676121" prefix=" " category="inline-code"></block> 無需自動化工具或儲存管理員協助執行 SnapRestore 命令的目錄。</block>
  <block id="097230f6ad5345abbe261eabbf533a68" category="section-title">本機恢復程序— SAN</block>
  <block id="4e3110543ebf2a771c16b3b2101f1f88" category="list-text">將託管資料檔案的磁碟群組置於系統中。此程序會因所選的邏輯磁碟區管理程式而異。使用 ASM 時、此程序需要卸除磁碟群組。在 Linux 中、必須卸除檔案系統、並停用邏輯磁碟區和磁碟區群組。目標是停止要還原之目標 Volume 群組上的所有更新。</block>
  <block id="1d0ecd206531f96737f8e8002be4a047" category="list-text">在所需還原點之前、立即將資料檔案磁碟群組還原至快照。</block>
  <block id="946fe41f610ab658e270a1844c992bcc" category="list-text">重新啟動新還原的磁碟群組。</block>
  <block id="c21d8f41541fc2a0259e7ea5e51edac3" category="paragraph">此程序假設所需的歸檔記錄檔仍存在於作用中的檔案系統中。如果沒有、則必須將歸檔記錄 LUN 離線並執行還原、以還原歸檔記錄。這也是將歸檔記錄分割成專用磁碟區的範例。如果歸檔記錄與重做記錄共用磁碟區群組、則必須在還原整體 LUN 組之前、將重做記錄複製到其他位置、以免遺失最終記錄的交易。</block>
  <block id="3fd5b2a08b3d7c4db29da8590ef6013f" category="section-title">完整恢復範例</block>
  <block id="31679daa394b7091acfd728d940b7322" category="paragraph">假設資料檔案已毀損或毀損、且需要完整還原。執行程序如下：</block>
  <block id="aa09ca247daac25fc18c2633124ca9b6" category="section-title">時間點恢復範例</block>
  <block id="935ff627038d1f5001220c8df7f0e1b9" category="paragraph">整個恢復過程只需一個命令：<block ref="3df448f0a5ec82cac76d91ba14c0fa1d" prefix=" " category="inline-code"></block>。</block>
  <block id="dcd27cf8b8ceae2cd84c898d3c1b9fdb" category="paragraph">如果需要時間點恢復、則必須知道快照的時間戳記、並可識別如下：</block>
  <block id="17108ef3ad2e1e613b844beb5f2c6d29" category="paragraph">快照建立時間列於 3 月 9 日和 10 ： 10 ： 06 。為了安全起見、快照時間會增加一分鐘：</block>
  <block id="904b0a17b003c70e398ea85996f0f9ba" category="paragraph">恢復作業現在已啟動。它指定的快照時間為 10 ： 11 ： 00 、記錄時間後一分鐘、以計算可能的時鐘差異、目標恢復時間為 10 ： 44 。接下來、 sqlplus 會要求所需的歸檔記錄檔、以達到所需的 10 ： 44 恢復時間。</block>
  <block id="91f99c5ad04365fb4d00e509963e2a0c" category="admonition">使用來完成資料庫的快照還原<block ref="3df448f0a5ec82cac76d91ba14c0fa1d" prefix=" " category="inline-code"></block> 命令不需要特定授權、而是使用時間點還原<block ref="72104026d9850e8c478c23b2e2e4e8e9" prefix=" " category="inline-code"></block> 需要 Oracle 進階壓縮授權。</block>
  <block id="9173402b63dc5f55506a692258f185e8" category="doc">SnapCenter 和其他工具</block>
  <block id="5459c1727c923baa303ff472498dbe97" category="paragraph">在某些情況下、直接在 ONTAP 上簡單設定這些核心功能即可滿足需求、但更複雜的需求則需要協調層。</block>
  <block id="aeeb3212c35c26d321183e81d4926e57" category="paragraph">SnapCenter 是 NetApp 資料保護的旗艦產品。在極低的層級上、它與 SnapManager 產品在執行資料庫備份的方式上類似、但它是從頭開始打造、提供單一窗口來管理 NetApp 儲存系統上的資料保護。</block>
  <block id="50780f47f6839d47d60bc4555ee00c3f" category="section-title">休息</block>
  <block id="a0bac638f30c704da8e03aba136da86d" category="paragraph">ONTAP 也包含豐富的 RESTful API 集。這可讓協力廠商建立資料保護及其他管理應用程式、並與 ONTAP 進行深度整合。此外、想要建立自己的自動化工作流程和公用程式的客戶也能輕鬆使用 RESTful API 。</block>
  <block id="a3b43ae3d4028e3c7ccac3d5720e9fb0" category="paragraph">在備份模式中保護和恢復 Oracle 資料庫需要兩組資料。請注意、這不是唯一的 Oracle 備份選項、而是最常見的選項。</block>
  <block id="8e523970ff7c41dba74e723511d14717" category="list-text">備份模式中資料檔案的快照</block>
  <block id="deeddf207b1a29c63ae7c1943f90f3d9" category="list-text">資料檔案處於備份模式時所建立的歸檔記錄</block>
  <block id="fa1229103a2e02a4ed8790098c98f71f" category="paragraph">如果需要完整恢復（包括所有已提交的交易）、則需要第三個項目：</block>
  <block id="7c11b244c2549a2cc477c134ec4c5635" category="list-text">一組目前的重做記錄</block>
  <block id="8522faf14bc9d4ab497945bb48adc870" category="paragraph">有許多方法可以推動線上備份的還原。許多客戶使用 ONTAP CLI 還原快照、然後使用 Oracle RMAN 或 sqlplus 來完成還原。這在大型正式作業環境中尤其常見、因為資料庫還原的可能性和頻率極低、而且任何還原程序都是由熟練的 DBA 來處理。為了實現完整的自動化、 NetApp SnapCenter 等解決方案包含 Oracle 外掛程式、其中包含命令列和圖形介面。</block>
  <block id="f88f41d4801183a5d53a4b71f383d144" category="paragraph">有些大型客戶已在主機上設定基本指令碼、以便在特定時間將資料庫置於備份模式、以準備排程的快照、藉此採取更簡單的方法。例如、排程命令<block ref="56f72994c4cc84b13a4c20dab49fea35" prefix=" " category="inline-code"></block> 23 時 58 分、<block ref="84c8391d82cbfe300a9615844e0a167f" prefix=" " category="inline-code"></block> 於 00 ： 02 、然後於午夜直接在儲存系統上排程快照。如此一來、就能實現簡單易用、擴充性極高的備份策略、無需外部軟體或授權。</block>
  <block id="719fbeb74939b8c065321f175de3d222" category="paragraph">最簡單的配置是將資料檔案隔離到一個或多個專用磁碟區。它們必須不受任何其他檔案類型的污染。這是為了確保資料檔案磁碟區可以透過 SnapRestore 作業快速還原、而不會破壞重要的重做記錄檔、控制檔或歸檔記錄。</block>
  <block id="19156bdcbf322e8e3189909bbb7a69e8" category="paragraph">SAN 對專用磁碟區內的資料檔案隔離有類似的需求。在 Microsoft Windows 等作業系統中、單一磁碟區可能包含多個資料檔案 LUN 、每個 LUN 都有 NTFS 檔案系統。在其他作業系統中、通常會有邏輯 Volume Manager 。例如、使用 Oracle ASM 時、最簡單的選項是將 ASM 磁碟群組的 LUN 限制在單一磁碟區、以便作為一個單元進行備份和還原。如果基於效能或容量管理的理由而需要額外的磁碟區、則在新磁碟區上建立額外的磁碟群組、將可簡化管理。</block>
  <block id="993afa8643b7200c5c9e527c24c1d8b2" category="paragraph">如果遵循這些準則、則可直接在儲存系統上排程快照、而無需執行一致性群組快照。原因是 Oracle 備份不需要同時備份資料檔案。線上備份程序旨在讓資料檔案在數小時內緩慢串流至磁帶、因此能夠繼續更新。</block>
  <block id="a2ea5ea024e4a68e4d7f4abeca3441a1" category="paragraph">在使用分佈於不同磁碟區的 ASM 磁碟群組等情況下、會產生複雜性。在這種情況下、必須執行 CG 快照、以確保 ASM 中繼資料在所有組成磁碟區之間一致。</block>
  <block id="0a3ecb97c1b7c97e5075bae0daaa45aa" category="paragraph">* 注意： * 驗證 ASM<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block> 和<block ref="76a2173be6393254e72ffa4d6df1030a" prefix=" " category="inline-code"></block> 檔案不在主控資料檔案的磁碟群組中。這會影響選擇性還原資料檔案和僅還原資料檔案的能力。</block>
  <block id="2f8a5e254c86a42ebcc8b7d3c84cd22e" category="paragraph">此程序假設所需的歸檔記錄檔仍存在於作用中的檔案系統中。如果沒有、則必須還原歸檔記錄、或將 RMAN/sqlplus 導向快照目錄中的資料。</block>
  <block id="a67a69f712a877950e94edd27310b40e" category="paragraph">此外、對於較小的資料庫、終端使用者可以直接從中復原資料檔案<block ref="a15da8cecb1f1192c4d913b8ba676121" prefix=" " category="inline-code"></block> 目錄、無需自動化工具或儲存管理員協助執行<block ref="a4c0ce4da6fb04943b499690fb3afd6e" prefix=" " category="inline-code"></block> 命令。</block>
  <block id="6da8ebf3245e4fbe4654e7f92f0330d7" category="list-text">將託管資料檔案的磁碟群組置於系統中。此程序會因所選的邏輯磁碟區管理程式而異。使用 ASM 時、此程序需要卸除磁碟群組。在 Linux 中、必須卸除檔案系統、且必須停用邏輯磁碟區和磁碟區群組。目標是停止要還原之目標 Volume 群組上的所有更新。</block>
  <block id="931ab211ac6773d20c03a998f9f921ce" category="list-text">如果需要完整還原、請重新播放所有重做記錄。</block>
  <block id="b6575c3fca5eaaa56eeb8e9ce8867f05" category="paragraph">此程序假設所需的歸檔記錄檔仍存在於作用中的檔案系統中。如果沒有、則必須將歸檔記錄 LUN 離線並執行還原、以還原歸檔記錄。這也是將歸檔記錄分割成專用磁碟區的範例。如果歸檔記錄與重做記錄共用一個磁碟區群組、則必須先將重做記錄複製到其他位置、才能還原整個 LUN 集。此步驟可防止這些最終記錄的交易遺失。</block>
  <block id="65fd6f7f97414140b4d6060b743dc645" category="paragraph">這些需求包括恢復速度、最大允許資料遺失量、以及備份保留需求等因素。資料保護計畫也必須考量資料保留與還原的各種法規要求。最後、必須考量不同的資料恢復情境、從使用者或應用程式錯誤所造成的典型和可預見的恢復、到包括站點完全遺失的災難恢復情境。</block>
  <block id="2bd1d35ff88de136066c33905c0fd677" category="paragraph">資料保護與還原原則的細微變更、可能會對儲存、備份與還原的整體架構造成重大影響。在開始設計工作之前、務必先定義並記錄標準、以免資料保護架構複雜化。不必要的功能或保護層級會導致不必要的成本和管理成本、而最初忽略的需求可能導致專案方向錯誤、或是需要最後一分鐘的設計變更。</block>
  <block id="a60e6b87ede45aef49d8d095435db22b" category="section-title">恢復時間目標</block>
  <block id="3d3b341e14c584d1edcea9fe13619ee1" category="paragraph">恢復時間目標（ RTO ）定義了恢復服務所允許的最長時間。例如、人力資源資料庫的 RTO 可能為 24 小時、因為雖然在工作天內無法存取這些資料、但企業仍可繼續營運。相反地、支援銀行總分類帳的資料庫、其 RTO 會以分鐘甚至秒為單位來衡量。RTO 為零是不可能的、因為必須有辦法區分實際服務中斷和例行事件、例如遺失的網路封包。然而、典型的要求是接近零的 RTO 。</block>
  <block id="5a27873285a0397cc06f9f47280c9426" category="section-title">恢復點目標</block>
  <block id="f3ae061e139f47d793058ee596a5243f" category="paragraph">恢復點目標（ RPO ）定義了最大可容忍的資料遺失量。在許多情況下、 RPO 完全取決於快照或 SnapMirror 更新的頻率。</block>
  <block id="2d68fbd3cefeb34bfd64c8f89caba64d" category="paragraph">在某些情況下、 RPO 可能會變得更具侵略性、因此可選擇性地更頻繁地保護某些資料。在資料庫內容中、 RPO 通常是在特定情況下可能遺失多少記錄資料的問題。在資料庫因產品錯誤或使用者錯誤而受損的典型還原案例中、 RPO 應為零、表示不應有資料遺失。恢復程序包括還原較早的資料庫檔案複本、然後重新播放記錄檔、將資料庫狀態提升至所需的時間點。此作業所需的記錄檔應已在原始位置中。</block>
  <block id="57df8b025934bcd0f7e96bae19cf0688" category="paragraph">在不尋常的情況下、記錄資料可能會遺失。例如、意外或惡意<block ref="4609acba202877f99742342f4195d95e" prefix=" " category="inline-code"></block> 資料庫檔案可能會導致刪除所有資料。唯一的選擇是從備份還原、包括記錄檔、有些資料必然會遺失。在傳統備份環境中改善 RPO 的唯一選項是執行記錄資料的重複備份。然而、由於資料持續移動、而且難以將備份系統維持為持續運作的服務、因此這項功能也有其侷限性。進階儲存系統的優點之一、就是能夠保護資料、避免意外或惡意損壞檔案、進而在不移動資料的情況下提供更好的 RPO 。</block>
  <block id="3d08c71e26ac92e34925e02570c4bd22" category="paragraph">災難恢復包括在發生實體災難時恢復服務所需的 IT 架構、原則和程序。這可能包括洪水、火災或惡意或疏忽意圖的人。</block>
  <block id="78f4e749ec0c6bb2627abbbc00bce296" category="paragraph">災難恢復不只是一套恢復程序。這是識別各種風險、定義資料恢復和服務持續性需求、以及提供適當架構及相關程序的完整程序。</block>
  <block id="75bcd60b234aba82b5827cd7a5171563" category="paragraph">在建立資料保護需求時、必須區分典型的 RPO 和 RTO 需求、以及災難恢復所需的 RPO 和 RTO 需求。有些應用程式環境需要零 RPO 和近乎零的 RTO 、才能因應資料遺失的情況、從相對正常的使用者錯誤到破壞資料中心的火災。然而、這些高層級的保護措施會產生成本和管理上的後果。</block>
  <block id="756651fea87d05811d7a42451d074b60" category="paragraph">一般而言、非災難性資料恢復需求應嚴格、原因有兩個。首先、應用程式錯誤和使用者錯誤會導致資料受損、幾乎是不可避免的。其次、只要儲存系統未遭銷毀、就不難設計出可提供零 RPO 和低 RTO 的備份策略。沒有理由不解決容易補救的重大風險、這就是為何用於本機恢復的 RPO 和 RTO 目標應該積極主動的原因。</block>
  <block id="cb6faee28dd34d25f06bd0b33abe1c2f" category="paragraph">災難恢復 RTO 和 RPO 需求因災難可能性及相關資料遺失或業務中斷所造成的後果而異。RPO 和 RTO 需求應以實際業務需求為基礎、而非一般原則。他們必須考慮多種邏輯和實體災難案例。</block>
  <block id="68f31611fc8a5e6a20793905280a7001" category="section-title">邏輯災難</block>
  <block id="07f5727077caaf8dedf895542181d26b" category="paragraph">邏輯災難包括使用者、應用程式或作業系統錯誤所造成的資料毀損、以及軟體故障。邏輯災難也可能包括由外部人士利用病毒或蠕蟲或利用應用程式弱點發動的惡意攻擊。在這些情況下、實體基礎架構並未受損、但基礎資料已不再有效。</block>
  <block id="3cb5ee5f24e42f56ba6dac48b7b046d2" category="paragraph">越來越常見的邏輯災難類型稱為勒索軟體、其中攻擊模式是用來加密資料。加密不會損壞資料、但會在付款給第三方之前無法使用。越來越多的企業被勒索軟體攻擊的目標鎖定。針對此威脅、 NetApp 提供防竄改快照、即使儲存管理員也無法在設定的到期日之前變更受保護的資料。</block>
  <block id="91c87f53ce0a1f416308a67ce119c623" category="section-title">實體災難</block>
  <block id="79055ca11f54a97d22617a656eab8b9b" category="paragraph">實體災難包括基礎架構元件故障、其超過備援功能、導致資料遺失或服務延長中斷。例如、 RAID 保護可提供磁碟機備援、而使用 HBA 則可提供 FC 連接埠和 FC 纜線備援。這類元件的硬體故障是可預見的、不會影響可用度。</block>
  <block id="3f7c55fe5f35f94cd2c4bd73b9cbb11b" category="paragraph">在企業環境中、通常可以使用備援元件來保護整個站台的基礎架構、直到唯一可預見的實體災難案例完全遺失站台為止。災難恢復規劃則取決於站台對站台的複寫。</block>
  <block id="7f3dd7bdd41f7af6853732a383bbd7e2" category="section-title">同步與非同步資料保護</block>
  <block id="c5ac17d5693914368f39b40a07af23d4" category="paragraph">在理想的環境中、所有資料都會在地理上分散的站台之間同步複寫。這類複寫不一定可行、甚至可能、原因有幾個：</block>
  <block id="28c59a675d03e1f62a48958bb53ae523" category="list-text">同步複寫不可避免地會增加寫入延遲、因為所有變更都必須複寫到兩個位置、應用程式 / 資料庫才能繼續處理。因此產生的效能影響有時是不可接受的、無法使用同步鏡射。</block>
  <block id="50a05ceeb998c4dac7e8b5d706fe2029" category="list-text">100% SSD 儲存設備的採用率增加、意味著更有可能注意到額外的寫入延遲、因為效能期望包括數十萬 IOPS 和低於毫秒的延遲。若要充分發揮 100% SSD 的效益、可能需要重新規劃災難恢復策略。</block>
  <block id="04d90fe6288ce6cceba54a2b71e55727" category="list-text">資料集會繼續以位元組為單位增加、因此必須確保足夠的頻寬來維持同步複寫、因此會產生挑戰。</block>
  <block id="d3aaae220bd5b3d68dd4ccec3bf78197" category="list-text">資料集的複雜度也隨之增加、管理大規模同步複寫也會帶來挑戰。</block>
  <block id="c3a841e0bfc640f91b0a00c4af8c6f5c" category="list-text">雲端型策略通常需要較長的複寫距離和延遲、進一步排除同步鏡射的使用。</block>
  <block id="7df1515e247dfa2063c433b9339c2d4a" category="paragraph">NetApp 提供的解決方案包括同步複寫、可滿足最嚴苛的資料恢復需求、並可提供更優異的效能與靈活度的非同步解決方案。此外、 NetApp 技術也能與許多第三方複寫解決方案無縫整合、例如 Oracle DataGuard</block>
  <block id="4d2c802af835583121763e1a6acc3f9b" category="section-title">保留時間</block>
  <block id="123dbb4c09a5c8fb993a856cf65c9d25" category="paragraph">資料保護策略的最後一個層面是資料保留時間、這可能會大幅改變。</block>
  <block id="d3a424909a8559a2d076e5d9a28d834f" category="list-text">一般要求是在主要站台上進行 14 天夜間備份、以及儲存在次要站台上的 90 天備份。</block>
  <block id="1d7c2d97c3bfd5ca9489e0ffeb06b150" category="list-text">許多客戶會建立獨立的季度歸檔、儲存在不同的媒體上。</block>
  <block id="61ae175e4a0c88c4624184a0cb9b04d2" category="list-text">持續更新的資料庫可能不需要歷史資料、而備份只需保留幾天。</block>
  <block id="8bb85c2149e1e808032e7025b0a27b80" category="list-text">法規要求可能需要在 365 天內恢復任何任意交易的點。</block>
  <block id="05280349760feacdd6227fb8012e39d7" category="doc">快照型備份</block>
  <block id="a4c2aeedbfeeda21f232cbf45be91693" category="paragraph">關鍵值如下：</block>
  <block id="d06c89cff665ecdde6eded3c9d44cd2b" category="list-text">* 簡易性。 * 快照是特定時間點資料容器內容的唯讀複本。</block>
  <block id="175888ba89c31a851f719bdd271cae9c" category="list-text">* 效率。 * 快照在建立時不需要任何空間。只有在資料變更時才會使用空間。</block>
  <block id="d853e9e275a6e58b3a9a56fa641cbb9f" category="list-text">* 管理能力。 * 由於快照是儲存作業系統的原生部分、因此以快照為基礎的備份策略很容易設定和管理。如果儲存系統已開機、就可以開始建立備份。</block>
  <block id="b564e5fbab71af776ed54a19d09b268c" category="list-text">* 擴充性。 * 最多可保留 1024 個檔案和 LUN 的單一容器備份。對於複雜的資料集、可透過一組一致的快照來保護多個資料容器。</block>
  <block id="7159872a568b97a971b9ea182fb23b7c" category="list-text">無論磁碟區包含 1024 個快照或無、效能都不會受到影響。</block>
  <block id="1a54f7e14e6e652bb32b12df22faf387" category="paragraph">雖然許多儲存廠商都提供快照技術、但 ONTAP 中的 Snapshot 技術是獨一無二的、可為企業應用程式和資料庫環境帶來顯著效益：</block>
  <block id="d77b23e355dc2f65b90fb52ed9a90f9c" category="list-text">Snapshot 複本是基礎 Write -Anywhere File Layout （ WAFL ）的一部分。它們不是附加技術或外部技術。這簡化了管理、因為儲存系統是備份系統。</block>
  <block id="8b888e6a2d883c0111428c101532294a" category="list-text">快照複本不會影響效能、但某些邊緣情況除外、例如當基礎儲存系統填滿的快照中儲存了大量資料時。</block>
  <block id="2283ea50a243a5d1ad551f7d21f39895" category="list-text">「一致性群組」一詞通常是指一組儲存物件、這些物件是以一致的資料集合來管理。特定 ONTAP 磁碟區的快照構成一致性群組備份。</block>
  <block id="ac72c83a8204d600d567261b41c5488c" category="paragraph">ONTAP 快照的擴充能力也優於競爭技術。客戶可以儲存 5 、 50 或 500 個快照、而不會影響效能。磁碟區目前允許的最大快照數為 1024 。如果需要額外的快照保留、則有選項可將快照串聯至其他磁碟區。</block>
  <block id="3b7ff39ba50f1bc3f56d38c41ba51855" category="paragraph">因此、保護託管在 ONTAP 上的資料集非常簡單且具有高度擴充性。備份不需要移動資料、因此備份策略可以根據業務需求量身打造、而非限制網路傳輸率、大量磁帶機或磁碟接移區域。</block>
  <block id="55c5bbb3aad88266600eaa1a526406d4" category="paragraph">將快照當作資料保護策略使用的常見問題之一、就是「真實」資料和快照資料位於同一個磁碟機上。遺失這些磁碟機將會導致主要資料和備份遺失。</block>
  <block id="68870deb35eeb53373325a314030bd11" category="paragraph">然而、本機快照不應是唯一的備份策略、因此 NetApp 提供 SnapMirror 和 SnapVault 複寫等技術、可快速有效地將快照複寫至一組不同的磁碟機。在架構正確的解決方案中、快照加上快照複寫功能可將磁帶的使用降至最低、甚至是每季歸檔、或完全消除。</block>
  <block id="73d3fd255835ca3dc926f59d50223f91" category="paragraph">使用 ONTAP Snapshot 複本保護資料有許多選項、快照是許多其他 ONTAP 功能的基礎、包括複寫、災難恢復和複製。快照技術的完整說明不在本文件的範圍內、但以下各節提供一般概觀。</block>
  <block id="7441577327d1d49b71cc2f6403e17e7b" category="paragraph">建立資料集快照的主要方法有兩種：</block>
  <block id="b38ba43128207852ef5149e6c578ba89" category="list-text">損毀一致的備份</block>
  <block id="dc64a2f6075820724476e435a1ebd7fa" category="list-text">應用程式一致的備份</block>
  <block id="32561979f55bc68c4f028fd26a9975f6" category="paragraph">當備份點還原足夠時、主要會使用損毀一致的備份。當需要更精細的恢復時、通常需要應用程式一致的備份。</block>
  <block id="367735591e5e6e04c17b7930acb29b7d" category="paragraph">「應用程式一致性」一詞通常是錯誤的。例如、將 Oracle 資料庫置於備份模式稱為應用程式一致的備份、但資料並未以任何方式保持一致或停止。資料會在整個備份過程中持續變更。相反地、大部分的 MySQL 和 Microsoft SQL Server 備份確實會在執行備份之前先將資料關閉。VMware 可能會或可能不會使某些檔案一致。</block>
  <block id="ebf90723e7659cb5381545104b618612" category="paragraph">術語「一致性群組」是指儲存陣列將多個儲存資源視為單一映像來管理的能力。例如、資料庫可能包含 10 個 LUN 。陣列必須能夠以一致的方式備份、還原及複寫這 10 個 LUN 。如果 LUN 的映像在備份時不一致、則無法還原。複寫這 10 個 LUN 需要所有複本彼此完全同步。</block>
  <block id="3f8a43f1defaa984435092f616876545" category="paragraph">討論 ONTAP 時、「一致性群組」一詞並不常使用、因為一致性一向是 ONTAP 內 Volume 和 Aggregate 架構的基本功能。許多其他儲存陣列會將 LUN 或檔案系統視為個別單元進行管理。接著可選擇性地將它們設定為「一致性群組」、以保護資料、但這是組態中的額外步驟。</block>
  <block id="74e816c3c784f5c30c79dca4590d7f59" category="paragraph">ONTAP 一向能夠擷取一致的本機和複寫資料映像。雖然 ONTAP 系統上的各種磁碟區通常並未正式描述為一致性群組、但這就是它們的名稱。該磁碟區的快照是一致性群組映像、該快照的還原是一致性群組還原、 SnapMirror 和 SnapVault 都提供一致性群組複寫。</block>
  <block id="15cc4389a08c3f4748e98622e630ad3e" category="section-title">一致性群組快照</block>
  <block id="d286b747757ef3d8d3abac27bfae65f9" category="paragraph">一致性群組快照（ CG 快照）是基本 ONTAP Snapshot 技術的延伸。標準快照作業可在單一磁碟區內建立所有資料的一致映像、但有時必須在多個磁碟區甚至跨多個儲存系統建立一致的快照集。結果是一組快照、其使用方式與只有一個個別磁碟區的快照相同。它們可用於本機資料還原、複寫以進行災難恢復、或複製為單一一致的單元。</block>
  <block id="7c199465bc6344e648e2f73c88131605" category="paragraph">CG 快照的最大已知用途是資料庫環境、其大小約為 1PB 、跨越 12 個控制器。在此系統上建立的 CG 快照已用於備份、恢復和複製。</block>
  <block id="e5c199b4a97409f33d5caae984957744" category="paragraph">大多數情況下、當資料集跨越磁碟區且必須保留寫入順序時、所選管理軟體會自動使用 CG 快照。在此情況下、無需瞭解 CG 快照的技術詳細資料。然而、在某些情況下、複雜的資料保護需求需要對資料保護和複寫程序進行詳細控制。自動化工作流程或使用自訂指令碼來呼叫 CG 快照 API 是其中的一些選項。若要瞭解最佳選項和 CG-snapshot 的角色、需要更詳細的技術說明。</block>
  <block id="cf3c30ea5c240a8aef02d240f42cdff7" category="paragraph">建立一組 CG 快照是兩個步驟：</block>
  <block id="f30455406a91bd776afbc88e60b9697e" category="list-text">在所有目標磁碟區上建立寫入屏障。</block>
  <block id="c7afe45d94f2fd172a01e851d7f92a2f" category="list-text">在圍籬狀態下建立這些磁碟區的快照。</block>
  <block id="c464d4671e489eaad9a8cbf0a8086ea9" category="paragraph">寫入隔離是連續建立的。這表示當隔離程序在多個磁碟區之間設定時、寫入 I/O 會依序凍結在第一個磁碟區上、因為它會繼續提交到稍後出現的磁碟區。這可能一開始就違反了保留寫入順序的要求、但這僅適用於非同步在主機上發出的 I/O 、不需仰賴任何其他寫入。</block>
  <block id="688656b1f8644ee299edf7be87a8fc75" category="paragraph">例如、資料庫可能會發出許多非同步資料檔案更新、並允許作業系統重新排序 I/O 、並根據其本身的排程器組態完成這些更新。這類 I/O 的順序無法保證、因為應用程式和作業系統已釋出保留寫入順序的要求。</block>
  <block id="599ce07d1bae0fa6169959e2bdb97ada" category="paragraph">以計數器為例、大部分的資料庫記錄活動都是同步的。在確認 I/O 之前、資料庫不會繼續進行記錄寫入、而且必須保留這些寫入的順序。如果記錄 I/O 到達圍籬式磁碟區、則不會予以確認、應用程式會在進一步寫入時加以封鎖。同樣地、檔案系統中繼資料 I/O 通常是同步的。例如、檔案刪除作業不得遺失。如果具有 xfs 檔案系統的作業系統刪除了檔案、而更新 xfs 檔案系統中繼資料的 I/O 則會移除位於圍籬磁碟區上的該檔案參照、則檔案系統活動就會暫停。這可確保 CG 快照作業期間檔案系統的完整性。</block>
  <block id="0f0c0f05310f9cf257d65bfd936f15c5" category="paragraph">在目標磁碟區之間設定寫入屏障之後、就可以開始建立快照。由於磁碟區的狀態會從相關寫入點凍結、因此不需要同時精確建立快照。為了防範建立 CG 快照的應用程式中的瑕疵、初始寫入屏障包含可設定的逾時時間、 ONTAP 會在定義的秒數後自動釋放隔離功能並繼續寫入處理。如果所有快照都是在逾時期間發生之前建立的、則產生的一組快照是有效的一致性群組。</block>
  <block id="df4925d1c6c3f3258e80ff35ce62b17d" category="section-title">相關寫入順序</block>
  <block id="6c78ee478b93fbb573157b85fb1114db" category="paragraph">從技術觀點來看、一致性群組的關鍵在於保留寫入順序、特別是根據寫入順序。例如、寫入 10 個 LUN 的資料庫會同時寫入所有 LUN 。許多寫入都是以非同步方式發出、這表示完成的順序不重要、實際完成的順序會因作業系統和網路行為而異。</block>
  <block id="69d87c00869001f3f06ad4a1494eac21" category="paragraph">某些寫入作業必須存在於磁碟上、資料庫才能繼續進行其他寫入作業。這些關鍵寫入作業稱為「相關寫入」。後續寫入 I/O 則取決於磁碟上是否有這些寫入資料。這 10 個 LUN 的任何快照、恢復或複寫都必須確保相關寫入順序受到保證。檔案系統更新是寫入順序相關寫入的另一個範例。必須保留檔案系統變更的順序、否則整個檔案系統可能會毀損。</block>
  <block id="74fbae5d0b3c16e1774c5f4dce2c1c36" category="section-title">策略</block>
  <block id="53e858edb9bd9ff3f9ead52cebf5731d" category="paragraph">以快照為基礎的備份主要有兩種方法：</block>
  <block id="f87f61f625a005bd32c53f808d235eea" category="list-text">快照保護的熱備份</block>
  <block id="c32eba270db95747b471fd53e203a47b" category="paragraph">當備份點還原足夠時、主要會使用損毀一致的 Snapshot 備份。在某些情況下可以套用歸檔記錄檔、但如果需要更精細的時間點還原、則最好使用線上備份。</block>
  <block id="82cc23cd5dc667cc9fb78ff6e76ac15b" category="paragraph">快照型線上備份的基本程序如下：</block>
  <block id="dbaf4855045e45fbcf678fa4cd1ab2db" category="list-text">將資料庫放入<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> 模式。</block>
  <block id="c3e07fb8aef84ef3d94e3f9d5376c091" category="list-text">建立所有託管資料檔案的磁碟區快照。</block>
  <block id="2d0e58ff1a25bd9fd8a85ad8ce6f2665" category="list-text">結束<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> 模式。</block>
  <block id="4196c5674aaa9e4317b2b4c54f94a905" category="list-text">執行命令<block ref="9d2840394bc37850da4e360dbf60c0dc" prefix=" " category="inline-code"></block> 強制記錄歸檔。</block>
  <block id="f2736e795871e2fc2d36addb9436f337" category="list-text">為所有託管歸檔記錄的磁碟區建立快照。</block>
  <block id="f24880a3fe8b242fdd1aba5a2d11196f" category="paragraph">此程序會產生一組快照、其中包含備份模式中的資料檔案、以及在備份模式中產生的重要歸檔記錄。這是恢復資料庫的兩項需求。控制檔等檔案也應受到保護、以方便使用、但唯一的絕對需求是保護資料檔案和歸檔記錄。</block>
  <block id="0c32649da44277db19fcfa3fe4dac28f" category="paragraph">雖然不同的客戶可能有非常不同的策略、但幾乎所有這些策略最終都是以下列相同原則為基礎。</block>
  <block id="88f451afed04f47352987f617f805826" category="section-title">快照型還原</block>
  <block id="c092a9763068c8382be82f9c77bb9658" category="paragraph">在設計 Oracle 資料庫的 Volume 配置時、第一個決定是是否使用 Volume NetApp SnapRestore （ VBSR ）技術。</block>
  <block id="15a0b8dc4d1b340d403bf6515f7e61b8" category="paragraph">Volume 型 SnapRestore 可讓磁碟區立即還原至較早的時間點。由於磁碟區上的所有資料都已還原、因此 VBSR 可能不適用於所有使用案例。例如、如果整個資料庫（包括資料檔案、重做記錄和歸檔記錄）儲存在單一磁碟區上、且此磁碟區使用 VBSR 還原、則資料會遺失、因為較新的歸檔記錄和重做資料會被捨棄。</block>
  <block id="e63c0ca12b07a654ccadd92527a95c47" category="paragraph">還原不需要 VSR 。許多資料庫都可以使用檔案型單一檔案 SnapRestore （ SFSR ）來還原、或只是將檔案從快照複製回作用中的檔案系統。</block>
  <block id="b38bd603a952c93872eae2ea858cb15f" category="paragraph">以這種方式隔離資料檔案、可讓檔案還原至較早的狀態、而不會損壞其他檔案系統。</block>
  <block id="5755a6275c3ecd99e8159efc58a8ff6c" category="section-title">Snapshot保留</block>
  <block id="957abb72f2db3a20e0b570a5fa3a1dcc" category="paragraph">對於 SAN 環境中具有 Oracle 資料的每個 Volume<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 應設為零、因為在 LUN 環境中保留快照空間並不實用。如果百分比保留設為 100 、則具有 LUN 的磁碟區快照需要在磁碟區中有足夠的可用空間、但不包括快照保留空間、以吸收所有資料 100% 的營業額。如果將百分比保留設為較低的值、則需要相對較小的可用空間、但它一律會排除快照保留。這表示 LUN 環境中的快照保留空間會被浪費。</block>
  <block id="d5a06adf11e69f265f3ee3277212764e" category="paragraph">在 NFS 環境中、有兩個選項：</block>
  <block id="7631336a8e2e03f6ac500c145445b2d7" category="list-text">設定<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 根據預期的快照空間使用量。</block>
  <block id="acc4c5d06fc4a9ac93880c9c2d0a6e76" category="list-text">設定<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 以歸零並統整管理作用中和快照空間使用量。</block>
  <block id="44806986c5abfcd6261803f4f75a7b56" category="paragraph">使用第一個選項、<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 設為非零值、通常約 20% 。然後、使用者就會隱藏此空間。不過、此值並不會限制使用率。如果具有 20% 保留的資料庫擁有 30% 的營業額、則快照空間可能會超出 20% 保留空間的範圍、並佔用無保留空間。</block>
  <block id="c8910acb0bfa30f82b423ff09a9710ca" category="paragraph">將保留設定為 20% 等值的主要優點是驗證某些空間永遠可供快照使用。例如、保留 20% 的 1TB 磁碟區只允許資料庫管理員（ DBA ）儲存 800GB 的資料。此組態保證至少有 200GB 的空間可供快照使用。</block>
  <block id="be233226a8cb890c0a8bbf041c06ac6b" category="paragraph">何時<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 設為零、則使用者可以使用磁碟區中的所有空間、以提供更好的可見度。DBA 必須瞭解、如果他 / 她看到 1TB 的磁碟區運用快照、則這 1TB 的空間會在使用中資料和 Snapshot 週轉之間共享。</block>
  <block id="b10efee713968b90d211d08ec8345d20" category="paragraph">終端使用者之間的選項 1 和選項 2 之間沒有明確的偏好設定。</block>
  <block id="8112d08173571f2d01372cadea3ea76d" category="section-title">ONTAP 和第三方快照</block>
  <block id="0cc082f7cc7618a904f6cde556295cbd" category="paragraph">Oracle Doc ID 604683.1 說明第三方快照支援的需求、以及備份與還原作業的多種選項。</block>
  <block id="130a02f8381e6c54b2ea07d2bdaf6f0b" category="paragraph">第三方廠商必須保證公司的快照符合下列要求：</block>
  <block id="97eb59a0f249226523b31dd52d557e00" category="list-text">快照必須與 Oracle 建議的還原與還原作業整合。</block>
  <block id="083e9332dc2b6bf064139ac2e670eee9" category="list-text">快照必須在快照點保持一致的資料庫損毀。</block>
  <block id="9dae8634b638a6949dab0f7eaf7988bd" category="list-text">快照中的每個檔案都會保留寫入順序。</block>
  <block id="7bc868657652757ca8505ddcd297456f" category="paragraph">ONTAP 和 NetApp Oracle 管理產品符合這些要求。</block>
  <block id="9e19caeb431a5e29a1a63e3cee4b36c9" category="doc">使用 ONTAP 保護 Oracle 資料</block>
  <block id="848aab87f65bfade12f80d4e864ec046" category="paragraph">企業無法在沒有資料存取權的情況下運作、有時資料會定義業務。此資料必須受到保護；然而、資料保護不只是確保可用的備份、還要快速可靠地執行備份、而且還要安全地儲存。</block>
  <block id="28a0304f97f876b27cf541f4ad9a30d7" category="paragraph">資料保護的另一面是資料恢復。當資料無法存取時、企業就會受到影響、而且可能無法運作、直到資料還原為止。此程序必須快速且可靠。最後、大多數資料庫都必須防範災難、這表示必須維護資料庫的複本。複本必須是最新的。複本也必須快速且簡單、才能使其成為完全運作的資料庫。</block>
  <block id="3d601b26d05eac41fc6a7eba92fdc8b9" category="admonition">本文件取代先前發佈的技術報告 _TR-4591 ： Oracle 資料保護：備份、還原及複寫。 _</block>
  <block id="21d28aa03f67eb242b1c95a6a0594ff5" category="section-title">規劃</block>
  <block id="355ba59494fea8b20be391a73cc755eb" category="paragraph">準確測試資料庫儲存效能是極為複雜的主題。需要瞭解下列問題：</block>
  <block id="b57041cc3b57577b5c21eff44739e3f9" category="list-text">IOPS 與處理量</block>
  <block id="236e7fd957ada95e8094e302623980d3" category="list-text">前景與背景 I/O 作業之間的差異</block>
  <block id="902f90cc4ab59808cac5606f767f61c4" category="list-text">延遲對資料庫的影響</block>
  <block id="196198dbaa1d1ea17cfc478fbb2f419f" category="list-text">許多作業系統和網路設定也會影響儲存效能</block>
  <block id="5ff18eadb2ef3fc20e13bed3e5b61d79" category="paragraph">此外、還有非儲存資料庫工作要考量。最佳化儲存效能並不會帶來實用效益、因為儲存效能不再是效能的限制因素。</block>
  <block id="32a993d3f497a6dd4392d3348b05ebc3" category="list-text">網路頻寬是效能限制的常見來源。例如、旋轉式磁碟解決方案通常是資料庫效能的瓶頸、因為 I/O 延遲非常高。當 All Flash 陣列移除延遲限制時、障礙會頻繁移轉至網路。在虛擬化環境和刀鋒系統中、這一點尤其顯著、因為這些環境和刀鋒系統的真正網路連線能力難以視覺化。如果由於頻寬限制而無法充分利用儲存系統本身、這可能會使效能測試變得複雜。</block>
  <block id="8caa382fb0f5f7a8279424d306dd003d" category="list-text">由於 All Flash 陣列的延遲大幅改善、因此一般無法將 All Flash 陣列與含有旋轉磁碟的陣列進行效能比較。測試結果通常沒有意義。</block>
  <block id="bc2b8b37bdda467f2ce639ab28bf4646" category="list-text">將尖峰 IOPS 效能與 All Flash 陣列進行比較通常並不實用、因為資料庫不受儲存 I/O 限制例如、假設一個陣列可維持 500K 的隨機 IOPS 、而另一個陣列則可維持 300K 。如果資料庫花費 99% 的時間處理 CPU 、這種差異在現實世界中是不相關的。工作負載永遠不會使用儲存陣列的完整功能。相反地、尖峰 IOPS 功能在整合平台中可能非常重要、而在整合平台中、儲存陣列預期會載入至尖峰容量。</block>
  <block id="0c2cbb26e6baa58b7d3a3309f95a2786" category="list-text">請務必在任何儲存測試中考慮延遲和 IOPS 。市面上許多儲存陣列都宣稱 IOPS 極高、但延遲卻使這些 IOPS 在這類層級上無法使用。使用 All Flash Array 的典型目標是 1 毫秒標記。更好的測試方法不是測量最大可能的 IOPS 、而是判斷儲存陣列在平均延遲大於 1 毫秒之前可以維持多少 IOPS 。</block>
  <block id="e6d8362588e550c19912b0f3f0e1a129" category="section-title">Oracle 自動工作負載儲存庫與基準測試</block>
  <block id="d035df494751722dd56d4cf4a8d1f795" category="paragraph">Oracle 效能比較的黃金標準是 Oracle 自動工作負載儲存庫（ AWR ）報告。</block>
  <block id="95f7e55383674168e90b01b708bc88db" category="paragraph">有多種類型的 AWR 報告。從儲存點來看、執行所產生的報告<block ref="5053a9940effa118d38161a53f3b80f8" prefix=" " category="inline-code"></block> Command 是最全面且最有價值的命令、因為它針對特定資料庫執行個體、並包含一些詳細的分佈圖、可根據延遲來中斷儲存 I/O 事件。</block>
  <block id="7b79802e5668e6e5b990081db481505d" category="paragraph">比較兩個效能陣列的理想方法是在每個陣列上執行相同的工作負載、並產生精確鎖定工作負載的 AWR 報告。在執行時間極長的工作負載中、可以使用包含開始和停止時間的單一 AWR 報告、但最好將 AWR 資料分成多份報告。例如、如果批次工作從午夜執行至上午 6 點、請建立一系列從午夜– 1 點、上午 1 點– 2 點開始的一小時 AWR 報告。</block>
  <block id="e39ecb86ad7d25413ba8ad2976fd3e4a" category="paragraph">在其他情況下、應最佳化非常簡短的查詢。最佳選項是以查詢開始時建立的 AWR 快照為基礎的 AWR 報告、以及在查詢結束時建立的第二個 AWR 快照。否則資料庫伺服器應保持安靜、以將會使分析中查詢活動模糊的背景活動降至最低。</block>
  <block id="2fe7152c186ec1b5b0451e13ec8b968b" category="admonition">如果無法取得 AWR 報告、 Oracle 狀態報告是一個很好的替代方案。它們包含與 AWR 報告相同的大部分 I/O 統計資料。</block>
  <block id="8b8c73ac7e509a897688356d1d283d75" category="section-title">Oracle AWR 與疑難排解</block>
  <block id="42a92c79ee82f4343e7d65f2f1cf2dd2" category="paragraph">AWR 報告也是分析效能問題的最重要工具。</block>
  <block id="ad5387afbab7c506c781c8b12b0a4b24" category="paragraph">與基準測試一樣、效能疑難排解也需要您精確測量特定工作負載。如果可能、請在向 NetApp 支援中心回報效能問題、或與 NetApp 或合作夥伴客戶團隊合作、討論新解決方案時提供 AWR 資料。</block>
  <block id="6471146c0e33e2a8ec8a5c6635c837bc" category="paragraph">提供 AWR 資料時、請考量下列需求：</block>
  <block id="5c3ba265890805919f93c246b3f8d2d6" category="list-text">執行<block ref="5053a9940effa118d38161a53f3b80f8" prefix=" " category="inline-code"></block> 產生報告的命令。輸出可以是文字或 HTML 。</block>
  <block id="25db65f9a36910f3e488a8b7407130de" category="list-text">如果使用 Oracle Real Application Clusters （ RAC ）、請為叢集中的每個執行個體產生 AWR 報告。</block>
  <block id="96d55341f8208c60720e68b3155f3aa1" category="list-text">鎖定問題存在的特定時間。AWR 報告的最長可接受使用時間通常為一小時。如果問題持續數小時、或涉及多小時作業、例如批次工作、請提供多個一小時的 AWR 報告、涵蓋整個分析期間。</block>
  <block id="4533b15b837909c68a0171d2638494d2" category="list-text">如有可能、請將 AWR 快照時間間隔調整為 15 分鐘。此設定可執行更詳細的分析。這也需要額外執行<block ref="5053a9940effa118d38161a53f3b80f8" prefix=" " category="inline-code"></block> 提供每 15 分鐘間隔的報告。</block>
  <block id="97eb6d04cc93934c1be4ab95054cd0b0" category="list-text">如果問題是非常短的執行查詢、請根據作業開始時建立的 AWR 快照、以及作業結束時建立的第二個 AWR 快照、提供 AWR 報告。否則、資料庫伺服器應保持安靜、以將會使分析中作業的活動受到影響的背景活動減至最低。</block>
  <block id="5186f459ce7d75e587a083bcb7c5927a" category="list-text">如果在特定時間回報效能問題、但未在其他時間回報、請提供額外的 AWR 資料、以展現良好的效能來進行比較。</block>
  <block id="108a72dad388aa310cc52ee3bac7d1cc" category="section-title">calibr_IO</block>
  <block id="f1c07dfccef6a6c47a5ccef938e10e3d" category="paragraph">。<block ref="108a72dad388aa310cc52ee3bac7d1cc" prefix=" " category="inline-code"></block> 絕對不可使用命令來測試、比較或基準測試儲存系統。如 Oracle 文件所述、本程序會校正儲存設備的 I/O 功能。</block>
  <block id="872892cce56a2665ad7ceecc44b38166" category="paragraph">校準與基準測試不同。此命令的目的是發佈 I/O 、藉由最佳化發行給主機的 I/O 層級、協助校正資料庫作業並改善其效率。因為執行的 I/O 類型<block ref="108a72dad388aa310cc52ee3bac7d1cc" prefix=" " category="inline-code"></block> 作業並不代表實際的資料庫使用者 I/O 、結果無法預測、而且經常無法重現。</block>
  <block id="e66807fad19acd41db50eedff918a4dd" category="section-title">SLOB2</block>
  <block id="0a6192ff5412539c31db2c7a98f408b3" category="inline-link-macro"><block ref="0a6192ff5412539c31db2c7a98f408b3" category="inline-link-rx"></block></block>
  <block id="d1f6fb23f52090ffd944dc54549735b8" category="paragraph">SLOB2 是愚蠢的小 Oracle 基準測試工具、已成為評估資料庫效能的首選工具。這是由 Kevin Closson 開發的、可在取得 <block ref="3ccce0719b1965cd915da75778e4e706" category="inline-link-macro-rx"></block>。安裝和設定需要幾分鐘的時間、它使用實際的 Oracle 資料庫來在使用者可定義的資料表空間上產生 I/O 模式。這是少數幾種可用的測試選項之一、可將全快閃陣列與 I/O 飽和它也有助於產生更低層級的 I/O 、以模擬低 IOPS 但對延遲敏感的儲存工作負載。</block>
  <block id="baffd8ac40ca7b966340e7b257b4c7b4" category="section-title">交換台工作台</block>
  <block id="905a59d6f73f4e2aea1dc232a3bcd195" category="paragraph">交換基準台可用於測試資料庫效能、但使用交換基準台的方式會對儲存造成壓力、這是非常困難的。NetApp 尚未從 SwingWorkbench 中看到任何測試結果、這些測試產生足夠的 I/O 、使其在任何 AFF 陣列上都成為重大負載。在有限的情況下、訂單輸入測試（ OET ）可用於從延遲點評估儲存設備。這在資料庫對於特定查詢具有已知延遲相依性的情況下很有用。必須注意確保主機和網路已正確設定、以實現 All Flash 陣列的延遲潛力。</block>
  <block id="e3cf940afa524b20b15c43b20405be77" category="section-title">HammerDB</block>
  <block id="5c9408da71d2ff7554b9fd11add795cf" category="paragraph">HammerDB 是一種資料庫測試工具、可模擬 TPC-C 和 TPC-H 基準測試等。建構足夠大的資料集以正確執行測試可能需要很長時間、但它可以是評估 OLTP 和資料倉儲應用程式效能的有效工具。</block>
  <block id="7e1ad070b7fff621d9d64a71cec87684" category="section-title">Orion</block>
  <block id="56fedcbec2842fb62a743c5f84311597" category="paragraph">Oracle Orion 工具通常與 Oracle 9 搭配使用、但並未加以維護、以確保與各種主機作業系統的變更相容。由於與作業系統和儲存組態不相容、因此很少與 Oracle 10 或 Oracle 11 搭配使用。</block>
  <block id="38622bf572fa7bec2dc7f3915ebd345f" category="paragraph">Oracle 重新編寫了該工具，默認情況下，該工具與 Oracle 12c 一起安裝。雖然本產品已經過改良、並使用許多與實際 Oracle 資料庫相同的呼叫、但它並未使用 Oracle 所使用的相同程式碼路徑或 I/O 行為。例如、大部分的 Oracle I/O 都是同步執行、這表示資料庫會暫停、直到 I/O 作業在前景完成為止。只是以隨機 I/O 淹沒儲存系統、並不是真正的 Oracle I/O 複製、也無法提供直接的儲存陣列比較方法、也無法測量組態變更的影響。</block>
  <block id="bb68dfada5ca20e256bbd3ffbbfab9e6" category="paragraph">也就是說、 Orion 有一些使用案例、例如一般測量特定主機網路儲存組態的最大可能效能、或是測量儲存系統的健全狀況。仔細測試後、只要參數包括 IOPS 、處理量和延遲的考量、並嘗試忠實複寫真實的工作負載、就能設計出可用的 Orion 測試來比較儲存陣列或評估組態變更的影響。</block>
  <block id="6b64090d226d30776368e89b08c7c71b" category="summary">適用於 Oracle 資料庫的 WAFL 對齊</block>
  <block id="03a35ba2b6191f8cfbd1cca378eefc91" category="doc">Oracle 資料庫的 WAFL 對齊驗證</block>
  <block id="219900dcd21cee2f958254a708ad36f6" category="paragraph">正確的 WAFL 對齊對於良好的效能至關重要。雖然 ONTAP 以 4KB 單位管理區塊、但這並不表示 ONTAP 以 4KB 單位執行所有作業。事實上、 ONTAP 支援不同大小的區塊作業、但基礎會計是由 WAFL 以 4KB 為單位進行管理。</block>
  <block id="5d3a5c290e14d74acf49b20d15120886" category="paragraph">「對齊」一詞是指 Oracle I/O 與這些 4KB 單元的相對應方式。最佳效能要求 Oracle 8KB 區塊位於磁碟機上的兩個 4KB WAFL 實體區塊上。如果區塊偏移 2KB 、則此區塊會位於一半的 4KB 區塊、一個獨立的完整 4KB 區塊、然後是第三個 4KB 區塊的一半。這種安排會導致效能降低。</block>
  <block id="0073ce99d632b066d5ac09a4ad0cf7fc" category="paragraph">對齊並不涉及 NAS 檔案系統。Oracle 資料檔案會根據 Oracle 區塊的大小、與檔案的開頭對齊。因此、 8KB 、 16KB 和 32KB 的區塊大小一律會對齊。所有區塊作業都會從檔案開頭偏移、單位為 4 KB 。</block>
  <block id="d7f7edd61ab216efc34578584a7d0e7c" category="paragraph">相反地、 LUN 在啟動時通常會包含某種驅動程式標頭或檔案系統中繼資料、以建立偏移。對齊在現代作業系統中很少是個問題、因為這些作業系統是專為可能使用原生 4KB 磁碟區的實體磁碟機所設計、因此也需要將 I/O 與 4KB 邊界對齊才能獲得最佳效能。</block>
  <block id="38b3d1cd67903560954ad297a92e3de1" category="paragraph">不過、有一些例外情況。資料庫可能已從未針對 4KB I/O 最佳化的舊版作業系統移轉、或是在建立分割區時發生使用者錯誤、可能導致偏移量、而大小單位不是 4KB 。</block>
  <block id="612eeadd26ceeace7b043d37f8e24b1f" category="paragraph">下列範例僅適用於 Linux 、但程序可適用於任何作業系統。</block>
  <block id="1d5b772bea21e5e949413e09eedf17de" category="section-title">一致</block>
  <block id="594b0fc1af44897ff4b26f2e6b866685" category="paragraph">以下範例顯示單一磁碟分割的單一 LUN 對齊檢查。</block>
  <block id="dc2c18402c86861702fc1d94a6495ac3" category="paragraph">首先、建立使用磁碟機上所有可用分割區的分割區。</block>
  <block id="adff8cc6319e96d2685fd082a5aa043c" category="paragraph">您可以使用下列命令以數學方式檢查對齊方式：</block>
  <block id="4bc7aba328a710bb7d0935cf830634aa" category="paragraph">輸出顯示單位為 512 位元組、且分割區的開頭為 32 個單位。總共 32 x 512 = 16 、 834 位元組、這是 4KB WAFL 區塊的整數倍數。此分割區已正確對齊。</block>
  <block id="dd343941469b5360af52eb1b94fe5de6" category="paragraph">若要驗證正確的對齊方式、請完成下列步驟：</block>
  <block id="7d84e72acd05d0c93d99e414f5b092b5" category="list-text">識別 LUN 的通用唯一識別碼（ UUID ）。</block>
  <block id="92af2a93f00a6297c490ba0be5fd7a8a" category="list-text">進入 ONTAP 控制器上的節點 Shell 。</block>
  <block id="5274579d5eff6fe6d1e8ecbf54e84993" category="list-text">在第一步中識別的目標 UUID 上開始收集統計資料。</block>
  <block id="52df0a2ea976123bf02330300b2392e3" category="list-text">執行一些 I/O請務必使用<block ref="3c908d68ba53922b92c5595b72fa011c" prefix=" " category="inline-code"></block> 用於確保 I/O 同步且無緩衝的引數。</block>
  <block id="fac8a5b490ea29eca93ec213d79e6ff2" category="admonition">請務必小心使用此命令。反轉<block ref="39c8942e1038872a822c0dc75eedbde3" prefix=" " category="inline-code"></block> 和<block ref="8bf8854bebe108183caeb845c7676ae4" prefix=" " category="inline-code"></block> 引數會破壞資料。</block>
  <block id="4f7dce34a21e3de727f3e3ad05e6e7d8" category="list-text">停止統計資料並檢視對齊分佈圖。所有 I/O 都應位於<block ref="c6bd178b372b0ddd17fff48819badc6a" prefix=" " category="inline-code"></block> 貯體、表示 I/O 與 4KB 區塊邊界對齊。</block>
  <block id="5df81374c01d1b7c20fe8cb3883117eb" category="section-title">未對齊</block>
  <block id="5ff266dadf965b3c304513f516a13c12" category="paragraph">以下範例顯示 I/O 未對齊：</block>
  <block id="25be03b87e6a5d8170ce85b16ea506ab" category="list-text">建立不符合 4KB 邊界的分割區。這不是現代作業系統的預設行為。</block>
  <block id="4adda0e871000c2b13a4faef6ce4e21b" category="paragraph">錯誤的對齊是顯而易見的。I/O 大多落在 * 之中 <block ref="66c8d76cad709856ccec680cab8ab35a" prefix="*" category="inline-code"></block> 符合預期偏移的貯體。建立分割區時、它會比最佳化的預設值更進一步移入 512 個位元組、這表示長條圖偏移 512 個位元組。</block>
  <block id="b53cb977228ac351c16dfacc3c427a99" category="paragraph">此外<block ref="20e637b3ddd562732de038fba736c7ee" prefix=" " category="inline-code"></block> 統計資料為非零、這表示執行的 I/O 並未填滿整個 4KB 區塊。</block>
  <block id="d3d92f87c5235ad11c8bc69e85fb2fd0" category="section-title">重作記錄</block>
  <block id="162b54d51a30629d78e153f8da201780" category="paragraph">此處說明的程序適用於資料檔案。Oracle 重做記錄和歸檔記錄檔有不同的 I/O 模式。例如、重做記錄是單一檔案的循環覆寫。如果使用預設的 512 位元組區塊大小、寫入統計資料看起來會像這樣：</block>
  <block id="d36dbaa617441d3308f5a9b50cb6f5ca" category="paragraph">I/O 會分散到所有分佈式分佈區、但這並不是效能考量。不過、重做記錄率極高可能會因為使用 4KB 區塊大小而受惠。在這種情況下、最好確定重做記錄 LUN 已正確對齊。不過、這對於資料檔案對齊的良好效能並不重要。</block>
  <block id="3f9e1e3abd12ad7445baea4b681b9ceb" category="paragraph">如果 Oracle 資料庫伺服器當機、則重新啟動時可能會發生過時的 NFS 鎖定問題。請仔細注意伺服器上的名稱解析設定、以避免此問題。</block>
  <block id="288ebefc25180862eb0448b786b1b9fc" category="paragraph">產生此問題的原因是建立鎖定和清除鎖定會使用兩種稍微不同的名稱解析方法。涉及兩個過程： Network Lock Manager （ NLM ）和 NFS 用戶端。NLM 使用<block ref="e5caaf154dfeed411b9eec65b903a22a" prefix=" " category="inline-code"></block> 以決定主機名稱、而<block ref="d49331f31f40041ebcee19fca74fd9d4" prefix=" " category="inline-code"></block> 程序用途<block ref="330c4316ae6124616389eb1ca9912f7a" prefix=" " category="inline-code"></block>。這些主機名稱必須相符、作業系統才能正確清除過時的鎖定。例如、主機可能正在尋找擁有的鎖定<block ref="c7169a6dd344d0f0a38071a1262e4973" prefix=" " category="inline-code"></block>但鎖定已由主機登錄為<block ref="0c32c65f5ac66d0bdb4e63bd5fde7f75" prefix=" " category="inline-code"></block>。如果<block ref="330c4316ae6124616389eb1ca9912f7a" prefix=" " category="inline-code"></block> 不會傳回與相同的值<block ref="5c020b5bb8d1ce1ace51c2a2f4c06fc2" prefix=" " category="inline-code"></block>，則鎖定釋放程序未成功。</block>
  <block id="19b9a1f540971d74c69042125bab2abc" category="paragraph">下列範例指令碼會驗證名稱解析是否完全一致：</block>
  <block id="ee04b3fa3b28391874763596275e09c9" category="paragraph">如果<block ref="b64c6f211add16fd66ac17ef14c2a2b4" prefix=" " category="inline-code"></block> 不符<block ref="4040592cec1880aa70936989f05e7c31" prefix=" " category="inline-code"></block>、可能是過時的鎖定。例如、此結果顯示潛在問題：</block>
  <block id="2b500e5914ea5a219ade17dea0808f51" category="paragraph">解決方案通常是透過變更主機出現在中的順序來找到<block ref="ad942c725cd0cae65ca4c63717ec464c" prefix=" " category="inline-code"></block>。例如、假設 hosts 檔案包含下列項目：</block>
  <block id="22b58ec1cec48707dfc018e6e216e966" category="paragraph">若要解決此問題、請變更完整網域名稱和簡短主機名稱出現的順序：</block>
  <block id="e357ccd0745db58f22ea5c0947b613ee" category="paragraph"><block ref="330c4316ae6124616389eb1ca9912f7a" prefix="" category="inline-code"></block> 現在傳回短<block ref="c7169a6dd344d0f0a38071a1262e4973" prefix=" " category="inline-code"></block> 主機名稱、符合的輸出<block ref="4040592cec1880aa70936989f05e7c31" prefix=" " category="inline-code"></block>。因此、鎖定會在伺服器當機後自動清除。</block>
  <block id="ea4c55be196897a16d86999f5c16d582" category="doc">虛擬化</block>
  <block id="9e28dbd7a4f5940eeaf6d3893c5c4b1f" category="section-title">儲存簡報</block>
  <block id="151ae53a4100e0a6e83bde4d78083f81" category="list-text">iSCSI LUN 由虛擬機器上的 iSCSI 啟動器管理、而非 Hypervisor</block>
  <block id="36f9cea3dc0f65698a9fbe15460591c1" category="list-text">* 可攜性。 * VM 擁有其檔案系統時、移動 Oracle 環境的程序會變得更簡單。檔案系統可在虛擬化與非虛擬化的來賓作業系統之間輕鬆移動。</block>
  <block id="f114856edc6cd8d6a9add5ec3f67656f" category="section-title">半虛擬化驅動程式</block>
  <block id="beeb10ceee6c9aabe178fb51edea7d22" category="paragraph">為了達到最佳效能、使用半虛擬化網路驅動程式至關重要。使用資料存放區時、需要半虛擬化 SCSI 驅動程式。半虛擬化的裝置驅動程式可讓來賓更深入地整合至 Hypervisor 、而非模擬的驅動程式、在該驅動程式中、 Hypervisor 會花費更多的 CPU 時間來模擬實體硬體的行為。</block>
  <block id="7c5996fc15a24ce96b30160b60ac2b96" category="section-title">過度使用 RAM</block>
  <block id="5bccdd812c4af1cb5b9e36ddce656b60" category="paragraph">過度使用 RAM 意味著在不同主機上設定的虛擬化 RAM 多於實體硬體上的虛擬化 RAM 。否則可能會造成非預期的效能問題。虛擬化資料庫時、 Oracle SGA 的基礎區塊不得由 Hypervisor 交換至儲存設備。這樣做會導致效能結果極不穩定。</block>
  <block id="ff1d278a485c443dc5d8fc9f10f1a702" category="doc">NetApp HCI for virtual desktop Infrastructure with VMware Horizon 7 - 利用 3D 圖形為進階使用者提供強大功能</block>
  <block id="e3162938e0d7b1bbc74111cc5b5871c5" category="paragraph">TR-4792 提供在採用 NVIDIA 圖形處理單元（ GPU ）和虛擬化軟體的 VMware Horizon 環境中、使用 NetApp H615C 運算節點來處理 3D 圖形工作負載的指引。它也提供 H615C 的 SPECviewperf 13 初步測試結果。</block>
  <block id="1de37c09602b46db5de57a946efe2768" category="paragraph"><block ref="1de37c09602b46db5de57a946efe2768" category="inline-link-macro-rx"></block></block>
  <block id="93b94e62ad8cb02a1d1a7b0944a5445d" category="summary">本文件討論ONTAP VMware vSphere的產品安全性功能。</block>
  <block id="57a033c33a8be6110be46b2914cc4989" category="doc">搭配 ONTAP 使用 vVols</block>
  <block id="21247c4392dc3c243f693dbf5b762553" category="section-title">產品與文件</block>
  <block id="94ef809dc16e728151bda996f8b4f8aa" category="inline-image-macro">ONTAP 工具 VASA 供應商架構、 240</block>
  <block id="d78de3410d86d345a548abdf67aff375" category="paragraph"><block ref="d78de3410d86d345a548abdf67aff375" category="inline-image-macro-rx" type="image"></block></block>
  <block id="5e5421e75636200787a4449a2cdaa1f1" category="section-title">產品安裝</block>
  <block id="72333dadacbc964761fb14f718f6d411" category="section-title">產品文件</block>
  <block id="e0644c46fdc2ced2c094f7db15e15a8a" category="paragraph">下列文件可協助您部署 ONTAP 工具。</block>
  <block id="be11c74c1dd7f307bb80183a90dc2067" category="section-title">開始使用</block>
  <block id="7d0ee6fed10d3d4e5c9ee496729ab519" category="inline-link">版本資訊</block>
  <block id="3d7fe3e43f9f24fffe5ed0d546d12f13" category="inline-link">部署ONTAP 各種工具</block>
  <block id="a2fa58344be7fbd9a2be0320a8df0f77" category="inline-link">升級ONTAP 功能</block>
  <block id="21e2a89d708329706ec6ed3fc989a1f6" category="section-title">使用ONTAP VMware工具</block>
  <block id="317bbf73ff27c5f981628c8fb83ebf22" category="inline-link">設定角色型存取控制</block>
  <block id="641e9457539249e880725760f91d5ee2" category="inline-link">設定高可用度</block>
  <block id="04edeb5424c826c14a69edb777edf395" category="section-title">保護及管理資料存放區</block>
  <block id="dd5138e8a4207a5b2fde43b411a4b5e1" category="section-title">Vasa Provider Dashboard</block>
  <block id="cd47dd01745339787e4c7300389401f2" category="section-title">最佳實務做法</block>
  <block id="9ae938622297e9d4b14dd0006a8f0bf4" category="paragraph">* 限制 *</block>
  <block id="b4f52a4fd0b07c9d904b95fc98a1cd45" category="inline-link">組態最大值</block>
  <block id="130b78bfd6c9b050a912fec77e285e3f" category="cell">容量/功能</block>
  <block id="72e0ee397942f7233122887584f94b8b" category="paragraph">搭配 vSphere 使用 ONTAP vVols 非常簡單、並遵循已發佈的 vSphere 方法（請參閱您的 ESXi 版本的 VMware 文件中的「在 vSphere 儲存環境下使用虛擬磁碟區」）。以下是一些與 ONTAP 一起考量的額外實務做法。</block>
  <block id="83583580d98b69cb8317f9b285f3c8df" category="cell">* 將 ONTAP 工具用於 VMware vSphere 的 UI 延伸或 REST API 、以佈建 vVols 資料存放區 * * 和傳輸協定端點 *</block>
  <block id="e8d5f9dc0bff953a9e59755813c7e8bf" category="cell">* 切勿將 ONTAP 工具應用裝置或 vCenter Server Appliance （ VCSA ）儲存在他們正在管理的 VVols 資料存放區。 *</block>
  <block id="ab8d352870fb5334773c7177d3d5dcd1" category="cell">* 避免在不同的 ONTAP 版本中執行 vVols 作業。 *</block>
  <block id="8b2bcef781b7e1f6d64739147d50aae7" category="cell">支援的儲存功能（例如 QoS 、特性設定等）已在 VASA Provider 的不同版本中有所變更、有些則視 ONTAP 版本而定。在 ONTAP 叢集中使用不同版本、或在具有不同版本的叢集之間移動 vVols 、可能會導致非預期行為或法規遵循警示。</block>
  <block id="cd7bf0e1e61341c1aa3fa23401af8a27" category="inline-image-macro">單一啟動器分區、包含四個節點、 400</block>
  <block id="51591d05b7e084ba8e5ae7f63172177e" category="inline-link">_TR-4080 現代 SAN ONTAP 9_ 的最佳實務做法</block>
  <block id="c1723e6a0e1d3dd28232b33e0cb6e61d" category="inline-link">_TR-4684 使用 NVMe 來實作和設定現代化 SAN</block>
  <block id="ee3cbda1c3c4a14ae024478c7ada6d11" category="cell">* 遵循所有通訊協定最佳實務做法。 *</block>
  <block id="6a2c1ac1da51eca0c1a65afffab8dfab" category="inline-image-macro">透過 NFS v3500 使用 vVols 進行網路組態</block>
  <block id="918febfed3d070cf1250909e5cdcf31d" category="paragraph">本文件涵蓋適用於 VMware vSphere 虛擬磁碟區（ VVols ）的 ONTAP 功能、包括最新的產品資訊和使用案例、以及最佳實務做法和其他資訊、可簡化部署並減少錯誤。</block>
  <block id="d30f04665be7a6d9663004b1b5e61a9a" category="paragraph">最佳實務做法是輔助其他文件、例如指南和相容性清單。這些技術是根據實驗室測試和NetApp工程師與客戶廣泛的現場經驗所開發。它們可能不是唯一可行或受支援的實務做法、但通常是最簡單的解決方案、可滿足大多數客戶的需求。</block>
  <block id="cc713c330b9c4e00d3ed7233bc54a889" category="section-title">虛擬磁碟區（ vVols ）概觀</block>
  <block id="cbf0aa9daeb855e4eace1a3bdc474ce2" category="paragraph">有幾個元件需要注意：</block>
  <block id="919601826e1d58bccaaab76d787871d2" category="cell">這是處理 VMware vSphere 與儲存系統之間通訊的軟體元件。對於 ONTAP 、 VASA Provider 會在名為 ONTAP tools for VMware vSphere 的應用裝置（簡稱 ONTAP 工具）中執行。ONTAP 工具也包括 vCenter 外掛程式、適用於 VMware Site Recovery Manager 的儲存複寫介面卡（ SRA ）、以及用於建置自己自動化的 REST API 伺服器。ONTAP 工具在 vCenter 中設定及登錄後、就不再需要直接與 ONTAP 系統互動、因為幾乎所有的儲存需求都可以直接從 vCenter UI 中進行管理、或透過 REST API 自動化來進行管理。</block>
  <block id="3b2cd9018385f55c53c9a8b756df8bb5" category="cell">傳輸協定端點是 ESXi 主機和 vVols 資料存放區之間 I/O 的 Proxy 。ONTAP VASA Provider 會自動建立這些 LUN 、每個 VVols 資料存放區的 FlexVol 磁碟區一個傳輸協定端點 LUN （大小為 4 MB ）、或是在資料存放區中主控 FlexVol 磁碟區的儲存節點上、每個 NFS 介面（ LIF ）一個 NFS 裝載點。ESXi 主機直接裝載這些傳輸協定端點、而非個別的 vVol LUN 和虛擬磁碟檔案。不需要管理 VASA Provider 自動建立、掛載、卸載及刪除的傳輸協定端點、以及任何必要的介面群組或匯出原則。</block>
  <block id="71afca0aa1a505ea2ac3ce5a1a681549" category="paragraph">vSphere 8 的新功能是、搭配 vVols 使用 NVMe over Fabrics （ NVMe of ）時、 ONTAP 中不再有傳輸協定端點的概念。相反地、只要第一個虛擬機器開機、 ESXi 主機就會為每個 ANA 群組自動產生一個虛擬 PE 。ONTAP 會自動為資料存放區所使用的每個 FlexVol 磁碟區建立全日空群組。</block>
  <block id="8202498953d2ebcf9968c37a7e47f4f6" category="paragraph">使用 NVMe for VVols 的另一個優點是、 VASA Provider 不需要任何繫結要求。而是由 ESXi 主機根據 VPE 在內部處理 vVol 繫結功能。這可減少 vVol 綁定風暴對服務造成影響的機會。</block>
  <block id="70532c0374111d897ef1176b34b6396c" category="inline-link">NVMe 和虛擬磁碟區</block>
  <block id="50ec55042a7f4e8c2c66219ac096cfb3" category="inline-link">vmware.com</block>
  <block id="113c9d4e642d1ba4cc469267fb7fd0de" category="paragraph">如需詳細資訊、請參閱<block ref="f8d477cd77073d731aafe4f52026608a" category="inline-link-rx"></block> 開啟<block ref="1f1565cca975c4a703345d21e7f273b8" category="inline-link-rx"></block></block>
  <block id="937251054fa0c1a7b946f8928cc857b9" category="section-title">原則型管理</block>
  <block id="2ce0d6ec59cca7e0b6e0bdc389301e63" category="section-title">使用儲存原則部署 VM</block>
  <block id="e0795f8b847058e171dec5a519757ece" category="image-alt">使用儲存原則部署虛擬機器</block>
  <block id="941431bc1cecb0ec5e89e78e9a5a96fc" category="section-title">VM 儲存原則法規遵循</block>
  <block id="bfd6dec22a6a1724ff1b67f1f289cdfc" category="image-alt">虛擬機器儲存原則符合性</block>
  <block id="9fe1fd556b933358881222d5c3da127c" category="paragraph">在發佈時、超大規模環境僅限於傳統的 NFS v3 資料存放區、因此 VVols 僅適用於內部部署 ONTAP 系統、或雲端連線系統、這些系統提供內部部署系統的完整功能、例如由全球各地的 NetApp 合作夥伴和服務供應商代管的系統。</block>
  <block id="274bc582ca884fc158ea9ac9f79f9067" category="inline-link">產品文件ONTAP</block>
  <block id="5ca60fe92dec435059ba5acefa4ce2c9" category="paragraph">_ 如需 ONTAP 的詳細資訊、請參閱<block ref="8a9b15dc18a16e0b1acfa438e27f6aa6" category="inline-link-rx"></block>_</block>
  <block id="3dffa984dadf9ff0006ee9cebd3b04b9" category="inline-link">TR-4597</block>
  <block id="d3fb76da5fbbcd6fa32e40910b5b9a47" category="section-title">搭配 ONTAP 使用 vVols 的優點</block>
  <block id="6a74f7c0a9021e009a9c030e54084978" category="paragraph">如第 1.2 節所述、原則型管理可讓 VM 使用預先定義的原則進行佈建及後續管理。這有助於 IT 作業的多種方式：</block>
  <block id="e0eb51b6d319e14c2fbfc1f628021a26" category="list-text">* 提高速度。 * ONTAP 工具不需要 vCenter 管理員與儲存團隊一起開啟儲存資源配置活動的問題單。不過、 vCenter 和 ONTAP 系統上的 ONTAP 工具 RBAC 角色仍可允許個別的團隊（例如儲存團隊）、或是由同一個團隊進行個別活動、只要有需要、就能限制特定功能的存取。</block>
  <block id="3f4dbd6687bd0d55bf69fe5fdd0137c4" category="list-text">* 更聰明的資源配置。 * 儲存系統功能可透過 VASA API 公開、讓資源配置工作流程能夠充分利用進階功能、而無需 VM 管理員瞭解如何管理儲存系統。</block>
  <block id="a13fcc9220d042cae454e9ac073636ca" category="list-text">* 更快的資源配置。 * 可在單一資料存放區中支援不同的儲存功能、並根據 VM 原則自動選擇適合的 VM 。</block>
  <block id="eb4c052226108afebf26e670208b9a55" category="list-text">* 避免錯誤。 * 儲存和 VM 原則是事先開發的、並可視需要套用、而無需每次佈建 VM 時都自訂儲存設備。當儲存功能從定義的原則中移出時、就會發出法規遵循警報。如前所述、 SCP 可讓初始資源配置可預測且可重複執行、而 VM 儲存原則則以 SCP 為基礎、則可確保正確放置。</block>
  <block id="f9878e32fdf258284c007eaae38773cd" category="section-title">現代化 SAN 上的 VM 精細管理</block>
  <block id="7e673a7c12cc256f29bcd7b2028d9d5a" category="paragraph">使用光纖通道和 iSCSI 的 SAN 儲存系統是 VMware 首次支援 ESX 的系統、但它們缺乏從儲存系統管理個別 VM 檔案和磁碟的能力。而是配置 LUN 並由 VMFS 管理個別檔案。這使得儲存系統難以直接管理個別 VM 儲存效能、複製和保護。VVols 提供 ONTAP 強大、高效能的 SAN 功能、讓使用 NFS 儲存設備的客戶能夠享有更精細的儲存空間。</block>
  <block id="25a46370807e0eab0dfe3853abfb9b6e" category="paragraph">現在、使用適用於 VMware vSphere 9.12 及更新版本的 vSphere 8 和 ONTAP 工具、 Vols 對於舊版 SCSI 型傳輸協定所使用的相同精細控制功能現在也可在採用 NVMe over Fabrics 的現代化光纖通道 SAN 中使用、以在規模上獲得更高的效能。有了 vSphere 8.0 更新 1 、現在可以使用 vVols 部署完整的端點對端 NVMe 解決方案、而無需在 Hypervisor 儲存堆疊中進行任何 I/O 轉譯。</block>
  <block id="f61f57f748f5f0b52c7f11f1f1bd43f0" category="section-title">更強大的儲存卸載功能</block>
  <block id="911fa02c34dda38cd69be06e524ed9d0" category="inline-link">效率保證</block>
  <block id="3170031d77f241bc872afcb490c0a806" category="paragraph">雖然 VAAI 提供多種卸載至儲存設備的作業、但 VASA Provider 仍會解決一些落差。SAN VAAI 無法將 VMware 託管的快照卸載至儲存系統。NFS VAAI 可以卸載 VM 託管的快照、但儲存原生快照對 VM 有限制。由於 VVols 使用個別 LUN 、命名空間或檔案來儲存虛擬機器磁碟、因此 ONTAP 可以快速有效地複製檔案或 LUN 、以建立不再需要差異檔案的 VM 精細快照。NFS VAAI 也不支援卸載熱（開啟電源） Storage VMotion 移轉的複製作業。當使用 VAAI 搭配傳統 NFS 資料存放區時、必須關閉虛擬機器電源、以允許移轉卸載。ONTAP 工具中的 VASA Provider 可提供近乎即時且具儲存效率的複本、以進行熱移轉和冷移轉、也支援近乎即時的 vVols 跨磁碟區移轉複本。由於這些顯著的儲存效率效益、您可能可以在中充分利用 vVols 工作負載<block ref="9d1af7a9d4f98887e53c1a9bedbce044" category="inline-link-rx"></block> 方案。同樣地、如果使用 VAAI 的跨磁碟區複製無法滿足您的需求、您可能會因為 vVols 複製體驗的改善而解決您的業務挑戰。</block>
  <block id="a8567b4dc683947384ef2e1dd0fc6ac1" category="section-title">vVols 的常見使用案例</block>
  <block id="48e535b80538b088fd868fde9372715c" category="paragraph">除了這些優點之外、我們也會看到 vVol 儲存設備的常見使用案例：</block>
  <block id="441f01ec38e91fad1b235a0e7422a178" category="list-text">* 隨選虛擬機器資源配置 *</block>
  <block id="bd652a918164d8fa5176b5f9b92c2e61" category="list-text">私有雲或服務供應商 IaaS 。</block>
  <block id="4fbc1141a40f5259e3ab1545de52b1ea" category="list-text">* 一流磁碟（ FCD ） *</block>
  <block id="e83f2e4e8676ee8faac4d6af599fd7e7" category="list-text">VMware Tanzu Kubernetes Grid [TKG] 持續磁碟區。</block>
  <block id="b2b81490f2245d3d566e0ccc6a29cfc2" category="list-text">透過與 VMDK 生命週期管理功能相隨的方式、提供 Amazon EBS 般的服務。</block>
  <block id="2511e4e8cbb72027ae20f24008d4b939" category="list-text">* 隨需提供暫存虛擬機器 *</block>
  <block id="eeb1044cc319a5d53503e45dbf762291" category="list-text">測試 / 開發實驗室</block>
  <block id="858d314810762abccaa7baf230e3dc18" category="list-text">訓練環境</block>
  <block id="ab7bbc294bf0f0354980a3014e8f4219" category="section-title">vVols 的常見優點</block>
  <block id="ccd6ea8c57e93a5401d07aab9c60f371" category="paragraph">在充分發揮其優勢時（例如在上述使用案例中）、 vVols 提供下列具體改善：</block>
  <block id="1c21847cdc5616af138ba0c03aad7adb" category="list-text">VVols 是搭配 vSphere CSI 使用 TKG 時的理想儲存技術、可提供由 vCenter 管理員管理的獨立儲存類別和容量。</block>
  <block id="d5f068caef73978a5483badd927a7e98" category="list-text">Amazon EBS 類似的服務可透過 FCD 提供、因為 FCD VMDK 就像名稱所示、是 vSphere 中的一流公民、生命週期可獨立管理、與可能附加的虛擬機器分開管理。</block>
  <block id="7e7040600922b2a78715f856613a3c08" category="doc">保護 vVols</block>
  <block id="de92c927f248723e4668aec459709995" category="section-title">Vasa Provider 高可用度</block>
  <block id="f4d4cb8868f07cad16bd7de7e36c5201" category="paragraph">NetApp VASA Provider 與 vCenter 外掛程式和 REST API 伺服器（先前稱為虛擬儲存主控台 [VSC] ）及儲存複寫介面卡一起執行、是虛擬應用裝置的一部分。如果 VASA Provider 不可用、則使用 vVols 的 VM 將繼續執行。但是、無法建立新的 vVols 資料存放區、而且 VVols 無法由 vSphere 建立或繫結。這表示無法開啟使用 vVols 的虛擬機器、因為 vCenter 將無法要求建立交換 vVol 。而且執行中的 VM 無法使用 VMotion 移轉至其他主機、因為 VVols 無法繫結至新主機。</block>
  <block id="3958bf41787d7fcc6a9f8dd9348c947f" category="paragraph">Vasa Provider 7.1 及更新版本支援新功能、確保服務在需要時可用。其中包括監控 VASA Provider 和整合式資料庫服務的新看門狗程序。如果偵測到故障、它會更新記錄檔、然後自動重新啟動服務。</block>
  <block id="1acc458c695b0d3dfbf588309801fda2" category="paragraph">vSphere 管理員必須使用相同的可用度功能來設定進一步的保護、以保護其他關鍵任務 VM 免於軟體、主機硬體和網路中的故障。虛擬應用裝置不需要額外的組態即可使用這些功能、只要使用標準 vSphere 方法進行設定即可。NetApp 已測試並支援這些解決方案。</block>
  <block id="ff43afff832597ff45e5abeab2826ccf" category="inline-link">適用於 VMware vSphere 的 ONTAP 工具文件（設定 ONTAP 工具的高可用度）</block>
  <block id="d516ca4c9c18446a82d9fc9ee85bd955" category="paragraph">vSphere High Availability 可輕鬆設定為在發生故障時、在主機叢集中的其他主機上重新啟動 VM 。vSphere 容錯功能可建立次要 VM 、以持續複寫、並可隨時接管、進而提供更高的可用度。如需這些功能的詳細資訊、請參閱<block ref="b6d78cbf1d5afb52929c529b32a350ad" category="inline-link-rx"></block>以及 VMware vSphere 文件（請在 ESXi 和 vCenter Server 下尋找 vSphere 可用度）。</block>
  <block id="97ba24d475ff6fdc7743099992cc301f" category="paragraph">ONTAP 工具 VASA Provider 會即時自動備份 VVols 組態至託管 ONTAP 系統、其中 VVols 資訊儲存在 FlexVol Volume 中繼資料中。如果 ONTAP 工具應用裝置因任何原因而無法使用、您可以輕鬆快速地部署新的工具並匯入組態。如需 VASA Provider 恢復步驟的詳細資訊、請參閱本知識庫文章：</block>
  <block id="6799b6ec743f9159edf3b43790210a11" category="inline-link">如何執行 VASA Provider 災難恢復解決方案指南</block>
  <block id="9462790a7557a7eb2fe9daad4b875817" category="paragraph"><block ref="9462790a7557a7eb2fe9daad4b875817" category="inline-link-rx"></block></block>
  <block id="029a7740ecd792264454f9dbe194e980" category="section-title">VVols 複寫</block>
  <block id="c7b26217fd0c9041b6f779a0f669de5c" category="paragraph">許多 ONTAP 客戶使用 NetApp SnapMirror 將傳統的資料存放區複寫到次要儲存系統、然後在發生災難時使用次要系統來恢復個別 VM 或整個站台。在大多數情況下、客戶都會使用軟體工具來管理這項作業、例如 NetApp SnapCenter 外掛程式 for VMware vSphere 等備份軟體產品、或是 VMware 的 Site Recovery Manager （搭配 ONTAP 工具中的儲存複寫介面卡）等災難恢復解決方案。</block>
  <block id="bc6303e4538280b1b01d45a5f7d20039" category="paragraph">這項軟體工具需求對於管理 vVols 複寫更為重要。雖然有些方面可以由原生功能進行管理（例如、 VMware 託管的 vVols 快照會卸載到 ONTAP 、而會使用快速、有效率的檔案或 LUN 複本）、但一般而言、管理複寫和還原需要協調。VVols 的中繼資料受到 ONTAP 和 VASA Provider 的保護、但在次要站台使用時需要額外處理。</block>
  <block id="c6a26835eb364bad22b16cb127b74135" category="paragraph">ONTAP 工具 9.7.1 搭配 VMware Site Recovery Manager （ SRM ） 8.3 版本、新增了災難恢復與移轉工作流程協調的支援、充分利用 NetApp SnapMirror 技術。</block>
  <block id="8142fcf496d02a58ce02a17558db863e" category="paragraph">目前、 VMware SRM 是 NetApp 唯一支援的 vVols 災難恢復與移轉自動化解決方案、 ONTAP 工具會先檢查是否存在已在 vCenter 註冊的 SRM 8.3 或更新版本伺服器、然後再允許您啟用 vVols 複寫、 雖然您可以利用 ONTAP 工具 REST API 來建立自己的服務。</block>
  <block id="7d8e8eced8d8b1a50f20640ffb5d363a" category="section-title">使用 SRM 複寫 VVols</block>
  <block id="c95aede1de7a41511c9d962deba49054" category="section-title">MetroCluster 支援</block>
  <block id="3f15bb720adb42bd521a2ce1cb3a2974" category="paragraph">雖然 ONTAP 工具無法觸發 MetroCluster 切轉、但它確實支援採用統一 vSphere 都會儲存叢集（ VMSC ）組態的 NetApp MetroCluster 系統來支援 VVols 備份磁碟區。MetroCluster 系統的移轉是以正常方式處理。</block>
  <block id="cde16c5ee89c209c821e120caf65bb81" category="paragraph">雖然 NetApp SnapMirror Business Continuity （ SM-BC ）也可作為 VMSC 組態的基礎、但 VVols 目前不支援這項功能。</block>
  <block id="c859f5cd725cb2d1b163e4b066bede9a" category="paragraph">如需 NetApp MetroCluster 的詳細資訊、請參閱以下指南：</block>
  <block id="e5e0fb3ae5564674a6548ade7c601578" category="inline-link">_TR-4689 MetroCluster IP 解決方案架構與設計 _</block>
  <block id="e64de4e49a37e62ff7f8c37e859bbeb9" category="paragraph"><block ref="e64de4e49a37e62ff7f8c37e859bbeb9" category="inline-link-rx"></block></block>
  <block id="0229efec9dc9b9a7fdf144b025157176" category="inline-link">_TR-4705 NetApp MetroCluster 解決方案架構與設計 _</block>
  <block id="6aee4b78ffdfaf193918978472d660a7" category="paragraph"><block ref="6aee4b78ffdfaf193918978472d660a7" category="inline-link-rx"></block></block>
  <block id="876341bac548f230eb390348e8b075ad" category="inline-link">VMware KB 2031038 VMware vSphere 支援 NetApp MetroCluster _</block>
  <block id="5e68486fffeebad2ed145408dc250367" category="paragraph"><block ref="5e68486fffeebad2ed145408dc250367" category="inline-link-rx"></block></block>
  <block id="50c323f7050912164118ba47eab75888" category="section-title">VVols 備份總覽</block>
  <block id="6751e706567f4773c4f3138b4de51a0f" category="paragraph">有幾種方法可以保護 VM 、例如使用客體內備份代理程式、將 VM 資料檔案附加至備份 Proxy 、或使用定義的 API （例如 VMware VADP ）。VVols 可以使用相同的機制來保護、許多 NetApp 合作夥伴也支援 VM 備份、包括 vVols 。</block>
  <block id="416d27c872769e934ac8a49ec98ccb53" category="paragraph">如前所述、 VMware vCenter 託管快照會卸載至節省空間且快速的 ONTAP 檔案 /LUN 複本。這些資料可用於快速手動備份、但 vCenter 最多可限制為 32 個快照。您可以使用 vCenter 拍攝快照、並視需要進行還原。</block>
  <block id="8f3d5ae5bd7d8922841975ccd84b8526" category="paragraph">從 SnapCenter Plugin for VMware vSphere （ SCV ） 4.6 開始、搭配 ONTAP 工具 9.10 及更新版本使用時、新增了對使用 ONTAP FlexVol Volume 快照的 vVols 型虛擬機器的損毀一致備份與還原支援、並支援 SnapMirror 和 SnapVault 複寫。每個磁碟區最多可支援 1023 個快照。此外、選擇控制閥也可以使用 SnapMirror 搭配鏡射儲存庫原則、在次要磁碟區上儲存更多快照、並保留更長的時間。</block>
  <block id="1429a9379faa8e82f8b198e93eebdf61" category="paragraph">vSphere 8.0 支援是採用分離式本機外掛程式架構的 4.7 號選擇控制閥推出的。vSphere 8.0U1 支援已新增至 4 號選擇控制閥 4.8 、該選擇控制閥已完全移轉至新的遠端外掛程式架構。</block>
  <block id="de1d77d00dae616276b6ceb6296a18f2" category="section-title">適用於 VMware vSphere 的 VVols Backup 搭配 SnapCenter 外掛程式</block>
  <block id="02f41838319aab980999b60967d7fd53" category="paragraph">有了 NetApp SnapCenter 、您現在可以根據標籤和 / 或資料夾、為 vVols 建立資源群組、以自動利用 ONTAP 的 FlexVol 快照來執行 vVols 型 VM 。這可讓您定義備份與還原服務、以便在虛擬機器在環境中動態佈建時、自動保護這些虛擬機器。</block>
  <block id="4549a2943666c4815098331d30a872da" category="paragraph">適用於 VMware vSphere 的 SnapCenter 外掛程式部署為登錄為 vCenter 擴充功能的獨立應用裝置、可透過 vCenter UI 或 REST API 進行管理、以實現備份與還原服務自動化。</block>
  <block id="26e2418d177df1dddb008e455ce28752" category="section-title">架構SnapCenter</block>
  <block id="c32197281aa44f57ae568a9a42c7b3b6" category="paragraph">由於其他 SnapCenter 外掛程式在撰寫本文時尚未支援 vVols 、因此我們將著重於本文中的獨立部署模型。</block>
  <block id="6750052f2c0fb06d80a8efd7cb871190" category="paragraph">由於 SnapCenter 使用 ONTAP FlexVol 快照、因此 vSphere 上不會產生任何額外負荷、也不會像傳統 VM 使用 vCenter 託管快照時所見到的效能損失。此外、由於選擇控制閥的功能是透過 REST API 公開、因此使用 VMware Aria Automation 、 Ansible 、 Terraform 等工具、以及幾乎任何其他能夠使用標準 REST API 的自動化工具、都能輕鬆建立自動化工作流程。</block>
  <block id="0c889d77d71512ceb7241bd0f6d6ca23" category="inline-link">REST API總覽</block>
  <block id="35eab4195b135718da016e20979f9031" category="paragraph">如需SnapCenter 有關靜態API的資訊、請參閱<block ref="33852d6f529e96c0b816da3945bcb1e5" category="inline-link-rx"></block></block>
  <block id="4ee2d383554981f4ea8eff4f35db6832" category="inline-link">VMware vSphere REST API的VMware外掛程式SnapCenter</block>
  <block id="63ae61e98eec102c39264a819a3c522e" category="paragraph">如需SnapCenter VMware vSphere REST API的靜態外掛程式資訊、請參閱<block ref="40a6c7462de67e21480b7a31e406f8f9" category="inline-link-rx"></block></block>
  <block id="bdf03d5c2a7086b6c916dc96d06a0a6c" category="paragraph">下列最佳實務做法可協助您充分發揮 SnapCenter 部署的效益。</block>
  <block id="60af6a4208b610da54a63a7e3658d5a5" category="list-text">選擇控制閥同時支援 vCenter Server RBAC 和 ONTAP RBAC 、並包含預先定義的 vCenter 角色、這些角色會在登錄外掛程式時自動為您建立。您可以深入瞭解受支援的 RBAC 類型<block ref="a8ef9d6a500bd8288101245a3828ddb1" category="inline-link-rx"></block></block>
  <block id="0ed0835259b5b8c4b0f0910e7bfe2b17" category="list-text">使用 vCenter UI 、使用所述的預先定義角色指派最低權限的帳戶存取權<block ref="17b3487f3493b9c198e03f92348bfca0" category="inline-link-rx"></block>。</block>
  <block id="d53326766687d6bc7fa2e28ee177e809" category="list-text">如果您在 SnapCenter 伺服器上使用選擇控制閥、則必須指派 _SnapCenterAdmin_ 角色。</block>
  <block id="61ba6cb0b6021c205d41ed7f6fc1eb71" category="list-text">ONTAP RBAC 是指用於新增及管理選擇控制閥所使用儲存系統的使用者帳戶。ONTAP RBAC 不適用於 vVols 型備份。深入瞭解 ONTAP RBAC 和選擇控制閥<block ref="e4e865178d3962f87ac5cef3d6d68942" category="inline-link-rx"></block>。</block>
  <block id="1c89ba258526186ea0ec98325b61371b" category="list-text">使用 SnapMirror 將備份資料集複寫到第二個系統、以取得來源磁碟區的完整複本。如前所述、您也可以使用鏡射資料保險箱原則、以長期保留備份資料、而不受來源磁碟區快照保留設定影響。vVols 支援這兩種機制。</block>
  <block id="9792eeb3b91469abf77746b005d82d77" category="list-text">由於選擇控制閥也需要 VMware vSphere 的 ONTAP 工具才能使用 vVols 功能、因此請務必檢查 NetApp 互通性對照表工具（ IMT ）以瞭解特定版本的相容性</block>
  <block id="71c989bd68059e2ddfa4200c60b736c7" category="list-text">如果您在 VMware SRM 中使用 vVols 複寫、請注意您的原則 RPO 和備份排程</block>
  <block id="604eb779cbb9af378f7bda71633b5b31" category="list-text">使用保留設定來設計備份原則、以符合組織定義的還原點目標（ RPO ）</block>
  <block id="067ff91a08d3ff453b59d81993b96182" category="list-text">在資源群組上設定通知設定、以便在執行備份時收到狀態通知（請參閱下方圖 10 ）</block>
  <block id="c3add00693172bbbb4dd864bf0ad9116" category="section-title">資源群組通知選項</block>
  <block id="6eae9510711f8df8f55a15e1761875d9" category="section-title">使用這些文件開始使用選擇控制閥</block>
  <block id="235a656535515ab3518937c09836e60d" category="inline-link">深入瞭SnapCenter 解VMware vSphere的功能</block>
  <block id="79eb02d2a96cc634df87bec5bd511bbe" category="paragraph"><block ref="79eb02d2a96cc634df87bec5bd511bbe" category="inline-link-rx"></block></block>
  <block id="04e7bb0411c1c8f56ca4fc8000c62ad8" category="inline-link">部署SnapCenter VMware vSphere的VMware vCenter外掛程式</block>
  <block id="d4ba0aa084ae1145248006481c881d29" category="paragraph"><block ref="d4ba0aa084ae1145248006481c881d29" category="inline-link-rx"></block></block>
  <block id="231cf4c70d866b616c21baddaeed0696" category="doc">疑難排解</block>
  <block id="9d2169c1c2855b78a7aeaa4f42d27dc7" category="section-title">NetApp 支援網站</block>
  <block id="ed9018b2e8611a3d2c03bb6a205b9715" category="inline-link">VMware vSphere適用的工具ONTAP</block>
  <block id="fff460b039580a1bd42725a397b4c8be" category="inline-link">NetApp 支援網站</block>
  <block id="897515b5a8a03f8d5cbed44fd47ef9f3" category="paragraph"><block ref="897515b5a8a03f8d5cbed44fd47ef9f3" category="inline-link-rx"></block></block>
  <block id="4020fd07f5ee2361dd23956e6a334ffd" category="paragraph">其他解決方案文件可於此處取得：</block>
  <block id="baf17f6d2396be5fd3676baf863a331f" category="section-title">產品疑難排解</block>
  <block id="9d6d7fa1a5253698556ac2b0cda2207d" category="paragraph">ONTAP 工具的各種元件（例如 vCenter 外掛程式、 VASA Provider 和儲存複寫介面卡）都會記錄在 NetApp 文件儲存庫中。不過、每個都有一個知識庫的個別小節、可能有特定的疑難排解程序。這些解決了 VASA Provider 可能遇到的最常見問題。</block>
  <block id="ae2a93a809929192ecc7b468f234af84" category="section-title">Vasa Provider UI 問題</block>
  <block id="92a2b5cb9c6906035c2864fa225e1940" category="inline-link">文章</block>
  <block id="69aecee18a55993c779487758eb051cc" category="paragraph">vCenter vSphere Web Client 偶爾會遇到與 Serenity 元件有關的問題、導致無法顯示 VASA Provider for ONTAP 功能表項目。請參閱部署指南或本知識庫中的解決 VASA Provider 註冊問題<block ref="c8979f1604396ce5570d07774ba255f0" category="inline-link-rx"></block>。</block>
  <block id="03cc611b90575ea37b55959adaa1c754" category="section-title">VVols 資料存放區資源配置失敗</block>
  <block id="281b890be0e8280eea1aebb82de90961" category="paragraph">有時 vCenter 服務在建立 vVols 資料存放區時可能會逾時。若要修正此問題、請重新啟動 VMware-SPS 服務、然後使用 vCenter 功能表（ Storage &gt; New Datastore ）重新掛載 vVols 資料存放區。本節內容涵蓋《管理指南》中 vCenter Server 6.5 的 VVols 資料存放區資源配置失敗。</block>
  <block id="3152add163cd8aaf116a259d85ebf8fb" category="section-title">升級 Unified Appliance 無法掛載 ISO</block>
  <block id="ffaa56a3f5a1157f2eb3955773bb41da" category="paragraph">由於 vCenter 發生錯誤、用於將 Unified Appliance 從一個版本升級至下一個版本的 ISO 可能無法掛載。如果 ISO 能夠附加至 vCenter 中的應用裝置、請遵循此知識庫中的程序<block ref="9839383ed04f777c0132b57ad0cb14ac" category="inline-link-rx"></block> 以解決此問題。</block>
  <block id="cacba1b456347ce8f32c7f5ed0d81e64" category="doc">部署 VVols Storage</block>
  <block id="3db9849d9f30bfc6e05c4e0b36d28848" category="section-title">將 VM 從傳統資料存放區移轉至 vVols</block>
  <block id="58f2a764a13ec89d3c5ead5343e75637" category="section-title">使用原則管理 VM</block>
  <block id="a4332a81dbc3a9888be608dea640cd3d" category="section-title">建立 VM 儲存原則</block>
  <block id="e65bde48b0a84fcc60d957de90c3a128" category="list-text">變更效能功能（例如最小和最大 IOPS ）需要特別注意特定組態。</block>
  <block id="7de504873f20af5c8ce6dadd2f79b29a" category="list-text">ONTAP 工具會使用目前支援的 ONTAP 版本來建立個別的非共用 QoS 原則。因此、每個個別的 VMDK 都會收到自己的 IOP 分配。</block>
  <block id="63a33ddbd2c3ccd2daac06020248049f" category="section-title">重新套用 VM 儲存原則</block>
  <block id="50b6e1c7f2e81842d993d8ce88acc979" category="summary">支援所有用於虛擬化的主要儲存傳輸協定、例如適用於SAN環境的iSCSI、Fibre Channel（FC）、Fibre Channel over Ethernet（FCoE）或Non-volatile Memory Express over Fibre Channel（NVMe / FC）、以及用於來賓連線的NFS（v3和v4.1）、以及SMB或S3。ONTAP客戶可以自由挑選最適合其環境的產品、並視需要在單一系統上結合各種通訊協定。</block>
  <block id="ee8cc65cae83009c275cd4748f4c58ae" category="doc">適用於VMware的虛擬化工具ONTAP</block>
  <block id="e08c666b5127e745f8aacbacfce37dcf" category="list-text">*適用於ONTAP VMware的VASA Provider for Sfor Sfor the。*適用於ONTAP VMware的VASA Provider支援VMware vStorage API for Storage Aware（VASA）架構。它是ONTAP VMware vSphere的VMware vSphere配套工具、可做為單一虛擬應用裝置、方便部署。VASA Provider將vCenter Server與ONTAP VMware連線、以協助資源配置及監控VM儲存設備。它可支援VMware虛擬磁碟區（vVols）、管理儲存功能設定檔和個別VM vVols效能、以及監控容量和設定檔法規遵循的警示。</block>
  <block id="a1c13ec555198266776a3a7b904810dd" category="paragraph">下圖說明ONTAP vSphere的各項功能。</block>
  <block id="dd55e255500b9ec15305dc69dfa0e15b" category="section-title">適用於VMware VAAI的NFS外掛程式</block>
  <block id="00cdd3f66e02711548cf72d579ec0df8" category="summary">利用此功能、您可以建立可套用至多個工作的備份原則。SnapCenter這些原則可定義排程、保留、複寫及其他功能。它們持續允許選用 VM 一致的快照、利用 Hypervisor 的能力來在拍攝 VMware 快照之前、先關閉 I/O 。</block>
  <block id="f1d1eddd608fe98b6fa2bc3436ce81d0" category="doc">儲存原則型管理和 vVols</block>
  <block id="871db14a81b3510676400538c6f07073" category="paragraph">請看一下這種方法、瞭解它如何簡化虛擬化儲存作業、並避免許多瑣碎的工作。</block>
  <block id="44d75bdf4feecabe2de10427870ae623" category="paragraph">SCP 支援虛擬機器資料 VVols 的最低和 / 或最高 QoS 。只AFF 有在不支援的系統上才支援最低QoS。VMware vSphere的VMware vSphere工具包含儀表板、可顯示VM精細的效能、以及在VMware系統上用於vVols的邏輯容量。ONTAP ONTAP</block>
  <block id="4240fa68f6d9919e6d039c4038175025" category="paragraph">下圖說明ONTAP VMware vSphere 9.8 vVols儀表板的各項功能。</block>
  <block id="50e0e66922b3b12510a128829d1fdc70" category="paragraph">定義儲存功能設定檔之後、就可以使用識別其需求的儲存原則來配置VM。VM儲存原則與資料存放區儲存功能設定檔之間的對應、可讓vCenter顯示相容資料存放區清單以供選擇。這種方法稱為儲存原則型管理。</block>
  <block id="794b6e2fc393d40a552fc58975920cb0" category="paragraph">VASA提供查詢儲存設備的技術、並將一組儲存功能傳回vCenter。VASA廠商供應商會提供儲存系統API與架構之間的轉譯、以及vCenter所瞭解的VMware API。NetApp 的 VASA Provider for ONTAP 是 ONTAP 工具的一部分、適用於 VMware vSphere 應用裝置 VM 、 vCenter 外掛程式則提供介面、可配置及管理 vVol 資料存放區、並可定義儲存功能設定檔（ CDP ）。</block>
  <block id="dad160104969c39365dd2cd4c98dd300" category="inline-link">TR-4400</block>
  <block id="bd490c925219bcb312338a370589bf70" category="list-text">VVol資料存放區可由FlexVol 多個叢集節點上的多個支援功能區所組成。最簡單的方法是單一資料存放區、即使磁碟區具有不同的功能也一樣。SPBM可確保VM使用相容的Volume。然而、這些磁碟區必須全部屬於ONTAP 單一的一套功能、並使用單一傳輸協定來存取。每個節點的每個傳輸協定只需一個LIF就足夠了。避免在ONTAP 單一VVol資料存放區中使用多個版本的支援、因為儲存功能可能因版本而異。</block>
  <block id="0cc956d6da91fefae9dad9b2c8c9519b" category="list-text">使用ONTAP VMware vSphere外掛程式的VMware vCenter工具來建立及管理VVol資料存放區。除了管理資料存放區及其設定檔之外、它還會自動建立傳輸協定端點、以便在需要時存取vVols。如果使用LUN、請注意LUN PE是使用LUN ID 300以上的LUN來對應。確認 ESXi 主機進階系統設定<block ref="ce913b4e625461a33f54f9e4ac38c2d7" prefix=" " category="inline-code"></block> 允許大於 300 的 LUN ID 號碼（預設值為 1,024 ）。若要執行此步驟、請在 vCenter 中選取 ESXi 主機、然後選取「設定」索引標籤、再選取「尋找」<block ref="ce913b4e625461a33f54f9e4ac38c2d7" prefix=" " category="inline-code"></block> 在進階系統設定清單中。</block>
  <block id="fac85f355a1eb47127ef1b94e7603924" category="list-text">請勿安裝或移轉VASA Provider、vCenter Server（應用裝置或Windows）或ONTAP VMware vSphere的各種支援工具到vVols資料存放區、因為這些工具彼此相依、因此在停電或其他資料中心中斷時、您無法管理這些工具。</block>
  <block id="dd76252ea7a50def2a98f218cb1505b4" category="inline-link">知識庫文章</block>
  <block id="15ef75dd3d20b8278c16cd01a708e13e" category="list-text">定期備份VASA Provider VM。至少要為包含 VASA Provider 的傳統資料存放區建立每小時快照。如需保護及恢復VASA Provider的詳細資訊、請參閱此<block ref="9d642870dca1748c69f7aa0b6fb95a89" category="inline-link-rx"></block>。</block>
  <block id="2d2d2e356f9ab117b7d2a58d42cc5988" category="paragraph">下圖顯示vVols元件。</block>
  <block id="d3ba101543fc97ba1dd9272c87bf65da" category="doc">虛擬磁碟區（vVols）與儲存原則型管理（SPBM）</block>
  <block id="fda9c21a4aefd4a1f42ad0b195e6ef0a" category="inline-link">TR-4400: VMware vSphere虛擬Volume ONTAP with VMware</block>
  <block id="61823c0f572643e0ce2e4edcb74cae51" category="paragraph">使用快照快速複製 VM 或資料存放區、而不會影響效能、然後使用 SnapMirror 將其傳送至次要系統、以提供長期的異地資料保護。這種方法只儲存變更的資訊、可將儲存空間和網路頻寬減至最低。</block>
  <block id="1556ba0bf6ea4783cda0ff40e96f0265" category="paragraph">下圖說明SnapCenter 了一套功能性部署的範例。</block>
  <block id="650062685b0df8284f1b87f62fa3f9f3" category="inline-link">TR-4128</block>
  <block id="92515b597b8c0784d6000b89ee47c5fd" category="doc">統一化儲存設備</block>
  <block id="d6154a0901f9ca6bb5d8fb15c113581e" category="paragraph"><block ref="d6154a0901f9ca6bb5d8fb15c113581e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="e9e0f5f2c513c7138ea70b4c929d6fef" category="inline-link">儲存虛擬化</block>
  <block id="400cc516a4a40acd605aef2cfd4ba4c0" category="doc">VMware Storage Distributed Resource Scheduler</block>
  <block id="e7649bfbacc438bf8e20ba3564db4bdd" category="paragraph">接著、它會在資料存放區叢集中的資料存放區之間（也稱為Pod）、在不中斷營運的情況下移動VM或VMDK、並選取將VM或VMDK置於資料存放區叢集中的最佳資料存放區。資料存放區叢集是類似資料存放區的集合、從 vSphere 管理員的觀點來看、這些資料存放區會彙總成單一使用量單位。</block>
  <block id="b028cce2007c32457c41f20d2954c0c2" category="paragraph">SDR的ONTAP 其他最佳實務做法包括：</block>
  <block id="d11eff5be5178b7ba95b06270611ffc8" category="list-text">叢集中的所有資料存放區都應該使用相同類型的儲存設備（例如SAS、SATA或SSD）、無論是所有VMFS或NFS資料存放區、都具有相同的複寫和保護設定。</block>
  <block id="76db7ce67615bbc16da685df79ed0aa9" category="list-text">請考慮在預設（手動）模式下使用SDR。此方法可讓您檢閱建議、並決定是否要套用建議。請注意VMDK移轉的下列影響：</block>
  <block id="97f4ed95cb52bb29629002a25cb5039f" category="list-text">當SDR在資料存放區之間移動VMDK時、ONTAP 任何從還原複製或重複資料刪除所節省的空間都會遺失。您可以重新執行重複資料刪除、以重新獲得這些節約效益。</block>
  <block id="38f492286c3edf236c76e993ce0f0bf2" category="list-text">在 SDR 移動 VMDK 之後、 NetApp 建議在來源資料存放區重新建立快照、因為其他情況下空間會被移動的 VM 鎖定。</block>
  <block id="09a99cbc4fb85d10c7af970e79032a05" category="list-text">在同一個集合體上的資料存放區之間移動VMDK並沒有什麼好處、而且SDR無法看到可能共用該集合體的其他工作負載。</block>
  <block id="09b616c445ab7efa8240062532e526e4" category="doc">VMware vSphere 搭配 ONTAP</block>
  <block id="48e29772cebbf1133d022577e278d5c1" category="admonition">本文件取代先前發佈的技術報告 _TR-4597 ： VMware vSphere for ONTAP _</block>
  <block id="bfa7e7fc7c6bf4cc4e4c5c74b09763eb" category="paragraph">最佳實務做法是輔助其他文件、例如指南和相容性清單。這些技術是根據實驗室測試和NetApp工程師與客戶廣泛的現場經驗所開發。它們可能不是每個環境中唯一能運作的支援實務做法、但通常是最簡單的解決方案、能滿足大多數客戶的需求。</block>
  <block id="9ed4a475dd3705157a9fed8811f63ce2" category="inline-link">NetApp 互通性對照表工具</block>
  <block id="e08175c6fa64cba68719dea85ebd9d34" category="inline-link">VMware相容性指南</block>
  <block id="a110ecc6d4ce7014019c560e5fedf572" category="paragraph">有許多理由讓成千上萬的客戶選擇 ONTAP 作為 vSphere 的儲存解決方案、例如支援 SAN 和 NAS 傳輸協定的統一儲存系統、使用節省空間的快照功能提供強大的資料保護功能、以及豐富的工具來協助您管理應用程式資料。使用與Hypervisor分開的儲存系統、您可以卸載許多功能、並將vSphere主機系統的投資效益最大化。這種方法不僅能確保主機資源專注於應用程式工作負載、也能避免儲存作業對應用程式造成隨機效能影響。</block>
  <block id="7a61ec7965eebc0b5486cb78f096c770" category="list-text">*及更多資訊。*善用NetApp AFF Sa系列陣列的極致效能、加速虛擬化基礎架構、同時管理成本。使用橫向擴充ONTAP 的叢集、享受完全不中斷營運的體驗、從維護到升級、到儲存系統的完整更換。使用NetApp加密功能保護閒置資料、無需額外成本。透過精細的服務品質功能、確保效能符合業務服務層級。它們都是業界領先的企業資料管理軟體 ONTAP 所提供的各種功能的一部分。</block>
  <block id="6104c8ef7be4222a76596ab6a22bb422" category="doc">建議的ESXi主機和其他ONTAP 功能設定</block>
  <block id="678582eb0cbbe0e063e618d230b63223" category="cell">*主機設定*</block>
  <block id="dfe49b73bd7e747701b49f9ed21ea2d6" category="cell">* NetApp推薦價值*</block>
  <block id="edceae57d92287f4f6200f94d3259cd0" category="cell">*需要重新開機*</block>
  <block id="dc3a6955a23583876d020db0f6b80d4d" category="cell">* ESXi進階組態*</block>
  <block id="73663d0d00956f0632e4ae75d811d53f" category="cell">VMFS3.HardwareAcceleratedLocking</block>
  <block id="59b1aceaef0203fdc32e11df232b16e6" category="cell">保留預設值（ 1 ）</block>
  <block id="bafd7322c6e97d25b6299b5d6fe8920b" category="cell">否</block>
  <block id="1b50110aedae4d8d2043a4eb9beb20af" category="cell">VMFS3.EnablBlockDelete</block>
  <block id="316084648bbafe451240702bd19c6ee9" category="cell">VMFS3.EnableVMFS6 取消對應</block>
  <block id="befd90cd01403237f6fdf296822efbee" category="inline-link-macro">VMware vSphere API ：陣列整合（ VAAI ）</block>
  <block id="571cc1d48c6d1ff3cf7e3a54cb035753" category="cell">* NFS 設定 *</block>
  <block id="c3b49a515dd0046685e06092642aa139" category="cell">net.TcpipHeapSize.</block>
  <block id="875f6b98e20edfecb56f9013d00987f6" category="cell">vSphere 6.0或更新版本、設定為32。
所有其他NFS組態、設定為30</block>
  <block id="93cba07454f06a4a960172bbd6e2a435" category="cell">是的</block>
  <block id="504e96cc79e7efe30a8271cea152d9d1" category="cell">net.TcpipHeapMax</block>
  <block id="5f1e7b6431061565550e292d05c73588" category="cell">NFS.MaxVolumes</block>
  <block id="3058676a1cf088aa4a73312ac36f2a58" category="cell">NFS41.MaxVolumes</block>
  <block id="62c07f94c64184ee5d530e4c0917093f" category="cell">vSphere 6.0 或更新版本、設定為 256 。</block>
  <block id="e18600af98c17fae10fdba0dc89979ed" category="cell">NFS.MaxQuesteepeth1^</block>
  <block id="be7707fa525d0124489c9fe3072f78de" category="cell">vSphere 6.0或更新版本、設定為128</block>
  <block id="18e1fb6924459470760771b20ab0c379" category="cell">NFS.HeartbeatMaxFailures</block>
  <block id="138989cbe5dd3a4997662e0f65c17878" category="cell">所有NFS組態皆設為10</block>
  <block id="1aa26eb281359ba3b9a9a4b83a09ed46" category="cell">NFS.Heartbeat頻率</block>
  <block id="7ea6e8664542e3beb1aea10425efb4db" category="cell">針對所有 NFS 組態設定為 12</block>
  <block id="eb4182715f8cde98563dc59ea36461d3" category="cell">NFS.Heartbeattimeout</block>
  <block id="45aa5481fa55802a29a96aefd2f5dab1" category="cell">針對所有 NFS 組態設定為 5 。</block>
  <block id="54a08b15243d9078d3b5a47f8242da6f" category="cell">SUNPC。MaxConnPerIP</block>
  <block id="c0b3fd5512c2093847f753f398290f30" category="cell">* FC/FCoE設定*</block>
  <block id="2e556ad678160413b32dcca55c7d1f5f" category="cell">路徑選擇原則</block>
  <block id="fb62337a3ef32f4701b639339a4ceb33" category="cell">使用具有ALUA的FC路徑時、設定為RR（循環配置資源）。所有其他組態皆設為「固定」。
將此值設為RR有助於在所有主動/最佳化路徑之間提供負載平衡。
固定值適用於舊版非ALUA組態、有助於防止Proxy I/O換句話說、它有助於在Data ONTAP 以7-Mode運作的環境中、讓I/O不再移至高可用度（HA）配對的其他節點</block>
  <block id="117704664d6cada78ac3107380f63d23" category="cell">disk.QFullSampleSize.</block>
  <block id="0e82e1f81de2159b0e9bee0b7be00dc9" category="cell">所有組態皆設為32。
設定此值有助於避免I/O錯誤。</block>
  <block id="f66a3c183f0e736240b77f8b755c880e" category="cell">disk.QFullThreshold</block>
  <block id="bdd8c1d08eabb5e1923ed8f0c4b10ba4" category="cell">所有組態均設為8。
設定此值有助於避免I/O錯誤。</block>
  <block id="19c08de7404551288e1274186e039ef4" category="cell">Emulex FC HBA逾時</block>
  <block id="b4dbfc2d52627e923cbb563a31ff756d" category="cell">使用預設值。</block>
  <block id="d46cddda4da7ec11f17472d11df95b68" category="cell">QLogic FC HBA逾時</block>
  <block id="19b5aaf3e2cb86809996ca63a2a416b0" category="cell">* iSCSI設定*</block>
  <block id="2aa077454308383f1e82025427cd7362" category="cell">所有iSCSI路徑均設為RR（循環配置資源）。
將此值設為RR有助於在所有主動/最佳化路徑之間提供負載平衡。</block>
  <block id="0340eb1bcbfc6cd3c62b8a878d8d643b" category="cell">所有組態皆設為32。
設定此值有助於避免I/O錯誤</block>
  <block id="891c10448731ad57490b9a932dabfff8" category="inline-link-macro">VMware KB 86331</block>
  <block id="fb55ee99c04280ac638757869929785d" category="paragraph">建立完等量磁碟區和LUN時、也會指定特定的預設設定：ONTAP ONTAP FlexVol</block>
  <block id="3f7502a5f109d7a73706aba1c0741a4b" category="cell">*《*》工具* ONTAP</block>
  <block id="485577e97e8efcd504fc8e8b13e613f1" category="cell">*預設設定*</block>
  <block id="5938fe448c8661febcef3f4e779e3adb" category="cell">Snapshot保留（-%快照空間）</block>
  <block id="cfcd208495d565ef66e7dff9f98764da" category="cell">0%</block>
  <block id="7218aec62575561a6de1cae8d5658390" category="cell">部分保留（-分數保留）</block>
  <block id="3a7e09ff0fa38663ffe6d91324ea75d9" category="cell">存取時間更新（-atime-update）</block>
  <block id="f8320b26d30ab433c5a54546d21f414c" category="cell">錯</block>
  <block id="e93200d5b0d16915bf04236790544b2f" category="cell">最小預先讀取（-min-readahead）</block>
  <block id="c877d89702fdd14e51b02028a20c7d07" category="cell">排程快照</block>
  <block id="fd18465573ec21a6218982055981f6b1" category="cell">儲存效率</block>
  <block id="00d23a76e43b46dae9ec7aa9dcbebb32" category="cell">已啟用</block>
  <block id="f65fd63b63c9e9f25bf6bc141e83de34" category="cell">Volume保證</block>
  <block id="c2410aebdf425dabcc65e546e506b03e" category="cell">無（精簡配置）</block>
  <block id="f97c03bf3e9580446d70d479f5aad1e0" category="cell">Volume自動調整大小</block>
  <block id="d89f4f8b1d7c18847b88b46142f61535" category="cell">大幅縮減</block>
  <block id="ace72ec54e17777d27eb8bdb9d57e782" category="cell">LUN空間保留</block>
  <block id="b9f5c797ebbf55adccdd8539a65a0241" category="cell">已停用</block>
  <block id="514aa7792a71ab4ab677eb2385131aae" category="cell">LUN空間配置</block>
  <block id="dbe1e98b00264bd496095ed5c95f9350" category="section-title">效能的多重路徑設定</block>
  <block id="de9f44b08eec22d6b405acff2c925d56" category="paragraph">雖然目前未由可用的 ONTAP 工具進行設定、 NetApp 仍會建議下列組態選項：</block>
  <block id="01d954fb2edbf283d121f0651b04de83" category="section-title">其他文件</block>
  <block id="40db5019ed68654f4eb2cf21ec5021db" category="inline-link">搭配 ONTAP 使用 VMware vSphere 7.x</block>
  <block id="30d85838b9488ee908d075559c8978cd" category="inline-link">搭配 ONTAP 使用 VMware vSphere 8.x</block>
  <block id="000c9205416c1ea85f6841a7ca379c17" category="inline-link">如需更多詳細資料、請參閱適用於 ESXi 7.x with ONTAP 的 NVMe 主機組態</block>
  <block id="5a27e6dbe6279e323aec51d205b2b455" category="inline-link">如需更多詳細資料、請參閱適用於 ESXi 8.x 與 ONTAP 的 NVMe 主機組態</block>
  <block id="99a66df20e19a8e18fae37a7f714750a" category="doc">虛擬機器與資料存放區複製</block>
  <block id="fe12a277656562082ad50b980c227a84" category="paragraph">在vSphere中、您可以複製VM、虛擬磁碟、vVol或資料存放區。複製之後、通常可透過自動化程序、進一步自訂物件。vSphere同時支援完整複本複本複本複本、以及連結的複本、可在其中分別追蹤原始物件的變更。</block>
  <block id="883a97a36ab0c59ec785b03161a1cc32" category="paragraph">連結的複本非常適合用來節省空間、但會增加vSphere處理VM的I/O量、進而影響該VM的效能、甚至可能影響整個主機的效能。這就是 NetApp 客戶經常使用儲存系統型複本來充分發揮兩者優勢的原因：有效使用儲存設備並提高效能。</block>
  <block id="17e1a153b5d05c5a642c93ba9ce3c6de" category="paragraph">下圖說明ONTAP 了還原複製。</block>
  <block id="d957242cd67db8ffccec78d93c14449d" category="list-text">VVols使用NetApp vSphere API for Storage Aware（VASA）Provider。  ONTAP 複本可用於支援 vCenter 管理的 vVol 快照、這些快照的空間效率極低、而且 I/O 效果極低、可用來建立和刪除這些快照。  也可以使用vCenter複製VM、這些VM也會卸載到ONTAP VMware、無論是在單一資料存放區/ Volume內、或是在資料存放區/磁碟區之間。</block>
  <block id="f3968368501d882b3969da59138db6e2" category="paragraph">您也可以直接複製ONTAP 實體內部的磁碟區或LUN、以複製資料存放區。有了NFS資料存放區、FlexClone技術就能複製整個Volume、而且可從ONTAP VMware匯出該實體複本、並由ESXi作為另一個資料存放區來掛載。對於VMFS資料存放區、ONTAP VMware可以複製一個或整個Volume內的LUN、包括其中的一個或多個LUN。包含VMFS的LUN必須對應至ESXi啟動器群組（igroup）、然後由ESXi重新簽名、才能掛載並作為一般資料存放區使用。在某些臨時使用案例中、可以掛載複製的VMFS、而無需重新簽名。複製資料存放區之後、就可以登錄、重新設定及自訂其中的VM、就像是個別複製的VM一樣。</block>
  <block id="2d506b6088a383ccf08479b0f80c0ff4" category="paragraph">在某些情況下、您可以使用額外的授權功能來強化複製功能、例如SnapRestore 針對備份或FlexClone的功能。這些授權通常包含在授權套裝組合中、不需額外付費。vVol 複製作業需要 FlexClone 授權、也必須支援 vVol 的託管快照（從 Hypervisor 卸載至 ONTAP ）。FlexClone授權也能在資料存放區/磁碟區內使用時、改善特定的VAAI型複本（建立即時、節省空間的複本、而非區塊複本）。  SRA也會在測試災難恢復複本的恢復時使用此複本、SnapCenter 而使用此複本來執行複製作業、並瀏覽備份複本來還原個別檔案。</block>
  <block id="5dd57c2a315d3af44c2eb40eefc47111" category="doc">網路組態</block>
  <block id="66507f357c74ee12194270cfe053b98d" category="paragraph">以下是幾點需要考量的事項：</block>
  <block id="7c4904daaa282388097ad83bf382e1a5" category="list-text">如果您的網路需要並支援巨型框架、尤其是使用iSCSI時、可以使用巨型框架。如果使用、請確定在儲存設備和ESXi主機之間的路徑中、所有網路裝置、VLAN等上的設定都相同。否則、您可能會看到效能或連線問題。MTU也必須在ESXi虛擬交換器、VMkernel連接埠、以及每ONTAP 個節點的實體連接埠或介面群組上設定相同。</block>
  <block id="8b6e7f43d1d697e8f99164f0aa2ab1b6" category="inline-link">TR-4182</block>
  <block id="730a8287f758961d602b1b050bbe2751" category="list-text">當ESXi和ONTAP VMware ESXi儲存陣列連接至乙太網路儲存網路時、NetApp建議將這些系統連接的乙太網路連接埠設定為快速擴充樹狀傳輸協定（RSTP）邊緣連接埠、或使用Cisco PortFast功能。NetApp建議在使用Cisco PortFast功能的環境中、啟用跨距樹狀結構PortFast主幹功能、並在ESXi伺服器或ONTAP VMware®儲存陣列上啟用802.1Q VLAN主幹連線。</block>
  <block id="ac4976538e1fc8726f77afc202561afc" category="list-text">NetApp建議下列連結集合最佳實務做法：</block>
  <block id="19d137845c7f6687c99b386dfad0aa97" category="list-text">除非您使用已設定LACP的DVSwitches 5.1或更新版本、否則請停用連接至ESXi的交換器連接埠LACP。</block>
  <block id="30254a2bb3e4b3b958b06d08c724e7db" category="list-text">使用LACP建立鏈路集合體、以動態ONTAP 多重模式介面群組搭配IP雜湊、以利支援靜態儲存系統。</block>
  <block id="d608421cceb8e4c584a2a32d9127879e" category="list-text">在ESXi上使用IP雜湊群組原則。</block>
  <block id="2432030fc6183a1a6c52cf5e93f3e9ae" category="paragraph">下表提供網路組態項目的摘要、並指出套用設定的位置。</block>
  <block id="7d74f3b92b19da5e606d737d339a9679" category="cell">項目</block>
  <block id="1aa66ef3a8e34a7a538960a80d2e1e31" category="cell">ESXi</block>
  <block id="bbc155fb2b111bf61c4f5ff892915e6b" category="cell">交換器</block>
  <block id="6c3a6944a808a7c0bbb6788dbec54a9f" category="cell">節點</block>
  <block id="0b7e67b6cdcf0432b624d53588d520fb" category="cell">SVM</block>
  <block id="75ba8d70e3692ba200f0e0df37b4d2ae" category="cell">IP 位址</block>
  <block id="ee6c0f25c2881cc69947a2ef23be5b8c" category="cell">VMkernel</block>
  <block id="e11f298a5bd5344d2d975b5157c27b69" category="cell">否*</block>
  <block id="d6f0876f76c273b8962b749c36153157" category="cell">連結集合體</block>
  <block id="fabd320b3b2249377e53e93099e27657" category="cell">虛擬交換器</block>
  <block id="b1b40427c8eb8d0a083ddb16e250325b" category="cell">否*</block>
  <block id="9881f82f0dd89588831f9d1682bd5492" category="cell">VLAN</block>
  <block id="5fc0d231160fa9650ea5c877f146bbe6" category="cell">VMkernel和VM連接埠群組</block>
  <block id="39a3e05f380e583ae2887c79c7443f11" category="cell">流程控制</block>
  <block id="220071ab44b426f80ef21f1c552c363c" category="cell">NIC</block>
  <block id="6f2c08412f489e52a17a30217f50b3c1" category="cell">跨距樹狀結構</block>
  <block id="4b1c0df98ba3f3d1681c3c3dbdc97746" category="cell">MTU（用於巨型框架）</block>
  <block id="7d6feaf896df4a937157d4ee5b91f4e1" category="cell">虛擬交換器與VMkernel連接埠（9000）</block>
  <block id="0110e50bd8629573701e73a4ba8b056f" category="cell">是（設為上限）</block>
  <block id="061ff5255adf00e4ae68469f43a7bf55" category="cell">有（9000）</block>
  <block id="bcc0e5a3e08cd34e80692195d056b06d" category="cell">容錯移轉群組</block>
  <block id="a4d1a66a448e327c12d3e287098a31d5" category="cell">是（建立）</block>
  <block id="465d5674eb6808b997037470f4dace73" category="cell">是（選取）</block>
  <block id="ba78d695573c8d4f1205452c675fa539" category="paragraph">* SVM lifs連接到具有VLAN、MTU及其他設定的連接埠、介面群組或VLAN介面。不過、這些設定不會在SVM層級進行管理。</block>
  <block id="50ecdab93bf5a2f1bfb4cd8f81b9bd3d" category="paragraph">這些裝置擁有自己的IP位址進行管理、但這些位址並未用於ESXi儲存網路環境。</block>
  <block id="efd0bde36323238fec688b9cdf0c75a3" category="section-title">SAN（FC、FCoE、NVMe/FC、iSCSI）、RDM</block>
  <block id="8982d243303f9d1a8c2470b7d55278e6" category="list-text">使用VMFS資料存放區</block>
  <block id="9a0098c8c1be287e8d1da1aaf3bd2e59" category="list-text">使用原始裝置對應（RDM）</block>
  <block id="8466b1e5abb4751e931c5feb1af4e469" category="inline-link">TR-4080</block>
  <block id="4157f0c23fc104508f492dc846f187f3" category="list-text">根據預設、會啟用SLM.除非您使用連接埠集、否則不需要額外的組態。</block>
  <block id="ed0e76ed86e852bd7317a09d856ec4e8" category="paragraph">其他應考慮的最佳實務做法：</block>
  <block id="93586ad57931e0f16fff61cdba9d77df" category="list-text">請確定ONTAP 已為叢集中每個節點上的每個SVM建立邏輯介面（LIF）、以達到最大可用度和行動性。最佳實務做法是每個節點使用兩個實體連接埠和LIF、每個光纖使用一個連接埠。ONTAPALUA可用來剖析路徑、識別作用中最佳化（直接）路徑、以及作用中未最佳化路徑。ALUA用於FC、FCoE和iSCSI。</block>
  <block id="b3cebb7381bddbabb1e950a46d264190" category="list-text">對於iSCSI網路、當存在多個虛擬交換器時、請在不同的網路子網路上使用多個VMkernel網路介面搭配NIC群組。您也可以使用多個實體NIC來連接至多個實體交換器、以提供HA並提高處理量。下圖提供多重路徑連線的範例。在靜態中ONTAP 、設定單一模式介面群組以容錯移轉兩個或多個連結連接至兩個或多個交換器、或使用LACP或其他連結集合技術搭配多重模式介面群組、以提供HA及連結集合的優點。</block>
  <block id="2968b9f3c141bf23bc73d0e6e15a174a" category="list-text">如果 ESXi 中使用挑戰握手驗證傳輸協定（ CHAP ）進行目標驗證、則也必須使用 CLI 在 ONTAP 中進行設定 <block ref="199c9b970eacf1c35d84a383b7ceb210" prefix="(" category="inline-code"></block>）或使用 System Manager （在 Storage （儲存） &gt; SVM （ SVM ） &gt; SVM Settings （ SVM 設定） &gt; Protocols （傳輸協定） &gt; iSCSI （ iSCSI ）下編輯啟動器安全性）。</block>
  <block id="d31f2e075df4ca75ca0874fa08f74b12" category="list-text">使用VMware vSphere的VMware vCenter工具來建立及管理LUN和群組。ONTAP外掛程式會自動決定伺服器的WWPN、並建立適當的igroup。它也會根據最佳實務做法來設定LUN、並將其對應至正確的igroup。</block>
  <block id="de78559e8aed2cd62fbf852f73dc58c2" category="inline-link">實體與虛擬相容模式</block>
  <block id="905221150fdd103b5241870a0a1f2c42" category="list-text">請謹慎使用 RDM 、因為它們可能較難管理、而且也會使用路徑、而路徑的限制如前所述。支援這兩種LUN ONTAP<block ref="27e1f8e5a88cfbb2836b083145b004c9" category="inline-link-rx"></block> RDM。</block>
  <block id="636da39a2033c6179a718983c5ce1222" category="inline-link">NVMe / FC主機組態指南ONTAP</block>
  <block id="81ef6507a13da5635951bc5b533deb59" category="inline-link">TR-4684</block>
  <block id="15483b0826bb9a4b11d1c89af2029c5c" category="list-text">如需更多關於將NVMe/FC搭配vSphere 7.0使用的資訊、請參閱此<block ref="6b4ed262d14e47ef641cd57b65c32c38" category="inline-link-rx"></block> 和<block ref="7a29b2f31035a451d5b068728d2b79a7" category="inline-link-rx"></block>下圖說明從vSphere主機到ONTAP VMware LUN的多重路徑連線能力。</block>
  <block id="743fa5a7bc7d4ba215b096e34779d298" category="paragraph">搭配ONTAP vSphere使用VMware NFS時、建議採用下列最佳實務做法：</block>
  <block id="ae4c5baa79e370d8f601cc7082f8123e" category="list-text">由於NFSv3與NFSv4.1之間沒有自動資料存放區轉換、因此請建立新的NFSv4.1資料存放區、並使用Storage VMotion將VM移轉至新的資料存放區。</block>
  <block id="bd6cc42f9cd65cca72cbd56d2f4bf43d" category="list-text">RO存取規則：系統</block>
  <block id="0bbc71e6a4ea49af70dd616d3807e524" category="list-text">匿名 UID</block>
  <block id="6670a317619282ec228a9ef492af0a76" category="list-text">NFS資料存放區磁碟區是從SVM的根磁碟區連結而來、因此ESXi也必須能夠存取根磁碟區、才能瀏覽及掛載資料存放區磁碟區。根 Volume 和資料存放區磁碟區交會嵌套的任何其他磁碟區的匯出原則、都必須包含 ESXi 伺服器授予其唯讀存取權的規則或規則。以下是根 Volume 的範例原則、也使用 VAAI 外掛程式：</block>
  <block id="8c93fb3ff528165613797962f5a0ed9c" category="list-text">存取傳輸協定：NFS（包括nfs3和nfs4）</block>
  <block id="80e6a4f964e826c69c1c62bd5ea67590" category="list-text">RW存取規則：Never（root Volume的最佳安全性）</block>
  <block id="f96625174b4a06d13267f9b0a5a96d59" category="list-text">超級使用者：sys（也適用於採用VAAI的根Volume）</block>
  <block id="4c571520a8128d1692fc709ffbfb2b1e" category="list-text">使用ONTAP VMware vSphere的VMware Infrastructure（最重要的最佳實務做法）：</block>
  <block id="23aa7b9aeed3fba2a1ec43e630313af7" category="list-text">使用外掛程式為VMware叢集建立資料存放區時、請選取叢集而非單一ESX伺服器。此選項會觸發IT自動將資料存放區掛載至叢集中的所有主機。</block>
  <block id="928562eb576ed6ae31cb1a149d3e751a" category="list-text">如果不使用ONTAP VMware vSphere的VMware vSphere功能、請針對所有伺服器或需要額外存取控制的每個伺服器叢集、使用單一匯出原則。</block>
  <block id="7bccab0fa4c0864835c645c9fde7ebf6" category="list-text">雖然供應彈性的Volume命名空間結構、可利用交會在樹狀結構中排列磁碟區、但這種方法對vSphere沒有任何價值。ONTAP無論儲存設備的命名空間階層為何、它都會在資料存放區根目錄中為每個VM建立一個目錄。因此、最佳實務做法是將vSphere磁碟區的交會路徑掛載到SVM的根磁碟區、這就是ONTAP VMware vSphere的VMware vSphere功能如何配置資料存放區。沒有巢狀結點路徑也表示除了根磁碟區之外、沒有任何磁碟區相依於任何磁碟區、即使是刻意將磁碟區離線或銷毀、也不會影響其他磁碟區的路徑。</block>
  <block id="ea6fc1288f1d3b21238d29ff28cb867a" category="list-text">對於NFS資料存放區上的NTFS分割區、4K區塊大小是可以的。下圖說明從vSphere主機連線至ONTAP VMware NFS資料存放區的能力。</block>
  <block id="e54433644e830ed1503561b778e9ded4" category="paragraph">下表列出NFS版本及支援的功能。</block>
  <block id="9fb9dac7513c7ef8452aade8a52ad40d" category="cell">vSphere功能</block>
  <block id="5b12ee0369243579651edca43ff65c85" category="cell">NFSv3.</block>
  <block id="de841868c2911da76b8ae2da9fa3166d" category="cell">NFSv4.1</block>
  <block id="64e3cc476958b05086721cd6070004cf" category="cell">vMotion與Storage vMotion</block>
  <block id="05807e454c19f244770adae059b3c330" category="cell">高可用度</block>
  <block id="45a75e44a713fdf94dbf1dbaa0749188" category="cell">容錯能力</block>
  <block id="f1e3446c69e4d87279ff7863482f9dcb" category="cell">DRS</block>
  <block id="6ca09f98e8925b2cb78bbf24eccc0186" category="cell">主機設定檔</block>
  <block id="ec8420797e3b089812499cce4047ded8" category="cell">儲存DRS</block>
  <block id="7c19bf1cbe62a87a42857ef0b4fe22ae" category="cell">儲存I/O控制</block>
  <block id="56d43ad1a280ada5e16fd2960ae44b32" category="cell">SRM</block>
  <block id="d595c8f30866b71ea121ced5cde66b1d" category="cell">虛擬磁碟區</block>
  <block id="6ad5114acf73f68a85c72f11646920cb" category="cell">硬體加速（VAAI）</block>
  <block id="ad37ded9046268d8e5ea7cb253bb5dda" category="cell">Kerberos驗證</block>
  <block id="45701e6ef9bc09dca07f8f4abe661dc6" category="cell">是（vSphere 6.5及更新版本增強支援AES、krb5i）</block>
  <block id="76969a36155d2f41fc6cc3bd3faff244" category="cell">多重路徑支援</block>
  <block id="be0ec3d9251292dd856ea0924ecc6873" category="doc">服務品質（QoS）</block>
  <block id="534ecd446aac2f9c809eef9064f44aab" category="paragraph">物件的QoS最大處理量限制可設定為Mbps和/或IOPS。如果兩者皆使用、ONTAP 則由支援執行第一個上限。工作負載可以包含多個物件、QoS原則也可以套用至一或多個工作負載。當原則套用至多個工作負載時、工作負載會共用原則的總限制。不支援巢狀物件（例如、磁碟區內的檔案無法各自擁有自己的原則）。QoS最低值只能以IOPS設定。</block>
  <block id="040f184b126879657b253b6d258661d9" category="paragraph">下列工具目前可用於管理ONTAP 不實的QoS原則、並將其套用至物件：</block>
  <block id="de134183bea5df515a6756a539ce6f18" category="list-text">CLI ONTAP</block>
  <block id="6ad5e0a20f49ad6a370454bb3afc9a9e" category="list-text">系統管理程式ONTAP</block>
  <block id="8e23e05fc0865e950d6a3581e0dd8ce9" category="list-text">OnCommand Workflow Automation</block>
  <block id="5ecb6b24c169667ff1a176768115659e" category="list-text">Active IQ Unified Manager</block>
  <block id="8cc4e713850f67a131e9dbf8b997f61e" category="list-text">NetApp PowerShell Toolkit for ONTAP</block>
  <block id="fcdb48d0d22627e4910a8352c80bd87a" category="list-text">VMware vSphere VASA Provider適用的工具ONTAP</block>
  <block id="e6defd03e0f49585b6d47614713e97f7" category="paragraph">若要將QoS原則指派給NFS上的VMDK、請注意下列準則：</block>
  <block id="2175e0e29bc4b213fa8b9c7afd591b6b" category="list-text">請勿將原則套用至其他 VM 檔案、例如虛擬交換檔案 <block ref="aa33c3c1850a3f99cec7426e2c411d08" prefix="(" category="inline-code"></block>）。</block>
  <block id="8230e9b5c1e9862fedb2c69f7cc5d3d1" category="list-text">使用 vSphere Web 用戶端尋找檔案路徑（資料存放區 &gt; 檔案）時、請注意它會結合的資訊<block ref="f149d7424e10a266ec998ca5b32b81bb" prefix=" " category="inline-code"></block> 和<block ref="4a78be158c13cd6b2dc2100a80bb7070" prefix=" " category="inline-code"></block> 只要顯示一個檔案、其中包含的名稱即可<block ref="4a78be158c13cd6b2dc2100a80bb7070" prefix=" " category="inline-code"></block> 但是的大小<block ref="f149d7424e10a266ec998ca5b32b81bb" prefix=" " category="inline-code"></block>。新增<block ref="4fc4e556dbb9dcede037ccd80fabd784" prefix=" " category="inline-code"></block> 輸入檔案名稱以取得正確路徑。</block>
  <block id="1d4614aca13104c98d5d8cc2d415b941" category="paragraph">若要將QoS原則指派給LUN、包括VMFS和RDM、ONTAP 顯示為Vserver的SVM、LUN路徑和序號、可從ONTAP VMware vSphere的「VMware vSphere的VMware vSphere」（VMware vSphere）「VMware vCenter工具」首頁上的「儲存系統」功能表取得。選取儲存系統（ SVM ）、然後選取相關物件 &gt; SAN 。  使用ONTAP 其中一項功能來指定QoS時、請使用此方法。</block>
  <block id="77bb2ba950959bd3f1c55da523ace0be" category="section-title">QoS和VMware SIOC ONTAP</block>
  <block id="5ad234cb2cde4266195252a23ca7d84e" category="cell">屬性</block>
  <block id="b8b8d1ba8fa345f03438a90f29af5784" category="cell">QoS ONTAP</block>
  <block id="c2a4cb962db2a4a6782b69864f0e411c" category="cell">VMware SIOC</block>
  <block id="aa628d5a66888444926b4dc042458200" category="cell">當作用中時</block>
  <block id="688b10fcfff927dee65634e3b3636064" category="cell">原則永遠處於作用中狀態</block>
  <block id="a981c4aa67c29ff2d36fc614d8b28808" category="cell">存在爭用時作用中（超過臨界值的資料存放區延遲）</block>
  <block id="f46e64a82c96db56f3d6657d4fb53f00" category="cell">單位類型</block>
  <block id="878b4223bb85b95d8caf0429d9406cd5" category="cell">IOPS、Mbps</block>
  <block id="3e189a34f422a141311dad231f9ad5b5" category="cell">IOPS、共享</block>
  <block id="7367a0ec46339213625cbc77d56a9572" category="cell">vCenter或應用程式範圍</block>
  <block id="1faff19290bb64ce8ff6bc1220496881" category="cell">多個vCenter環境、其他Hypervisor和應用程式</block>
  <block id="1e664a3cc0ab109fcabcc81b488cebb1" category="cell">單一vCenter伺服器</block>
  <block id="ebccc9f5c939841d86e5382988dfcc47" category="cell">在VM上設定QoS？</block>
  <block id="cddd0980ce99890d2ea90288f6b03117" category="cell">僅NFS上的VMDK</block>
  <block id="928629d8a2a889f5274cad9940a06da0" category="cell">NFS或VMFS上的VMDK</block>
  <block id="305e85b992089534091855224f60cf75" category="cell">設定LUN上的QoS（RDM）？</block>
  <block id="e798014243cf5682e7fb3aaf4ee7cecf" category="cell">在LUN（VMFS）上設定QoS？</block>
  <block id="9cd021ea9d3c88de723fe9a2e50a2380" category="cell">在Volume（NFS資料存放區）上設定QoS？</block>
  <block id="c352b53c32380efcf4436926da6d0414" category="cell">在SVM（租戶）上設定QoS？</block>
  <block id="5dad340ee8f9e8fa9b65bf86a9fd5341" category="cell">以原則為基礎的方法？</block>
  <block id="b31c76176f26196c6379a9bcce212d99" category="cell">是；可由原則中的所有工作負載共用、或完全套用至原則中的每個工作負載。</block>
  <block id="1ff33557bad923d68973872cacf2e43a" category="cell">是、使用vSphere 6.5及更新版本。</block>
  <block id="d5f1465492190ee9d30a09b36f64f4b7" category="cell">需要授權</block>
  <block id="4cec76d82991abd453484c23f7e3788a" category="cell">隨附ONTAP 於此功能</block>
  <block id="6bb36803f4670824ff9ebdf665654829" category="cell">Enterprise Plus</block>
  <block id="d4d4b5b65bebf236590d70c702a6ba6b" category="paragraph">VMware儲存分散式資源排程器（SDR）是vSphere功能、可根據目前的I/O延遲和空間使用量、將VM放置在儲存設備上。接著、它會在資料存放區叢集中的資料存放區之間（也稱為Pod）、在不中斷營運的情況下移動VM或VMDK、並選取將VM或VMDK置於資料存放區叢集中的最佳資料存放區。資料存放區叢集是類似資料存放區的集合、從 vSphere 管理員的觀點來看、這些資料存放區會彙總成單一使用量單位。</block>
  <block id="0ce8b0e3e0d7dc7f39c62fb74a28b3bf" category="section-title">雲端移轉與備份</block>
  <block id="4fe11b4a91ff38ec9933009a15dd5b0b" category="paragraph">另一ONTAP 項優勢是廣泛支援混合雲、將內部部署私有雲中的系統與公有雲功能合併在一起。以下是一些可搭配vSphere使用的NetApp雲端解決方案：</block>
  <block id="99c6c4d349151c1f4a6694e424aef741" category="inline-link">儲存更多 VM 快照</block>
  <block id="01fa297dbdab5aceb83a45a98161efe0" category="list-text">* FabricPool 《*》FabricPool *《*》*《*》提供快速且簡單的ONTAP 資料分層功能。冷區塊可移轉至公有雲或私有 StorageGRID 物件存放區中的物件存放區、並在再次存取 ONTAP 資料時自動重新叫用。或是將物件層用作SnapVault 已由效益管理的資料的第三層保護。您可以使用這種方法<block ref="60d027dbb3c3f076cbb70c6b246eb433" category="inline-link-rx"></block> 在一線ONTAP 和/或二線的不二元儲存系統上。</block>
  <block id="1a7072854c9dd945a98f4314b3f77408" category="list-text">*《*》。*使用NetApp軟體定義的儲存設備、將您的私有雲端延伸至遠端設施和辦公室、您可以使用《》來支援區塊和檔案服務、以及您在企業資料中心擁有的相同vSphere資料管理功能。ONTAP Select ONTAP Select</block>
  <block id="af63597853dc0983258c8f86a12aae0b" category="section-title">vSphere資料加密</block>
  <block id="63a07ab9352c9297cea3894d6cd41c3f" category="paragraph">如今、透過加密保護閒置資料的需求與日俱增。雖然最初的重點是財務和醫療資訊、但無論資訊儲存在檔案、資料庫或其他資料類型中、都越來越有興趣保護所有資訊。</block>
  <block id="937a352e0f824ff55e4cd50c8e3b051e" category="paragraph">有幾種方法可以保護在VMware vSphere上執行的虛擬化應用程式資料。其中一種方法是在客體作業系統層級使用VM內部的軟體來保護資料。vSphere 6.5等較新的Hypervisor現在也支援VM層級的加密、這是另一種替代方案。不過、NetApp軟體加密既簡單又簡單、而且具有下列優點：</block>
  <block id="6eda79cc710edc32583cf567b00e7672" category="list-text">*對虛擬伺服器CPU沒有影響。*某些虛擬伺服器環境需要其應用程式的每個可用CPU週期、但測試顯示、Hypervisor層級加密需要高達5倍的CPU資源。即使加密軟體支援 Intel 的 AES-NI 指令集來卸載加密工作負載（如同 NetApp 軟體加密一樣）、由於新的 CPU 與舊版伺服器不相容、因此這種方法可能不可行。</block>
  <block id="c216121021de8554d33503ef6616b256" category="list-text">*對儲存效率沒有影響。*目前廣泛使用重複資料刪除與壓縮等儲存效率技術、是以具成本效益的方式使用Flash磁碟媒體的關鍵。不過、加密資料通常無法進行重複資料刪除或壓縮。NetApp硬體與儲存加密的運作層級較低、可充分運用領先業界的NetApp儲存效率功能、不像其他方法。</block>
  <block id="5f9aa8333f218d1c21e67c8608a48672" category="list-text">*輕鬆進行資料存放區精細加密。*有了NetApp Volume Encryption、每個磁碟區都能獲得自己的AES 256位元金鑰。如果您需要變更、只要使用一個命令即可。如果您有多個租戶、或需要證明不同部門或應用程式的獨立加密、這種方法非常適合。這種加密是在資料存放區層級進行管理、比管理個別VM容易得多。</block>
  <block id="c95fa5b56a01e5c1a80c540c1ab1a750" category="paragraph">利用VMware Infrastructure、您可以清楚掌握虛擬基礎架構中的虛擬機器、並監控及疑難排解虛擬環境中的儲存與效能問題。Active IQ Unified Manager</block>
  <block id="be75250c2f30870dc1e359b4ade2a767" category="paragraph">典型的虛擬基礎架構部署ONTAP 在整個運算、網路和儲存層之間、有許多不同的元件。VM應用程式中的任何效能延遲都可能是因為各個元件在各個層面上所面臨的延遲問題。</block>
  <block id="d1734f6f2e65a1488896f74695db5254" category="paragraph">下列螢幕快照顯示Active IQ Unified Manager 「VMware虛擬機器」檢視畫面。</block>
  <block id="2118336fa447fcc0f213cb8c40c516af" category="paragraph">Unified Manager會在拓撲檢視中呈現虛擬環境的底層子系統、以判斷運算節點、網路或儲存設備是否發生延遲問題。此檢視也會強調導致效能延遲的特定物件、以便採取補救步驟並解決根本問題。</block>
  <block id="d8a78b994fcd4e04901203a2e7bc6414" category="paragraph">下列螢幕快照顯示AIQUM擴充拓撲。</block>
  <block id="f02207fb26160d7e47cf5ea35d07df03" category="doc">資料存放區與傳輸協定</block>
  <block id="a7c815fafe60ae637d38216fa6300395" category="list-text">FCP</block>
  <block id="26bcb9f1cb6f391f4b2c18e676bb458d" category="list-text">NVMe / FC</block>
  <block id="8b7c42123642e2e4ea7dd426aeb2de58" category="list-text">NVMe / TCP</block>
  <block id="e4e1c13bb0b14f6cb7608cbecea948ef" category="list-text">iSCSI</block>
  <block id="f7d773fd2896401c143676940bc001fc" category="list-text">NFS v3</block>
  <block id="0b99b245267ef194ca3b9f6e694b0983" category="list-text">NFS v4.1</block>
  <block id="9da73946f1bc3be4a41898d06c9d2e8b" category="cell">功能/特色</block>
  <block id="6151632541dcd80356c6c76b34d69d0c" category="cell">NVMe</block>
  <block id="520d0db389f362bf79ef56ca0af3dcab" category="cell">格式</block>
  <block id="99a3142584ca8ad0a3afadeaa6f2ef69" category="cell">VMFS或原始裝置對應（RDM）</block>
  <block id="26aae26f61844ac20ab7b04ba6f5c515" category="cell">VMFS或RDM</block>
  <block id="18263a30df8afc60a733e59c60676ac0" category="cell">VMFS</block>
  <block id="8dc6d0c66219ddb809322c0d248e55e6" category="cell">資料存放區或LUN的最大數量</block>
  <block id="aa23f9914ce1939ea7a4d479edfdc915" category="cell">每個主機有1024個LUN</block>
  <block id="1af3b27207afc48a363629a315d76b59" category="cell">每個伺服器有1024個LUN</block>
  <block id="0705fd627c25b5fba17cd9a022ed7d72" category="cell">每個伺服器256個Namespeces</block>
  <block id="51c0dc217976e27de06e262947947a62" category="cell">最大資料存放區大小</block>
  <block id="856c997f909830b8249756c07dc9452b" category="cell">64TB</block>
  <block id="b4fb1d41fedaec79072964cbb4d16e3d" category="cell">最大資料存放區檔案大小</block>
  <block id="d10549beb2f7bd1e91e5ef8965edd84a" category="cell">62TB</block>
  <block id="18301e675ce7d51c23071d7b135edbdc" category="cell">62TB 、含 ONTAP 9.12.1P2 及更新版本</block>
  <block id="9aa56a79640231adaec83bc53e59c929" category="cell">每個LUN或檔案系統的最佳佇列深度</block>
  <block id="c7dfde106afbb4e1d55096403af252e0" category="cell">64-256</block>
  <block id="ca6e77250a239af7b4aed9a1ac058825" category="cell">自動協商</block>
  <block id="edc5121cb9b42a76b718b8ece9d67437" category="paragraph">下表列出支援的VMware儲存相關功能。</block>
  <block id="6c1a84b789b54fd42511ce582be94d21" category="cell">vMotion</block>
  <block id="e95b58d02782c970bb339c6cc587ff39" category="cell">Storage VMotion</block>
  <block id="0486e0e3dc3e86859f43b6d8e32b8071" category="cell">VMware HA</block>
  <block id="8be6bd7f20474cbefdd496cb9fd495ca" category="cell">儲存分散式資源排程器（SDR）</block>
  <block id="28c2f8ab9cdbf296aa4261bc3c58ba0d" category="cell">VM內的Microsoft叢集服務（Microsoft Cluster Service、英文）或容錯移轉叢集</block>
  <block id="aa7f77e663b832d5b0e544c5511e680c" category="cell">不支援</block>
  <block id="aa18abedec09bd4f85e612c307e2eaa6" category="cell">容錯能力</block>
  <block id="17d495427086fa21259b9df40b27e00a" category="cell">精簡配置的VM（虛擬磁碟）</block>
  <block id="4ee7af004efef335d6a14c60ee758f5e" category="cell">是的
此設定是不使用 VAAI 時、 NFS 上所有 VM 的預設值。</block>
  <block id="13bc264ff420559de4156ec40980a4b9" category="cell">VMware原生多重路徑</block>
  <block id="a06819d91a165d0491c5816c54b41234" category="paragraph">下表列出支援ONTAP 的功能不完整的儲存管理功能。</block>
  <block id="f8d61013f1a3bbf1342f4ced3279c7cf" category="cell">重複資料刪除技術</block>
  <block id="72167540968147afed9deb59f0e9fe00" category="cell">節省陣列成本</block>
  <block id="9a5473a6abaea16b736f096913a749be" category="cell">資料存放區的節約效益</block>
  <block id="6cd880eabbec3488232c6cba3fbcf998" category="cell">資源隨需配置</block>
  <block id="5caeb11c4ed379b808d7f7cdca7cfbf0" category="cell">資料存放區或RDM</block>
  <block id="8a5227cc82d14862956938caffc1acf2" category="cell">資料存放區</block>
  <block id="b71ba22dcd42deceac87150206f7bd12" category="cell">調整資料存放區大小</block>
  <block id="c6b792bfd7aac8067d36337e67d11545" category="cell">僅成長</block>
  <block id="29e23534878bb63341e0b689426b7fb0" category="cell">擴充、自動擴充及縮減</block>
  <block id="76021405cc62a4b8c542e7f65e3d24ed" category="cell">適用於Windows、Linux應用程式（客體內）的列舉外掛程式SnapCenter</block>
  <block id="c0b3c629432c82a9e8500242abb35eaf" category="cell">使用ONTAP VMware vSphere的VMware VMware vSphere的支援工具來監控及主機組態</block>
  <block id="5a915a8215e9a66bcff0f034e8adff18" category="cell">使用ONTAP VMware vSphere的VMware vSphere的VMware工具進行資源配置</block>
  <block id="6495c7cda42bf1b80bc1c2af6166ef58" category="paragraph">下表列出支援的備份功能。</block>
  <block id="bf22a1b5bc2b72a75825094826a942de" category="cell">SRM支援複寫備份</block>
  <block id="60d3f7d9f265eb34e826da352cb545be" category="cell">Volume SnapMirror</block>
  <block id="fabf31a57c142c986c5d88cb089b3d7b" category="cell">VMDK映像存取</block>
  <block id="d7605580ecad0fcb4528789d74cdcad5" category="cell">VMDK檔案層級存取</block>
  <block id="4e3d259d82a536e12c5c9c948b62e26a" category="cell">NDMP精細度</block>
  <block id="90d45e02e50c81603c36a4e4ad3649d9" category="cell">資料存放區或 VM</block>
  <block id="8339c514e73f5cced3b83d504d60441b" category="inline-link">Windows Server容錯移轉叢集的設定</block>
  <block id="54b3e11ce37eaaa9884f4086e72dd2be" category="section-title">選擇儲存傳輸協定</block>
  <block id="0212b4e8bc965dcd8a7ff771dd96bf21" category="paragraph">下列因素可能有助於考量選擇傳輸協定：</block>
  <block id="774f1348caf3e145710073eb634c4fa1" category="list-text">*易於設定。*除了FC架構的初始組態設定（額外的交換器和纜線、分區、以及HBA和韌體的互通性驗證）之外、區塊傳輸協定也需要建立及對應LUN、以及由客體作業系統探索及格式化。NFS磁碟區建立及匯出之後、便會由ESXi主機掛載並準備好使用。NFS沒有特殊的硬體限制或韌體可管理。</block>
  <block id="530c759326761c6ac026b313985b255f" category="list-text">*儲存空間的透明度。*在NFS環境中、儲存使用率通常比較容易查看、因為精簡配置可立即回收節約效益。同樣地、相同資料存放區中的其他VM或其他儲存系統磁碟區也可立即使用重複資料刪除和複製的節約效益。NFS資料存放區的VM密度通常也較高、可減少資料存放區的管理數量、進而改善重複資料刪除的節約效益、並降低管理成本。</block>
  <block id="16ee928b12bc598bf52b0f312879ec95" category="section-title">資料存放區配置</block>
  <block id="8c761039ef4dd69451490b849ace1f82" category="list-text">避免在來賓作業系統中使用重組公用程式、因為這不會帶來效能效益、也會影響儲存效率和快照空間使用量。也請考慮在客體作業系統中關閉虛擬桌面的搜尋索引。</block>
  <block id="14abb814748566a24367c4459a54840b" category="list-text">以創新的儲存效率功能引領業界、讓您充分發揮可用磁碟空間的效益。ONTAP利用預設的即時重複資料刪除與壓縮技術、支援更高的效率。AFF資料會在集合體中的所有磁碟區中進行重複資料刪除、因此您不再需要將類似的作業系統和類似的應用程式群組在單一資料存放區中、以達到最大的節約效益。</block>
  <block id="446548f2b1301893641e29657fc7fe53" category="inline-link-macro">Oracle資料庫ONTAP</block>
  <block id="6cda576d2fd323c1a728b7ac67d6034f" category="list-text">一流磁碟（或改良的虛擬磁碟）可讓vCenter管理的磁碟獨立於vSphere 6.5及更新版本的VM。雖然主要是由API管理、但在vVols上也很實用、尤其是由OpenStack或Kubernetes工具管理時。支援的項目包括ONTAP VMware ONTAP vSphere的VMware vSphere的支援功能和VMware vSphere的支援功能。</block>
  <block id="71318121439b39fdf872bb0bd57494f2" category="section-title">資料存放區與VM移轉</block>
  <block id="e8824ce2062c6d1fc536163f7b8940bd" category="paragraph">將VM從另一個儲存系統上的現有資料存放區移轉至ONTAP 支援區時、請謹記以下幾項實務做法：</block>
  <block id="73b729fbc964c7d78dd90b64aaaeb785" category="list-text">使用Storage VMotion將大部分虛擬機器移至ONTAP VMware。這種方法不僅不中斷虛ONTAP 擬機器的執行、還能讓諸如即時重複資料刪除和壓縮等儲存效率功能、在資料移轉時處理資料。請考慮使用vCenter功能從清單清單清單中選取多個VM、然後在適當的時間排程移轉（按一下「Actions」（動作）時使用Ctrl鍵）。</block>
  <block id="9fb2cc2ced88ce872ef16c37d8284360" category="paragraph">外掛程式也能協助您在ONTAP vSphere環境中使用其他的功能。它可讓您安裝適用於 VMware VAAI 的 NFS 外掛程式、以便將複本卸載至 ONTAP 進行虛擬機器複製作業、保留大型虛擬磁碟檔案的空間、以及 ONTAP 快照卸載。</block>
  <block id="6161d374e9022f89382fd63b4be15aa1" category="section-title">一般網路</block>
  <block id="c7949782ad094d3ffc126bee722642a3" category="list-text">使用交換器、透過 Cisco 的 Virtual PortChannel （ VPC ）等多機箱連結集合群組方法、在兩個獨立的交換器機箱上支援連接埠的連結集合。</block>
  <block id="9dc1904e0c3ace141704b477cd9b345d" category="inline-link">網路管理</block>
  <block id="68ecdb0d7a96e68318a53d12e9fab5b5" category="list-text">使用 LACP 為具有連接埠或 IP 雜湊的動態多重模式介面群組的 ONTAP 儲存系統建立連結集合體。請參閱<block ref="b87480ad0ff34784c4be1445a72a3aaf" category="inline-link-rx"></block> 以取得進一步指引。</block>
  <block id="3b407fe7c9654197902b1dd26af6dc81" category="list-text">在 ESXi 上使用靜態連結集合（例如、 EtherChannel ）和標準 vSwitch 、或是搭配 vSphere Distributed Switch 使用 LACP 型連結集合時、請使用 IP 雜湊成組原則。如果未使用連結集合、請改用「根據來源虛擬連接埠 ID 建立路由」。</block>
  <block id="ee1ef6cf0f3971b44eb2abcac958fb8d" category="section-title">資料量FlexGroup</block>
  <block id="dd9bd4a686bdeb1c7f11dc3cd0cda75f" category="paragraph">請考慮下列案例：</block>
  <block id="6b277580cb59b13790b36344e827e22f" category="list-text">您已經建立了 8 個組成要素的新 FlexGroup</block>
  <block id="32efd8b10cc3b73c344f4c7e6c4b741e" category="list-text">新 FlexGroup 的快取逾時設定為 160 分鐘</block>
  <block id="879f959734466d50681eae9b95e7e591" category="paragraph">在此案例中、要完成的前 8 個複本將為完整複本、而非本機檔案複本。在 160 秒逾時過期之前、對該 VM 進行任何額外的複製、都會以循環方式使用每個組成要素內部的檔案複製引擎、以建立幾乎立即的複本、並在組成的磁碟區之間平均分配。</block>
  <block id="0f98175ace2dd0d56e47961b22b2544b" category="paragraph">在無法充分利用 FlexGroup 快取、但仍需要快速跨磁碟區複製的環境中、請考慮使用 vVols 。使用 vVols 進行跨磁碟區複製的速度比使用傳統資料存放區快得多、而且不依賴快取。</block>
  <block id="189aae773e13462525f07e99fcd9e90f" category="inline-link">VAAI ：快取如何與 FlexGroup 磁碟區搭配運作？</block>
  <block id="ce4df831657d2621e80bbef9271c33cd" category="summary">隨著舊有虛擬應用裝置的移轉、ONTAP VMware的功能豐富、限制更高、並提供全新vVols支援。</block>
  <block id="116d20fc387d73c8e4a86e7998913947" category="section-title">vSphere和Site Recovery Manager的最新版本</block>
  <block id="7cb1700928c008eb817bc79250cc9002" category="section-title">支援IPv6</block>
  <block id="ea9aacd1495949730de8eeab11e66459" category="paragraph">現在支援IPv6、但有下列限制：</block>
  <block id="918d32b75f0ab883abba3a8dc0c3ae8d" category="inline-link">互通性對照表工具</block>
  <block id="4a4842d7448ef71eb69b013e560b18bb" category="section-title">擴充性更高</block>
  <block id="96cb4d41ca97bd9d3d446984d3170a57" category="paragraph">SnapMirror Synchronous（SM-S）搭配ONTAP 了一套功能、可提供大量精細零RPO資料複寫解決方案、適合任務關鍵型應用程式、這項功能值得期待且期待已久。SM - S需要ONTAP 使用VMware工具9.8或更新版本。</block>
  <block id="b9832b10a87d0c3793ed3b413ee1d839" category="section-title">REST API支援</block>
  <block id="e3445c3aa798f5ad98665e33d34dd952" category="paragraph">最佳實務做法是輔助其他文件、例如指南和相容性工具。這些技術是根據實驗室測試和NetApp工程師與客戶廣泛的現場經驗所開發。在某些情況下、建議的最佳實務做法可能不適合您的環境；不過、它們通常是最簡單的解決方案、能滿足大多數客戶的需求。</block>
  <block id="87a7b114355b836acefe833c497611bb" category="paragraph">接著、您可以在雲端服務供應商的資料中心內執行測試容錯移轉、因為 FlexClone 的儲存佔用空間接近零。保護組織的成本現在比以往更低。</block>
  <block id="89fafdb11a7e8cd8abebb1d4df053dad" category="doc">複寫拓撲</block>
  <block id="be01acd2f018d38f9446f06b99ee4a2a" category="paragraph">在流程9中ONTAP 、叢集管理員可以看到叢集的實體元件、但使用叢集的應用程式和主機無法直接看到這些元件。實體元件提供一個共享資源集區、用於建構邏輯叢集資源。應用程式和主機只能透過含有磁碟區和LIF的SVM存取資料。</block>
  <block id="6f55124e085dbeb640e4cb8ad2c97905" category="list-text">SVM可控制橫跨叢集中多個節點的LUN和磁碟區。</block>
  <block id="39d9903201320a83d45d3b36d512f051" category="cell">最佳實務做法</block>
  <block id="2e4472d35f80aa8b7eca52ae3dd43dc6" category="section-title">支援的SnapMirror配置</block>
  <block id="86cf5bd2bdb1b1d67f8f907f41099509" category="section-title">支援的Array Manager配置</block>
  <block id="1ceb46f3e1c6c7995de4ec5f05601227" category="section-title">不支援的配置</block>
  <block id="3f88384b0d5cdcdc25895c644126c1b0" category="section-title">SnapMirror串聯</block>
  <block id="8bd15e818d377a0a5cf6ebc429555f79" category="section-title">SnapMirror與SnapVault</block>
  <block id="7878dfbf4b6ad3bc60d095cf89d79202" category="admonition">NetApp 支援<block ref="e7d3e049f94ce3ff8a47f209f012173d" prefix=" " category="inline-code"></block> 原則類型。</block>
  <block id="883e69a285ae2d5fd23c80cd29285804" category="paragraph">為了執行效能提升8.2、從一開始就重建了這個系統。SnapVault ONTAP儘管以前Data ONTAP 的使用者應該會發現相似點、SnapVault 但本版的VMware已經做出重大的改善。其中一項重大進展是SnapVault 、能夠在傳輸過程中維持主要資料的儲存效率。</block>
  <block id="9bc21373e0e299579a7ac86dcd4f513d" category="paragraph">架構上的一項重要變更是SnapVault 、在ONTAP Volume層級進行的不只是qtree層級的不完整複寫、7-Mode SnapVault 的情況就是如此。這項設定表示SnapVault 、來源的不景點必須是一個Volume、而且該Volume必須複寫到SnapVault 自己的Volume上的不二系統。</block>
  <block id="d447048519c85a2fb3bea0790cd109fb" category="paragraph">在使用 SnapVault 的環境中、會在主要儲存系統上建立特別命名的快照。根據實作的組態而定、命名快照可由 SnapVault 排程或 NetApp Active IQ Unified Manager 等應用程式在主要系統上建立。然後，在主系統上創建的命名快照將被複制到 SnapMirror 目標，並從該目的地將其保存到 SnapVault 目的地。</block>
  <block id="5bc66b9c84b3f7cc0b375e729376b68d" category="inline-link">TR-4015《SnapMirror組態最佳實務指南ONTAP 》（英文）。</block>
  <block id="0d510e96259254d285c6aaeb8458f45d" category="paragraph">如需SnapMirror和SnapVault 適用於ONTAP SnapMirror的更新資訊、請參閱<block ref="32e7c991f675bf983c547a2a174c2caf" category="inline-link-rx"></block></block>
  <block id="657a41cce55646ab17754ac1427970af" category="paragraph">下圖說明SnapMirror至SnapVault SnapMirror串聯組態。如果該站台位於DR站台或第三站台、但不受主站台中斷影響、則可重新設定環境、以便在容錯移轉後繼續備份。SnapVault</block>
  <block id="63fd1f18d5d53fa97fd05a7fd96090b4" category="section-title">在Site Recovery Manager環境中使用qtree</block>
  <block id="345cb3f040f9f7f3f1a4261ed260aa79" category="section-title">混合式FC與iSCSI環境</block>
  <block id="a60b166c2b69b4fdfbb733dc2193668a" category="paragraph">藉由支援的SAN傳輸協定（FC、FCoE和iSCSI）ONTAP 、支援的LUN服務、也就是能夠建立LUN並將其對應至連接的主機。由於叢集由多個控制器組成、因此有多個邏輯路徑是由多重路徑I/O管理、可通往任何個別LUN。主機上使用非對稱邏輯單元存取（ALUA）、以便選取LUN的最佳化路徑、並使其成為資料傳輸的作用中路徑。如果任何LUN的最佳化路徑有所變更（例如、因為包含的磁碟區已移動）、ONTAP 則針對此變更、支援不中斷地自動辨識及調整。如果最佳化路徑無法使用、ONTAP 則不中斷營運地切換至任何其他可用路徑。</block>
  <block id="56687c1a324f03f5d1429500efea710e" category="doc">使用vVols複寫時疑難排解SRM</block>
  <block id="ef74d715544e3b067a6bec3218ac5044" category="paragraph">疑難排解時、瞭解下列新工作流程會有所助益：</block>
  <block id="47f0942d341ee10381b2eff35089d75d" category="list-text">查詢複製對等方：探索兩個故障網域之間的複寫合約。</block>
  <block id="136a299aae29998a147852cb0cba5b4a" category="list-text">查詢FaultDomain：探索故障網域階層。</block>
  <block id="c071098c5df923c31f6245e4db2f3861" category="list-text">查詢複製群組：探索來源或目標網域中的複寫群組。</block>
  <block id="792cfe9ad3a3dc8528080a262e92989a" category="list-text">SyncReplicationGroup：在來源與目標之間同步資料。</block>
  <block id="39afb1e1e3b180a6230e07bb8571667e" category="list-text">查詢點時間複本：探索目標上的時間點複本。</block>
  <block id="9fb25fe2ff084dc9ccfb99eaccba7212" category="list-text">testFailoverReplicationGroupStart：開始測試容錯移轉。</block>
  <block id="bd4e1dacaca4c37a53b5286b6ae0239d" category="list-text">testFailoverReplicationGroupStop：結束測試容錯移轉。</block>
  <block id="887f376a43cf9de1d6e14a8d69e588f6" category="list-text">促銷複製群組：將目前正在測試的群組推廣至正式作業。</block>
  <block id="17ab16c5c0786ff381e6a085318bad9b" category="list-text">PrepareFailoverReplicationGroup：準備災難恢復。</block>
  <block id="665dd64ebcc4016bda94e0e8020d8c8e" category="list-text">容錯移轉複製群組：執行災難恢復。</block>
  <block id="6936cf00e30b7cd4421225113a023c3e" category="list-text">混響複寫群組：啟動反轉複寫。</block>
  <block id="61ac8950a043e6998b458d4f8171154c" category="list-text">queryMatchingContainer：尋找容器（連同主機或複寫群組）、以特定原則來滿足資源配置要求。</block>
  <block id="05c9efdc056d2af4640bc441ab61b53a" category="list-text">查詢資源中繼資料：從VASA提供者探索所有資源的中繼資料、可傳回資源使用率做為查詢配對Container功能的答案。</block>
  <block id="01fa56986f885c588b1be8c206623de8" category="paragraph">設定vVols複寫時最常見的錯誤是無法發現SnapMirror關係。這是因為磁碟區和SnapMirror關係是在ONTAP 不屬於「需求工具」範圍的情況下建立。因此、最佳實務做法是在ONTAP 嘗試建立複寫的vVols資料存放區之前、務必確認SnapMirror關係已完全初始化、並在兩個站台上執行「ReDiscovery工具」中的重新探索。</block>
  <block id="3e4627f6667f830baceaaf35890b575a" category="summary">若要深入瞭解本文所述資訊、請檢閱下列文件和/或網站。</block>
  <block id="092bf78f9c97ba171b8232ddff585392" category="doc">其他資訊</block>
  <block id="7d5b957cd473f6eaf5ad335a9c63c4ff" category="paragraph">若要深入瞭解本文所述資訊、請檢閱下列文件和 / 或網站：</block>
  <block id="c88037eb28ae3cceb0e32c2cd3c322d7" category="inline-link"><block ref="c88037eb28ae3cceb0e32c2cd3c322d7" category="inline-link-rx"></block></block>
  <block id="c9dd6bad4c7d561872f2e2d498a990bf" category="inline-link">互通性對照表工具IMT （不含）</block>
  <block id="1f82b18dcba5f32a085bc502cdd0c6b7" category="summary">利用NetApp技術、儲存虛擬機器（SVM）的概念可在安全的多租戶環境中提供嚴格的區隔。ONTAP</block>
  <block id="7520e12a140ccf3de279fe2fd48889e4" category="doc">部署最佳實務做法</block>
  <block id="1b4574c516231b685bb37b013b789b06" category="section-title">適用於SMT的SVM配置與區隔</block>
  <block id="446e04546ec0567eeeeef8e07368ab40" category="paragraph">利用NetApp技術、儲存虛擬機器（SVM）的概念可在安全的多租戶環境中提供嚴格的區隔。ONTAP某個SVM上的SVM使用者無法從另一個SVM存取或管理資源。如此一ONTAP 來、您就能為不同的業務單位建立獨立的SVM、以便在同一個叢集上管理自己的SRM工作流程、進而提升整體儲存效率、進而充分運用此項技術。</block>
  <block id="f98c1d223f34b2fdaf90eab1a3bc6a25" category="paragraph">考慮ONTAP 使用SVM範圍的帳戶和SVM管理生命體來管理功能、不僅能改善安全控管、也能提升效能。使用SVM範圍的連線時、效能自然會更高、因為SRA不需要處理整個叢集中的所有資源、包括實體資源。而是只需要瞭解抽象化至特定SVM的邏輯資產。</block>
  <block id="97399fb37deca0d463aa5c7dc8d064a6" category="section-title">管理ONTAP 功能的最佳實務做法</block>
  <block id="18f8b81b7fb7ea92f333e127583df17c" category="paragraph">如前所述、您可以ONTAP 使用叢集或SVM範圍內的認證和管理生命體來管理等叢集。為了達到最佳效能、您可能想要在不使用 vVols 時、考慮使用 SVM 範圍的認證。不過、在這樣做的過程中、您應該瞭解某些需求、而且您確實會失去某些功能。</block>
  <block id="6e62430b92a7c5a0b8512436b163a10d" category="list-text">可能不會報告儲存效率所節省的Aggregate空間。</block>
  <block id="93d86aa51e0909549d1b1210f887aef3" category="list-text">在支援的情況下、無法更新負載共用鏡像。</block>
  <block id="647d380b52e259fe7ed2e2582bc54b27" category="list-text">可能無法在ONTAP 以SVM範圍認證來管理的各種系統上執行EMS記錄。</block>
  <block id="c5cd657df037c277c37216b73efb0b08" category="summary">如有可能、請務必使用ONTAP 「資訊工具」來配置資料存放區和磁碟區。這可確保磁碟區、交會路徑、LUN、igroup、匯出原則、 和其他設定均以相容的方式進行設定。</block>
  <block id="d3b26e9021e83573a3d2a9050400a33a" category="doc">營運最佳實務做法</block>
  <block id="4d15db58f26b374b36c283df6b5a5fc1" category="paragraph">當ONTAP 透過SRA使用陣列型複寫時、SRM支援iSCSI、Fibre Channel及NFS版本3 with VMware®9。SRM不支援使用傳統或vVols資料存放區的NFS 4.1版陣列型複寫。</block>
  <block id="61f54ceeb0338787a2ee2d801cbc62cd" category="paragraph">若要確認連線能力、請務必確認您可以從目的地ONTAP 叢集掛載並卸載DR站台上的新測試資料存放區。測試您要用於資料存放區連線的每個傳輸協定。最佳實務做法是使用ONTAP 「VMware工具」來建立測試資料存放區、因為它是依照SRM的指示來執行所有資料存放區自動化作業。</block>
  <block id="6d717f70d89096b731dfc63d7a1379e1" category="section-title">關於陣列配對</block>
  <block id="2219228418c053eb593ce0a1f318da47" category="paragraph">在SRM中設定陣列配對時、您應該一律以新增至ONTAP 「VMware工具」的相同方式、在SRM中新增這些配對、也就是說、它們必須使用相同的使用者名稱、密碼和管理LIF。這項需求可確保SRA與陣列正常通訊。下列螢幕快照說明ONTAP 叢集在「叢集工具」中的顯示方式、以及如何將其新增至陣列管理程式。</block>
  <block id="3b34135c8c4d2b14ceb7ebf595f00193" category="section-title">關於複寫群組</block>
  <block id="c727c1020d3128dd7495a6e3e6f23736" category="paragraph">複寫群組的最後一個考量是、每個群組的本質都是一個邏輯一致性群組（請勿與SRM一致性群組混淆）。這是因為磁碟區中的所有VM都會使用相同的快照一起傳輸。因此、如果您有必須彼此一致的VM、請考慮將它們儲存在同FlexVol 一個地方。</block>
  <block id="9f8a350a2113ea4be6b4e5e5112514a3" category="section-title">關於保護群組</block>
  <block id="df77671ab2743af7f1d1457c200eb12c" category="paragraph">保護群組會將虛擬機器和資料存放區定義為群組、這些群組會從受保護的站台一起還原。受保護站台是指在正常穩定狀態作業期間、保護群組中設定的VM存在的位置。請務必注意、雖然SRM可能會針對保護群組顯示多個陣列管理程式、但保護群組無法跨越多個陣列管理程式。因此、您不應該跨不同SVM上的資料存放區跨VM檔案。</block>
  <block id="b148467d645c3613c1c7a2607764c515" category="section-title">關於恢復計畫</block>
  <block id="fd28cd9834ad3aa213c4fec2881064b5" category="paragraph">恢復計畫會定義在相同程序中恢復哪些保護群組。您可以在相同的恢復計畫中設定多個保護群組。此外、若要啟用更多執行恢復計畫的選項、可在多個恢復計畫中加入單一保護群組。</block>
  <block id="77aa84394124509e5e4006dcfd18789f" category="paragraph">恢復計畫可讓SRM管理員定義恢復工作流程、將VM指派給優先順序群組、從1（最高）指派至5（最低）、預設值為3（中）。在優先順序群組中、可設定VM以因應相依性。</block>
  <block id="030d749269f8866de516a551b0286001" category="paragraph">NetApp強烈建議您與應用程式團隊合作、瞭解容錯移轉案例中所需的作業順序、並據此建構您的恢復計畫。</block>
  <block id="cebb1167d3e78885137c837f0abf8026" category="section-title">測試容錯移轉</block>
  <block id="6ae8acfc86f5df3426d525fb95767506" category="paragraph">NetApp也建議偶爾確認來賓應用程式功能、尤其是在重新設定VM儲存設備之後。</block>
  <block id="bd47371bcd8b3d08d6b4b15481b08d93" category="paragraph">執行測試還原作業時、會在ESXi主機上為VM建立私有測試球型網路。不過、此網路不會自動連線至任何實體網路介面卡、因此無法在ESXi主機之間提供連線功能。為了在DR測試期間允許在不同ESXi主機上執行的VM之間進行通訊、會在DR站台的ESXi主機之間建立實體私有網路。若要驗證測試網路是否為私有網路、可以實體分隔測試網路、或使用VLAN或VLAN標記來分隔測試網路。此網路必須與正式作業網路隔離、因為在恢復VM時、無法將其置於可能與實際正式作業系統衝突的IP位址正式作業網路上。在SRM中建立恢復計畫時、所建立的測試網路可選取為私有網路、以便在測試期間連接VM。</block>
  <block id="2be58fc410ddf2ba9c350135a617944a" category="paragraph">在測試通過驗證且不再需要之後、請執行清除作業。執行清除功能會將受保護的VM恢復至初始狀態、並將恢復計畫重設為「就緒」狀態。</block>
  <block id="6f07b53963ee80903f0f13654de2cc3a" category="section-title">容錯移轉考量</block>
  <block id="9d33d94019b4a595a1ea232926a4da1b" category="paragraph">除了本指南所述的作業順序之外、還有其他幾個考量因素是站台容錯移轉。</block>
  <block id="74abdd5cb502cd65bcf1d7ca484ab0c2" category="paragraph">您可能必須面對的一個問題是站台之間的網路差異。某些環境可能會在主要站台和DR站台上使用相同的網路IP位址。這項功能稱為「延伸虛擬LAN（VLAN）」或「延伸網路設定」。其他環境可能需要在主要站台使用不同的網路IP位址（例如不同的VLAN）、相對於DR站台。</block>
  <block id="9b8890fe5b1ab29543118b12a7bd0a07" category="inline-link-macro">支援 SRM 的 NSX-T 選項</block>
  <block id="25154023650451d6cc971fc54bff8898" category="paragraph">VMware提供多種方法來解決此問題。例如VMware NSS-T Data Center等網路虛擬化技術、會從作業環境的第2層到第7層、將整個網路堆疊抽象化、以提供更多可攜的解決方案。深入瞭解 <block ref="3e6a2bd8e1acf69d423b7944c6543271" category="inline-link-macro-rx"></block>。</block>
  <block id="b56336aa967325217297d8725b64eb0b" category="inline-link-macro">VMware 文件</block>
  <block id="d32598436410006707b2ad1d79395f02" category="paragraph">若要設定SRM將不同的網路設定套用到多個VM、而不需要編輯恢復計畫中每個VM的內容、VMware提供一種稱為DR-IP-customizer的工具。如需瞭解如何使用此公用程式、請參閱 <block ref="837c7339284b78d4fd5550c5d0fb1a68" category="inline-link-macro-rx"></block>。</block>
  <block id="3c8c527afa8ce5009c8f707f7fd4fabf" category="section-title">重新保護</block>
  <block id="3b496038cb575fc404f8b0783e570f7a" category="paragraph">恢復之後、恢復站台將成為新的正式作業站台。由於恢復作業中斷了SnapMirror複寫、因此新的正式作業站台不會受到任何未來災難的保護。最佳實務做法是在恢復後立即將新的正式作業站台保護到另一個站台。如果原始正式作業站台可運作、VMware管理員可以將原始正式作業站台當作新的恢復站台、以保護新正式作業站台、有效反轉保護方向。只有在非災難性故障時、才能使用重新保護功能。因此、原始vCenter Server、ESXi伺服器、SRM伺服器及對應的資料庫最終必須可還原。如果無法使用、則必須建立新的保護群組和新的恢復計畫。</block>
  <block id="2bf236f8aceaaff2b305848df524c42e" category="paragraph">容錯回復作業基本上是以不同於以往的方向進行容錯移轉。最佳實務做法是在嘗試容錯回復之前、或是在容錯移轉至原始站台之前、先確認原始站台是否恢復為可接受的功能層級。如果原始站台仍遭入侵、您應該延遲容錯回復、直到故障獲得充分補救為止。</block>
  <block id="cb03753531bad31391d7156433b98ae6" category="paragraph">另一個容錯回復最佳做法是在完成重新保護後、在執行最終容錯回復之前、一律執行測試容錯移轉。如此可驗證原始站台上的系統是否能夠完成作業。</block>
  <block id="900a3b65ea54b6dcff72ed0d6ac66fdf" category="section-title">重新保護原始網站</block>
  <block id="12d059a2c7519f2e3497b30a71121503" category="paragraph">在容錯回復後執行重新保護、基本上會使環境回到最初的狀態、並再次從正式作業站台執行SnapMirror複寫至還原站台。</block>
  <block id="39e5fc9eb192f011ab14dae6c2974c4e" category="list-text">*威脅建模。*威脅建模的目的是在軟體開發生命週期初期、發現某項功能、元件或產品的安全性瑕疵。威脅模式是對影響應用程式安全性的所有資訊的結構化呈現。基本上、它是透過安全性觀點來檢視應用程式及其環境。</block>
  <block id="9f16ab3a50bca32d19c4729319035c8d" category="list-text">*動態應用程式安全性測試（dast）。*這項技術的設計、是為了偵測應用程式在執行狀態下的易受影響狀況。Dast會測試開放Web應用程式的公開HTTP和HTML介面。</block>
  <block id="267bed0525e4dab477e4c24ca5a1794e" category="list-text">*協力廠商程式碼貨幣。*在開放原始碼軟體（開放原始碼軟體）的軟體開發過程中、您必須解決與產品內建的任何開放原始碼軟體相關的安全性弱點。這是一項持續努力、因為新的開放源碼版本可能隨時都有新發現的弱點報告。</block>
  <block id="db7bc87c89c1ee76d313865a32fc0e06" category="list-text">*弱點掃描。*弱點掃描的目的是在NetApp產品中發現常見且已知的安全性弱點之後、再將弱點發佈給客戶。</block>
  <block id="1a4c104571630526efc77b84e82380fe" category="list-text">*滲透測試。*滲透測試是評估系統、Web應用程式或網路以找出攻擊者可能利用的安全性弱點的程序。NetApp的滲透測試（筆測試）是由一群獲核准且值得信賴的第三方公司進行。其測試範圍包括利用精密的利用方法或工具、對類似於惡意入侵者或駭客的應用程式或軟體發動攻擊。</block>
  <block id="7e98fc3ea1ec077cfd1727a58e9c9020" category="section-title">產品安全功能</block>
  <block id="dff88c2ef0b49b09246ffd6f9ec55195" category="list-text">*登入橫幅。* SSH預設為停用、如果從VM主控台啟用、則僅允許一次性登入。使用者在登入提示中輸入使用者名稱後、會顯示下列登入橫幅：</block>
  <block id="399875025e8e96cc13102a4dd72f2434" category="paragraph">*警告：*禁止未經授權存取本系統、並依法律予以起訴。存取本系統即表示您同意、若懷疑有未獲授權的使用情形、您的行動可能受到監控。</block>
  <block id="2d8330ed99c80a842ffbd1362e038e5e" category="paragraph">使用者透過 SSH 通道完成登入後、會顯示下列文字：</block>
  <block id="677528ad13d460c058ac50e8a62092cf" category="list-text">*角色型存取控制（RBAC）。* ONTAP 有兩種RBAC控制項與VMware Tools相關聯：</block>
  <block id="ac38773d017495a97d5b88f242578cb8" category="list-text">原生vCenter Server權限</block>
  <block id="c2e2fce3a995f59900d7afbbe58683f5" category="inline-link">此連結</block>
  <block id="31cedac82fef311cb790a12f96897223" category="list-text">vCenter外掛程式特定權限。如需詳細資訊、請參閱<block ref="e5f6920797dbff91ef59367270a82669" category="inline-link-rx"></block>。</block>
  <block id="5d32469f8a65b884a8f70abf95fe485a" category="list-text">*加密的通訊通道。*所有外部通訊都是透過使用TLS 1.2版的HTTPS進行。</block>
  <block id="600d4f98483fae8e58054f976d7e0c0e" category="list-text">*最小的連接埠曝光。*只有必要的連接埠會在防火牆上開啟。</block>
  <block id="0406f8902379502d1eba01f043c232b7" category="paragraph">下表說明開放連接埠的詳細資料。</block>
  <block id="69fc9fe9cbb7709e97a433352aecf77d" category="cell">TCP v4/v6連接埠#</block>
  <block id="02674a4ef33e11c879283629996c8ff8" category="cell">方向</block>
  <block id="86408593c34af77fdd90df932f8b5261" category="cell">功能</block>
  <block id="0c95054981de037de06e544a52eb3613" category="cell">8143.</block>
  <block id="a8e6fe5b9e68f30a146cefebaa7edcc3" category="cell">傳入</block>
  <block id="d16c4afdc5f340936b747baf91efc843" category="cell">用於REST API的HTTPS連線</block>
  <block id="5bd529d5b07b647a8863cf71e98d651a" category="cell">8043.</block>
  <block id="1f4deeb2f64336d4ff65ea3d2b4ffe2f" category="cell">HTTPS連線</block>
  <block id="cb4b69eb9bd10da82c15dca2f86a1385" category="cell">9060</block>
  <block id="5852f8019b572f4cdef5bab783fa799f" category="cell">HTTPS連線
用於透過 https 連線的 SOAP
此連接埠必須開啟、才能讓用戶端連線至 ONTAP 工具 API 伺服器。</block>
  <block id="b6d767d2f8ed5d21a44b0e5886680cb9" category="cell">22</block>
  <block id="f4e339608b243f9b57b78ffaf061b498" category="cell">SSH（預設為停用）</block>
  <block id="d82d678e9583c1f5f283ec56fbf1abb7" category="cell">9080</block>
  <block id="ef34781e03f49b5db5dd8fa267c4c41b" category="cell">HTTPS連線- VP和SRA -僅從回送進行內部連線</block>
  <block id="a44ba9086b2b83ccf2baf7c678723449" category="cell">9083.</block>
  <block id="fe01ac95967cd8cb5f5b5669b685277a" category="cell">HTTPS 連線： VP 與 SRA
用於透過 https 連線的 SOAP</block>
  <block id="abea47ba24142ed16b7d8fbf2c740e0d" category="cell">1162</block>
  <block id="4a0724da5c6f4e4817663ae822550800" category="cell">VP SNMP設陷封包</block>
  <block id="5cce8dede893813f879b873962fb669f" category="cell">1527.</block>
  <block id="91c15b8eb529bf2100c10383d1010a1e" category="cell">僅限內部使用</block>
  <block id="60135f95267c6e0711bf5a2858dfff2f" category="cell">僅在此電腦與本身之間的外部連線不接受（僅限內部連線）</block>
  <block id="13f3cf8c531952d72e5847c4183e6910" category="cell">443..</block>
  <block id="1ef2b5426b0824e93e33753fa87ddbf5" category="cell">雙向</block>
  <block id="e4b8a8d8761aab7733e317b585d5d606" category="cell">用於連線ONTAP 至叢集</block>
  <block id="bf6184406d1e18fffc86ecf770fbb391" category="inline-link">知識庫文章</block>
  <block id="fedac49792829de4ff38fcf7a3846faa" category="list-text">*支援憑證授權單位（CA）簽署的憑證。* ONTAP VMware vSphere的各種工具支援CA簽署的憑證。請參閱<block ref="0903a062b2072644a9b744a7fece4216" category="inline-link-rx"></block> 以取得更多資訊。</block>
  <block id="9fca19988370da2a459b24505e9d23d5" category="list-text">*稽核記錄。*您可以下載支援套裝組合、而且內容極為詳細。使用者登入和登出活動會記錄在個別的記錄檔中。ONTAPVASA API呼叫會記錄在專屬的VASA稽核記錄（本機CXF.log）中。</block>
  <block id="7d60a2806aedd934b75cce55d6693689" category="list-text">*密碼原則。*遵循下列密碼原則：</block>
  <block id="f82f7513742f08b9d2784923213bdc75" category="list-text">密碼不會記錄在任何記錄檔中。</block>
  <block id="83040c348e071499488a8128db207545" category="list-text">密碼不會以純文字形式傳達。</block>
  <block id="bc319862df3312f423a50fece7730db9" category="list-text">密碼是在安裝程序本身期間設定的。</block>
  <block id="853c2ea85b86882d0ea73b606a9800a4" category="list-text">密碼歷程記錄是可設定的參數。</block>
  <block id="b3d3877bc96752ae50a409c72597d47a" category="list-text">密碼最短使用期限設為24小時。</block>
  <block id="fb0bdec50022a37424a405b53da7c9c8" category="list-text">密碼欄位的自動完成功能已停用。</block>
  <block id="3a04f054be8ad983ea82fd5079519810" category="list-text">利用SHA256雜湊功能、將所有儲存的認證資訊加密。ONTAP</block>
  <block id="46e61d6e7c848d43ddcede8efd36c3d8" category="doc">SnapCenter 外掛程式 VMware vSphere</block>
  <block id="ae9e79ac4b60eba67cf1c7508417b42c" category="paragraph">適用於VMware vSphere軟體工程的NetApp SnapCenter 支援外掛程式使用下列安全開發活動：</block>
  <block id="b25a1098aff7d0c5ee590f1e1a114bb9" category="list-text">*動態應用程式安全性測試（dast）。*專為偵測應用程式執行狀態中的易受影響狀況而設計的技術。Dast會測試開放Web應用程式的公開HTTP和HTML介面。</block>
  <block id="6cc1fee6b4fc48755d78e93170bbed93" category="list-text">*協力廠商程式碼貨幣。*在開發軟體及使用開放原始碼軟體（開放原始碼軟體）的過程中、必須解決與產品整合的開放原始碼軟體（開放原始碼軟體）相關的安全性弱點。這是一項持續努力、因為開放源碼軟體會元件的版本可能隨時報告新發現的弱點。</block>
  <block id="87bd0fb9b4198f33535e0e1888a809f5" category="list-text">*滲透測試。*滲透測試是評估系統、Web應用程式或網路以找出攻擊者可能利用的安全性弱點的程序。NetApp的滲透測試（筆測試）是由一群獲核准且值得信賴的第三方公司進行。其測試範圍包括利用精密的利用方法或工具、對惡意入侵者或駭客等應用程式或軟體發動攻擊。</block>
  <block id="e91db3b3278f7bd95cc704d74c5c9597" category="paragraph">適用於VMware vSphere的NetApp SnapCenter VMware vCenter外掛程式在每個版本中都包含下列安全功能：</block>
  <block id="4abd7d1d5d223683d3346671efb7e89c" category="list-text">*受限的Shell存取。* SSH預設為停用、且只有在從VM主控台啟用時、才允許一次性登入。</block>
  <block id="8c264fa5ca2c588d960d98bd30cbc897" category="list-text">*登入橫幅中的存取警告。*使用者在登入提示中輸入使用者名稱後、會顯示下列登入橫幅：</block>
  <block id="0d6633ada3a9803e206b2359d859e892" category="paragraph">使用者透過SSH通道完成登入後、會顯示下列輸出：</block>
  <block id="b883bf79639dfce77e395b8458ee69e4" category="list-text">原生vCenter Server權限。</block>
  <block id="721796b1cb3468f0daf819180184d460" category="inline-link">角色型存取控制（RBAC）</block>
  <block id="1d08c46b7567a29be0690a92b9722a58" category="list-text">VMware vCenter外掛程式特定權限。如需詳細資訊、請參閱<block ref="f351263ad3706bd0a472039400dece78" category="inline-link-rx"></block>。</block>
  <block id="acab4c655c4a7b4db67fc07e22b86222" category="list-text">*加密的通訊通道。*所有外部通訊都是使用TLS透過HTTPS進行。</block>
  <block id="47a37e2d5fc8b7c936ad9b2b7a569a08" category="paragraph">下表提供開放連接埠詳細資料。</block>
  <block id="10bd16a816f831080065e807daa36a9a" category="cell">TCP v4/v6連接埠號碼</block>
  <block id="edf0320adc8658b25ca26be5351b6c4a" category="cell">8144.</block>
  <block id="d4a973e303ec37692cc8923e3148eef7" category="cell">8080</block>
  <block id="2c25c3d66f80eeaa8d6e5a144c6f942e" category="cell">用於OVA GUI的HTTPS連線</block>
  <block id="14b3e670eec63cc0cc456fd904bbfbd9" category="cell">SSH（預設為停用）</block>
  <block id="16fc18d787294ad5171100e33d05d4e2" category="cell">3306.</block>
  <block id="4cbf9c234f6b34c242a110cb993252bd" category="cell">MySQL（僅限內部連線；預設為停用外部連線）</block>
  <block id="29ab4efbdb7c727c81ee1382593bc5e2" category="cell">Ngin像（資料保護服務）</block>
  <block id="89f152cad33314315b4995ed1ca71535" category="inline-link">如何建立及/或將SSL憑證匯入SnapCenter VMware vSphere（選擇控制器）的VMware外掛程式</block>
  <block id="450adc59e39f23172756ac9369494a2d" category="list-text">*支援憑證授權單位（CA）簽署的憑證。* SnapCenter VMware vSphere的支援外掛程式支援CA簽署憑證的功能。請參閱<block ref="9f83d87d5d9f604d96288df21d450fac" category="inline-link-rx"></block>。</block>
  <block id="05a1aa8021df4579874c4eeb8788e5c9" category="list-text">*密碼原則。*下列密碼原則有效：</block>
  <block id="2c87609dbbc3630573c64e271de8207d" category="list-text">所有認證資訊均使用SHA256雜湊來儲存。</block>
  <block id="0f1a6fa0a65f9d5c3c4a16b070104d7a" category="list-text">*基本作業系統映像*。*本產品隨附適用於OVA的Debian基礎作業系統、存取受限且停用Shell存取。如此可減少攻擊佔用空間。每SnapCenter 個發行版基礎作業系統都會更新最新的安全修補程式、以達到最大的安全覆蓋範圍。</block>
  <block id="83cd5867ba912e517fa1100299fd1cf3" category="paragraph">NetApp針對SnapCenter VMware vSphere應用裝置開發有關VMware vSphere外掛程式的軟體功能與安全性修補程式、然後將其作為套裝軟體平台發佈給客戶。由於這些應用裝置包括特定的Linux子作業系統相依性、以及我們的專屬軟體、因此NetApp建議您不要變更子作業系統、因為這會對NetApp應用裝置造成重大影響。這可能會影響NetApp支援應用裝置的能力。NetApp建議測試及部署我們最新的應用裝置程式碼版本、因為這些版本已發行以修補任何與安全性相關的問題。</block>
  <block id="1bc6cee680286aae1b12889369b7f18a" category="summary">ONTAP 上的 MySQL</block>
  <block id="dac8ea4fbfd87a535663c227b91f50e3" category="doc">I/O 排程器</block>
  <block id="215dca219378b291ae287eb076489fdd" category="paragraph">Linux 核心可讓您以低層級控制 I/O 排程封鎖裝置的方式。</block>
  <block id="dc36d23ef487690f1698c69d9e49cee2" category="paragraph">Linux 各版本的預設值差異極大。MySQL 建議您使用<block ref="722d122e81cbbe543bd5520bb8678c0e" prefix=" " category="inline-code"></block> 或是<block ref="30e482a8ab57cfc19075dece53b0a56b" prefix=" " category="inline-code"></block> 在 Linux 上具有原生非同步 I/O （ AIO ）的 I/O 排程器。一般而言、 NetApp 客戶和內部測試都能透過 NoOps 獲得更好的結果。</block>
  <block id="6def78482bd1915cb81f0f5c19ee8fe6" category="paragraph">MySQL 的 InnoDB 儲存引擎使用 Linux 上的非同步 I/O 子系統（原生 AIO ）來執行預先讀取和寫入資料檔案頁面的要求。此行為由控制<block ref="2c03186a22d036ce7dad84be5de2f2ce" prefix=" " category="inline-code"></block> 組態選項、預設為啟用。有了原生的整合式全功能電腦、 I/O 排程器的類型對 I/O 效能有更大的影響。執行效能標竿、判斷哪一個 I/O 排程器可為您的工作負載和環境提供最佳結果。</block>
  <block id="e7b09beaf26efc7d8bee91786cf794b5" category="paragraph">如需設定 I/O 排程器的指示、請參閱相關的 Linux 和 MySQL 文件。</block>
  <block id="6e8775bd755a8835ce86806d669677ea" category="doc">儲存組態</block>
  <block id="2f09ac000b4a1808cb795b7bdbb20ecc" category="doc">InnoDB_log_file_size</block>
  <block id="b8674b2897b288ca55b74328df4780b3" category="paragraph">為 InnoDB 記錄檔大小選取適當的大小、對於寫入作業以及在伺服器當機後擁有適當的還原時間都很重要。</block>
  <block id="b61bad6f7bf48bf9abda0c86c9beed79" category="paragraph">由於有這麼多交易登入檔案、因此記錄檔大小對於寫入作業非常重要。修改記錄時、變更不會立即回寫到表格區。相反地、變更會記錄在記錄檔的結尾、而且頁面會標示為「髒污」。InnoDB 使用其記錄檔將隨機 I/O 轉換成連續 I/O</block>
  <block id="e87d83a3c0af4df83efb4784b5182f8f" category="paragraph">當記錄檔已滿時、會依序將不完整頁面寫入資料表空間、以釋放記錄檔中的空間。例如、假設某個伺服器在交易過程中當機、而且寫入作業只會記錄在記錄檔中。伺服器必須經過復原階段、記錄檔中記錄的變更會重新播放、才能重新上線。記錄檔中的項目越多、伺服器恢復所需的時間就越長。</block>
  <block id="8321756b7fedf72543a1b0917bf92613" category="paragraph">在此範例中、記錄檔大小會同時影響還原時間和寫入效能。為記錄檔大小選擇正確的數字時、請平衡恢復時間與寫入效能。一般而言、 128M 和 512M 之間的任何項目都是物超所值的。</block>
  <block id="598132a821e8cc696fbbae934047d991" category="paragraph">MySQL 及其變種、包括 MariaDB 和 Percona MySQL 、是全球最受歡迎的資料庫。</block>
  <block id="35701e1bcd40c8e1a520fc33d0e14842" category="doc">InnoDB_Flush 方法</block>
  <block id="138738e11d5fda5c496edaa92e32e158" category="paragraph">InnoDB_flush_method 參數指定 InnoDB 如何開啟及排清記錄檔和資料檔。</block>
  <block id="c262c8cd82b96f69fbbc058d7a35683b" category="section-title">最佳化</block>
  <block id="d1e67ebe6122765789852eb430c42c75" category="paragraph">在 InnoDB 最佳化中、如果適用、設定此參數會調整資料庫效能。</block>
  <block id="51ca63a7fb332d4d18e7139ea5787c50" category="paragraph">下列選項用於透過 InnoDB 排清檔案：</block>
  <block id="a9b8d4c72b58a9554274cba7904d47e2" category="list-text"><block ref="e590322920bebc1156ab585bd6597d76" prefix="" category="inline-code"></block>。InnoDB 使用<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> 系統呼叫以清除資料和記錄檔。此選項為預設設定。</block>
  <block id="8198b1fd4bf2fafa4f4e8ffb4a8ac900" category="list-text"><block ref="a48be70a21bca2cf4b3e481efed66ae4" prefix="" category="inline-code"></block>。InnoDB 使用<block ref="a48be70a21bca2cf4b3e481efed66ae4" prefix=" " category="inline-code"></block> 用於打開和刷新日誌文件和 fsync （）以刷新數據文件的選項。InnoDB 不使用<block ref="a48be70a21bca2cf4b3e481efed66ae4" prefix=" " category="inline-code"></block> 直接來說、因為 UNIX 的許多種類都有問題。</block>
  <block id="f89f9147df5dde99a7944d2028b59e7e" category="list-text"><block ref="6a334fd488ef92b18584207148410cc4" prefix="" category="inline-code"></block>。InnoDB 使用<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> 選項（或<block ref="42d27f470f62deaad644fef8618b59bb" prefix=" " category="inline-code"></block> 在 Solaris 上）開啟資料檔案及使用<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> 清除資料和記錄檔。此選項可在某些版本的 GNU/Linux 、 FreeBSD 和 Solaris 上使用。</block>
  <block id="5e90100e134d805a66f8cda2e73f5298" category="list-text"><block ref="d66655d6d13113f23421f282ed1eaeb7" prefix="" category="inline-code"></block>。InnoDB 使用<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> 排清 I/O 時的選項；不過、它會跳過<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> 之後進行系統通話。此選項不適用於某些類型的檔案系統（例如 XFS ）。如果您不確定檔案系統是否需要<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> 系統呼叫（例如為了保留所有檔案中繼資料）使用<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> 選項。</block>
  <block id="c680d437163cc6bab4f9bdb35c3073d0" category="section-title">觀察</block>
  <block id="907dee0040812e8e7d1fd00b870b5063" category="paragraph">在 NetApp 實驗室測試中、<block ref="e590322920bebc1156ab585bd6597d76" prefix=" " category="inline-code"></block> 預設選項用於 NFS 和 SAN 、與相較之下、這是一項很棒的效能改進工具<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block>。使用「齊平」方法時為<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> 使用 ONTAP 時、我們觀察到用戶端會以序列方式、在 4096 區塊的邊界寫入大量的單位位元組寫入資料。這些寫入會增加網路延遲並降低效能。</block>
  <block id="2f0b9319cf6d59e07ea4b1ef65a12be1" category="doc">open_file_limits</block>
  <block id="11e52b21a9795b7dcf947027b0ec5d01" category="paragraph">。<block ref="2f0b9319cf6d59e07ea4b1ef65a12be1" prefix=" " category="inline-code"></block> 參數決定作業系統允許 mysqld 開啟的檔案數目。</block>
  <block id="e0732f22b2900006e8fcb6367fd162f7" category="paragraph">此參數在執行階段的值是系統允許的實際值、可能與您在伺服器啟動時指定的值不同。在 MySQL 無法變更開啟檔案數量的系統上、此值為 0 。有效<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 此值是根據系統啟動時指定的值（如果有）和的值而定<block ref="0bc91339c0d774f560a9a38fc9dfac30" prefix=" " category="inline-code"></block> 和<block ref="023a3b50ddf424c9a1d51984190a0c92" prefix=" " category="inline-code"></block> 使用這些公式：</block>
  <block id="6b840ff0a7667f4642a0844269657fc4" category="list-text">10 +<block ref="0bc91339c0d774f560a9a38fc9dfac30" prefix=" " category="inline-code"></block> + <block ref="023a3b50ddf424c9a1d51984190a0c92" prefix="(" category="inline-code"></block> x 2 ）</block>
  <block id="d3de183489c20b8efa2947eeff3028d7" category="list-text"><block ref="0bc91339c0d774f560a9a38fc9dfac30" prefix="" category="inline-code"></block> x 5.</block>
  <block id="2c08922fbaba089e7c2982df43fd352a" category="list-text">如果為正、則作業系統限制</block>
  <block id="8ca153937fcbdf56497ad779a91f31d1" category="list-text">如果作業系統限制為無限：<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 在啟動時指定值；若無、則指定值為 5 、 000</block>
  <block id="98038bb4026a70f5ee4041522c6eebe4" category="paragraph">伺服器會嘗試使用這四個值的最大值來取得檔案描述元數目。如果無法取得這麼多描述元、伺服器會嘗試取得系統允許的數量。</block>
  <block id="3ee58d04a0dc9b2551698643e0421005" category="doc">InnoDB_LRU_SCAN_depth</block>
  <block id="29d0f4f8b383d39e73abd11ac73ca28a" category="paragraph">。<block ref="3ee58d04a0dc9b2551698643e0421005" prefix=" " category="inline-code"></block> 參數會影響 InnoDB 緩衝區集區之排清作業的演算法和啟發性。</block>
  <block id="eeb16232629bd788f0d29c104105bba2" category="paragraph">此參數主要是效能專家調校 I/O 密集工作負載的興趣所在。對於每個緩衝區集區執行個體、此參數會指定最少使用（ LRU ）頁面清單中、頁面清理程式執行緒應繼續掃描的程度、以尋找要清除的髒頁面。此背景作業每秒執行一次。</block>
  <block id="39359bf2914e4e1cf84a9dea580fd20a" category="paragraph">您可以上下調整值、將可用頁數降至最低。請勿將此值設定得比所需值高得多、因為掃描可能會產生重大的效能成本。此外、請考慮在變更緩衝區集區執行個體數目時調整此參數、因為<block ref="f2c8312d381c16c6c95a727c3f61a4c7" prefix=" " category="inline-code"></block> 定義頁面清理程式執行緒每秒執行的工作量。</block>
  <block id="513a275422fae2456617321a2f3fc0af" category="paragraph">小於預設值的設定適用於大部分的工作負載。只有在典型工作負載下有備用 I/O 容量時、才考慮增加此值。相反地、如果寫入密集的工作負載使 I/O 容量飽和、請降低該值、尤其是當您擁有大型緩衝區集區時。</block>
  <block id="62812b938ba1113b81bd7f612ad0e6f8" category="doc">InnoDB_緩 衝區 _Pool_size</block>
  <block id="d7a8b502d05f5e477158eb80c1fb8dae" category="paragraph">InnoDB 緩衝資源池是任何調校活動中最重要的部分。</block>
  <block id="5cb6c45d18482180f34ae727b53379fb" category="paragraph">InnoDB 在很大程度上仰賴緩衝區集區來快取索引和資料、調適性雜湊索引、插入緩衝區、以及許多內部使用的其他資料結構。緩衝區集區也會緩衝資料的變更、這樣就不需要立即對儲存設備執行寫入作業、進而改善效能。緩衝區集區是 InnoDB 的一部分、必須據此調整其大小。設定緩衝區集區大小時、請考量下列因素：</block>
  <block id="03f07291794c3b9cb00d04cb9f30be81" category="list-text">若為僅 InnoDB 的專用機器、請將緩衝區集區大小設為 80% 以上的可用 RAM 。</block>
  <block id="7b0119b7fa59f87d23d5c65da456b226" category="list-text">如果不是 MySQL 專用伺服器、請將 RAM 大小設為 50% 。</block>
  <block id="a6a9695e1464f5554c0006c55facfadf" category="doc">檔案描述元</block>
  <block id="8e222c68dd214db9f8a1b5b572ee6267" category="paragraph">它會使用它們來開啟新的連線、將資料表儲存在快取中、建立暫時資料表來解決複雜的查詢、以及存取持續性的查詢。如果 mysqld 在需要時無法開啟新檔案、它就能停止正常運作。此問題的常見症狀是錯誤 24 「開啟的檔案太多」。 mysqld 可以同時開啟的檔案描述元數量是由定義的<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 設定在組態檔案中的選項 <block ref="86d0d007043d911697753b35e2c18f35" prefix="(" category="inline-code"></block>）。但是<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 也取決於作業系統的限制。這種相依性會使設定變數變得更複雜。</block>
  <block id="07561a91f81dfe3c8e4364aac8bdbea4" category="paragraph">MySQL 無法設定<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 選項高於下所指定的選項<block ref="dd1c6d8164dfd1cee0afa39b177e843b" prefix=" " category="inline-code"></block>。因此、您必須在作業系統層級明確設定這些限制、才能讓 MySQL 視需要開啟檔案。檢查 Linux 檔案限制的方法有兩種：</block>
  <block id="84e705ac120a887df441f4161dc29409" category="list-text">。<block ref="2eabb4efed7dffb32ea1170eab71b798" prefix=" " category="inline-code"></block> 命令會快速為您提供所允許或鎖定參數的詳細說明。執行此命令所做的變更並非永久性變更、將會在系統重新開機後清除。</block>
  <block id="a4c404dc92855948bc4c007a86091dbe" category="list-text">變更為<block ref="b803f460349bd101b1de260021ef0e60" prefix=" " category="inline-code"></block> 檔案是永久性的、不受系統重新開機影響。</block>
  <block id="cbcab8220d4ffddbdc44f9936125d83d" category="paragraph">請務必同時變更使用者 mysql 的硬限制和軟限制。以下摘錄來自組態：</block>
  <block id="97dc47f90c600a96fac6642560ffaceb" category="paragraph">同時、請在中更新相同的組態<block ref="90f16be5b82ca0aa94088c89fe00b3dd" prefix=" " category="inline-code"></block> 以完全使用開放式檔案限制。</block>
  <block id="395ec860c9530814e94538b7121a8319" category="doc">InnoDB_Flush 記錄 _AT_TRx_Commit</block>
  <block id="2f2c7742844f13de59d435b9099c78cc" category="paragraph">當資料發生變更時、變更不會立即寫入儲存設備。</block>
  <block id="0b36b8f791a48c7b4692e7df069dabc8" category="paragraph">而是記錄在記錄緩衝區中、這是 InnoDB 分配給記錄在記錄檔中的緩衝區變更的記憶體部分。InnoDB 會在交易提交、緩衝區滿時、或每秒一次（以先發生的事件為準）、將緩衝區排清至記錄檔。控制此程序的組態變數是 InnoDB_Flush 記錄 _AT_TRx_Commit 。價值選項包括：</block>
  <block id="280a38864b81c14ba3db52801e087ed0" category="list-text">當您設定時<block ref="cab9a35054c49f0ba619a6e6943f461b" prefix=" " category="inline-code"></block>、 InnoDB 會將修改過的資料（在 InnoDB 緩衝區集區中）寫入記錄檔（ IB_logfile ）、並每秒清除記錄檔（寫入儲存區）。不過、提交交易時、它不會執行任何動作。如果發生電源故障或系統當機、則沒有任何未排清的資料可恢復、因為它不會寫入記錄檔或磁碟機。</block>
  <block id="5967bb5566cb7cd8bdb0b372ceb21565" category="list-text">當您設定時<block ref="1ab7a7611b59147e84a38b6f3e7d9d09" prefix=" " category="inline-code"></block>、 InnoDB 會將記錄緩衝區寫入交易記錄檔、並在每筆交易中將記錄檔排清至持久儲存區。例如、對於所有交易認可、 InnoDB 會寫入記錄、然後寫入儲存設備。儲存速度變慢會對效能造成負面影響、例如每秒 InnoDB 交易數會減少。</block>
  <block id="9e9b3a43cb7a1b13c5ee3f6519d7f60e" category="list-text">當您設定時<block ref="44d4dfee9b1c95f8768bec989cd3baf5" prefix=" " category="inline-code"></block>、 InnoDB 會在每次提交時將記錄緩衝區寫入記錄檔、但不會將資料寫入儲存區。InnoDB 每秒會清除一次資料。即使發生電源故障或系統當機、記錄檔中也有選項 2 資料可供使用、而且可恢復。</block>
  <block id="14f3e0328e25aa02b37bd6817a442a58" category="paragraph">如果效能是主要目標、請將值設為 2 。由於 InnoDB 每秒一次寫入磁碟機、而非每次提交交易時、效能大幅提升。如果發生停電或當機、可從交易記錄中恢復資料。</block>
  <block id="4a34cbb1957909093a2e216fc1cd0962" category="paragraph">如果資料安全是主要目標、請將值設為 1 、以便每次提交交易時、 InnoDB 都會將資料清出磁碟機。不過、效能可能會受到影響。</block>
  <block id="53be3047aa6f8a62c640cc8b4d6089c6" category="admonition">* NetApp 建議 * 將 InnoDB_Flush 日誌 _TRx_Commit 值設為 2 、以獲得更好的效能。</block>
  <block id="2199371f8380c97ad11a03fba3b501c9" category="doc">InnoDB_IO_capAC</block>
  <block id="ac165f23bb7435219b226ed6e76c5fa4" category="paragraph">在 InnoDB 外掛程式中、從 MySQL 5.7 新增名為 InnoDB_IO_capACure.</block>
  <block id="b4f38c42ef968074288f239b42e92b7f" category="paragraph">它可控制 InnoDB 執行的 IOPS 上限（包括髒頁的排清率、以及插入緩衝區 [ibuf] 批次大小）。InnoDB_IO_capAC容量 參數會根據 InnoDB 背景工作來設定 IOPS 上限、例如從緩衝區排清頁面、以及從變更緩衝區合併資料。</block>
  <block id="9679a08c293f29d9546c42207b09d418" category="paragraph">將 InnoDB_IO_capAC容量 參數設定為系統每秒可執行的 I/O 作業大約數目。理想情況下、請盡可能將設定保持在低的位置、但不要太低、讓背景活動變慢。如果設定太高、資料會從緩衝區移除、並太快插入緩衝區以供快取、以提供顯著效益。</block>
  <block id="668b6acc98c3469094062ed50b43e43a" category="admonition">* NetApp 建議 * 如果在 NFS 上使用此設定、請分析 IOPS （ Sys台 / Fio ）的測試結果、並據此設定參數。除非您在 InnoDB 緩衝資源池中看到比您想要的更多修改或不乾淨頁面、否則請使用最小的值來進行排清和清除。</block>
  <block id="038b11d42ee14bd77b6370c575c63b16" category="admonition">除非您證明較低的值不足以應付工作負載、否則請勿使用極端值、例如 20,000 或更多。</block>
  <block id="62385f5ceb285bca676cb0561555d719" category="paragraph">InnoDB_IO_capACure. 參數可規範排清率和相關 I/O</block>
  <block id="58d94bb6e53e154e2f4b16efa09f4c0d" category="paragraph">只要 I/O 和容量需求在單一 LUN 檔案系統的限制範圍內、就可以將較小的資料庫放在一對標準 LUN 上。例如、需要大約 2K 隨機 IOPS 的資料庫、可以裝載在單一 LUN 上的單一檔案系統上。同樣地、只有 100GB 大小的資料庫也能放在單一 LUN 上、而不會造成管理問題。</block>
  <block id="c33bcb4f520265bb106616e844397ffb" category="paragraph">大型資料庫需要多個 LUN 。例如、需要 10 萬 IOPS 的資料庫最可能需要至少八個 LUN 。由於磁碟機的 SCSI 通道數量不足、單一 LUN 將成為瓶頸。10TB 資料庫同樣難以在單一 10TB LUN 上進行管理。邏輯磁碟區管理程式的設計旨在將多個 LUN 的效能和容量功能結合在一起、以改善效能和管理能力。</block>
  <block id="428e88a1415b00f5eb396829b4bd9a2c" category="paragraph">在這兩種情況下、一對 ONTAP 磁碟區應該足夠。透過簡單的組態、資料檔案 LUN 會與記錄 LUN 一樣置於專用磁碟區中。在邏輯 Volume Manager 組態下、資料檔案 Volume 群組中的所有 LUN 都將位於專用磁碟區、而記錄 Volume 群組的 LUN 則位於第二個專用磁碟區。</block>
  <block id="e8c31916b755be39cb0a66804a1d8f8b" category="paragraph">* NetApp 建議 * 在 SAN 上使用兩個檔案系統進行 MySQL 部署：</block>
  <block id="fe9d8ca2c46747e16ed31f64638e66e6" category="list-text">第一個檔案系統會儲存所有 MySQL 資料、包括資料表空間、資料和索引。</block>
  <block id="04d82ed32fa1eeaa6df117c178062441" category="list-text">第二個檔案系統會儲存所有記錄（二進位記錄、慢速記錄和交易記錄）。</block>
  <block id="15bcb76b7e8b441c0d2a6e723f70c20c" category="paragraph">以這種方式分隔資料有多種原因、包括：</block>
  <block id="02774797d31a8f1c6d805860038c32a3" category="list-text">資料檔案和記錄檔的 I/O 模式各不相同。將它們區隔、就能透過 QoS 控制提供更多選項。</block>
  <block id="6cab2c793e807e2d0c57f5b0d96505c1" category="list-text">最佳化使用 Snapshot 技術需要能夠個別還原資料檔案。將資料檔案與記錄檔混合會干擾資料檔案還原。</block>
  <block id="553ad1f7b6f5cfee021e5cf56e56a289" category="list-text">NetApp SnapMirror 技術可用於為資料庫提供簡單、低 RPO 的災難恢復功能、但是資料檔案和記錄檔需要不同的複寫排程。</block>
  <block id="ff5f52a69a35dd41da3e3c4b810e4f94" category="admonition">使用這種基本的兩個磁碟區配置、以符合未來需求的解決方案、以便在需要時使用所有 ONTAP 功能。</block>
  <block id="7b755794e9de5716b2d6305bd10bee1b" category="paragraph">* NetApp 建議 * 使用 ext4 檔案系統格式化磁碟機、因為有下列功能：</block>
  <block id="fa92f58d5035dec5e24a787f76504783" category="list-text">延伸的區塊管理方法、用於日誌檔案系統（ JFS ）中的區塊管理功能、以及延伸檔案系統（ XFS ）的延遲分配功能。</block>
  <block id="a72d73cde02c10703b72dcae6bc7c812" category="list-text">ext4 允許檔案系統最多 1 個 exbibyte （ 2^60 位元組）、檔案最多 16 個 tebibytes （ 16 * 2^40 位元組）。相反地、 ext3 檔案系統僅支援 16TB 的最大檔案系統大小、最大檔案大小為 2TB 。</block>
  <block id="56b4168424fa999bc383d24daf2da4eb" category="list-text">在 ext4 檔案系統中、多區塊分配（ mballoc ）會在單一作業中為檔案分配多個區塊、而非如 ext3 中逐一分配。此組態可減少多次呼叫區塊分配器的成本、並最佳化記憶體配置。</block>
  <block id="632635d22b347f0140fb15d0eb0ed09e" category="list-text">雖然 XFS 是許多 Linux 套裝作業系統的預設值、但它以不同方式管理中繼資料、不適合某些 MySQL 組態。</block>
  <block id="aff8b2ed0a4719f014e5baeb861ea7d4" category="paragraph">* NetApp 建議 * 將 4K 區塊大小選項與 mkfs 公用程式搭配使用、以符合現有區塊 LUN 大小。</block>
  <block id="0a24d0336b7b0b29a9daa97f88499884" category="paragraph"><block ref="018d13c1d8b9abcae080b8abbc7c2d8b" prefix="" category="inline-code"></block></block>
  <block id="86fc8cb3bf2cae621315896a94b35f67" category="paragraph">NetApp LUN 以 4KB 實體區塊儲存資料、產生八個 512 位元組的邏輯區塊。</block>
  <block id="5f441ceabc94de2a9cced94d9f53a2d0" category="paragraph">如果您未設定相同的區塊大小、 I/O 將無法正確對齊實體區塊、而且可能會在 RAID 群組中的兩個不同磁碟機中寫入、導致延遲。</block>
  <block id="236ac851d05b8822524001920948f23d" category="admonition">請務必調整 I/O 、以順利進行讀寫作業。但是、當 I/O 從不在實體區塊開頭的邏輯區塊開始時、 I/O 會未對齊。I/O 作業只有在邏輯區塊（實體區塊中的第一個邏輯區塊）開始時才會對齊。</block>
  <block id="3225a10b07f1580f10dee4abc3779e6c" category="cell">參數</block>
  <block id="c82a6100dace2b41087ba6cf99a5976a" category="cell">價值</block>
  <block id="b10db909b8fda84e70bf9b308d0938d9" category="cell">256M</block>
  <block id="c81e728d9d4c2f636f067f89cc14862c" category="cell">2.</block>
  <block id="7ccc31934ae8244d8263d3c09bcee186" category="cell">InnoDB_doublewrite</block>
  <block id="e590322920bebc1156ab585bd6597d76" category="cell">fsync</block>
  <block id="adb0c1ec32461889a5093441599260eb" category="cell">11g</block>
  <block id="774412967f19ea61d448977ad9749078" category="cell">8192</block>
  <block id="311887a53ec7390fc383fa2ad813f012" category="cell">InnoDB_緩 衝區集區執行個體</block>
  <block id="c9f0f895fb98ab9159f51fd0297e236d" category="cell">8.</block>
  <block id="1006f82d8df7d2325439b28ea691737c" category="cell">open_file_limit</block>
  <block id="3c9b5f1cd6a030bcb7bed9eac80589fb" category="cell">65535</block>
  <block id="c9f5a4d3ede4d084dda0a788ed06783c" category="paragraph">若要設定本節所述的參數、您必須在 MySQL 組態檔（ my.cnf ）中變更這些參數。NetApp 最佳實務做法是在內部執行測試的結果。</block>
  <block id="6a554ff1dc93539a626e576bf0d28a02" category="paragraph">MySQL 資料庫的容器化日漸普及。</block>
  <block id="bcc002a9f2e2ade112438f50a6630498" category="paragraph">低層級的容器管理幾乎總是透過 Docker 來執行。OpenShift 和 Kubernetes 等容器管理平台讓大型容器環境的管理變得更簡單。容器化的優點包括成本較低、因為不需要授權 Hypervisor 。此外、容器可讓多個資料庫彼此隔離執行、同時共用相同的基礎核心和作業系統。容器可在微秒內完成佈建。</block>
  <block id="14d9b10c6196045941347a9e85704b50" category="inline-link-macro">Astra Trident文件</block>
  <block id="b8c3891a902a70c4f7f774363652f4b4" category="summary">MySQL 檔案結構</block>
  <block id="5713a921d815fd7d19875846450f8ea8" category="doc">檔案結構</block>
  <block id="4955922857da5499a2f1be602a96b0ff" category="paragraph">InnoDB 是儲存設備和 MySQL 伺服器之間的中間層、可將資料儲存到磁碟機中。</block>
  <block id="5d416cf65dd1e2c908bf430f957c89f8" category="paragraph">MySQL I/O 分為兩種類型：</block>
  <block id="e8a320970c929abda9ae744b0b9e8f5f" category="list-text">隨機檔案 I/O</block>
  <block id="85430c0aa096ec282f2a14156baa312e" category="list-text">連續檔案 I/O</block>
  <block id="b7b9a4c6983139a2673988826094a3cf" category="paragraph">資料檔案會隨機讀取及覆寫、因此 IOPS 較高。因此、建議使用 SSD 儲存設備。</block>
  <block id="322f79fd77365edecd173807cb429ca2" category="paragraph">重做記錄檔和二進位記錄檔是交易記錄檔。它們會依序寫入、因此您可以在 HDD 上使用寫入快取獲得良好效能。恢復時會進行連續讀取、但很少會造成效能問題、因為記錄檔大小通常比資料檔案小、而連續讀取比隨機讀取快（發生在資料檔案上）。</block>
  <block id="a898d206a27508975fea2e241af2f04e" category="paragraph">雙寫入緩衝區是 InnoDB 的一項特殊功能。InnoDB 會先將排清的頁面寫入雙寫入緩衝區、然後將頁面寫入資料檔案的正確位置。此程序可防止頁面毀損。如果沒有雙寫入緩衝區、如果在寫入磁碟機程序期間發生電源故障、頁面可能會毀損。由於寫入雙寫入緩衝區是循序的、因此對 HDD 進行了高度最佳化。恢復時會進行連續讀取。</block>
  <block id="363512900e45bc17bdd6edfa50582862" category="paragraph">由於 ONTAP NVRAM 已提供寫入保護、因此不需要雙重寫入緩衝。MySQL 有一個參數、<block ref="02d3c518a4019ea00e34e16491d826b4" prefix=" " category="inline-code"></block>，以停用雙寫入緩衝區。此功能可大幅提升效能。</block>
  <block id="49a7df723922bddb4df4002b51087a1c" category="paragraph">插入緩衝區也是 InnoDB 的一項特殊功能。如果非唯一的次要索引區塊不在記憶體中、 InnoDB 會將項目插入插入插入緩衝區、以避免隨機 I/O 作業。插入緩衝區會定期合併到資料庫的次要索引樹中。插入緩衝區可將 I/O 要求合併至同一個區塊、以減少 I/O 作業的數量；隨機 I/O 作業可以是連續的。插入緩衝區也針對 HDD 進行了高度最佳化。連續寫入和讀取都會在正常作業期間執行。</block>
  <block id="6a0190340f27f29279bbfd319800289d" category="paragraph">復原區段以隨機 I/O 為導向。為了保證多重版本併發（ MVCC ）、 InnoDB 必須在復原區段中登錄舊影像。從復原區段讀取先前影像需要隨機讀取。如果您執行具有可重複讀取的長交易（例如 mysqldump —單一交易）或執行長查詢、可能會發生隨機讀取。因此、在這種情況下、將復原區段儲存在 SSD 上會更好。如果您只執行簡短的交易或查詢、隨機讀取並不是問題。</block>
  <block id="a27e0d4b650aa6db30fdd95b54c94b27" category="paragraph">* 由於 InnoDB I/O 特性、 NetApp 建議 * 下列儲存設計配置。</block>
  <block id="defc1bfda928f419df5e4af79c98343e" category="list-text">一個用於儲存 MySQL 的隨機和連續 I/O 導向檔案的磁碟區</block>
  <block id="7fd750411093ebd1faa0d99dd2608514" category="list-text">另一個用於儲存 MySQL 純粹循序 I/O 導向檔案的磁碟區</block>
  <block id="0561a3b014eef0e5125fa63e1626cf57" category="paragraph">此配置也能協助您設計資料保護原則與策略。</block>
  <block id="9166d970028a28a614af39e6286371b7" category="paragraph">您可以使用關閉此參數<block ref="8cafbd8d9096941261e87f4f9152ab92" prefix=" " category="inline-code"></block> 針對效能標竿、或是當您比較在意最高效能、而非資料完整性或可能的故障時。InnoDB 使用稱為雙寫入的檔案清除技術。InnoDB 在將頁面寫入資料檔案之前、會將其寫入稱為雙寫入緩衝區的鄰近區域。寫入和清除雙寫入緩衝區完成後、 InnoDB 會將頁面寫入資料檔案中的適當位置。如果作業系統或 mysqld 程序在頁面寫入期間當機、 InnoDB 之後可以在當機恢復期間、從雙寫入緩衝區找到良好的頁面複本。</block>
  <block id="3dfd4b9a526f8a8cf17021e34638b375" category="admonition">* NetApp 建議 * 停用雙寫入緩衝區。ONTAP NVRAM 的功能相同。雙重緩衝會不必要地損害效能。</block>
  <block id="0e5e83102103fcdd25af430bf7327034" category="paragraph">MySQL 文件建議您將 NFSv4 用於 NAS 部署。</block>
  <block id="ca0d9fdc80b88e73b548638af421788f" category="section-title">ONTAP NFS 傳輸大小</block>
  <block id="efcd0ba3fcbee9896a25804677e70b4b" category="paragraph">根據預設、 ONTAP 將 NFS IO 大小限制為 64K 。使用 MySQL 資料庫的隨機 IO 使用的區塊大小要小得多、遠低於 64K 上限。大型區塊 IO 通常是平行處理的、因此 64K 最大值也不是限制。</block>
  <block id="4655f686de75b23f16d530ed7351c447" category="paragraph">有些工作負載的上限為 64K 、因此會造成限制。尤其是、如果資料庫執行的 IO 數量較少、但容量較大、例如完整表格掃描備份作業等單執行緒作業、將會更快、更有效率地執行。ONTAP 搭配資料庫工作負載的最佳 IO 處理大小為 256k 。針對下列特定作業系統所列出的 NFS 裝載選項已相應從 64K 更新至 256k 。</block>
  <block id="3ab93db30f3dded2c8d71859afbb53f6" category="admonition">切勿將 ONTAP 上允許的傳輸大小上限降至低於目前掛載之 NFS 檔案系統的 rsize/wsize 值。這可能會在某些作業系統中造成當機或甚至資料毀損。例如、如果 NFS 用戶端目前設定為 rsize/wsize 65536 、則 ONTAP 最大傳輸大小可在 65536 到 1048576 之間調整、因為用戶端本身受到限制、因此沒有任何影響。將傳輸大小上限降至 65536 以下可能會損害可用度或資料。</block>
  <block id="5ea0bb5d4dab46d7971fef94ccde9369" category="paragraph">* NetApp 推薦 *</block>
  <block id="09c6aa928c90ba68a4e03deadfeaa644" category="paragraph">設定下列 NFSv4 Fstab （ /etc/fstab ）設定：</block>
  <block id="0ae3c9648bc2d8c33fa57415604da370" category="paragraph"><block ref="a63a3dc825ff52908de7c9dfcb29ffa5" prefix="" category="inline-code"></block></block>
  <block id="3e0b2c100b093560f63ad57c6849bc8a" category="admonition">NFSv3 的常見問題是停電後鎖定的 InnoDB 記錄檔。使用時間或切換記錄檔可解決此問題。不過、 NFSv4 有鎖定作業、並追蹤開啟的檔案和委派。</block>
  <block id="62e4eb800d20b46085ccb975da78bafe" category="sidebar">ONTAP 是許多企業應用程式與資料庫技術的資料管理與資料保護基礎。下列頁面提供 ONTAP 和企業應用程式及基礎架構的最佳實務做法和實作程序指引。</block>
  <block id="78898e52fcbdc5337204a384f2456d4f" category="sidebar">Microsoft SQL Server</block>
  <block id="4f60acc41a8bf3fa75e7f74768637787" category="sidebar">Microsoft SQL Server 資料保護</block>
  <block id="b8529ff730dcf8dd2178d72de271dc4d" category="sidebar">開放原始碼資料庫</block>
  <block id="bb9a5a6fadabab849d2e87f0898d7601" category="sidebar">ONTAP 上的 MariaDB 和 MySQL</block>
  <block id="5ad2a11eceac3ebd7cbf3b534ebdb1db" category="sidebar">ONTAP 上的 PostgreSQL</block>
  <block id="c30dd1a85cf86d95b11c1a08f70130ce" category="sidebar">Oracle資料庫</block>
  <block id="4948dede9f4e7c3dfe48c38f7902f6e5" category="sidebar">ONTAP 上的 Oracle</block>
  <block id="d71074394b511143c8d1108e74a81abb" category="sidebar">Oracle 資料保護</block>
  <block id="f4d8825927d11df25770df5e00d6a52e" category="sidebar">Oracle 移轉</block>
  <block id="86083f3ea21c2385b4f013aae3c57858" category="sidebar">SAP HANA</block>
  <block id="677f2e7e550075f7bbbdac91e0918f2f" category="sidebar">SAP解決方案</block>
  <block id="1b83f2b1c0b7fb3af048c2a59624fe3b" category="sidebar">SAP HANA 搭配 AFF 和 FC</block>
  <block id="6ab3c3f05076d213f0b1feff267607c6" category="sidebar">SAP HANA 搭配 AFF 和 NFS</block>
  <block id="56079badd056a19303cc26e6a4fcc7e0" category="sidebar">VMware</block>
  <block id="f07084a11252c9bca97503ea9a627c89" category="sidebar">使用 ONTAP 的虛擬磁碟區（ VVols ）</block>
  <block id="2d90ac09cbf108bddad31dd341f8614e" category="sidebar">VMware Site Recovery Manager 搭配 ONTAP</block>
  <block id="b0dae11b82e63781abdc8f893c41b3c0" category="sidebar">企業應用程式</block>
  <block id="999bc6b18351bbe817d26f559ba408ae" category="sidebar">SAP</block>
  <block id="2d2eef88dbdd0c34bde24e2632d9944f" category="sidebar">SAP HANA 與 AnyDB</block>
  <block id="399bd1ee587245ecac6f39beaa99886f" category="sidebar">PostgreSQL</block>
  <block id="f4f70727dc34561dfde1a3c529b6205c" category="sidebar">設定</block>
  <block id="7d219314ccabde6609510141bb175a6c" category="sidebar">共享執行個體與專用執行個體</block>
  <block id="d5363ae19ecaede49e2ced297df7737a" category="sidebar">記憶體組態</block>
  <block id="500c09aa1bb9af431f2c18348e69bfd0" category="sidebar">tempdb 檔案</block>
  <block id="4c5d94eb4dc4bff93f6a96a08ab7b244" category="sidebar">資料安全</block>
  <block id="cf91513c6fc63cebe4b63a6647238d6d" category="sidebar">RAID</block>
  <block id="83db97189c47f7bb4edd879e8756f6e6" category="sidebar">容量限制</block>
  <block id="af81930661b267e8f1e68c4d66e9ee56" category="sidebar">容錯移轉與切換</block>
  <block id="dfd1f50170457b961c15bb13ad7e3bed" category="sidebar">資料檔案和重做區塊大小</block>
  <block id="49f83bf3a15b8626eb91fde93c6b1788" category="sidebar">Oracle RAC</block>
  <block id="13d80777c8fd43e555c1f5b1b72d7ef0" category="sidebar">主機組態</block>
  <block id="7e6bb0931a72759d39514aa924b420bc" category="sidebar">AIX</block>
  <block id="6bb83af717367dd4a47f75801ae7a2b0" category="sidebar">Linux 搭配 ASMLib 和 AFD</block>
  <block id="619615da0f93507e22a6054ef2aea4f1" category="sidebar">邏輯介面</block>
  <block id="aca8e861c6f30fe2d42d0310a387312b" category="sidebar">乙太網路組態</block>
  <block id="63a5b8bd41978e8124f9ccdfa9063e9e" category="sidebar">FC SAN 組態</block>
  <block id="c3f378ef942f6bf228a43aaacc628fea" category="sidebar">LVM 分拆</block>
  <block id="254f642527b45bc260048e30704edb39" category="sidebar">組態</block>
  <block id="f3a78e25ce9f95fc3c61ccc39f32fb4d" category="sidebar">Oracle Direct NFS（DNFS）</block>
  <block id="989cefa74de0e10a575103f446258d99" category="sidebar">NFS 會租用和鎖定</block>
  <block id="0d695ec265a3b0b5e7e32e33ffe4ed22" category="sidebar">NFS 快取</block>
  <block id="eb4d10d6eda7c9266cd36c4eb0a223cf" category="sidebar">ASM 回收公用程式</block>
  <block id="297e2ac2ec0bd88ad598062f4c07ee45" category="sidebar">分層原則</block>
  <block id="9af6f452cd88c83f2bde555de8f93690" category="sidebar">傳送資料至物件存放區</block>
  <block id="08af6d4e6b562e2d0b418d7198f5a0f7" category="sidebar">從物件存放區擷取資料</block>
  <block id="02d01636975b3ae0c0ab22368cea8d54" category="sidebar">分層策略</block>
  <block id="7fbd108e1fc6910c941094e95a677878" category="sidebar">完整檔案</block>
  <block id="eb43c2427eb06b9f561363863b4a4f0b" category="sidebar">部分檔案</block>
  <block id="1afe200fa26ba361f59b603b22ad6392" category="sidebar">選取檔案</block>
  <block id="448d15345bb99c834095da225c529b8a" category="sidebar">資料可用度</block>
  <block id="5869e10a9dea6d88d61bb10040557f35" category="sidebar">資料完整性</block>
  <block id="7b68149402c05a52968bda6af0435c8a" category="sidebar">快照型線上備份</block>
  <block id="49ba0ee205d016d8236db9c1e8c130e5" category="sidebar">儲存 Snapshot 最佳化備份</block>
  <block id="2c6d98297c340e390e0783220b038545" category="sidebar">實體架構</block>
  <block id="13a854bdd11f8f57a0b25c00631f1430" category="sidebar">邏輯架構</block>
  <block id="5e7988aeba0e1d3c15c5c78a0db738d1" category="sidebar">SyncMirror</block>
  <block id="5ba8ee2f32815884475d1f2244ba16a6" category="sidebar">故障案例</block>
  <block id="e31593850dc03f8f10d036df5dc8633b" category="sidebar">Oracle 資料庫移轉</block>
  <block id="5102abd5a9cc202678054b832caf678d" category="sidebar">程序</block>
  <block id="1495d3ed3ebff783c0f480b583372450" category="sidebar">主機資料複本</block>
  <block id="d81ca5686c955ed50927409eb8c14bb0" category="sidebar">外部 LUN 匯入</block>
  <block id="2fea59b7e470acac5ec1589d504da14e" category="sidebar">完成</block>
  <block id="e9cc85ef98d982c3c3e53d6b82293126" category="sidebar">傳輸協定轉換</block>
  <block id="fbbd0e8905df3950eca4d1d8f55881ad" category="sidebar">其他附註</block>
  <block id="ac0465a970688dc3c326dcdd8fe2805e" category="sidebar">效能最佳化與基準測試</block>
  <block id="7cb9c3cd8b9873d39a1fe87c083cd55c" category="sidebar">過時的 NFS 鎖定</block>
  <block id="c0916addb4f26afa58c5a6df4f463fa5" category="sidebar">統一化儲存設備</block>
  <block id="c0032c6bab44eeeb6886c7a4aa67cf77" category="sidebar">虛擬化工具</block>
  <block id="1c77ac70000b6804e930748d5df7be5e" category="sidebar">虛擬磁碟區和儲存原則型管理</block>
  <block id="217601d383b816e6a2548e57b5006f92" category="sidebar">複製</block>
  <block id="8f2db90dd4a6fbd95ba8f0bc54fd6b27" category="sidebar">QoS</block>
  <block id="09b4a81ec7b05cbacc7cbfa13e006254" category="sidebar">儲存原則型管理</block>
  <block id="2e8526cbe762cb1b8393d935a3b0bf16" category="sidebar">建議設定</block>
  <block id="10a764f91b59ce3c8931d55c2fd54222" category="sidebar">部署 vVols 儲存設備</block>
  <block id="30f6724a02fc69093960468c0a2fbcd4" category="sidebar">產品安全性</block>
  <block id="3390e3575b3e341afa2b7172ff5b33a7" category="sidebar">VMware vSphere的插件SnapCenter</block>
  <block id="62a004b95946bb97541afa471dcca73a" category="sidebar">MySQL</block>
  <block id="7f1a6761f7160e33a32105202e47303b" category="sidebar">容器化</block>
  <block id="bd57f4f74ca087a92a48b23d45753729" category="paragraph">ONTAP 工具 VASA 供應商負責管理 FCP 、 iSCSI 群組、以及 ONTAP 中的 NVMe 子系統、這些子系統是以受管理 ESXi 主機的探索啟動器為基礎。不過、它並未與光纖通道交換器整合以管理分區。在進行任何資源配置之前、必須根據最佳實務做法進行分區。以下是單一啟動器分區至四個 ONTAP 系統的範例：</block>
  <block id="6b14e3f4a37881185acf7a766f8f6272" category="paragraph">單一啟動器分區：</block>
  <block id="17ccf64e30cb518fd7ca87ce752ad738" category="paragraph"><block ref="17ccf64e30cb518fd7ca87ce752ad738" category="inline-image-macro-rx" type="image"></block></block>
  <block id="58b5cd2a94730c2e044c14891f1e0e87" category="paragraph">如需更多最佳實務做法、請參閱下列文件：</block>
  <block id="fc9e4d789d968936f8ff5ae5a99847e0" category="paragraph"><block ref="fc9e4d789d968936f8ff5ae5a99847e0" category="inline-link-rx"></block></block>
  <block id="d748a2834a7220eef4ec4775a51632f9" category="paragraph"><block ref="d748a2834a7220eef4ec4775a51632f9" category="inline-link-rx"></block></block>
  <block id="80dad10df0d1a031764e7c648c46aa23" category="paragraph">* 請考慮使用最大 IOPS 來控制未知虛擬機器或測試虛擬機器。 *</block>
  <block id="93e4f73afe8b787b33161ec273ca087f" category="paragraph">VASA Provider 7.1 首度提供最大 IOPS 、可將未知工作負載的 IOPS 限制在特定的 vVol 、以避免對其他更重要的工作負載造成影響。如需效能管理的詳細資訊、請參閱表 4 。</block>
  <block id="4e0d7e0587bf99c9b7a64a84fd42f6bd" category="paragraph">請參閱 NetApp 和 VMware 針對您所選傳輸協定的其他最佳實務做法指南。一般而言、除了上述變更之外、沒有其他變更。</block>
  <block id="97f87e9ab1d660463c63beb8745fd9e5" category="paragraph">* 使用 vVols over NFS v2* 的網路組態範例</block>
  <block id="c80b3cc8b5013bd4039769fb0f783e60" category="paragraph"><block ref="c80b3cc8b5013bd4039769fb0f783e60" category="inline-image-macro-rx" type="image"></block></block>
  <block id="dee28dd6d1a9ef7bf399f642fd9d588f" category="section-title">NFS 傳輸大小</block>
  <block id="d8299d00f914e35b80644e5781e47a77" category="paragraph"><block ref="d8299d00f914e35b80644e5781e47a77" category="inline-image-macro-rx" type="image"></block></block>
  <block id="5a656ddcc72bacc3a5900c23edf7a08e" category="paragraph"><block ref="5a656ddcc72bacc3a5900c23edf7a08e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="073ce0a0568adc64d52dd9b1d8c02c54" category="paragraph"><block ref="073ce0a0568adc64d52dd9b1d8c02c54" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3401a9880dfc322da8a56c4d632361f6" category="paragraph"><block ref="3401a9880dfc322da8a56c4d632361f6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="87f823f4f3b4258445d5af029afe5ad9" category="paragraph"><block ref="87f823f4f3b4258445d5af029afe5ad9" category="inline-image-macro-rx" type="image"></block></block>
  <block id="9213fe9d391179276ff6c03552486255" category="paragraph"><block ref="9213fe9d391179276ff6c03552486255" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3105b4c0642b9710179c18edcf8e8718" category="paragraph"><block ref="3105b4c0642b9710179c18edcf8e8718" category="inline-image-macro-rx" type="image"></block></block>
  <block id="1a43000eb9893bff7ab7b1ce1d3fd6a8" category="paragraph"><block ref="1a43000eb9893bff7ab7b1ce1d3fd6a8" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4b7a8562c98b8c652bdfb6aa79788222" category="paragraph"><block ref="4b7a8562c98b8c652bdfb6aa79788222" category="inline-image-macro-rx" type="image"></block></block>
  <block id="acce752526553bfa73c92799accd9cb8" category="summary">Oracle 資料保護總覽</block>
  <block id="deb8cb7644231cae002f5f37c725b86f" category="paragraph">遠距離移轉通常需要更具創意的方法、例如中所說明的記錄傳送程序 <block ref="86efe12ea0d3a769a4b7cfc2b6362f49" category="inline-link-macro-rx"></block>。遠距 IP 網路在任何接近 LAN 或 SAN 速度的地方、都很少會有頻寬。在某種情況下、 NetApp 協助 220 TB 資料庫進行遠距移轉、而且產生的歸檔記錄率非常高。所選的資料傳輸方法是每天運送磁帶、因為這種方法提供最大可能的頻寬。</block>
  <block id="055362c7082175c34483772a43b776cf" category="paragraph">例如、複製 10TB 資料庫通常需要大約七小時才能完成。如果企業需要中斷七小時、檔案複製是輕鬆安全的移轉選項。如果五小時不可接受、則只需簡單的記錄傳送程序（請參閱 <block ref="eee8a7589b6555fc3411165c58a62ca5" category="inline-link-macro-rx"></block>）只需最少的努力就能設定、將轉換時間縮短至約 15 分鐘。在此期間、資料庫管理員可以完成此程序。如果 15 分鐘是不可接受的、則可透過指令碼將最後的轉換程序自動化、將轉換時間縮短至幾分鐘。您可以隨時加快移轉速度、但這樣做的代價是時間和精力。轉換時間目標應以企業可接受的內容為基礎。</block>
  <block id="911e63244fc82405263306a64e535c69" category="paragraph">只有在中的步驟之後才應建立 zpool <block ref="e8673fdb712a2edcdf56742c7eec0045" category="inline-link-macro-rx"></block> 執行。如果程序未正確執行、可能會因為 I/O 對齊而導致嚴重的效能降低。ONTAP 的最佳效能要求 I/O 必須與磁碟機上的 4K 邊界對齊。在 zpool 上建立的檔案系統使用有效的區塊大小、並透過稱為的參數加以控制<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block>，您可以執行命令來檢視<block ref="1615297782a0dff59b20451e2ca97ea7" prefix=" " category="inline-code"></block>。</block>
  <block id="b2ca9da17ac7a0807fb313343c1ba9cb" category="list-text">已建立磁碟分割、並使用 33 磁區偏移值、而非預設的 32 。重複中所述的程序 <block ref="6ba0f94fdd8f9504e3fef5712023fb85" category="inline-link-macro-rx"></block>。直方圖顯示如下：</block>
  <block id="eb7f9a88026c895932f70c650c364132" category="list-text">增加 LUN 的大小</block>
  <block id="0f11c45e6e7377b9d10a93534d0fa2f3" category="list-text">將 LUN 新增至現有的磁碟區群組、並擴充內含的邏輯磁碟區</block>
  <block id="e4da750cce448393b2597f8f66086894" category="paragraph">啟動器群組（ igroup ）是 ONTAP LUN 遮罩架構的一部分。除非先授予主機存取權、否則無法存取新建立的 LUN 。這是透過建立一個 igroup 、列出應授予存取權的 FC WWN 或 iSCSI 啟動器名稱來完成。在撰寫本報告時、僅 FC LUN 支援 FLI 。不過、轉換為 iSCSI 後移轉是一項簡單的工作、如所示 <block ref="43085dc2a05784d4912331d1ed1db91d" category="inline-link-macro-rx"></block>。</block>
  <block id="525e71fb331412cd820122c3d51d453c" category="paragraph">這可讓 DBA 在資料刪除後回收儲存陣列上的空間。ONTAP 會攔截零並取消分配 LUN 的空間。回收程序非常快速、因為儲存系統中沒有寫入資料。</block>
  <block id="14bdf3569ec0024259b2b02c5a668eae" category="paragraph">何時<block ref="7ccc31934ae8244d8263d3c09bcee186" prefix=" " category="inline-code"></block> 啟用（預設）時、 InnoDB 會將所有資料儲存兩次：先儲存至雙寫入緩衝區、然後儲存至實際資料檔案。</block>
  <block id="394ad91b4701dbd32675896bed204755" category="sidebar">PostgreSQL 的主機組態</block>
  <block id="9852487272d9b2aa9026d0fddc0616fc" category="sidebar">PostgreSQL 的儲存組態</block>
  <block id="bc237072428e0e4c415160b898946d4c" category="sidebar">PostgreSQL 的資料保護</block>
  <block id="3423582eed75b4bd6632c18238fd78e4" category="sidebar">Microsoft SQL Server 的資料庫組態</block>
  <block id="5a4517368fb2ab5498fc2108c2ea64c5" category="sidebar">Oracle 資料庫的資料庫組態</block>
  <block id="e483c0ecf3a2b1a60f886d4a5ac553ff" category="sidebar">Oracle 資料庫的主機組態</block>
  <block id="06b078afa802a679ad4694d13a8a2495" category="sidebar">Oracle 資料庫的網路組態</block>
  <block id="f1991b28c5d48cb53798755acf9dfe62" category="sidebar">Oracle 資料庫的儲存組態</block>
  <block id="ea9cdfcbfcf1906c15b6779f0f327028" category="sidebar">MySQL 的資料庫組態</block>
  <block id="308f8f580d0248ac023557cfd4b10d83" category="sidebar">MySQL 的主機組態</block>
  <block id="830f353b3e6055499fac447b16b0c935" category="sidebar">MySQL 的儲存組態</block>
  <block id="3106f8f17f2974fe05da16fb0cc50505" category="summary">ONTAP 上具有 SAN 的 PostgreSQL 資料庫</block>
  <block id="74cacb0c34a37e2859e3b054938a344d" category="doc">具有 SAN 檔案系統的 PostgreSQL</block>
  <block id="1758f5c81d60f1a0ac8600fddc99a919" category="paragraph">具有 SAN 的 PostgreSQL 資料庫通常裝載在 xfs 檔案系統上、但如果作業系統廠商支援、也可以使用其他資料庫</block>
  <block id="d73e7b56b7baa813a32c521ca074e7c4" category="paragraph">雖然單一 LUN 通常可支援高達十萬 IOPS 、但 IO 密集的資料庫通常需要使用含分段的 LVM 。</block>
  <block id="f7cc8c4234952826818ad4d0c2050ac9" category="paragraph">PostgreSQL 資料庫可以裝載在 NFSv3 或 NFSv4 檔案系統上。最佳選項取決於資料庫以外的因素。</block>
  <block id="1482c42acc1dd31ee8496c71a805e73c" category="paragraph">例如、在某些叢集式環境中、 NFSv4 鎖定行為可能較為理想。（請參閱 <block ref="bc3a7e667477b8b3590fa1451dcb924c" category="inline-link-macro-rx"></block> 如需其他詳細資料）</block>
  <block id="9674525687765646f35916d0e569eda9" category="paragraph">否則、資料庫功能應接近相同、包括效能。唯一的要求是使用<block ref="d64a84456adc959f56de6af685d0dadd" prefix=" " category="inline-code"></block> 掛載選項。這是為了確保軟性逾時不會產生無法恢復的 IO 錯誤。</block>
  <block id="0c6430fad6c643c444b5d6d52b18edb4" category="paragraph">如果選擇 NFSv4 作為傳輸協定、 NetApp 建議使用 NFSv4.1 。NFSv4.1 中的 NFSv4 傳輸協定有一些功能性增強功能、可改善 NFSv4.0 的恢復能力。</block>
  <block id="248212b04c23627e2719e106224d2eb3" category="paragraph">針對一般資料庫工作負載、請使用下列掛載選項：</block>
  <block id="9efbdff43e91279291e95690414bec95" category="paragraph">在 ONTAP 層級增加傳輸大小後、將會使用下列掛載選項：</block>
  <block id="395201f6a339cc4cf6b345e0c259f383" category="section-title">NFSv3 TCP 插槽表</block>
  <block id="1f8260aa2c5a5b35bf771c26828d2096" category="paragraph">如果 NFSv3 與 Linux 搭配使用、則正確設定 TCP 插槽表至關重要。</block>
  <block id="92d0a1aef2134a70d5c0f0279dc22ec6" category="doc">Snapshot複本</block>
  <block id="0c47b4eb567b018e3d2e5882b88eaca9" category="paragraph">儲存快照是目標資料的時間點複本。ONTAP 的實作功能包括設定各種原則、每個磁碟區最多可儲存 1024 個快照。ONTAP 中的快照具有極高的空間效率。空間只會在原始資料集變更時使用。它們也是唯讀的。快照可以刪除、但無法變更。</block>
  <block id="7986a4827296ca9cd0b991ded9f8a10d" category="paragraph">在某些情況下、可以直接在 ONTAP 上排程快照。在其他情況下、在建立快照之前、可能需要 SnapCenter 等軟體來協調應用程式或作業系統的作業。無論哪種方法最適合您的工作負載、積極的快照策略都能透過頻繁且容易存取的方式、來提供資料安全性、從開機 LUN 到關鍵任務資料庫、都能備份所有資料。</block>
  <block id="c4bf0f56feeec9a45e973768fbc4f47e" category="section-title">防竄改快照</block>
  <block id="38fef959179f8d3eb79a68a5ce747bdc" category="paragraph">如此可確保入侵者、惡意內部人員、甚至勒索軟體攻擊都無法入侵備份、即使備份導致存取 ONTAP 系統本身也是如此。如果結合頻繁的快照排程、就能以極低的 RPO 提供極強大的資料保護功能。</block>
  <block id="a1f41e52e9ddbd9f87ecd032c237b1c0" category="section-title">SnapMirror 複寫</block>
  <block id="18d315ae923785b3f9c5234724b0ab42" category="paragraph">第二個系統也會開啟新的管理安全選項。例如、某些 NetApp 客戶會將主要和次要儲存系統的驗證認證資料加以分隔。沒有單一管理使用者可以存取這兩個系統、這表示惡意系統管理員無法刪除所有資料複本。</block>
  <block id="500569e3cc0764260a592cb176921ca3" category="section-title">儲存虛擬機器</block>
  <block id="597cb258dd509add7cd999794c60d430" category="paragraph">例如、您可以為關鍵的正式作業工作負載設定一個 SVM 、並在不同的網路區段上設定第二個 SVM 以進行開發活動。然後、您可以限制特定管理員存取正式作業 SVM 、同時讓開發人員更廣泛地控制開發 SVM 中的儲存資源。您可能也需要為財務和人力資源團隊提供第三個 SVM 、以儲存特別重要的純眼資料。</block>
  <block id="7d0fc71fe28e011ca49b06214469d484" category="section-title">管理 RBAC</block>
  <block id="4f0dae2ba2fd11c533349d6ade4f81de" category="paragraph">ONTAP 提供強大的角色型存取控制（ RBAC ）功能、可用於管理登入。某些管理員可能需要完整的叢集存取權、而其他管理員可能只需要存取特定的 SVM 。進階服務台人員可能需要增加磁碟區大小的能力。因此、您可以授予系統管理使用者執行工作職責所需的存取權限、而無需再提供其他權限。此外、您可以使用來自不同廠商的 PKI 來保護這些登入安全、僅限制對 ssh 金鑰的存取、並強制執行失敗的登入嘗試鎖定。</block>
  <block id="852741d2a7fb0a8a1a5dd748dbbd6734" category="section-title">API RBAC</block>
  <block id="bbbea5fec67f15424fa77aa563754c49" category="paragraph">自動化需要 API 呼叫、但並非所有工具都需要完整的管理存取權。為了協助保護自動化系統的安全、 API 層級也提供 RBAC 。您可以將自動化使用者帳戶限制為所需的 API 呼叫。例如、監控軟體不需要變更存取權、只需要讀取存取權。配置儲存設備的工作流程不需要刪除儲存設備的能力。</block>
  <block id="7604bad489eaec7e27d112c63d3e2936" category="paragraph">若要進一步進行多重「因素」驗證、需要兩位不同的管理員（每位管理員都有自己的認證）來核准某些活動。這包括變更登入權限、執行診斷命令和刪除資料。</block>
  <block id="b39c0496b44447232912303246b46aaa" category="paragraph">如果需要大量連續 IO 、則可依照下節所述增加 NFS 傳輸大小。</block>
  <block id="959e8f746f4ff03f6225b95cf646e65f" category="admonition">本文件取代先前發佈的技術報告 _TR-4590 ： Microsoft SQL Server 與 ONTAP 的最佳實務做法指南</block>
  <block id="aa131b86ebd9f719bab1aba612ae3c3f" category="list-text">當恢復計畫中的資料存放區數量和保護群組數量減至最少時、 SRM 會發揮最佳效能。因此、您應該考慮在受 SRM 保護的環境中最佳化虛擬機器密度、以因應 RTO 至關重要的環境。</block>
  <block id="afab42482b97a8b43c62320c373ded74" category="list-text">使用 Distributed Resource Scheduler （ DRS ）協助平衡受保護和恢復 ESXi 叢集的負載。請記住、如果您計畫進行容錯回復、當您執行重新保護之前受保護的叢集時、就會成為新的恢復叢集。DRS 有助於平衡兩個方向的放置。</block>
  <block id="8ed6c5d9143eeb92cf75bb8a08bb7819" category="list-text">儘可能避免將 IP 自訂功能與 SRM 搭配使用、因為這樣可能會增加 RTO 。</block>
  <block id="e2e7245b1b3cf4a13a6b703ead49ebee" category="paragraph">系統會為每個陣列配對建立陣列管理程式。有了SRM和ONTAP VMware等工具、每個陣列配對都是以SVM的範圍來完成、即使您使用叢集認證資料也是如此。這可讓您根據指派給租戶的SVM進行管理、在租戶之間分割DR工作流程。您可以為指定的叢集建立多個陣列管理員、而且這些管理員可以是非對稱的。您可以在不同ONTAP 的叢集之間進行扇出或扇入。例如、您可以將叢集1上的SVMA和SVM-B複製到叢集2上的SVM-C、叢集3上的SVM-D、或反之。</block>
  <block id="4da3f855cd505741909cfd49d743e68e" category="paragraph">SRM也可讓您在VM恢復時變更其網路組態。此重新設定包括 IP 位址、閘道位址和 DNS 伺服器設定等設定。不同的網路設定會在個別 VM 恢復時套用到它們、您可以在恢復計畫中的 VM 內容設定中指定。</block>
  <block id="e409450ce49f3558b068c69a77a9623a" category="paragraph">在容錯回復之後、您應該向所有相關人員確認他們的服務已恢復正常、然後再重新執行「重新保護」、</block>
  <block id="a42cf9beb4788dddb7d317e05cc08e23" category="sidebar">資料庫檔案和檔案群組</block>
  <block id="8858bb6564a2efc189c9183c495ce545" category="sidebar">LUN 對齊</block>
  <block id="02bc4ad8a694d41c8b598dfbcb12f069" category="sidebar">LUN 數量和 LUN 大小</block>
  <block id="066f208a93617bd82090d42624ce63cc" category="sidebar">LUN 調整大小</block>
  <block id="9eeba6fd02cf3b6d8aee35e0ce9bf8fe" category="sidebar">LVM 分拆</block>
  <block id="183bdb28f19bee640319f68825827aea" category="sidebar">RPO 、 RTO 和 SLA</block>
  <block id="2172b5d51273924b537842b0db78bfd4" category="sidebar">備份與還原基礎知識</block>
  <block id="3403aac944f3cb6e2d2c7f7d52bc44b9" category="paragraph">隨著資料呈指數成長、企業的資料管理變得更加複雜。這種複雜性會增加授權、營運、支援和維護成本。若要降低整體 TCO 、請考慮使用可靠、高效能的後端儲存設備、從商業資料庫切換為開放原始碼資料庫。</block>
  <block id="dcac08882e3396bd30210108baa1641d" category="paragraph">ONTAP 是理想的平台、因為 ONTAP 是專為資料庫所設計。為了滿足資料庫工作負載的需求、我們特別建立了許多功能、例如隨機 IO 延遲最佳化、以提供進階服務品質（ QoS ）到基本 FlexClone 功能。</block>
  <block id="1429a98a71e16287326edd7fc1f999fd" category="paragraph">其他功能（例如不中斷升級）（包括儲存設備更換）、可確保關鍵資料庫仍可使用。您也可以透過 MetroCluster 為大型環境進行即時災難恢復、或是使用 SnapMirror 主動式同步來選擇資料庫。</block>
  <block id="8df3fb35ff15e02683bfb1bc7f852c93" category="paragraph">最重要的是、 ONTAP 提供無與倫比的效能、並能根據您的獨特需求調整解決方案的規模。我們的高階系統可提供超過 1M IOPS 、延遲時間以微秒為測量單位、但如果您只需要 10 萬次 IOPS 、您可以使用仍執行相同儲存作業系統的較小控制器來調整儲存解決方案的大小。</block>
  <block id="97b4cda00dd31f5be69440f48c4da149" category="summary">ONTAP 的 PostgreSQL 資料庫組態</block>
  <block id="c4f52498c0db572381512887d7584e53" category="summary">PostgreSQL 資料庫和儲存快照</block>
  <block id="b0792163c858a7c221b236d84619b5ef" category="summary">PostgreSQL 使用 ONTAP 來資料庫 NFS</block>
  <block id="189950ed46e5e8b7e92941531a5bb88b" category="doc">具有 NFS 檔案系統的 PostgreSQL 資料庫</block>
  <block id="6cabd4dcf3582d38c441228705da3bda" category="doc">PostgreSQL 資料保護</block>
  <block id="383a6a5241ecfc558b9fec1d7cff5239" category="summary">PostgreSQL 表格空間</block>
  <block id="20d0e2519b3555a0a2927c8914c17280" category="summary">PostgreSQL 資料保護軟體</block>
  <block id="29e2aec511a8e307ecceacbd86c22f14" category="summary">PostgreSQL 初始化參數</block>
  <block id="035ecd1be6cacde993302b440e396bc2" category="paragraph">大多數資料庫客戶現在都選擇 All Flash Array 、這會造成一些額外考量。例如、請考慮在雙節點 AFF A900 系統上進行效能測試：</block>
  <block id="33f545d041b93838074263c0efd2e9da" category="list-text">有了 80/20 讀取 / 寫入比率、兩個 A900 節點可在延遲甚至超過 150 μ s 標記之前、提供超過 1M 的隨機資料庫 IOPS 。這遠遠超出了大多數資料庫目前的效能需求、很難預測預期的改善。儲存設備將會大幅清除、成為瓶頸。</block>
  <block id="0445195555faac96ebff962dbff126ea" category="summary">MySQL 組態參數</block>
  <block id="c0b7708ffcd66fd65a9d2a4801091563" category="paragraph">NetApp 建議使用一些重要的 MySQL 組態參數、以獲得最佳效能。</block>
  <block id="10eb8b7e75da1815860da31490513841" category="summary">使用 NFS 的 MySQL</block>
  <block id="5249e05857621fbfae51371a73006c44" category="summary">MySQL 和 NFSv3 插槽表</block>
  <block id="d058f95e3a8d4b7b46802139d6b95982" category="paragraph">Linux 上的 NFSv3 效能取決於所呼叫的參數<block ref="453f2cc2326f82af1053f4aa4b75400b" prefix=" " category="inline-code"></block>。</block>
  <block id="bf2bdc980948fb9084a63963398846b2" category="paragraph">ONTAP 是適用於 MySQL 資料庫的理想平台、因為 ONTAP 確實是專為資料庫所設計。為了滿足資料庫工作負載的需求、我們特別建立了許多功能、例如隨機 IO 延遲最佳化、以提供進階服務品質（ QoS ）到基本 FlexClone 功能。</block>
  <block id="1b3804b7e2292e18f5e66d54f7a9fafc" category="paragraph">最重要的是、 ONTAP 提供無與倫比的效能、並能根據您的獨特需求調整解決方案的規模。我們的高階系統可提供超過 1M IOPS 、延遲時間以微秒為測量單位、但如果您只需要 10 萬次 IOPS 、您可以使用更小的控制器來調整儲存解決方案的大小、而該控制器仍可執行完全相同的儲存作業系統。</block>
  <block id="1339877637a3f7f59745a00e04f304fd" category="summary">MySQL 和 InnoDB_log_file_size</block>
  <block id="c1c4e722764621d56a075e42ce48d0c0" category="summary">MySQL 和 InnoDB_緩 衝區 Pool 大小</block>
  <block id="ae14ab6d1e5edd0e782d8897d1721eb4" category="summary">MySQL 和 InnoDB_doublewrite</block>
  <block id="689c52e3f5db5d2dafccd7d93cf1abc4" category="summary">MySQL 和 InnoDB_Fling_log_AT_TRx_commi</block>
  <block id="639600080c225673dfdfa012fdbd6146" category="summary">MySQL 和 IO 排程器</block>
  <block id="72985ac51e91797345b2437088a4362e" category="summary">MySQL 搭配 SAN</block>
  <block id="d5ef0a45fe252b03f538bfd134b168db" category="summary">MySQL 和 InnoDB_LRU_SCAN_depth</block>
  <block id="df657260453f6ef228ee0ca22dd7a415" category="summary">MySQL 容器化</block>
  <block id="2828450fc6669c8df75f937e227996f1" category="doc">MySQL 檔案描述元</block>
  <block id="9420010a756fb6d3ddeadfa63d2170f6" category="paragraph">若要執行、 MySQL 伺服器需要檔案描述元、而且預設值不足。</block>
  <block id="62414a5a9c0e2fc12a8d028ad29164b8" category="summary">MySQL 和 InnoDB_IO_capACure</block>
  <block id="6219c45bc8c26437c0b7e1a69d4cbe58" category="summary">MySQL 和 InnoDB_Flush 方法</block>
  <block id="35d1a5d7b12999ec27f5233dccba043f" category="summary">MySQL 和 open_file_limits</block>
  <block id="c031febc35017c70bf3b526723756b2a" category="doc">iSCSI 和 NVMe / TCP</block>
  <block id="4da35d461815e71b97bda03476e89b7b" category="paragraph">使用 iSCSI 或 NVMe / TCP 的主機可以直接連線至儲存系統、並正常運作。原因是路徑。直接連線至兩個不同的儲存控制器、會產生兩個不同的資料流路徑。遺失路徑、連接埠或控制器並不會妨礙其他路徑的使用。</block>
  <block id="40715d81cea527f13cdf470773fc3a65" category="paragraph">可以使用直接連線的 NFS 儲存設備、但有很大的限制：如果沒有大量的指令碼工作、容錯移轉將無法運作、這是客戶的責任。</block>
  <block id="d0b13bfd23c05f64222869de30f81000" category="paragraph">直接連線的 NFS 儲存設備會造成不中斷的容錯移轉複雜化、這是因為本機作業系統上會發生路由。例如、假設主機的 IP 位址為 192.168.1.1/24 、並直接連線至 IP 位址為 192.168.1.50/24 的 ONTAP 控制器。在容錯移轉期間、該位址 192.168.1.50 可以容錯移轉至其他控制器、而且主機可以使用該位址、但主機如何偵測其存在？原來的 192.168.1.1 位址仍然存在於不再連線至作業系統的主機 NIC 上。目的地為 192.168.1.5 的流量將繼續傳送至無法運作的網路連接埠。</block>
  <block id="288a0a5ebbc70fb3b968ec58d36d71ab" category="paragraph">第二個 OS NIC 可設定為 19 可以與故障的 over 192.168.1.50 位址進行通訊、但本機路由表預設會使用一個 * 且只有一個 * 位址來與 192.168.1.0/24 子網路通訊。系統管理員可以建立指令碼架構、以偵測失敗的網路連線、並變更本機路由表或使介面正常運作。具體程序取決於所使用的作業系統。</block>
  <block id="d6ce8522932df7ae76aa0b963ad9ef7d" category="paragraph">實際上、 NetApp 客戶確實有直接連線的 NFS 、但通常僅適用於容錯移轉期間 IO 暫停的工作負載。使用硬掛載時、在這類暫停期間不應有任何 IO 錯誤。IO 應該會暫停運作、直到服務還原為止、無論是透過容錯回復或手動介入、在主機上的 NIC 之間移動 IP 位址。</block>
  <block id="3436a7073ac9f4071820b6720a7789fc" category="section-title">FC Direct Connect</block>
  <block id="b7981516813a09695906aa429b07f48f" category="paragraph">無法使用 FC 傳輸協定將主機直接連接至 ONTAP 儲存系統。原因是使用 NPIV 。用於識別 FC 網路的 ONTAP FC 連接埠的 WWN 使用稱為 NPIV 的虛擬化類型。任何連接至 ONTAP 系統的裝置都必須能夠辨識 NPIV WWN 。目前沒有任何 HBA 廠商提供可安裝在能夠支援 NPIV 目標的主機上的 HBA 。</block>
  <block id="97db606ac6781989ea3b189d7be28bf2" category="inline-link-macro">直接連線網路</block>
  <block id="e817ecc2f82a2b78d828ec8704031da3" category="section-title">直接連線網路</block>
  <block id="d078ae9a339971900f939db9e82f253d" category="paragraph">儲存管理員有時偏好從組態中移除網路交換器、以簡化其基礎架構。在某些情況下可能會支援這項功能。</block>
  <block id="87e6f97c8ec2f31df616ef84401ffaf4" category="paragraph">有幾種疑難排解資源可提供額外資訊。</block>
  <block id="52d04863ac62a6fa67e1b49a31086928" category="paragraph">以下各節概述 VMware SRM 和 ONTAP 儲存設備的最佳作業實務做法。</block>
  <block id="f24ef4a42850a2b3e3d77e610ae46fee" category="doc">計畫性和非計畫性事件的恢復能力</block>
  <block id="4bce11924453ef2ee7e40109f79dc66d" category="paragraph">NetApp MetroCluster 和 SnapMirror 主動同步是強大的工具、可增強 NetApp 硬體和 ONTAP ® 軟體的高可用度和不中斷營運。</block>
  <block id="d267775072875ddbb24c16a41c22d8a2" category="paragraph">MetroCluster 和 SnapMirror 主動式同步提供三種基本方法、可在發生計畫性或非計畫性事件時維持資料連續性：</block>
  <block id="1d3027d09fc1db3087f05f2163af2cb7" category="list-text">備援元件、可防止單一元件故障</block>
  <block id="f3b83f3b77289efe3b53cf537b7b77f5" category="list-text">本機 HA 接管、用於影響單一控制器的事件</block>
  <block id="b6ed0cba165f6f9664dc1e57ac3419ec" category="list-text">完整的站台保護：將儲存設備和用戶端存取從來源叢集移至目的地叢集、以快速恢復服務</block>
  <block id="16afcbe8821dfa582521cd62c1ec130d" category="paragraph">這表示在單一元件故障時、作業會順暢地繼續、並在更換故障元件時自動恢復至備援作業。</block>
  <block id="8fab78e8b214cad43d962b802bf568f8" category="paragraph">除了單節點叢集（例如 ONTAP Select 等軟體定義版本）之外、所有 ONTAP 叢集都具有稱為接管和恢復的內建 HA 功能。叢集中的每個控制器都會與另一個控制器配對、形成 HA 配對。這些配對可確保每個節點都在本機上連線至儲存設備。</block>
  <block id="83e1749664841043ce8b1e894769a201" category="paragraph">接管是一種自動化程序、其中一個節點會接管另一個節點的儲存設備、以維護資料服務。GiveBack 是還原正常作業的反向程序。可以規劃接管、例如執行硬體維護或 ONTAP 升級、或是因節點緊急或硬體故障而非計畫性地進行。</block>
  <block id="0b0403a9258293da1f6a5fc84d24a18e" category="inline-link">HA配對管理總覽</block>
  <block id="cf654073ce9eb8f38d3f05292ed83cc5" category="paragraph">當某個站台離線、或是作為整個站台維護的計畫活動時、就會使用 MetroCluster 進行站台切換。其餘站台則假設擁有離線叢集的儲存資源（磁碟和集合體）、而故障站台上的 SVM 則會在災難站台上線並重新啟動、保留其完整身分以供用戶端和主機存取。</block>
  <block id="823bd5c6c005e340599d915e134d851c" category="summary">VMware vSphere 解決方案概觀</block>
  <block id="be26d39d86de44047c65c1fed157d529" category="paragraph">vCenter Server Appliance （ VCSA ）是強大的集中式管理系統、也是 vSphere 的單一窗口、可讓管理員有效操作 ESXi 叢集。它有助於執行重要功能、例如 VM 資源配置、 VMotion 作業、高可用度（ HA ）、分散式資源排程器（ DRS ）、 Tanzu Kubernetes Grid 等。它是 VMware 雲端環境中的重要元件、設計時應考慮到服務可用度。</block>
  <block id="8ba8694e23f6560a60d85c4de549122b" category="section-title">vSphere 高可用度</block>
  <block id="01036edb3159652090a3f7149fe1ce2f" category="paragraph">vSphere HA 叢集可從故障伺服器還原 VM 。</block>
  <block id="15496c3917565cea1f21bbc7e6eba996" category="image-alt">VMSC 圖表</block>
  <block id="dcff37ab37f2cb6a72aeb3c30e3ed5aa" category="section-title">主機故障偵測</block>
  <block id="7069d861b63dd4095cfb7b2ee30587f5" category="paragraph">建立 HA 叢集之後、叢集中的所有主機都會參與選舉、其中一部主機即成為主主機。每個從屬設備都會對主主機執行網路活動訊號、而主設備則會在所有從屬主機上執行網路活動訊號。vSphere HA 叢集的主要主機負責偵測從屬主機的故障。</block>
  <block id="73b629afd8ef39d8d0147696412538c8" category="paragraph">視偵測到的故障類型而定、在主機上執行的虛擬機器可能需要容錯移轉。</block>
  <block id="e12cf4015a45ff29f1f84ae1a3ee0390" category="paragraph">在 vSphere HA 叢集中、偵測到三種類型的主機故障：</block>
  <block id="4eac346eb6cdd3a1a98ee9bc71ebccaa" category="list-text">故障：主機停止運作。</block>
  <block id="3875a4c584a7715edf4a221ce53d45fc" category="list-text">隔離：主機會變成網路隔離。</block>
  <block id="82fba11358d642111efbcf36273159f2" category="list-text">分割區 - 主機失去與主主機的網路連線。</block>
  <block id="5f72ceebd161159fe623ff01ac0cf1b4" category="paragraph">主主機會監控叢集中的從屬主機。這種通訊是透過每秒交換網路訊號來完成。當主主機停止從從屬主機接收這些心跳時、它會在宣告主機故障之前先檢查主機的活動性。主要主機執行的活性檢查是判斷從屬主機是否與其中一個資料存放區交換活動訊號。此外、主主機會檢查主機是否回應傳送至其管理 IP 位址的 ICMP Ping 、以偵測其是否只是與主節點隔離、或完全與網路隔離。它會透過 ping 預設閘道來執行此作業。您可以手動指定一或多個隔離位址、以增強隔離驗證的可靠性。</block>
  <block id="5546466ab10e5cbfbc4b286cd60b8b4a" category="section-title">最佳實務做法 _</block>
  <block id="0456a7ce7bf92fb68980571fdd2defa1" category="paragraph">NetApp 建議指定至少兩個額外的隔離位址、而且每個位址都是站台本機位址。這將提高隔離驗證的可靠性。</block>
  <block id="19c262cd1e1bb07c491e359333f04a29" category="section-title">主機隔離回應</block>
  <block id="620b4ae663a26c98656d1c81bec1a6c2" category="paragraph">在 HA 起始隔離回應之前、會先檢查 vSphere HA 主要代理程式是否擁有包含 VM 組態檔案的資料存放區。如果沒有、則主機不會觸發隔離回應、因為沒有主節點可重新啟動 VM 。主機會定期檢查資料存放區狀態、以判斷是否由擁有主角色的 vSphere HA 代理程式宣告。</block>
  <block id="6bd7b146f345eefac88b336a89aa3754" category="paragraph">如果主機與 vSphere HA 主主機隔離或分割、而主主機無法透過心跳資料存放區或 ping 進行通訊、就可能發生分割腦部狀況。主機會宣告隔離的主機當機、並在叢集中的其他主機上重新啟動 VM 。現在存在分割腦狀況、因為有兩個執行中的虛擬機器執行個體、只有其中一個執行個體可以讀取或寫入虛擬磁碟。現在可以透過設定 VM 元件保護（ VMCP ）來避免發生大腦分裂的情況。</block>
  <block id="df05a421ed8ba49f97f18dc085495ee4" category="section-title">VM 元件保護（ VMCP ）</block>
  <block id="1418d127ee81cc7f3e114029e9ba6856" category="paragraph">與 HA 相關的 vSphere 6 功能增強功能之一是 VMCP 。VMCP 針對區塊（ FC 、 iSCSI 、 FCoE ）和檔案儲存（ NFS ）、提供增強的保護、防止所有路徑中斷（ APD ）和永久裝置遺失（ PDL ）情況。</block>
  <block id="fc35e15d00ef5b037a1a56c77ef3e17c" category="section-title">永久裝置遺失（ PDL ）</block>
  <block id="967b20f28092443585be2b9649d0ba93" category="paragraph">當儲存設備永久故障或被管理性移除、且不預期返回時、會發生 PDL 狀況。NetApp 儲存陣列會向 ESXi 發出 SCSI Sense 程式碼、聲明該裝置已永久遺失。在 vSphere HA 的「故障條件和 VM 回應」區段中、您可以設定在偵測到 PDL 條件後應回應的內容。</block>
  <block id="6d623de2ea8c5007def6f2349d9ad8b9" category="section-title">所有下行路徑（ APD ）</block>
  <block id="15d2d9b1f25022e7080482582e155265" category="paragraph">當主機無法存取儲存裝置、且沒有通往陣列的路徑可用時、便會發生 APD 狀況。ESXi 認為這是裝置的暫時性問題、因此預期裝置會再次出現。</block>
  <block id="f89caca297ba86d190d90ef30c409ccf" category="paragraph">偵測到 APD 狀況時、會啟動定時器。140 秒後、 APD 條件會正式宣告、且裝置會標示為 APD 逾時。140 秒過後、 HA 會開始計算 VM 容錯移轉 APD 延遲中指定的分鐘數。指定時間過後、 HA 會重新啟動受影響的虛擬機器。您可以設定 VMCP 在需要時以不同的方式回應（停用、問題事件、或關機和重新啟動 VM ）。</block>
  <block id="76d29c3c5f57a16a7f080459356c3793" category="paragraph">保守是指 HA 能夠重新啟動 VM 的可能性。如果設為保守、 HA 只會重新啟動受 APD 影響的 VM 、前提是它知道其他主機可以重新啟動。在積極的情況下、 HA 會嘗試重新啟動 VM 、即使它不知道其他主機的狀態。如果沒有可存取其所在資料存放區的主機、這可能導致 VM 無法重新啟動。</block>
  <block id="580bc3953adcf3e3a20c5497f67f8b2c" category="paragraph">NetApp 建議將 APD 逾時後的 APD 恢復回應設定為停用。</block>
  <block id="a067a9a0e98c97f62fba4698bde30edc" category="section-title">適用於 NetApp MetroCluster 的 VMware DRS 實作</block>
  <block id="b9e04f46a88c8139fbb91780a2ff9064" category="paragraph">如果您為叢集建立 DRS 關聯性規則、您可以指定 vSphere 如何在虛擬機器容錯移轉期間套用該規則。</block>
  <block id="f903d43a0acb7412db93e8201ab12be3" category="paragraph">您可以指定 vSphere HA 容錯移轉行為的規則有兩種類型：</block>
  <block id="a96c8bab3a450bb828e3093d16f7e32c" category="list-text">VM 反關聯性規則會強制指定的虛擬機器在容錯移轉動作期間保持分離。</block>
  <block id="1fa3a04279011cbc6001c96c0f6f27fb" category="list-text">VM 主機關聯性規則會在容錯移轉動作期間、將指定的虛擬機器放置在特定主機或已定義主機群組的成員上。</block>
  <block id="225e3f7204b6e5bf6cd388af7bb16eb4" category="paragraph">使用 VMware DRS 中的 VM 主機關聯性規則、可以在站台 A 和站台 B 之間有邏輯分隔、以便 VM 在主機上執行、而該主機與陣列是設定為指定資料存放區的主要讀取 / 寫入控制器。此外、 VM 主機關聯性規則可讓虛擬機器保持儲存設備的本機狀態、進而在站台之間發生網路故障時確定虛擬機器連線。</block>
  <block id="db03e2255e35df6fa9719c800850c397" category="paragraph">以下是 VM 主機群組和關聯規則的範例。</block>
  <block id="b3c45603f3738ac1e1f8e1e87569c00c" category="section-title">使用 NetApp MetroCluster 實作 VMware Storage DRS</block>
  <block id="4669dbcf4d42583b3fae1c79fa228078" category="paragraph">依預設、啟用 Storage DRS 的 DRS 叢集會啟用儲存 I/O 控制。儲存 I/O 控制功能可讓管理員控制 I/O 壅塞期間分配給虛擬機器的儲存 I/O 數量、讓更重要的虛擬機器能夠優先選擇較不重要的虛擬機器來分配 I/O 資源。</block>
  <block id="f06483bf36a941eebbb2f78a89b6bf68" category="paragraph">Storage DRS 使用 Storage VMotion 將虛擬機器移轉至資料存放區叢集中的不同資料存放區。在 NetApp MetroCluster 環境中、必須在該站台的資料存放區內控制虛擬機器移轉。例如、在站台 A 的主機上執行的虛擬機器 A 、最好能在站台 A 的 SVM 資料存放區內移轉如果無法這麼做、虛擬機器將繼續運作、但效能降低、因為虛擬磁碟讀取 / 寫入將透過站台間連結來自站台 B 。</block>
  <block id="2438f6a80b933cf058ad052d26ac0703" category="paragraph">複製儲存物件可讓您快速建立複本以供進一步使用、例如配置額外的VM、備份/還原作業等。</block>
  <block id="1a795345e422d7dbcca8fe38671a9371" category="summary">VMSC 設計與實作準則。</block>
  <block id="b73deaadc37ea1c7a13ad17af6730c42" category="doc">VMSC 設計與實作準則</block>
  <block id="3512760e2d3fc1a9dd2116e83bb0cada" category="paragraph">本文件概述 VMSC 搭配 ONTAP 儲存系統的設計與實作準則。</block>
  <block id="556669df5b5073ab3d2ddcf638e942d9" category="section-title">NetApp 儲存組態</block>
  <block id="7f4d4fbe08a8a895671d05c4a82b0c85" category="inline-link">資訊文件MetroCluster</block>
  <block id="002eb41870df47521a2b59424d251f60" category="inline-link">SnapMirror營運不中斷總覽</block>
  <block id="447566f62201eb825a1f6fb7a570873f" category="paragraph">設定 MetroCluster 之後、管理就像管理傳統的 ONTAP 環境一樣。您可以使用命令列介面（ CLI ）、系統管理員或 Ansible 等各種工具來設定儲存虛擬機器（ SVM ）。設定 SVM 後、在叢集上建立邏輯介面（生命體）、磁碟區和邏輯單元編號（ LUN ）、以用於正常作業。這些物件將會使用叢集對等網路自動複寫到其他叢集。</block>
  <block id="b5486be95ed9ae2e4681a39cf8fe8041" category="inline-link">一致性群組總覽</block>
  <block id="57166da54d8751e1ed084f00b3f169e3" category="section-title">建立 vSphere HA 叢集</block>
  <block id="829006223e7bdcfd478d2261f1d5ac40" category="inline-link">如何在 docs.vmware.com 上的 vSphere Client 中建立和設定叢集</block>
  <block id="2bbae4763835d2e2dd123c1b4b0ae73d" category="paragraph">建立 vSphere HA 叢集是一個多步驟程序、完整記錄於<block ref="dd51ccd863dd3c9fbca770681f8e68a9" category="inline-link-rx"></block>。簡言之、您必須先建立空叢集、然後使用 vCenter 新增主機、並指定叢集的 vSphere HA 和其他設定。</block>
  <block id="d50e63b9f70efedde8dc093be8ec12b2" category="inline-link">VMware vSphere Metro儲存叢集建議實務做法</block>
  <block id="950954623b197b80e3ebb95b0adcc3de" category="paragraph">若要設定 HA 叢集、請完成下列步驟：</block>
  <block id="1073102bd8c6cbd17340f2a19043583f" category="list-text">連線至 vCenter UI 。</block>
  <block id="ebf69ea3a3e34739bde13d589e85ef10" category="list-text">在主機和叢集中、瀏覽至您要建立 HA 叢集的資料中心。</block>
  <block id="d8fd85bbc0cd4746e5d80e291696b86c" category="list-text">以滑鼠右鍵按一下資料中心物件、然後選取新叢集。在基礎知識之下、確保您已啟用 vSphere DRS 和 vSphere HA 。完成精靈。</block>
  <block id="f2c634ca704e26f96be1723db6dda32a" category="image-alt">自動產生電腦說明的螢幕擷取畫面</block>
  <block id="f4f59bf1e324854573172ca2b5070d45" category="list-text">選取叢集、然後移至「組態」標籤。選取 vSphere HA 、然後按一下編輯。</block>
  <block id="329c69e52a7de6215aa4dbfa19940f2d" category="list-text">在 [ 主機監控 ] 下，選取 [ 啟用主機監控 ] 選項。</block>
  <block id="9fc231ac455a53f2fabc59f29ab537ad" category="list-text">在「故障與回應」標籤上、於「 VM 監控」下、選取「僅限 VM 監控」選項或「 VM 與應用程式監控」選項。</block>
  <block id="58aea8c81a7e8b8160584574af309fbb" category="list-text">在 [ 許可控制 ] 下，將 HA 接入控制選項設定為叢集資源保留；使用 50% 的 CPU/ MEM 。</block>
  <block id="3f059eee365aa5c64c0be1d6dba81d69" category="list-text">選取 DRS 、然後按一下編輯。</block>
  <block id="7b5f9be03fd1421a9da56c2c7677ad69" category="list-text">除非應用程式要求、否則請將自動化層級設為手動。</block>
  <block id="a8ee10582e28e3623629963a88ff5ec9" category="image-alt">VMSC 3 5.</block>
  <block id="256164bb48582e5267e408f2e67e1939" category="inline-link">docs.vmware.com</block>
  <block id="91fb89f03b846483f7108d3f1bfb0156" category="list-text">啟用 VM 元件保護、請參閱<block ref="fc88c93ad20ad804a211f4e6fea63e56" category="inline-link-rx"></block>。</block>
  <block id="d64ed3e9c10229648e069f56e32f4c8e" category="cell">回應</block>
  <block id="f3c1d0e4118d5d9501e1a7aeed19d224" category="cell">主機故障</block>
  <block id="45d583cd5692c76d45e96536edce2a0e" category="cell">重新啟動 VM</block>
  <block id="1c3a7ae924920b573baede481becd22f" category="cell">主機隔離</block>
  <block id="2e011e74abc75a2823c627b7ee9e22a7" category="cell">永久裝置遺失（ PDL ）的資料存放區</block>
  <block id="49476a1ad365d5f8deb36464de7fe33b" category="cell">關閉並重新啟動 VM</block>
  <block id="e7bbd35db169028c75e7c8ae655bf6ae" category="cell">All Paths Down （ APD ）資料存放區</block>
  <block id="e7480b00a5e3efd904a08ca88804de45" category="cell">客人不會心碎</block>
  <block id="e8896c595f3effde37ef29d7c6233703" category="cell">重設 VM</block>
  <block id="59695df3d45a3a21b8ff0bf57fda6a2b" category="cell">VM 重新啟動原則</block>
  <block id="a150f56b87fd99bf9bf019f8447ba68b" category="cell">由虛擬機器的重要性決定</block>
  <block id="370a480458a8c63a838940f1241e14ee" category="cell">主機隔離的回應</block>
  <block id="11f30f9be08cd4f9e500290222ddc552" category="cell">關閉並重新啟動 VM</block>
  <block id="fb53fafa45c0de9bd41d368c7455c9f1" category="cell">使用 PDL 的資料存放區回應</block>
  <block id="d7c3b9f5568eb60f08076b29490afcaf" category="cell">對具有 APD 的資料存放區的回應</block>
  <block id="423b2d98eae113ae3391aa0b12f11935" category="cell">關閉並重新啟動 VM （保守）</block>
  <block id="132bbe6dbceb01227dba5ab04db7202b" category="cell">APD 的 VM 容錯移轉延遲</block>
  <block id="8d15ed7d27d83ed6229a66b1f44b7696" category="cell">3 分鐘</block>
  <block id="8c7b0644547f0ee3fe537e8ba441566d" category="cell">APD 逾時的 APD 恢復回應</block>
  <block id="4dea08318b2824f845e9b889a6e17778" category="cell">VM 監控靈敏度</block>
  <block id="f535a28adc173e28610c129d0dc578ae" category="cell">預設為高</block>
  <block id="83164803a765d1ea1f10d50dfdd26130" category="section-title">設定資料存放區以進行心跳</block>
  <block id="22c81b09ec3086b2dce8f68867a221e0" category="paragraph">當管理網路故障時、 vSphere HA 會使用資料存放區來監控主機和虛擬機器。您可以設定 vCenter 如何選取心跳資料存放區。若要設定資料存放區以進行心跳、請完成下列步驟：</block>
  <block id="64809e5386c9dc53f894f772f27d1b44" category="list-text">在資料存放區心跳區段中、從指定清單中選取使用資料存放區、並在需要時自動補充資料。</block>
  <block id="fc66ba7317ceb4220dc88aa267db085d" category="list-text">選取您要 vCenter 從兩個站台使用的資料存放區、然後按下 OK 。</block>
  <block id="1d2b14769d080b9214d9e407dfc92a64" category="section-title">設定進階選項</block>
  <block id="a9316d69e5abcfaffc56fc8f5e645412" category="paragraph">當 HA 叢集內的主機無法連線至網路或叢集中的其他主機時、就會發生隔離事件。根據預設、 vSphere HA 會使用其管理網路的預設閘道做為預設隔離位址。不過、您可以為主機指定其他隔離位址來執行 ping 、以判斷是否應該觸發隔離回應。新增兩個可 ping 的隔離 IP 、每個站台一個。請勿使用閘道 IP 。使用的 vSphere HA 進階設定為 das.isolationaddress 。您可以將 ONTAP 或 Mediator IP 位址用於此用途。</block>
  <block id="eaa1dfe3982e06655ce64e240c139b81" category="paragraph">適用於 NetApp MetroCluster 的 VMware DRS 關聯性</block>
  <block id="e32221c52eb3b0bbeb3ca79aad6c90f6" category="paragraph">在本節中、我們會為 MetroCluster 環境中的每個站台 \ 叢集、建立 VM 和主機的 DRS 群組。然後我們設定 VM\Host 規則、使 VM 主機與本機儲存資源的關聯性一致。例如、站台 A VM 屬於 VM 群組 sitea_vms 、站台 A 主機屬於主機群組 sitea_hosts 。接下來、在 VM\Host 規則中、我們指出 sitea_vms 應該在 sitea_hosts 中的主機上執行。</block>
  <block id="5bfa0d712f66aef47f8a2ea582bc0b72" category="list-text">NetApp 強烈建議在組 * 中的主機上運行規範 * ，而不是規範 * 必須在組 * 中的主機上運行。萬一站台 A 主機故障、站台 A 的 VM 需要透過 vSphere HA 在站台 B 的主機上重新啟動、但後者的規格不允許 HA 在站台 B 上重新啟動 VM 、因為這是硬規則。以前的規格是軟性規則、在 HA 發生時會違反、因此可提供可用度而非效能。</block>
  <block id="cc6a363013bd2a8c1e05304f1c6abd79" category="inline-link">vSphere 監控與效能</block>
  <block id="124de7d2bc72d75be9e481c1cc56ada2" category="section-title">建立 DRS 主機群組</block>
  <block id="0759e9476d3bf1868f88356025adafb2" category="paragraph">若要建立站台 A 和站台 B 專屬的 DRS 主機群組、請完成下列步驟：</block>
  <block id="a69dff3dd4b284f60243dfd62fa4e57f" category="list-text">在 vSphere Web Client 中、以滑鼠右鍵按一下資源清冊中的叢集、然後選取「設定」。</block>
  <block id="a130b4af254ead99e9ea83044e54ea1d" category="list-text">按一下 VM\Host Groups 。</block>
  <block id="1bb250fbf1946dd1bd7ad228032f8803" category="list-text">按一下「新增」</block>
  <block id="62c4d1538f957af2951f2c93ee191d0b" category="list-text">輸入群組的名稱（例如、 sitea_hosts ）。</block>
  <block id="df22605898fc890edbcb2a126aa202ce" category="list-text">從「類型」功能表中、選取「主機群組」。</block>
  <block id="57c0028584902f6cee210dcc13bc9745" category="list-text">按一下「新增」、然後從站台 A 選取所需的主機、再按一下「確定」。</block>
  <block id="583e6d8c3b1006b0561d4b360e58994f" category="list-text">重複這些步驟、為站台 B 新增另一個主機群組</block>
  <block id="18d0ad44a1e563aaf9f5871e32535a6c" category="list-text">按一下「確定」。</block>
  <block id="154964ee7fc6d3261ec55811b0ff9972" category="section-title">建立 DRS VM 群組</block>
  <block id="40c1eaba5f178f243c57b595b6af4d5e" category="paragraph">若要建立站台 A 和站台 B 專屬的 DRS VM 群組、請完成下列步驟：</block>
  <block id="9a209a741c26968fc13ed8192523df15" category="list-text">輸入群組的名稱（例如、 sitea_vms ）。</block>
  <block id="f947c7c9f173289b1c2565b3297095f0" category="list-text">從 Type （類型）功能表中、選取 VM Group （ VM 群組）。</block>
  <block id="40a2a21a084c8d16395113cb79a19ebb" category="list-text">按一下「新增」、然後從站台 A 選取所需的 VM 、再按一下「確定」。</block>
  <block id="e2e7af699096077fe178ebf021fb2273" category="section-title">建立 VM Host 規則</block>
  <block id="0a6075f3d3fdbe7c133268face0f5c82" category="paragraph">若要建立站台 A 和站台 B 特有的 DRS 關聯性規則、請完成下列步驟：</block>
  <block id="df4f9bcca0ceb7a67ba25d886a18743b" category="list-text">按一下 VM\Host Rules 。</block>
  <block id="876a25c102b5c301814921d1a9c0e625" category="list-text">輸入規則的名稱（例如、 sitea_fit射 ）。</block>
  <block id="d4b5f57f4e2bd5c357ad9b1fbdc2cf8e" category="list-text">確認已核取「啟用規則」選項。</block>
  <block id="d1169f525bd934df7f1a7e3bcf401997" category="list-text">從 Type （類型）功能表中、選取 Virtual Machines to Hosts （虛擬機器至主機）。</block>
  <block id="77328c16c697ce1d6c036c3f950e7542" category="list-text">選取 VM 群組（例如、 sitea_vms ）。</block>
  <block id="b36943ce975d4c5c6e9481a4ca396270" category="list-text">選取主機群組（例如、 sitea_hosts ）。</block>
  <block id="32fbcb32cfae9a0656233943c28f7c94" category="list-text">重複這些步驟、為站台 B 新增另一個 VM\ 主機規則</block>
  <block id="488f70e76f3c9ddf155b693e31c5a1e1" category="paragraph">若要為每個站台設定資料存放區叢集、請完成下列步驟：</block>
  <block id="1dfbc2b980c0b56a5d9889c6d9a25460" category="list-text">使用 vSphere Web 用戶端、瀏覽至 HA 叢集位於 Storage 下的資料中心。</block>
  <block id="dfc332b252ad3de167b6a336d7e70d46" category="list-text">以滑鼠右鍵按一下資料中心物件、然後選取儲存 &gt; 新資料存放區叢集。</block>
  <block id="829b62dbd6a4923b66591b2bff38ed5b" category="list-text">選取 HA 叢集、然後按一下「下一步」。</block>
  <block id="30fe6cfa0a4c5fb23fccfe149cefc006" category="list-text">選取屬於站台 A 的資料存放區、然後按一下「下一步」。</block>
  <block id="4ea461b22638db4c94aa076d62a2065f" category="list-text">檢閱選項、然後按一下「完成」。</block>
  <block id="7b79e97caff76847cf350f1197c49953" category="list-text">重複這些步驟以建立站台 B 資料存放區叢集、並確認只選取站台 B 的資料存放區。</block>
  <block id="d8f83b09bd6b864f22076c109cfaae66" category="section-title">vCenter Server 可用度</block>
  <block id="605b8c1efcf2de9164e5d5425c67bdcd" category="paragraph">您的 vCenter Server 應用裝置（ VCSA ）應使用 vCenter HA 加以保護。vCenter HA 可讓您在主動式被動式 HA 配對中部署兩個 VCSA 。每個故障網域各有一個。您可以在上閱讀更多有關 vCenter HA 的資訊<block ref="173ca8434bdf39dd0a60efe576d066cd" category="inline-link-rx"></block>。</block>
  <block id="70901a02a148fd2dfc1ff5736f4f5336" category="list-text">將儲存網路流量與其他網路區隔。使用專屬的VLAN或獨立的交換器來儲存、即可建立獨立的網路。如果儲存網路共用實體路徑（例如上行鏈路）、您可能需要QoS或額外的上行鏈路連接埠、以確保有足夠的頻寬。請勿將主機直接連線至儲存設備；請使用交換器來建立備援路徑、並讓 VMware HA 在不需介入的情況下運作。請參閱 <block ref="2d54da766c3f840b00eab5923273fca5" category="inline-link-macro-rx"></block> 以取得更多資訊。</block>
  <block id="59cfc5aaa0678bcb883492b4397c71b8" category="cell">有（ ONTAP 9.14.1 ）</block>
  <block id="a58c81d13cac4e9b37bba2bd7fc3a93d" category="paragraph">VMware 領先業界的 vSphere Hypervisor 可部署為稱為 vSphere Metro Storage Cluster （ VMSC ）的延伸叢集。</block>
  <block id="e3224e391e08365c1593c07b9fe99cfa" category="section-title">適用於 vSphere 環境的持續可用度解決方案</block>
  <block id="d3e911c902a6b066f9c31d471d16fb21" category="paragraph">若要跨兩個站台建立 VMware HA/DRS 叢集、 ESXi 主機會由 vCenter Server Appliance （ VCSA ）使用和管理。vSphere 管理、 VMotion ® 和虛擬機器網路是透過兩個站台之間的備援網路連線。管理 HA/DRS 叢集的 vCenter Server 可連線至兩個站台的 ESXi 主機、並應使用 vCenter HA 進行設定。</block>
  <block id="da76be2bc20d4e043d9a2019b817214f" category="inline-link">如何在 vSphere Client 中建立和設定叢集</block>
  <block id="e02f3e9258a23204655bd512ec53911d" category="paragraph">請參閱<block ref="c06ae090600e7aa086edfa28514435e7" category="inline-link-rx"></block> 設定 vCenter HA 。</block>
  <block id="38910d3dab2318849fd5f1a1dfbe0152" category="inline-link">VMware 儲存相容性指南</block>
  <block id="838b66b875df1b432ac420a98cba3db6" category="paragraph">如果您想要更多有關 vSphere Metro Storage 叢集設計準則的資訊、請參閱下列文件：</block>
  <block id="07aaf2aebfd07b8763284018d1ebbf57" category="inline-link">VMware vSphere 支援 NetApp MetroCluster</block>
  <block id="a4a5fd5b00daf98bd381d80257378acd" category="list-text"><block ref="a4a5fd5b00daf98bd381d80257378acd" category="inline-link-rx"></block></block>
  <block id="c3dc11e39d996a00b095022f4e56583d" category="inline-link">VMware vSphere 支援 NetApp SnapMirror 業務持續運作</block>
  <block id="8f675397d9c0ef95aa8b3f0ada9d601a" category="list-text"><block ref="f53214cfd764fa0267c92323be0d7337" category="inline-link-rx"></block> （現在稱為 SnapMirror 主動同步）</block>
  <block id="b553530def78406c0977f70d5e90b9e8" category="list-text">Stretch MetroCluster</block>
  <block id="2d90abe978ed8084d304295ad0a8c8fd" category="list-text">Fabric MetroCluster</block>
  <block id="b03023e82bda6a71adc49c4834e3b6ab" category="paragraph">以下說明 Stretch MetroCluster 的高階拓撲圖。</block>
  <block id="119be031ef4485d20c7683d291d0e9f6" category="inline-link">本文檔MetroCluster</block>
  <block id="ad9122c6d75ebaa024669fde1c0bdfb8" category="paragraph">請參閱<block ref="d8a206747dbcec13122724b2aee18957" category="inline-link-rx"></block> 取得 MetroCluster 的特定設計與部署資訊。</block>
  <block id="b47354fcd7d17ab4fbb3283f71677efe" category="paragraph">SnapMirror 主動式同步也可透過兩種不同方式部署。</block>
  <block id="314084a577b998d8089dff72c98c58b0" category="list-text">非對稱</block>
  <block id="b69cd5a82aaf0c524a71d46ec6fdd29c" category="cell">NFS v4.1 工作階段主幹需要 ONTAP 9.14.1 及更新版本</block>
  <block id="d9c9eb44a58ee1ce90daa68527aa8930" category="summary">使用 MCC 的 VMSC 的失敗案例</block>
  <block id="e7c7574b0826c9074f480de76c889ba8" category="paragraph">以下各節概述 VMSC 和 NetApp MetroCluster 系統各種故障情況的預期結果。</block>
  <block id="c8a2eebb480fef69e6ed917ea7f7a9d3" category="section-title">單一儲存路徑故障</block>
  <block id="b99e8e694b032f593bbd01f6205b4a98" category="paragraph">在這種情況下、如果 HBA 連接埠、網路連接埠、前端資料交換器連接埠或 FC 或乙太網路纜線等元件故障、 ESXi 主機會將該儲存裝置的特定路徑標記為已停用。如果在 HBA/ 網路 / 交換器連接埠上提供恢復功能、就能為儲存裝置設定多個路徑、 ESXi 理想情況下會執行路徑切換。在這段期間內、虛擬機器會持續執行而不會受到影響、因為提供多條路徑可通往儲存設備、因此可確保儲存設備的可用度。</block>
  <block id="80fc15dd1deb985234440745e8a78d4c" category="paragraph">在使用 NFS/iSCSI 磁碟區的環境中、 NetApp 建議在標準 vSwitch 中、至少為 NFS vmkernel 連接埠設定兩個網路上行鏈路、而在對應 NFS vmkernel 介面的連接埠群組中、則必須設定相同的上行鏈路。NIC 群組可在雙主動式或雙主動式待命模式中進行設定。</block>
  <block id="0c8694e8ef7f8935edbfac605753bc95" category="paragraph">此外、對於 iSCSI LUN 、必須將 vmkernel 介面繫結至 iSCSI 網路介面卡、以設定多重路徑。如需詳細資訊、請參閱 vSphere 儲存文件。</block>
  <block id="0fc808fdb968eb089fbc5124c0a8e15a" category="paragraph">在使用光纖通道 LUN 的環境中、 NetApp 建議至少有兩個 HBA 、以保證 HBA/ 連接埠層級的恢復能力。NetApp 也建議將單一啟動器分區至單一目標分區、以做為設定分區的最佳實務做法。</block>
  <block id="238c3d1c7bf8b5b42237392383a4c7ab" category="paragraph">應使用虛擬儲存主控台（ VSC ）來設定多重路徑原則、因為它會為所有新的和現有的 NetApp 儲存裝置設定原則。</block>
  <block id="217811709dfb096c78e73934de01271c" category="section-title">單一 ESXi 主機故障</block>
  <block id="93bc89a0478478dd84d8159a18f6c1a2" category="image-alt">單一主機故障。</block>
  <block id="15023af3b440b4004f509e961bfe1e30" category="paragraph">在這種情況下、如果 ESXi 主機發生故障、 VMware HA 叢集中的主節點會偵測主機故障、因為主機不再接收到網路心跳。若要判斷主機是否真的停機或只是網路分割區、主節點會監控資料存放區的訊次、如果沒有、則會 ping 失敗主機的管理 IP 位址、以執行最終檢查。如果所有這些檢查都是負數、則主節點會將此主機宣告為故障主機、而在該故障主機上執行的所有虛擬機器都會在叢集中的正常主機上重新開機。</block>
  <block id="9a11158d52f71012ae8722b09bf8bf29" category="paragraph">如果已設定 DRS VM 和主機關聯性規則（ VM 群組 sitea_vms 中的 VM 應在主機群組 sitea_hosts 中執行主機）、則 HA 主機會先檢查站台 A 的可用資源如果站台 A 沒有可用的主機、則主主機會嘗試在站台 B 的主機上重新啟動 VM</block>
  <block id="7922c92ff860eb0508dc8cc8aae3ffdd" category="paragraph">如果本機站台有資源限制、則可能會在其他站台的 ESXi 主機上啟動虛擬機器。不過、如果將虛擬機器移轉回本機站台中任何仍在運作的 ESXi 主機、而違反任何規則、則定義的 DRS VM 和主機關聯性規則將會修正。如果 DRS 設定為手動、 NetApp 建議您啟動 DRS 、並套用建議來修正虛擬機器的放置位置。</block>
  <block id="387b5a49326be3a47e081682e75e19b4" category="paragraph">在此案例中、 MetroCluster 行為並無任何變更、所有資料存放區仍會保持不變、不受其個別站台影響。</block>
  <block id="a11ffa7d20dab792fe5aa9c27017493e" category="section-title">ESXi 主機隔離</block>
  <block id="17e01652089acd413e26ea89cf98a2b8" category="image-alt">ESXi 主機隔離</block>
  <block id="8a4b746274e9d7129602d54434624806" category="paragraph">在此案例中、如果 ESXi 主機的管理網路中斷、 HA 叢集中的主節點將不會接收任何訊息、因此此主機會在網路中隔離。若要判斷它是否發生故障或只是隔離、主節點會開始監控資料存放區心跳。如果主機存在、則主機會由主節點宣告為隔離。根據設定的隔離回應、主機可能會選擇關閉、關閉虛擬機器、甚至讓虛擬機器保持開機。隔離回應的預設時間間隔為 30 秒。</block>
  <block id="a070f7923919fed39772c5d3f91bf482" category="section-title">磁碟機櫃故障</block>
  <block id="4f90d34a41c7ebc83024a5e3ca35ff3a" category="image-alt">單一磁碟櫃故障。</block>
  <block id="1c872dcd4bcebb1d7567f383901dfc0d" category="section-title">單一儲存控制器故障</block>
  <block id="68badb604dbd29653979fdc7083cbffe" category="paragraph">在這種情況下、兩個儲存控制器中的其中一個會在一個站台發生故障。由於每個站台都有 HA 配對、因此一個節點的故障會以透明方式自動觸發容錯移轉至另一個節點。例如、如果節點 A1 故障、其儲存設備和工作負載會自動傳輸至節點 A2 。虛擬機器將不會受到影響、因為所有的叢集都仍然可用。第二個站台節點（ B1 和 B2 ）不受影響。此外、 vSphere HA 將不會採取任何行動、因為叢集中的主節點仍會接收到網路心跳。</block>
  <block id="0ac25682ea568511724f2e0819127d89" category="image-alt">單一節點故障</block>
  <block id="e7b4c0523308b3fd46189b6ab4867fe5" category="paragraph">如果容錯移轉是循環災難的一部分（節點 A1 容錯移轉至 A2 ）、而且之後發生 A2 故障、或是站台 A 完全故障、則災難後的切換可能會發生在站台 B</block>
  <block id="7b590b52d9f3d4d40cda67758ff92ba1" category="section-title">交換器間連結故障</block>
  <block id="9df08f82abe35d87c6f7c96b18dab755" category="section-title">管理網路的交換器間連結故障</block>
  <block id="ed0711cbc7a050952e0e370bab079bff" category="image-alt">管理網路上的交換器間連結故障</block>
  <block id="a32c6c77bb8d407cf5825aec175bab4b" category="paragraph">在此案例中、如果前端主機管理網路的 ISL 連結失敗、站台 A 的 ESXi 主機將無法與站台 B 的 ESXi 主機通訊這會導致網路分割區、因為特定站台的 ESXi 主機將無法將網路心跳傳送至 HA 叢集中的主節點。因此、由於分割區的緣故、將會有兩個網路區段、每個區段中都會有一個主節點、可保護 VM 免於特定站台內的主機故障。</block>
  <block id="628309883a8d1307131d205b200c56ae" category="section-title">儲存網路的交換器間連結故障</block>
  <block id="a9da7e2a43bcea673a22b949355e619d" category="image-alt">儲存網路的交換器間連結故障</block>
  <block id="625db96c5ee1e9b5197b6cb3c1715021" category="paragraph">在此案例中、如果後端儲存網路的 ISL 連結故障、站台 A 的主機將無法存取站台 B 的儲存磁碟區或叢集 B 的 LUN 、反之亦然。VMware DRS 規則的定義、是為了讓主機儲存站台的關聯性能讓虛擬機器在不影響站台的情況下執行。</block>
  <block id="8d9609f32cbee8fa5080f95d71a2a142" category="paragraph">在此期間、虛擬機器會繼續在各自的站台上執行、在此案例中、 MetroCluster 行為不會有任何變更。所有的資料存放區都會繼續保持不變、不受其個別站台影響。</block>
  <block id="719831bfdda20be14c04e2b165cce85e" category="paragraph">如果因為某種原因違反關聯規則（例如、 VM1 原本應從站台 A 執行、其磁碟位於本機叢集 A 節點上、而 VM1 則是在站台 B 的主機上執行）、則虛擬機器的磁碟將透過 ISL 連結遠端存取。由於 ISL 連結故障、在站台 B 執行的 VM1 將無法寫入其磁碟、因為通往儲存磁碟區的路徑已關閉、且該特定虛擬機器已關閉。在這些情況下、 VMware HA 不會採取任何行動、因為主機正在主動傳送心跳。這些虛擬機器必須在各自的站台手動關閉並開啟電源。下圖說明違反 DRS 關聯性規則的虛擬機器。</block>
  <block id="09ba89b1ea49214c15fbf8ea6f129cb0" category="image-alt">發生 ISL 故障後、違反 DRS 關聯性規則的虛擬機器無法寫入磁碟</block>
  <block id="49f26967af2ad76cacf7888cbeeb0590" category="section-title">所有交換器間故障或完整資料中心分割區</block>
  <block id="bc331d84348670dff6731555166fa378" category="paragraph">在這種情況下、站台之間的所有 ISL 連結都會中斷、而且兩個站台彼此之間會隔離。如先前的案例所述、例如管理網路和儲存網路的 ISL 故障、虛擬機器在完全 ISL 故障時不會受到影響。</block>
  <block id="3543d47d1f3a8dc6989a32f62ce3ea77" category="image-alt">所有 ISL 故障或完整的資料中心分割區</block>
  <block id="3a096ef571101010add81b37081d3276" category="paragraph">NetApp 建議判斷是否有任何虛擬機器違反 DRS 規則。從遠端站台執行的任何虛擬機器都會停機、因為它們將無法存取資料存放區、 vSphere HA 會在本機站台上重新啟動該虛擬機器。當 ISL 連結恢復上線後、在遠端站台上執行的虛擬機器將會停止運作、因為無法有兩個執行個體使用相同的 MAC 位址執行虛擬機器。</block>
  <block id="87e9384cb464ff9a4ce385fc59a178a2" category="image-alt">VM1 違反 DRS 關聯規則的資料中心分割區</block>
  <block id="0951e388ebea20c49e71af25ef84947d" category="section-title">NetApp MetroCluster 中兩個 Fabric 上的交換器間連結故障</block>
  <block id="715cbc6f6bcf5da6b73f10233847d3a1" category="paragraph">在所有 ISL 停機之後所發生的任何寫入動作、都不會鏡射到另一個站台。當組態處於此狀態時、發生災難時的切入將會遺失尚未同步的資料。在這種情況下、需要手動介入才能在進行重新操作後恢復。如果很可能在較長的時間內沒有可用的 ISL 、系統管理員可以選擇關閉所有資料服務、以避免在發生災難時發生資料遺失的風險。在至少有一個 ISL 可供使用之前、應將執行此動作的可能性與需要進行重新操作的災難可能性進行權衡。或者、如果 ISL 在串聯案例中發生故障、系統管理員可能會在所有連結失敗之前、觸發已規劃的切換至其中一個站台。</block>
  <block id="89f375bfe8be0893bf175b89ce754b8e" category="image-alt">NetApp MetroCluster 中兩個 Fabric 的交換器間連結故障。</block>
  <block id="bc813a6fdbbeebf4d230b7e33d8c3a76" category="section-title">已消除叢集連結故障</block>
  <block id="77130a0b52e4379c6b6667cf7f8e155c" category="image-alt">已對等叢集連結故障</block>
  <block id="9dc32d7afddc9a265c5c2713db55fc70" category="section-title">完成站台故障</block>
  <block id="d0d6a03c382bc5412f1822e5c97d5142" category="paragraph">在完整站台 A 故障案例中、站台 B 的 ESXi 主機因為故障而無法從站台 A 的 ESXi 主機取得網路心跳。站台 B 的 HA 主機會驗證資料存放區心跳不存在、宣告站台 A 的主機故障、並嘗試重新啟動站台 B 中的站台 A 虛擬機器在此期間、儲存管理員會執行一次轉換、以恢復仍在運作的站台上故障節點的服務、該站台將還原站台 B 上站台 A 的所有儲存服務站台 A 磁碟區或 LUN 在站台 B 上可用後、 HA 主代理程式會嘗試重新啟動站台 B 中的站台 A 虛擬機器</block>
  <block id="23e5761401326cc21bcf9d108b9e3e7f" category="paragraph">如果 vSphere HA 主要代理程式嘗試重新啟動虛擬機器（包括登錄及開機）失敗、則會在延遲後重試重新啟動。重新啟動之間的延遲時間最多可設定為 30 分鐘。vSphere HA 會嘗試重新啟動這些項目、最多嘗試次數（預設為六次）。</block>
  <block id="085a4a3eba6c30fa589bfee20eb0c294" category="paragraph">如果站台 A 已切換、則可透過容錯移轉至正常運作的節點、無縫地處理其中一個仍在運作的站台 B 節點的後續故障。在這種情況下、四個節點的工作現在僅由一個節點執行。在這種情況下、恢復將包括執行恢復到本機節點的贈品。然後、當站台 A 還原時、會執行切換作業、以還原組態的穩定狀態作業。</block>
  <block id="2b9b713afb0d80ef371a0b55e58366b6" category="image-alt">完成站台故障</block>
  <block id="e6364c2f5314a32cd95be04b4c2112e6" category="paragraph">以下各節概述將 VMware vVols 與 ONTAP 儲存設備搭配使用的程序和最佳實務做法。</block>
  <block id="a9da618400fb93b20c20f5343efaefa7" category="sidebar">VMware vSphere Metro Storage Cluster with ONTAP</block>
  <block id="2f58fa882a22b5af5f0741f03abaf611" category="sidebar">vSphere Metro Storage 叢集搭配 ONTAP</block>
  <block id="4a884da785a62e8b1758932191ff42de" category="paragraph">使用 VMware 、 Oracle OLVM 或 KVM 來虛擬化資料庫、對於選擇虛擬化技術的 NetApp 客戶而言、這是越來越常見的選擇、即使是他們最關鍵的關鍵任務資料庫也一樣。</block>
  <block id="3a8ba1ff8824968961222d6b447b4973" category="section-title">支援能力</block>
  <block id="3231d83af741101eb02b16e5d7a6dffc" category="paragraph">對於 Oracle 虛擬化支援政策、尤其是 VMware 產品、存在許多誤解。聽說 Oracle 完全不支援虛擬化並不罕見。這個概念不正確、導致錯失從虛擬化中獲益的機會。Oracle Doc ID 249212.1 討論實際需求、客戶很少會將此視為疑慮。</block>
  <block id="722bd611ee4f38780607b400c8a604c0" category="paragraph">如果虛擬化伺服器發生問題、而 Oracle Support 先前不知道該問題、可能會要求客戶在實體硬體上重現問題。執行產品尖端版本的 Oracle 客戶可能不想使用虛擬化技術、因為可能會發生支援問題、但這種情況對於虛擬化客戶而言、並不是一個真正的世界、因為他們使用的是 Oracle 產品版本。</block>
  <block id="c8a4476ecddeda66dbd2c354c8fb2c6b" category="paragraph">考慮將資料庫虛擬化的客戶應根據其業務需求做出儲存決策。雖然這是所有 IT 決策的一般陳述、但資料庫專案尤其重要、因為需求的大小和範圍差異極大。</block>
  <block id="835ce293f862d9fb74e50f4cf928c56d" category="paragraph">儲存簡報有三個基本選項：</block>
  <block id="327813abbc0ae1e9d3abe282303bf00c" category="list-text">Hypervisor 資料存放區上的虛擬化 LUN</block>
  <block id="1a1af5efffda8c766ead9f73fc782e0e" category="list-text">由虛擬機器掛載的 NFS 檔案系統（非從 NFS 型資料存放區）</block>
  <block id="f9bf9489147891f7ee7ba15126a27fda" category="list-text">直接裝置對應。客戶不喜歡 VMware RDM 、但實體裝置通常與 KVM 和 OLVM 虛擬化類似。</block>
  <block id="69b0ac6bf6ea8e1ab4e4fc896294da01" category="paragraph">將儲存設備呈現給虛擬化來賓作業系統的方法通常不會影響效能。主機作業系統、虛擬化網路驅動程式和 Hypervisor 資料存放區實作均經過高度最佳化、只要遵循基本最佳實務做法、通常都能在 Hypervisor 和儲存系統之間使用所有可用的 FC 或 IP 網路頻寬。在某些情況下、使用一種儲存呈現方法比使用另一種方法來獲得最佳效能可能會稍微容易一些、但最終結果應該是可比較的。</block>
  <block id="a2e8fb5328f6558e3a119d8c224a1897" category="paragraph">決定如何將儲存設備呈現給虛擬化來賓作業系統的關鍵因素是可管理性。沒有正確或錯誤的方法。最佳方法取決於 IT 營運需求、技能和偏好。</block>
  <block id="e4919ac0a074fa1bba5303f596a5f591" category="paragraph">考量因素包括：</block>
  <block id="c422e10bbf04c180f4c47f81ed9a1f7a" category="list-text">* 透明度。 * VM 管理其檔案系統時、資料庫管理員或系統管理員更容易識別其資料的檔案系統來源。檔案系統和 LUN 的存取方式與實體伺服器的存取方式完全相同。</block>
  <block id="42de52ad09be3101fc535dea2aedce1d" category="list-text">* 一致性。 * VM 擁有其檔案系統時、使用或不使用 Hypervisor 層會影響管理能力。資源配置、監控、資料保護等程序也可在整個資產中使用、包括虛擬化和非虛擬化環境。</block>
  <block id="0562446bc5eefe9a584e23ffb3061cbf" category="paragraph">另一方面、在另一個 100% 虛擬化的資料中心中、最好還是在整個佔用空間中使用資料存放區型儲存設備、但前提是上述相同的理由（一致性）、也就是能夠使用相同的程序來進行資源配置、保護、監控和資料保護。</block>
  <block id="7269a37b557c66664c0377693f62ec8a" category="list-text">* 穩定性與疑難排解。 * VM 擁有其檔案系統時、由於整個儲存堆疊都存在於 VM 上、因此提供良好、穩定的效能與疑難排解問題變得更簡單。Hypervisor 唯一的角色是傳輸 FC 或 IP 框架。當資料存放區包含在組態中時、它會引入另一組逾時、參數、記錄檔和潛在錯誤、使組態複雜化。</block>
  <block id="c160b6d86853c20a432e2407b82866e6" category="list-text">* 廠商鎖定 * 將資料放入資料存放區後、使用不同的 Hypervisor 或將資料從虛擬化環境中移出、將變得非常困難。</block>
  <block id="a42abd01a1e0c89cfa2112dc09378967" category="list-text">* 啟用 Snapshot ： * 虛擬化環境中的傳統備份程序可能會因為頻寬相對有限而成為問題。例如、四埠 10GbE 主幹可能足以支援許多虛擬化資料庫的日常效能需求、但這類主幹可能不足以使用 RMAN 或其他需要串流完整資料複本的備份產品來執行備份。因此、日益整合的虛擬化環境需要透過儲存快照來執行備份。如此可避免僅為了支援備份時間內的頻寬和 CPU 需求而需要過度建置 Hypervisor 組態。</block>
  <block id="86c36175331b4a95c083fabdcca8b8a0" category="paragraph">使用來賓擁有的檔案系統有時會讓您更輕鬆地利用快照型備份和還原、因為需要保護的儲存物件可以更輕鬆地鎖定目標。然而、越來越多的虛擬化資料保護產品能夠與資料存放區和快照完美整合。在決定如何將儲存設備呈現給虛擬化主機之前、應充分考慮備份策略。</block>
  <block id="8c19dda4c4cab5e52edf9463f196b97d" category="section-title">資料存放區等量分割</block>
  <block id="8fa77493c52e71f201ccdb67db26446d" category="paragraph">在使用資料庫搭配資料存放區時、效能方面有一個關鍵因素需要考量、那就是分段。</block>
  <block id="53ab623a905e6ec84d908f0b99a8d1c8" category="paragraph">VMFS 等資料存放區技術可以跨越多個 LUN 、但它們不是等量磁區的裝置。LUN 會串聯。最終結果可能是 LUN 熱點。例如、典型的 Oracle 資料庫可能有 8-LUN ASM 磁碟群組。所有 8 個虛擬化 LUN 均可在 8-LUN VMFS 資料存放區上進行佈建、但無法保證資料所在的 LUN 。產生的組態可能是全部 8 個虛擬化 LUN 、佔用 VMFS 資料存放區內的單一 LUN 。這會成為效能瓶頸。</block>
  <block id="e6bb99e411f5495b03c1e0a4e75a1434" category="paragraph">通常需要分拆。有些 Hypervisor （包括 KVM ）可以使用 LVM 等量分拆來建置資料存放區、如前所述 <block ref="dd0ff2598ebb26feb9ff73a59186b79f" category="inline-link-macro-rx"></block>。有了 VMware 、架構看起來有點不同。每個虛擬化 LUN 都必須放置在不同的 VMFS 資料存放區上。</block>
  <block id="506c2c0c7f5b70af3df68c45c46f45a7" category="paragraph">例如：</block>
  <block id="6ec151851a31c86edd358bc49f80908c" category="paragraph"><block ref="6ec151851a31c86edd358bc49f80908c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="70ff2667d6b190dea65bae42217aa310" category="paragraph">這種方法的主要驅動因素不是 ONTAP 、而是因為單一 VM 或 Hypervisor LUN 可平行處理的作業數量、有固有的限制。單一 ONTAP LUN 通常支援的 IOPS 遠高於主機所能要求的 IOPS 。單一 LUN 效能限制幾乎是主機作業系統的普遍結果。結果是大多數資料庫需要 4 到 8 個 LUN 才能滿足效能需求。</block>
  <block id="59f9d8d1b212a8ff6bd3476975e17620" category="paragraph">VMware 架構需要仔細規劃其架構、以確保此方法不會遇到資料存放區和 / 或 LUN 路徑最大化問題。此外、每個資料庫都不需要一組唯一的 VMFS 資料存放區。主要需求是確保每個主機都有一組乾淨的 4 到 8 個 IO 路徑、從虛擬化 LUN 到儲存系統本身的後端 LUN 。在極少數情況下、更多的資料存取器可能對真正極致的效能需求有所助益、但 4-8 個 LUN 通常足以滿足 95% 的資料庫需求。單一 ONTAP 磁碟區包含 8 個 LUN 、可透過典型的 OS/ONTAP/ 網路組態、支援多達 250,000 個隨機 Oracle 區塊 IOPS 。</block>
  <block id="7564f732469e12963d8b416572cf4efb" category="section-title">什麼是 vSphere Metro Storage Cluster ？</block>
  <block id="830d984ea50f71fa76636d0524167a3a" category="doc">vSphere 資料存放區和傳輸協定功能概觀</block>
  <block id="cc0f7f705e4495c607aea288505e31bf" category="sidebar">VMSC 概述</block>
  <block id="de9a829f775bc333b77fdacbc333f7a1" category="sidebar">vSphere HA 解決方案</block>
  <block id="70b29c8dabeb7a16884003c35e163f96" category="sidebar">VMSC 設計</block>
  <block id="6c4755219197ce467bf892a552c8663a" category="sidebar">VMSC 恢復能力</block>
  <block id="13376e3e9b02a56731aa64aeb10947b2" category="sidebar">使用 MCC 的 VMSC 案例</block>
  <block id="f0a36f02b824ef55cbd63aa2700a4ec9" category="summary">Oracle 資料庫快照型備份與還原</block>
  <block id="77243afc69ab08d8277d0e23dda813d9" category="doc">Oracle 資料庫線上備份</block>
  <block id="4ac7e99e454283880f5bdf93e9d59eb9" category="summary">Oracle 資料庫完整檔案 FabricPool 分層</block>
  <block id="3dd6786160916127fc2f6fc2ec955bbe" category="summary">具備 ONTAP 零區塊偵測功能的 ASM 回收公用程式</block>
  <block id="89c60635365825dfa13d154785577592" category="summary">Oracle 和 TCP/IP 及乙太網路組態</block>
  <block id="aaa024a70ffabce1e14fdc1a4b17fe8d" category="doc">用於 Oracle 資料庫的 TCP/IP 和乙太網路組態</block>
  <block id="665de76ea0059ac13982f04e19e74216" category="summary">使用 Microsoft Windows 的 Oracle 資料庫</block>
  <block id="0d4fbbc8820271a0ce5d46a15e7bf90f" category="paragraph">Microsoft Windows with ONTAP 上 Oracle 資料庫的組態主題。</block>
  <block id="422956aac4f76239935ded6a492144f2" category="summary">ONTAP 專為 Oracle 資料庫所設計。瞭解方法！</block>
  <block id="795da6575a33e265d7d9a5774cd10e6f" category="summary">ONTAP 上 Oracle 資料庫的一致性群組備份</block>
  <block id="33c729820ffa60f55745fa3c259e273c" category="doc">Oracle 資料庫一致性群組備份</block>
  <block id="56abf0735f338713ce53e8cdecd6994e" category="paragraph">若要進行最簡單的備份、只要將整個 Oracle 資料庫放在單一 ONTAP 磁碟區即可</block>
  <block id="190d2bad1c6e231bc18c33e002e663c7" category="summary">Oracle 資料庫與直接連線 ONTAP 連線</block>
  <block id="4a3f422632f7d08bf0e6c05affea24e4" category="summary">SyncMirror 的 Oracle 資料庫</block>
  <block id="5bbdf1e19bb3f7b70de51a3764fc5f19" category="doc">Oracle 資料庫儲存快照最佳化備份</block>
  <block id="a962af081661ee46d4ef879de33c841e" category="paragraph">當 Oracle 12c 發行時、快照型備份與還原變得更簡單、因為不需要將資料庫置於熱備份模式。結果是能夠直接在儲存系統上排程快照式備份、同時仍保留執行完整或時間點還原的能力。</block>
  <block id="fdf9dde4dc297fff7ac7b3c1458b0dad" category="doc">使用 Oracle 資料庫的 LVM 分拆</block>
  <block id="d3c8171a7167ce43c547aac8fdd86cfb" category="doc">Oracle 資料檔案移轉</block>
  <block id="9718528cb14225785c79e3afc4152efc" category="doc">Oracle 資料庫 LUN 規模調整和 LUN 數量</block>
  <block id="ea7df930bd6bec6222e23d2b3af02a50" category="paragraph">SnapMirror 主動式同步支援兩種儲存容錯移轉作業：計畫性和非計畫性、運作方式略有不同。系統管理員會手動啟動計畫性容錯移轉、以快速切換至遠端站台、而非計畫性容錯移轉則由第三站台的協調員自動啟動。計畫性容錯移轉的主要目的是執行漸進式修補與升級、執行災難恢復測試、或是採用正式的原則、在一年內在站台之間切換作業、以證明完整的主動式同步功能。</block>
  <block id="f7c8b0ba16967990d91c2ca78d655eaa" category="paragraph">下圖顯示正常、容錯移轉及容錯回復作業期間的情況。為了便於說明、它們描述了複寫的 LUN 。在實際的 SnapMirror 主動式同步組態中、複寫是以磁碟區為基礎、其中每個磁碟區都包含一個或多個 LUN 、但為了讓圖片更簡單、磁碟區層已經移除。</block>
  <block id="cfa86460b638615878bbee89b1b6d4c7" category="paragraph">綠線是一條活動路徑，但由於該路徑上的 IO 需要通過 SnapMirror 活動同步路徑傳遞，因此會產生更多延遲。額外的延遲時間取決於用於 SnapMirror 主動同步的站台之間互連的速度。</block>
  <block id="22ea45ef5d49a1b807d571799d80613d" category="paragraph">一旦來源系統恢復服務、 SnapMirror 主動式同步就能重新同步複寫、但會執行其他方向。現在的組態基本上與起點相同、只是主動鏡射站台已經翻轉。</block>
  <block id="2702e101c97ce9a58738b1a4089319df" category="summary">MetroCluster 邏輯架構和 Oracle 資料庫</block>
  <block id="784fdd6bf0ebb9c00eaefafc3f9a9cee" category="doc">RAID 和 Oracle 資料庫</block>
  <block id="204d288bf0e9d1ee9912d68d6282d7a9" category="summary">Oracle 資料庫與 AIX</block>
  <block id="90b3697759466f587c318ce55df76258" category="doc">使用 IBM AIX 的 Oracle 資料庫</block>
  <block id="14ab10a24aa8f6c18bfdfd0d8a394dcb" category="paragraph">IBM AIX 與 ONTAP 上 Oracle 資料庫的組態主題。</block>
  <block id="b67d277a8a8f29f7b869c9bdbff5fcd1" category="summary">Oracle 資料庫和 FabricPool 擷取原則</block>
  <block id="2e34d4efdcf01f27eb9407a010ca1621" category="summary">使用 FLI 進行 Oracle 移轉：轉換</block>
  <block id="c5753b0ef1dfc2c724f24235a689d1ab" category="summary">Oracle 資料庫 FabricPool 分層原則</block>
  <block id="57d15767e9302dbb67058ed0bd9eebac" category="doc">Oracle 資料庫與 NVFAIL</block>
  <block id="4f03272fa32b53344924740fd30fc52d" category="summary">Oracle 資料庫與 Solaris</block>
  <block id="206960915d76763c590449d5ef03639a" category="summary">ONTAP 上的 Oracle 資料庫和快照的角色</block>
  <block id="4bc550014af4fefad8f4cc8f0827c4b5" category="doc">Oracle 資料庫和快照型備份</block>
  <block id="cf5bc9d838fb937caa7978b4a9b0f98a" category="paragraph">NetApp Snapshot 技術是 ONTAP 上 Oracle 資料庫資料保護的基礎。</block>
  <block id="ba5a23e78f51c1bcb1b82efbe1797502" category="summary">Oracle 資料庫參數 - db_file_multimblock_read_count</block>
  <block id="ea84db84607112a0d40fca3ff45dfffa" category="summary">ONTAP QoS 的 Oracle 資料庫效能管理</block>
  <block id="0af83eb081b1a831789867d7f0867610" category="summary">Oracle 資料庫管理與自動化工具</block>
  <block id="7c58d5a62a9c29d2a846b210deea95f2" category="paragraph">ONTAP 在 Oracle 資料庫環境中的主要價值來自核心 ONTAP 技術、例如即時 Snapshot 複本、簡單的 SnapMirror 複寫、以及快速建立 FlexClone Volume 。</block>
  <block id="591b3149d6cb247a04883c411dab3e24" category="summary">Checksum 與 Oracle 資料庫完整性</block>
  <block id="56f014c6fc8fac3e242c9d2e42c654c0" category="paragraph">ONTAP 及其支援的通訊協定包含多項保護 Oracle 資料庫完整性的功能、包括靜態資料和透過網路傳輸的資料。</block>
  <block id="31b3368edcb737b712ee02926409c837" category="doc">Oracle 資料庫、 MetroCluster 和 NVFAIL</block>
  <block id="490e2f530e53cf85f8ce9b052a8336ec" category="paragraph">NVFAIL 是 ONTAP 中的一般資料完整性功能、其設計可讓資料庫發揮最大的資料完整性保護。</block>
  <block id="f2cf6b943d224a732c92223538580ee9" category="doc">MetroCluster 上的 Oracle 單一執行個體</block>
  <block id="ea1d91c32fcf0f4a1090fd0da341c014" category="paragraph">與其他儲存災難恢復解決方案不同、 SnapMirror 主動式同步提供非對稱式平台靈活度。每個站台的硬體不一定相同。此功能可讓您調整支援 SnapMirror 主動同步所用硬體的大小。如果遠端儲存系統需要支援完整的正式作業工作負載、則它可以與主要站台相同、但如果災難導致 I/O 減少、遠端站台上較小的系統可能會更具成本效益。</block>
  <block id="3873b13983c66ae61dd877b0443a3828" category="summary">Oracle 資料庫與一致性群組災難恢復</block>
  <block id="ede2d3fcaec1bb9dcda5a75c90f37368" category="summary">在 ONTAP 上使用 Oracle 資料庫、將可用度最大化</block>
  <block id="9688c9c1c1d15e2f91a3a5b8e5f14bd4" category="doc">ONTAP 提供 Oracle 資料庫可用度</block>
  <block id="44e95a6c3878f189a550b4c0314d3b33" category="paragraph">NetApp 知道資料庫中有最重要的關鍵任務資料。</block>
  <block id="7aa93b5fc17b83fc9e4816155f8f59ab" category="summary">Oracle 資料庫效能測試</block>
  <block id="0b3a030b64747fb3830c79e1ffbef7ee" category="summary">Oracle 資料庫和物件儲存區存取中斷</block>
  <block id="99a1755be2504777b7e266ed14b33168" category="doc">Oracle 資料庫和 ONTAP 控制器容錯移轉 / 切換</block>
  <block id="8dbb58cb7fbd4c7db3f14b9674e7d4e6" category="summary">使用 SnapRestore 快速恢復 Oracle 資料庫</block>
  <block id="fd0d4a1100bcbce28e8252537f7c4ef4" category="summary">Oracle 資料庫資料保護 SLA</block>
  <block id="48130805e35d0c7ab5afbcb71abb1ad0" category="doc">Oracle 資料庫 RTO 、 RPO 和 SLA 規劃</block>
  <block id="f359cd007fda575e70269cac76fab4af" category="paragraph">ONTAP 可讓您輕鬆根據業務需求量身打造 Oracle 資料庫資料保護策略。</block>
  <block id="05f9f35345d8f2164958f3b6b7098fa7" category="summary">Oracle 部分檔案 FabricPool 分層</block>
  <block id="48e2495d3eeb1b57ea7d073e06620063" category="doc">透過記錄傳送進行 Oracle 資料庫移轉</block>
  <block id="2cba4042f0a43491e4ea8f14238ae6e4" category="summary">Oracle 和 FabricPool 快照分層</block>
  <block id="6f7b1d0f996b7d49f60586ce7fbeca36" category="doc">Oracle 與 FabricPool 快照分層</block>
  <block id="35b12c67685c33721c1a59e8b736fd61" category="summary">使用 Oracle 資料庫進行 NFS 快取</block>
  <block id="1404b2da267c376dac716bd5455f4ff3" category="summary">使用 FLI 進行 Oracle 移轉：傳輸協定轉換</block>
  <block id="c37c1629ee55e6d553c16bbab86adbde" category="doc">將 Oracle 資料庫移轉至 ONTAP 儲存系統</block>
  <block id="f1d34b6e878aac7179a735d301e4fb76" category="paragraph">利用新儲存平台的功能、有一項不可避免的需求；資料必須放在新的儲存系統上。ONTAP 讓移轉程序變得簡單、包括 ONTAP 到 ONTAP 的移轉與升級、外部 LUN 匯入、以及直接使用主機作業系統或 Oracle 資料庫軟體的程序。</block>
  <block id="b7433f552fcf8a4e34f2ccc357037d4e" category="doc">Oracle 資料庫主機資料複本</block>
  <block id="1cede70bc6077ecbac9a77b03d1bc6e1" category="summary">Oracle 資料庫的資料保護規劃</block>
  <block id="e2bc0913921cafeb725765069883b685" category="paragraph">正確的 Oracle 資料庫資料保護架構取決於資料保留、可恢復性、以及各種事件中斷的容錯能力等業務需求。</block>
  <block id="c0b79db5f258f0c991a383cbdbf001dd" category="inline-link-macro">SnapMirror 主動同步</block>
  <block id="8a05777f407870cbc2668230c8117503" category="summary">使用 Linux 和 ASMlib/ASM 篩選器驅動程式的 Oracle 資料庫</block>
  <block id="494900ae2c2cdb5abdba3806f4dfaeb0" category="doc">使用 ASMLib/AFD 的 Oracle 資料庫（ ASM 篩選器驅動程式）</block>
  <block id="afae47e326854c63cbc85989720416e0" category="summary">使用 FLI 進行 Oracle 移轉：規劃</block>
  <block id="85cef7bf4ac9d983cf8e1e11785eeef1" category="summary">Oracle 移轉與 FLI ：完成</block>
  <block id="0c5284e14535835121effc8afb702b28" category="summary">使用 ONTAP 進行 Oracle 資料庫災難恢復</block>
  <block id="2ba21d57ee7f1d78a405b9e80c6aaf6b" category="paragraph">對於大多數客戶而言、 DR 不只需要擁有遠端資料複本、還需要能夠快速使用該資料。NetApp 提供兩種技術來滿足這種需求： MetroCluster 和 SnapMirror 主動同步</block>
  <block id="107bcc34799abe752a088be24869419c" category="paragraph">SnapMirror 主動同步是以 SnapMirror Synchronous 為基礎。使用 MetroCluster 、每個 ONTAP 控制器都負責將其磁碟機資料複寫到遠端位置。有了 SnapMirror 主動式同步、您基本上擁有兩個不同的 ONTAP 系統、可維護 LUN 資料的獨立複本、但可以合作呈現該 LUN 的單一執行個體。從主機的角度來看、這是單一 LUN 實體。</block>
  <block id="50ae143b75fc238e91c09c750cf211c1" category="summary">Oracle 資料庫參數 - filesystemio_options</block>
  <block id="cf451e0aed3c944d3f1c761387762e56" category="summary">使用 Linux 的 Oracle 資料庫</block>
  <block id="e712ed441aacc4eeecb5656d5493c99c" category="summary">使用 HP-UX 的 Oracle 資料庫</block>
  <block id="c36ae718fe9d7978c8781b19d0b3dee0" category="paragraph">適用於 HP-UX with ONTAP 上 Oracle 資料庫的組態主題。</block>
  <block id="45df37151f6a0fd8a3b55d0423459f82" category="doc">Oracle 資料庫 I/O 的 LUN 對齊</block>
  <block id="857a8adc9eda2d9e197a52323daca558" category="doc">Oracle 資料庫 FabricPool 分層概述</block>
  <block id="fd73b1ca3b942a1514078a7e59c7433b" category="summary">Oracle 資料庫和過時的 NFSv3 鎖定</block>
  <block id="102aeb54bf1a69403672f53090c52878" category="summary">透過記錄傳送的 Oracle 資料庫 DR</block>
  <block id="d470f5db851ef84aaa776600805af48b" category="summary">Oracle 資料庫虛擬化簡介</block>
  <block id="b8fc1174bb3f1c65475334182829f75e" category="doc">Oracle 資料庫虛擬化</block>
  <block id="b1b3f70e4333a9dbda75a98ceb78db39" category="summary">MetroCluster 實體架構和 Oracle 資料庫</block>
  <block id="250bce9fbefc7872908d9c2708fc753b" category="doc">Oracle 資料庫備份分層</block>
  <block id="4fbe2d000cdf5390ca980149d98eec4d" category="summary">Oracle 資料庫移轉規劃</block>
  <block id="d11e22f56fe0c9dd85597038a25cd80d" category="doc">Oracle 資料庫與儲存容量管理</block>
  <block id="1234e92308935cf0a5a22541f312c541" category="summary">採用 SnapMirror 和 SyncMirror 的 Oracle 資料庫</block>
  <block id="a4cdac841b6453db2f51ce52a1303209" category="paragraph">SnapMirror 複寫和中斷 CG SnapMirror 關係可維持各磁碟區之間的一致性、 SnapMirror 同步和 SnapMirror 主動同步則可維持各組成磁碟區之間的一致性。</block>
  <block id="454ff7e5f4a8d37cf6b16b804deca2b6" category="summary">Oracle 資料庫區塊大小</block>
  <block id="eed7df980a6ae17f8e0fecdecf0e25f4" category="doc">Oracle 移轉程序範例指令碼</block>
  <block id="fac6d6b61dd6bd3ee73d5b425bc5a3b7" category="doc">使用 Oracle 資料庫進行精簡配置</block>
  <block id="35ebaedc3385b350dff13e0cfa869c9f" category="summary">Oracle RAC 逾時</block>
  <block id="710cf627a103721a0452cb72494ea742" category="admonition">請參閱以下關於精簡配置的章節、以瞭解儲存效率與部分保留之間互動的說明。</block>
  <block id="8bc1cc1880ea3a623cb9b80b8cbb7b72" category="paragraph">壓縮資料的方法有好幾種。許多資料庫都包含自己的壓縮功能、但在客戶環境中很少會發現這種情況。其原因通常是對壓縮資料的 * 變更 * 效能會受到影響、而對於某些應用程式而言、資料庫層級壓縮的授權成本較高。最後、對資料庫作業的整體效能影響。對於執行資料壓縮與解壓縮的 CPU 、而非實際的資料庫工作、支付高昂的每 CPU 授權成本是不合理的。更好的選擇是將壓縮工作卸載到儲存系統。</block>
  <block id="3e98696b9bb83904c14603458a8c3728" category="admonition">調適式壓縮所使用的區塊大小最多可增加至 32KB 。這可能會改善儲存效率、而且當大量的這類資料儲存在陣列上時、應該考慮用於靜態檔案、例如交易記錄檔和備份檔案。在某些情況下、使用 16KB 或 32KB 區塊大小的作用中資料庫、也可能因為增加適應式壓縮的區塊大小而受惠。請洽詢 NetApp 或合作夥伴代表、瞭解這是否適合您的工作負載。</block>
  <block id="0e6f69b7cb8364ed908c411686154808" category="admonition">在串流備份目的地上、不應將大於 8KB 的壓縮區塊大小與重複資料刪除一起使用。原因是備份資料的細微變更會影響 32KB 壓縮時間。如果視窗移動、則產生的壓縮資料會在整個檔案中有所不同。重複資料刪除是在壓縮之後進行、這表示重複資料刪除引擎會以不同的方式檢視每個壓縮備份。如果需要重複資料刪除串流備份、則只應使用 8KB 區塊調適性壓縮。調適性壓縮較為理想、因為它的區塊大小較小、不會中斷重複資料刪除的效率。由於類似的原因、主機端壓縮也會影響重複資料刪除的效率。</block>
  <block id="e8a7060409e1a82af9dacfe72458ffac" category="paragraph">例如、只有在檔案與檔案系統本身的 8KB 邊界對齊時、才會壓縮寫入 8KB 檔案。這表示它必須落在檔案的前 8KB 、檔案的第二 8KB 等。確保正確對齊的最簡單方法是使用正確的 LUN 類型、建立的任何分割區都應該與 8K 的倍數裝置開始偏移、並使用資料庫區塊大小的倍數檔案系統區塊大小。</block>
  <block id="96738983d52a374cb4a8c958e924836e" category="paragraph">備份或交易記錄等資料會循序寫入跨越多個區塊的作業、所有這些區塊都會被壓縮。因此、不需要考慮對齊。唯一令人擔憂的 I/O 模式是隨機覆寫檔案。</block>
  <block id="1afe2c0821b67085f9ea2d2deeb2e92a" category="paragraph">資料壓縮技術可改善壓縮效率。如前所述、僅有調適式壓縮功能、最多可節省 2 ： 1 、因為它僅限於在 4KB WAFL 區塊中儲存 8KB I/O 。較大區塊大小的壓縮方法可提供更好的效率。不過、這些資料不適合受到小型區塊覆寫的資料。解壓縮 32KB 的資料單元、更新 8KB 部分、重新壓縮及回寫磁碟機、都會產生額外的負荷。</block>
  <block id="82116b39cd4d0d1920fab1ab4515603b" category="paragraph">節省的程度各不相同。已壓縮或加密的資料通常無法進一步壓縮、因此資料集無法從資料壓縮中獲益。相反地、新初始化的資料檔案僅包含區塊中繼資料和零、最多可壓縮至 80 ： 1 。</block>
  <block id="2608473fa5767385d01f256eccbc1cc4" category="paragraph">許多競爭陣列都宣稱能夠根據資料庫複製多次的假設來刪除重複的資料庫。在這方面，也可以使用 NetApp 重複資料刪除技術，但 ONTAP 提供更好的選擇： NetApp FlexClone 技術。最終結果相同；資料庫的多個複本會建立共用大部分基礎實體區塊。使用 FlexClone 比花時間複製資料庫檔案然後刪除複製檔案更有效率。實際上，它是不重複數據刪除，而不是重複數據刪除，因爲從一開始就不會創建重複數據。</block>
  <block id="7e96c1b651af3f28c27b78807f0310e2" category="paragraph">強烈建議採用精簡配置、因為它可以簡化管理、同時大幅改善可用容量、並節省相關成本。原因很簡單：資料庫環境通常包含大量的空空間、大量的磁碟區和 LUN 、以及可壓縮的資料。如果磁碟區和 LUN 的儲存空間有一天 100% 滿、而且包含 100% 不可壓縮的資料、則大量資源配置會導致保留空間。這種情況不太可能發生。精簡配置可回收空間並在其他地方使用、並可讓容量管理以儲存系統本身為基礎、而非許多較小的磁碟區和 LUN 。</block>
  <block id="f67b854e2d644480b0ec40d7de2b773d" category="paragraph">在 All Flash AFF 系統上執行的 ONTAP 上建立的磁碟區會自動精簡佈建、並啟用所有的內嵌效率功能。雖然資料庫通常無法從重複資料刪除中獲益、而且可能包含不可壓縮的資料、但預設設定仍適用於幾乎所有的工作負載。ONTAP 旨在有效處理所有類型的資料和 I/O 模式、無論是否能節省成本。只有在充分瞭解理由且有偏離的好處時、才應變更預設值。</block>
  <block id="649141c6b8267ea3df10949a853d22cb" category="list-text">請勿將 32KB 壓縮和重複資料刪除同時用於資料庫備份。請參閱一節 <block ref="57ee2712afc5e59236f86db0537b05dc" category="inline-xref-macro-rx"></block> 以取得詳細資料。</block>
  <block id="5059ada12bae6c7e7fac9338d88301b5" category="doc">Oracle 資料庫歸檔記錄分層</block>
  <block id="4abda684ecc952239d7800547dcf2995" category="sidebar">MetroCluster 上的 Oracle SI</block>
  <block id="bdebc59bb8c11012c00a4be61b8bdb5d" category="summary">Microsoft SQL Server 執行個體部署</block>
  <block id="030194212f0e1890126b205fdbcfe852" category="summary">保護 ONTAP 上的 Microsoft SQL Server 安全</block>
  <block id="972d09960af01a5f3831f2eac1c75d12" category="summary">使用 ONTAP 進行 Microsoft SQL Server 災難恢復</block>
  <block id="db78788a721b9a9a669c4935d455a593" category="paragraph">企業資料庫和應用程式基礎架構通常需要複寫、才能在最短的停機時間內、避免自然災難或非預期的業務中斷。</block>
  <block id="fad02ab7a45b438ba1a4c024b9edb2be" category="paragraph">以下是 SnapMirror for SQL Server 的建議：</block>
  <block id="ff1af055b96eb7cd0f0ab71b2cc80c3d" category="list-text">為了一致性的目的、請勿從控制器排程 SnapMirror 更新。而是在完整備份或記錄備份完成後、從 SnapCenter 啟用 SnapMirror 更新以更新 SnapMirror 。</block>
  <block id="60654048dbcae98cde53dc0449c8e47b" category="summary">Microsoft SQL Server 儲存考量</block>
  <block id="71cc52562b241f23c0f5c74c589fc56c" category="paragraph">Aggregate 是 NetApp 儲存組態的最低層級儲存容器。網際網路上存在一些舊版文件、建議將 IO 分隔到不同的基礎磁碟機集。ONTAP 不建議這麼做。NetApp 已使用資料檔案和交易記錄檔分離的共用和專用集合體、執行各種 I/O 工作負載特性分析測試。測試結果顯示、一個大型集合體含有更多 RAID 群組和磁碟機、可最佳化和改善儲存效能、而且管理員更容易管理、原因有兩個：</block>
  <block id="994dbcbb2492daba25572c539cc12968" category="list-text">一個大型集合體可讓所有檔案都能使用所有磁碟機的 I/O 功能。</block>
  <block id="900188651b4134e36897865047c3fb5b" category="list-text">將磁碟區中的快照保留值設為零、以便從作業角度進行監控。</block>
  <block id="27d9533edb3ad60370502d101cd38d2b" category="list-text">停用快照排程和保留原則。而是使用 SnapCenter 來協調 SQL Server 資料磁碟區的 Snapshot 複本。</block>
  <block id="a09a2d9023a555d2d5a72621bf3395b3" category="list-text">將 SQL Server 系統資料庫放在專用磁碟區上。</block>
  <block id="7b3c6a2d089eb1b6f8959e7e61a50c07" category="section-title">LUN</block>
  <block id="a2f15f0d2a5091a4b232a8fa89bb43f8" category="paragraph">執行查詢時、 SQL Server 會嘗試分配最適當的記憶體量、以有效執行。</block>
  <block id="a549d3d5e3e6aa1db52e782527a9664d" category="summary">Microsoft SQL Server 資料庫檔案放置</block>
  <block id="329282f5b4d197877079b3b130756d76" category="paragraph">在 ONTAP 上正確放置 SQL Server 資料庫檔案是初始部署階段的關鍵。如此可確保最佳效能、空間管理、備份與還原時間、並可根據您的業務需求進行設定。</block>
  <block id="d8969d8106a5ac08f38277a3c0b813dc" category="paragraph">將多個資料檔案放入檔案群組的功能可讓您將負載分散到不同的儲存裝置、有助於改善系統的 I/O 效能。與此相反的是、由於 SQL Server 會循序寫入交易記錄檔、因此無法從多個檔案中獲益。</block>
  <block id="bd87ed7f70b7f9173319df18e5b5b751" category="paragraph">每次 SQL Server 增加檔案時、都會以零填滿新分配的空間。該程序會封鎖所有需要寫入對應檔案的工作階段、或在交易記錄增加時產生交易記錄。</block>
  <block id="7a64f7e9c9b5737a434bdcc8f935c5ce" category="summary">Microsoft SQL Server 和 ONTAP 儲存效率</block>
  <block id="9df29e7c756637e30b37f014d02117ef" category="paragraph">SQL Server 本身也具備可壓縮及有效管理資料的功能。SQL Server 目前支援兩種類型的資料壓縮：資料列壓縮和頁面壓縮。</block>
  <block id="09ddfa236e0fa1173f8d86a5ad0c148f" category="summary">Microsoft SQL Server 記錄目錄</block>
  <block id="cc2c23339c0ad05c5ae1704b4a0ecb37" category="paragraph">記錄目錄是在 SQL Server 中指定、用於在主機層級儲存交易記錄備份資料。如果您使用 SnapCenter 來備份記錄檔、則 SnapCenter 使用的每個 SQL Server 主機都必須設定一個主機記錄目錄、才能執行記錄備份。由於包含資料庫儲存庫、因此與備份、還原或複製作業相關的中繼資料會儲存在中央資料庫儲存庫中SnapCenter 。</block>
  <block id="59412263456ecc0573b76fe1c40d55fb" category="paragraph">ONTAP 為您的 Microsoft SQL Server 資料庫提供企業級的安全性與效能解決方案、同時也提供世界級的工具來管理您的環境。</block>
  <block id="e8b13d430655a3ab009ba8e90e51ce5a" category="paragraph">NetApp 假設讀者具備下列工作知識：</block>
  <block id="c7f2945182947499933dea6fafeb22d3" category="summary">ONTAP 上的 Microsoft SQL Server tempdb 放置位置</block>
  <block id="03162932e80c8f83c1ad9e36b16c1dcf" category="summary">Microsoft SQL Server CPU 組態</block>
  <block id="074e88cde37f7aba58ac120bbc874e77" category="paragraph">SQL Server 授權有兩個選項。第一個稱為伺服器 + 用戶端存取授權（ CAL ）模式、第二個是每個處理器核心模式。雖然您可以使用伺服器 + CAL 策略存取 SQL Server 中所有可用的產品功能、但每個插槽的硬體限制為 20 個 CPU 核心。即使您的伺服器的 SQL Server Enterprise Edition + CAL 每個插槽有超過 20 個 CPU 核心、應用程式也無法在該執行個體上同時使用所有這些核心。</block>
  <block id="cc3873d6002920194cf7e9dd493c5863" category="paragraph">除非您遇到效能問題、否則您不太可能需要變更處理器親和性預設值、但仍值得您瞭解它們是什麼、以及它們的運作方式。</block>
  <block id="4317f0d20ae625ae3139762a94175cbd" category="paragraph">根據預設、如果選擇個別處理器核心授權、 SQL Server 會在查詢執行期間使用所有可用的 CPU 。</block>
  <block id="ff03ad08d7a38270e44c8c74372d0e7c" category="summary">使用 SnapCenter 和 T-SQL 命令保護 ONTAP 上的 Microsoft SQL Server 資料庫。</block>
  <block id="a72812111b6cfc428e19135820c476bc" category="paragraph">SnapCenter 是適用於企業應用程式的 NetApp 資料保護軟體。使用適用於 SQL Server 的 SnapCenter 外掛程式、以及由 SnapCenter Plug-in for Microsoft Windows 管理的作業系統作業、即可快速輕鬆地保護 SQL Server 資料庫。</block>
  <block id="62c187efa0cd9f4191b84ae987d522c9" category="paragraph">SQL Server 執行個體可以是獨立式安裝、容錯移轉叢集執行個體、也可以永遠位於可用性群組。結果是、從單一窗口即可保護、複製及還原主要或次要複本的資料庫。SnapCenter 可以同時管理內部部署、雲端和混合式組態的 SQL Server 資料庫。資料庫複本也可以在幾分鐘內在原始主機或替代主機上建立、以供開發或報告之用。</block>
  <block id="8a3aceb6ed4b21af2f2c00ecb032f75f" category="paragraph">在 SQL Server 2022 中、 Microsoft 推出了 T-SQL 快照、可提供建立指令碼和自動化備份作業的路徑。您可以為資料庫準備快照、而非執行完整大小的複本。資料庫準備好備份之後、您就可以利用 ONTAP REST API 來建立快照。</block>
  <block id="eeeb4e610a7896c1b1f2e2ea9b3f52a0" category="list-text">使用 ALTER 命令凍結資料庫。如此一來、資料庫就能在基礎儲存設備上準備一致的快照。凍結之後、您可以使用備份命令來解凍資料庫並記錄快照。</block>
  <block id="fd95362fecccbbb7b017317e8bede3b5" category="admonition">ONTAP 和 MySQL 資料庫上的本文件取代先前發佈的 _TR-4722 ： ONTAP 最佳實務做法的 MySQL 資料庫。 _</block>
  <block id="887757e2405372a0b9e17cc054ab38f3" category="paragraph">SnapRestore 之所以能如此快速有效地運作、是因為快照的本質、基本上是在特定時間點對磁碟區內容進行平行唯讀檢視。作用中區塊是可以變更的實際區塊、而快照則是建立快照時構成檔案和 LUN 之區塊狀態的唯讀檢視。</block>
  <block id="f9b673452d1da030fef3f976bbbbb103" category="paragraph">在此範例中、來源資料庫位於 ONTAP 系統上。建立資料庫備份最簡單的方法是使用快照。將資料庫置於熱備份模式幾秒鐘<block ref="252ce13e6c150af4d3e7eea5fca266bc" prefix=" " category="inline-code"></block> 在託管資料檔案的磁碟區上執行作業。</block>
  <block id="630a571b99791968d41f9caba4a3e39c" category="paragraph">結果是磁碟上的快照稱為<block ref="a8b3bc9f12cd194b80d404c30e9015ee" prefix=" " category="inline-code"></block> 包含處於熱備份模式時的資料檔案映像。如果結合適當的歸檔記錄以使資料檔案一致、則此快照中的資料可作為還原或複製的基礎。在這種情況下、它會複寫到新的伺服器。</block>
  <block id="96a1129a5a4b32943286cafd5e0ca2e1" category="paragraph">在此範例中、 SnapMirror 用於將快照熱備份複寫到新位置。</block>
  <block id="0c4e214451012c456ece194f5465deb2" category="paragraph">SnapCenter 包括快照式備份與還原、 SnapMirror 與 SnapVault 複寫等基本功能、以及大型企業大規模營運所需的其他功能。這些進階功能包括擴充的角色型存取控制（ RBAC ）功能、可與協力廠商協調化產品整合的 RESTful API 、資料庫主機上 SnapCenter 外掛程式的不中斷中央管理、以及專為雲端規模環境設計的使用者介面。</block>
  <block id="ee4b6ce05339d0d985309ece9b7d4372" category="inline-link-macro">TR-4067 ONTAP 最佳實務做法上的 NFS</block>
  <block id="7a3ba6ac400bdd362b5db9daabcefca2" category="paragraph">NFS 傳輸協定包含多個不同需求的版本。如需 ONTAP 的 NFS 組態完整說明、請參閱 <block ref="d594eac583da3f61bc51209142764c76" category="inline-link-macro-rx"></block>。下列各節涵蓋一些較重要的需求和一般使用者錯誤。</block>
  <block id="dabc72adea00cc712e7650b066f1d8c6" category="inline-link">TR-4067 ONTAP 最佳實務做法上的 NFS</block>
  <block id="36911cfd2b35ef0ca97dab53c7e045f0" category="paragraph">切換至 NFSv4 比單純將掛載選項從 ves=3 變更為 ves=4.1 更複雜。如需更完整的 NFSv4 組態與 ONTAP 說明、包括作業系統設定指南、請參閱<block ref="92f446ddde3e320c4e32b449cbe3112d" category="inline-link-rx"></block>。本 TR 的下列各節說明使用 NFSv4 的一些基本要求。</block>
  <block id="a80438f1b3354b284cf31082c45b33b3" category="summary">採用 ONTAP 的 Hyper-V 儲存基礎架構</block>
  <block id="cfbb26e347d5746581822f8046be20c4" category="paragraph">Hyper-V 儲存基礎架構可裝載於 ONTAP 儲存系統上。Hyper-V 儲存以儲存 VM 檔案及其磁碟的儲存設備可使用 NetApp LUN 或 NetApp CIFS 共用來提供、如下圖所示。</block>
  <block id="25aa60030552ee28c6e802f74d96f111" category="inline-image-macro">NetApp 上的 Hyper-V 儲存基礎架構、寬度 =624 、高度 =338</block>
  <block id="818a20c74e71223c5a644895a6dd4095" category="paragraph"><block ref="818a20c74e71223c5a644895a6dd4095" category="inline-image-macro-rx" type="image"></block></block>
  <block id="a9c5672e01a7d0a8e068c2573fbdd4c2" category="section-title">NetApp LUN 上的 Hyper-V 儲存設備</block>
  <block id="1d9f855d005777411eca330fd3c883a1" category="inline-link-macro">在 SAN 環境中進行資源配置</block>
  <block id="d02671c8f4f293bf5688d34f44e5b87b" category="list-text">在 Hyper-V 伺服器機器上佈建 NetApp LUN 。如需詳細資訊、請參閱「<block ref="9659d1fb07c4af2143cd165cb4b6822e" category="inline-link-macro-rx"></block>。」</block>
  <block id="2771a58b129233810f1c389eedd2207f" category="list-text">從 Server Manager 的「工具」區段開啟 Hyper-V Manager 。</block>
  <block id="ee15a170a42b1f37e0d70bf3b367f2ee" category="list-text">選取 Hyper-V 伺服器、然後按一下 Hyper-V 設定。</block>
  <block id="b9cc0276ae5386d0ed5e9ed31ceb340d" category="list-text">指定將 VM 及其磁碟儲存為 LUN 的預設資料夾。這樣做會將預設路徑設為 Hyper-V 儲存設備的 LUN 。如果您想要明確指定 VM 的路徑、則可以在建立 VM 時指定路徑。</block>
  <block id="72feffd29972ad4bc2fb9f5705e60864" category="inline-link-macro">在 SMB 環境中進行資源配置</block>
  <block id="ace87f7890ab6204f4ef6abd0afaf28a" category="paragraph">在開始執行本節所列的步驟之前、請先檢閱「<block ref="f9d723fa339e7968f40a99719593036c" category="inline-link-macro-rx"></block>。」 若要在 NetApp CIFS 共用上設定 Hyper-V 儲存設備、請完成下列步驟：</block>
  <block id="d3f9aa7fc4289533bdeb015bbd645a22" category="list-text">指定將 VM 及其磁碟儲存為 CIFS 共用的預設資料夾。這樣做會將預設路徑設為 Hyper-V 儲存設備的 CIFS 共用。如果您想要明確指定 VM 的路徑、則可以在建立 VM 時指定路徑。</block>
  <block id="a531c67c9d6be93b7864c891efc5480a" category="paragraph">Hyper-V 中的每個虛擬機器也可隨附提供給實體主機的 NetApp LUN 和 CIFS 共用。此程序與任何實體主機相同。下列方法可用於將儲存設備配置至 VM ：</block>
  <block id="b7756c6e1b92d15f0367db534aa4fdc2" category="list-text">使用 VM 中的 FC 啟動器新增儲存 LUN</block>
  <block id="dda418820dd5a8b649a681b73da4ba97" category="list-text">使用虛擬機器中的 iSCSI 啟動器新增儲存 LUN</block>
  <block id="ee0537a6d83f8b83e99ac0b7b3d0af82" category="list-text">將直接移轉實體磁碟新增至 VM</block>
  <block id="a842c008b079c30c444ab4c9d78524e6" category="list-text">從主機將 VHD/VHDX 新增至 VM</block>
  <block id="50fba9282607c757ab39ad110cd0fde4" category="list-text">當 VM 及其資料儲存在 NetApp 儲存設備上時、 NetApp 建議定期在 Volume 層級執行 NetApp 重複資料刪除。當相同的 VM 託管在 CSV 或 SMB 共享上時、這種做法可大幅節省空間。重複資料刪除功能會在儲存控制器上執行、不會影響主機系統和 VM 的效能。</block>
  <block id="6b4ecf09c5310b6b905c86b910a57012" category="list-text">NetApp 建議取消勾選允許管理作業系統共用 Hyper-V 虛擬交換器的此網路介面卡選項。這樣做可為 VM 建立專用網路。</block>
  <block id="8f20505d01de58b8e00048581d2d7244" category="list-text">如果主機系統已設定多個 FC 連接埠並呈現給 VM 、則必須在 VM 中安裝 MPIO 才能啟用多重路徑功能。</block>
  <block id="e003acc3eceda748125d4c7bf41052e7" category="list-text">如果在該主機上使用 MPIO 、則無法將直接移轉磁碟配置至主機、因為直接移轉磁碟不支援 MPIO 。</block>
  <block id="aa7c5f68a034b43fa3bafa90ea6a6c2b" category="list-text">用於 VHD/VHD 檔案的磁碟應該使用 64K 格式進行配置。</block>
  <block id="5aa08a9ab39b4ff0ad3ec476f9c0a7a9" category="inline-link">Hyper-V 虛擬光纖通道總覽</block>
  <block id="17d2fe1a1b42dbc4c914a82ff9a06cbf" category="list-text">如需虛擬光纖通道的詳細資訊、請參閱 Microsoft<block ref="ffefda586e5fabc71f0e43393b116d4c" category="inline-link-rx"></block> 頁面。</block>
  <block id="6736b7040d05d12679268b13fae93377" category="paragraph">有了 ODX 、在 SMB 共用區、 LUN 內、以及 SMB 共用區與 LUN 之間（如果位於同一個磁碟區）複製檔案、速度更快、效率更高。此方法在相同磁碟區中需要多個作業系統（ HDD/VHDX ）黃金映像複本的情況下更有幫助。如果複本位於同一個磁碟區內、則可在大幅減少的時間內製作同一個黃金映像的數個複本。ODX 也適用於 Hyper-V 儲存即時移轉、可用於移動 VM 儲存設備。</block>
  <block id="53003aec095203ae2075a8150e8ead4e" category="paragraph">如果複本是跨磁碟區的、相較於主機型複本、效能可能不會大幅提升。</block>
  <block id="80f704dacc785527bc57a7851889f8b3" category="paragraph">若要在 CIFS 上啟用 ODX 功能、請在 NetApp 儲存控制器上執行下列 CLI 命令：</block>
  <block id="9c8ee5398727fdb2573f25e0535d686d" category="list-text">啟用適用於 CIFS 的 ODX 。
# 將權限等級設為診斷
叢集：： &gt; 設定權限診斷</block>
  <block id="574eac1c36a4e6832136e6cf051cc147" category="list-text">若要在 SAN 上啟用 ODX 功能、請在 NetApp 儲存控制器上執行下列 CLI 命令：
# 將權限等級設為診斷
叢集：： &gt; 設定權限診斷</block>
  <block id="ea782640f98557c065767874aded89e7" category="list-text">對於 CIFS 、只有當用戶端和儲存伺服器都支援 SMB 3.0 和 ODX 功能時、 ODX 才會提供使用。</block>
  <block id="c2dca5b1810c92e856cc04f6f2a88586" category="list-text">對於 SAN 環境、只有當用戶端和儲存伺服器都支援 ODX 功能時、 ODX 才可用。</block>
  <block id="f41987326c80680c60b359697adfa4cc" category="inline-link">改善 Microsoft 遠端複製效能</block>
  <block id="fcb65106bb1fd73c88cf9528cb579ed5" category="inline-link">Microsoft 卸載資料傳輸</block>
  <block id="65994fb0563b49bfe0e59359edf5513d" category="paragraph">如需 ODX 的相關資訊、請參閱<block ref="29f9e15a4017cdf9ae06e098a7a28381" category="inline-link-rx"></block> 和<block ref="f884f78ec6d36ebebd3d9fc57e8c3734" category="inline-link-rx"></block> 。</block>
  <block id="20029977789a74e480e6f8d14c07b48a" category="paragraph">容錯移轉叢集可為 Hyper-V 伺服器提供高可用度和擴充性。容錯移轉叢集是一組相互支援的 Hyper-V 伺服器、可一起提高 VM 的可用度和擴充性。</block>
  <block id="1b5f8c43b61e9249f3c82e39f9649160" category="section-title">叢集共享磁碟區</block>
  <block id="c3e01cf065f02a4feb72ac75d534fa2e" category="paragraph">CSV 可讓容錯移轉叢集中的多個節點同時擁有與 NTFS 或 Refs 磁碟區相同的 NetApp LUN 的讀取 / 寫入存取權。透過 CSV 、叢集式角色可以從一個節點快速容錯移轉至另一個節點、而無需變更磁碟機擁有權或卸除及重新掛載磁碟區。CSV 也能簡化容錯移轉叢集中可能大量 LUN 的管理。CSV 提供一般用途的叢集式檔案系統、其分層位於 NTFS 或 Refs 之上。</block>
  <block id="92f30d2ddb9cc7fbf92029307c6dbe98" category="inline-image-macro">Hyper-V 容錯移轉叢集與 NetApp 、 width=624 、 height =271</block>
  <block id="873c6f06eca771e8f918112aaf233170" category="paragraph"><block ref="873c6f06eca771e8f918112aaf233170" category="inline-image-macro-rx" type="image"></block></block>
  <block id="7c1d777ad1068fcefc91b140eba543bf" category="list-text">NetApp 建議關閉 iSCSI 網路上的叢集通訊、以防止內部叢集通訊和 CSV 流量流經同一個網路。</block>
  <block id="b53334a2710cb18a4e717240b312807f" category="list-text">NetApp 建議使用備援網路路徑（多個交換器）來提供恢復能力和 QoS 。</block>
  <block id="f251ad17cf6806e0e3667148cda40e43" category="list-text">用於 CSV 的磁碟必須使用 NTFS 或 Refs 進行分割。使用 FAT 或 FAT32 格式化的磁碟無法用於 CSV 。</block>
  <block id="161432666d89990b3c1112afe633ff8e" category="list-text">用於 CSV 的磁碟應使用 64K 格式進行配置。</block>
  <block id="36cf7806cbb55a382b64bd9b65b2939b" category="inline-link-macro">部署 Hyper-V 叢集</block>
  <block id="390167e852a9bfc97d6ed31462a05b2f" category="paragraph">如需部署 Hyper-V 叢集的相關資訊、請參閱附錄 B ： <block ref="8a150f92c22920868769b8738759e23d" category="inline-link-macro-rx"></block>。</block>
  <block id="32730f5882545bbe6a81ac49049968f0" category="section-title">Hyper-V 線上即時移轉： VM 移轉</block>
  <block id="d7f2f7b4116921a3d8d4b8e5892420a7" category="paragraph">有時在 VM 的生命週期內、必須將其移至 Windows 叢集上的不同主機。如果主機的系統資源不足、或由於維護原因而需要重新開機、則可能需要這麼做。同樣地、可能需要將 VM 移至不同的 LUN 或 SMB 共用區。如果目前的 LUN 或共享區空間不足或效能低於預期、則可能需要這項功能。Hyper-V 線上即時移轉功能可將執行中的 VM 從一部實體 Hyper-V 伺服器移轉至另一部伺服器、對使用者的 VM 可用度沒有影響。您可以在屬於容錯移轉叢集一部分的 Hyper-V 伺服器之間、或是在不屬於任何叢集的單獨 Hyper-V 伺服器之間、即時移轉 VM 。</block>
  <block id="92829881718abd402c6c73b34be944da" category="section-title">叢集環境中的即時移轉</block>
  <block id="e8881f62af8c1495a1f4869b97e95505" category="paragraph">VM 可在叢集的節點之間無縫移動。VM 移轉是即時的、因為叢集中的所有節點都共用相同的儲存設備、而且可以存取 VM 及其磁碟。下圖說明叢集環境中的即時移轉。</block>
  <block id="8cda6697809dd81e112a12c43f6f89f4" category="inline-image-macro">在叢集式環境中進行即時移轉、寬度 =580 、高度 =295</block>
  <block id="d668981cacbbf412643956687c03fc0d" category="paragraph"><block ref="d668981cacbbf412643956687c03fc0d" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4797d6b2727c9902e114fa95ed076fc2" category="list-text">擁有專屬連接埠、可進行即時移轉流量。</block>
  <block id="7c021f26d9ab2ec9934fc24d167ceaa4" category="list-text">擁有專用的主機即時移轉網路、以避免移轉期間發生與網路相關的問題。</block>
  <block id="a725857d2338d476a409fd1fb67b1f56" category="inline-link-macro">附錄 C ：在叢集環境中部署 Hyper-V 線上即時移轉</block>
  <block id="45f7134e494aae2cba3b60b3fe769caa" category="paragraph">如需在叢集環境中部署即時移轉的相關資訊、請參閱 <block ref="b584c2d96a6b139fbe05976580afae94" category="inline-link-macro-rx"></block>。</block>
  <block id="07cb5e9c694ee3a8dcc475a38371ad5c" category="paragraph">您可以在兩個非叢集式、不相互關聯的 Hyper-V 伺服器之間即時移轉 VM 。此程序可以使用共用或不共用的即時移轉。</block>
  <block id="87b94a12a79a6dbc08decd540810bb26" category="inline-image-macro">在非叢集式環境中進行共用即時移轉、寬度 =331 、高度 =271</block>
  <block id="f442dd66197cc65f49ad8ec9c50e8076" category="paragraph"><block ref="f442dd66197cc65f49ad8ec9c50e8076" category="inline-image-macro-rx" type="image"></block></block>
  <block id="207d1150dff7488c7f8bfafe7036a222" category="list-text">在「共享無內容即時移轉」中、每部 Hyper-V 伺服器都有自己的本機儲存設備（可以是 SMB 共享區、 LUN 或 DAS ）、而 VM 的儲存設備則是其 Hyper-V 伺服器的本機儲存設備。VM 在線上即時移轉時、 VM 的儲存設備會透過用戶端網路鏡射到目的地伺服器、然後再移轉 VM 。儲存在 DAS 、 LUN 或 SMB/CIFS 共用區上的虛擬機器可移至其他 Hyper-V 伺服器上的 SMB/CIFS 共用區、如下圖所示。也可將其移至 LUN 、如第二個圖所示。</block>
  <block id="8df9231bc9de1239aa92c6a9d1116db4" category="inline-image-macro">在非叢集式環境中、不共用任何即時移轉至 SMB 共享區、寬度 =624 、高度 =384</block>
  <block id="c6acea552c059bcc9ccb207ad6b8cee1" category="paragraph"><block ref="c6acea552c059bcc9ccb207ad6b8cee1" category="inline-image-macro-rx" type="image"></block></block>
  <block id="559b3e5c1d4ea7b8f3eaf8cbc0e4155e" category="inline-image-macro">在非叢集式環境中將任何內容即時移轉至 LUN 、寬度 =624 、高度 =384</block>
  <block id="3d0d53528ff4699abb6fab11a6bf756d" category="paragraph"><block ref="3d0d53528ff4699abb6fab11a6bf756d" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b19cfe6ea61be3a5ed442a8a975a6406" category="inline-link-macro">附錄 D ：在叢集環境之外部署 Hyper-V 即時移轉</block>
  <block id="b7c375b5c0ef95eecd45b0a4614c2c68" category="paragraph">如需在叢集環境外部部署即時移轉的相關資訊、請參閱 <block ref="52490817f607e6265e62f91bb3c3799a" category="inline-link-macro-rx"></block>。</block>
  <block id="061731a1a3266df0eda8efe87e649dbb" category="section-title">Hyper-V 儲存即時移轉</block>
  <block id="ecaa2ddd351a3f5a9704aaea9a13abaf" category="paragraph">在虛擬機器的生命週期內、您可能需要將虛擬機器儲存設備（ HDD/VHDX ）移至不同的 LUN 或 SMB 共享區。如果目前的 LUN 或共享區空間不足或效能低於預期、則可能需要這項功能。</block>
  <block id="1f976b42d4bb2c18a943d132252997d6" category="paragraph">目前裝載 VM 的 LUN 或共用區可能會用盡空間、重新規劃用途、或是降低效能。在這種情況下、虛擬機器可以在不停機的情況下移至另一個 LUN 、或在不同的磁碟區、集合或叢集上共用。如果儲存系統具備複製卸載功能、此程序就會更快完成。NetApp 儲存系統預設為啟用 CIFS 和 SAN 環境的複製卸載。</block>
  <block id="bbaae8d50419225b92db654852107b29" category="paragraph">ODX 功能可在位於遠端伺服器上的兩個目錄之間執行完整檔案或子檔案複本。複本是透過在伺服器之間複製資料來建立（如果來源和目的地檔案都在同一部伺服器上、則複製資料也會複製到同一部伺服器）。建立複本時、用戶端不會從來源讀取資料、也不會寫入目的地。此程序可減少用戶端或伺服器的處理器和記憶體使用量、並將網路 I/O 頻寬降至最低。如果複本位於同一個磁碟區內、則複本速度會更快。如果複本是跨磁碟區的、相較於主機型複本、效能可能不會大幅提升。在繼續主機上的複本作業之前、請確認儲存系統上已設定複本卸載設定。</block>
  <block id="843c69ad55fb8bac002321dee51a4770" category="paragraph">從主機啟動 VM 儲存即時移轉時、會識別來源和目的地、並將複製活動卸載至儲存系統。由於活動是由儲存系統執行、因此主機 CPU 、記憶體或網路的使用率可忽略不計。</block>
  <block id="27d2fda0da241bb37583fba1af25cd09" category="paragraph">NetApp 儲存控制器支援下列不同的 ODX 情境：</block>
  <block id="48a53ae81ff0c821cba0e11bd2383bf3" category="list-text">* IntraSVM 。 * 資料歸同一個 SVM 所有：</block>
  <block id="ec3d44fd176b5d51f4f60dff319cea6b" category="list-text">* Intravolume 、 inIntranet 模式 * 。來源和目的地檔案或 LUN 位於同一個磁碟區內。複本是使用 FlexClone 檔案技術執行、可提供額外的遠端複本效能優勢。</block>
  <block id="980ca02c9855a39b86e9fbf5acd955b4" category="list-text">* 磁碟區間、內部網路模式 * 。來源和目的地檔案或 LUN 位於同一個節點上的不同磁碟區上。</block>
  <block id="8a4d33d47a803a1796b431a0df5a8016" category="list-text">* 磁碟區間、節點間。 * 來源和目的地檔案或 LUN 位於不同節點上的不同磁碟區。</block>
  <block id="81d5c73c98489729a8f91afe4936dbd2" category="list-text">* InterSVM 。 * 資料由不同的 SVM 擁有。</block>
  <block id="ea9799ac312b9050a36864c98be8f73f" category="list-text">* 磁碟區間、節點間。 * 來源和目的地檔案或 LUN 位於不同節點上的不同磁碟區。</block>
  <block id="3693f5a47e6bfc0762c5b2c174e653be" category="list-text">* 叢集間。 * 從 ONTAP 9.0 開始、 ODX 也支援 SAN 環境中的叢集間 LUN 傳輸。叢集間 ODX 僅支援 SAN 通訊協定、不支援 SMB 。</block>
  <block id="8e459b300b9b5f521f0cc464bc1a7137" category="paragraph">移轉完成後、必須重新設定備份和複寫原則、以反映存放 VM 的新磁碟區。任何先前所進行的備份都無法使用。</block>
  <block id="9cabe6ff649f754acc3a863e852828e8" category="paragraph">VM 儲存設備（ HDD/VHDX ）可在下列儲存類型之間移轉：</block>
  <block id="49a63af944b72883bd718eb8c8ff01c8" category="list-text">DAS 和 SMB 共享</block>
  <block id="85fbd1c03217c7c62157aac97d16ecf9" category="list-text">DAS 和 LUN</block>
  <block id="876c6424f49d57e8be596b8caadf5a61" category="list-text">SMB 共享區和 LUN</block>
  <block id="1518cb86dc78f6083ed8b1d292b87ed8" category="list-text">在 LUN 之間</block>
  <block id="7257cd316393b74da62868c27652c6c0" category="list-text">在 SMB 共享之間</block>
  <block id="17785c3ef4bbda06e9db9c15908dc0c6" category="inline-image-macro">Hyper-V 儲存即時移轉、寬度 = 339 、高度 = 352</block>
  <block id="eccf932baf8f6019c69035ea09e26c2c" category="paragraph"><block ref="eccf932baf8f6019c69035ea09e26c2c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="319572d5872182625e2834b8615517f2" category="inline-link-macro">附錄 E ：部署 Hyper-V 儲存即時移轉</block>
  <block id="04a136595cb35e5c42e3ea764e9cd259" category="paragraph">如需部署儲存即時移轉的相關資訊、請參閱 <block ref="e0d213bcf75379722df0c1b3af5063a2" category="inline-link-macro-rx"></block>。</block>
  <block id="86174aa4d77b1853f72b6e1a6f32c753" category="paragraph">Hyper-V 複本會將 Hyper-V VM 從主要站台複寫到次要站台上的複本 VM 、以非同步方式為 VM 提供災難恢復。主站台上的 Hyper-V 伺服器稱為主伺服器；次要站台上接收複寫 VM 的 Hyper-V 伺服器稱為複本伺服器。下圖顯示 Hyper-V 複本範例案例。您可以在屬於容錯移轉叢集一部分的 Hyper-V 伺服器之間、或是在不屬於任何叢集的單獨 Hyper-V 伺服器之間、使用 Hyper-V 複本來處理 VM 。</block>
  <block id="28e90920ae557bd81a8056f93fb4b0ee" category="inline-image-macro">Hyper-V 複本、寬度 = 624 、高度 = 201</block>
  <block id="4fc821418df9e4488323cc70692d5083" category="paragraph"><block ref="4fc821418df9e4488323cc70692d5083" category="inline-image-macro-rx" type="image"></block></block>
  <block id="8c340dc334134096f68b880b42a8692c" category="section-title">複寫</block>
  <block id="b9bce4677e5b3ea1c310fddca6123c9f" category="paragraph">在主伺服器上為 VM 啟用 Hyper-V 複本之後、初始複寫會在複本伺服器上建立相同的 VM 。初始複寫之後、 Hyper-V 複本會維護 VM VHD 的記錄檔。根據複寫頻率、以相反順序將記錄檔重新播放至複本 VHD 。此記錄和反向順序的使用可確保以非同步方式儲存和複寫最新的變更。如果複寫未與預期頻率一致、就會發出警示。</block>
  <block id="ec9fc8b78968b1d0daadf7598a4e2ab6" category="paragraph">Hyper-V 複本支援延伸複寫、可在其中設定次要複本伺服器以進行災難恢復。您可以設定次要複本伺服器、讓複本伺服器接收複本 VM 上的變更。在延伸複寫案例中、主要伺服器上主要 VM 上的變更會複寫到複本伺服器。然後將變更複寫到擴充複本伺服器。只有當主要和複本伺服器都停機時、 VM 才能容錯移轉至延伸複本伺服器。</block>
  <block id="a3f36244dba1d116dac91134dda3b9db" category="paragraph">容錯移轉不是自動的；程序必須手動觸發。容錯移轉有三種類型：</block>
  <block id="f8487dcb10cf762a4d3f28da4635bd2a" category="list-text">* 測試容錯移轉。 * 此類型用於驗證複本 VM 是否能在複本伺服器上成功啟動、並在複本 VM 上啟動。此程序會在容錯移轉期間建立重複的測試 VM 、不會影響正常的正式作業複寫。</block>
  <block id="09f4056fddf2108616fe7bf3194540ba" category="list-text">* 計畫性容錯移轉。 * 此類型用於在計畫性停機或預期停機期間容錯移轉 VM 。此程序是在主 VM 上啟動、必須在主伺服器上關閉、然後才會執行規劃的容錯移轉。機器容錯移轉後、 Hyper-V 複本會在複本伺服器上啟動複本 VM 。</block>
  <block id="0ad8df7e141c378e7ad1debc5721cecf" category="list-text">* 非計畫性容錯移轉。 * 發生非預期的中斷時、可使用此類型。此程序是在複本 VM 上啟動、只有在主機器故障時才應使用。</block>
  <block id="d8afbc541b39d23648c823057cffe3a5" category="section-title">恢復</block>
  <block id="53b169078c7c6ecee01802b49b675c54" category="paragraph">當您設定虛擬機器的複寫時、可以指定恢復點的數量。恢復點代表可從複寫機器恢復資料的時間點。</block>
  <block id="31e96602ee944674a6ee07052bc6552a" category="inline-link-macro">在叢集環境之外部署 Hyper-V 複本</block>
  <block id="fd09d6344b235cdd2863e5027a2716e8" category="list-text">如需在叢集環境外部署 Hyper-V 複本的相關資訊、請參閱<block ref="376f647d5b86bfed7dfffbd7c50e7d1e" category="inline-link-macro-rx"></block>。」</block>
  <block id="23b6fa788d78e992f84931ddd3cef629" category="inline-link-macro">在叢集環境中部署 Hyper-V 複本</block>
  <block id="a3538f75015c27ee42ac1f1c0b535a61" category="list-text">如需在叢集環境中部署 Hyper-V 複本的相關資訊、請參閱<block ref="e81baea973ee37d0bb61473f872cfb84" category="inline-link-macro-rx"></block>。」</block>
  <block id="57a0eb5139789611b6b213a5f3fa5412" category="summary">本附錄說明如何在 NetApp 儲存設備上部署高可用度 Hyper-V 叢集。</block>
  <block id="e286734bc8843e9f46f2812455917ea5" category="paragraph">本附錄說明如何部署 Hyper-V 叢集。</block>
  <block id="fa0edb5816386e7e049e5c77d9cdb367" category="list-text">至少有兩部 Hyper-V 伺服器彼此連線。</block>
  <block id="a7bad6853c4b367ee245a88ab3195af0" category="list-text">每部 Hyper-V 伺服器上至少設定一個虛擬交換器。</block>
  <block id="ebdc83ef4c8d2993b67ae667bcb0cd50" category="list-text">容錯移轉叢集功能會在每部 Hyper-V 伺服器上啟用。</block>
  <block id="65e98c7fa4c69ce7bd0d182ede13991a" category="list-text">SMB 共享區或 CSV 是用來儲存 VM 及其磁碟以用於 Hyper-V 叢集的共用儲存區。</block>
  <block id="22f4b86bcfebce25bb61ddd3ee8d6f7f" category="list-text">不同叢集之間不應共用儲存設備。每個叢集只應有一個 CSV/CIFS 共用。</block>
  <block id="c2377be670723e586c1324a4a12607a5" category="list-text">如果 SMB 共用是用作共用儲存設備、則必須設定 SMB 共用的權限、以授予叢集中所有 Hyper-V 伺服器的電腦帳戶存取權。</block>
  <block id="ea355214fd4bc7c57f471bd92918879b" category="section-title">部署</block>
  <block id="3627e168149dcf185918371a7adb5680" category="list-text">以系統管理員群組成員的身分登入其中一個 Windows Hyper-V 伺服器。</block>
  <block id="0cc618f3a272a1fc35b193fc6efa1122" category="list-text">啓動 Server Manager**</block>
  <block id="f30124a5c887cea53cc6397d6c9e40a6" category="list-text">按一下 [ 工具 ] 區段中的 [ 容錯移轉叢集管理員 ] 。</block>
  <block id="54be8be618f1803d7fc1579e2fad9a6c" category="list-text">按一下「從動作建立叢集」功能表。</block>
  <block id="6bcb4b141d153c7cee9fc6b2633a703c" category="list-text">提供屬於此叢集一部分的 Hyper-V 伺服器詳細資料。</block>
  <block id="58ee4cb30b6b0dd4665be3c60c65e0f1" category="list-text">驗證叢集組態。當系統提示您進行叢集組態驗證時、請選取是、然後選取所需的測試、以驗證 Hyper-V 伺服器是否已通過先決條件、以成為叢集的一部分。</block>
  <block id="8a2ec0e7f4a4ecb848794b1aba47839b" category="list-text">驗證成功後、即會啟動「建立叢集」精靈。在精靈中、提供新叢集的叢集名稱和叢集 IP 位址。接著會為 Hyper-V 伺服器建立新的容錯移轉叢集。</block>
  <block id="ce73c2e33e5d228466b28690400c8c14" category="list-text">按一下容錯移轉叢集管理程式中新建立的叢集、然後加以管理。</block>
  <block id="904aa93ec80c2a5ca93ed8ace0e52220" category="list-text">定義要使用的叢集共用儲存設備。可以是 SMB 共享或 CSV 。</block>
  <block id="d69f1a0923232e84331ec6d30315124c" category="list-text">將 SMB 共用當成共用儲存設備不需要特殊步驟。</block>
  <block id="3b045123cc5f216c3aa18614a4cabf45" category="list-text">在 NetApp 儲存控制器上設定 CIFS 共用。若要這麼做、請參閱「<block ref="f9d723fa339e7968f40a99719593036c" category="inline-link-macro-rx"></block>」。</block>
  <block id="c0edb31f94845e5a1f67d2f79db4408f" category="list-text">若要使用 CSV 做為共用儲存設備、請完成下列步驟：</block>
  <block id="dfd86a662700832b7931201c3abdf13f" category="list-text">在 NetApp 儲存控制器上設定 LUN 。若要這麼做、請參閱「在 SAN 環境中進行資源配置」一節。</block>
  <block id="49873862ecc43076ac3a4de327f3efdb" category="list-text">請確定容錯移轉叢集中的所有 Hyper-V 伺服器都能看到 NetApp LUN 。若要為容錯移轉叢集的所有 Hyper-V 伺服器執行此動作、請確定其啟動器已新增至 NetApp 儲存設備上的啟動器群組。此外、請務必探索 LUN 、並確定已啟用 MPIO 。</block>
  <block id="4fe4609b22418e84ea85667368c2e742" category="list-text">在叢集中的任一 Hyper-V 伺服器上、完成下列步驟：</block>
  <block id="de824a62ee353b5481bb4eeb5c13d899" category="list-text">將 LUN 連線、初始化磁碟、建立新的簡易磁碟區、並使用 NTFS 或 Refs 格式化。</block>
  <block id="340f3a4d7fad2c45eadfe69d5b56ce38" category="list-text">在容錯移轉叢集管理程式中、展開叢集、展開儲存、在磁碟上按一下滑鼠右鍵、然後按一下新增磁碟。這樣會開啟將 LUN 顯示為磁碟的「將磁碟新增至叢集」精靈。按一下「確定」、將 LUN 新增為磁碟。</block>
  <block id="c473a447596255e12e2e772012c42b17" category="list-text">CSV 可從容錯移轉叢集的所有 Hyper-V 伺服器同時顯示、並可從其本機位置 C ： \ClusterStorage\ 存取。</block>
  <block id="b735c11dd95d1b42d173adb43b3a1df2" category="list-text">建立高可用度 VM ：</block>
  <block id="27f977a1c170f87899be67daf203a268" category="list-text">在容錯移轉叢集管理程式中、選取並展開先前建立的叢集。</block>
  <block id="569f3bea800216a760ac935540b72c1e" category="list-text">按一下 [ 角色 ] ，然後按一下 [ 動作 ] 中的 [ 虛擬機器 ]按一下 [ 新增虛擬機器 ] 。</block>
  <block id="4380a9c5c56776fad0f4492a0d3c63f5" category="list-text">從 VM 應位於的叢集中選取節點。</block>
  <block id="a8be7e73ae88a070ad15a4a6f6d515fe" category="list-text">在虛擬機器建立精靈中、提供共用儲存設備（ SMB 共享區或 CSV ）作為儲存 VM 及其磁碟的路徑。</block>
  <block id="9da4e10b0da989c65844cd59ed2a0991" category="list-text">使用 Hyper-V Manager 將共享儲存設備（ SMB 共享或 CSV ）設定為儲存 Hyper-V 伺服器的 VM 及其磁碟的預設路徑。</block>
  <block id="064cd683bf50cb65205de6b9298201b3" category="list-text">測試非計畫性容錯移轉停止擁有 VM 的伺服器上的叢集服務。</block>
  <block id="c7bfaead2ee1aea320b1d91da7ba31d7" category="summary">瞭解 NetApp 儲存設備和 Windows Server 環境</block>
  <block id="5c8c98e7f403562b754941b4d0c17f65" category="paragraph">如中所述 <block ref="ba92ae7cf3bb4a058d2b231c16067714" category="inline-link-macro-rx"></block>NetApp 儲存控制器提供真正統一化的架構、支援檔案、區塊和物件傳輸協定。這包括 SMB/CIFS 、 NFS 、 NVMe / TCP 、 NVMe / FC 、 iSCSI 、 FC （ FCP ）和 S3 、可建立統一化的用戶端和主機存取。同一個儲存控制器可以同時以 SAN LUN 的形式提供區塊儲存服務、並以 NFS 和 SMB/CIFS 的形式提供檔案服務。ONTAP 也可做為 All SAN Array （ ASA ）使用、透過 iSCSI 和 FCP 的對稱雙主動式多重路徑功能來最佳化主機存取、而統一化的 ONTAP 系統則使用非對稱雙主動式多重路徑功能。在這兩種模式中、 ONTAP 都會使用 ANA 來管理 NVMe over Fabrics （ NVMe of ）多重路徑。</block>
  <block id="b39d47dbcb48e2064ea0978dea0793ae" category="list-text">以持續可用的 SMB 3.0 共享區代管的 VM</block>
  <block id="be1d5dd432dd053b97f14401fc060813" category="list-text">在 iSCSI 或 FC 上執行的叢集共用磁碟區（ CSV ） LUN 上託管的 VM</block>
  <block id="fc27a7625c9ffb2fe9dd539f1960c978" category="list-text">SMB 3.0 共用上的 SQL Server 資料庫</block>
  <block id="658f98073361780ad39f8c0d45eca2f8" category="list-text">NVMe 、 iSCSI 或 FC 上的 SQL Server 資料庫</block>
  <block id="d2ed21657f98def30346884514f11cce" category="list-text">其他應用程式工作負載</block>
  <block id="b76d8ce5a4b5758745257d0223494701" category="section-title">ONTAP 資料管理</block>
  <block id="37b74b1418c82d2f0f3a093c4da8e7de" category="paragraph">ONTAP 是在 NetApp 儲存控制器上執行的管理軟體。NetApp 儲存控制器稱為節點、是一種硬體裝置、內含處理器、 RAM 和 NVRAM 。節點可以連接至 SATA 、 SAS 或 SSD 磁碟機、或是這些磁碟機的組合。</block>
  <block id="4472647bb1219b68f4b76e737a20ce52" category="inline-image-macro">Windows Server 環境中的 NetApp 儲存部署、寬度 =624 、高度 =479</block>
  <block id="79ea3c938053f84aab6e3d9a963056f6" category="paragraph"><block ref="79ea3c938053f84aab6e3d9a963056f6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="7df39ad25b0e96b5a09cafef15c90e83" category="paragraph">ONTAP SVM 是一種邏輯儲存伺服器、可從一或多個邏輯介面（生命體）提供 LUN 和 / 或 NAS 命名空間的資料存取。因此 SVM 是儲存區段的基本單元、可在 ONTAP 中實現安全的多租戶共享。每個 SVM 都設定為擁有儲存磁碟區、這些磁碟區是從指派給實體乙太網路或 FC 目標連接埠的實體集合和邏輯介面（生命體）來配置。</block>
  <block id="ded35f53d6a4c12f9aa23622a273290c" category="paragraph">邏輯磁碟（ LUN ）或 CIFS 共用是在 SVM 的磁碟區內建立、並對應至 Windows 主機和叢集、以提供儲存空間、如下圖所示。SVM 不受節點限制、並以叢集為基礎；它們可以使用實體資源、例如叢集中任何位置的磁碟區或網路連接埠。</block>
  <block id="66bfba6c82925242c27d2f07403b627e" category="inline-image-macro">ONTAP 儲存虛擬機器、寬度 = 572 、高度 = 443</block>
  <block id="9bcb5e161ae4c106ccd0f2dc96989097" category="paragraph"><block ref="9bcb5e161ae4c106ccd0f2dc96989097" category="inline-image-macro-rx" type="image"></block></block>
  <block id="8f64c369fcdc9c990f5540ce53430671" category="paragraph">儲存設備可同時在 SAN 和 NAS 環境中佈建至 Windows Server 。在 SAN 環境中、儲存設備是以 NetApp 磁碟區上 LUN 的磁碟形式提供、作為區塊儲存設備。在 NAS 環境中、儲存設備會在 NetApp 磁碟區上以 CIFS/SMB 共用的形式提供、做為檔案儲存設備。這些磁碟和共用可以在 Windows Server 中套用、如下所示：</block>
  <block id="8572daf67b8cf4929b8a104909d42a03" category="list-text">適用於 Windows Server 主機的儲存設備、適用於應用程式工作負載</block>
  <block id="460622219d2e0a7fe2d7339d37894127" category="list-text">儲存儲存設備：奈米伺服器和容器</block>
  <block id="24148b9d626dc3494e0f1a07f5ddf180" category="list-text">用於儲存 VM 的個別 Hyper-V 主機儲存設備</block>
  <block id="c9d2a95802a3dc0a7c1033928d3cfc3f" category="list-text">Hyper-V 叢集的共用儲存設備、以 CSV 的形式儲存 VM</block>
  <block id="76c319d8818e93b50538dff2f4427cbc" category="list-text">SQL Server 資料庫的儲存設備</block>
  <block id="13a4fb282282699692756c149d94bbbe" category="paragraph">若要從 Windows Server 2016 連線、設定及管理 NetApp 儲存設備、請使用下列其中一種方法：</block>
  <block id="81ef8774b45c60d7387b0e91d9c4eb05" category="list-text">* 安全 Shell （ SSH ）。 * 使用 Windows Server 上的任何 SSH 用戶端來執行 NetApp CLI 命令。</block>
  <block id="935df6062271011aad64300fe0f8a6c7" category="list-text">* System Manager 。 * 這是 NetApp 的 GUI 型管理產品。</block>
  <block id="85c7991eb4ed1078ecb54aacffe3a3a2" category="list-text">* NetApp PowerShell Toolkit* 。這是 NetApp PowerShell 工具套件、用於自動化及實作自訂指令碼和工作流程。</block>
  <block id="1fb25b443082bb79703b1237630cd9b6" category="section-title">NetApp PowerShell 工具套件</block>
  <block id="a5038d870bfecae7a8fb1fb0d8ba892b" category="list-text">NetApp 不支援 Windows Server 儲存空間。儲存空間僅用於 JBOD （只有一堆磁碟）、不適用於任何類型的 RAID （直接附加儲存 [DAS] 或 SAN ）。</block>
  <block id="b37ae3efea13417cff3fdb198db41274" category="list-text">ONTAP 不支援 Windows Server 中的叢集式儲存集區。</block>
  <block id="436593f3429fec64588705fe44025823" category="list-text">NetApp 支援共享虛擬硬碟格式（ VHDX ）、用於 Windows SAN 環境中的來賓叢集。</block>
  <block id="a3a862b96d666cb7005617313f703378" category="list-text">Windows Server 不支援使用 iSCSI 或 FC LUN 建立儲存池。</block>
  <block id="570d38aae09bbf84ba37f9219909a7cb" category="list-text">如需 NetApp PowerShell 工具組的詳細資訊、請參閱<block ref="12f72d9ce1eab5b7cd58718fecdd145c" category="inline-link-rx"></block>。</block>
  <block id="699f0a44719fb3de5404046fc6caa8af" category="inline-link">TR-4475 ： NetApp PowerShell 工具套件最佳實務指南</block>
  <block id="532d077f114744273b1a7cd2a4794077" category="list-text">如需 NetApp PowerShell 工具組最佳實務做法的相關資訊、請參閱<block ref="87b47631a9123c9d2a382039a9ba503e" category="inline-link-rx"></block>。</block>
  <block id="64f3248fbae79dd41841377bf7dd37c6" category="paragraph">乙太網路可廣泛分為下列群組：</block>
  <block id="0047d4a23ffec6d4afe912d0a2598e58" category="list-text">虛擬機器的用戶端網路</block>
  <block id="d6cf6da705ce58c7b649fea1cd43c470" category="list-text">多個儲存網路（連接至儲存系統的 iSCSI 或 SMB ）</block>
  <block id="0d8658721aaab8eb43f9b6d72283b8f8" category="list-text">叢集通訊網路（叢集節點之間的活動訊號和其他通訊）</block>
  <block id="338c97ec16c135df1c972ba5b92db129" category="list-text">管理網路（用於監控系統並進行疑難排解）</block>
  <block id="7b6753ef35b59e8866faf1b43b213520" category="list-text">移轉網路（用於主機即時移轉）</block>
  <block id="0f31fc2f15105bd45773e0fe5a33814a" category="list-text">VM 複寫（ Hyper-V 複本）</block>
  <block id="11ef3cd9dc7173f009417493a7a51f57" category="list-text">NetApp 建議您針對上述各項功能、使用專用的實體連接埠來隔離網路並提高效能。</block>
  <block id="84f729d0d6ae07e1ea7697e418337328" category="list-text">針對上述每項網路需求（儲存需求除外）、可彙總多個實體網路連接埠以分散負載或提供容錯能力。</block>
  <block id="89831505b6fb0eb3bfb78852c3e8838a" category="list-text">NetApp 建議在 Hyper-V 主機上建立專用的虛擬交換器、以便在 VM 內建立來賓儲存連線。</block>
  <block id="301b0a1048a669cb6b56215ce25f83d2" category="list-text">請確定 Hyper-V 主機和來賓 iSCSI 資料路徑使用不同的實體連接埠和虛擬交換器、以確保來賓與主機之間的安全隔離。</block>
  <block id="38d14a6f7d54295d21bfb890bbfac145" category="list-text">NetApp 建議避免 iSCSI NIC 的 NIC 群組。</block>
  <block id="3b5eab23ccdc37978e26fa584647f2f5" category="list-text">NetApp 建議使用主機上設定的 ONTAP 多重路徑輸入 / 輸出（ MPIO ）來進行儲存。</block>
  <block id="6395caf6c767d5f8026b684721c1e27e" category="list-text">如果使用來賓 iSCSI 啟動器、 NetApp 建議在來賓 VM 中使用 MPIO 。如果您使用直接移轉磁碟、則必須避免在客體內使用 MPIO 。在這種情況下、在主機上安裝 MPIO 就足夠了。</block>
  <block id="55892ded4e0eac09cd2bd256ea8e4f49" category="list-text">NetApp 建議不要將 QoS 原則套用至指派給儲存網路的虛擬交換器。</block>
  <block id="9e33949565ff57eed3e484a27adca687" category="list-text">NetApp 建議不要在實體 NIC 上使用自動私有 IP 位址（ APIPA ）、因為 APIPA 不可路由且未在 DNS 中登錄。</block>
  <block id="b06f6cf7b5c4e8ac8117fe6238a15184" category="list-text">NetApp 建議為 CSV 、 iSCSI 和即時移轉網路開啟巨型框架、以提高處理量並縮短 CPU 週期。</block>
  <block id="d34fac956ae63cd93b204c541399ec3f" category="list-text">NetApp 建議取消勾選允許管理作業系統共用 Hyper-V 虛擬交換器的此網路介面卡選項、以建立虛擬機器專用的網路。</block>
  <block id="0d3e51fc3c7ecb31cb6dcf3ea104060c" category="list-text">NetApp 建議建立備援網路路徑（多個交換器）、以進行即時移轉、並建立 iSCSI 網路、以提供恢復能力和 QoS 。</block>
  <block id="72a46482f366b350b6b0215baa631137" category="summary">Microsoft Windows 和 Hyper-V 的其他資源</block>
  <block id="4bb047f8c530785002e490ef17fa725e" category="doc">何處可找到其他資訊</block>
  <block id="0650b34324cf33e3bf1ba6d5db9aa14c" category="list-text">Windows Server 上 Hyper-V 的新功能 +
<block ref="8508224d602483e88bde8402b5d1f2d1" category="inline-link-rx"></block></block>
  <block id="1139a59d4aa15acd59f31d05c5a9d642" category="summary">本附錄說明如何在叢集環境外部署 Hyper-V 複本。</block>
  <block id="be9cfe5b3b6e5354686be0cb736fe70d" category="list-text">您需要位於相同或不同地理位置的獨立 Hyper-V 伺服器、作為主要和複本伺服器。</block>
  <block id="427aef80e259ae74b835c2b646e8fba8" category="list-text">如果使用不同的站台、則必須設定每個站台的防火牆、以允許主要伺服器和複本伺服器之間的通訊。</block>
  <block id="3ac92c1d06a47463c6ea9f2c4289a625" category="list-text">複本伺服器必須有足夠的空間來儲存複寫的工作負載。</block>
  <block id="6db575d6d23958eefd722c2559c2ae2b" category="list-text">設定複本伺服器。</block>
  <block id="f348eb2699776a23b340068fa13ba378" category="list-text">為了讓傳入的防火牆規則允許傳入的複寫流量、請執行下列 PowerShell Cmdlet ：</block>
  <block id="b3741a0bf4f272b05520af3145ce6b20" category="list-text">按一下「動作」中的「 Hyper-V 設定」。</block>
  <block id="0b81c69f5b40344714e859c333f7e46d" category="list-text">按一下 [ 複寫組態 ] ，然後選取 [ 將此電腦啟用為複本伺服器 ] 。</block>
  <block id="23e173753ad1fc5a192335afcd91aaa2" category="list-text">在驗證和連接埠區段中、選取驗證方法和連接埠。</block>
  <block id="c67571ac7fd00493d3ca7147b7756914" category="list-text">在 [ 授權與儲存 ] 區段中，指定儲存複寫 VM 和檔案的位置。</block>
  <block id="c6f470c780ac40391a73366709e36fae" category="list-text">在主伺服器上啟用 VM 複寫。VM 複寫是以每個 VM 為基礎啟用、而非針對整個 Hyper-V 伺服器。</block>
  <block id="84f81856434a0c817bfd8ec7ba575d63" category="list-text">在 Hyper-V Manager 中、以滑鼠右鍵按一下虛擬機器、然後按一下「啟用複寫」以開啟「啟用複寫」精靈。</block>
  <block id="bb27dca619d145c6538ad523a5c5aec7" category="list-text">提供必須複寫 VM 的複本伺服器名稱。</block>
  <block id="368e47c642802a224da6a1e9196c2345" category="list-text">提供驗證類型和複本伺服器連接埠、該伺服器連接埠已設定為在複本伺服器上接收複寫流量。</block>
  <block id="df839b9a847de722b03fb6f8db4abd3d" category="list-text">選取要複寫的 VHD 。</block>
  <block id="7e2b2defa62bab724dad332e0efe93d4" category="list-text">選擇將變更傳送至複本伺服器的頻率（持續時間）。</block>
  <block id="f1358329d5a84d751f47c4d4e4882286" category="list-text">設定還原點以指定複本伺服器上要維護的還原點數目。</block>
  <block id="13bb9737452c217970585237bf9a3c67" category="list-text">選擇初始複寫方法、指定將 VM 資料初始複本傳輸到複本伺服器的方法。</block>
  <block id="e7773df7e8bec8a84ededaaba6cc3b5c" category="list-text">檢閱摘要、然後按一下「完成」。</block>
  <block id="eaa408dd6135876f9368b7e9e8447340" category="list-text">此程序會在複本伺服器上建立 VM 複本。</block>
  <block id="c6c9686c38a42b00345f77c5ddbe044a" category="list-text">執行測試容錯移轉、確保複本 VM 在複本伺服器上正常運作。測試會在複本伺服器上建立一個暫存 VM 。</block>
  <block id="4b07a5223e241d6b4d7935c2282616a5" category="list-text">登入複本伺服器。</block>
  <block id="baaaeb9b824a8922645198d46a10e27a" category="list-text">在 Hyper-V Manager 中、以滑鼠右鍵按一下複本 VM 、按一下複寫、然後按一下測試容錯移轉。</block>
  <block id="b9950331695e861c821d48077fe8b1f1" category="list-text">選擇要使用的恢復點。</block>
  <block id="b1d034cdaa7ef0d2bc761b948c78838a" category="list-text">此程序會建立名稱相同的 VM 、並附加 -Test 。</block>
  <block id="8c95c5ef4d5593fe860313c283fab784" category="list-text">驗證虛擬機器、確保一切正常運作。</block>
  <block id="e5c73308bdacf8978516ccda5462e80a" category="list-text">容錯移轉之後、如果您為複本測試 VM 選取停止測試容錯移轉、則會刪除該虛擬機器。</block>
  <block id="c4eacda4a6022cafe1bfc0d735075dce" category="list-text">執行計畫性容錯移轉、將主要 VM 上的最新變更複寫到複本 VM 。</block>
  <block id="7c3c0f256f21e1f117a98a5afa47dd56" category="list-text">登入主要伺服器。</block>
  <block id="2d6fd035cbd8062dcc29935ff448420e" category="list-text">關閉要容錯移轉的 VM 。</block>
  <block id="582c3456f1d3f75fd04a3dfcdb20c132" category="list-text">在 Hyper-V Manager 中、以滑鼠右鍵按一下關閉的 VM 、按一下「複寫」、然後按一下「規劃容錯移轉」。</block>
  <block id="4ed0c56504eba0632689dfc8056e3c49" category="list-text">按一下容錯移轉、將最新的 VM 變更傳輸至複本伺服器。</block>
  <block id="f490046b13ec9105a4adb8f885b5688f" category="list-text">在主 VM 故障時執行非計畫性容錯移轉。</block>
  <block id="c01438bcded7cda6d1ee326fa268f93c" category="list-text">在 Hyper-V Manager 中、以滑鼠右鍵按一下複本 VM 、按一下複寫、然後按一下容錯移轉。</block>
  <block id="94faab2d3840f3d8320e20ad4a90e6cd" category="list-text">按一下「容錯移轉」以容錯移轉 VM 。</block>
  <block id="4be45953e45cfa5fc987ba108c1e5793" category="summary">本附錄說明如何在叢集式環境中部署即時移轉。</block>
  <block id="388b92a1de3321595dcfbdc1c67ce749" category="paragraph">若要在叢集環境中使用即時移轉、請完成下列步驟：</block>
  <block id="b66a6c742469f1d08a2d11bcf4f211ff" category="list-text">在容錯移轉叢集管理程式中、選取並展開叢集。如果叢集不可見、請按一下容錯移轉叢集管理程式、按一下連線至叢集、然後提供叢集名稱。</block>
  <block id="e3883376513ba0aeb2f3d190d4e0377d" category="list-text">按一下角色、其中會列出叢集中所有可用的 VM 。</block>
  <block id="e164db40505184b94012bbbd4aa4c1a2" category="list-text">在虛擬機器上按一下滑鼠右鍵、然後按一下「移動」。這樣做有三個選項：</block>
  <block id="6a1e101231f8f4bcd4a75390cc0eddc2" category="list-text">* 即時移轉。 * 您可以手動選取節點、或允許叢集選取最佳節點。在即時移轉中、叢集會將 VM 所使用的記憶體從目前節點複製到另一個節點。因此、當 VM 移轉至另一個節點時、 VM 所需的記憶體和狀態資訊就已存在、可供 VM 使用。這種移轉方法幾乎是瞬間完成的、但一次只能有一個 VM 進行即時移轉。</block>
  <block id="4374953843b8a5507e79ee5145fd88cd" category="list-text">* 快速移轉。 * 您可以手動選取節點、或允許叢集選取最佳節點。在快速移轉中、叢集會將 VM 所使用的記憶體複製到儲存設備中的磁碟。因此、當 VM 移轉至另一個節點時、 VM 所需的記憶體和狀態資訊可由另一個節點從磁碟中快速讀取。透過快速移轉、可同時移轉多個 VM 。</block>
  <block id="f1321d73ebfb5a92e710d313fd53c21c" category="list-text">* 虛擬機器儲存移轉。 * 此方法使用「移動虛擬機器儲存設備」精靈。使用此精靈、您可以選取 VM 磁碟及其他要移至其他位置的檔案、這些位置可以是 CSV 或 SMB 共用。</block>
  <block id="36397d251acf4232a7e91edc7ae649c7" category="summary">ONTAP NAS 儲存設備、適用於使用 SMB3 的 Hyper-V</block>
  <block id="a06ae7fcee90c7ab1e1321d0dd8b2242" category="paragraph">ONTAP 使用 SMB3 傳輸協定、為 Hyper-V 虛擬機器提供彈性且高效能的 NAS 儲存設備。</block>
  <block id="2efbb65fec3bad963652820bc484fe59" category="paragraph">使用 CIFS 通訊協定建立 SVM 時、 CIFS 伺服器會在 Windows Active Directory 網域的 SVM 上執行。SMB 共用可用於主目錄、以及裝載 Hyper-V 和 SQL Server 工作負載。ONTAP 支援下列 SMB 3.0 功能：</block>
  <block id="55339f66c60fe6973920932c368d5b51" category="list-text">持續處理（持續可用的檔案共用）</block>
  <block id="94713d3b3a69a2fd695bffeb252007d3" category="list-text">見證協定</block>
  <block id="adb115272d11e09afdfd8702a652d626" category="list-text">叢集式用戶端容錯移轉</block>
  <block id="f5025b9fcd1b24276af8ec2da3aa4cd7" category="list-text">橫向擴充認知</block>
  <block id="81abcea6e16bc538d9843e8808b2066b" category="list-text">ODX</block>
  <block id="f4ad9c4d51155dbb3fb746c7c497c145" category="list-text">遠端 VSS</block>
  <block id="56a26f5f5f602966c3a3088fc05c7383" category="paragraph">在 Windows Server 的 NAS 環境中使用 NetApp 儲存設備有下列需求：</block>
  <block id="5f3a2953a5f6d187ed4babba3c754b95" category="list-text">ONTAP 叢集具有有效的 CIFS 授權。</block>
  <block id="2744237d602ca5ed3f1a6370ed8ebe91" category="list-text">至少會建立一個 Aggregate 。</block>
  <block id="89917a1bea2d5c48569d9ed0a9526f74" category="list-text">系統會建立一個資料邏輯介面（ LIF ）、而且必須為 CIFS 設定資料 LIF 。</block>
  <block id="87a2c188e55f400a5936550cc2f91148" category="list-text">存在 DNS 設定的 Windows Active Directory 網域伺服器和網域管理員認證。</block>
  <block id="da920c4d42bb062c9dbfd877c84ef133" category="list-text">NetApp 叢集中的每個節點都會與 Windows 網域控制站同步處理時間。</block>
  <block id="f04e0c239705cd7c6e249d3ed6991627" category="section-title">Active Directory 網域控制站</block>
  <block id="2e0bc40db7949b4af757ea11110ae955" category="paragraph">NetApp 儲存控制器可以與 Windows Server 類似、在 Active Directory 中加入及操作。在建立 SVM 期間、您可以提供網域名稱和名稱伺服器詳細資料來設定 DNS 。SVM 會嘗試搜尋 Active Directory 網域控制站、方法是以類似 Windows Server 的方式、查詢 DNS 中的 Active Directory/ 輕量型目錄存取傳輸協定（ LDAP ）伺服器。</block>
  <block id="dee2aa3e7614e2fc47c6fbbb5cd123b5" category="paragraph">若要讓 CIFS 設定正常運作、 NetApp 儲存控制器必須與 Windows 網域控制器同步時間。NetApp 建議 Windows 網域控制器與 NetApp 儲存控制器之間的時間偏差不超過五分鐘。最佳做法是設定 ONTAP 叢集的網路時間傳輸協定（ NTP ）伺服器、使其與外部時間來源同步。若要將 Windows 網域控制站設定為 NTP 伺服器、請在 ONTAP 叢集上執行下列命令：</block>
  <block id="2d60b04429a0c7bcf1dc0021d1c01046" category="list-text">在啟用 NAS 傳輸協定 CIFS 的情況下、建立新的 SVM 。您可以使用下列任一方法建立新的 SVM ：</block>
  <block id="26ed02718973e705cd69ee6e109400e0" category="list-text">系統管理員</block>
  <block id="fc05c3b0a7017fa6841b856230e365bb" category="list-text">NetApp PowerShell 工具套件</block>
  <block id="bbee3ec15cf30d6e65d6a020f6d4af1e" category="list-text">設定 CIFS 通訊協定</block>
  <block id="8de4bddcd1cd8e4614e52342eef41752" category="list-text">提供 CIFS 伺服器名稱。</block>
  <block id="a817c1f7bf7af809fd90c63b2a8e4447" category="list-text">提供必須加入 CIFS 伺服器的 Active Directory 。您必須擁有網域管理員認證、才能將 CIFS 伺服器加入 Active Directory 。</block>
  <block id="bf8cf0b24d936c2fe2e3681004650bf0" category="list-text">在每個叢集節點上指派具有生命的 SVM 。</block>
  <block id="5d77fb569194f93fead7154a8d1d1bc3" category="list-text">在 SVM 上啟動 CIFS 服務。</block>
  <block id="547edc4d2fb156c3e495e6325eae5a4a" category="list-text">從 Aggregate 建立具有 NTFS 安全樣式的磁碟區。</block>
  <block id="1418b945a2d25e4f6514fc52e9d6c7ef" category="list-text">在捲上建立 qtree （選用）。</block>
  <block id="f0bbe023b40d4d11ed83d36a68894cae" category="list-text">建立對應於 Volume 或 qtree 目錄的共用、以便從 Windows Server 存取。如果共用用於 Hyper-V 儲存設備、請選取在建立共用時啟用 Hyper-V 的持續可用性。這樣做可為檔案共用提供高可用度。</block>
  <block id="9ef47a6b1a5d19245750aa732054173a" category="list-text">編輯建立的共用、並視需要修改存取共用的權限。SMB 共用的權限必須設定為授與存取此共用之所有伺服器的電腦帳戶存取權。</block>
  <block id="053003e418b94e54d509f16e6a5ac54f" category="paragraph">若要偵測先前使用 Windows Server 建立的 CIFS 共用、請完成下列步驟：</block>
  <block id="9eb306535570bd14746bad4f0768684f" category="list-text">以系統管理員群組成員的身分登入 Windows Server 。</block>
  <block id="4cac21133029fce3cd01fb6d42f8bedb" category="list-text">請移至 run.exe 、輸入為存取共用而建立的 CIFS 共用的完整路徑。</block>
  <block id="cf48b5bae22bbcd1956b57470865f653" category="list-text">若要將共用永久對應至 Windows Server 、請以滑鼠右鍵按一下「此電腦」、按一下「對應網路磁碟機」、然後提供 CIFS 共用的路徑。</block>
  <block id="304c9374426bb10ac275b8d050d77a72" category="list-text">若要在 Windows Server 中開啟 MMC 、請按一下 Server Manager 「工具」區段中的「電腦管理」。</block>
  <block id="e731a6a9193d81f0140801ba9fb7c316" category="list-text">按一下 [ 其他動作 ] 並連線到另一台電腦，這會開啟 [ 選取電腦 ] 對話方塊。</block>
  <block id="92b70da99a18efe7530353abe1820089" category="list-text">輸入 CIFS 伺服器名稱或 SVM LIF 的 IP 位址、以連線至 CIFS 伺服器。</block>
  <block id="2d6dbdc8809506c631cd711d19c21958" category="list-text">展開「系統工具」和「共用資料夾」、以檢視和管理開啟的檔案、工作階段和共用。</block>
  <block id="3a38167e840fd7939f34e194afadd957" category="list-text">為了確認當磁碟區從一個節點移至另一個節點時、或在節點故障的情況下、不會發生停機、 NetApp 建議您在檔案共用上啟用持續可用性選項。</block>
  <block id="7a98f276625e5966a817f0783982ef86" category="list-text">為 Hyper-V over SMB 環境佈建 VM 時、 NetApp 建議您在儲存系統上啟用複本卸載功能。如此可縮短 VM 的資源配置時間。</block>
  <block id="8bb66ec4b6ef9437bd1c4c88328028b9" category="list-text">如果儲存叢集主控多個 SMB 工作負載、例如 SQL Server 、 Hyper-V 和 CIFS 伺服器、 NetApp 建議將不同的 SMB 工作負載託管在不同的 SVM 上。這項組態非常實用、因為每項工作負載都需要獨特的儲存網路和 Volume 配置。</block>
  <block id="ce424317fa59851e16cfbe4cbac13386" category="list-text">將 VM 從一個 SMB 3.0 共用移轉至另一個 SMB 3.0 共用時、 NetApp 建議在儲存系統上啟用 CIFS 複本卸載功能、以便更快移轉。</block>
  <block id="be7159d8a65544f2712c72dc0254f9be" category="list-text">為 SMB 環境佈建磁碟區時、必須以 NTFS 安全樣式建立磁碟區。</block>
  <block id="bb17c7edf27266c09bc64edcc1299db5" category="list-text">叢集中節點上的時間設定應相應設定。如果 NetApp CIFS 伺服器必須參與 Windows Active Directory 網域、請使用 NTP 。</block>
  <block id="261b72d9729025ebf489205324a048d5" category="list-text">持續處理只能在 HA 配對中的節點之間運作。</block>
  <block id="e185fb0d3a49c7a3318c954d8aa25c05" category="list-text">見證通訊協定只能在 HA 配對中的節點之間運作。</block>
  <block id="67d7fd26a92bba839041dd45a19cec56" category="list-text">只有 Hyper-V 和 SQL Server 工作負載才支援持續可用的檔案共用。</block>
  <block id="fa2e04a9f0cdcb5ad0e9f1e5ad1ada82" category="list-text">ONTAP 9.4 以上版本支援 SMB 多通道。</block>
  <block id="f357368b2f195de4f8b4463eed2bf004" category="list-text">不支援 RDMA 。</block>
  <block id="f55cb235b18bf3d499f9276cd235bfb6" category="list-text">不支援 Refs 。</block>
  <block id="fb97dc994a0600d8610daca021159b33" category="paragraph">nano 伺服器不需要額外的用戶端軟體、即可存取 NetApp 儲存控制器上 CIFS 共用區上的資料。</block>
  <block id="2be09e0be799992463b5c9542ce31dd8" category="paragraph">若要將檔案從奈米伺服器複製到 CIFS 共用、請在遠端伺服器上執行下列 Cmdlet ：</block>
  <block id="2e0d4f41db110bf64a66493b31c9b168" category="list-text"><block ref="6f88c516ba3d9ab0cd23b81fc43dd697" prefix="" category="inline-code"></block> 是 NetApp 儲存控制器上的 CIFS 共用。</block>
  <block id="5e017ad7a7df43934bccc7c27031a140" category="list-text">若要將檔案複製到奈米伺服器、請執行下列 Cmdlet ：</block>
  <block id="d153ba0c2e04ac16dcece009a842216e" category="paragraph">若要複製資料夾的完整內容、請指定資料夾名稱、並使用 Cmdlet 結尾的 -Recurse 參數。</block>
  <block id="c9f4515194bc7b2927aa17b7d9b4aa25" category="summary">如何設定 Hyper-V 儲存即時移轉</block>
  <block id="a49764977574be237e816e868b16bd9e" category="doc">部署 Hyper-V 儲存即時移轉</block>
  <block id="587db979ac1f69c45774cb09d6d6670b" category="paragraph">瞭解如何設定 Hyper-V 儲存即時移轉</block>
  <block id="0146445d75059a401441fd65f1bae1e0" category="list-text">您必須擁有獨立式 Hyper-V 伺服器、並具備獨立儲存設備（ DAS 或 LUN ）或 SMB 儲存設備（本機或其他 Hyper-V 伺服器共用）。</block>
  <block id="71c2ecf4798ba7bf00669c37826cb55b" category="inline-link-macro">在叢集環境之外進行即時移轉</block>
  <block id="4a8052295fad176b01067c772f7c7e5d" category="list-text">Hyper-V 伺服器必須設定為即時移轉。檢閱中的部署一節 <block ref="0e7f526c94c2d5b9ef424b7a8a1c9587" category="inline-link-macro-rx"></block>。</block>
  <block id="43434644e024fa3073cc9c64dba551d0" category="list-text">開啟 Hyper-V Manager 。</block>
  <block id="3999a6e17f16c7f048684f76a1a59e38" category="list-text">在 VM 上按一下滑鼠右鍵、然後按一下「移動」。</block>
  <block id="1d838d1a72e03329477d7f4024eec108" category="list-text">選取 [ 移動虛擬機器的儲存設備 ] 。</block>
  <block id="45d2d7245527e5e6e9be62e79d5a46d8" category="list-text">根據您的偏好選擇儲存設備的移動選項。</block>
  <block id="13d0ba1c0320910efd0d040f2d461527" category="list-text">提供 VM 項目的新位置。</block>
  <block id="6efadc6e298c560f1699100ac97c7378" category="list-text">檢閱摘要、然後按一下「確定」以移動 VM 的儲存設備。</block>
  <block id="b2d949a2d7f46bb1e39037d38eea14e4" category="summary">使用 Microsoft Hyper-V 實現 ONTAP 儲存效率</block>
  <block id="bd2eab4ffe0ab602b60386dfdd3ef913" category="paragraph">ONTAP 為虛擬化環境（包括 Microsoft Hyper-V ）提供領先業界的儲存效率NetApp 也提供儲存效率保證方案。</block>
  <block id="e957a0e8016b502f05bb1966b2ec6064" category="paragraph">NetApp 重複資料刪除的運作方式是在儲存磁碟區層級移除重複的區塊、只儲存一個實體複本、無論有多少個邏輯複本。因此、重複資料刪除會產生一種錯覺、認為該區塊有許多複本。重複資料刪除功能會在整個磁碟區的 4KB 區塊層級上自動移除重複的資料區塊。此程序會重新宣告儲存設備、藉由減少實體寫入磁碟的次數、以達到空間和潛在的效能節約。重複資料刪除技術可在 Hyper-V 環境中節省 70% 以上的空間。</block>
  <block id="44ee5e4157e5291ffc8bc5d1d9b5959d" category="paragraph">精簡配置是配置儲存設備的有效方法、因為儲存設備並未預先配置。換句話說、當磁碟區或 LUN 是使用精簡配置建立時、儲存系統上的空間就會被閒置。在資料寫入 LUN 或磁碟區之前、該空間會一直保持未使用狀態、而且只會使用儲存資料所需的空間。NetApp 建議在磁碟區上啟用精簡配置、並停用 LUN 保留。</block>
  <block id="8bc14f0cb78851f59e85c1d447c2c99f" category="section-title">服務品質</block>
  <block id="8649c492f1adfda9b6ab44990a1a7580" category="paragraph">在企業環境中、儲存 QoS 有助於達成下列目標：</block>
  <block id="ca944817219b4a5d2cb25894ee7bac2d" category="list-text">防止使用者工作負載彼此影響。</block>
  <block id="1d5819479882e9b1b8133fda618801e5" category="list-text">保護在 IT 即服務（ ITaaS ）環境中必須符合特定回應時間的關鍵應用程式。</block>
  <block id="b06d1116eb0db3e3c8c51d1707dfcf99" category="list-text">防止租戶彼此影響。</block>
  <block id="1d7dd784ada3e9fe62630025fa82dc80" category="list-text">新增每個租戶、避免效能降低。</block>
  <block id="3c7577ceba90e087950e69f357ce949b" category="paragraph">QoS 可讓您限制傳送至 SVM 、彈性磁碟區、 LUN 或檔案的 I/O 量。I/O 可受作業數或原始處理量的限制。</block>
  <block id="0ac164a0cdedc812bd371348407d8df2" category="paragraph">下圖說明 SVM 及其本身的 QoS 原則、可強制執行最大處理量限制。</block>
  <block id="4cd97525569a4c4f332a1fbadea31367" category="inline-image-macro">儲存虛擬機器具有自己的 QoS 原則、寬度 =319 、高度 =341</block>
  <block id="11751e265ace69b487d325224006c7e5" category="paragraph"><block ref="11751e265ace69b487d325224006c7e5" category="inline-image-macro-rx" type="image"></block></block>
  <block id="42674eda4c194d913efb361684c8b8c6" category="paragraph">若要使用自己的 QoS 原則設定 SVM 並監控原則群組、請在 ONTAP 叢集上執行下列命令：</block>
  <block id="2398ac10b8f12f8d175464af41b6cc27" category="summary">瞭解如何部署 Microsoft Windows Nano Server</block>
  <block id="60aa20a9330bfedece833eb6496e61dc" category="doc">部署奈米伺服器</block>
  <block id="751f4ae88fb7c0e83c557b594f24f467" category="paragraph">瞭解如何部署 Microsoft Windows Nano Server 。</block>
  <block id="ffd8df9c68fc3e1710ed9dc15dec9225" category="paragraph">若要將奈米伺服器部署為 Hyper-V 主機、請完成下列步驟：</block>
  <block id="e93afc2a7bab8945ac834e9f955ab2c8" category="list-text">若要建立奈米伺服器 VHD/VHDX 、請完成下列步驟：</block>
  <block id="3b515a3daeec18784951623c4ef02332" category="list-text">執行下列 PowerShell Cmdlet 、為奈米伺服器建立 VHD 做為 Hyper-V 主機。此命令會提示您輸入新 VHD 的系統管理員密碼。</block>
  <block id="2ef6d24f20fa6986cbd70ea844d3e16e" category="list-text">在下列範例中、我們建立了支援啟用容錯移轉叢集功能 Hyper-V 主機的 Nano Server VHD 。此範例是從安裝於 f:\ 的 ISO 建立 Nano Server VHD 。新建立的 VHD 會放在執行 Cmdlet 的資料夾中名為 NanoServer 的資料夾中。電腦名稱為 NanoServer 、而產生的 VHD 包含 Windows Server 的標準版本。</block>
  <block id="7f165cd40e3ab8b56d69cfdf799ebb23" category="list-text">使用 Cmdlet New-NanovServerImage 設定參數來設定 IP 位址、子網路遮罩、預設閘道、 DNS 伺服器、網域名稱、 等等。</block>
  <block id="9ba9f17628c7c8e123a1c4d0b154e1e0" category="list-text">在 VM 或實體主機中使用 VHD 將 Nano Server 部署為 Hyper-V 主機：</block>
  <block id="7482916c1c66ae16c274920ca01eda80" category="list-text">若要在虛擬機器上部署、請在 Hyper-V Manager 中建立新的虛擬機器、並使用步驟 3 中建立的 VHD 。</block>
  <block id="8a1f197a1a3903636fe46d151b55f1a4" category="list-text">若要在實體主機上部署、請將 VHD 複製到實體電腦、並將其設定為從此新 VHD 開機。首先、掛載 VHD 、執行 BCDboot e:\windows （ VHD 掛載於 E:\ 下）、卸載 VHD 、重新啟動實體電腦、然後開機至奈米伺服器。</block>
  <block id="1a2fbb26db89a11f849f5a17170449b5" category="list-text">將 Nano Server 加入網域（選用）：</block>
  <block id="fa966a71fb7e787a036cc8ae2df719c2" category="list-text">登入網域中的任何電腦、並執行下列 PowerShell Cmdlet 來建立資料 blob ：</block>
  <block id="5e83141959914643e6e309d32cb02675" category="list-text">在遠端機器上執行下列 PowerShell Cmdlet 、將 odjblob 檔案複製到奈米伺服器：</block>
  <block id="9493ca9bfebee08582b48c95f6ad1768" category="list-text">重新啟動奈米伺服器。</block>
  <block id="24d48ec9863eca883370d9e471e7dec1" category="section-title">連線至奈米伺服器</block>
  <block id="11e7dceca10309920a26c38df3c5f421" category="paragraph">若要使用 PowerShell 遠端連線至奈米伺服器、請完成下列步驟：</block>
  <block id="08d7b9e67b4bbd447b1fa3d9103976e8" category="list-text">在遠端伺服器上執行下列 Cmdlet 、將 Nano Server 新增為遠端電腦上的信任主機：</block>
  <block id="0b1f1a420d35761f550f4a9f3b9e2ecb" category="list-text">如果環境安全、而且您想要將所有主機設定為伺服器上的信任主機、請執行下列命令：</block>
  <block id="06879aa989dffc1c877a92441f72d474" category="list-text">在遠端伺服器上執行下列 Cmdlet 來啟動遠端工作階段。出現提示時、請提供 Nano 伺服器的密碼。</block>
  <block id="c5363e6f2cab660a02c04316d65097b5" category="paragraph">若要從遠端 Windows Server 使用 GUI 管理工具遠端連線至 Nano Server 、請完成下列命令：</block>
  <block id="d97c0d550aa0ad1af548a89c27d9f7ea" category="list-text">以系統管理員群組成員的身分登入 Windows Server 。</block>
  <block id="ff621b1b3a7bcf389fc4c97a55bf9505" category="list-text">若要從伺服器管理員遠端管理奈米伺服器、請在「所有伺服器」上按一下滑鼠右鍵、按一下「新增伺服器」、提供奈米伺服器的資訊並加以新增。您現在可以在伺服器清單中看到奈米伺服器。選取「奈米伺服器」、按一下滑鼠右鍵、然後開始使用提供的各種選項進行管理。</block>
  <block id="2343c80f9e6b008ea95cc15026c9c094" category="list-text">若要從遠端管理奈米伺服器上的服務、請完成下列步驟：</block>
  <block id="1430c8ff3134db821cc65ac53e010d4d" category="list-text">從 Server Manager 的「工具」區段開啟「服務」。</block>
  <block id="358fe30f1157bd64dad7a3aba4e40f94" category="list-text">以滑鼠右鍵按一下 [ 服務 ( 本機 )] 。</block>
  <block id="72fa515e487f796b536e03179e63e7db" category="list-text">按一下「連線至伺服器」</block>
  <block id="50ec7cc625733992673123275ff834d6" category="list-text">提供 Nano Server 詳細資料、以檢視及管理奈米伺服器上的服務。</block>
  <block id="f322fcdc841439901a45a176928f80e0" category="list-text">如果在奈米伺服器上啟用 Hyper-V 角色、請完成下列步驟、從 Hyper-V Manager 遠端管理：</block>
  <block id="14994643f0c569708527514d0405c1e5" category="list-text">以滑鼠右鍵按一下 Hyper-V Manager 。</block>
  <block id="8e0877f5a8a5d540837664b9de1070ca" category="list-text">按一下「連線至伺服器」、並提供奈米伺服器詳細資料。現在、您可以將奈米伺服器當作 Hyper-V 伺服器來管理、在上面建立和管理 VM 。</block>
  <block id="b2c5e9024429f1b7f8581d1747d25fd6" category="list-text">如果在奈米伺服器上啟用容錯移轉叢集角色、請完成下列步驟、從容錯移轉叢集管理程式進行遠端管理：</block>
  <block id="31b3efaeee0b35b5bde4f1353f947b93" category="list-text">從 Server Manager 的「工具」區段開啟容錯移轉叢集管理程式。</block>
  <block id="2cb85a898a7a975600dcc1bea85df531" category="list-text">使用奈米伺服器執行叢集相關作業。</block>
  <block id="2810ba8ba9d5e4319af85df66ddf2286" category="summary">使用 Hyper-V 的 ONTAP 儲存安全性</block>
  <block id="2fae32629d4ef4fc6341f1751b405e45" category="doc">安全性</block>
  <block id="6ca21561032e8c064bc8514ab2e92740" category="paragraph">ONTAP 為 Windows 作業系統提供安全的儲存系統。</block>
  <block id="615e826f5576798f024d7959ccefc794" category="section-title">Windows Defender 防毒軟體</block>
  <block id="2861d3b5f4351fd51979bf98547a050b" category="paragraph">Windows Defender 是預設在 Windows Server 上安裝及啟用的反惡意程式碼軟體。此軟體可主動保護 Windows Server 免於已知惡意軟體的侵害、並可透過 Windows Update 定期更新反惡意程式碼定義。NetApp LUN 和 SMB 共用可以使用 Windows Defender 進行掃描。</block>
  <block id="a86f08bae2bbd68aa81b64f748f3ccb8" category="inline-link">Windows Defender 概觀</block>
  <block id="4b51dd417e2be3fdc9a793c3290e3a63" category="paragraph">如需詳細資訊、請參閱<block ref="d66127569e4d44a2d0a35bc9d20b1ea7" category="inline-link-rx"></block>。</block>
  <block id="ce71fc775b37c52dabd938808de8d0f9" category="section-title">Bitlocker</block>
  <block id="8d9091beebb755bb6e68a4f04d3288f6" category="paragraph">BitLocker 磁碟機加密是一項資料保護功能、延續自 Windows Server 2012 。此加密可保護實體磁碟、 LUN 和 CSV 。</block>
  <block id="0494cad48bf6f5dd2105391f0426af1a" category="paragraph">啟用 BitLocker 之前、必須先將 CSV 設為維護模式。因此、 NetApp 建議您在 CSV 上建立 VM 之前、先做出有關以 BitLocker 為基礎的安全性的決策、以避免停機。</block>
  <block id="e2e4ca1a6c3bcca61ed5ec3ea10c90c0" category="summary">瞭解如何使用 Windows Server 容錯移轉叢集來部署及設定 Hyper-V 複本。</block>
  <block id="5674fdbee301f444dd0ca3836c682957" category="list-text">如果使用不同的站台、則必須設定每個站台的防火牆、以允許主要叢集和複本叢集之間的通訊。</block>
  <block id="6cc66ed27b17f9c380f924d533e633d6" category="list-text">複本叢集必須有足夠的空間來儲存複寫的工作負載。</block>
  <block id="ff71768b9e039ee5012c181eb29bdc39" category="list-text">在叢集的所有節點上啟用防火牆規則。在主要叢集和複本叢集中的所有節點上、以管理員權限執行下列 PowerShell Cmdlet 。</block>
  <block id="ac005fe375c3903e88ed3801a8646b0a" category="list-text">設定複本叢集。</block>
  <block id="3a57da55cdc319b0580af329b8776df6" category="list-text">使用 NetBIOS 名稱和 IP 位址來設定 Hyper-V 複本代理程式、以作為用於複本叢集的叢集連線點。</block>
  <block id="643ce0b9206c6c138b36b79315a468f2" category="list-text">開啟容錯移轉叢集管理程式。</block>
  <block id="52243c461a19e74a8e4b64d801979142" category="list-text">展開叢集、按一下「角色」、然後按一下「從動作設定角色」窗格。</block>
  <block id="f87ee1c8e6945b31ba45ee813ea7c124" category="list-text">在「選取角色」頁面中選取 Hyper-V 複本代理人。</block>
  <block id="fdbea454936dca227734d3f978334254" category="list-text">提供要用作叢集連線點的 NetBIOS 名稱和 IP 位址（用戶端存取點）。</block>
  <block id="bb8627cc57d25f02546b85f38d97ae04" category="list-text">此程序會建立 Hyper-V 複本代理程式角色。確認已成功上線。</block>
  <block id="9b11f91c42607554f82ca0c4a5739d14" category="list-text">設定複寫設定。</block>
  <block id="662af7cfca9243c46223a416df05d774" category="list-text">以滑鼠右鍵按一下在前述步驟中建立的複本代理程式、然後按一下複寫設定。</block>
  <block id="45375ee44c681920240b13f25bf53d9e" category="list-text">選取 " 將此叢集啟用為複本伺服器 " 。</block>
  <block id="88aeceb8128e3b94092a3e66ac2236db" category="list-text">在授權與儲存區段中、選取允許將 VM 複寫至此叢集的伺服器。此外、請指定儲存複寫虛擬機器的預設位置。</block>
  <block id="3d9241b7079c08f25c850a7d8ac5eebd" category="inline-link-macro">叢集環境外部的複本</block>
  <block id="3077be518a570235f65497aa5b227e9b" category="paragraph">複寫類似於一節中所述的程序 <block ref="85d27647a4d4ffb042b0371e9654ea4c" category="inline-link-macro-rx"></block>。</block>
  <block id="f8b7d7bb25e13b6b771e58da1fa078cb" category="summary">在 SAN 環境中為 Windows 和 Hyper-V 配置 ONTAP 儲存設備</block>
  <block id="24294828f9d26e2b73b5b1e0eda7a2d0" category="paragraph">ONTAP SVM 支援區塊傳輸協定 iSCSI 和 FC 。使用區塊傳輸協定 iSCSI 或 FC 建立 SVM 時、 SVM 會分別取得 iSCSI 合格名稱（ IQN ）或 FC 全球名稱（ WWN ）。此識別碼為存取 NetApp 區塊儲存設備的主機提供 SCSI 目標。</block>
  <block id="7f33f1b99e752967fce41fe3dec9f051" category="section-title">在 Windows Server 上佈建 NetApp LUN</block>
  <block id="025d3d39bb1937ffe40a12b1917e28b6" category="paragraph">在 Windows Server 的 SAN 環境中使用 NetApp 儲存設備有下列需求：</block>
  <block id="3e306b32d1acc6cfcca681b93d8d57cd" category="list-text">NetApp 叢集已設定一或多個 NetApp 儲存控制器。</block>
  <block id="3e0ea625c6f590606b5242be6455347c" category="list-text">NetApp 叢集或儲存控制器具有有效的 iSCSI 授權。</block>
  <block id="5bf7c7c03ed76506f8822badb526f0a8" category="list-text">可使用 iSCSI 和 / 或 FC 組態連接埠。</block>
  <block id="46434438c1896350bc085c1a67785198" category="list-text">FC 分區是在 FC 的 FC 交換器上執行。</block>
  <block id="1e704db41d570618bd723b41d0db395e" category="list-text">SVM 應在每個儲存控制器上、每個乙太網路或光纖通道架構都有一個 LIF 、以便使用 iSCSI 或光纖通道來提供資料。</block>
  <block id="daa700de515c2e157d34b0e12c154478" category="list-text">建立新的 SVM 、並啟用區塊傳輸協定 iSCSI 和 / 或 FC 。您可以使用下列任一方法建立新的 SVM ：</block>
  <block id="ec642b047305fbfe6db973f313768eae" category="list-text">NetApp 儲存設備上的 CLI 命令</block>
  <block id="43736124eda42b8dec979b188b9d891b" category="list-text">設定 iSCSI 和 / 或 FC 傳輸協定。</block>
  <block id="51dbb9050f89d2c5cbfda6a46bb48963" category="list-text">在 SVM 上啟動 iSCSI 和 / 或 FC 服務。</block>
  <block id="5058f1af8388633f609cadb75a75dc9d" category="paragraph">。</block>
  <block id="80967cdacf7a48c49276c07097765c46" category="list-text">使用 SVM 生命來建立 iSCSI 和 / 或 FC 連接埠集。</block>
  <block id="2d59cbd9d3169fc27e47164a0bf60c42" category="list-text">使用建立的連接埠集、為 Windows 建立 iSCSI 和 / 或 FC 啟動器群組。</block>
  <block id="b6efc79e22c0381d9fcc8c3f40ff674f" category="list-text">將啟動器新增至啟動器群組。啟動器是 iSCSI 的 IQN 、 FC 的 WWPN 。您可以執行 PowerShell Cmdlet Get-InitiatorPort 從 Windows Server 查詢。</block>
  <block id="ab39c1b30c8045ee5b2419b682b64e5c" category="paragraph">Windows Server 上 iSCSI 的 IQN 也可以在 iSCSI 啟動器內容的組態中進行檢查。</block>
  <block id="83f0120a854049de17bd46bb97e5c5fa" category="list-text">使用 Create LUN （創建 LUN ）嚮導創建 LUN ，並將其與創建的啓動器組相關聯。</block>
  <block id="186c31b1cbf72f8c54f9c6a0edca1cfe" category="paragraph">Windows Server 使用非對稱式邏輯單元存取（ ALUA ）擴充 MPIO 來判斷通往 LUN 的直接和間接路徑。雖然 SVM 擁有的每個 LIF 都接受其 LUN 的讀取 / 寫入要求、但在任何指定時刻、只有其中一個叢集節點實際擁有支援該 LUN 的磁碟。這會將通往 LUN 的可用路徑分為兩種類型、直接或間接、如下圖所示。</block>
  <block id="6b08a0deb0bef5f6429e5fb7bab4da29" category="inline-image-macro">SAN 環境中的多重路徑、寬度 = 624 、高度 = 232</block>
  <block id="e5106eaf1ca3b8ff0d6a4555b38845de" category="paragraph"><block ref="e5106eaf1ca3b8ff0d6a4555b38845de" category="inline-image-macro-rx" type="image"></block></block>
  <block id="7e6c7f4878b6fa562299bd45be030c4d" category="section-title">MPIO</block>
  <block id="90881f9a41c6c14a994dd6d410b5eae3" category="section-title">啟用 MPIO</block>
  <block id="1f4614ecf24e855792cb4a72e2ca4a86" category="paragraph">若要在 Windows Server 上啟用 MPIO 、請完成下列步驟：</block>
  <block id="bb35cb72ffe2e8dd1a02cf65b86c6cd3" category="list-text">啟動 Server Manager 。</block>
  <block id="d580309cd21fec5dd6a0fc9e095dacbe" category="list-text">按一下 [ 管理 ] 區段中的 [ 新增角色和功能 ] 。</block>
  <block id="19c0c759d805032bc93817553dbc8ef9" category="list-text">在「選取功能」頁面中、選取「多重路徑 I/O 」</block>
  <block id="63c2082592ff76eac0541130a24e7670" category="section-title">設定 MPIO</block>
  <block id="655995aa16b525227f20b4e6b55a22cf" category="paragraph">使用 iSCSI 傳輸協定時、您必須告知 Windows Server 將多重路徑支援套用至 MPIO 內容中的 iSCSI 裝置。</block>
  <block id="3cdb8cf9c5fe85e070ceba959169e83f" category="paragraph">若要在 Windows Server 上設定 MPIO 、請完成下列步驟：</block>
  <block id="bd27f39c0a288d0682b789a806d1eec7" category="list-text">以系統管理員群組成員的身分登入 Windows Server 。</block>
  <block id="a267872bfc142a132ea159cb0904930f" category="list-text">按一下 [ 工具 ] 區段中的 [MPIO ] 。</block>
  <block id="46205f4b1d4b254565cae2fd6970a3a6" category="list-text">在 Discover Multi-Paths 的 MPIO Properties （ MPIO 內容）中、選取 Add Support for iSCSI Devices （新增 iSCSI 裝置支援）、然後按一下 Add （新增）。接著會出現提示、要求您重新啟動電腦。</block>
  <block id="8c372bcf6ff4084f9e072d698d449b18" category="list-text">重新啟動 Windows Server 、查看 MPIO 內容的「 MPIO 裝置」一節中所列的 MPIO 裝置。</block>
  <block id="28f21ae88e9953ac3d80686cfb49832b" category="section-title">設定iSCSI</block>
  <block id="a12e2e6108a8b8cb032c190ebe798d79" category="paragraph">若要在 Windows Server 上偵測 iSCSI 區塊儲存、請完成下列步驟：</block>
  <block id="623f636e32ba5729ab907ad3eeeb5adb" category="list-text">按一下 [ 工具 ] 區段中的 [iSCSI 啟動器 ] 。</block>
  <block id="d259349ad54c81b69ffb57d045a7c135" category="list-text">按一下「探索」索引標籤下的「探索入口網站」。</block>
  <block id="9055f8c4230cf1268018d9b81d1c30e0" category="list-text">提供與為 SAN 傳輸協定的 NetApp 儲存設備所建立之 SVM 相關聯的生命負載 IP 位址。按一下「進階」、在「一般」索引標籤中設定資訊、然後按一下「確定」。</block>
  <block id="56fe767f1eb1a3401bb37455b6e1c804" category="list-text">iSCSI 啟動器會自動偵測 iSCSI 目標、並將其列在「目標」索引標籤中。</block>
  <block id="f6357f1aad932cb8ef210a786e72e1e9" category="list-text">在探索到的目標中選取 iSCSI 目標。按一下「連線」以開啟「連線至目標」視窗。</block>
  <block id="28d26404caba20cb28577f61c51a7e1f" category="list-text">您必須在 NetApp 儲存叢集上、從 Windows Server 主機建立多個工作階段至目標 iSCSI 生命期。若要這麼做、請完成下列步驟：</block>
  <block id="3aef6deb3c61c368bc66313781c8e351" category="list-text">在「連線至目標」視窗中、選取「啟用 MPIO 」、然後按一下「進階」。</block>
  <block id="d754cac9ca73d1113c5fa5908ca2dc97" category="list-text">在「一般」索引標籤下的「進階設定」中、選取本機介面卡做為 Microsoft iSCSI 啟動器、然後選取「啟動器 IP 」和「目標入口網站 IP 」。</block>
  <block id="fdcb9587e9c4d393ea337f94fb0e1f5f" category="list-text">您也必須使用第二個路徑進行連線。因此、請重複步驟 5 至步驟 8 、但這次請為第二個路徑選取啟動器 IP 和目標入口網站 IP 。</block>
  <block id="cb35c153406b8cdeb5963bd9a0ceb501" category="list-text">在 iSCSI Properties （ iSCSI 屬性）主窗口的 Discered Targets （已發現目標）中選擇 iSCSI 目標，然後單擊 Properties （屬性）。</block>
  <block id="2a3977b58760a2b4c9e557175a5e494e" category="list-text">「內容」視窗顯示已偵測到多個工作階段。選取工作階段、按一下「裝置」、然後按一下 MPIO 以設定負載平衡原則。會顯示為裝置設定的所有路徑、並支援所有負載平衡原則。NetApp 通常建議使用子集循環資源、而此設定是啟用 ALUA 的陣列的預設值。循環配置資源是不支援 ALUA 的主動式陣列的預設值。</block>
  <block id="7b7b8262c038321869fc17ba522bbe07" category="paragraph">若要在 Windows Server 上偵測 iSCSI 或 FC 區塊儲存、請完成下列步驟：</block>
  <block id="7554b29976a023cca6089775e3a7fd73" category="list-text">按一下「伺服器管理員」「工具」區段中的「電腦管理」。</block>
  <block id="b7e726cedaa814db32dbfe4395773cc4" category="list-text">在 [ 電腦管理 ] 中，按一下 [ 儲存設備中的磁碟管理 ] 區段，然後按一下 [ 其他動作及重新掃描磁碟 ] 。這樣做會顯示原始 iSCSI LUN 。</block>
  <block id="8fd13d2e47a19c784864b40dc7e4621f" category="list-text">按一下探索到的 LUN 、然後將其上線。然後選取使用 MBR 或 GPT 分割區初始化磁碟。提供磁碟區大小和磁碟機代號、並使用 FAT 、 FAT32 、 NTFS 或彈性檔案系統（ Refs ）格式化、以建立新的簡易磁碟區。</block>
  <block id="31ef353687ab7c0fb280206b2eba67d0" category="list-text">NetApp 建議在託管 LUN 的磁碟區上啟用精簡配置。</block>
  <block id="de065768c0f0b724b1926b25d92fdcef" category="list-text">為了避免多重路徑問題、 NetApp 建議使用所有 10Gb 工作階段或所有 1Gb 工作階段、連至指定的 LUN 。</block>
  <block id="ed4eb5407c23e138e99781446b4170d8" category="list-text">NetApp 建議您確認已在儲存系統上啟用 ALUA 。ONTAP 預設會啟用 ALUA 。</block>
  <block id="df0f70c4f2bca2f5f0216ab40982d08a" category="list-text">在 NetApp LUN 對應至的 Windows Server 主機上、在防火牆設定中、針對輸入和 iSCSI 服務（ TCP 輸出）啟用 iSCSI 服務（ TCP 輸入）。這些設定可讓 iSCSI 流量進出 Hyper-V 主機和 NetApp 控制器。</block>
  <block id="defe090ca065bb89790c1a0b2d533ad0" category="section-title">在奈米伺服器上佈建 NetApp LUN</block>
  <block id="a7b1fc24d300b03d303a4e66fd5eaf19" category="inline-link-macro">部署奈米伺服器。</block>
  <block id="c56e09ae358fe6206c8e4059eb76252b" category="paragraph">除了上一節提及的先決條件、儲存角色必須從奈米伺服器端啟用。例如、必須使用 -Storage 選項來部署奈米伺服器。若要部署奈米伺服器、請參閱「<block ref="00a4a5119b1e43564baa188fc895d5ff" category="inline-link-macro-rx"></block>"</block>
  <block id="152dbede177bc5347922fdc2b306adf2" category="paragraph">若要在奈米伺服器上配置 NetApp LUN 、請完成下列步驟：</block>
  <block id="fe02f402a046a8784957e096b11835e3" category="list-text">請依照「<block ref="60e7ef5a283935545371795472ceb490" category="inline-link-macro-rx"></block>。」</block>
  <block id="1b3c1a51c3603283ec4f7ab199a89ad3" category="list-text">若要設定 iSCSI 、請在奈米伺服器上執行下列 PowerShell Cmdlet ：</block>
  <block id="5e885af04f617a09b29600bd064e0a82" category="list-text">將啟動器新增至啟動器群組。</block>
  <block id="8a73c7acbdf9fc31a87cebe8de47a176" category="list-text">設定 MPIO 。</block>
  <block id="8e08d5639ddc5bf9f71aeea2f9df6706" category="list-text">偵測區塊儲存。</block>
  <block id="ad04ba98fa2a26c6e2a4f71314b1c4c7" category="section-title">從 SAN 開機</block>
  <block id="e29512aa6180bca309f145289f08337c" category="paragraph">實體主機（伺服器）或 Hyper-V VM 可直接從 NetApp LUN （而非其內部硬碟）啟動 Windows Server 作業系統。在從 SAN 開機的方法中、要從中開機的 OS 映像位於連接至實體主機或 VM 的 NetApp LUN 上。對於實體主機、實體主機的 HBA 會設定為使用 NetApp LUN 進行開機。對於 VM 、 NetApp LUN 會附加為用於開機的直接移轉磁碟。</block>
  <block id="2cf07cb81d5366158ac32b0d02e3bf39" category="paragraph">使用 NetApp FlexClone 技術、可立即複製具有 OS 映像的開機 LUN 、並將其附加至伺服器和 VM 、以快速提供乾淨的 OS 映像、如下圖所示。</block>
  <block id="e60c0a021a1a11ca0fd66050c818b441" category="inline-image-macro">使用 NetApp Flexclone, width=561,height=357 啟動 LUN</block>
  <block id="79f4f54e05eb2f1c2084e0542e66f182" category="paragraph"><block ref="79f4f54e05eb2f1c2084e0542e66f182" category="inline-image-macro-rx" type="image"></block></block>
  <block id="738e6a96e2bf795b59ac62d4827a779e" category="list-text">實體主機（伺服器）具有適當的 iSCSI 或 FC HBA 。</block>
  <block id="7957c1b3b06b3ca5c17a05da5e59c9ec" category="list-text">您已為支援 Windows Server 的伺服器下載適當的 HBA 裝置驅動程式。</block>
  <block id="1810f78aa22a9972644e65ac2cdad107" category="list-text">伺服器具有適當的 CD/DVD 磁碟機或虛擬媒體來插入 Windows Server ISO 映像、而且已下載 HBA 裝置驅動程式。</block>
  <block id="0af744e0f07c6b198e478b2ba83aca3a" category="list-text">NetApp iSCSI 或 FC LUN 是在 NetApp 儲存控制器上進行佈建。</block>
  <block id="30e2bee2ccadbae82d2d5aeddd5b4078" category="paragraph">若要設定實體主機從 SAN 開機、請完成下列步驟：</block>
  <block id="7d90eb9f56cbfbfe2930a2d651f51f3a" category="list-text">在伺服器 HBA 上啟用 BootBIOS 。</block>
  <block id="034cb1858f7a3762e67e18bff38aa62a" category="list-text">對於 iSCSI HBA 、請在開機 BIOS 設定中設定啟動器 IP 、 iSCSI 節點名稱和介面卡開機模式。</block>
  <block id="aeae1f3a4453e2d3e333de58d3f28c4a" category="list-text">在 NetApp 儲存控制器上建立 iSCSI 和 / 或 FC 的啟動器群組時、請將伺服器 HBA 啟動器新增至群組。伺服器的 HBA 啟動器是 FC HBA 的 WWPN 或 iSCSI HBA 的 iSCSI 節點名稱。</block>
  <block id="1ec419dd357b1eacb28eec8cfd657908" category="list-text">在 NetApp 儲存控制器上建立 LUN 、 LUN ID 為 0 、並將其與上一步建立的啟動器群組建立關聯。此 LUN 可作為開機 LUN 。</block>
  <block id="52ec2612ed3c17b60d5c662122410366" category="list-text">將 HBA 限制為指向開機 LUN 的單一路徑。在開機 LUN 上安裝 Windows Server 之後、可以新增其他路徑、以利用多重路徑功能。</block>
  <block id="0fa69ac9076a9031393e6f5d4aa909d5" category="list-text">使用 HBA 的 BootBIOS 公用程式、將 LUN 設定為開機裝置。</block>
  <block id="58347d33bbc0409dce93e92c5983619a" category="list-text">重新啟動主機並進入主機 BIOS 公用程式。</block>
  <block id="1b9013d7a416c62e05336b3791451d0d" category="list-text">設定主機 BIOS 、使開機 LUN 成為開機順序中的第一個裝置。</block>
  <block id="3472e7b0e2c4389366cf3e0f09f6376d" category="list-text">從 Windows Server ISO 啟動安裝設定。</block>
  <block id="8423662d97649ae1012d665b6594f514" category="list-text">當安裝詢問「您要在何處安裝 Windows ？」時、請按一下安裝畫面底部的「載入驅動程式」、以啟動「選取要安裝的驅動程式」頁面。提供先前下載的 HBA 裝置驅動程式路徑、並完成驅動程式的安裝。</block>
  <block id="4d0de28cb0fe5a517374a0c7fdaaff27" category="list-text">現在、之前建立的開機 LUN 必須顯示在 Windows 安裝頁面上。選取開機 LUN 以在開機 LUN 上安裝 Windows Server 、然後完成安裝。</block>
  <block id="0dbc8e7afe6136a3b34471c047b28f83" category="paragraph">若要設定從 SAN 開機以供 VM 使用、請完成下列步驟：</block>
  <block id="6af97eac32eef9a62687eac41262ae48" category="list-text">在 NetApp 儲存控制器上建立 iSCSI 或 FC 的啟動器群組時、請將 iSCSI 的 IQN 或 Hyper-V 伺服器 FC 的 WWN 新增至控制器。</block>
  <block id="c18de5a7c8558c6b9b749ea9d61336da" category="list-text">在 NetApp 儲存控制器上建立 LUN 或 LUN 複本、並將它們與上一步建立的啟動器群組建立關聯。這些 LUN 可作為 VM 的開機 LUN 。</block>
  <block id="dac33c93e3d9b5c90a34c39aa579711a" category="list-text">偵測 Hyper-V 伺服器上的 LUN 、將其上線並初始化。</block>
  <block id="441d10873880501fa764914d0bf1f044" category="list-text">使 LUN 離線。</block>
  <block id="0490d2908eb59e831010f6c50ebdf6ea" category="list-text">使用稍後在「 Connect Virtual Hard Disk 」頁面上的「 Attach a Virtual Hard Disk 」選項來建立 VM 。</block>
  <block id="2b2b3b281225dec976273bad7f4dacf0" category="list-text">將 LUN 新增為傳遞磁碟至 VM 。</block>
  <block id="ab82d3a85d9187f45c1cac0bd2922647" category="list-text">開啟 VM 設定。</block>
  <block id="d2e03542bea91031de7772d6cb0b7b13" category="list-text">按一下「 IDE 控制器 0 」、選取「硬碟」、然後按一下「新增」。選取 IDE 控制器 0 、將此磁碟設為 VM 的第一個開機裝置。</block>
  <block id="1904d13d92aac636b46007dec34eb357" category="list-text">在「硬碟」選項中選取「實體硬碟」、然後從清單中選取一個磁碟做為直接移轉磁碟。磁碟是在前述步驟中設定的 LUN 。</block>
  <block id="19e47f17e14687afa5f6c07833dbd7aa" category="list-text">在傳遞磁碟上安裝 Windows Server 。</block>
  <block id="30f837081d56a5f1605e52592a38d5f4" category="list-text">確定 LUN 已離線。否則、磁碟將無法新增為直接移轉磁碟至 VM 。</block>
  <block id="9865f9e3af02eaca8b480229a22515f4" category="list-text">當存在多個 LUN 時、請務必在磁碟管理中記下 LUN 的磁碟編號。這是必要的做法、因為列出給 VM 的磁碟會與磁碟編號一起列出。此外、將磁碟選擇為 VM 的直接移轉磁碟也會根據此磁碟編號而定。</block>
  <block id="15b11e66e58b25dffc74ff36f6529d4d" category="list-text">NetApp 建議您使用在主機上設定的 ONTAP MPIO 進行儲存。</block>
  <block id="154e178d8f948264ecf34dcfd8ad3112" category="summary">本附錄說明如何在叢集環境之外使用 Hyper-V 即時移轉</block>
  <block id="3a37015d23bf5b95b8aaeeb60e7149f6" category="paragraph">本節說明如何在叢集環境外部署 Hyper-V 即時移轉。</block>
  <block id="34076d85579973b175bda646666488f5" category="list-text">獨立式 Hyper-V 伺服器、具備獨立儲存設備或共享的 SMB 儲存設備。</block>
  <block id="6d3867adf71fde2bd2e28c3530f980e2" category="list-text">安裝在來源伺服器和目的地伺服器上的 Hyper-V 角色。</block>
  <block id="860a24a5665c79d337512cf7091c1f27" category="list-text">這兩個 Hyper-V 伺服器都屬於同一個網域或彼此信任的網域。</block>
  <block id="599b01a5eeab6af8dcd5d22203b25b3b" category="paragraph">若要在非叢集式環境中執行即時移轉、請設定來源和目的地 Hyper-V 伺服器、讓它們能夠傳送和接收即時移轉作業。在兩部 Hyper-V 伺服器上、完成下列步驟：</block>
  <block id="5c8aa736f4d71f22237d67e44338e090" category="list-text">按一下 [ 動作 ] 中的 [Hyper-V 設定 ] 。</block>
  <block id="146cc3da35b3cb4807f19e5c342f3d0b" category="list-text">按一下「即時移轉」、然後選取「啟用傳入和傳出即時移轉」。</block>
  <block id="000104d6631c201d8476c728987584e9" category="list-text">選擇是允許任何可用網路上的即時移轉流量、還是僅允許特定網路上的即時移轉流量。</block>
  <block id="bbba185068a3a5aa887f5064ee5fc3de" category="list-text">或者、您也可以從即時移轉的進階區段設定驗證傳輸協定和效能選項。</block>
  <block id="0d91ef025d958a7706b6abf25f2160a5" category="list-text">如果使用 CredSSP 做為驗證傳輸協定、請務必先從目的地 Hyper-V 伺服器登入來源 Hyper-V 伺服器、然後再移動 VM 。</block>
  <block id="4671ab6d9ed8f69134f49812ab7a7c35" category="list-text">如果使用 Kerberos 做為驗證傳輸協定、請設定受限制的委派。這樣做需要 Active Directory 網域控制站存取。若要設定委派、請完成下列步驟：</block>
  <block id="3c3a519ac45fd3a37ae321645897af94" category="list-text">以系統管理員身分登入 Active Directory 網域控制站。</block>
  <block id="15be526c72b91c88e16f64f6c832eb6b" category="list-text">按一下 [ 工具 ] 區段中的 [Active Directory 使用者和電腦 ] 。</block>
  <block id="444f95dff8ac9b4c8c6335d66d6ae4a7" category="list-text">展開網域、然後按一下「電腦」。</block>
  <block id="a07ecc7f9ab368b241540687975a30aa" category="list-text">從清單中選取來源 Hyper-V 伺服器、以滑鼠右鍵按一下該伺服器、然後按一下「內容」。</block>
  <block id="a3a23c7b6ce827c11b3cdb698108c307" category="list-text">在 [ 委派 ] 索引標籤中，選取 [ 信任這台電腦只能委派給指定的服務 ] 。</block>
  <block id="4070350eb1a20fec8173f5ee230b8566" category="list-text">選取「僅使用 Kerberos 」。</block>
  <block id="36d92877123542287dffc5912e198436" category="list-text">按一下「新增」、即可開啟「新增服務」精靈。</block>
  <block id="2a206fdec4cfdbdd63ff3dd2265bbb34" category="list-text">在 " 新增服務 " 中 , 按一下 " 使用者和電腦 ", 這會開啟 " 選取使用者或電腦 "**</block>
  <block id="6fb0c1f70349caf1f37bdb1c7b73efe4" category="list-text">提供目的地 Hyper-V 伺服器名稱、然後按一下「確定」。</block>
  <block id="261db7be66ebd6db420e928cb4b402f7" category="list-text">若要移動 VM 儲存設備、請選取 CIFS 。</block>
  <block id="f4288db12d8f66e52ec2ac189f491e82" category="list-text">若要移動 VM 、請選取 Microsoft Virtual System 移轉服務。</block>
  <block id="9149d965e2ccf728685f671fb1046ab9" category="list-text">在 [ 委派 ] 索引標籤中，按一下 [ 確定 ] 。</block>
  <block id="9bc766cbcc4911cf673963ca303576bc" category="list-text">從「電腦」資料夾中、從清單中選取目的地 Hyper-V 伺服器、然後重複此程序。在 [ 選取使用者或電腦 ] 中，提供來源 Hyper-V 伺服器名稱。</block>
  <block id="5868e6c6d4568bb2c1245c731ab1f681" category="list-text">移動 VM 。</block>
  <block id="ab102f10122268c6b0663d464d3192da" category="list-text">選擇 [ 移動虛擬機器 ] 。</block>
  <block id="8b95cb0524fdc80c99bdf8cb976556d2" category="list-text">指定虛擬機器的目的地 Hyper-V 伺服器。</block>
  <block id="25b70b154b120ba061f03c292637a9a4" category="list-text">選擇移動選項。若為共用即時移轉、請選擇僅移動虛擬機器。若為「共享無線即時移轉」、請根據您的偏好選擇其他兩個選項中的任何一個。</block>
  <block id="8c60fc97ae35b3af22d644ab2b9186e7" category="list-text">根據您的偏好、在目的地 Hyper-V 伺服器上提供虛擬機器的位置。</block>
  <block id="dd714dbbaab89194e2aefdf439089cff" category="list-text">檢閱摘要、然後按一下「確定」來移動 VM 。</block>
  <block id="8ab11353f8fda3f130084c6ff3c1f32e" category="summary">Microsoft Windows 與 Hyper-V 虛擬化與 ONTAP 概觀</block>
  <block id="e905fd86484ea1bf5b665b34fc9e24b4" category="paragraph">Microsoft Windows Server 是企業級作業系統（ OS ）、涵蓋網路、安全性、虛擬化、私有雲、混合雲、 虛擬桌面基礎架構、存取保護、資訊保護、 Web 服務、應用程式平台基礎架構、 還有更多。</block>
  <block id="16b5970810caafa8d6f89bee6e0398f2" category="admonition">* 本文件取代先前發佈的技術報告 _TR-4568 ： NetApp 部署指南與 Windows Server* 儲存最佳實務做法</block>
  <block id="dbf037f8e99a1d5b52fe58af78568561" category="list-text">支援檔案、物件和區塊傳輸協定的統一化架構。如此一來、儲存控制器就能同時做為 NAS 和 SAN 裝置、以及物件儲存區</block>
  <block id="23748de0bc860150d3c6b27a4d472042" category="list-text">All SAN Array （ ASA ）僅著重於區塊傳輸協定、並透過為連線主機新增對稱的雙主動式多重路徑功能、將 I/O 恢復時間（ IORT ）最佳化</block>
  <block id="d0114359083804284c542907b2f8cd60" category="list-text">軟體定義的統一化架構</block>
  <block id="30063e1e8c837a5b52057909e747b2d8" category="list-text">在 VMware vSphere 或 KVM 上執行的 ONTAP Select</block>
  <block id="f7d26dbdc8e2b21b211abf2157e73536" category="list-text">來自超大規模雲端供應商的第一方產品</block>
  <block id="4d82a1ec1af02725042c8c785564ee7a" category="list-text">Amazon FSX for NetApp ONTAP 產品</block>
  <block id="7450cfde7058dc5e1f7909d0280fd7ae" category="list-text">Azure NetApp Files</block>
  <block id="1215f8190533dfdf63d2224a6d88266f" category="list-text">Google Cloud NetApp Volumes</block>
  <block id="538a662f2ecbeba6af56e41386484f67" category="paragraph">Windows Server 和 ONTAP 可在大型環境中共同運作、為資料中心整合和私有雲或混合雲部署帶來巨大價值。這種組合也能有效率地提供不中斷營運的工作負載、並支援無縫擴充。</block>
  <block id="8f0442ea7c58fe8ab4000f5aaeac415b" category="paragraph">本文件適用於設計適用於 Windows Server 的 NetApp 儲存解決方案的系統與儲存架構設計師。</block>
  <block id="f6f27d1607ed17a4b610676f16f68357" category="paragraph">我們在此文件中做出下列假設：</block>
  <block id="e9d690b9eb25093e460ea369baa55496" category="inline-link">叢集管理員系統管理指南</block>
  <block id="d54e01b4234443b582b1d0cc44ce1c19" category="list-text">讀者對 NetApp 硬體與軟體解決方案有廣泛的瞭解。請參閱<block ref="87244016000a25428f0fcae2d3732d46" category="inline-link-rx"></block> 以取得詳細資料。</block>
  <block id="c501659fe58b766ec2ead9a0c974e530" category="inline-link">叢集式 Data ONTAP SAN 管理</block>
  <block id="75ac79ee68c2245f6d8b8cc32a3eae9e" category="inline-link">NAS 管理</block>
  <block id="48fa880bcded409e494bd8e2e8c64a97" category="list-text">讀取器一般瞭解區塊存取傳輸協定、例如 iSCSI 、 FC 和檔案存取傳輸協定 SMB/CIFS 。請參閱<block ref="123a6e61ead9566ba44616c8f29f1ba3" category="inline-link-rx"></block> 以取得 SAN 相關資訊。請參閱<block ref="9933d9f07fd1633df051103d1b03340e" category="inline-link-rx"></block> 以取得 CIFS/SMB 相關資訊。</block>
  <block id="02279515531a2de57bfdffa958d40813" category="list-text">讀者對 Windows Server 作業系統和 Hyper-V 有廣泛的瞭解</block>
  <block id="3eb0aeddd8b10d858bd2028c6f983308" category="summary">VMware SRM 和 ONTAP 儲存設備的最佳作業實務做法</block>
  <block id="06b2d4b91b5c9eaa8c20a1c270f95b3c" category="inline-image-macro">叢集</block>
  <block id="6c0893d9a45aaff00c1ef0daf0867ada" category="paragraph"><block ref="6c0893d9a45aaff00c1ef0daf0867ada" category="inline-image-macro-rx" type="image"></block></block>
  <block id="820b71b9a8a55fe48690a5f973c5480e" category="paragraph">採用 ONTAP Tools for VMware vSphere 的軟體工程採用下列安全開發活動：</block>
  <block id="ecdc76c84c9674a3148f3d464298469c" category="paragraph">適用於 VMware vSphere 的 ONTAP 工具在每個版本中都包含下列安全功能。</block>
  <block id="0785fa6b3221e7345916be824259dc2f" category="paragraph">搭配 ONTAP 工具使用適用於 VMware vSphere 的 SDR 時、您必須先使用外掛程式建立資料存放區、使用 vCenter 建立資料存放區叢集、然後將資料存放區新增至該叢集。建立資料存放區叢集之後、可直接從「詳細資料」頁面上的資源配置精靈、將其他資料存放區新增至資料存放區叢集。</block>
  <block id="043d75b2a25cf6f38bccaf9211c5bcc5" category="summary">本頁說明在 VMware vSphere 環境中實作 ONTAP 儲存解決方案的最佳實務做法。</block>
  <block id="760f70bd45ae12af9fa6bee90f402eeb" category="cell">請參閱中的NFS.MaxQuestue深度 <block ref="1f38ac07598dbb4b06912539aafa4211" category="inline-link-macro-rx"></block>。</block>
  <block id="647fe6e64f77a1f54f9bb61154ab2a4f" category="summary">更多 vVols 資源</block>
  <block id="852ee2d26adc87d2379ffeb9287f7642" category="inline-image-macro">適用於 VMware vSphere 9.8 vVols 的 ONTAP 工具儀表板</block>
  <block id="12947c7ceaf237f27fd206edb07cc0c1" category="paragraph"><block ref="12947c7ceaf237f27fd206edb07cc0c1" category="inline-image-macro-rx" type="image"></block></block>
  <block id="6e2c48e84c0d02dd4e236da05038bd9a" category="paragraph">支援VMFS和NFS vVol資料存放區。ONTAP將vVols與SAN資料存放區搭配使用、可帶來NFS的部分效益、例如VM層級的精細度。以下是一些最佳實務做法、您可以在中找到更多資訊 <block ref="7be3ce63e842612697a6d91b19b8afcd" category="inline-link-macro-rx"></block>：</block>
  <block id="436b5d96360742275889cb237fe2ab70" category="inline-image-macro">VVols 元件</block>
  <block id="1706c14e85f152d61bab2f65d32810a1" category="paragraph"><block ref="1706c14e85f152d61bab2f65d32810a1" category="inline-image-macro-rx" type="image"></block></block>
  <block id="43f38d7beb04aa98b65d2317c2f1659f" category="inline-image-macro">適用於 vSphere 的 ONTAP 工具</block>
  <block id="aa5b1d896aebe8a04ceac7c2a16b2cd3" category="paragraph"><block ref="aa5b1d896aebe8a04ceac7c2a16b2cd3" category="inline-image-macro-rx" type="image"></block></block>
  <block id="c4b0e8af5e898d44e394489b0c629abb" category="image-alt">VM 主機群組和關聯規則</block>
  <block id="f98dd9d12416a648450df8c99d10878a" category="summary">以下是 VMware vSphere 虛擬磁碟區（ VVols ）與 ONTAP 的概觀</block>
  <block id="674c41ba00ec77fc9d294abbba7e7b7d" category="paragraph">ONTAP 在過去二十多年來一直是 VMware vSphere 環境的領先儲存解決方案、並持續新增創新功能來簡化管理、同時降低成本。</block>
  <block id="ae7454da5e20b82b7fe67eb1ff88c923" category="admonition">本文件將先前發佈的技術報告 _TR-4400: VMware vSphere 虛擬磁碟區（ vVols ）取代為 ONTAP</block>
  <block id="ee82b7a98212a75a2397dd9c5f9b1ab4" category="paragraph">ONTAP 自 2012 年首次推出 VASA 規格以來、就一直提供支援。雖然其他 NetApp 儲存系統可能支援 VASA 、但本文件著重於目前支援的 ONTAP 9 版本。</block>
  <block id="afd715f07b1ec06fe77bf23a2d7bf185" category="paragraph">_ 如需 ONTAP 和 VMware vSphere 最佳實務做法的詳細資訊、請參閱 <block ref="5dbb4949ffa7cb97fe4eaffc517a1111" category="inline-link-macro-rx"></block>_</block>
  <block id="e88c947a5d8f4c0daec271a8595604a7" category="inline-image-macro">Active IQ Unified Manager 虛擬機器檢視</block>
  <block id="9078040b61fc8a9bd0215e8f35ff788c" category="paragraph"><block ref="9078040b61fc8a9bd0215e8f35ff788c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="0ef2f850d3f17cacfbd404bade7eed5b" category="inline-image-macro">AIQUM 擴充拓撲</block>
  <block id="75817aa97084cb93e0292a1f0549551f" category="paragraph"><block ref="75817aa97084cb93e0292a1f0549551f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4e749568996a3331860532ac7a470fdb" category="inline-image-macro">SnapMirror 關係配置</block>
  <block id="3d2c169d59a49a498b2d7e714c5a6ce2" category="paragraph"><block ref="3d2c169d59a49a498b2d7e714c5a6ce2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="706bdd824ec69e00026180eaf2801d2e" category="paragraph"><block ref="706bdd824ec69e00026180eaf2801d2e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="ba1aebb9b3c7be6b408863c12bbc2844" category="paragraph"><block ref="ba1aebb9b3c7be6b408863c12bbc2844" category="inline-image-macro-rx" type="image"></block></block>
  <block id="ea07c4b81c3f00ae8bbef49ac8562d1c" category="paragraph"><block ref="ea07c4b81c3f00ae8bbef49ac8562d1c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="12a757dd793cbe082927530094a72d26" category="inline-image-macro">陣列配對</block>
  <block id="263506cdbbc7c35e461fc5f1044b9c79" category="paragraph"><block ref="263506cdbbc7c35e461fc5f1044b9c79" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b26873df0260bdc332a7511f6823cf63" category="inline-image-macro">不支援的組態</block>
  <block id="120528a3f7d5a39fdd0d67fb0e2b94a4" category="paragraph"><block ref="120528a3f7d5a39fdd0d67fb0e2b94a4" category="inline-image-macro-rx" type="image"></block></block>
  <block id="160a69c7a04198d870353b06dbf714a9" category="paragraph"><block ref="160a69c7a04198d870353b06dbf714a9" category="inline-image-macro-rx" type="image"></block></block>
  <block id="742a3ab0c9a97e5a438c8edfb1b271d2" category="paragraph"><block ref="742a3ab0c9a97e5a438c8edfb1b271d2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="d0a05359b36f0932509cfa007b46e853" category="inline-image-macro">SnapMirror 關係串聯</block>
  <block id="2057708d80974a7573d92b3e0d8a9258" category="paragraph"><block ref="2057708d80974a7573d92b3e0d8a9258" category="inline-image-macro-rx" type="image"></block></block>
  <block id="cd92dffb12f75e4b81ad67d8668ae698" category="inline-image-macro">SnapMirror 至 SnapVault 串聯</block>
  <block id="13ece5df0d16f65585acbfb9ebad113c" category="paragraph"><block ref="13ece5df0d16f65585acbfb9ebad113c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="c74d71595c83ecb05581a89554ca8bb2" category="inline-image-macro">SnapMirror 至 SnapVault 串聯反轉</block>
  <block id="5bb35c000e450925b37eff3feca75a24" category="paragraph"><block ref="5bb35c000e450925b37eff3feca75a24" category="inline-image-macro-rx" type="image"></block></block>
  <block id="2ab367df5e87b988bc086e5ee534793e" category="summary">本頁說明使用 ONTAP 和 NFS 連線的資料存放區實作 VMware vSphere 的最佳實務做法。</block>
  <block id="0e768c8183bcbfc87718f59d9dfd61eb" category="inline-link-macro">資料存放區</block>
  <block id="622b235a9123d972c612737c81eb55a1" category="inline-link-macro">NFSv3 nConnect 功能搭配 NetApp 和 VMware</block>
  <block id="d94a770977f68948a4930f4a2edbabb9" category="image-alt">新叢集</block>
  <block id="f5c7047b98efcb8c7eef2db6ef31faf4" category="image-alt">啟用主機監控選項</block>
  <block id="239aaf78fcb42b02d3709057d2a7978a" category="image-alt">VM 監控</block>
  <block id="a7765f8868404f7c3cb890ce051f7de4" category="image-alt">接入控制</block>
  <block id="e5bd6e5564d38885fef18a28e48861b4" category="image-alt">HA 叢集</block>
  <block id="8e00c91ecf143f76c94e3aa1668fc92b" category="inline-image-macro">ONTAP 複製</block>
  <block id="9c7295440be885852a164f5880627146" category="paragraph"><block ref="9c7295440be885852a164f5880627146" category="inline-image-macro-rx" type="image"></block></block>
  <block id="1eed6756a7834e04fb7716ee8d830425" category="inline-link-macro"><block ref="1eed6756a7834e04fb7716ee8d830425" category="inline-link-rx"></block></block>
  <block id="0e4a75553a081fffff029a37e55f5d71" category="inline-link-macro"><block ref="0e4a75553a081fffff029a37e55f5d71" category="inline-link-rx"></block></block>
  <block id="32fd58743bd2ce579949a47db1b95ca8" category="summary">與 SRA 和傳統資料存放區相比、 VVols 複寫搭配 VASA 提供獨特的功能。</block>
  <block id="570bfadf5783125790b6c87f55842fb2" category="inline-image-macro">SnapCenter 部署</block>
  <block id="71ca4878111d253f9883f471e5de9594" category="paragraph"><block ref="71ca4878111d253f9883f471e5de9594" category="inline-image-macro-rx" type="image"></block></block>
  <block id="bd90e11d4c9fc73f37adda8029276215" category="summary">本頁說明在 VMware vSphere 環境中實作 ONTAP 儲存解決方案的最佳實務做法。</block>
  <block id="ab906277df9ce070b1e11724f8ccf589" category="list-text">在叢集中的每個節點上、為每個SVM使用單一邏輯介面（LIF）ONTAP 。不再需要過去針對每個資料存放區的LIF建議。雖然直接存取（同一個節點上的 LIF 和資料存放區）是最佳選擇、但別擔心間接存取、因為效能影響通常很小（微秒）。</block>
  <block id="8dc90de75c19a4114217f443b0ca2866" category="inline-image-macro">從 vSphere 主機連線至 ONTAP NFS 資料存放區</block>
  <block id="36b9a8da16a1d2fad06b788e662b7c4a" category="paragraph"><block ref="36b9a8da16a1d2fad06b788e662b7c4a" category="inline-image-macro-rx" type="image"></block></block>
  <block id="bb6d2d52dfe07f9662232c444256aece" category="paragraph">使用 iSCSI 或 NVMe / TCP 的主機可以直接連線至儲存系統、並正常運作。原因是路徑。直接連線至兩個不同的儲存控制器、可產生兩個不同的資料流路徑。遺失路徑、連接埠或控制器並不會妨礙其他路徑的使用。</block>
  <block id="0d761ccb2787bad60b77ac971f6d3914" category="summary">本頁說明在 VMware vSphere 環境中實作 ONTAP FlexGroup Volume 的最佳實務做法。</block>
  <block id="adc6ae60e2ce9c7497e70727d5232a2d" category="paragraph">將 ONTAP 和 FlexGroup Volume 搭配 VMware vSphere 使用、即可建立簡單且可擴充的資料存放區、充分發揮整個 ONTAP 叢集的完整功能。</block>
  <block id="55e0e7799b68cd76cf68be0ee82fef7b" category="section-title">複本卸載</block>
  <block id="0db4fc806176bc768d44fa59cf3c36aa" category="paragraph">您可能會發現、如果您使用的是 VAAI 複製、但複製的複製量不足以保持快取溫暖、則您的複本可能不會比主機複本快。如果是這種情況、您可以調整快取逾時、以更符合您的需求。</block>
  <block id="1e8e371d8058e71f2444bc0cd42517eb" category="paragraph">Volume 接收的每個新複製工作都會重設逾時。如果範例 FlexGroup 中的組成磁碟區在逾時之前未收到複製要求、則會清除該特定 VM 的快取、而且需要再次填入該磁碟區。此外、如果原始複本的來源變更（例如、您已更新範本）、則每個成分的本機快取都會失效、以避免任何衝突。如前所述、快取是可調整的、可設定以符合您環境的需求。</block>
  <block id="6bcf203b609d41b14c06e319cede61d7" category="section-title">QoS 設定</block>
  <block id="9ab9903a16c07ff38214a043719957fd" category="paragraph">支援使用 ONTAP 系統管理員或叢集 Shell 在 FlexGroup 層級設定 QoS 、但無法提供 VM 認知或 vCenter 整合。</block>
  <block id="d9450aaad95d69e8cc75ddc0a69a9026" category="paragraph">QoS （最大 / 最小 IOPS ）可在 vCenter UI 中的個別虛擬機器或當時資料存放區中的所有虛擬機器上設定、或使用 ONTAP 工具透過 REST API 設定。在所有VM上設定QoS會取代任何個別VM設定。設定未來不會延伸至新的或移轉的VM；您可以在新的VM上設定QoS、或是將QoS重新套用至資料存放區中的所有VM。</block>
  <block id="f32c3edaacea72c0ddb30ecf0135c4de" category="section-title">指標</block>
  <block id="ed7927d72c6154d79bedf6b19ea8fc83" category="paragraph">ONTAP 9.8 也為 FlexGroup 檔案新增了檔案型效能指標（ IOPS 、處理量和延遲）、這些指標可在適用於 VMware vSphere 儀表板和 VM 報告的 ONTAP 工具中檢視。VMware vSphere外掛程式的支援功能也可讓您使用最大和/或最小IOPS的組合來設定服務品質（QoS）規則。ONTAP這些設定可以跨資料存放區中的所有VM進行設定、也可以針對特定VM個別設定。</block>
  <block id="c2ffe02d76c4f089648f1647b43e4ee5" category="section-title">最佳實務做法</block>
  <block id="43fc84d75bb64307120a48d004166174" category="inline-link-macro">資料存放區和傳輸協定 - NFS</block>
  <block id="b43cf2a2c13b864c3b2547368e95b2c5" category="list-text">使用 ONTAP 工具來建立 FlexGroup 資料存放區、以確保以最佳方式建立 FlexGroup 、並將匯出原則設定為符合您的 vSphere 環境。不過、使用 ONTAP 工具建立 FlexGroup Volume 之後、您會發現 vSphere 叢集中的所有節點都使用單一 IP 位址來掛載資料存放區。這可能導致網路連接埠出現瓶頸。若要避免此問題、請卸載資料存放區、然後使用標準 vSphere 資料存放區精靈、使用在 SVM 上的整個生命體之間進行負載平衡的循環 DNS 名稱來重新掛載資料存放區。重新掛載之後、 ONTAP 工具將再次能夠管理資料存放區。如果 ONTAP 工具無法使用、請使用 FlexGroup 預設值、並依照中的準則建立匯出原則 <block ref="1dcda1ccb6404fd747bdfa52cd9e0cc2" category="inline-link-macro-rx"></block>。</block>
  <block id="689367b2abf9b4f7fdef5f8589689dbc" category="list-text">調整FlexGroup VMware資料存放區規模時、請記住FlexGroup 、此功能包含FlexVol 多個較小的、可建立較大命名空間的支援區。因此、將資料存放區大小調整為至少 8 倍（假設預設為 8 個組成要素）、即最大 VMDK 檔案的大小、加上 10-20% 的未使用保留空間、以便靈活地重新平衡。例如、如果您的環境中有 6TB VMDK 、請將 FlexGroup 資料存放區大小調整為不小於 52.8 TB （ 6X8+10% ）。</block>
  <block id="315f464c64861565200e97577a6eabde" category="list-text">SnapCenter Plug-in for VMware vSphere 4.4 版及更新版本支援在主要儲存系統上的 FlexGroup 資料存放區中備份及還原 VM 。4 ． 6 號選擇控制閥增加了對基於 FlexGroup 的數據存儲的 SnapMirror 支持。使用陣列型快照和複寫是保護資料的最有效方法。</block>
  <block id="6c5f0256b71da4e103acbeed0dfcc379" category="summary">本文件說明適用於 VMware 的 SnapCenter 外掛程式的安全性層面。</block>
  <block id="3fd4fd8640d78da436f762569919841f" category="list-text">* 產品安全性事件回應活動。 * 公司內部和外部都發現安全性弱點、如果未及時解決、可能會對 NetApp 的聲譽造成嚴重風險。為了推動此程序、產品安全性事件回應團隊（PSIRT）會報告並追蹤弱點。</block>
  <block id="a2132633bc2804871caed9697d50a10d" category="summary">ONTAP 工具支援功能、限制和 VVols 。</block>
  <block id="2fa76de41291847c8d191ea664c53395" category="summary">瞭解 vSphere Metro Storage Cluster with ONTAP</block>
  <block id="0ecd760f5e697e57a60b2f1597be9d54" category="admonition">如需VMware vSphere虛擬磁碟區、SPBM及ONTAP VMware的詳細資訊、請參閱 <block ref="2e6ec19fbf81081d6cc68364fb2fb656" category="inline-link-macro-rx"></block>。</block>
  <block id="7dbbfa4d228c6ffe9a64c938bc057b0d" category="inline-image-macro">多重路徑連線</block>
  <block id="4525956d57ef52f4b2a4f341fbeec28e" category="paragraph"><block ref="4525956d57ef52f4b2a4f341fbeec28e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="8692ff2ea8c35b5c4c7cea90481e416c" category="summary">本文件會對建議的儲存設備和網路設定進行分類及列舉。</block>
  <block id="ff6fdc6e7749c69219fc26d54c625bd5" category="paragraph">NetApp 針對 NFS 和區塊傳輸協定開發了一組最佳 ESXi 主機設定。此外、我們也針對多重路徑和 HBA 逾時設定提供具體指引、以根據 NetApp 和 VMware 內部測試、讓 ONTAP 正常運作。</block>
  <block id="baee97fad9d55c529dc7a7eb07fd1ba4" category="cell">vSphere 6.0 或更新版本、設定為 256
所有其他 NFS 組態都設為 64 。</block>
  <block id="b3fd5cebc3e5891cccea8f8df97003e0" category="paragraph">以下各節概述 ONTAP 和 VMware SRM 的部署最佳實務做法。</block>
  <block id="c89f9fd1a8019dc4d7a2559a982d3aa8" category="inline-link-macro">S3組態總覽</block>
  <block id="8eb06904cba6440e6130ac3e32b68aba" category="paragraph">* 注意： * 如需更多有關 SVM 、統一化儲存設備和用戶端存取的資訊、請參閱 <block ref="9e7286a7ad3ab81fa024704c7a52e505" category="inline-link-macro-rx"></block> 在VMware的VMware®文件中心。ONTAP</block>
  <block id="d96a9839a4f7a8d356a868bd23816516" category="summary">ONTAP 在將近 20 年來一直是 VMware vSphere 環境的領先儲存解決方案、並持續新增創新功能來簡化管理、同時降低成本。本文件介紹ONTAP vSphere的解決方案、包括最新的產品資訊和最佳實務做法、以簡化部署、降低風險及簡化管理。</block>
  <block id="93fbb268e5e551ae95265cfe3b3b6c7a" category="paragraph">PostgreSQL 隨附的變種包括 PostgreSQL 、 PostgreSQL Plus 和 EDBS PostgreSQL 進階伺服器（ EPAS ）。PostgreSQL 通常部署為多層應用程式的後端資料庫。它受一般中介軟體套件的支援（例如 PHP 、 Java 、 Python 、 Tcl/Tk 、 ODBC 、 和 JDBC) ，過去一直是開放原始碼資料庫管理系統的熱門選擇。ONTAP 是執行 PostgreSQL 資料庫的絕佳選擇、可確保其可靠性、高效能及高效率的資料管理功能。</block>
  <block id="bbc2d665b02dc421c5c756db4b973610" category="sidebar">Microsoft Hyper-V</block>
  <block id="672553790d8814b967eb8623e754ea84" category="sidebar">部署準則和儲存最佳實務做法</block>
  <block id="c5865855c43d734069987786177edd98" category="sidebar">Hyper-V</block>
  <block id="230dea8fdf5e53eb32282fb3f8d4d9f6" category="sidebar">部署準則和儲存最佳實務做法</block>
  <block id="3c0fa9c86e8d92c7a146b2d71467ab2e" category="sidebar">NetApp 儲存設備和 Windows Server 環境</block>
  <block id="1ed211700a6cc31a2b45adb662dcbb8a" category="sidebar">在 SAN 環境中進行資源配置</block>
  <block id="41ffc5ff950f2260951b6b6150c36f6b" category="sidebar">在 SMB 環境中進行資源配置</block>
  <block id="e5f52b64058cb937fdd114369219d380" category="sidebar">NetApp 上的 Hyper-V 儲存基礎架構</block>
  <block id="4380100fa910735712157068aeec0575" category="sidebar">在叢集式環境中部署 Hyper-V 線上即時移轉</block>
  <block id="0726f4e9c3c98564af638f1b4cd17a9e" category="sidebar">在叢集式環境外部署 Hyper-V 即時移轉</block>
  <block id="1bbd09497cd931a02f8dc0ee3cfcf19d" category="sidebar">在叢集環境外部署 Hyper-V 複本</block>
  <block id="832a116d7f9184d8880a539553a0cb52" category="sidebar">在叢集環境中部署 Hyper-V 複本</block>
  <block id="1a85c0d242c43eb56cc500e60d323331" category="paragraph">VMFS是高效能的叢集式檔案系統、可提供共用儲存資源池的資料存放區。VMFS 資料存放區可設定為使用 FC 、 iSCSI 、 FCoE 或 NVMe 命名空間存取 LUN 、使用 NVMe / FC 或 NVMe / TCP 通訊協定存取。VMFS 可讓叢集中的每個 ESX 伺服器同時存取儲存設備。從 ONTAP 9.12.1P2 開始、 LUN 大小上限通常為 128TB （ ASA 系統則為較早版本）；因此、使用單一 LUN 可建立最大大小為 64TB 的 VMFS 5 或 6 資料存放區。</block>
  <block id="8983ee0717807e5385f3c8b2c70a177c" category="list-text">TR-4597：VMware vSphere ONTAP for VMware
<block ref="0bff808225ac084b8184e7670c17aa52" category="inline-link-macro-rx"></block></block>
  <block id="1f7ff87198d4a8563ac0d42354d47052" category="list-text">TR-4400: VMware vSphere虛擬Volume ONTAP with VMware
<block ref="57ea579fe6c0d333a496008248ad03e2" category="inline-link-macro-rx"></block></block>
  <block id="ef8c76bd50596fa93881a13dac3f23b3" category="inline-link-macro"><block ref="ef8c76bd50596fa93881a13dac3f23b3" category="inline-link-rx"></block></block>
  <block id="6e5923e0b2d91653ee7dd35aa5f48141" category="list-text">TR-4015《SnapMirror組態最佳實務指南ONTAP 》（英文）
<block ref="6a851721cd10ebeb2f9cfa107f963956" category="inline-link-macro-rx"></block></block>
  <block id="e651877073d877e1ee090d986eafc550" category="list-text">您必須將 Hyper-V 叢集放在相同或不同地理位置的同一位置、做為主要叢集和複本叢集。檢閱 <block ref="8a150f92c22920868769b8738759e23d" category="inline-link-macro-rx"></block> 以取得更多詳細資料。</block>
  <block id="8762adae157b34ee542f2e614401603a" category="list-text">概念ONTAP
<block ref="836022e29667128997850a15d18e8759" category="inline-link-rx"></block></block>
  <block id="e7b3912abd11fa36935a211d0189ebc2" category="list-text">現代 SAN 的最佳實務做法
<block ref="49df8abaa6163afdde37b69f7f59185c" category="inline-link-rx"></block></block>
  <block id="05c54431756e1b1a7114938bc6f4b199" category="list-text">NetApp All SAN Array Data Availability and Integrity with the NetApp ASA
<block ref="8f140ecff12b563e3c96a8cff991aedb" category="inline-link-rx"></block></block>
  <block id="bc96f334e3988ce96701a7082c0e23b5" category="list-text">開始使用 Nano Server +
<block ref="abdd6de84336a7f761fbe384605879e9" category="inline-link-rx"></block></block>
  <block id="0e660b82d6e28b6935041a5223ed1aed" category="paragraph">若要部署即時移轉、您必須在具有共用儲存設備的容錯移轉叢集中設定 Hyper-V 伺服器。檢閱 <block ref="8a150f92c22920868769b8738759e23d" category="inline-link-macro-rx"></block> 以取得更多詳細資料。</block>
  <block id="1dd1e97374852e1f244963d9fdb0c414" category="list-text">測試計畫性容錯移轉。使用即時移轉、快速移轉或儲存移轉（移動）、將 VM 移至另一個節點。檢閱 <block ref="ba8afff2d0e4662eeb47d28935e79828" category="inline-link-macro-rx"></block> 以取得更多詳細資料。</block>
  <block id="8737a5d2bc43b0eb76ab5674d0fcb094" category="sidebar">SRM with ONTAP 概述</block>
  <block id="76f6daa4bfab6ca8a7350e46d3d6718f" category="sidebar">SRM 的其他資訊</block>
  <block id="3ebf71fd7bd7392466a892c2228b2f58" category="section-title">在 Windows Server 上配置 SMB 共享</block>
  <block id="674b9c5bbf2379d6c48343d029972e53" category="section-title">主機整合</block>
  <block id="16ce478a465011bacaa6e508063c2648" category="section-title">值得記住的事項</block>
  <block id="83f04319244758f7531b398c51aa9f38" category="section-title">在奈米伺服器上配置 SMB 共享</block>
  <block id="2323e97f7cf2da464750911f1f3e1af6" category="doc">在叢集環境中部署 Hyper-V 複本</block>
  <block id="36b10adb4505559b63b091b53614af1f" category="section-title">NetApp 重複資料刪除</block>
  <block id="1ba5c1747d37a3d7ae84fd1dcac77603" category="section-title">進一步閱讀</block>
  <block id="50802d3e5a25b93d471686a10da03dd8" category="section-title">最佳實務做法</block>
  <block id="67bd1e9f90c0abcd3fe89dce2e8b6307" category="doc">在叢集式環境外部署 Hyper-V 即時移轉</block>
  <block id="f2b84afd0523a6df7547c404aa3647d8" category="section-title">目標對象</block>
  <block id="458ed20ed5d1729b427e233e0e52f797" category="section-title">為 Windows Server 佈建 NetApp 儲存設備</block>
  <block id="e648c74a53b161f90c8e915624ce6135" category="section-title">管理 NetApp 儲存設備</block>
  <block id="9292ee6bce21e93911c38cd0a1c2e209" category="section-title">網路最佳實務做法</block>
  <block id="381400d1babe5b80783d5e46896d832e" category="doc">部署奈米伺服器</block>
  <block id="02676c7c18a8d411999242a1f5731de2" category="section-title">NetApp CIFS 上的 Hyper-V 儲存設備</block>
  <block id="00a66fbc09172147ac7be9c85b708a6b" category="section-title">卸載資料傳輸</block>
  <block id="39d0bfdf27f1fc555ae2f030e21f8818" category="section-title">Hyper-V 叢集：虛擬機器的高可用度與擴充性</block>
  <block id="10fd9c0040ca7b99a67758c3cd638746" category="section-title">在叢集式環境中進行即時移轉</block>
  <block id="ed7cd01cb26e2db33a36eaa87ac85ff1" category="section-title">在叢集式環境外進行即時移轉</block>
  <block id="023196611fee49915adf49422b3289e6" category="section-title">Hyper-V 複本：虛擬機器的災難恢復</block>
  <block id="e78f6d0414a6dde66f4e12a3e218620b" category="section-title">延伸複寫</block>
  <block id="e43f3be13a49d6eeab4304d80790eaa0" category="section-title">偵測區塊儲存</block>
  <block id="adc95a9707f2f351740aa0d52f08981e" category="section-title">NetApp FlexClone 方法</block>
  <block id="0bee1618a00f62535bd1e3f03af6a8f0" category="section-title">從 SAN 開機以供實體主機使用</block>
  <block id="68468d5f213be162fe50260787894f8f" category="section-title">從 SAN 開機以供虛擬機器使用</block>
  <block id="5b6253395cb699e828a4e33bbe3ad99e" category="doc">在叢集環境外部署 Hyper-V 複本</block>
  <block id="c56bd6d44fe37df3133f12e09059b492" category="doc">部署 Hyper-V 叢集</block>
  <block id="284558d4613b1e72103300f1b8973b3b" category="paragraph">首次安裝時、 ESX 沒有預先設定的功能、例如代管來賓作業系統或支援終端使用者應用程式。它是空容器、直到定義虛擬機器（ VM ）為止。ONTAP 類似。第一次安裝 ONTAP 時、只有建立 SVM 、它才具備資料服務功能。定義資料服務的是 SVM 特性設定。</block>
  <block id="2737c9012caaebb1cbb9e526400a2345" category="paragraph">在多租戶環境中、每個租戶的資料都可以獲得專用的 SVM 。每個叢集、 HA 配對和節點的 SVM 和生命量限制取決於所使用的傳輸協定、節點模型和 ONTAP 版本。  請參閱 <block ref="41f66f34b3a905f864500c9319fdff8f" category="inline-link-macro-rx"></block> 針對這些限制。</block>
  <block id="50812cc1b8d48579d382b689e4393be6" category="paragraph">部分資料不包含重複資料。例如、 Oracle 區塊包含資料庫的全域唯一標頭、以及近乎唯一的標尾。因此、 Oracle 資料庫的重複資料刪除功能很少能節省 1% 以上的成本。使用 MS SQL 資料庫進行重複資料刪除的效果稍微好一些、但區塊層級的獨特中繼資料仍是一項限制。</block>
  <block id="e237dd01ca20b300861ea50239fefbf9" category="paragraph">這包括典型的規劃措施、例如確保主機和儲存系統之間的 SAN 上有足夠的頻寬、使用 FC 交換器廠商所需的 FC 連接埠設定、檢查所有必要裝置之間是否存在所有 SAN 路徑、避免 ISL 爭用、 並使用適當的 SAN 架構監控。</block>
  <block id="bab63c3a8b4ae009c3596c809e27d73b" category="paragraph">MetroCluster 複寫是以 NetApp SyncMirror 技術為基礎、其設計旨在有效率地切換至同步模式及從同步模式切換到同步模式。這項功能符合要求同步複寫、但也需要高可用度資料服務的客戶需求。例如、如果中斷與遠端站台的連線、通常最好讓儲存系統繼續以非複寫狀態運作。</block>
  <block id="bf4d44f407dab4b746f1eaeb06e897af" category="paragraph">許多同步複寫解決方案只能以同步模式運作。這種類型的全或全無複寫有時稱為 Domino 模式。這類儲存系統會停止提供資料、而不允許資料的本機和遠端複本進行非同步處理。如果複寫被強制中斷、重新同步可能會非常耗時、而且可能會讓客戶在重新建立鏡像期間暴露在完全資料遺失的風險中。</block>
  <block id="8f076395fe8f8f46c03efb655db313e6" category="section-title">FC 直接連線</block>
  <block id="722830ffc5e46dbe206670f85cd1d889" category="paragraph">ONTAP 和其他某些 NetApp 產品現在支援使用各種方法的多因素驗證（ MFA ）。因此、光是使用者名稱 / 密碼就不再是安全執行緒、而沒有第二個因素的資料、例如 FOB 或智慧型手機應用程式。</block>
  <block id="37c43820ab88f1340855c30955eec330" category="section-title">多重管理驗證（ MAV ）</block>
  <block id="1910dc5a02cb649cc24df5670c631e34" category="paragraph"><block ref="1910dc5a02cb649cc24df5670c631e34" category="inline-image-macro-rx" type="image"></block></block>
  <block id="416d0d3efc5f3919abcdaaa2364738d9" category="paragraph"><block ref="416d0d3efc5f3919abcdaaa2364738d9" category="inline-image-macro-rx" type="image"></block></block>
  <block id="28c6217e46797f76e427c591070cf50c" category="paragraph"><block ref="28c6217e46797f76e427c591070cf50c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="d03e09c345dd723011486de3855c13b2" category="list-text">SMB 文件
<block ref="409ef354547d1e3428907ed7fdd2dc6e" category="inline-link-rx"></block></block>
  <block id="834873443aaaf2c09b851c8b0f7b2497" category="section-title">資料庫壓縮</block>
  <block id="2ee3c7318caa2523e9c749e4e2152266" category="paragraph">與剛接觸 ONTAP 的客戶混淆的一個常見點是使用 FlexVols 、通常稱為「 Volume 」。</block>
  <block id="ff2dabe8a40c84d01b0584c50319a79e" category="paragraph">磁碟區不是 LUN 。這些詞彙與許多其他廠商產品（包括雲端供應商）同義。ONTAP Volume 是簡單的管理容器。它們本身不會提供資料、也不會佔用空間。它們是檔案或 LUN 的容器、可改善及簡化管理、尤其是大規模管理。</block>
  <block id="92a5781e05d0d9b7044f44e2ef7bff84" category="section-title">磁碟區和 LUN</block>
  <block id="faf1e8eebcac2d18d4ac10e75f416a3f" category="paragraph">相關 LUN 通常位於單一磁碟區中。例如、需要 10 個 LUN 的資料庫通常會將所有 10 個 LUN 放在同一個磁碟區上。</block>
  <block id="3a5bf2895b95fa2b89fce4dcf94fd2f9" category="list-text">使用 LUN 對磁碟區的比例 1 ： 1 表示每個磁碟區有一個 LUN 、這是 * 非 * 正式最佳實務做法。</block>
  <block id="1886f4ac4aa2f64bf8224f178a36ba92" category="list-text">而是應將磁碟區視為工作負載或資料集的容器。每個磁碟區可能只有一個 LUN 、或者可能有許多 LUN 。正確的答案取決於管理需求。</block>
  <block id="0de05608a70e8ec5863afc41ba150178" category="list-text">在不必要數量的磁碟區之間分散 LUN 、可能會導致額外的額外負荷和排程問題、例如快照作業、 UI 中顯示的物件過多、並導致在達到 LUN 限制之前達到平台磁碟區限制。</block>
  <block id="0955dbd01a9f8194cad5a6876b931f5a" category="section-title">磁碟區、 LUN 和快照</block>
  <block id="9bbd4f2fca3a1e1aaa76abf8cb43351c" category="paragraph">Snapshot 原則和排程會放置在磁碟區上、而非 LUN 上。如果資料集由 10 個 LUN 組成、則當這些 LUN 位於同一個磁碟區中時、只需要單一快照原則。</block>
  <block id="f34f28bb7a1701ded173c2ab504f5c20" category="paragraph">此外、在單一磁碟區中共同定位給定資料集的所有相關 LUN 、可提供原子快照作業。例如、如果基礎 LUN 全部放在單一磁碟區上、則位於 10 個 LUN 上的資料庫、或是由 10 個不同作業系統組成的 VMware 應用程式環境、都可以作為單一且一致的物件加以保護。如果將快照放在不同的磁碟區上、則即使同時排程、快照仍可能保持 100% 同步。</block>
  <block id="fe7797cb1dbe36223357d4c25ff30c9e" category="paragraph">在某些情況下、由於恢復需求、相關的 LUN 集可能需要分割成兩個不同的磁碟區。例如、資料庫可能有四個 LUN 用於資料檔案、兩個 LUN 用於記錄。在這種情況下、具有 4 個 LUN 的資料檔案磁碟區和具有 2 個 LUN 的記錄磁碟區可能是最佳選擇。原因在於可進行的可恢復性是不相關的。例如、資料檔案磁碟區可以選擇性地還原為較早的狀態、這表示所有四個 LUN 都會還原為快照狀態、而記錄磁碟區與其重要資料則不會受到影響。</block>
  <block id="66383d632fe33f1b7c20af9c1c142028" category="section-title">Volume 、 LUN 和 SnapMirror</block>
  <block id="8fb29c5f40886ece62abcd994f1aa202" category="paragraph">SnapMirror 原則和作業就像快照作業一樣、是在磁碟區上執行、而不是在 LUN 上執行。</block>
  <block id="7d8d0afc8d9998a7e6457c6251b4defc" category="paragraph">在單一磁碟區中共同定位相關 LUN 、可讓您建立單一 SnapMirror 關係、並透過單一更新來更新所有包含的資料。與快照一樣、更新也將是一項原子作業。SnapMirror 目的地將保證擁有來源 LUN 的單一時間點複本。如果 LUN 分散在多個磁碟區、則複本可能彼此一致、也可能不一致。</block>
  <block id="e45ffde45b5f4090fe8c92a49d38bcb2" category="section-title">磁碟區、 LUN 和 QoS</block>
  <block id="756a4c619fb81eafd00bc072334a5877" category="paragraph">雖然 QoS 可以選擇性地套用至個別 LUN 、但通常在磁碟區層級設定 QoS 會比較容易。例如、指定 ESX 伺服器中的來賓所使用的所有 LUN 都可以放置在單一磁碟區上、然後就可以套用 ONTAP 調適性 QoS 原則。結果是將每 TB IOPS 的自我擴充限制套用至所有 LUN 。</block>
  <block id="fb219ca81e7a635609b70d290a7a3aa2" category="paragraph">同樣地、如果資料庫需要 10 萬次 IOPS 、而且佔用 10 個 LUN 、則在單一磁碟區上設定單一的 10 萬次 IOPS 限制、比在每個 LUN 上設定 10 個個別的 10K IOPS 限制更容易。</block>
  <block id="56739402ea66bd29b7303b69ee165d5b" category="section-title">多重 Volume 配置</block>
  <block id="c509cb5f7def30cc77b15b0e91ab39a4" category="paragraph">在某些情況下、跨多個磁碟區散佈 LUN 可能會有幫助。主要原因是控制器分段。例如、 HA 儲存系統可能會裝載單一資料庫、其中需要每個控制器的完整處理與快取潛力。在這種情況下、典型的設計是將一半的 LUN 放在控制器 1 的單一磁碟區、而另一半的 LUN 則放在控制器 2 的單一磁碟區中。</block>
  <block id="ad328d1793d6c3621e91d83556548a01" category="paragraph">同樣地、控制器分段也可用於負載平衡。HA 系統託管 100 個資料庫、每個資料庫各有 10 個 LUN 、每個資料庫可在兩個控制器上接收 5 個 LUN 磁碟區。如此一來、每個控制器就能以對稱的方式進行對稱載入、同時還能配置額外的資料庫。</block>
  <block id="4cd2d5d8d873ad1f707d88334324153a" category="paragraph">不過、這些範例都不涉及 1 ： 1 的磁碟區對 LUN 比率。目標仍然是透過在磁碟區中共同定位相關 LUN 來最佳化管理性。</block>
  <block id="a9fd7be1f3363701ad1b35b16af02c9e" category="paragraph">其中一個例子是、 1 ： 1 LUN 對磁碟區比率非常合理、其中每個 LUN 可能真正代表單一工作負載、而且每個工作負載都需要個別管理。在這種情況下、 1 ： 1 的比率可能是最佳的。</block>
  <block id="64e5a77897fe6326f14436eaaaf5432b" category="section-title">可用空間和 LVM 空間分配</block>
  <block id="702db8f3db66a0eec35817fe5d2e4544" category="inline-link-macro">ASMRU</block>
  <block id="096ca5ad0b3774fee4699e2da1bfa884" category="paragraph">在檔案系統環境中自動精簡配置作用中 LUN 的效率、可能會隨著資料刪除而隨時間而喪失。除非刪除的資料會以零覆寫（另請參閱 <block ref="5b58c4ec517e475a59d0a785f87cabdc" category="inline-link-macro-rx"></block> 或是隨著修剪 / 取消對應空間回收而釋放空間、「清除」資料會佔用檔案系統中越來越多的未分配空白空間。此外、在許多資料庫環境中、主動式 LUN 的精簡配置功能有限、因為資料檔案會在建立時初始化為全尺寸。</block>
  <block id="ceb8ec6ec593174c2c6f33be2ca966eb" category="summary">Oracle 和 ONTAP 磁碟區和 LUN 配置</block>
  <block id="0724b56ced27e0a66fb4692a57fb1436" category="doc">Oracle 資料庫 LUN 放置</block>
  <block id="f595bf3bf71ab0c91a5503ba4efb8ea4" category="paragraph">資料庫 LUN 在 ONTAP 磁碟區內的最佳放置方式、主要取決於如何使用各種 ONTAP 功能。</block>
  <block id="05a1ffdb277b8c7ac1dca78adae0017e" category="sidebar">LUN 放置</block>
  <block id="9d5c13d45bbf74999764cfe8d4798562" category="summary">適用於 VMware vSphere 的 ONTAP 工具安全強化指南、 HTTPS 憑證管理。</block>
  <block id="d6a1787b51b08315bfcc44f3a9bb4b2f" category="paragraph">根據預設、 ONTAP 工具會使用在安裝期間自動建立的自我簽署憑證、以確保 HTTPS 存取安全無虞。ONTAP 工具提供下列功能：</block>
  <block id="1eddd0f3479da31541c39e5ddddfa930" category="list-text">重新產生 HTTPS 憑證</block>
  <block id="61bf3033b18d202012951f5bf7be4fa9" category="paragraph">在 ONTAP 工具安裝期間、會安裝 HTTPS CA 憑證、並將憑證儲存在金鑰庫中。使用者可以選擇透過維護主控台重新產生 HTTPS 憑證。</block>
  <block id="b363a018e3596ec66080579ce5bd4c2d" category="paragraph">您可以在 _main_ 主控台中存取上述選項、方法是瀏覽至「應用程式組態」→「重新產生憑證」。 _</block>
  <block id="43d609906e5ac2fd9406eddd67d6f82a" category="summary">適用於 VMware vSphere 的 ONTAP 工具安全強化指南、使用者存取點。</block>
  <block id="c015e2af845448c5e88873c4e51c8cac" category="paragraph">ONTAP Tools for VMware vSphere 安裝會建立並使用三種類型的使用者：</block>
  <block id="6399e228248ba3e1f084750197938b67" category="list-text">系統使用者： root 使用者帳戶</block>
  <block id="2a408bd40a0a3130a390340955a699ef" category="list-text">應用程式使用者：系統管理員使用者、主要使用者及資料庫使用者帳戶</block>
  <block id="5d212a60c02bc59306c8863b31342276" category="list-text">支援使用者：診斷使用者帳戶</block>
  <block id="3c2b7b0ce42bb5eb8141643a9729f4ee" category="section-title">1. 系統使用者</block>
  <block id="b277c4882e7365ab0ac88d56cd6154b3" category="paragraph">系統（ root ）使用者是由安裝在基礎作業系統（ Debian ）上的 ONTAP 工具所建立。</block>
  <block id="155b9191864da17a7eaaf07b64d596d8" category="list-text">預設的系統使用者「 root 」是由 ONTAP 工具安裝在 Debian 上建立的。其預設值為停用、可透過「 Maint 」主控台在特定的基礎上啟用。</block>
  <block id="159efbffccd1957bc8c4c78b2a74c085" category="section-title">2. 應用程式使用者</block>
  <block id="170cab8b15d5b37a17e43144afe7308d" category="paragraph">應用程式使用者在 ONTAP 工具中會命名為本機使用者。這些是在 ONTAP 工具應用程式中建立的使用者。下表列出應用程式使用者的類型：</block>
  <block id="e01ca242f9b1bef82800de4c209149c7" category="cell">*使用者*</block>
  <block id="f14c276c07197ebef1394a5a219087a1" category="cell">*說明*</block>
  <block id="9eb92414db7b53ac16645af9b0f64e58" category="cell">系統管理員使用者</block>
  <block id="ccf6887baccb4288ae3579b56fac8d2a" category="cell">它是在 ONTAP 工具安裝期間建立、使用者在部署 ONTAP 工具時提供認證。使用者可以在「 Maint 」主控台中變更「密碼」。密碼將在 90 天內過期、使用者預期會變更相同的密碼。</block>
  <block id="55df75b800db0f96de770b3c38f676b4" category="cell">維護使用者</block>
  <block id="a2bc121b09cae43d6c478870f5298ae5" category="cell">它是在 ONTAP 工具安裝期間建立、使用者在部署 ONTAP 工具時提供認證。使用者可以在「 Maint 」主控台中變更「密碼」。這是維護使用者、是為了執行維護主控台作業而建立的。</block>
  <block id="b124032a093d41b9efbb43f40c538bcb" category="cell">資料庫使用者</block>
  <block id="86a670227d3e81e8fa34eb4aede3129a" category="section-title">3. 支援使用者（診斷使用者）</block>
  <block id="e482d8f0e37161e7916c7a78d2cf7210" category="paragraph">在 ONTAP 工具安裝期間、系統會建立支援使用者。此使用者可在伺服器發生任何問題或中斷時、用來存取 ONTAP 工具、並收集記錄。根據預設、此使用者已停用、但可透過「 Maint 」主控台臨時啟用。請務必注意、此使用者將在一段時間後自動停用。</block>
  <block id="562596399deefc1e2a6cc32eb489976c" category="summary">適用於 VMware vSphere 的 ONTAP 工具安全強化指南。</block>
  <block id="80dd7fd00106118cf9c10abf911b7111" category="paragraph">此處列出的必要連接埠和通訊協定、可讓 VMware vSphere 伺服器的 ONTAP 工具與其他實體（例如託管儲存系統、伺服器和其他元件）之間進行通訊。</block>
  <block id="d40dfcfdaecc4e8015535acd5de00398" category="section-title">OTV 所需的傳入和傳出連接埠</block>
  <block id="5732d3577c35dfcce968ba967a9a6149" category="cell">*TCP v4/v6 連接埠 #*</block>
  <block id="e71a4b7488a97c0e5d8b3ab3efe619e4" category="cell">*方向*</block>
  <block id="bc437eb0df24b836c84a74f47b391093" category="cell">* 功能 *</block>
  <block id="576fe92cf4e45714b61ed10e5c856aa5" category="cell">HTTPS 連線 +
用於透過 HTTPS 連線的 SOAP +
此連接埠必須開啟、才能讓用戶端連線至 ONTAP 工具 API 伺服器。</block>
  <block id="4e31bd5bdc8239bb7c98471d3500d951" category="cell">HTTPS 連線： VP 與 SRA +
用於透過 HTTPS 連線的 SOAP</block>
  <block id="7e6b20d014d1c659e4eaf20dc2dcd7eb" category="cell">8443</block>
  <block id="aaa2d7fe63bee55de8ffca52cb61fbd5" category="cell">遠端外掛程式</block>
  <block id="25fa62922a9b3c1c2763bbf88014e217" category="cell">只有在此電腦和本身之間才有 Derby 資料庫連接埠、不接受外部連線—僅限內部連線</block>
  <block id="c68bd9055776bf38d8fc43c0ed283678" category="cell">8150</block>
  <block id="b482bc4bf0e383b0858c5d9eb0e96ba9" category="cell">記錄完整性服務會在連接埠上執行</block>
  <block id="9956361dfa33899fc0efed6ee3946512" category="section-title">控制對 Derby 資料庫的遠端存取</block>
  <block id="58b7326b56820f4b18dfd73dc9707831" category="paragraph">系統管理員可以使用下列命令來存取 derby 資料庫。您可以透過 ONTAP 工具本機 VM 以及遠端伺服器來存取它、步驟如下：</block>
  <block id="296068c08046bbf197300e38c4e851cb" category="paragraph">*[.Underline] #example:#*</block>
  <block id="10046bc1eb8463e6ca6ae51bd3b7a574" category="inline-image-macro">Derby 、 width=468 、 height =136</block>
  <block id="36434da35edb72a1f85cbbcc1ff2b197" category="paragraph"><block ref="36434da35edb72a1f85cbbcc1ff2b197" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f21dd7ffc271f1301878c3078a59692d" category="summary">適用於 VMware vSphere 的 ONTAP 工具安全強化指南、登入橫幅。</block>
  <block id="ae20daf991a940f9de7033ff0a1af410" category="paragraph">使用者透過SSH通道完成登入後、會顯示下列文字：</block>
  <block id="8f1b6f904292913013b1f6e578d7b074" category="summary">適用於 VMware vSphere 的 ONTAP 工具安全強化指南、完整性驗證。</block>
  <block id="aeeb9f5277554716592480db544d25f3" category="paragraph">有兩種方法可供客戶驗證其 ONTAP 工具安裝套件的完整性。</block>
  <block id="126ba7383e25522e071a963ddd6f220f" category="list-text">驗證校驗和</block>
  <block id="deccc645a0c8869a44e645f2f4247dbd" category="list-text">驗證簽名</block>
  <block id="e5f3970dd7fabab1726b53d58d636de2" category="paragraph">OTV 安裝套件的下載頁面提供校驗和。使用者必須根據下載頁面所提供的 Checksum 來驗證下載套件的總和。</block>
  <block id="7452fe022f94726684aeea655673eb0f" category="section-title">驗證 ONTAP 工具 OVA 的簽名</block>
  <block id="373d060b52f94a014177952dcca0c4e9" category="paragraph">vApp 安裝套件以 tarball 的形式提供。此 tarball 包含虛擬應用裝置的中繼和根憑證、以及 README 檔案和 OVA 套件。README 檔案可引導使用者驗證 vApp OVA 套件的完整性。</block>
  <block id="48fefdb76906b256f183e6f68b23eba1" category="paragraph">客戶也必須在 vCenter 7.0U3E 版及更新版本上傳所提供的根憑證和中介憑證。  對於 7.0.1 與 7.0.U3E 之間的 vCenter 版本、 VMware 不支援驗證憑證的功能。客戶不需要上傳任何 vCenter 6.x 版的憑證</block>
  <block id="84a005842347a9560b170cfcd79c5203" category="section-title">將信任的根憑證上傳至 vCenter</block>
  <block id="57f60da4817dc5d71c45890bb182781e" category="list-text">使用 VMware vSphere Client 登入 vCenter Server 。</block>
  <block id="72282f16a7aca6b61acfc6fe27ce55c7" category="list-text">指定管理員 @vspece.pengil 或 vCenter 單一登入管理員群組的其他成員的使用者名稱和密碼。如果您在安裝期間指定不同的網域、請以管理員 @ mydomain.</block>
  <block id="43a75b176810226695d2db6f52c87b73" category="list-text">如果系統提示您、請輸入 vCenter Server 的認證。</block>
  <block id="5f51c5b3cb2f48fd1d670bf384d1006d" category="list-text">按一下 [ 信任的根憑證 ] 底下的 [ 新增 ] 。</block>
  <block id="55c3b759c54a437c7ced6432f1c62de0" category="list-text">按一下瀏覽並選取憑證 .pem 檔案（ OTV_OVa_INT_ROOT_CERT_CHERC.pem ）的位置。</block>
  <block id="8acdedaaa4134bb6ae49472b4bc268a7" category="list-text">按一下「新增」憑證即會新增至儲存區。</block>
  <block id="e2200da08ea15bdea0f97dbfc4e9f1c7" category="inline-link-macro">將信任的根憑證新增至憑證存放區</block>
  <block id="6eeecddd909e7e017ba2732e46dc739c" category="paragraph">請參閱 <block ref="b8e45b03638af10d852f253eba7e63e3" category="inline-link-macro-rx"></block> 以取得更多資訊。部署 VApp （使用 OVA 檔案）時、可在「 Review details 」（檢閱詳細資料）頁面上驗證 vApp 套件的數位簽章。如果下載的 VApp 套件為正版、「發行者」欄會顯示「信任的憑證」（如下面的螢幕擷取畫面所示）。</block>
  <block id="a13b63a149750821fb588cd3cb41c209" category="inline-image-macro">信任的憑證</block>
  <block id="a83d8109f7a0cf9c4a04c65c40ecd354" category="paragraph"><block ref="a83d8109f7a0cf9c4a04c65c40ecd354" category="inline-image-macro-rx" type="image"></block></block>
  <block id="61dc5ac976a8bd4a8744d8890305d26e" category="section-title">驗證工具 ISO 和 ONTAP tar.gz 的簽名</block>
  <block id="d4f26c1c073b64ba200e3fa71762c256" category="paragraph">NetApp 會在產品下載頁面上與客戶共用程式碼簽署憑證、以及適用於 OTV-ISO 和 SRA.tgz 的產品 zip 檔案。</block>
  <block id="a7ac1e7561da5cc70126cfea891de159" category="paragraph">從程式碼簽署憑證中、使用者可以擷取公開金鑰、如下所示：</block>
  <block id="5f4345a6f62f7a3926b2c3d92f5574f6" category="paragraph">接著應使用公開金鑰來驗證 ISO 和 tgz 產品 zip 的簽名、如下所示：</block>
  <block id="81eeab9506186e2dca8faefa78d54067" category="paragraph">範例：</block>
  <block id="c6666237b03fcb86e315a0a06e73b6ef" category="summary">適用於 VMware vSphere 的 ONTAP 工具安全強化指南、儲存管理連線的相互 TLS 加密。</block>
  <block id="53893182b7e17fb2da37935ee3ffda55" category="paragraph">ONTAP 9.7 版及更新版本支援相互 TLS 通訊。從適用於 VMware 的 ONTAP 工具和 vSphere 9.12 開始、系統會使用相互 TLS 與新增的叢集進行通訊（視 ONTAP 版本而定）。</block>
  <block id="1be712dee4c47804142318ffb739e46b" category="paragraph">對於所有先前新增的儲存系統：在升級期間、所有新增的儲存系統都會自動受到信任、而且會設定憑證型驗證機制。</block>
  <block id="d39adf53eaace0fbba30d4e13760a974" category="paragraph">如下面的螢幕擷取畫面所示、叢集設定頁面會顯示為每個叢集設定的相互 TLS （憑證型驗證）狀態。</block>
  <block id="c036889d83926f57571c8b12e4f7fb6f" category="inline-image-macro">Image2 、 width=468 、 height =158</block>
  <block id="095064767a4b9cadb4016dfc2788237c" category="paragraph"><block ref="095064767a4b9cadb4016dfc2788237c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="53f061d401dd80027634ccca2a19cd8d" category="section-title">* 叢集新增 *</block>
  <block id="7ce4b2757e70979f49bcf8f64ba36363" category="paragraph">在叢集新增工作流程期間、如果所新增的叢集支援 MTLS 、則預設會設定 MTLS 。使用者不需要為此進行任何組態。下列螢幕擷取畫面會顯示在叢集新增期間顯示給使用者的畫面。</block>
  <block id="3c1556a297200019d3a0b8045c0956b9" category="inline-image-macro">新增儲存系統、寬度 = 450 、高度 = 400</block>
  <block id="3a225aabc3c5c25670ad0b4d131da24f" category="paragraph"><block ref="3a225aabc3c5c25670ad0b4d131da24f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="987de6e025f6af1fc4451710295ca76f" category="inline-image-macro">新增儲存系統、寬度 = 468 、高度 = 416</block>
  <block id="576a9128888c73fc82869b3ae173c7d2" category="paragraph"><block ref="576a9128888c73fc82869b3ae173c7d2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="307eba22b8070bb93e642827620f8588" category="paragraph"><block ref="307eba22b8070bb93e642827620f8588" category="inline-image-macro-rx" type="image"></block></block>
  <block id="71cfed326a2cabd3b505c6580123a459" category="inline-image-macro">新增儲存系統、寬度 = 468 、高度 = 516</block>
  <block id="a3a8f9da50b3f15d69f3186129f159f6" category="paragraph"><block ref="a3a8f9da50b3f15d69f3186129f159f6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3b3ebbeea272602ddec07bb77e34668a" category="section-title">叢集編輯</block>
  <block id="d2562e450657937f981a45d9d18ff4ec" category="paragraph">在叢集編輯作業期間、有兩種情況：</block>
  <block id="500bcb89776517849e2e07073aad4eca" category="list-text">如果 ONTAP 憑證過期、則使用者必須取得新憑證並上傳憑證。</block>
  <block id="edf2227e3378b5b0864ef73e58d39d77" category="list-text">如果 OTV 憑證過期、則使用者可以勾選核取方塊來重新產生該憑證。</block>
  <block id="6db8cdf80049c7cf629fe6f8f6e3a9c0" category="list-text">產生 ONTAP 的新用戶端憑證 _</block>
  <block id="acba923a9524c642724d6ff34f5dac93" category="inline-image-macro">修改儲存系統、寬度 = 468 、高度 = 461</block>
  <block id="6a59df9970674c274e20b1d91be2df8a" category="paragraph"><block ref="6a59df9970674c274e20b1d91be2df8a" category="inline-image-macro-rx" type="image"></block></block>
  <block id="75545011d3e6abe8a2cd8cd5bc21c6fd" category="paragraph"><block ref="75545011d3e6abe8a2cd8cd5bc21c6fd" category="inline-image-macro-rx" type="image"></block></block>
  <block id="14a73da2f5fe352620bed1b49a3319ed" category="summary">適用於 VMware vSphere 之 ONTAP 工具的安全強化指南、網路安全保護、防範 DOS 攻擊。</block>
  <block id="8f7e7bd942f453f0550dc4f907e88810" category="paragraph">依預設、每位使用者的並行要求上限為 48 個。ONTAP 工具中的根使用者可以根據其環境需求變更此值。* 此值不應設為非常高的值、因為它提供了一種機制來防範拒絕服務（ DOS ）攻擊。 *</block>
  <block id="99c1088ea27d16b42c6b45d794f59d3f" category="paragraph">使用者可以在 *_/opt/NetApp/vscserver/etc/dosfilterParams .json_* 檔案中變更並行工作階段的最大數量及其他支援參數。</block>
  <block id="5e7c907630f5a432ac6b39f0b8c04c28" category="paragraph">我們可以使用下列參數來設定篩選器：</block>
  <block id="a35f2f4ccb228969a85b8719ea25b047" category="list-text">*_delayMs_* ：在考慮所有請求之前，爲其提供的延遲（以毫秒爲單位）超過了速率限制。給予 -1 即可拒絕要求。</block>
  <block id="f1b9d5fde713093a3a80f140d1439d37" category="list-text">*_THROLMS__* ：異步等待信號量的時間。</block>
  <block id="aa363bec6acd7600aedeee5377470bde" category="list-text">*_maxRequestM_* ：允許執行此要求的時間。</block>
  <block id="351b695725caafd647abb749c50a7e6f" category="list-text">*_ipWhitelist_* ：以逗號分隔的 IP 位址清單、不會受到速率限制。（這可以是 vCenter 、 ESXi 和 SRA IP ）</block>
  <block id="058e1fe7e6afcd3bcff86482a583976b" category="list-text">*_maxRequestsPerSec_* ：每秒來自連線的最大要求數。</block>
  <block id="1c1496a21f967d57b50fe5ebb0e62125" category="paragraph">* 在 _dosfilterParams 檔案中的預設值： *</block>
  <block id="9afb15056a8bc8b4402d55eba2274dad" category="summary">適用於 VMware vSphere 的 ONTAP 工具安全強化指南、 NTP 組態。</block>
  <block id="48edbd8a951efb0ad617f7868b27a6c0" category="paragraph">有時、網路時間組態不一致、可能會發生安全問題。請務必確保網路中的所有裝置都有正確的時間設定、以避免發生此類問題。</block>
  <block id="a55d703ea2930e8e72e94ce11c3297ab" category="section-title">* 虛擬應用裝置 *</block>
  <block id="5a65f4c9ca6d99f573528348d36914fa" category="paragraph">您可以從虛擬應用裝置的維護主控台設定 NTP 伺服器。  使用者可以在 _ 系統組態 _ = &gt; _ 新增 NTP 伺服器 _ 選項下新增 NTP 伺服器詳細資料</block>
  <block id="90ab4fc7a1c530bceac36bda71efbc5f" category="paragraph">根據預設、 NTP 的服務為 ntpd 。這是一項舊版服務、在某些情況下、虛擬機器無法順利運作。</block>
  <block id="6801ecdb823d018c7370042d27b5ee2c" category="section-title">* Debian*</block>
  <block id="dc3bb5166d38d2aec53765aca7c0d24c" category="paragraph">在 Debian 上、使用者可以存取 /etc/ntp.conf 檔案來取得 NTP 伺服器的詳細資料。</block>
  <block id="fec65f0c33739368ce5845fadb6cb880" category="paragraph">這些指南同時適用於應用程式和應用裝置本身的客體作業系統。</block>
  <block id="5aaf8fc9424d7872cf500fb7adcb3b97" category="summary">適用於 VMware vSphere 的 ONTAP 工具安全強化指南、密碼原則組態。</block>
  <block id="53477738359cebc12d4e01727ee8b5e7" category="paragraph">首次部署 ONTAP 工具或升級至 9.12 版或更新版本的使用者、必須同時遵循系統管理員和資料庫使用者的強式密碼原則。在部署過程中、系統會提示新使用者輸入密碼。對於升級至 9.12 版或更新版本的瀏覽欄位使用者、維護主控台將提供遵循強式密碼原則的選項。</block>
  <block id="7afd9be20a239f83f98bdbc7f90512ef" category="list-text">一旦使用者登入主控台、就會對照複雜的規則集來檢查密碼、如果發現未遵循、則會要求使用者重設相同的密碼。</block>
  <block id="1e048d74f3d9375186833526a00f4309" category="list-text">密碼預設有效時間為 90 天、 75 天之後、使用者會開始收到變更密碼的通知。</block>
  <block id="dbb73ef3f8e9b61d387a809281a654cc" category="list-text">每個週期都需要設定新密碼、系統不會將最後一個密碼當作新密碼。</block>
  <block id="210b05d5e7375bcb02bcf09a873bbda6" category="list-text">每當使用者登入主控台時、會在載入主功能表之前、先檢查密碼原則、例如下列螢幕擷取畫面：</block>
  <block id="bc66b4fce20ef49b05e4a54f053e65a6" category="inline-image-macro">主功能表、寬度 = 468 、高度 = 116</block>
  <block id="4661acb75237098be364b3c05d7d9b7c" category="paragraph"><block ref="4661acb75237098be364b3c05d7d9b7c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="8f09c69f731d4d6f2e8d6135082aa8e4" category="list-text">如果發現未遵循密碼原則或 ONTAP 工具 9.11 或更早版本的升級設定、然後使用者會看到下列畫面來重設密碼：</block>
  <block id="4499d4bfb9610056781e2e61956dd0ca" category="inline-image-macro">密碼重設畫面、寬度 = 468 、高度 = 116</block>
  <block id="a84278f7bf3ee281e39e467fca1fe454" category="paragraph"><block ref="a84278f7bf3ee281e39e467fca1fe454" category="inline-image-macro-rx" type="image"></block></block>
  <block id="47e6664ac0a72e1d719cfc288383b4f8" category="list-text">如果使用者嘗試設定弱密碼或再次輸入上一個密碼、則使用者將會看到下列錯誤：</block>
  <block id="fe04952c38b6a9a7db1a75bbb4905232" category="inline-image-macro">弱密碼錯誤、寬度 = 468 、高度 = 101</block>
  <block id="2c59de9ea5183e73d5fa6382fa7f3fc1" category="paragraph"><block ref="2c59de9ea5183e73d5fa6382fa7f3fc1" category="inline-image-macro-rx" type="image"></block></block>
  <block id="704c7fc6c4d40b9af6aafb7cf9b44022" category="paragraph">為了防止未經授權的存取、系統會設定閒置逾時、自動登出在使用授權資源期間處於非使用中狀態的使用者。如此可確保只有授權使用者才能存取資源、並協助維護安全性。</block>
  <block id="80f9ebebc8f94450338d28bcb4a2164d" category="inline-link">設定 vSphere Client 逾時值</block>
  <block id="3748702da26b5718f1f7c769ce58b009" category="list-text">根據預設、 vSphere Client 工作階段會在閒置 120 分鐘後關閉、要求使用者再次登入才能繼續使用用戶端。您可以編輯 webclient.properties 檔案來變更逾時值。 您可以設定 vSphere Client 的逾時時間<block ref="ec8715bde1a929a6f64160d5372f4574" category="inline-link-rx"></block></block>
  <block id="e4306c4cf124046d8f90518752cd5021" category="list-text">ONTAP 工具的網路 CLI 工作階段登出時間為 30 分鐘。</block>
  <block id="7fb0cadcdae6feac05c7b8274b97b3c7" category="sidebar">ONTAP 工具強化概述</block>
  <block id="10b486896b1a91f5d38214dfb30c4263" category="sidebar">驗證 ONTAP 工具安裝套件的完整性</block>
  <block id="7c7c4cc4771d6114aa8b4d38f5817a85" category="sidebar">連接埠和通訊協定</block>
  <block id="919e26ea009ce7fa2dcc499a27ccc6aa" category="sidebar">存取點（使用者）</block>
  <block id="333dd505db0523536c6885f47456518c" category="sidebar">相互 TLS</block>
  <block id="6a3f3799bc264d32568bb7169ddd515a" category="sidebar">HTTPS憑證</block>
  <block id="4b7ad38343c4b2010cf81e6b2933e186" category="sidebar">登入橫幅</block>
  <block id="bfdb89134acf30ff5da790924cefa0ac" category="sidebar">閒置逾時</block>
  <block id="cb197b06aa92a742d01e256d58d3e34b" category="sidebar">DOS 攻擊</block>
  <block id="d870a4bd29f74339732a958574d2c4eb" category="sidebar">NTP 組態</block>
  <block id="339ce1d4220ba7045e3a35ef35279ad3" category="sidebar">密碼原則</block>
  <block id="3698338a95ad1801e25ed154adaf1a70" category="summary">適用於 VMware vSphere 的 ONTAP 工具安全強化指南、概觀與簡介。</block>
  <block id="47d29daaa26fbfa9c9a069d4cd023ac1" category="doc">適用於 VMware vSphere 的 ONTAP 工具安全性強化指南</block>
  <block id="fe0e23a929284a636c245a362ada6472" category="paragraph">適用於 VMware vSphere 的 ONTAP 工具安全性強化指南提供一套完整的指示、可協助您設定最安全的設定。</block>
  <block id="bc86ce4caa57368f9094a93dd72ffd28" category="paragraph">在需要 Domino 模式的情況下、 NetApp 提供 SnapMirror 同步（ SM-S ）。應用程式層級選項也存在、例如 Oracle DataGuard 或 SQL Server Always On Availability Groups 。作業系統層級的磁碟鏡射可以是一個選項。如需其他資訊和選項、請洽詢您的 NetApp 或合作夥伴客戶團隊。</block>
  <block id="8059304404c995bd8a349056e7d40e32" category="inline-link">_Broadcom_ 的 NetApp 虛擬化解決方案</block>
  <block id="cc5363f91541e771ebd890b2330cb8ba" category="paragraph"><block ref="cc5363f91541e771ebd890b2330cb8ba" category="inline-link-rx"></block></block>
  <block id="c90946faf2ed37e17d936e0b3acde7a7" category="summary">對靜態資料加密的需求與日俱增、超越傳統資料、延伸到所有儲存的資料類型。</block>
  <block id="b1e1676a19b222da72a55b95aa86d3e9" category="paragraph">如需深入探討更多安全性主題、請參閱下列資源。</block>
  <block id="e6bd708199eed7d8bf33ef8308be0b3e" category="inline-link-macro">安全技術報告</block>
  <block id="fb7f6edb08c080e81bd91a922a9d08f8" category="list-text"><block ref="fb7f6edb08c080e81bd91a922a9d08f8" category="inline-link-macro-rx"></block></block>
  <block id="ff8c9f0959eb84d21416835c3f9c89d6" category="inline-link-macro">安全強化指南</block>
  <block id="589b1ebfaed268e1548717208be6131f" category="list-text"><block ref="589b1ebfaed268e1548717208be6131f" category="inline-link-macro-rx"></block></block>
  <block id="e44de13cc4b452eccde9961bbe9da42b" category="inline-link-macro">ONTAP 安全性與資料加密產品文件</block>
  <block id="c76e848365d3a2199dfced47ddbf8690" category="list-text"><block ref="c76e848365d3a2199dfced47ddbf8690" category="inline-link-macro-rx"></block></block>
  <block id="7436b418bed093768e360d32105591d2" category="inline-link-macro">本文檔ONTAP Select</block>
  <block id="82fe32c89de73116e2188701ca735c39" category="list-text"><block ref="82fe32c89de73116e2188701ca735c39" category="inline-link-macro-rx"></block></block>
  <block id="f5c286d9dc4cdaffcb8e5c86388e6ed8" category="list-text"><block ref="f5c286d9dc4cdaffcb8e5c86388e6ed8" category="inline-link-macro-rx"></block></block>
  <block id="4dab2f9796b0af6304d00e21e2b9dfb4" category="inline-link-macro">AWS上的VMware Cloud</block>
  <block id="560d5b2cd40977bd7b77b31d7088f657" category="list-text"><block ref="560d5b2cd40977bd7b77b31d7088f657" category="inline-link-macro-rx"></block></block>
  <block id="9789f0612fda153726aa8ad87265e4b9" category="inline-link-macro">Azure VMware解決方案</block>
  <block id="f068ad668d317d445bc0da61125c318f" category="list-text"><block ref="f068ad668d317d445bc0da61125c318f" category="inline-link-macro-rx"></block></block>
  <block id="8cb69aa5b1609d0a39f0fcd576c07df6" category="inline-link-macro">Google Cloud VMware Engine</block>
  <block id="dadb2f85467c159b9d8387744cdd0ce6" category="list-text"><block ref="dadb2f85467c159b9d8387744cdd0ce6" category="inline-link-macro-rx"></block></block>
  <block id="e6288bb2b93ca74537fbff66317f01d9" category="inline-link-macro">什麼是 Google Cloud NetApp Volumes ？</block>
  <block id="e19aa8cca2f701dba5fc123376bebdb5" category="list-text"><block ref="e19aa8cca2f701dba5fc123376bebdb5" category="inline-link-macro-rx"></block></block>
  <block id="b44c4aa4ed40a2c01a89549bc8746cbd" category="cell">大多數vSphere 6.x版本的設定為512MB。
針對 6.5U3 、 6.7U3 和 7.0 或更新版本、設為預設（ 1024MB ）。</block>
  <block id="f3c4f211a4831f8f7c223705b0fccd5d" category="paragraph">處理量限制在控制服務層級、管理未知工作負載、或在部署前測試應用程式、以確保它們不會影響正式作業中的其他工作負載。它們也可用於在識別出高效能工作負載之後加以限制。</block>
  <block id="5ab12aefceb83851b73081a686bd30ab" category="section-title">ONTAP QoS 原則支援</block>
  <block id="8aa45e69fd8330d5e4d2f6e16309ff41" category="paragraph">也支援以IOPS為基礎的最低服務層級、以提供一致的效能、適用於ONTAP VMware的SAN物件、以及ONTAP 支援VMware的NAS物件。</block>
  <block id="98d229565d14d4d286f57a588a784c1e" category="inline-link-macro">效能監控與管理總覽</block>
  <block id="b7629a90716592b8dcae7480ad66d224" category="paragraph">請參閱 <block ref="de4b907e949a377b72cd0f0b0595d155" category="inline-link-macro-rx"></block> 以取得更多資訊。</block>
  <block id="81eba6b819a671b6c8962061afd13a78" category="section-title">非 VVols NFS 資料存放區</block>
  <block id="5bafceb9f14cf4b07086992cd31326a5" category="paragraph">ONTAP QoS 原則可套用至整個資料存放區或其中的個別 VMDK 檔案。不過、請務必瞭解、傳統（非 vVols ） NFS 資料存放區上的所有 VM 都會共用來自指定主機的通用 I/O 佇列。如果有任何 VM 受到 ONTAP QoS 原則的限制、則實際上這會導致該資料存放區的所有 I/O 似乎都受到該主機的節流限制。</block>
  <block id="1520a4910ffa6efc27379931cc307d0b" category="paragraph">*範例：*
* 您可以針對主機 ESX3-01 掛載為傳統 NFS 資料存放區的磁碟區、設定 vm1.vmdk 的 QoS 限制。
* 同一部主機（ ESX3-01 ）使用 VM2.vmdk 、而且位於同一個磁碟區。
* 如果 vm1.vmdk 受到節流、則 VM2.vmdk 也會被節流、因為它與 vm1.vmdk 共用相同的 IO 佇列。</block>
  <block id="caf18b31d986fc095c3c0cd6a1f19f9e" category="paragraph">從 vSphere 6.5 開始、您可以利用儲存 I/O 控制（ SIC ） v2 的儲存原則型管理（ SPBM ）來管理非 vVols 資料存放區的檔案精細限制。</block>
  <block id="c28029445f9803e209550517678387a9" category="paragraph">如需更多有關使用 SEIOC 和 SPBM 原則管理效能的資訊、請參閱下列連結。</block>
  <block id="8bef032522908e987555b77fb50dbb85" category="inline-link-macro">SPBM 主機型規則： SEIOC v2</block>
  <block id="98a7507b3e8be801707c07e336bc5506" category="inline-link-macro">使用 vSphere 管理儲存 I/O 資源</block>
  <block id="37b0c263c77e85e59d9f00438e870fa4" category="paragraph"><block ref="ea373db41b8c05446b96b46f4bbe1141" category="inline-link-macro-rx"></block>
<block ref="c5badf4fd27434d786395fe52801b533" category="inline-link-macro-rx"></block></block>
  <block id="cd6af799ac31b0fbf81bcbba1d3d6bf1" category="list-text">原則必須套用至<block ref="3b9aef0680339707b430261c2f800255" prefix=" " category="inline-code"></block> 其中包含實際的虛擬磁碟映像、而非<block ref="aa26c73336ecfd98ed727b3e249c7f90" prefix=" " category="inline-code"></block> （虛擬磁碟描述元檔案）或<block ref="092eb4dd2ca488962f4c22b3e8cc4ca0" prefix=" " category="inline-code"></block> （ VM 描述元檔案）。</block>
  <block id="9aa28dc739b66a86d9f73ba24b9dd4c2" category="paragraph">使用VMware vSphere 9.8及更新版本的VMware vSphere 9.8版的VMware VMware vCenter資料存放區提供增強的QoS功能。FlexGroup ONTAP您可以輕鬆地在資料存放區或特定VM的所有VM上設定QoS。如FlexGroup 需詳細資訊、請參閱本報告的「參考資料」一節。請注意、上述傳統 NFS 資料存放區的 QoS 限制仍然適用。</block>
  <block id="b5380e34617914719b059f6d55b97b66" category="section-title">VMFS 資料存放區</block>
  <block id="b74c42e3de8c5b901769e263bf236711" category="paragraph">使用 ONTAP LUN 時、 QoS 原則可套用至包含 LUN 或個別 LUN 的 FlexVol 磁碟區、但無法套用至個別 VMDK 檔案、因為 ONTAP 無法感知 VMFS 檔案系統。</block>
  <block id="e122a7a507ac1f580cc5b9f2632a851c" category="section-title">VVols 資料存放區</block>
  <block id="be1ca5bcad3b34c08e2b2d7bfc8a95e3" category="paragraph">您可以在個別 VM 或 VMDK 上輕鬆設定最低和 / 或最高 QoS 、而不會影響任何其他 VM 或 VMDK 、使用儲存原則型管理和 vVols 。</block>
  <block id="f5ac983ee93a7017d283971566bc828e" category="paragraph">為 vVol 容器建立儲存功能設定檔時、請在效能功能下指定最大和 / 或最小 IOPS 值、然後使用 VM 的儲存原則參考此 SCP 。建立VM或將原則套用至現有VM時、請使用此原則。</block>
  <block id="1f23e960871a0a77a49731a6b47646c5" category="inline-link-macro">VMware vSphere 虛擬磁碟區（ VVols ）搭配 ONTAP</block>
  <block id="8743b08c4d707cd145a4e7acce189480" category="cell">是（資料存放區可以節流）</block>
  <block id="b2891bc898f2a418aa349b623568299e" category="summary">Active IQ Unified Manager 可在 VMware vSphere 環境中監控及疑難排解 NetApp 儲存設備和效能問題。</block>
  <block id="b7ce758ec5c25cb23edfa4ead0d0097e" category="admonition">* 使用旋轉磁碟機時、 NetApp 建議 * 至少有 15% 的可用空間。這包括所有未使用的空間、包括集合體或磁碟區內的可用空間、以及因使用完整資源配置而分配但實際資料未使用的任何可用空間。當可用空間接近 10% 時、效能會受到影響。</block>
  <block id="5a7f49be424e282d22b4c3889f5cd341" category="paragraph">MetroCluster 是一項 ONTAP 功能、可在各個站台之間使用 RPO=0 同步鏡射來保護您的 Oracle 資料庫、並可在單一 MetroCluster 系統上擴充至支援數百個資料庫。</block>
  <block id="30160293c6cf2d26d13cbd294af7fb4c" category="paragraph">使用也很簡單。使用 MetroCluster 並不一定會增加或變更任何用於營運企業應用程式和資料庫的最佳競賽。</block>
  <block id="641cc5f60c71fe9f9a2e15c5cc680ec3" category="summary">適用於 VMware vSphere 、 TCP 連接埠和傳輸協定的 ONTAP 工具安全強化指南</block>
  <block id="273eb98a312e607888044e87e0210015" category="section-title">NetApp VVols 支援</block>
  <block id="551e3b0a48f99995daac658b17a1de62" category="list-text">* 更好的容量管理。 *Vasa 與 ONTAP 工具可視需要將儲存容量降至個別的集合層級、並在容量開始不足時提供多層警示。</block>
  <block id="38653f1dd04b13c5276f4f4a82e8506f" category="admonition">術語「連線」是指用於跨站台複寫的叢集連線。它並不指主機協定。無論叢集間通訊所使用的連線類型為何、 MetroCluster 組態中的所有主機端通訊協定都會如常支援。</block>
  <block id="6f343e6c5daed91ac953577dd5e1e06e" category="doc">喪失複寫連線能力</block>
  <block id="6f04ca443b44ef3da2adedd7c0cf36fa" category="paragraph">針對下列範例、假設站台 A 已設定為慣用站台。</block>
  <block id="f553ed0b13f8b38932589ba34432ab5a" category="paragraph">如果 SM-AS 複寫中斷、寫入 IO 就無法完成、因為叢集無法將變更複寫到相反的站台。</block>
  <block id="2ef1646841c5728f668289819e837437" category="section-title">站台 A （慣用站台）</block>
  <block id="47d7b1b43310c2ce615be2e71aed414d" category="paragraph">偏好的站台上的複寫連結失敗、在寫入 IO 處理中會有大約 15 秒的暫停、因為 ONTAP 會在判斷複寫連結確實無法連線之前、重試複寫的寫入作業。15 秒後、站台 A 系統會恢復讀寫 IO 處理。SAN 路徑不會變更、 LUN 也會保持連線。</block>
  <block id="bb713afeab82bcb45a45d3cc1411e3eb" category="section-title">站台B</block>
  <block id="dc68c1abbc392a93905ce712c45999eb" category="paragraph">由於站台 B 不是 SnapMirror 作用中同步偏好的站台、因此其 LUN 路徑將在大約 15 秒後變成無法使用。</block>
  <block id="3784559d5087e35dc7372b1c51cf920e" category="section-title">儲存系統故障</block>
  <block id="901afcf3108cffc70b3209e8613babf0" category="paragraph">儲存系統故障的結果與遺失複寫連結的結果幾乎完全相同。當仍在運作的站台發生 IO 暫停約 15 秒。一旦超過 15 秒、 IO 就會像往常一樣繼續在該站台上進行。</block>
  <block id="0ce6f0c843cdd28d3ff7284039730959" category="section-title">調解員遺失</block>
  <block id="6b9600f6a35d60a0773b02ff771e5be1" category="paragraph">中介服務無法直接控制儲存作業。它可作為叢集之間的替代控制路徑。它主要用於自動化容錯移轉、而不會有發生分裂的風險。在正常作業中、每個叢集都會將變更複寫到其合作夥伴、因此每個叢集都可以驗證合作夥伴叢集是否在線上並提供資料。如果複寫連結失敗、複寫就會停止。</block>
  <block id="878273b0ad33bf4f330480ad6262d08c" category="paragraph">安全自動容錯移轉需要協調員、因為否則儲存叢集就無法判斷雙向通訊是否因為網路中斷或實際儲存設備故障而中斷。</block>
  <block id="7bccc28ee4a5fac4fa93b691ca9733bc" category="paragraph">中介程序為每個叢集提供替代路徑、以驗證其合作夥伴的健全狀況。案例如下：</block>
  <block id="7ba0268be94dd09db527214e2f2862b4" category="list-text">如果叢集可以直接聯絡其合作夥伴、複寫服務就可以運作。無需採取任何行動。</block>
  <block id="5c3163ce1d24869bf6e6594bcd37901d" category="list-text">如果偏好的站台無法直接聯絡其合作夥伴或透過中介人聯絡、則會假設該合作夥伴實際上無法使用、或是被隔離、並已將其 LUN 路徑離線。接著、偏好的站台會繼續釋放 RPO=0 狀態、並繼續處理讀取和寫入 IO 。</block>
  <block id="e2c06d8468f627e9f8fdc9380204f00f" category="list-text">如果非偏好的站台無法直接聯絡其合作夥伴、但可以透過協調器聯絡、則會使其路徑離線、並等待複寫連線的恢復。</block>
  <block id="f7fd4567c8be042fc3f9be5b45124d76" category="list-text">如果非偏好的站台無法直接或透過營運協調員聯絡其合作夥伴、則會假設該合作夥伴實際上無法使用、或是被隔離、並已將其 LUN 路徑離線。然後、非偏好的站台會繼續釋放 RPO = 0 狀態、並繼續處理讀取和寫入 IO 。它將扮演複寫來源的角色、並將成為新的慣用站台。</block>
  <block id="1286d22222876588b31270c148d8c480" category="paragraph">如果調解器完全無法使用：</block>
  <block id="3cc95aae492aaec45753d6e6b7d91c12" category="list-text">複寫服務因任何原因而失敗、包括非慣用站台或儲存系統故障、將導致偏好的站台釋放 RPO = 0 狀態、並恢復讀寫 IO 處理。非慣用站台將使其路徑離線。</block>
  <block id="92395625e4bc805c933a9b4f52c5c594" category="list-text">偏好的站台故障將導致中斷、因為非偏好的站台將無法驗證相對站台是否確實離線、因此非偏好的站台無法安全恢復服務。</block>
  <block id="3450c1f3c1166bb5f38dd42c45eb1b70" category="section-title">還原服務</block>
  <block id="5a0a7b8380bda809ef1b210c3bb41b93" category="paragraph">解決故障（例如還原站台對站台連線或啟動故障系統）後、 SnapMirror 作用中同步端點會自動偵測是否存在錯誤的複寫關係、並將其恢復至 RPO=0 狀態。重新建立同步複寫後、故障路徑將再次上線。</block>
  <block id="8f3219fa36fad5d789373fdf883d28b1" category="paragraph">在許多情況下、叢集式應用程式會自動偵測失敗路徑的傳回、這些應用程式也會重新上線。在其他情況下、可能需要主機層級的 SAN 掃描、或是需要手動將應用程式恢復上線。這取決於應用程式及其設定方式、一般而言、這類工作可以輕鬆自動化。ONTAP 本身具有自我修復功能、不應需要任何使用者介入、即可恢復 RPO = 0 儲存作業。</block>
  <block id="52ec8762530eb85c0734309b6747a861" category="section-title">手動容錯移轉</block>
  <block id="afe62727c9717a186ce014753f902c8a" category="paragraph">變更偏好的站台需要簡單的操作。IO 會暫停一秒或兩秒、作為叢集之間複寫行為切換的權限、但 IO 不會受到影響。</block>
  <block id="2d430e41b39275608ed6816ee435f2c4" category="paragraph">調解器並不是真正的斷路器、但這實際上正是它所提供的功能。它不會採取任何行動、而是提供替代的通訊通道、讓叢集與叢集之間能進行通訊。</block>
  <block id="caeb8c810d4965bfc8ad369332977e54" category="inline-image-macro">SnapMirror 主動式同步圖表與中介器</block>
  <block id="2767cf2bbeaf5540c1e615745cfead81" category="paragraph">自動化容錯移轉的第一項挑戰是大腦分離問題、如果兩個站台彼此之間的連線中斷、就會發生這個問題。應該發生什麼事？您不想讓兩個不同的網站自行指定為資料的保存複本、但如何讓單一網站分辨相對網站的實際損失與無法與相對網站通訊的差異？</block>
  <block id="661d0a9679d7d1af0f76f646c941e5cc" category="paragraph">這是調解者輸入圖片的地方。如果放置在第三個站台上、而且每個站台都有與該站台的個別網路連線、則每個站台都有額外的路徑來驗證對方的健全狀況。請再次查看上圖、並思考下列案例。</block>
  <block id="d0c23d9c3fc0a960d3362e7ba10243f5" category="list-text">如果調解器故障或無法從一個或兩個站台連線、會發生什麼情況？</block>
  <block id="123c024944e0a1dd3f71661e6d0e5005" category="list-text">這兩個叢集仍可透過複寫服務所使用的相同連結彼此通訊。</block>
  <block id="00a2d2948ebb25dba32d9366b8655dfc" category="list-text">資料仍以 RPO = 0 保護提供</block>
  <block id="7ac2e4e468f2c732023f530f71ac9dbb" category="list-text">如果站台 A 故障會發生什麼情況？</block>
  <block id="ce89434a9a13b39dccbbded97d674de0" category="list-text">站台 B 會看到兩個通訊通道都中斷。</block>
  <block id="0a22d4bfa3bb021654f02d82cdbb9422" category="list-text">站台 B 將接管資料服務、但不使用 RPO=0 鏡射</block>
  <block id="2a7681a43b5e9647d24566f342ab0b27" category="list-text">如果站台 B 故障會發生什麼情況？</block>
  <block id="1c8ff8325f78bcc084c3c197606b5482" category="list-text">站台 A 會看到兩個通訊通道都中斷。</block>
  <block id="8a8e5bd62b16753898cefd37bdf7ccb4" category="list-text">站台 A 會接管資料服務、但不會使用 RPO=0 鏡射</block>
  <block id="11b1ce76911fece428e0edd5c9e7682f" category="paragraph">還有一個案例需要考量：資料複寫連結遺失。如果站台之間的複寫連結遺失、 RPO=0 鏡射顯然是不可能的。那麼應該發生什麼事？</block>
  <block id="3e2a78d8ed8be1e5b40ff81cc9e2a2d6" category="paragraph">這是由偏好的站台狀態所控制。在 SM 合夥關係中、其中一個站台是次要站台。這對正常作業沒有影響、所有資料存取都是對稱的、但如果複寫中斷、則必須中斷連結才能恢復作業。結果是首選站台將在不進行鏡射的情況下繼續作業、而次要站台將停止 IO 處理、直到複寫通訊恢復為止。</block>
  <block id="225caaa9ecf3ac7dfb141c808a1c1651" category="paragraph">SnapMirror 主動式同步（前身為 SnapMirror Business Continuity 或 SM-bc ）可讓個別的 SQL Server 資料庫和應用程式在發生任何中斷時繼續提供服務、而且儲存設備的透明容錯移轉不需要任何手動介入。</block>
  <block id="700cb79deb6ef819c0aacbb228c5a16b" category="paragraph">SnapMirror 主動式同步（ SM-AS ）是以 SnapMirror 同步為基礎。兩者都能提供 RPO=0 同步資料複寫、但 SMAS 可為 SAN 資料提供接近零的 RTO 可用度、進一步提升解決方案。這是透過管理 SAN 路徑的自動化來完成、以保持資料可用。站台、控制器和通訊故障均由 ONTAP 自動處理。</block>
  <block id="c159224eea5fb4a30b3cc9be6e90cd6c" category="paragraph">SnapMirror 主動式同步可提供存在於兩個不同站台上的 LUN 。在正常作業中、沒有「來源」或「目的地」。方向是雙向的。針對指定 LUN 路徑的所有讀取 IO 、將由本機控制器使用其本機資料複本來提供服務。所有寫入作業都會複寫到遠端合作夥伴、並在確認之前在本機寫入。</block>
  <block id="4a85397e66688e4e619ffe832e627548" category="inline-image-macro">SnapMirror 主動式同步總覽</block>
  <block id="ddc1e5dc440806435445e7a532ad1198" category="paragraph">從邏輯上來說、這種行為就像一組 LUN 。IO 可透過位於兩個不同叢集上的 SAN 路徑導向這些邏輯 LUN 、但資料永遠相同。IO 行為是對稱的、對許多主動式應用程式組態而言、這是至關重要的。</block>
  <block id="ddc5ca7c74db522011a3b2ddccda5b40" category="inline-image-macro">SnapMirror 主動式同步邏輯設計</block>
  <block id="daadd24f5163a10f9a2f016019883886" category="section-title">路徑管理</block>
  <block id="9bb9bee58b329761e36c7d9bf8900d6f" category="paragraph">SnapMirror 同步網路拓撲有兩種方法：統一和不統一。在統一存取和非統一存取之間選擇時、主要考量的因素是您是否可以或必須將 SAN 延伸至不同的站台。SnapMirror 主動式同步可在這兩種情況下使用。</block>
  <block id="1f46c4a6c97a8add22ae7c23181c23d8" category="paragraph">ONTAP Mediator 是從 NetApp 支援網站下載的軟體應用程式、通常部署在虛擬機器上。</block>
  <block id="91e17573d84d7d626cc27e989a3957bc" category="inline-link-macro">SnapMirror Active Sync 的 ONTAP 文件</block>
  <block id="ae81dd17263728532627374843ee0ff8" category="paragraph">有關規劃和組態步驟、請參閱<block ref="44f5d8051247437425911d96f84db248" category="inline-link-macro-rx"></block>。</block>
  <block id="5abea2d56204d1c15aa063dc90ccfb4f" category="paragraph">SnapMirror 作用中同步將一個站台視為「來源」、另一個則視為「目的地」。這表示單向複寫關係、但這不適用於 IO 行為。複寫是雙向的、對稱的、而且在鏡像的兩側、 IO 回應時間相同。</block>
  <block id="e5086daa5843466ff5f04f20d4c19d74" category="paragraph"><block ref="36cd38f49b9afa08222c0dc9ebfe35eb" prefix=" " category="inline-code"></block>指定是控制偏好的站台。如果複寫連結遺失、來源複本上的 LUN 路徑將繼續提供資料、而目的地複本上的 LUN 路徑將無法使用、直到 SnapMirror 重新建立複寫並重新進入同步狀態為止。然後路徑將恢復服務資料。</block>
  <block id="a0bbe7bd1e93252f1267d98703905552" category="paragraph">來源 / 目的地組態可透過 SystemManager 檢視：</block>
  <block id="13d0a54956b2dd09d5e909acadfb1694" category="inline-image-macro">SM 來源的螢幕擷取畫面</block>
  <block id="5b53b7d18b58af25bcf47dc21678038f" category="paragraph">或在 CLI ：</block>
  <block id="498b1bbe0e017f1ad405fe4c77fb8ea1" category="paragraph">關鍵在於來源為叢集 1 上的 SVM 。如上所述、「來源」和「目的地」兩詞並未說明複寫資料的流程。這兩個站台都可以處理寫入作業、並將其複寫到另一個站台。實際上、兩個叢集都是來源和目的地。將一個叢集指定為來源的效果、只是控制在複寫連結遺失時、哪個叢集仍保留為讀寫儲存系統。</block>
  <block id="18a07170e14f5cbc26533f0a136dfdd0" category="inline-image-macro">SnapMirror 主動式同步不一致的網路</block>
  <block id="9532c9e7afcd43c7d9bb5740695fc259" category="paragraph">這種方法的主要優點是 SAN 簡易性、您無需透過網路擴充 SAN 。有些客戶在站台之間沒有足夠的低延遲連線、或缺乏基礎架構、無法透過站台間網路來通道 FC SAN 流量。</block>
  <block id="439caacb19fa16f2c21563703ed645d7" category="paragraph">不一致存取的缺點是、某些失敗情況（包括遺失複寫連結）會導致部分主機失去儲存設備的存取權。以單一執行個體執行的應用程式、例如原本只在任何指定掛載的單一主機上執行的非叢集資料庫、如果本機儲存連線中斷、就會失敗。資料仍會受到保護、但資料庫伺服器將無法再存取。需要在遠端站台上重新啟動、最好是透過自動化程序來重新啟動。例如、 VMware HA 可偵測一部伺服器上的所有路徑停機情況、並在另一部可用路徑的伺服器上重新啟動 VM 。</block>
  <block id="9fad44ede04fb95c16ea64be5e51836c" category="paragraph">在許多情況下、透過站台對站台連結存取儲存設備的應用程式額外延遲成本是不可接受的。這表示統一網路的可用度提升到最低、因為站台上的儲存設備遺失、可能導致仍需要關閉該故障站台上的服務。</block>
  <block id="15da96ce40136a3259e04ae0dc25fc95" category="paragraph">由於簡單起見、本機叢集有多個備援路徑未顯示在這些圖表中。ONTAP 儲存系統本身就是 HA 、因此控制器故障不應導致站台故障。只會導致受影響網站上使用本機路徑的變更。</block>
  <block id="bb12626aefb7c36f9b13694d35dadd5d" category="paragraph">SM － as 的一項重要功能是能夠設定儲存系統、以瞭解主機的位置。將 LUN 對應至指定主機時、您可以指出 LUN 是否接近指定的儲存系統。</block>
  <block id="4590bab77464ba1a9c8ee6b8095eef60" category="inline-image-macro">SnapMirror Active Sync AFF 統一網路</block>
  <block id="2b2fdfa824f1319cc47992b1277faa78" category="paragraph">在正常作業中、所有 IO 都是本機 IO 。從本機儲存陣列提供讀取和寫入服務。寫入 IO 當然也需要由本機控制器複寫到遠端系統、然後才會被確認、但所有讀取 IO 都會在本機上提供服務、而且不會因在站台之間瀏覽 SAN 連結而產生額外延遲。</block>
  <block id="97b2bb0cfbae3fe49433caf537e819ec" category="paragraph">只有當所有主動 / 最佳化路徑都遺失時、才會使用非最佳化路徑。例如、如果站台 A 上的整個陣列失去電力、站台 A 的主機仍能存取站台 B 上陣列的路徑、因此仍可繼續運作、雖然延遲會較高。</block>
  <block id="5ab085bf88338486e590861594d3947a" category="paragraph">NetApp ASA 系統可跨叢集上的所有路徑提供雙主動式多重路徑。這也適用於 SM-AS 組態。</block>
  <block id="6511f0e2589c08e82bc8dd3e9bc93185" category="inline-image-macro">SnapMirror Active Sync ASA 統一網路</block>
  <block id="c3fe6771b27ffcb15a75ae88f6d57c4b" category="paragraph">具有非統一存取權的 ASA 組態、其運作方式與 AFF 大致相同。透過統一存取、 IO 就能跨越 WAN 。這可能是或不理想的做法。</block>
  <block id="498a9faf271a73dcf026b1041b66ef2a" category="paragraph">如果兩個站台相距 100 公尺、且具備光纖連線能力、則不應偵測到透過 WAN 的額外延遲、但如果站台相距很遠、則兩個站台的讀取效能都會受到影響。與此相反、 AFF 只有在沒有可用的本機路徑時、才會使用這些 WAN 路徑、而且因為所有 IO 都是本機 IO 、所以日常效能會更好。使用非統一存取網路的 ASA 可讓您選擇取得 ASA 的成本和功能效益、而不會造成跨站台延遲存取的損失。</block>
  <block id="15ab92b8042738f6acc912e2d98ae17a" category="paragraph">採用低延遲組態的 ASA 具有兩項有趣的優點。首先、它基本上是 * 任何單一主機的效能加倍 * 、因為 IO 可以由兩倍多的控制器使用兩倍的路徑來提供服務。其次、在單一站台環境中、它提供極高的可用度、因為整個儲存系統可能會遺失、而不會中斷主機存取。</block>
  <block id="41c719032afe187deaf4b4b2af41aa36" category="paragraph">ONTAP 9 8 及更新版本均提供溫度敏感儲存效率（ TSSE ）。它仰賴區塊存取熱圖來識別不常存取的區塊、並以更高效率加以壓縮。</block>
  <block id="8284eb5a9d9bef8f0f1ece257656d0fe" category="summary">ONTAP 上 Epic 的其他資訊</block>
  <block id="345245c83d2b2c4c2a5eb9f2887da627" category="paragraph">若要深入瞭解本文件所述資訊、請參閱下列文件和/或網站：</block>
  <block id="bc4fe2352063642d68529f2aa0ca7ca3" category="inline-link-macro">NetApp 產品文件</block>
  <block id="0897605072547ea93ef25a4b355ac5f6" category="list-text"><block ref="0897605072547ea93ef25a4b355ac5f6" category="inline-link-macro-rx"></block></block>
  <block id="5358757de9216cc29d688612a3d72fe1" category="inline-link-macro">ONTAP 9 文件</block>
  <block id="3973235e869d719328cf4b37e59562e5" category="list-text"><block ref="3973235e869d719328cf4b37e59562e5" category="inline-link-macro-rx"></block></block>
  <block id="c9cefb6ed873a418f8c8232dca6879d2" category="inline-link-macro">一致性群組</block>
  <block id="10d6aff3e86ebe3712a2616b45008fb3" category="list-text"><block ref="10d6aff3e86ebe3712a2616b45008fb3" category="inline-link-macro-rx"></block></block>
  <block id="0d3cc094235677831b5697c5bab76394" category="inline-link-macro">ONTAP 和 ONTAP 系統管理員文件資源</block>
  <block id="3b2c8ae1d985c88d539bf7851e067922" category="list-text"><block ref="3b2c8ae1d985c88d539bf7851e067922" category="inline-link-macro-rx"></block></block>
  <block id="e9bf68ed54b6d1ff63e8bda8c0b6a70f" category="inline-link-macro">TR-3930i：《NetApp Epic規模調整準則》（NetApp Sizing Guidelines for Epic）</block>
  <block id="920aa6d447930899ad56517c79fd12fc" category="list-text"><block ref="b6ff45309a811037a92ca1e6262c74a8" category="inline-link-macro-rx"></block>（需要 NetApp 登入）</block>
  <block id="840f4016fe968750d45ea4545f2f1893" category="section-title">EPIC 客戶指引文件</block>
  <block id="a839c9787ec80291f4b34dc5451786a5" category="paragraph">Epic 提供客戶下列文件、以取得伺服器、儲存設備和網路的指引。本技術報告會參考這些文件。</block>
  <block id="67bab37630accce3ea259fb1601fca2e" category="list-text">儲存區域網路考量</block>
  <block id="0fe2c5f32f45114c27e3b7a7ca0ba0ad" category="list-text">營運不中斷技術解決方案指南</block>
  <block id="2163e1881d92ff554d8969998a7d618f" category="list-text">All Flash 參考架構策略手冊</block>
  <block id="b332ca8d59cd86adb52c28aef982cc69" category="list-text">儲存產品與技術狀態</block>
  <block id="a0107bedc201b2df3694df573f65ae32" category="list-text">EPIC Cloud 考量事項</block>
  <block id="0cf7d14c360e7f8755d749057b348718" category="list-text">硬體組態指南（客戶專屬）</block>
  <block id="50923dab9020d1e069418763d0bd15a3" category="list-text">資料庫儲存配置建議（客戶專屬）</block>
  <block id="4e1249f2da2104e56555dec5d4d51e6a" category="summary">EPIC 四節點架構</block>
  <block id="7baf69c8e83ff08e0583426d011bc650" category="paragraph">下圖顯示四節點架構的儲存配置：正式作業中的 HA 配對、災難恢復中的 HA 配對。控制器的大小和磁碟數量是以後一個大小調整映像為基礎。</block>
  <block id="70ccc987c3596ca363e7b8d980858220" category="paragraph">NetApp 通過接受 SLM 建議的 AQO 策略來保證最低的樓層性能。Epic 支援將 ONTAP 上的儲存資源池整合到大幅減少的硬體上。如需更多資訊、請參閱 Epic 季度 Spats 文件。基本上、 Pool1 、 Pool2 和 NAS1 （列於 Epic 硬體組態指南中）都可以在單一 HA 配對上執行、工作負載平均分散在兩個控制器上。在災難恢復中、 Epic Pool 3 和 NAS 3 也會在 HA 配對中的兩個控制器之間分割。</block>
  <block id="34557edb2bf88cd4f837f2384ead1830" category="paragraph">測試完整複本環境（例如 SUP 、 REL 和 PJX ）是從 Epic Production 、 Epic Report 或 Epic Disaster Recovery 複製而成。如需 Epic 備份與重新整理的相關資訊、請參閱標題為「資料管理」一節。</block>
  <block id="5c8423bf649a8a50f33626549581cce9" category="section-title">四節點架構</block>
  <block id="f42ac2802f367c372897f3fb06218d2d" category="inline-image-macro">EPIC 4 節點架構</block>
  <block id="848f13dbd455e0190684bb8052ef94d6" category="paragraph"><block ref="848f13dbd455e0190684bb8052ef94d6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="14b8013c3961c3eb9f2d01aff2c9d430" category="section-title">四節點工作負載配置</block>
  <block id="8e576f920186d1c7001b6f1da66f2359" category="inline-image-macro">EPIC 4 節點放置</block>
  <block id="34594b0fc43be2425a0a68f14928bc8d" category="paragraph"><block ref="34594b0fc43be2425a0a68f14928bc8d" category="inline-image-macro-rx" type="image"></block></block>
  <block id="145a177f694025424b761a3b22ca2f6b" category="summary">EPIC 六節點架構</block>
  <block id="7682e26e53b5af35c13c22f5034f788a" category="paragraph">客戶可能想從六節點設計開始、或是在需求不斷增加的情況下、從四個節點無縫橫向擴充至六個節點。透過橫向擴充、您可以不中斷地在節點之間移動工作負載、並在叢集之間重新平衡。</block>
  <block id="121ec45abd57b78d2c63e13a01970fbf" category="paragraph">此架構可在叢集上提供最佳效能與容量平衡。Epic Production 、 Epic Report 及 Epic Test 均在第一對 HA 上執行。第二個 HA 配對用於 Clarity 、 Hyperspace 、 VMware 、 NAS1 及其餘 Epic 工作負載。災難恢復與上一節中的四節點架構相同。</block>
  <block id="628e6fdb5831f5144730fdfb620a1a2a" category="section-title">六節點架構</block>
  <block id="5d28884b83f218379ec90c789e2e382b" category="inline-image-macro">EPIC 6 節點架構</block>
  <block id="a5cf77b4851a534d4e7f8cbfc10e7734" category="paragraph"><block ref="a5cf77b4851a534d4e7f8cbfc10e7734" category="inline-image-macro-rx" type="image"></block></block>
  <block id="214d949b6d12c893a63f49d862292640" category="section-title">六節點工作負載配置</block>
  <block id="65ea1ebb7d9c2d858f8701fcbecd438d" category="inline-image-macro">EPIC 6 節點配置</block>
  <block id="77e8933cdf526d7670fcd797f57f81a7" category="paragraph"><block ref="77e8933cdf526d7670fcd797f57f81a7" category="inline-image-macro-rx" type="image"></block></block>
  <block id="a3ab98b5217808d71238c069623fa0ff" category="summary">EPIC 八節點架構</block>
  <block id="ab4e8eb50674d5d1bee79a6682b49325" category="paragraph">下圖顯示橫向擴充的八節點架構。同樣地、您可以從四個節點開始、擴充至六個節點、並繼續擴充至八個節點以上。此架構可在生產環境中的六個節點之間、提供最佳的效能與容量平衡。</block>
  <block id="0ef10ffde0c0ebd21feabe96ec890f72" category="paragraph">在本設計中、測試環境是從 Report 複製而非 Production 。這會減輕測試環境的負荷、並從正式作業環境中進行完整性檢查。</block>
  <block id="211891edb616b1a6e25c469a73cd07c9" category="section-title">八節點架構</block>
  <block id="3b31cb391c5fb328f6bcf768909f68a2" category="paragraph"><block ref="3b31cb391c5fb328f6bcf768909f68a2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="c344a01a287e43ab2ef2793cf550435a" category="section-title">八節點工作負載配置</block>
  <block id="80a544c0b0187e121e581e019d0902a9" category="inline-image-macro">EPIC 8 節點配置</block>
  <block id="e374fdf5079d6709ca8206b4c77be000" category="paragraph"><block ref="e374fdf5079d6709ca8206b4c77be000" category="inline-image-macro-rx" type="image"></block></block>
  <block id="17e9ce8e967d60724d7f53d467470a10" category="summary">EPIC 架構</block>
  <block id="b1830ae1e99adb346ce1da353cd6c089" category="paragraph">本節說明 Epic 軟體環境及需要儲存的關鍵元件。它提供重要考量、協助引導儲存設計。</block>
  <block id="4db273f137d059bd4ffd23818c367214" category="paragraph">Epic 總部位於威斯康星州維羅納、為大中型醫療集團、醫院及整合式醫療組織製作軟體。客戶還包括社區醫院、學術機構、兒童組織、安全網供應商和多醫院系統。EPIC 整合式軟體涵蓋臨床、存取和營收功能、並延伸至家庭。</block>
  <block id="27cd823999704d6e14cdee1e83bef7f0" category="paragraph">本文件不涵蓋Epic軟體所支援的廣泛功能範圍。然而、從儲存系統的角度來看、所有 Epic 軟體都會針對每個部署共用一個以病患為中心的資料庫。EPIC 正在從 InterSystems Cache 資料庫移轉至全新的 InterSystems Iris 資料庫。由於 Cache 和 Iris 的儲存需求相同、因此在本文的其餘部分、我們會將資料庫稱為 Iris 。Iris 適用於 AIX 和 Linux 作業系統。</block>
  <block id="4e25ab2bd75f003927aabf72608c3610" category="section-title">跨系統虹膜</block>
  <block id="0af82ac784148ef3818d2fe5b04763fa" category="paragraph">InterSystems Iris 是 Epic 應用程式所使用的資料庫。在此資料庫中、資料伺服器是持續儲存資料的存取點。應用程式伺服器可管理資料庫查詢、並向資料伺服器提出資料要求。對於大多數 Epic 軟體環境、在單一資料庫伺服器中使用對稱式多處理器（ SMP ）架構、就足以滿足 Epic 應用程式的資料庫要求。在大型部署中、可使用 InterSystems 的 Enterprise Cache Protocol （ ECP ）來支援分散式模型。</block>
  <block id="8dfea4e602a85bafff792b879b2d056b" category="paragraph">使用啟用容錯移轉的叢集硬體、可讓待命資料伺服器存取與主要資料伺服器相同的儲存設備。它也能讓待命資料伺服器在硬體故障期間接管處理責任。</block>
  <block id="c77ab217583518f1b67702b591baf929" category="paragraph">InterSystems 也提供技術來滿足資料複寫、災難恢復和高可用度（ HA ）需求。InterSystems 的複寫技術可用於同步或非同步地從主要資料伺服器複寫 IRIS 資料庫至一或多個次要資料伺服器。NetApp SnapMirror 用於複寫 WebBLOB 儲存設備、或用於備份與災難恢復。</block>
  <block id="df2e58f9c6f746010ccdd5cf07673500" category="paragraph">更新的虹膜光圈資料庫有許多優點：</block>
  <block id="f8ffd660138274e3b7b31f900153e4b6" category="list-text">擴充規模並讓擁有多個 Epic 執行個體的大型組織能夠整合為一個較大的執行個體。</block>
  <block id="242ef58734fef1421d6cc1e1154bd041" category="list-text">客戶現在可以在 AIX 和 Red Hat Enterprise Linux （ RHEL ）之間移動、而無需支付新的平台授權。</block>
  <block id="08a78b85487809e2116574e4ff97dec5" category="section-title">Cache 資料庫伺服器與儲存使用量</block>
  <block id="4cc33a0396ddd5a29816a3a40d01a6b5" category="list-text">* Production * 在 Epic 軟體環境中、部署單一以病患為中心的資料庫。在 Epic 的硬體需求中、主控讀取 / 寫入虹膜光圈資料伺服器的實體伺服器稱為正式作業資料庫伺服器。此伺服器需要高效能的 All Flash 儲存設備來儲存屬於主要資料庫執行個體的檔案。為了達到高可用度、 Epic 支援使用容錯移轉資料庫伺服器、該伺服器可存取相同的檔案。Iris 使用 Epic Mirror 複寫至唯讀報告、災難恢復及支援唯讀複本。由於業務持續運作的原因、每種類型的資料庫伺服器都可以切換為讀取 / 寫入模式。</block>
  <block id="cdbcd4cba3ac1d1b15d302df69df1198" category="list-text">* 報告 * 報告鏡像資料庫伺服器提供正式作業資料的唯讀存取權。它主控設定為正式作業的 Iris 資料伺服器備份鏡射的虹膜光圈資料伺服器。報告資料庫伺服器的儲存容量需求與正式作業資料庫伺服器相同。報告寫入效能與正式作業相同、但讀取工作負載特性不同、大小不同。</block>
  <block id="10938a446d1d37c3afcad8aac850f514" category="list-text">* 支援唯讀 * 此資料庫伺服器為選用功能、並未顯示下圖。也可以部署鏡射資料庫伺服器來支援 Epic 的唯讀功能、其中提供唯讀模式的正式作業複本存取權。基於營運不中斷的理由、此類型的資料庫伺服器可切換至讀取 / 寫入模式。</block>
  <block id="32042e6794444e49e092cad346b66b28" category="list-text">* 災難恢復 * 為了達到業務持續性和災難恢復目標、災難恢復鏡像資料庫伺服器通常部署在與正式作業和 / 或報告鏡像資料庫伺服器位於不同地理位置的站台上。災難恢復鏡射資料庫伺服器也會主控設定為正式作業的 Iris 資料伺服器備份鏡像的虹膜資料伺服器。如果正式作業站台長時間無法使用、則可將此備份鏡射資料庫伺服器設定為作為鏡射讀寫執行個體（ SRW ）。備份鏡射資料庫伺服器的檔案儲存需求與正式作業資料庫伺服器相同。相反地、備份鏡射資料庫儲存設備的大小與正式作業儲存設備的大小相同、從效能的角度來看、可確保業務持續運作。</block>
  <block id="d05c7e253f48b314f8488aba0e85b3b4" category="inline-image-macro">EPIC IRIS ODB</block>
  <block id="90cb7e5b029ac3a1b754d9f0d75bfbb9" category="paragraph"><block ref="90cb7e5b029ac3a1b754d9f0d75bfbb9" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b101ffd23847579c0cf3cb028fc314ee" category="list-text">* 測試 * 醫療組織通常會部署開發、測試及接移環境。這些環境的其他虹膜光圈資料伺服器也需要儲存設備、可由同一個儲存系統容納。EPIC 對於從共享儲存系統提供額外儲存設備有特定要求和限制。本文件中的最佳實務做法一般會解決這些特定需求。</block>
  <block id="5c52f2993ead7ce33b4600c9955d9657" category="paragraph">除了虹膜晶片（ Iris odb ）資料伺服器之外、 Epic 軟體環境通常還包括其他元件、例如下列元件、如下圖所示：</block>
  <block id="c352fde153a95627d87a161b60e9e211" category="list-text">Oracle 或 Microsoft SQL Server 資料庫伺服器、作為 Epic Clarity 商業報告工具的後端</block>
  <block id="72e364f0316ce75144d3bcbc76627977" category="admonition">Clarity 用於報告每日從報告的虹膜光圈資料庫擷取的資料。</block>
  <block id="9c7d7e54119a875f7f730fac34d86939" category="list-text">WebBLOB 伺服器（ SMB ）</block>
  <block id="7f140c68d528349ef23a9adde829618a" category="list-text">多用途資料庫伺服器</block>
  <block id="db670b036ce103ccc68fe4a2f746bcbb" category="list-text">多用途虛擬機器（ VM ）</block>
  <block id="46f49acf82ce78d08668061bb78e679a" category="list-text">用於用戶端存取的 Hyperspace</block>
  <block id="847ce339c80d3a544fdd1e3ea23f89ed" category="inline-image-macro">EPIC 資料庫</block>
  <block id="ddc0ff60fb0cba83974547cb2fd7a40e" category="paragraph"><block ref="ddc0ff60fb0cba83974547cb2fd7a40e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="300c335aaf3a97bb6020a19be0b8ca96" category="paragraph">所有這些多重工作負載、集區、 NAS 和 SAN 通訊協定的儲存需求、都可以由單一 ONTAP 叢集加以整合和代管。這項整合可讓醫療組織針對所有 Epic 及非 Epic 工作負載、制定單一資料管理策略。</block>
  <block id="4a7de8a55a290fb3a0a4efd490ec781b" category="section-title">營運資料庫工作負載</block>
  <block id="a627911d38337b81dddab9711a61842c" category="paragraph">每部 Epic 資料庫伺服器都會對下列檔案類型執行 I/O ：</block>
  <block id="458648f675593beefe031e7b7ba9fcdd" category="list-text">資料庫檔案</block>
  <block id="07599d3aee2c26c36cae1cb305a0d120" category="list-text">日誌檔案</block>
  <block id="b9c807a9cbbe80f3b710d64a47334ecf" category="list-text">應用程式檔案</block>
  <block id="4b11d0da3422be079767b9c81ea967cb" category="paragraph">個別資料庫伺服器的工作負載取決於其在 Epic 軟體環境中的角色。例如、正式作業資料庫檔案通常會產生最嚴苛的工作負載、包括 100% 隨機 I/O 要求。任何鏡射資料庫的工作負載通常較不嚴苛、讀取要求也較少。日誌檔案工作負載主要是連續的。</block>
  <block id="6908d08a516bc86d102ccafa6c2ece9d" category="paragraph">Epic 維護的工作負載模式適用於儲存效能基準測試和客戶工作負載。如需 Epic 工作負載模型、基準測試結果、以及使用 NetApp 規模調整工具來正確調整 Epic 環境儲存容量的詳細資訊、請參閱<block ref="81c36a9e6d224e9d42c9630dffaa9434" category="inline-link-rx"></block>（需要 NetApp 登入）。</block>
  <block id="f71d6b15e61746171efc106f495b60cd" category="paragraph">EPIC 也為每位客戶提供自訂的硬體組態指南、其中包含 I/O 預測和儲存容量需求。最終的儲存需求可能包括開發、測試和 / 或移接環境、以及任何其他可能整合的輔助工作負載。客戶可以使用硬體組態指南、將總儲存需求傳達給 NetApp 。本指南包含設定 Epic 部署規模所需的所有資料。</block>
  <block id="c7a0b1a5f7a146b9b72947b2bba045ed" category="paragraph">在部署階段、 Epic 提供資料庫儲存配置指南、提供更精細的 LUN 層級詳細資料、可用於進階儲存設計。請注意、《資料庫儲存配置指南》是一般儲存建議、並非 NetApp 專屬的建議。使用本指南來判斷 NetApp 的最佳儲存配置。</block>
  <block id="ab3b24e1e2a3f9784a9c6cad8db20a76" category="summary">大尺寸</block>
  <block id="706a0ec5dbae849750639964dc6b852f" category="paragraph">在評估 Epic 儲存環境時、其中一項重要架構考量事項是 ODB 資料庫大小。</block>
  <block id="abe227b9b306ed7c0527800b44a2f1d0" category="paragraph">您可以使用下圖選取中小型大型 Epic 儲存架構。這些設計包括執行《硬體組態指南》中列出的所有工作負載。規模調整樹狀結構是根據 100 多份硬體組態指南中的資料而定、而且應該是最準確的預估值。</block>
  <block id="be0322041cc582d91f5f470df1ef2ba4" category="paragraph">請務必注意、這只是起點。您應該與 Epic 聯盟團隊合作、確認任何 Epic 設計。您可以在 EPIC @ NetApp .com 聯絡團隊。每個部署作業都需要滿足客戶要求、同時遵循 Epic 和 NetApp 建議的最佳實務做法。</block>
  <block id="20e8e833e31ffb5776ac701658144bd3" category="list-text">Epic 小型架構、 Epic 資料庫低於 10TB</block>
  <block id="5d8ee21ec144a04a8287c0171b9a8527" category="list-text">中型 Epic 架構、採用 Epic 資料庫、介於 10TB 至 50TB 之間</block>
  <block id="79ac7005a81d3ad4f64a1a5f5db00c7e" category="list-text">大型 Epic 架構、 Epic 資料庫容量大於 50TB</block>
  <block id="650c96055e8747d8b8a4c503b32aea8d" category="inline-image-macro">史詩般的尺寸指南</block>
  <block id="1c2004236bc67ea5f8fcc53a967ce698" category="paragraph"><block ref="1c2004236bc67ea5f8fcc53a967ce698" category="inline-image-macro-rx" type="image"></block></block>
  <block id="431d999c23fb9c149586aa971425928e" category="summary">EPIC 儲存需求</block>
  <block id="8afb3f2b206e0239313a484fe51999d7" category="paragraph">專屬的儲存資源通常會提供給正式作業資料庫、而鏡射資料庫執行個體則會與其他 Epic 軟體相關元件（例如 Clarity 報告工具）共用次要儲存資源。</block>
  <block id="d31081e8762bd0903adf5d3f0b769e73" category="paragraph">其他軟體儲存環境（例如用於應用程式和系統檔案的環境）也由次要儲存資源提供。</block>
  <block id="ed879cdc9a77683dfbe5be59441dec43" category="paragraph">除了規模調整考量之外、 Epic 還有下列額外的儲存配置規則和重要考量：</block>
  <block id="ba76cf08b10101b5fee8e2e6d0da268e" category="list-text">自 2020 年起、所有營運資料庫（ odb ）工作負載都必須位於 All Flash Array 上。</block>
  <block id="542f0f7c69fde2bd55b5a36854a84fa3" category="list-text">EPIC 建議每個儲存池位於不同的實體硬體上、包括 Pool1 、 Pool2 、 Pool3 、 NAS1 和 NAS2 。</block>
  <block id="919d67cad73121e6af0b2b20169d947b" category="admonition">叢集中的節點可視為儲存資源池。使用 ONTAP 9 的 4 或更新版本和 AQO 、您可以使用原則建立受保護的集區。</block>
  <block id="4449a7b5d2b5dfb4b1bad2ed2f86b5fd" category="list-text">全新 Epic 3-2-1 備份建議。</block>
  <block id="b560499317ab0447790f01d7acd5401b" category="list-text">位於遠端站台的複本（災難恢復）</block>
  <block id="09d6c5f51239ea513e80e433549993f4" category="list-text">其中一個複本必須位於與主要複本不同的儲存平台上</block>
  <block id="df5be706f042b26557014aa77c608eb6" category="list-text">資料複本</block>
  <block id="47311b53e9ae798223e097c4249a0668" category="admonition">使用 NetApp SnapMirror 備份 NetApp 的客戶不符合 3-2-1 建議。原因是 ONTAP to ONTAP 不符合上述第二項要求。您可以直接從 ONTAP 使用 SnapMirror 來在內部部署（例如透過 StorageGRID ）或雲端上物件儲存、以滿足 Epic 的需求。</block>
  <block id="fef74abf89ce7520dbdabb6ae983ee4b" category="paragraph">如需更多關於儲存設備要求的資訊、請參閱下列適用於 Galaxy 的 Epic 指南：</block>
  <block id="bed1a6db332388739ca169835c6c3425" category="list-text">SAN考量</block>
  <block id="9080906c2106e0567c91717cc003d027" category="list-text">儲存產品與技術狀態（ Spats ）</block>
  <block id="81b560a1124b6edc7fe2858e332661b6" category="list-text">硬體組態指南</block>
  <block id="db11e37a9250a9db4d48618851771913" category="summary">EPIC 儲存快照組態</block>
  <block id="4cbb03cae0c07fb5c8e5d5e6df97064e" category="doc">EPIC 儲存效率組態</block>
  <block id="bc9c71d0bf41f8b2c8bde032eb1d97d0" category="paragraph">儲存設備分散於多個磁碟區、且擁有一個或多個適當數量的 LUN 以滿足工作負載需求的應用程式、需要將內容一起備份、以確保資料保護一致。</block>
  <block id="d43039551f875a24f15f154306be2586" category="paragraph">一致性群組（簡稱 CGS ）提供這項功能及更多功能。您可以在夜間使用這些快照、使用原則來建立隨需或排程一致的快照。您可以使用此選項來還原、複製甚至複寫資料。</block>
  <block id="cbe00f2bdd9a3c8aaaf5f8159a8750c1" category="paragraph">如需 CGS 的其他資訊、請參閱<block ref="acc09d7e0c59ae3310cafae5d547383a" category="inline-link-macro-rx"></block></block>
  <block id="e62f16b222adc7aecc70ff7b56e652dc" category="paragraph">一旦按照本文前幾節的詳細說明配置了這些卷和 LUN ，就可以將它們配置成一組 CGS 。建議的最佳實務做法是如下圖所示設定：</block>
  <block id="7dd784e39903a42471f96a6d0d6ae420" category="inline-image-macro">EPIC 一致性群組配置</block>
  <block id="909e3795441b963b86fcad387196919f" category="paragraph"><block ref="909e3795441b963b86fcad387196919f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="45dbe5c870e6de731da235aab8c51046" category="paragraph">每晚的 CG 快照排程應設定在每個與提供正式作業資料庫儲存設備之磁碟區相關的子 CGS 上。這將使這些 CGS 每天晚上都有一組全新的一致備份。然後、這些資料可用於複製正式作業資料庫、以用於開發和測試等非正式作業環境。NetApp 針對 Epic 開發專屬的 CG 型自動化 Ansible 工作流程、以自動化生產資料庫的備份、更新及測試環境。</block>
  <block id="a93362f9de0aff40adccba50a939a6fa" category="paragraph">CG 快照可用於支援 Epic 正式作業資料庫的還原作業。</block>
  <block id="4bf6f09e67952b918985533c270b0668" category="paragraph">對於 SAN 磁碟區、請停用用於 CGS 的每個磁碟區上的預設快照原則。這些快照通常由使用中的備份應用程式或 NetApp 的 Epic Ansible 自動化服務來管理。</block>
  <block id="7082753514151e011ff039e6fe23eba2" category="paragraph">對於 SAN 磁碟區、請停用每個磁碟區上的預設快照原則。這些快照通常由備份應用程式或 Epic Ansible 自動化管理。 [NS2]</block>
  <block id="669d2da75a76d767cc8259b5f37cacc3" category="paragraph">WebBLOB 和 VMware 資料集應設定為僅限 Volume 、而非與 CGS 相關聯。您可以使用 SnapMirror 在不同於正式作業的儲存系統上維護快照。</block>
  <block id="5a6fb6753e1c4f748d223c8e329133fb" category="paragraph">完成後、組態將如下所示：</block>
  <block id="926ce6c3b85cb26b415b6fc7e43f2879" category="inline-image-macro">Epic with CG 快照</block>
  <block id="a578d209aa95904cf62330de918a003d" category="paragraph"><block ref="a578d209aa95904cf62330de918a003d" category="inline-image-macro-rx" type="image"></block></block>
  <block id="193e03aa51a18f1e5d72b6a9dd240ed7" category="paragraph">ONTAP 內嵌效率預設為開啟、無論儲存傳輸協定、應用程式或儲存層為何、都能正常運作。</block>
  <block id="f900dc6292f9bf9dcf98291ad5846d4b" category="paragraph">效率可減少寫入昂貴 Flash 儲存設備的資料量、並減少所需的磁碟機數量。ONTAP 可透過複寫來維持效率。即使是 Epic 等對延遲敏感的應用程式、每種效率對效能幾乎沒有影響。</block>
  <block id="936d07f32ce5afcd55e98c4a8cbce642" category="paragraph">* NetApp 建議 * 開啟所有效率設定、以最大化磁碟使用率。這些設定在 AFF 和 ASA 型系統上預設為開啟。</block>
  <block id="d4a551eeebb2992a4ffff1ad1083479a" category="paragraph">下列功能可提高儲存效率：</block>
  <block id="cc0df1dcdfa0541f9c5dde8e0b570a36" category="list-text">重複資料刪除功能可移除主 LUN 所在磁碟區中區塊的備援複本、進而節省主儲存區的空間。此建議選項預設為開啟。</block>
  <block id="db37fd6533f852997b6ae076ae5e86e0" category="list-text">內嵌壓縮可減少寫入磁碟的資料量、並透過 Epic 工作負載大幅節省空間。此建議選項預設為開啟。</block>
  <block id="c8afff3d362092825c7eda5b0b6b39af" category="list-text">即時資料實作需要的 4K 區塊不足一半、並將其整合為單一區塊。此建議選項預設為開啟。</block>
  <block id="b158d6ac5a43e19d1be67d7ba849494d" category="list-text">精簡複寫是 NetApp 資料保護軟體產品組合的核心、其中包括 NetApp SnapMirror 軟體。SnapMirror 精簡複寫可保護業務關鍵資料、同時將儲存容量需求降至最低。* NetApp 建議 * 開啟此選項。</block>
  <block id="13fb0a52e16b7b3839f151b0847cd0d1" category="list-text">集合式重複資料刪除技術重複資料刪除功能一律處於磁碟區層級。有了 ONTAP 9 2 、就能使用 Aggregate 重複資料刪除技術、節省更多磁碟資源。後處理序 Aggregate 重複資料刪除已新增至 ONTAP 9 。 3* NetApp 建議 * 開啟此選項。</block>
  <block id="46269eefafcbb08ab4667022c6491767" category="summary">EPIC 與檔案傳輸協定</block>
  <block id="73a17ad0a24141989f242b5b099eec4f" category="paragraph">支援在同一個 All Flash 陣列上結合 NAS 和 SAN 。</block>
  <block id="688ffca27fb85bfb71c8a7632a871ec1" category="paragraph">* NetApp 建議 * 將 FlexGroup Volume 用於 NAS 共用區、例如 WebBLOB （若有）。</block>
  <block id="55449fd175613962d882ab450cfc5f3c" category="inline-link-macro">FabricPool</block>
  <block id="1cd6516d7f54730b868069e2db63b528" category="paragraph">WebBLOB 的冷資料高達 95% 。您可以選擇使用 ONTAP 的功能、將所有 Flash 陣列和階層備份及冷資料的空間、釋放到內部部署或雲端的物件儲存空間<block ref="e722be9b80fb0aa9c356c4300710e630" category="inline-link-macro-rx"></block>。所有這些都可以在沒有任何明顯效能影響的情況下完成。FabricPool 是 ONTAP 的一項隨附功能。客戶可以產生冷（或非作用中）資料報告、以檢視啟用 FabricPool 可實現多少效益。您可以透過原則將資料的存留期設定為階層。EPIC 客戶利用這項功能大幅節省成本。</block>
  <block id="fc3145f7fe85a0cdfffb31f4034ada3b" category="summary">Epic on ONTAP - 主機公用程式</block>
  <block id="f2f8d65f0baeae6d15c1016784ddadbf" category="paragraph">NetApp 主機公用程式是適用於各種作業系統的軟體套件、其中包含管理公用程式、例如<block ref="3a8e4afa851609127d534b04e7d29c08" prefix=" " category="inline-code"></block> CLI 二進位、多重路徑驅動程式、以及正常 SAN 作業所需的其他重要檔案。</block>
  <block id="23cfb87b0ff3960aab8099cbbb63b50b" category="inline-link-macro">SAN 主機</block>
  <block id="b0a8af1d81527bdd65ec0e8fb2a4b4e0" category="paragraph">* NetApp 建議 * 在連接至儲存系統的主機上安裝 NetApp 主機公用程式、並存取 NetApp 儲存系統。如需詳細資訊、請參閱<block ref="b2445b429f9784426e3dc1158e67c70d" category="inline-link-macro-rx"></block>與<block ref="7d7a0f71ed9bf2fe94a10fa9e1aeb381" category="inline-link-macro-rx"></block>文件。</block>
  <block id="54ed29e411552372c5b6b9e2e1617e6d" category="admonition">在 AIX 中、在探索 LUN 之前安裝主機公用程式尤其重要。如此可確保 LUN 多重路徑行為已正確設定。如果在未使用主機公用程式的情況下執行探索、則需要使用命令從系統取消設定 LUN 、然後透過或重新開機重新探索<block ref="fe54d1c30028417038a4ffe0fc5eb503" prefix=" " category="inline-code"></block> LUN<block ref="9442434081221d63eaaa2c4799062866" prefix=" " category="inline-code"></block> 。</block>
  <block id="e7a8be60cff2fec7b8ed793c4d2dddfe" category="summary">EPIC LUN 和 Volume 組態</block>
  <block id="acdbb325faec5e3e2d86b3dbbaf90c54" category="paragraph">Epic 資料庫儲存配置建議文件提供每個資料庫 LUN 大小和數量的指引。</block>
  <block id="a620ecf0a73eb209a145eb913a29bc5a" category="paragraph">請務必與 Epic DBA 和 Epic 支援人員一起檢閱本文件、並確定 LUN 和 LUN 大小的數量、因為它們可能需要調整。這些儲存建議對於 HBA 佇列深度、儲存效能、操作簡易性和擴充簡易性都很重要。</block>
  <block id="21ebeea1f14a138dfebb1b9599a4c3dd" category="paragraph">為了最大化工作負載的效能、例如 Epic odb 或 Clarity 、每種配置也最適合 NetApp 儲存設備。使用八個磁碟區時、寫入 IO 會平均分散在各個控制器上、以最大化 CPU 使用率。對於複寫和備份、最好將磁碟區數量限制在八個、以簡化作業。</block>
  <block id="90adf331b7868c7af46ad6e035e93844" category="section-title">擴充選項</block>
  <block id="b323bb297a66afc2eea7b89dd4019798" category="section-title">Volume 和 8-LUN 配置</block>
  <block id="66d125e77a6185ef5cf43b2a6bffea80" category="inline-image-macro">EPIC 8-LUN 配置</block>
  <block id="99a54ac1eaa5bd57b4c4c29d6a63f1ac" category="paragraph"><block ref="99a54ac1eaa5bd57b4c4c29d6a63f1ac" category="inline-image-macro-rx" type="image"></block></block>
  <block id="bad4d79343f04d8b64999875ad328086" category="list-text">平衡 HA 配對中的工作負載、以最大化效能與效率。</block>
  <block id="26b591a32a8a235db7f742995589a455" category="list-text">使用精簡配置的磁碟區和 LUN 。</block>
  <block id="9fb0aaeb125238e83485971ae6b7e2fc" category="list-text">使用至少八個 DB LUN 、兩個日誌 LUN 和兩個應用程式 LUN 。此組態可將儲存效能和作業系統佇列深度最大化。如果需要容量或其他原因、可以使用更多資源。</block>
  <block id="ba5e00554d1ba1b8ca0fc2eaeda44672" category="list-text">如果您確實需要將 LUN 新增至磁碟區群組、請一次新增八個 LUN 。</block>
  <block id="08c8ec6a9fefcf9c5c7dff1258aacf67" category="list-text">若要將磁碟區和 LUN 群組備份在一起、則需要一致性群組（ CGS ）。</block>
  <block id="f513b81222a1b44f552ae172aeb697c9" category="list-text">請勿在 Genio 或任何 I/O 效能期間使用 QoS 。</block>
  <block id="b77a34499937c829a2c5c5a1cdc17f05" category="list-text">在 Genio 或 Clarity 測試之後、 NetApp 建議您在載入正式作業資料之前、先刪除儲存設備並重新配置資源。</block>
  <block id="186bc47646aec5e2abf40b2605a16461" category="list-text">在 LUN 上設定啟用是很重要的<block ref="54645d7349dcc4fe9d7d19985a40c2c9" prefix=" " category="inline-code"></block>。否則、 ONTAP 將不會看到 LUN 上任何刪除的資料、並可能導致容量問題。如需詳細資訊、請參閱 Epic Storage Configuration 快速參考指南。</block>
  <block id="153c47e1653d87804319da1fe347f29b" category="summary">EPIC 效能管理</block>
  <block id="912975539030067a6f1874223cda9b75" category="paragraph">大多數的 All Flash 陣列都能提供 Epic 工作負載所需的效能。NetApp 與眾不同之處在於能夠設定樓層等級的效能原則、並確保每個應用程式的效能一致。</block>
  <block id="edfc4c86589e31546a8fb2d8b085b8c9" category="section-title">服務品質（QoS）</block>
  <block id="8080e6f80ff76b571829265ee2917e87" category="paragraph">NetApp 建議使用 QoS 。QoS 的優點是能夠整合所有 Epic 工作負載。所有的傳輸協定和儲存資源池都可以位於較少的硬體上。您不需要將儲存資源池分開。</block>
  <block id="44c2f7cd7c41efaae67916780bf96079" category="list-text">NetApp 建議將叢集中的所有工作負載指派給 QoS 原則、以更有效地管理叢集上的保留空間。</block>
  <block id="d90d7fd828646173964451dadbe758c1" category="list-text">NetApp 建議在 HA 配對之間平均平衡所有工作負載。</block>
  <block id="a77412a540f86bfc443abfcef22db414" category="list-text">執行任何 I/O 測試時、請勿使用 QoS 原則、否則 Genio 測試將會失敗。在指派任何 QoS 原則之前、請先分析不同的正式作業工作負載 2-4 週。</block>
  <block id="c36c006dced61f1e460ff43516fa7294" category="summary">Epic on ONTAP - 傳輸協定</block>
  <block id="0f079f7da3a6e5c8a52a3aca113fd3e6" category="paragraph">FCP 是呈現 LUN 的慣用傳輸協定。</block>
  <block id="97ec588f063ba0f25df2b93eda2639c8" category="paragraph">* NetApp 建議 * 單一啟動器分區：每個區域有一個啟動器、並使用全球連接埠名稱（ WWPN ）在儲存設備上提供所有必要的目標連接埠。在單一區域中存在多個啟動器、可能會導致間歇性 HBA 串擾、進而造成重大中斷。</block>
  <block id="880bc24c60e1d6eb559f57440c27f955" category="paragraph">建立 LUN 之後、將 LUN 對應至包含主機 WWPN 的啟動器群組（ igroup ）、以啟用存取。</block>
  <block id="d8609b6e37acaad082fff919da3c6691" category="paragraph">NetApp 也支援使用 NVMe / FC （如果您有支援的 AIX 和 RHEL 作業系統版本）、並增強效能。FCP和NVMe / FC可共存於同一個架構上。</block>
  <block id="2586e87005565fe66fa19a3af50f632c" category="summary">專為 Epic 打造的儲存規模</block>
  <block id="5e3e8694114d62a133f86c691b0d1d68" category="paragraph">您應該與 Epic 聯盟團隊合作、確認任何 Epic 設計。您可以在 EPIC @ NetApp .com 聯絡團隊。每個部署作業都需要滿足客戶要求、同時遵循 Epic 和 NetApp 建議的最佳實務做法。</block>
  <block id="c77c62342c6d144df81571fee8e8a4e8" category="paragraph">如需如何使用 NetApp 規模調整工具來判斷 Epic 軟體環境儲存需求的正確 RAID 群組大小和 RAID 群組數量的相關資訊、請參閱<block ref="b6ff45309a811037a92ca1e6262c74a8" category="inline-link-macro-rx"></block>（需要 NetApp 登入）。</block>
  <block id="6fff8a4d9dc5db1aefc3e3a86c26dbd7" category="admonition">必須存取 NetApp Field Portal 。</block>
  <block id="1484157a851d4053990c9bf55fb59e58" category="summary">EPIC on ONTAP 範例部署 - 集合體</block>
  <block id="e8f3d574ecc3fdf160285a0c9a5a7046" category="paragraph">如需資源配置集合體的最新文件<block ref="a20b867e80db6cfd4fb8336d84c1fcc5" category="inline-link-macro-rx"></block>、請按一下。</block>
  <block id="f2871c08962452bb98a23ee83880a7dd" category="admonition">預設設定可最佳化效能和容量。每個節點會建立一個大型 Aggregate 。</block>
  <block id="46b67d0e3c5baea52f318c392862983a" category="summary">EPIC on ONTAP 範例部署 - 檔案系統</block>
  <block id="ff902a0a262960f8bf9189923c1ff7d9" category="paragraph">如需有關裝載 LUN 、建立磁碟區群組和邏輯磁碟區、以及設定檔案系統的資訊、請參閱 Epic Storage Configuration 快速參考指南。使用下列命令範例、為 RHEL 設定 Epic Production 伺服器。</block>
  <block id="f54e4ad7066826fa3c18dcb8a62ddd03" category="section-title">檔案系統和掛載選項</block>
  <block id="ca487f2e3d336dbbead8ef7ce6f1dc6c" category="paragraph">在建立並對應 LUN 並完成分區之後、請使用下列程序將儲存設備附加至伺服器。</block>
  <block id="232aac42537fa2491071068a6dacfe10" category="admonition">在此範例中、我們使用 8 個 1024GB LUN 做為 DB 、 2 個 1024GB LUN 做為日誌、 2 個 1024GB LUN 做為應用程式安裝。</block>
  <block id="cdf658da371089bb06d8dc79b4ae2e2e" category="section-title">非同步 I/O</block>
  <block id="86c5811d8dc490e1467aed33484d89f2" category="paragraph">Epic SAN 考量白皮書與儲存組態快速參考文件複本、提供如何設定主機及連線至儲存設備的詳細資料。本節將說明如何設定 Red Hat Enterprise Linux 主機。AIX 詳細資料可在參考文件中找到。</block>
  <block id="81cba0a3715b5297330ade2beaa9dc7d" category="summary">EPIC on ONTAP 範例部署 - LUN</block>
  <block id="30baf86157b500051493cda4ff1be0c3" category="paragraph">&gt;&gt;&gt; 敘述性的前置詞句或段落預留位置</block>
  <block id="6aa18085c59b7b34360d5dff15bf6e84" category="paragraph">建立LUN</block>
  <block id="6a761ce5c1cf1122b1aaea2aec3cfc85" category="paragraph">若要建立 LUN ：<block ref="18244093c882fe4e65acdec6d61f9f95" category="inline-link-rx"></block></block>
  <block id="8ede5bcd129cb7b52add8d233c5e5867" category="paragraph">將 Volume 新增至 CG</block>
  <block id="4bd3faeb169131a1ecbf00026f146a6f" category="paragraph">若要建立或修改一致性群組：<block ref="52ad8c1ba289849e0c6ebe85b916c91a" category="inline-link-rx"></block></block>
  <block id="1093fcc785c9f0e59ff32142b73ff3a5" category="paragraph">對應 LUN</block>
  <block id="9e5dabcfb97ff08290166a6dd001c95e" category="paragraph">若要對應 LUN ：<block ref="8b5a6c46b302a4299b28e891d262657f" category="inline-link-rx"></block></block>
  <block id="73a228bbb9b14b5f966f329a201b115d" category="paragraph">視 ONTAP 版本而定、 Volume 上的「部分保留」預設設定可以是 100% 。此組態應設為 0 。</block>
  <block id="b13aace07f0445cf1ff16be054bcc01e" category="summary">EPIC on ONTAP 範例部署</block>
  <block id="cca1d6e8ff542fcd4d1315f7f9033467" category="paragraph">本節將引導您完成 ONTAP 叢集的完整進階組態、配置儲存設備、並將其呈現給 Epic 伺服器。</block>
  <block id="df8f0aad2b90e887efba35ecbc7e6546" category="paragraph">為了擷取詳細資料並簡化文件、我們使用命令列。如果偏好 GUI 、您可以在 System Manager 中配置所有設定。</block>
  <block id="d706ffe8745cb55ce7b7d1c7dfa458dd" category="paragraph">過去、大型專案的初始大量設定通常會使用表 1 所列的命令來加快、尤其是當您串連工作表中的命令時。此命令清單也可做為絕佳的建置文件。</block>
  <block id="12c8172fde8f9b3f81c3ed0d2805f3d4" category="paragraph">另一個資源配置選項是使用 Ansible 的第 0 天和第 1 天自動化指令碼。NetApp 現有數百本 Ansible 教戰手冊可供下載、包括透過 Ansible 銀河集合 install NetApp ． ONTAP 命令下載 Ansible Galaxy 集合。</block>
  <block id="80455b40cdd7b477184d76f23f747af1" category="paragraph">此外、 GUI 也能與簡單的單頁 LUN 及共享資源配置搭配運作、GUI 最適合用於新增、修改或刪除儲存設備時的作業。如果您套用表 1 中的最佳實務儲存設定、則任一選項都沒問題。</block>
  <block id="d7441f24bee2c1922760ce27f5e978ec" category="paragraph">完整的叢集設定和儲存 / 主機資源配置、在分段時不應超過一小時。</block>
  <block id="3924c8a2656c72cc0c7d6a27f9ad08ea" category="paragraph">* 最佳儲存設定實務 *</block>
  <block id="51ac4bf63a0c6a9cefa7ba69b4154ef1" category="cell">設定</block>
  <block id="689202409e48743b914713f96d93947c" category="cell">價值</block>
  <block id="2ee34178bb8415b7d7234cd27b83aed6" category="cell">Aggregate</block>
  <block id="ae6bd8a277455ba774ffc217a2f8a539" category="cell">預設自動資源配置、每個節點使用 RAID DEP 、一個 ADP 集合體</block>
  <block id="63555da25f96be027cd722d9f281cffa" category="cell">使用多個處理器時有兩個 SVM （區塊 SVM 和 SMB/NFS SVM ）。使用 Epic 和傳輸協定命名慣例。使用適當的安全風格</block>
  <block id="aec0819ab194aee8aab8a5e40aad8343" category="cell">磁碟區空間保證</block>
  <block id="334c4a4c42fdb79d7ebc3e73b517e6f8" category="cell">無</block>
  <block id="d374cbba7f603e6be8e6450a6b3feb45" category="cell">Volume Snapshot 原則</block>
  <block id="8285885018fdba6d87edc774237f0e24" category="cell">Volume 自動調整大小</block>
  <block id="4d200fce73a8e1cc965cfc2c43343824" category="cell">成長</block>
  <block id="948111f101cd4e13c4a1e21775e9742d" category="cell">Volume 最大自動調整大小</block>
  <block id="fde7826aacd46b7610beed2b0ef8d81e" category="cell">2T 或 2 X LUN 大小</block>
  <block id="ca714a7089246aff7f85bbda97ba660b" category="cell">Volume Snapshot 自動刪除</block>
  <block id="a10311459433adf322f2590a4987c423" category="cell">已啟用</block>
  <block id="6bb41960470a19d97556b9240ac0b3ff" category="cell">Volume大小</block>
  <block id="9bba382221ce257d09f3f50492803815" category="cell">1.5 X LUN 大小</block>
  <block id="dc85eb20ed6dd71700df76a7f9acd32b" category="cell">Volume 配置</block>
  <block id="370e47099244ee43c575d91449bb7e36" category="cell">甚至跨控制器散佈</block>
  <block id="ca301c828c76b7b6b1a9b621ba37f603" category="cell">igroup類型</block>
  <block id="d6c56de514a4a8fe23f54d6b42dd23af" category="cell">作業系統與實體伺服器搭配使用時、 VMware 類型與 ESX 搭配使用。</block>
  <block id="bbd68bf55ab562da30e73449f1b87424" category="summary">EPIC on ONTAP 範例部署 - 通訊協定</block>
  <block id="589b83bd3c7696acc0086c7f233e64e3" category="doc">EPIC on ONTAP 範例部署 - 平台</block>
  <block id="05f72896244a448167caa4a410eb4ecf" category="paragraph">對於 Epic odb 資料庫、日誌和應用程式工作負載、 Epic 建議將儲存設備以 FCP LUN 的形式呈現給伺服器。</block>
  <block id="a3a5d01a736b2f5bc994d2ff7b0da8c5" category="summary">EPIC on ONTAP 範例部署 - FCP 傳輸協定</block>
  <block id="dc0e595680f18844673c0930ecf1ca6b" category="paragraph">建立 SVM 之後、您需要在其中新增通訊協定。</block>
  <block id="263a628397d3f78e3b61f40863b0868f" category="paragraph">若要建立 FCP 資料生命、請按一下<block ref="8f46d074b2d46f416cb36dce6f8bd76d" category="inline-link-macro-rx"></block>。</block>
  <block id="663c2decd75c93fbad53179b6016c0d1" category="paragraph">啟動器群組用於允許伺服器存取 LUN 。若要建立 iGroup 、請按一下<block ref="c6345eebd77187b1723cf47095ffbd0f" category="inline-link-macro-rx"></block>。</block>
  <block id="93f7209bec244568b95ac2f8f50896d7" category="summary">EPIC on ONTAP 範例部署 - SVM</block>
  <block id="39ce7fcbb7e39843ad7e81e460901359" category="paragraph">NetApp 會虛擬化儲存設備、並由 SVM 提供使用者存取。</block>
  <block id="8c22ab38f47a2a116e19714defb5f005" category="paragraph">對於 Epic 、有 FCP SVM 和 SMB SVM 。根據您想要管理儲存設備的方式、以及可能的多租戶、您可以使用更多 SVM 。</block>
  <block id="99889a411324e95bb7313521d10d972b" category="paragraph">若要設定 SVM 、請按一下<block ref="cb8e547e3f29ee63864aeed75c724bf1" category="inline-link-macro-rx"></block></block>
  <block id="abf025601df70d9ba931fe67b1cc4a79" category="summary">EPIC on ONTAP 範例部署 - Volume</block>
  <block id="02594c71ca915876e2512e474d8b462d" category="paragraph">若要建立 Volume 、請參閱<block ref="b6546da834bc505016791ad9e7ec9d1e" category="inline-link-rx"></block></block>
  <block id="36e2bc00e48fbcfe5ae35a8a6056788c" category="admonition">從 ONTAP 9 7 開始、當您擁有 NVE 授權、以及內建或外部金鑰管理時、預設會啟用 Aggregate 和 Volume 加密。若要啟用磁碟區層級的重複資料刪除功能、請將 ADD -CRY加密 錯誤設為 Volume cree/modify 命令（如果您擁有 NVE 授權）。</block>
  <block id="7a112f92e38a30129ab13d18331e21ce" category="section-title">自動刪除快照</block>
  <block id="f118801694edca90b5e446d3fe39cda0" category="paragraph">若要自動刪除快照：<block ref="ecea59d033fb2dad1d38e75fbdc1c820" category="inline-link-rx"></block></block>
  <block id="e324e68086bb9c9e930b9d1168f1de5d" category="summary">ONTAP 可用度的 EPIC</block>
  <block id="8339b88fddad3cfe433f684a83da04eb" category="paragraph">ONTAP 的核心是不中斷營運的營運、可避免業務營運中斷所造成的成本高昂。</block>
  <block id="ca7972f1caf7a478b4f931e986112b62" category="paragraph">NetApp 根據正式作業資料提供超過 99.99999999% 的可用度、這是透過 NetApp Active IQ 稱為家中的資料。叢集中的每個 HA 配對都沒有單點故障。ONTAP 可追溯至 1992 年、是全球部署最廣泛的資料管理軟體、擁有提供可靠儲存設備的卓越歷史。現在、有了 Active IQ 主動監控並自動解決 97% 的問題、可用度就會更高、支援案例也會大幅減少。</block>
  <block id="43a21754b069ee170b1858e00c4072df" category="paragraph">EPIC建議使用HA儲存系統來減輕硬體元件故障。本建議從基本硬體（例如備援電源供應器）延伸至網路（例如多重路徑網路）。</block>
  <block id="58992d12f27d940ad0ced78080987a44" category="paragraph">當您需要升級儲存設備、向上擴充、橫向擴充或重新平衡叢集上的工作負載時、病患照護將不會有任何影響。您可能會移動資料、但絕不會再因資料移轉或堆高機升級而中斷病患照護。改用新一代技術、防範未來、避免硬體束縛。 NetApp 甚至提供 100% 的書面可用度保證。</block>
  <block id="071a41c2bfc6123073746c5459501089" category="inline-link-macro">NetApp ONTAP 可靠性、可用度、可維修性和安全性</block>
  <block id="c38a90bcf1a9aa5905c0c4e6fbac331b" category="paragraph">如需 NetApp 可靠性、可用度、可維修性和安全功能的詳細資訊、請參閱<block ref="c4f5dec030b0bd57318efbed2e25e7a7" category="inline-link-macro-rx"></block>白皮書。</block>
  <block id="12a3215a6e17b2d4e547b8c9ddb4db59" category="summary">EPIC 資料保護</block>
  <block id="e2f4ffd17d85ea8c667a8fa10eaa81bd" category="doc">EPIC 複製</block>
  <block id="d777ff146845d0c5a59b451dcdd63eff" category="paragraph">Epic 認為儲存節點型 NetApp Snapshot 技術與傳統檔案型備份相比、對正式作業工作負載沒有效能影響。當 Snapshot 備份用作正式作業資料庫的還原來源時、必須以資料庫一致性為考量來實作備份方法。</block>
  <block id="7952c7481879c42a618f85cfab77dc0b" category="paragraph">快照是磁碟區的時間點唯讀備份複本。NetApp FlexClone ® 會擷取快照、使其立即讀取並可寫入。FlexClone Volume 提供絕佳價值、可擷取唯讀、應用程式一致的快照、並從正式作業資料建立可寫入的 FlexClone Volume 。這項原生功能對儲存節省、作業時間和自動化功能有重大影響。</block>
  <block id="dd12a5170cc960b0ed4afe4f23fd727b" category="paragraph">在重新整理程序中、會使用 FlexClone 磁碟區。</block>
  <block id="198010d8bf8a3ff0f084ffd059a9a1da" category="section-title">資料管理</block>
  <block id="31949f92a027681e10fa0ae809d62bcd" category="paragraph">作為解決方案的一部分、 NetApp 使用原生 ONTAP 工具、提供全自動的備份與測試更新解決方案。此解決方案旨在簡化 Epic 資料管理、特別是針對 Epic 資料庫管理員（ DBA ）的大型社群：</block>
  <block id="bde282ad1e62a3d8d64bcbebfd99918c" category="list-text">Epic Mirror 用於將資料複寫至災難恢復和報告（以綠色表示）。</block>
  <block id="89c4ed523f61f9d3446182d80a53c8b6" category="list-text">從 Report 傾印至 Clarity 的每日資料傾印。</block>
  <block id="c3d37da5ec71148ab4d2292c5fc62181" category="list-text">NetApp 自動備份（以黃色表示）。</block>
  <block id="f417d841f910f45d16ac64fccd850be8" category="list-text">NetApp 自動更新 SUP 、 REP 及其他（以藍色表示）的測試。</block>
  <block id="2a7a6372892435f5d284e730df618c35" category="list-text">測試環境適用於完整複本環境、而非較小的壁球複本。</block>
  <block id="88b2dcefc205727508d4017aacafaafd" category="paragraph">如需詳細資訊、請聯絡適用於 Epic 應用程式的 NetApp 服務。</block>
  <block id="4e3e281c19bf41f436de9fe363daa25c" category="paragraph">一致性群組（簡稱 CGS ）提供這項功能及更多功能。您可以在夜間使用這些快照、使用原則來建立隨需或排程一致的快照。您可以使用此選項來還原、複製甚至複寫資料。</block>
  <block id="f5de57234e68f27cbd82acfc80f2d5cb" category="inline-link-macro">一致性群組的 NetApp 文件</block>
  <block id="f7e43fe614bf53ff9721f7494c0caf16" category="paragraph">如需 CGS 的其他資訊、請參閱<block ref="0efc681e89d66f1c589ad00a8ae67afa" category="inline-link-macro-rx"></block></block>
  <block id="9f42082fda47a6a26e6c6e6bcc14526e" category="section-title">設定 Epic 的一致性群組</block>
  <block id="7d381e222258ec55bcf215684ae70097" category="inline-image-macro">EPIC 與一致性群組</block>
  <block id="4eb8f91ee432a8e69615314961db4f88" category="paragraph"><block ref="4eb8f91ee432a8e69615314961db4f88" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4294e0bf4b67190ddcb91a01b3c4356c" category="section-title">一致性群組快照</block>
  <block id="86cfb45aaa741215d8d8d58223948dcc" category="paragraph">WebBLOB 和 VMare 資料集應僅設定為 Volume 、而非與 CGS 相關聯。您可以使用 SnapMirror 或 SnapVault 技術、在不同於正式作業的儲存系統上維護其 Snapshot 複本。</block>
  <block id="f5445123331a1b74a34fd1f392e9e946" category="inline-image-macro">Epic CG 快照</block>
  <block id="92aabd14a16803d9fa65ca4f94488322" category="paragraph"><block ref="92aabd14a16803d9fa65ca4f94488322" category="inline-image-macro-rx" type="image"></block></block>
  <block id="9c71026f6349a81cd2a3cfcfa8ea9ceb" category="summary">ONTAP 整合的 EPIC</block>
  <block id="569a30a99d3744f0871a7c36162f469c" category="paragraph">醫療業的主要挑戰之一、就是封閉環境的效率不彰。</block>
  <block id="87b522a84cee7651eb3ea5c59d4c9a35" category="paragraph">多點解決方案是由阻礙進展的不同群組所建立。統一化的資料管理策略可提高效率、加速轉型。將病患記錄、勒索軟體和泛用 AI 等顛覆性技術、都是整合的必備工具。</block>
  <block id="882f36b3d76e4e5b9ac08850c1e7a15a" category="paragraph">有了 ONTAP 、您就能在內部部署和雲端上整合檔案 / 區塊 / 物件、以及每個第 0/1/2/3 層工作負載、全部都在 ONTAP 上執行。</block>
  <block id="0b153e0d191221abe8c325950ab9a03b" category="summary">EPIC on ONTAP 效率</block>
  <block id="12ca553efec3e73a9120d8c050d405a9" category="paragraph">EPIC 可在所有 Flash 陣列上執行、其中大部分的成本都是磁碟。因此、儲存效率對於節省成本至關重要。</block>
  <block id="aac466a460fe672b45d2e43b476f772e" category="paragraph">NetApp 內嵌式儲存效率可在儲存設備上實現領先業界的節約效益、而不會影響效能、我們甚至還提供 All Flash Array 的書面效率保證。</block>
  <block id="436525ee58a117eefbde96bb2f0cae02" category="paragraph">在計算儲存效率時、請務必測量原始到可用的有效容量。</block>
  <block id="bbf547b93564824fe00f04646269a56e" category="list-text">* 原始容量 * 在套用任何 RAID 之前、磁碟大小依磁碟數而定。</block>
  <block id="29cabda6c17d251ab3bba7feb41646fc" category="list-text">* 可用容量 * 套用 RAID 後、可用儲存空間有多少。</block>
  <block id="9edb4e889ca40d3881217c9433ecb376" category="list-text">* 有效容量 * 配置及呈現給主機或用戶端的儲存容量。</block>
  <block id="21e10a177fbffc69f63f5dcdb44175f5" category="paragraph">下圖是典型 Epic 部署的效率計算範例、包括所有需要 852TB 有效儲存空間的工作負載、效率高達 5.2:1 、可提供 1.32PB 的總有效資料。</block>
  <block id="c8c2fd097c28062ec912ad0d2f9bbe11" category="admonition">根據磁碟數量、原始至可用容量會稍有不同。</block>
  <block id="f0a0c9b18011b122c315d8970dbcce49" category="inline-image-macro">卓越的儲存效率</block>
  <block id="d145883b21ccbccb471abc3a5dac40f3" category="paragraph"><block ref="d145883b21ccbccb471abc3a5dac40f3" category="inline-image-macro-rx" type="image"></block></block>
  <block id="bf8acecf163b9e71e2e9331bc87c5e90" category="admonition">NetApp 不使用 NetApp Snapshot 技術或精簡配置來計算保證方案的效率。這樣做會顯示 30-100:1 的不切實際效率、這並不代表實際儲存容量的規模。</block>
  <block id="f4f81a0ab85224d234bc465988b5b871" category="summary">EPIC on ONTAP 概覽</block>
  <block id="35b4c598dd74c59e91d978c12210cc03" category="doc">ONTAP 上的 EPIC</block>
  <block id="52aaae321a4b3f69eaf3448c22d2d55c" category="paragraph">ONTAP 讓 EPIC 變得更簡單。</block>
  <block id="76d68daeac9b3e7a8cfb0c3d904ac7de" category="paragraph">ONTAP 是一個資料管理平台、可讓您整合 Epic 工作負載、同時滿足所有效能、資料保護及資料管理需求。</block>
  <block id="85e6f9f2e3539043a3a60b16af5a654f" category="paragraph">只有在 NetApp 上、您才能在單一高可用度資料管理平台上、將 SAN 、 NAS 和物件的所有醫療工作負載標準化。ONTAP 是全球部署最廣泛的儲存軟體平台、擁有將近 30 年的持續創新經驗。您可以使用原生 ONTAP 資料管理工具和應用程式整合、來因應 Epic 的所有挑戰。不需要購買多種協力廠商工具來填補解決方案的缺口。</block>
  <block id="54fed3d17b1233bcc7ab7b0d3f6eddca" category="paragraph">許多儲存廠商都提供傳統、可靠且快速的區塊儲存。它們運作良好、但通常部署在封閉環境中、以執行單一工作負載、例如正式作業、報告、清晰度、 VDI 、 VMware 和 NAS 。每個封閉環境都有不同的硬體和不同的管理工具、通常由不同的 IT 群組管理。這種傳統方法增加了當今醫療業最大的問題、也就是複雜度。</block>
  <block id="58ad32957aed88a3c14ef81e5f254bd3" category="paragraph">NetApp 讓資料管理變得更簡單、更有效率。ONTAP 使用創新與技術、透過任何具有整合式資料保護功能的傳輸協定、在單一平台上為每個工作負載提供一致且保證的 SLA 、而非讓大型封閉環境的問題大受影響。這些功能和工具也延伸到您選擇的雲端、如下圖所示。</block>
  <block id="0d9c98d3832defc892b59655abcfacfc" category="inline-image-macro">ONTAP 為醫療產業提供擴充性與簡易性</block>
  <block id="4277ed476100dc05b0a4e0e837c3d9b9" category="paragraph"><block ref="4277ed476100dc05b0a4e0e837c3d9b9" category="inline-image-macro-rx" type="image"></block></block>
  <block id="63cc4e5664cd9022b0fc1580682f9995" category="summary">ONTAP 的卓越效能</block>
  <block id="6762c0b102338c245945f7d09da83fa4" category="paragraph">ONTAP 於 2009 年推出 Flash 技術、並自 2010 年起支援 SSD 。這項 Flash 儲存設備的長期使用經驗可讓 NetApp 調整 ONTAP 功能、以最佳化 SSD 效能、並增強 Flash 媒體的耐受度、同時保留 ONTAP 的豐富功能。</block>
  <block id="8e0c14b7c96a8748c07c3916510ebd8b" category="paragraph">自 2020 年起、所有 Epic odb 工作負載都必須位於 All Flash 儲存設備上。EPIC 工作負載通常以每 TB 儲存容量約 1 、 000 至 2 、 000 IOPs （ 8k 區塊、 75% / 25% 讀寫比率、 100% 隨機）運作。EPIC 對延遲非常敏感、而高延遲對終端使用者體驗以及執行報告、備份、完整性檢查和環境更新時間等作業工作都有明顯影響。</block>
  <block id="4a9928f04affb2a4fe321fb9e2b003fd" category="list-text">All Flash Array 的限制因素不是磁碟機、而是控制器的使用率。</block>
  <block id="11a9dfbe9a015ca567ecd5f77959dc1f" category="list-text">ONTAP 使用雙主動式架構。為了達到效能、 HA 配對中的兩個節點都會寫入磁碟機。</block>
  <block id="3a5c5db6ac361794af4c29a626c584f5" category="list-text">如此一來、 CPU 使用率便達到最大化、這是 NetApp 能夠發佈業界最佳 Epic 效能的最重要因素。</block>
  <block id="2f6b137b593d6a732992bc619827ee36" category="list-text">NetApp RAID DP 、進階磁碟分割（ ADP ）和 WAFL 技術可滿足所有 Epic 需求。所有工作負載都會在所有磁碟之間散佈 IO 。無瓶頸。</block>
  <block id="0ce3d3de991180e05a5a0818efc312ef" category="list-text">ONTAP 已經過寫入最佳化；寫入一次會被確認寫入鏡射 NVRAM 、然後再以內嵌記憶體速度寫入磁碟。</block>
  <block id="ca65639a4e206f319202179e1d9a4ff4" category="list-text">WAFL 、 NVRAM 和模組化架構可讓 NetApp 使用軟體、以即時效率、加密和效能進行創新。此外、 NetApp 也能在不影響效能的情況下、引進新的功能和功能。</block>
  <block id="f13349f1404495d87711104e964b1cef" category="list-text">過去、每個新版 ONTAP 的效能與效率都有 30% 至 50% 的提升。當您與 ONTAP 保持最新狀態時、效能是最佳選擇。</block>
  <block id="70d9e3c68d42d6ec42ab792e06c44357" category="section-title">NVMe</block>
  <block id="42fa4afed0f941a60ea00e82671c421d" category="paragraph">當效能至關重要時、 NetApp 也支援下一代 FC SAN 傳輸協定 NVMe / FC 。</block>
  <block id="1e4d4890d3f90b04841095b53183f782" category="paragraph">如下圖所示、我們的 Genio 測試使用 NVMe / FC 傳輸協定、與 FC 傳輸協定相比、實現了更多 IOPS 。NVMe / FC 連線解決方案在超過 45 秒寫入週期臨界值之前、達到超過 700k IOPS 。以 NVMe 取代 SCSI 命令、也能大幅降低主機的使用率。</block>
  <block id="0b336e7e203efd55d17ecfaa03c134f5" category="inline-image-macro">EPIC Genio 圖形</block>
  <block id="293e47073bb00e514b986ef28fbbb2e1" category="paragraph"><block ref="293e47073bb00e514b986ef28fbbb2e1" category="inline-image-macro-rx" type="image"></block></block>
  <block id="9ff8735576a58daba5ba20974f92a584" category="summary">ONTAP 擴充性的 EPIC</block>
  <block id="1027782bab261904e6adf43f2b137951" category="paragraph">Epic 硬體組態指南的成長率約為每年 20% 、為期 3 年。不過、環境也可能意外成長。</block>
  <block id="39e52e339ff39b5620d48036812e09ec" category="paragraph">NetApp 可無縫擴充 NAS 、 SAN 和物件叢集的效能和容量、最多可擴充至 12 個節點。因此、您可以隨業務成長而不中斷營運地向上或向外擴充。</block>
  <block id="49c5cdfe08202e574deefaa3d26c332a" category="inline-link-macro">現代 SAN 上通過 NetApp 驗證的架構 Epic</block>
  <block id="12cb4beeba752f647712c749e3076fbf" category="paragraph">Epic Iris 提供更多擴充功能。它可讓擁有多個 Epic 執行個體的大型客戶整合至單一執行個體。<block ref="5d13d58e489e8fe43bb727515c1d9ff2" category="inline-link-macro-rx"></block>本文說明 Epic 可在單一 HA 上無縫地將整合的工作負載擴充至 720K IOPS 、並在叢集中橫向擴充至超過 4M IOPS 。您可以升級控制器或將磁碟新增至現有叢集、以不中斷營運的方式擴充。</block>
  <block id="196097993185ddccf60443ac3f86e89f" category="paragraph">NAS 、 SAN 和物件資料也能在叢集中的節點之間不中斷地移動。叢集中的每個 HA 配對都可以是 ONTAP FAS 和 AFF 系統類型和大小的任意組合。您可以在單一叢集之間平衡工作負載、以最大化您的儲存投資。</block>
  <block id="6abd4957b4615c500bd2a32425316211" category="paragraph">ONTAP 也提供選項、可將 StorageGRID 或雲端上的物件儲存設備作為備份目標及 / 或自動冷儲存分層目標。此功能可讓您自動將昂貴的 All Flash 磁碟、階層快照和冷資料釋出給 Object 。</block>
  <block id="8d3f76f475a5e81f188f700429c71a9e" category="paragraph">結果是、 Epic 只要運用 ONTAP 、多重通訊協定、 StorageGRID 及您選擇的雲端、就能更好地運用 NetApp 產品組合。這些產品提供災難恢復、歸檔、分析、分層等選項。</block>
  <block id="1e3ccee88df9552e4751ba4ad173de96" category="summary">ONTAP 安全性的 EPIC</block>
  <block id="32e1bf49ff775c9283c882fe7f3ec873" category="paragraph">安全性是當今組織和醫療主管的首要考量。管理工作從未如此困難、組織也面臨法規遵循、資料治理、防毒保護和勒索軟體等挑戰。</block>
  <block id="0d6ce08690a300cb8ce00d77e1c31a5e" category="inline-link-macro">ONTAP 安全強化指南</block>
  <block id="40e97866feb53c48881b34e5f97ca61f" category="paragraph">完整的 Epic 與儲存安全性指南不在本文件的涵蓋範圍之內、但<block ref="471b0f2cfbad0f2ec4e54df06500d580" category="inline-link-macro-rx"></block>詳細說明 ONTAP 提供的所有廣泛與進階安全功能。</block>
  <block id="1408f921f799efe0e585aeba5fa9ed58" category="inline-link-macro">TR-4569</block>
  <block id="f87d3f3c7c3e6e9ab1153c53d78b40b1" category="paragraph">NetApp Active IQ Unified Manager 會根據所包含的資訊來監控安全違規事件、並在儀表板中報告這些違規事件<block ref="1b2ca6a48e0bf52cc6351680c5ee6170" category="inline-link-macro-rx"></block>、以簡化安全管理。這些工具可協助貴組織達成安全目標、以保護、偵測及補救攻擊。</block>
  <block id="a1fbc1f9fe3c77416c96f491ba933c4a" category="inline-link-macro">NetApp FPolicy</block>
  <block id="96f76ddccc0adcaf0fc9a2fc6c834374" category="inline-link-macro">多因素（ MFA ）驗證</block>
  <block id="a754af2f708573321f76c2d36bea9f02" category="paragraph">NetApp 也與安全性廠商合作、透過軟體提供整合<block ref="48fae993b7aeb9944f39dadc4618e2b6" category="inline-link-macro-rx"></block>功能、以強化您的安全性產品。此外、<block ref="b5ae90d3a2df9b77f2db834fe0dc7b7d" category="inline-link-macro-rx"></block>您也可以新增以保護 Epic 環境免於遭洩漏認證的未經授權存取。</block>
  <block id="91d998bab304adb0fd27858a4295dcac" category="inline-link-macro">ONTAP 網路保存庫</block>
  <block id="e9c1c7d4ca860adb553d87c2c1d9ef35" category="inline-link-macro">NetApp勒索軟體解決方案</block>
  <block id="63ab8aaa1f35361bdf5c84b3d1dd4765" category="inline-link-macro">NetApp 與 Zero Trust</block>
  <block id="a67fe844bc4d3e5cf5ebac11dea00b01" category="paragraph">最後、 ONTAP 原生 Snapshot 複本與不可變<block ref="79305a8b61b53acc892506e6bcd6f49f" category="inline-link-macro-rx"></block>的 SnapLock 技術搭配、提供獨特的氣隙功能、可保護病患記錄免於勒索軟體的侵害。請參閱上的 NetApp 文件<block ref="910d0617bba4ff1a9d41b4b330096d85" category="inline-link-macro-rx"></block>。如需更具策略性的安全性方法，請參閱<block ref="aaf21a490837c9b392e59c6c9110165d" category="inline-link-macro-rx"></block>。</block>
  <block id="28caba838e7a7ff7ff218bae8235208a" category="summary">EPIC 快照與複製</block>
  <block id="8ad0c394ef79d2b18983fabe84f658fc" category="paragraph">快照是磁碟區的時間點複本、該磁碟區是唯讀的。</block>
  <block id="568043eed0b44992a4b4a1cc21f8b633" category="paragraph">快照會對作用中檔案系統中的所有區塊進行邏輯鎖定。NetApp ONTAP Snapshot 複本近乎即時、而且不會使用任何額外的儲存設備。</block>
  <block id="04a00b93a2db41946dc3d263cf6c294c" category="paragraph">寫入其中檔案配置（即 WAFL ）是唯寫入的檔案系統、不會執行其他 IO 、例如在覆寫前複製受快照保護區塊中的資料。不會移動任何資料、因此快照不會影響儲存容量或效能。快照可大幅節省儲存成本、同時擴充備份解決方案。</block>
  <block id="a701f5d044348085ee4f97fef6636845" category="section-title">FlexClone</block>
  <block id="16f57611d3d44b74ce1c1b134cb8e798" category="paragraph">NetApp ONTAP FlexClone Volume 是現有磁碟區的複本或現有磁碟區的快照。否則、它 ONTAP 就像其他任何磁碟區一樣、可以自行複製、使用快照保護、並使用 QoS 原則進行設定。</block>
  <block id="e0c3236990160654182a79c89baab29f" category="paragraph">與快照一樣、 FlexClone 磁碟區在建立時不需要任何額外空間。只有複本變更才需要額外容量。</block>
  <block id="9a9ff90c24c36543bf54b1f2136fd9e0" category="paragraph">Epic 需要 10 至 30 份正式作業資料庫複本、以滿足各種作業需求、例如串流備份、完整性檢查和整備升級環境。隨着升級頻率的增加，構建在 FlexClone 捲上的解決方案的需求也隨之增加。</block>
  <block id="dad816f366caa0b8cae67daaeb85deb0" category="admonition">NetApp 提供全自動 Epic 備份解決方案和 Epic Refresh 解決方案、作為解決方案的一部分、使用 Ansible 和原生 NetApp 工具。</block>
  <block id="53f102b306ab1aba43e9e20701dc32f2" category="doc">ONTAP 上的 EPIC</block>
  <block id="3bfc8ddd725eed5b674d1a480bc650d2" category="paragraph">數位化轉型的關鍵在於讓資料發揮更大效益。</block>
  <block id="2b82426bc0bfa4ea3efb779d165629a4" category="admonition">本文件取代先前發表的技術報告 _TR-3923 ：適用於 Epic 的 NetApp 最佳實務做法。</block>
  <block id="fdf0f3f3a2bae0d66ca5ecb45e1f3d85" category="paragraph">醫院需要大量資料才能開始數位轉型。治療病患、管理工作人員排程和醫療資源的程序、是收集和處理資訊的過程之一。不過、許多行動仍是手動執行、或是透過過時的系統執行。一種常態是資料量持續呈指數成長、因此越來越難以管理。</block>
  <block id="74090662bfdb94e49dfc286a6946cc5c" category="paragraph">造成此問題的主要原因是醫院資料通常儲存在資料封閉環境中。手動輸入和更新花費太多時間、導致工作時間耗盡和錯誤。本文件是醫療資料的一部分、即 Epic 電子健康記錄（ EHR ）。不過、此處涵蓋的資料管理策略可以也應該套用至所有醫療資料。NetApp 擁有現代化及簡化數位基礎架構的經驗證明。我們的智慧型資料基礎架構是數位轉型的基礎。</block>
  <block id="b68a1112138fe0c0c1beafc2aea18949" category="paragraph">NetApp 提供單一的資料管理解決方案、可滿足所有醫療需求、我們能夠引導醫院完成數位化轉型的過程。醫療業以結構和智慧解決方案為基礎、可充分發揮這項寶貴資訊的全部價值。此架構可協助醫療供應商更快診斷疾病、並制定個人化治療計畫、以更有效地支援緊急情況下的決策程序。您也可以建置自己的智慧型資料基礎架構、讓醫院能夠解除資料封閉環境的鎖定、促進資料互通性、並保護敏感的病患資訊。</block>
  <block id="6b5a360f7d15046cfd935db963e3da66" category="paragraph">請參考本文件、成功建構及實作 Epic EHR 。與其建置多個 Epic 封閉環境、不如建置單一 Epic 資料基礎架構、並改造醫院。</block>
  <block id="261addf78c7b2c961032b3dd08ba0b1f" category="section-title">目的</block>
  <block id="b8954f46b76dae4370058c7bd9ae0c97" category="paragraph">本文件說明將 NetApp 儲存設備整合至 Epic 軟體環境的最佳實務做法。其中包含下列各節：</block>
  <block id="6c5022fa1197168f37c42e56f80d36aa" category="list-text">對 Epic 軟體環境及其儲存需求的技術瞭解、涵蓋各種組態。</block>
  <block id="a9da176a5abe5a618e8ed6a88bdbf21b" category="list-text">Epic 儲存設備考量事項、說明 Epic 解決方案的重要決策因素。</block>
  <block id="8b3f0902644adbb7e0435ae9c9a284e2" category="list-text">NetApp 儲存建議、說明符合 Epic 儲存需求的 NetApp 儲存組態最佳實務做法。</block>
  <block id="5d113f2038d289f391614c39043629e8" category="section-title">範圍</block>
  <block id="217eb7cf1ad7503a42f61ad3cffb47fb" category="paragraph">本文件不涵蓋下列主題：</block>
  <block id="f900b8ede5ddf3a0471176dab052001d" category="list-text">量化效能需求與規模調整指南、請見<block ref="81c36a9e6d224e9d42c9630dffaa9434" category="inline-link-rx"></block>（需要 NetApp 登入）</block>
  <block id="ef1e6887c579ba81dcedc3f4e3793cd2" category="section-title">對象</block>
  <block id="2f215f5ba67ae7978ce4846a4a1cdc08" category="paragraph">NetApp假設讀者具備下列背景知識：</block>
  <block id="6cfde17644914efa6d0a4d0c21a8f9db" category="list-text">深入瞭解SAN和NAS概念</block>
  <block id="c86456e4299d4b0ad43e030d0fdd0af5" category="list-text">熟悉 ONTAP 儲存系統的技術知識</block>
  <block id="59eba43c04b655e21f087af920398a2a" category="list-text">熟悉 ONTAP 的組態與管理</block>
  <block id="b7c45da218d2e29ec939a31cdd81f2be" category="paragraph">執行 ONTAP 的 NetApp 儲存控制器可在 Windows Server 環境中支援下列工作負載：</block>
  <block id="f43e8d35e63b48bc73d5dc074df829ae" category="paragraph">Microsoft ODX 也稱為複製卸載、可在儲存裝置內或相容儲存裝置之間直接傳輸資料、而無需透過主機電腦傳輸資料。ONTAP 支援 CIFS 與 SAN 傳輸協定的 ODX 功能。如果複本位於同一個磁碟區內、 ODX 可能會改善效能、降低用戶端 CPU 和記憶體的使用率、並降低網路 I/O 頻寬使用率。</block>
  <block id="72960f8df48c0debc035454921c1b5d3" category="list-text">在共享的即時移轉中、虛擬機器會儲存在 SMB 共用區中。因此、當您即時移轉虛擬機器時、虛擬機器的儲存設備會保留在中央 SMB 共用區上、以便其他節點立即存取、如下所示。</block>
  <block id="5a002cf26db634ca1b1fff75461d2427" category="list-title">ONTAP 可在 NetApp 儲存控制器上執行。有多種格式可供選擇。</block>
  <block id="6011d6a859985e0b6d7c13b0907896ca" category="paragraph">ONTAP 提供高可用度的儲存設備、其中可存在從儲存控制器到 Windows Server 的多個路徑。多重路徑是指從伺服器到儲存陣列的多重資料路徑。多重路徑可防止硬體故障（纜線切割、交換器和主機匯流排介面卡 [HBA] 故障等）、並可利用多重連線的彙總效能來提供更高的效能限制。當某個路徑或連線無法使用時、多重路徑軟體會自動將負載移至其他可用路徑之一。MPIO 功能將通往儲存設備的多個實體路徑結合為單一邏輯路徑、用於資料存取、以提供儲存恢復能力和負載平衡。若要使用此功能、必須在 Windows Server 上啟用 MPIO 功能。</block>
  <block id="8bbfb9edfb90853f3f9439d77ce59441" category="list-text">ONTAP 上的 CLI 命令</block>
  <block id="e72f4a4f5fcfab964176e743af1f3196" category="paragraph">NAS 傳輸協定 CIFS 原生整合至 ONTAP 。因此、 Windows Server 不需要任何額外的用戶端軟體即可存取 ONTAP 上的資料。NetApp 儲存控制器會在網路上顯示為原生檔案伺服器、並支援 Microsoft Active Directory 驗證。</block>
  <block id="ab2d1dd1b024fd7be648c22c4a43997b" category="list-text">某些 CIFS 管理工作可以使用 Microsoft Management Console （ MMC ）來執行。在執行這些工作之前、您必須使用 MMC 功能表命令、將 MMC 連接至 ONTAP 儲存設備。</block>
  <block id="1d5ba6202d85466a95188b58c37dccc8" category="list-text">NetApp 建議您將 Hyper-V 主機與 ONTAP 儲存設備連線至 10GB 網路（如果有的話）。如果是 1GB 網路連線、 NetApp 建議您建立由多個 1GB 連接埠組成的介面群組。</block>
  <block id="79d467fa842b9015f2f12ada4fa1c7fc" category="paragraph">SQL Server 效能對 CPU 和核心組態有多項相依性。</block>
  <block id="4403546c5938500562a9d8677deb1c38" category="section-title">核心與授權</block>
  <block id="c325fde2d51a1ea2ddd8c9dd51cfdf9c" category="paragraph">下圖顯示啟動後的 SQL Server 記錄訊息、指出核心限制的強制執行。</block>
  <block id="e59dc8056170cddb696ba9bff812c325" category="paragraph">SQL Server 會使用作業系統提供的所有 CPU （如果選擇了每個處理器核心授權）。它也會建立排程器 f0r 每個 CPU 、以充分利用任何指定工作負載的資源。當多工處理時、伺服器上的作業系統或其他應用程式可以將處理執行緒從一個處理器切換至另一個處理器。SQL Server 是一種資源密集的應用程式、發生這種情況時、效能可能會受到影響。為了將影響降至最低、您可以設定處理器、以便將所有 SQL Server 負載導向預先選定的處理器群組。這是透過使用 CPU 關聯性遮罩來達成的。</block>
  <block id="e40a45aed8142e74026f5aa7a6ee1122" category="paragraph">關聯性 I/O 遮罩選項會將 SQL Server 磁碟 I/O 繫結至 CPU 子集。在 SQL Server OLTP 環境中、此延伸功能可大幅提升 SQL Server 執行緒的效能、以執行 I/O 作業。</block>
  <block id="16dce493fdad96fe48148f47dc552bfb" category="admonition">* NetApp 推薦 * 適用於資料倉儲等 DSS 、從 50 開始<block ref="1abedc5f6ab369ab9fcd16d6b7990638" prefix=" " category="inline-code"></block>、視需要探索調校或調校。進行變更時、請務必測量應用程式中的關鍵查詢。</block>
  <block id="0add8d6e7be42a854cd7e0161c7f9bcc" category="paragraph">通常會為每個查詢建立個別的作業系統執行緒。如果數百個同時連線到 SQL Server 、則每個查詢的單執行緒組態可能會消耗過多的系統資源。此<block ref="a9233738c364090bbc418d8a0e08a79e" prefix=" " category="inline-code"></block>選項可讓 SQL Server 建立一個工作執行緒集區、以共同為大量查詢要求提供服務、進而協助改善效能。</block>
  <block id="29daf9697a41a463dbe76855a2053a87" category="paragraph">下列範例說明如何使用 T-SQL 設定最大工作執行緒選項。</block>
  <block id="7039e99a0fdcc0d3ef80074ed42bf4e4" category="paragraph">資料庫備份策略應以確定的業務需求為基礎、而非理論能力。透過結合 ONTAP 的 Snapshot 技術並運用 Microsoft SQL Server API 、無論使用者資料庫的大小為何、您都能快速進行應用程式一致的備份。如需更進階或橫向擴充的資料管理需求、 NetApp 提供 SnapCenter 。</block>
  <block id="97e73fdb42ddecb63ed519a484ff3c9b" category="paragraph">SQL Server 也需要作業系統與儲存設備之間的協調、以確保建立時快照中有正確的資料。在大多數情況下、唯一安全的方法是使用 SnapCenter 或 T-SQL 。在沒有這種額外協調的情況下建立的快照、可能無法可靠地恢復。</block>
  <block id="9d831cc4c73b8a2915ce6d8928d55915" category="paragraph">SQL Server 全年無休可用性群組複寫功能是絕佳的選項、 NetApp 提供多種選項、可將資料保護與全年無休整合。不過、在某些情況下、您可能會想要考慮使用 ONTAP 複寫技術。有三個基本選項。</block>
  <block id="dd432f8769e4d3db8acf8bf9df94680a" category="paragraph">SnapMirror 技術提供快速靈活的企業解決方案、可在 LAN 和 WAN 上複寫資料。SnapMirror 技術只會在建立初始鏡射後、將變更的資料區塊傳輸到目的地、大幅降低網路頻寬需求。可以在同步或非同步模式中設定。</block>
  <block id="fce5f84d02dbd5c9e3cfedf18e809644" category="summary">Microsoft SQL Server 和 NetApp MetroCluster</block>
  <block id="41900c1c2eb669e401e4abee9091b40b" category="paragraph">Microsoft SQL Server 部署搭配 MetroCluster 環境需要對 MetroCluster 系統的實體設計進行一些說明。</block>
  <block id="60359402d81f6673550c3df489efb034" category="paragraph">MetroCluster 會同步鏡射不同位置或故障網域中兩個 ONTAP 叢集之間的資料和組態。MetroCluster 會自動管理兩個目標、為應用程式提供持續可用的儲存空間：</block>
  <block id="abf0aedf685f58c3cf3abe3e41ca549c" category="list-text">透過同步鏡射寫入叢集的資料、將還原點目標（ RPO ）歸零。</block>
  <block id="1194ac032fc54dbcf779ac23fbc73dd5" category="list-text">鏡射組態並自動化第二個站台的資料存取、讓還原時間目標（ RTO ）接近零。</block>
  <block id="9aa45379205d52916f2958359e92c1c8" category="paragraph">MetroCluster 可在兩個站台的兩個不同叢集之間自動鏡射資料和組態、提供簡易性。在一個叢集內配置儲存設備時、會自動鏡射到第二個站台的第二個叢集。NetApp SyncMirror ® 以零 RPO 提供所有資料的完整複本。這表示來自單一站台的工作負載可隨時切換至另一站台、並持續提供資料而不會遺失資料。MetroCluster 可管理切換程序、以便在第二個站台存取 NAS 和 SAN 資源配置的資料。MetroCluster 的驗證解決方案設計包含規模調整和組態、可在通訊協定逾時期間或更快（通常少於 120 秒）內執行轉換。這會導致接近零的 RPO 、應用程式可以繼續存取資料而不會發生故障。 MetroCluster 有多種由後端儲存架構定義的變化。</block>
  <block id="47985b72c36de8197de21d06517f1a03" category="paragraph">使用 MetroCluster 保護 SQL Server 是以 SyncMirror 為基礎、提供最高效能的橫向擴充同步鏡射技術。</block>
  <block id="96a36329b3e96b1619b1d635a806bb3f" category="summary">Microsoft SQL Server 搭配 NetApp MetroCluster</block>
  <block id="9fcf1f7a4c16b536048dc5875b61d4b1" category="paragraph">使用零 RPO 來保護 SQL Server 資料庫的其中一個選項是 MetroCluster 。MetroCluster 是一項簡單、高效能的 RPO = 0 複寫技術、可讓您輕鬆複寫整個基礎架構到各個站台。</block>
  <block id="8a7f9ca86b522c62318d9b1eb5b51625" category="paragraph">SQL Server 可在單一 MetroCluster 系統上擴充至數千個資料庫。可能有 SQL Server 獨立執行個體或容錯移轉叢集執行個體、 MetroCluster 系統不一定會新增或變更管理資料庫的任何最佳實務做法。</block>
  <block id="43135677cc98d0d6872d9ec24bef82e4" category="paragraph">MetroCluster 的完整說明不在本文件的範圍內、但原則很簡單。MetroCluster 可提供 RPO=0 複寫解決方案、並可快速容錯移轉。您在這個基礎上建置的內容取決於您的需求。</block>
  <block id="046797023ebbfe8b6dd24d4fc7cab0be" category="paragraph">例如、突然站台遺失之後的基本快速災難恢復程序可能會使用下列基本步驟：</block>
  <block id="f8b79e7c0c5914411ccfda1cbaa25414" category="list-text">強制 MetroCluster 進行</block>
  <block id="740d5da1ae0060ef63f290d3aed64929" category="list-text">執行 FC/iSCSI LUN 的探索（僅限 SAN ）</block>
  <block id="89c617c4ed9cac275e572a67b1c52b29" category="list-text">掛載檔案系統</block>
  <block id="f08329445e69fa49a8223bf365f09e47" category="list-text">啟動 SQL Services</block>
  <block id="b7aabeea5e06b7371d4372fd7f698f88" category="paragraph">此方法的主要需求是在遠端站台上執行作業系統。它必須預先設定 SQL Server 安裝程式、並應以同等版本進行更新。SQL Server 系統資料庫也可以鏡射到遠端站台、並在宣告災難時掛載。</block>
  <block id="2b963bb5f627aa0ffda026b4d97b6474" category="summary">Microsoft SQL Server 和 SM-as 容錯移轉案例</block>
  <block id="b0bb805a1ea68ad43ceacf65954b4b4b" category="paragraph">規劃完整的 SnapMirror 主動式同步應用程式架構時、需要瞭解 SM-AS 在各種計畫性和非計畫性容錯移轉案例中的回應方式。</block>
  <block id="511d40fa1b50f901027391480dff9c67" category="paragraph">安全自動化容錯移轉需要中介程序。理想情況下、它會放置在獨立的第三站台、但如果與參與複寫的叢集之一共存、則仍能滿足大多數需求。</block>
  <block id="cef962a099d3ff2b834420d0c97f5bc1" category="summary">Microsoft SQL Server 和 SM-as 非統一存取</block>
  <block id="3ef2650b3e4d89df6ea0248f432e6c2c" category="paragraph">非統一存取網路表示每部主機只能存取本機儲存系統上的連接埠。SAN 不會延伸至站台（或同一站台內的故障網域）。</block>
  <block id="7c58b14cf1e27ff24a5b6a0656848380" category="summary">Microsoft SQL Server 和 SnapMirror 主動式同步</block>
  <block id="64affc06244780af1f97a68438460989" category="paragraph">SnapMirror 主動式同步功能可讓個別 SQL Server 資料庫和應用程式在儲存設備和網路中斷期間繼續作業、並可透過透明的儲存容錯移轉、無需任何手動介入。</block>
  <block id="0a19f1ca74616d0d4972b2c02c3f7fee" category="paragraph">從 ONTAP 9 。 15.1 開始、 SnapMirror 主動式同步除了支援現有的非對稱組態之外、還支援對稱式主動 / 主動式架構。對稱式主動 / 主動式功能可提供同步雙向複寫、以利業務持續運作和災難恢復。它可協助您保護關鍵 SAN 工作負載的資料存取、同時跨多個故障網域同時讀寫資料、確保不中斷營運、並將災難或系統故障期間的停機時間降至最低。</block>
  <block id="d17dae030927ab027095c1e44df8fbf1" category="paragraph">SQL Server 主機使用光纖通道（ FC ）或 iSCSI LUN 存取儲存設備。在每個託管複寫資料複本的叢集之間進行複寫。由於此功能是儲存層級複寫、因此在獨立主機或容錯移轉叢集執行個體上執行的 SQL Server 執行個體可以執行任何叢集的讀取 / 寫入作業。有關規劃和組態步驟、請參閱<block ref="44f5d8051247437425911d96f84db248" category="inline-link-macro-rx"></block>。</block>
  <block id="b2f689709f901a51858096aaf9637eb4" category="paragraph">** 同步複寫 **</block>
  <block id="71ed2e619a97a27f6fe533714a412725" category="paragraph">在正常作業中、每個複本都是 RPO=0 同步複本、但有一個例外。如果資料無法複寫、 ONTAP 將釋出複寫資料的需求、並在另一個站台上的 LUN 離線時、繼續在一個站台上提供 IO 服務。</block>
  <block id="331b5c7e8c01ec1e37b60de5a5efba6c" category="paragraph">** 儲存硬體 **</block>
  <block id="588068838f06fe39dec548e2210ddf2f" category="paragraph">ONTAP Mediator 是從 NetApp 支援下載的軟體應用程式、通常部署在小型虛擬機器上。ONTAP Mediator 不是一種斷路器。它是參與 SnapMirror 主動同步複寫之兩個叢集的替代通訊通道。自動化作業由 ONTAP 根據合作夥伴透過直接連線和協調員所收到的回應來驅動。</block>
  <block id="6fda40460e9cbbefd704b9c01ea2c18c" category="summary">Microsoft SQL Server 和 SM 做為慣用站台</block>
  <block id="ac420a2d1b21182a80148191683bc9f7" category="paragraph">SnapMirror 主動式同步處理行為是對稱的、但有一個重要的例外是偏好的站台組態。</block>
  <block id="3ccf31c781c6df95109107d66199a8f6" category="section-title">SQL Server 獨立執行個體</block>
  <block id="bd53ef250bf6f7a012cc7ed01c62f8cd" category="inline-link-macro">ONTAP 上的 SQL Server</block>
  <block id="d0d5aa4f66a3624a91ad4b11bbc2250f" category="paragraph">檔案配置和伺服器組態的最佳實務做法與文件中建議的做法相同<block ref="c89905de54b32eb552c83786b7590df9" category="inline-link-macro-rx"></block>。</block>
  <block id="a489ffed938ef1b9e86889bc413501ee" category="inline-link-macro">統一</block>
  <block id="ee289d07b4c3d14dcc9cc162df065f99" category="paragraph">有了獨立安裝程式、 SQL Server 只能在一個站台上執行。可能<block ref="b88135502d93a28469d0c520f73e7e7d" category="inline-link-macro-rx"></block>會使用存取權。</block>
  <block id="50c137c2af8db8930fd9881b4ece5d99" category="inline-image-macro">具有統一存取的單一主機</block>
  <block id="327efeeabe7ad30552ef39a61284b93b" category="paragraph">在統一存取的情況下、任一站台的儲存設備故障都不會中斷資料庫作業。包含資料庫伺服器的站台發生完整的站台故障、當然會導致停機。</block>
  <block id="5bc465d840f8a329d264340f938ab253" category="paragraph">有些客戶可以使用預先設定的 SQL Server 安裝程式來設定在遠端站台上執行的作業系統、並以與正式作業執行個體相同的建置版本進行更新。容錯移轉需要在替代站台上啟動該 SQL Server 獨立執行個體、探索 LUN 、以及啟動資料庫。完整程序可透過 Windows PowerShell Cmdlet 自動化、因為儲存端不需要任何作業。</block>
  <block id="ea7bbefe18f9ad7af62904dd6da19c33" category="inline-link-macro">不一致</block>
  <block id="b53a3ef75c6e33a4f8945589cbe8beee" category="paragraph"><block ref="56d4a3cb11d7ad2b0e560d2cc8afde2c" category="inline-link-macro-rx"></block>也可以使用存取、但如果資料庫伺服器所在的儲存系統故障、則會導致資料庫中斷、因為資料庫沒有可用的儲存路徑。在某些情況下、這點仍可接受。SnapMirror 主動式同步仍會提供 RPO = 0 資料保護、萬一站台發生故障、仍在運作中的複本就會開始運作、並可使用與上述統一存取相同的程序來恢復作業。</block>
  <block id="a2e30e760061ab42fd5030c552306712" category="paragraph">使用虛擬化主機可更輕鬆地設定簡單且自動化的容錯移轉程序。例如、如果 SQL Server 資料檔案與開機 VMDK 同步複寫至次要儲存設備、則在發生災難時、可在其他站台啟動完整的環境。系統管理員可以手動啟動仍在運作的站台上的主機、或是透過 VMware HA 等服務來自動化程序。</block>
  <block id="f04055c72ba32a95b9830308e4508cb1" category="section-title">SQL Server 容錯移轉叢集執行個體</block>
  <block id="21fd4631916f5c0e63ef67f98d413d6a" category="paragraph">SQL Server 容錯移轉執行個體也可以裝載在實體伺服器或虛擬伺服器上執行的 Windows 容錯移轉叢集上、做為客體作業系統。這種多主機架構可提供 SQL Server 執行個體和儲存恢復能力。這類部署在尋求健全容錯移轉程序、同時維持強化效能的高需求環境中非常有用。在容錯移轉叢集設定中、當主機或主要儲存設備受到影響時、 SQL Services 會容錯移轉至次要主機、同時次要儲存設備也可用於 IO 。無需自動化指令碼或系統管理員介入。</block>
  <block id="58daef667c5e83ded89d712a683c532b" category="summary">Microsoft SQL Server 和 SM-as 統一存取</block>
  <block id="b8c5c455d22a62b43bd58615af0a569e" category="paragraph">統一存取網路意味著主機可以存取兩個站台（或同一個站台內的故障網域）上的路徑。</block>
  <block id="fdbd6bb11fa9bf15b9e53c8f359e821c" category="list-text">如果使用 SMB 、目的地 SVM 必須是來源 SVM 所屬 Active Directory 網域的成員、如此一來、在從災難恢復期間、 NAS 檔案中儲存的存取控制清單（ ACL ）就不會中斷。</block>
  <block id="d5a7d81e3f495111d65621aede2e26a4" category="list-text">不需要使用與來源 Volume 名稱相同的目的地 Volume 名稱、但可讓將目的地 Volume 掛載至目的地的程序更容易管理。如果使用 SMB 、您必須在來源命名空間的路徑和目錄結構中、使目的地 NAS 命名空間相同。</block>
  <block id="4dd0779e2b7f46c37eb5ec38cdde3bb6" category="list-text">在需要快速資料恢復的情況下使用同步複寫、而非同步解決方案則可在 RPO 中靈活運用。</block>
  <block id="829f5bea960b53b5f1e50e8288a740d4" category="paragraph">檔案群組中的邏輯物件放置與實體資料庫檔案之間的分隔、可讓您微調資料庫檔案配置、充分發揮儲存子系統的效益。支援給定工作負載的資料檔案數量可視需要而有所不同、以支援 I/O 需求和預期容量、而不會影響應用程式。資料庫配置的這些變化對應用程式開發人員來說是透明的、他們將資料庫物件放置在檔案群組中、而非資料庫檔案中。</block>
  <block id="df42f2a843e18c9b5f6adccba2ffcbf9" category="paragraph">執行 Volume 維護工作在 SQL Server 2016 中已簡化、稍後會在安裝過程中提供選項。此圖顯示選項、可授予 SQL Server 資料庫引擎服務執行 Volume 維護工作的權限。</block>
  <block id="8c0ea2438ef8ec6eede8f5ae6996c5a0" category="paragraph">控制資料庫檔案大小的另一個重要資料庫選項是自動壓縮。啟用此選項時、 SQL Server 會定期縮減資料庫檔案、減少檔案大小、並釋出空間給作業系統。這項作業需要大量資源、而且很少有用、因為當新資料進入系統時、資料庫檔案會在一段時間後再次增加。資料庫上不應啟用自動壓縮。</block>
  <block id="58083df92a650a52d9ea6e4d544ffbd8" category="list-text">在 SnapCenter 複製交易記錄檔的專用磁碟區上建立主機記錄目錄。</block>
  <block id="42ad46ab967ef7af8287ca8a5c12f2d1" category="paragraph">下節說明最佳化資料庫效能所需的 SQL Server 記憶體設定。</block>
  <block id="4e6b5a65dde214f8e25b7adbac9c9583" category="paragraph">最大伺服器記憶體選項可設定 SQL Server 執行個體可使用的最大記憶體容量。如果在執行 SQL Server 的同一部伺服器上執行多個應用程式、而且您想要保證這些應用程式有足夠的記憶體可以正常運作、通常會使用此功能。</block>
  <block id="fb182faf8ee092092118e8cbb568ae0d" category="paragraph">有些應用程式只會在啟動時使用任何可用的記憶體、而且不會要求額外的記憶體、即使這些應用程式的記憶體承受著記憶體壓力。這就是最大伺服器記憶體設定的作用所在。</block>
  <block id="c7af956e7765f16c090e0eab836fb42a" category="paragraph">若要使用 SQL Server Management Studio 調整最小或最大伺服器記憶體、必須重新啟動 SQL Server 服務。您也可以使用以下代碼、使用 TransAct SQL （ T-SQL ）來調整伺服器記憶體：</block>
  <block id="0abaf38d5c4f997a2507fe6e57682b0b" category="paragraph">非一致性記憶體存取（ NUMA ）是一項記憶體存取最佳化技術、可協助避免處理器匯流排上的額外負載。</block>
  <block id="87dfe44a851d25873ee6bd0691ac0c6e" category="paragraph">如果在安裝 SQL Server 的伺服器上設定 NUMA 、則不需要額外的組態、因為 SQL Server 可感知 NUMA 並在 NUMA 硬體上執行良好。</block>
  <block id="7cf384150f5c5317f48125af9bf68c31" category="paragraph">索引建立記憶體選項是另一個進階選項、通常不需要變更為預設值。</block>
  <block id="64e199b7fb089ffb63f4c4396bac2cd1" category="paragraph">根據預設， [ 每個查詢的最小記憶體 ] 設定會為每個要執行的查詢分配 &gt;= 至 1024KB 。最佳做法是將此設定保留為預設值、以便 SQL Server 能夠動態管理分配給索引建立作業的記憶體量。不過、如果 SQL Server 的 RAM 超過有效執行所需的容量、則如果您增加此設定、某些查詢的效能可能會大幅提升。因此、只要 SQL Server 、任何其他應用程式或作業系統未使用的伺服器上有可用的記憶體、則提升此設定有助於整體 SQL Server 效能。如果沒有可用的可用記憶體、增加此設定可能會影響整體效能。</block>
  <block id="95a3a11e77f5071b2a97b611548b866c" category="paragraph">本最佳實務做法一節的範圍僅限於根據 NetApp 建議的儲存基礎架構原則和偏好的標準進行技術設計。端點對端點實作超出範圍。</block>
  <block id="133dcf168b09b98ab4e6c6f77a743a14" category="paragraph">如需 NetApp 產品的相容性資訊，請參閱<block ref="18e7fcfe606d6d0912191de7fd9eb56a" category="inline-link-macro-rx"></block>。</block>
  <block id="961963c19132b001c6c7289519292be5" category="paragraph">部署 SQL Server 之前、您必須先瞭解 SQL Server 資料庫執行個體所支援之應用程式的工作負載需求。每個應用程式對於容量、效能和可用度的需求各不相同、因此每個資料庫都應該設計成能以最佳方式支援這些需求。許多組織會使用應用程式需求來定義 SLA 、將資料庫分類為多個管理層。SQL Server 工作負載通常分類如下：</block>
  <block id="d748a2050ea9de15020c9f22e1c8a802" category="list-text">OLTP 通常是組織中最重要的資料庫。這些資料庫通常會支援面對客戶的應用程式、因此被視為是公司核心營運不可或缺的一環。關鍵任務 OLTP 資料庫及其支援的應用程式通常都有需要高效能的 SLA 、對效能降低敏感且需要最大可用度。他們也可能是永遠在容錯移轉叢集或永遠在可用度群組的候選對象。這些資料庫類型的 I/O 混合通常以 75% 到 90% 的隨機讀取和 25% 到 10% 的寫入為特徵。</block>
  <block id="542d0aad1735dc536565c8a1ec4b579f" category="list-text">決策支援系統（ DSS ）資料庫、有時稱為資料倉儲。這些資料庫對於許多仰賴分析來協助其業務的組織而言、都是關鍵任務。執行查詢時、這些資料庫會對 CPU 使用率和從磁碟讀取作業敏感。在許多組織中、 DSS 資料庫在月底、每季和每年都是最重要的此工作負載通常有將近 100% 的讀取 I/O 混合、而 IO 處理量通常比 IOPS 更重要。</block>
  <block id="af2a7a153f6f4904cc7384604809cf3c" category="paragraph">SQL Server 可設定為每部伺服器的單一執行個體、或設定為多個執行個體。正確的決策通常取決於各種因素、例如伺服器是用於正式作業或開發、無論執行個體是否對業務營運和效能目標至關重要。</block>
  <block id="8f66f557400d1222f6352dbc8811ec03" category="paragraph">共享執行個體組態一開始可能比較容易設定、但可能會導致資源被分割或鎖定的問題、進而導致在共享 SQL Server 執行個體上主控資料庫的其他應用程式發生效能問題。</block>
  <block id="40d6bdd2be551c4046e5ad632c4dfe71" category="paragraph">ONTAP 儲存解決方案與 Microsoft SQL Server 的結合、可實現企業級資料庫儲存設計、滿足現今最嚴苛的應用程式需求。</block>
  <block id="9e020f08745f560c049f43a1b5ead190" category="paragraph">在 ONTAP 解決方案上最佳化 SQL Server 需要瞭解 SQL Server I/O 模式和特性。SQL Server 資料庫設計完善的儲存配置必須支援 SQL Server 的效能需求、同時提供整個基礎架構的最大管理能力。良好的儲存配置也能讓初始部署成功、並隨著業務成長、環境隨時間而順利成長。</block>
  <block id="9eb2f26da39e165d9e3a1c48b5798690" category="paragraph">磁碟區會建立並位於集合體內。此術語有時會造成混淆、因為 ONTAP 磁碟區不是 LUN 。ONTAP Volume 是資料的管理容器。磁碟區可能包含檔案、 LUN 、甚至 S3 物件。磁碟區不會佔用空間、只會用於管理內含的資料。</block>
  <block id="64999620676d7bc615f88fabe256272f" category="list-text">如果您在 SMB 共用上安裝 SQL Server 、請確定已在 SMB 磁碟區上啟用 Unicode 以建立資料夾。</block>
  <block id="b0874893f6e3e7030833ec488dc9da90" category="list-text">將使用者資料檔案放<block ref="937f38432beb92fdba3d47780720bdf7" prefix="(" category="inline-code"></block>在不同的磁碟區上、因為它們是隨機讀取 / 寫入工作負載。建立交易記錄備份的頻率通常高於資料庫備份。因此<block ref="cb15b9539ae0d984ff8740c68b52561c" prefix="(" category="inline-code"></block>、請將交易記錄檔放在不同的磁碟區或 VMDK 上、以便為每個資料檔案建立獨立的備份排程。這種分隔方式也能將記錄檔的連續寫入I/O與資料檔案的隨機讀寫I/O隔離、大幅提升SQL Server效能。</block>
  <block id="f7f1cb17ab4960f1a8e4c28a7fbccb0d" category="list-text">請勿在同一個 LUN 上混合使用資料庫和非資料庫檔案、例如與全文搜尋相關的檔案。</block>
  <block id="58ccb3e2006ffa82c78944061df94b30" category="paragraph">ONTAP 儲存效率經過最佳化、可儲存及管理 SQL Server 資料、但所需的儲存空間最少、而且不會影響效能。</block>
  <block id="6f80e9146e2184b9ec3c46b6d7dd903f" category="paragraph">當 SQL Server 必須寫入特殊系統頁面以分配新物件時、頁面爭用可能會發生在通用分配對應（ GAM ）、共用全域分配對應（ SGAM ）或頁面可用空間（ PFS ）頁面上。鎖條會將這些頁面鎖定在記憶體中。在忙碌的 SQL Server 執行個體上、在 tempdb 的系統頁面上取得鎖定可能需要很長時間。這會導致查詢執行時間變慢、也稱為鎖定爭用。請參閱下列建立 tempdb 資料檔案的最佳實務做法：</block>
  <block id="255bd5c00b8de4b2f998369f766b2b5e" category="paragraph">本節說明遠端資料保護、將資料複寫到遠端站台、以保護異地儲存和災難恢復的安全。請注意、這些表格並未解決同步鏡射資料保護問題。如需此需求、請參閱 NetApp MetroCluster 文件、包括<block ref="06d0604733fc7f7e3f9befaa1239278d" category="inline-link-macro-rx"></block>和<block ref="87f167af2516b222ddeec7405581e8b8" category="inline-link-macro-rx"></block></block>
  <block id="ad8d77efdce72d372a83929b50a127d1" category="paragraph">資料集的損毀一致備份是指在單一時間點擷取整個資料集結構。如果資料集儲存在單一磁碟區中、則程序很簡單；您可以隨時建立 Snapshot 。如果資料集橫跨多個磁碟區、則必須建立一致性群組（ CG ）快照。建立 CG 快照有多種選項、包括 NetApp SnapCenter 軟體、原生 ONTAP 一致性群組功能、以及使用者維護的指令碼。</block>
  <block id="3c27a8d13352bda1e272615270d5faba" category="paragraph">資料庫的損毀一致備份是指在單一時間點擷取整個資料庫結構、包括資料檔案、重做記錄和控制檔。如果資料庫儲存在單一磁碟區中、則程序很簡單；您可以隨時建立 Snapshot 。如果資料庫橫跨磁碟區、則必須建立一致性群組（ CG ）快照。建立 CG 快照有多種選項、包括 NetApp SnapCenter 軟體、原生 ONTAP 一致性群組功能、以及使用者維護的指令碼。</block>
  <block id="7589d3d0b42e170fc0a459aba0b87fd6" category="paragraph">當資料庫非常大或必須盡快恢復時、最好使用 VBSR 、而使用 VSR 需要隔離資料檔案。在 NFS 環境中、指定資料庫的資料檔案必須儲存在專用的磁碟區中、而這些磁碟區不會受到任何其他類型的檔案污染。在 SAN 環境中、資料檔案必須儲存在專用磁碟區上的專用 LUN 中。如果使用 Volume Manager （包括 Oracle 自動儲存管理 [AS] ）、則磁碟群組也必須專用於資料檔案。</block>
  <block id="d8c4de538bee7abe14d3527c343afee7" category="paragraph">如果需要雙主動式擴充 RAC 、則應考慮使用 SnapMirror 主動式同步來取代 MetroCluster 。SM-AS 複寫可讓您偏好資料的特定複本。因此、可以內建擴充 RAC 叢集、讓所有讀取作業都在本機進行。讀取 I/O 永遠不會跨越網站、因此可提供最低的延遲。所有寫入活動仍必須傳輸站台間連線、但任何同步鏡射解決方案都無法避免此類流量。</block>
  <block id="be6001fc2ab5bfaacf123c0267e58a0a" category="admonition">如果開機 LUN （包括虛擬化開機磁碟）與 Oracle RAC 搭配使用、則<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block>可能需要變更參數。如需 RAC 逾時參數的詳細資訊<block ref="1d616ba7dc3776fc2ecabd1cd20f420f" category="inline-link-macro-rx"></block>、請參閱。</block>
  <block id="2bd32004298994cdcbc5a1672f2b8c95" category="summary">Oracle 單一執行個體、含 SnapMirror 作用中同步</block>
  <block id="b704207e8ec8f6bbae1764da78cb5232" category="doc">Oracle 與 SnapMirror 主動式同步</block>
  <block id="93c480a0b6f335159bf44fcf2e2bec93" category="paragraph">使用 SnapMirror 主動式同步不一定會新增或變更任何操作資料庫的最佳實務做法。</block>
  <block id="30bca7463d8c7b2108be553aabb70549" category="paragraph">最佳架構取決於業務需求。例如、如果目標是在資料遺失的情況下提供 RPO =0 保護、但 RTO 是放寬的、則使用 Oracle 單一執行個體資料庫並以 SM 方式複寫 LUN 、可能就足以滿足 Oracle 授權標準的要求、而且成本也較低。遠端站台的故障不會中斷作業、而主站台的遺失會導致仍在運作中的站台產生 LUN 、而這些 LUN 已在線上且可供使用。</block>
  <block id="34ff499afe445b877410a8ae3527a84f" category="paragraph">如果 RTO 更嚴格、則透過指令碼或叢集軟體（例如 Pacemaker 或 Ansible ）進行基本主動被動式自動化、可縮短容錯移轉時間。例如、可將 VMware HA 設定為偵測主要站台上的 VM 故障、並在遠端站台上啟用 VM 。</block>
  <block id="63cededd737a118049828e08a2a7e8c7" category="paragraph">最後、為了實現極快速的容錯移轉、 Oracle RAC 可部署在各個站台上。RTO 基本上為零、因為資料庫會隨時在線上、且可在兩個站台上使用。</block>
  <block id="5d0f4a1c768b6f8fc0a38580e17ef62b" category="summary">Oracle Extended RAC 搭配 SnapMirror 主動式同步</block>
  <block id="596d088e9c01a0ceec54de24c763f7c4" category="paragraph">許多客戶透過在各個站台之間延伸 Oracle RAC 叢集來最佳化 RTO 、進而實現完全主動式的組態。整體設計變得更複雜、因為它必須包含 Oracle RAC 的仲裁管理。</block>
  <block id="c128a5dcb6cee18ff198d2c48937cea1" category="paragraph">傳統的延伸 RAC 叢集式仰賴 ASM 鏡射來提供資料保護。這種方法可行、但也需要大量手動設定步驟、並對網路基礎架構造成負擔。相反地、讓 SnapMirror 主動式同步處理負責資料複寫、可大幅簡化解決方案。同步、中斷後重新同步、容錯移轉和仲裁管理等作業都變得更簡單、而且 SAN 不需要分散在各個站台上、如此就能簡化 SAN 的設計與管理。</block>
  <block id="74f82d1e2ecf05353775ddaeb38bcddd" category="paragraph">瞭解 SnapMirror 主動式同步上的 RAC 功能的關鍵在於將儲存裝置視為單一 LUN 集、並以鏡射儲存設備為主控。例如：</block>
  <block id="68dcade92edf97d052fd54be2dc6b60c" category="inline-image-macro">Oracle 邏輯存取</block>
  <block id="9c4d005ebe3fb148615bd62837da8194" category="paragraph"><block ref="9c4d005ebe3fb148615bd62837da8194" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b88e2c412773438221951df1b45aa00c" category="paragraph">沒有主要複本或鏡射複本。從邏輯上來說、每個 LUN 只有一個複本、而位於兩個不同儲存系統上的 SAN 路徑上則有該 LUN 可用。從主機的角度來看、沒有儲存容錯移轉、而是有路徑變更。當其他路徑保持連線時、各種故障事件可能會導致通往 LUN 的特定路徑遺失。SnapMirror 主動式同步可確保所有作業路徑都能使用相同的資料。</block>
  <block id="31c1d5c6e07b5b3d11e0585af763dc13" category="paragraph">在此範例組態中、 ASM 磁碟的組態與企業儲存設備上任何單站台 RAC 組態的組態相同。由於儲存系統提供資料保護、因此會使用 ASM 外部備援。</block>
  <block id="f016e2bef75fc762898fb65f21fb9836" category="section-title">統一存取與不通知存取</block>
  <block id="c70bc2caf8d25b4a91254d72909c7e75" category="paragraph">在 SnapMirror 主動式同步上使用 Oracle RAC 最重要的考量、是使用統一或非統一存取。</block>
  <block id="7cb7fcd446ee1d35aa27d2af5532e2ea" category="paragraph">統一存取意味著每個主機都可以看到兩個叢集上的路徑。非統一存取表示主機只能看到本機叢集的路徑。</block>
  <block id="53934f78a11bd68da05d52b4f83ec9fc" category="paragraph">這兩個選項都不是特別推薦或不鼓勵的。有些客戶可以隨時連線到網站、有些客戶可能沒有這種連線能力、或是他們的 SAN 基礎架構不支援長距離 ISL 。</block>
  <block id="53772793c4bb5f4dac1c6c0eade7403c" category="section-title">不一致的存取</block>
  <block id="68f708ec0a3f5091f6e432be351bf3cc" category="paragraph">從 SAN 的角度來看、不一致的存取更容易設定。</block>
  <block id="b923541ce3d0d3feae5be9fb6199f770" category="inline-image-macro">Oracle RAC 非統一存取</block>
  <block id="b7d64dea0436c64fbd1652575479aa68" category="paragraph"><block ref="b7d64dea0436c64fbd1652575479aa68" category="inline-image-macro-rx" type="image"></block></block>
  <block id="58dcba3041e7c7c3352e2c7f9f497eb5" category="inline-link-macro">不一致的存取</block>
  <block id="52aa3a00cda7a8077552683f88c13e20" category="paragraph">此方法的主要缺點<block ref="56ad9440d84c5145567c05e340b22f93" category="inline-link-macro-rx"></block>是、站台對站台 ONTAP 連線中斷或儲存系統遺失、將導致一個站台的資料庫執行個體遺失。這顯然不是理想的做法、但在交換較簡單的 SAN 組態時、這可能是可接受的風險。</block>
  <block id="4f7fff29e362cc56706e5fe5d34884b6" category="section-title">統一存取</block>
  <block id="df51b4c411cdf825abbf60c345b2886c" category="paragraph">統一存取需要將 SAN 延伸至各個站台。主要優點是儲存系統的遺失不會導致資料庫執行個體遺失。相反地、它會導致路徑目前正在使用的多重路徑變更。</block>
  <block id="bb79831252d74e631b0f64224932d6e6" category="paragraph">有幾種方法可以設定不一致的存取。</block>
  <block id="8ce82023c8f26832db1e79b32f2f7171" category="admonition">在下圖中、也會出現一些作用中但未最佳化的路徑、這些路徑會在簡單的控制器故障期間使用、但這些路徑並不代表簡化圖表的目的。</block>
  <block id="15670c5b41a372b781730d1a2677ed57" category="section-title">具有鄰近設定的 AFF</block>
  <block id="e2b2f6d768064f58804cd8cb2f295266" category="paragraph">如果站台之間存在嚴重延遲、則可以使用主機鄰近設定來設定 AFF 系統。如此一來、每個儲存系統就能知道哪些主機是本機主機、哪些是遠端主機、並適當地指派路徑優先順序。</block>
  <block id="5ffb901a29d38d4d4f7c462ffbd0ad7f" category="inline-image-macro">具有統一存取的 RAC</block>
  <block id="efdefb56bfdac6f3b9194f8ce94b9ae9" category="paragraph"><block ref="efdefb56bfdac6f3b9194f8ce94b9ae9" category="inline-image-macro-rx" type="image"></block></block>
  <block id="e106da7d1088531e38324a9d76b9a988" category="paragraph">在正常作業中、每個 Oracle 執行個體都會優先使用本機主動 / 最佳化路徑。結果是所有讀取都會由區塊的本機複本提供服務。這會產生最低的可能延遲。寫入 IO 也同樣會向下傳送至本機控制器的路徑。在確認之前必須複寫 IO 、因此仍會產生跨越站台對站台網路的額外延遲、但在同步複寫解決方案中無法避免這種情況。</block>
  <block id="889ea87800d5947e36cda77f7d1b16b4" category="section-title">ASA / AFF 不含感應設定</block>
  <block id="a92e6cf0c610f6072564d047ffa516be" category="paragraph">如果站台之間沒有明顯的延遲、則可在不設定主機鄰近設定的情況下設定 AFF 系統、或使用 ASA 。</block>
  <block id="7760495be1250342ca752bb9cdc684ee" category="paragraph"><block ref="7760495be1250342ca752bb9cdc684ee" category="inline-image-macro-rx" type="image"></block></block>
  <block id="6bad71277bac94b02b8ad4267095b9e1" category="paragraph">每個主機都可以使用兩個儲存系統上的所有作業路徑。如此一來、每部主機就能充分發揮兩個叢集的效能潛力、而不只是一個叢集、進而大幅提升效能。</block>
  <block id="56473d7f95c121dd938752e3ee76807e" category="paragraph">有了 ASA 、不僅兩個叢集的所有路徑都會視為作用中且最佳化、而且合作夥伴控制器上的路徑也會是作用中的。結果是整個叢集上的全作用中 SAN 路徑、</block>
  <block id="22ede275964a6c559bc3f8f6d60e47ff" category="admonition">ASA 系統也可用於非統一存取組態。由於不存在跨站台路徑、因此透過 ISL 的 IO 不會影響效能。</block>
  <block id="263e6bb36868a481a8831ae728712452" category="summary">Oracle SnapMirror 作用中同步</block>
  <block id="d1864442faf9b87db487ba86c72892a9" category="paragraph">以下說明的範例顯示部署具有 SnapMirror 作用中同步複寫之 Oracle 單一執行個體資料庫的許多選項。</block>
  <block id="1bd45bc28deaa95af95dd782d94963fa" category="inline-image-macro">具有不統一存取的 Oracle SI</block>
  <block id="c94bc93663b0f709f6a6885553fe9153" category="paragraph"><block ref="c94bc93663b0f709f6a6885553fe9153" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b29b2b92ebd168fbb013ea878c5c1075" category="paragraph">SnapMirror 主動式同步功能可在災難恢復站台上提供資料的同步複本、但要讓資料可用、則需要作業系統和相關應用程式。基本自動化可大幅改善整體環境的容錯移轉時間。叢集件產品（例如 Pacemaker ）通常用於在站台之間建立叢集、在許多情況下、容錯移轉程序可以使用簡單的指令碼來驅動。</block>
  <block id="1e953e50c45ead229eae67ed609a3a1e" category="paragraph">如果主節點遺失、叢集軟體（或指令碼）將會在替代站台上線。其中一個選項是建立預先針對組成資料庫的 SAN 資源所預先設定的待命伺服器。如果主站台發生故障、叢集軟體或指令碼替代方案會執行類似下列的一系列動作：</block>
  <block id="861373097ad1daff7221c81f1ffb8bd2" category="list-text">偵測主要站台故障</block>
  <block id="471eb645214523a67e69f308fd203df5" category="list-text">執行 FC 或 iSCSI LUN 的探索</block>
  <block id="aaae9cdb1dc3caf850c21cbae6cb7dd9" category="paragraph">實際的啟動程序很簡單。LUN 探索等命令每個 FC 連接埠只需要幾個命令。檔案系統掛載只是一個<block ref="19822b1b15d9eefc54c07ab49f87b100" prefix=" " category="inline-code"></block>命令、只要一個命令、即可在 CLI 上啟動和停止資料庫和 ASM 。</block>
  <block id="81760e5cf8ff0457c9927339fe0d7987" category="list-text">手動啟動資料庫、或將虛擬機器設定為自動啟動資料庫。</block>
  <block id="17ad404af9b36204bcadadd073042e1c" category="paragraph">例如、 ESX 叢集可以跨越站台。在發生災難時、虛擬機器可在移至災難恢復站台後上線。</block>
  <block id="06c019e625f0595de8528ac88cab1815" category="section-title">儲存設備故障保護</block>
  <block id="0559887c95614fe388b0dc7f8914a2db" category="paragraph">上圖顯示的用途<block ref="56ad9440d84c5145567c05e340b22f93" category="inline-link-macro-rx"></block>、其中 SAN 並未延伸至各個站台。這可能比較容易設定、在某些情況下、可能是目前 SAN 功能唯一的選項、但也表示主要儲存系統故障會導致資料庫中斷、直到應用程式容錯移轉為止。</block>
  <block id="5cbfe7798787ccd0e92fcaceca503314" category="inline-link-macro">統一存取</block>
  <block id="38a1b98129ec5892c90cdda2967b957c" category="paragraph">為了獲得更高的恢復能力、您可以使用部署解決方案<block ref="8c3bdda17267bf34dafd546406201d13" category="inline-link-macro-rx"></block>。如此可讓應用程式繼續使用從另一站點廣告的路徑運作。</block>
  <block id="d77ca8b041bbb54326491bb1aeb6fadf" category="doc">Oracle 與 SnapMirror 主動式同步 - RAC 斷路器</block>
  <block id="084a4c8d8d6223c9b3c0749a4097bf8f" category="paragraph">雖然使用 SnapMirror 主動式同步的延伸 RAC 是 IO 的對稱架構、但有一個例外是連線至大腦分割管理。</block>
  <block id="f0dd83fae83b5ba13b4e8c760578f47f" category="paragraph">如果複寫連結遺失且兩個站台都沒有仲裁、會發生什麼情況？應該發生什麼事？此問題同時適用於 Oracle RAC 和 ONTAP 行為。如果無法跨站台複寫變更、而您想要恢復作業、則其中一個站台必須生存、另一個站台必須無法使用。</block>
  <block id="58dc7db50a2e11a9de9e6cc092c59d4d" category="inline-link-macro">資訊媒體ONTAP</block>
  <block id="406abe933a832eefeb56c0390b824200" category="paragraph">可<block ref="6663df057ff17bcadb83516e8fd742b7" category="inline-link-macro-rx"></block>在 ONTAP 層解決此需求。RAC 中斷有多個選項。</block>
  <block id="1a7cedbe5066c42f7f901bffc7905f59" category="section-title">Oracle tiebreaker</block>
  <block id="236ca78f8e5b54033dbbd133abe79e60" category="paragraph">管理分離式 Oracle RAC 風險的最佳方法、是使用奇怪數量的 RAC 節點、最好是使用第三站台的斷路器。如果第三個站台無法使用、則可將斷路器執行個體放置在兩個站台的其中一個站台、有效地將其指定為慣用的生存者站台。</block>
  <block id="af70ccf0217a2356d2bcebb6fab5a25b" category="section-title">Oracle 和 CSS_critical</block>
  <block id="e7c7cde013ca0177a945b339ca49fe1d" category="paragraph">對於偶數個節點、預設的 Oracle RAC 行為是叢集中的其中一個節點將被視為比其他節點更重要。具有較高優先順序節點的站台會在站台隔離後繼續運作、而另一個站台上的節點則會被移除。優先順序是以多個因素為基礎、但您也可以使用設定來控制此行為<block ref="6124b1cbe711d49d95a1c41d4e2701b4" prefix=" " category="inline-code"></block>。</block>
  <block id="1a79a4d60de6718e8e5b326e338ae533" category="inline-link-macro">範例</block>
  <block id="6ae35dd8ffe888ab910de0d5d5e3a45a" category="paragraph">在<block ref="0a286933b98d5160dd3059338d9fd4c7" category="inline-link-macro-rx"></block>架構中、 RAC 節點的主機名稱為 jfs12 和 jfs13 。的目前設定<block ref="6124b1cbe711d49d95a1c41d4e2701b4" prefix=" " category="inline-code"></block>如下：</block>
  <block id="d05ceaa3e91a5aa94cbe7a8ac83ad048" category="paragraph">如果您想要將具有 jfs12 的站台設為慣用站台、請在站台 A 節點上將此值變更為「是」、然後重新啟動服務。</block>
  <block id="d7e25fc2f6769b17d752bc3cde6d0266" category="summary">Oracle 與 SnapMirror 主動同步容錯移轉</block>
  <block id="f0972b46fa5671c4841c63750ccdebb9" category="doc">SnapMirror 主動式同步： Oracle RAC 複寫遺失</block>
  <block id="8a6c7e7b423c27776aad808ff121ced3" category="paragraph">喪失 Oracle RAC 複寫連結會產生類似於 SnapMirror 連線中斷的結果、但預設會縮短逾時時間。在預設設定下、 Oracle RAC 節點會在遺失儲存連線後等待 200 秒後才會消失、但在 RAC 網路心跳中斷後、只會等待 30 秒。</block>
  <block id="488bd272072f6a962dc0b8f69fc362b8" category="paragraph">CRS 訊息類似於下列訊息。您可以看到 30 秒的逾時時間。由於 CSS_critical 設定在站台 A 上的 jfs12 上、這將是要生存的站台、而站台 B 上的 jfs13 將被逐出。</block>
  <block id="80f8fcffb7c608c6d25e68111eb38b2d" category="summary">Oracle 與 SnapMirror 主動式同步 - 手動容錯移轉</block>
  <block id="0d97f4e7841f881ee429033c005d63ef" category="paragraph">「容錯移轉」一詞並不表示使用 SnapMirror 主動式同步進行複寫的方向、因為它是雙向複寫技術。相反地、「容錯移轉」是指在發生故障時、哪個儲存系統是偏好的站台。</block>
  <block id="669420d9776c5672f6a1edf3bbf41604" category="paragraph">例如、您可能想要在關閉站台進行維護之前、或是在執行 DR 測試之前、執行容錯移轉以變更偏好的站台。</block>
  <block id="1a5cda38e5f45bb47ad55cae28a62d58" category="paragraph">GUI 範例：</block>
  <block id="dd8c4d4a8c7db09b331d019e9ba3a643" category="inline-image-macro">以 SM 為偏好的站台的 SystemManager 剪輯</block>
  <block id="50925d08482582f6a3178736557a9d6c" category="paragraph"><block ref="50925d08482582f6a3178736557a9d6c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="beecd91de8185d21ecef9d430e18d4dc" category="paragraph">透過 CLI 將其改回的範例：</block>
  <block id="3877a64f9dbc63cfbdca7e30e66c42a2" category="summary">Oracle 和 SnapMirror 主動同步 - 中介故障</block>
  <block id="9daff60ceba391d4160d5e54f14037d8" category="paragraph">中介服務無法直接控制儲存作業。它可作為叢集之間的替代控制路徑。它主要用於自動化容錯移轉、而不會有發生分裂的風險。</block>
  <block id="13ce4a149213a3a389210201d2850f7c" category="paragraph">在正常作業中、每個叢集都會將變更複寫到其合作夥伴、因此每個叢集都可以驗證合作夥伴叢集是否在線上並提供資料。如果複寫連結失敗、複寫就會停止。</block>
  <block id="381c63e25d0de40f5be6677aa1346b0e" category="paragraph">安全自動化作業需要協調員的原因、是因為儲存叢集無法判斷雙向通訊是否因為網路中斷或實際儲存設備故障而中斷。</block>
  <block id="e51e3b7c6dff02b4ab76ceab7b000eb8" category="list-text">由於任何原因而導致複寫服務失敗、將導致首選站台釋放 RPO = 0 狀態、並恢復讀寫 IO 處理。非慣用站台將使其路徑離線。</block>
  <block id="957e90f10d8268ba74dc866bec3ed2fa" category="doc">SnapMirror 主動式同步 - 連線中斷總數</block>
  <block id="4470e5dd55a8a6253ccfd5dca462e193" category="paragraph">如果站台之間的複寫連結完全遺失、則 SnapMirror 主動式同步和 Oracle RAC 連線都會中斷。</block>
  <block id="cd48b65842aa3ca6718bf9d05c82a272" category="paragraph">Oracle RAC SPLIT 偵測功能與 Oracle RAC 儲存設備活動訊號有關。如果站台對站台連線中斷導致 RAC 網路心跳和儲存複寫服務同時中斷、結果是 RAC 站台無法透過 RAC 互連或 RAC 投票磁碟進行跨站台通訊。在預設設定下、這兩個站台可能會被移除、因此產生一組偶數的節點。具體行為將取決於事件順序、 RAC 網路和磁碟心跳輪詢的時間。</block>
  <block id="d76ecbc1eb83c7a69064a5bb857c85c9" category="inline-link-macro">斷路器</block>
  <block id="acef32b29f0767a38d288d2517fd82e4" category="paragraph">雙站台中斷的風險可透過兩種方式解決。首先、<block ref="5eea39840e87052aa3c632ea60116716" category="inline-link-macro-rx"></block>可以使用組態。</block>
  <block id="f52f16ab0735aaefebdd18f6be0a1d9a" category="paragraph">如果第三站台無法使用、則可調整 RAC 叢集上的「錯誤數」參數來解決此風險。根據預設值、 RAC 網路心跳逾時為 30 秒。這通常是 RAC 用來識別故障的 RAC 節點、並將其從叢集中移除。它也與投票磁碟活動訊號有連線。</block>
  <block id="c2b5462b64e9fc5a5b57a31b233c8857" category="paragraph">例如、如果反鏟切斷了傳輸 Oracle RAC 和儲存複寫服務站台間流量的處理通道、則 30 秒錯過計數倒數將會開始。如果 RAC 偏好的站台節點無法在 30 秒內重新與另一個站台建立連絡、而且也無法使用投票磁碟來確認對方站台在相同的 30 秒內停機、則偏好的站台節點也會被移除。結果是資料庫完全中斷。</block>
  <block id="db651e89ed200f74c11c1ae1c5d2b32d" category="paragraph">視發生錯誤數輪詢的時間而定、 30 秒可能不足以讓 SnapMirror 作用中同步逾時、並允許首選站台上的儲存設備在 30 秒的時間過期之前恢復服務。這 30 秒的時間範圍可以增加。</block>
  <block id="dbdaf8435bc0aa414eca4876e6c308d2" category="paragraph">此值可讓偏好的站台上的儲存系統在錯誤計數逾時過期之前恢復作業。然後、只會將 LUN 路徑移除站台上的節點移除。範例如下：</block>
  <block id="e231fb490ed068ec9b23beb7dd95220e" category="paragraph">Oracle Support 強烈建議您不要變更錯誤數或磁碟逾時參數、以解決組態問題。不過、在許多情況下、變更這些參數可能是必要且不可避免的、包括 SAN 開機、虛擬化及儲存複寫組態。例如、如果 SAN 或 IP 網路發生穩定性問題、導致 RAC 遷離、您應該修正基礎問題、而不要收取錯誤數或磁碟逾時的值。為了解決組態錯誤而變更逾時是掩蓋問題、而非解決問題。根據基礎架構的設計層面、變更這些參數以正確設定 RAC 環境、是不同的、且與 Oracle 支援聲明一致。使用 SAN 開機時、通常會調整到最大 200 的 miskcount 、以符合磁碟逾時。如需其他資訊、請參閱<block ref="ba774c2123df7855b7691ef15a557a8c" category="inline-link-macro-rx"></block>。</block>
  <block id="cb5f127f654db8aa1847f5e9e6c5118e" category="summary">Oracle 與 SnapMirror 主動式同步：服務還原</block>
  <block id="894265e54aece56ce813211a980cdfe2" category="paragraph">SnapMirror 可以自我修復。SnapMirror 主動式同步會自動偵測是否存在錯誤的複寫關係、並將其恢復至 RPO = 0 狀態。重新建立同步複寫後、路徑將再次上線。</block>
  <block id="c512ae64a9e9927a6314fdd926760a72" category="paragraph">在許多情況下、叢集式應用程式會自動偵測失敗路徑的傳回、這些應用程式也會重新上線。在其他情況下、可能需要主機層級的 SAN 掃描、或是需要手動將應用程式恢復上線。</block>
  <block id="c83e8f0dcd2a1773693ac06c752f2ddd" category="paragraph">這取決於應用程式及其設定方式、一般而言、這類工作可以輕鬆自動化。SnapMirror 主動式同步本身是自行修正的、在電源和連線恢復後、不應需要任何使用者介入、即可恢復 RPO = 0 儲存作業。</block>
  <block id="b55bb91b49684d644a2314af260f5584" category="doc">Oracle 搭配 SnapMirror 主動式同步範例架構</block>
  <block id="8ba2bb4ebd97f28e7d98a180d8b06c1a" category="paragraph">本節所示的詳細故障範例是根據下列架構而定。</block>
  <block id="5d10516d162cd9f09cf5dc249d499836" category="admonition">這只是 SnapMirror Active Sync 上 Oracle 資料庫的眾多選項之一。選擇此設計是因為它說明了一些較複雜的案例。</block>
  <block id="ce2a1d07c1660eb99608e2aeb9ffda20" category="inline-link-macro">偏好的網站</block>
  <block id="93d235b3b3adb1fcc631cc9720911156" category="paragraph">在此設計中，假設站台 A 是在設定的<block ref="0a07e9e6141ed78f0b7013768c76c4a9" category="inline-link-macro-rx"></block>。</block>
  <block id="3f35d87b783da3d0c6ab04c2222e88cc" category="inline-image-macro">SM 上的 Oracle 設計範例</block>
  <block id="65d5312cbb5d7497db9571af7d19e76d" category="paragraph"><block ref="65d5312cbb5d7497db9571af7d19e76d" category="inline-image-macro-rx" type="image"></block></block>
  <block id="af82c537bd0f6778b9916dc78da8c55a" category="paragraph">儲存系統或站台故障的結果與遺失複寫連結的結果幾乎相同。當仍在運作的站台寫入時、 IO 應該會暫停約 15 秒。一旦超過 15 秒、 IO 就會像往常一樣繼續在該站台上進行。</block>
  <block id="24f2945a7c742e126cdf5dcdfb08ec89" category="paragraph">如果只有儲存系統受到影響、故障站台上的 Oracle RAC 節點將會遺失儲存服務、並在遷離和後續重新開機之前、輸入相同的 200 秒磁碟逾時倒數。</block>
  <block id="0cff2ae5f5c305f11d8d8a333bd1da2c" category="paragraph">RAC 節點上遺失儲存服務的 SAN 路徑狀態如下：</block>
  <block id="e33921fb5e166f433573176882c09294" category="paragraph">Linux 主機偵測到路徑遺失速度快於 200 秒、但從資料庫的角度來看、故障站台上的用戶端連線仍會在預設 Oracle RAC 設定下凍結 200 秒。完整資料庫作業只會在遷離完成後恢復。</block>
  <block id="db34db4ac9bd7910a9eded83e1ff30f9" category="paragraph">同時、另一個站台上的 Oracle RAC 節點會記錄其他 RAC 節點的遺失。否則、它會繼續如常運作。</block>
  <block id="ad08bdae586fc05e13eff6bd6d9f0ee2" category="paragraph">如果 SnapMirror 主動式同步複寫連結、則無法完成寫入 IO 、因為叢集無法將變更複寫到另一個站台。</block>
  <block id="564a95e2696af68aa1c3a4953ecd1ce9" category="section-title">站台A</block>
  <block id="18fe52a46fad1fa4c9873ea81b6e885f" category="paragraph">複寫連結失敗的站台 A 在寫入 IO 處理中會暫停約 15 秒、因為 ONTAP 會在判斷複寫連結確實無法運作之前、嘗試複寫寫入內容。經過 15 秒後、站台 A 上的 ONTAP 叢集會恢復讀寫 IO 處理。SAN 路徑不會變更、 LUN 也會保持連線。</block>
  <block id="657e60cc43634129c8f9314afdd5c48b" category="paragraph">複寫連結的時間是 15 ： 19 ： 44 。Oracle RAC 的第一個警告會在 200 秒逾時（由 Oracle RAC 參數 disktimeout 控制）接近 100 秒後到達。</block>
  <block id="f29d4b902de1f9de93b8673047367cb3" category="paragraph">達到 200 秒投票磁碟逾時後、此 Oracle RAC 節點將自行從叢集移除並重新開機。</block>
  <block id="b864ca7c3ca6173547e4a66ba059c688" category="summary">Oracle 、 SM-as 、主動同步、中介</block>
  <block id="01682ebdcacbc827e3ef8083e7b4c060" category="summary">Oracle 和 SM － as 非統一存取</block>
  <block id="f6dbb06140585fe45ddeaf49cae9418e" category="summary">Oracle 和 SnapMirror 主動同步</block>
  <block id="d6e7dde9799f39cece01cbc4b2728cdf" category="paragraph">SnapMirror 主動式同步可讓您建置超高可用度的 Oracle 資料庫環境、其中 LUN 可從兩個不同的儲存叢集取得。</block>
  <block id="13645bda5e7e84c7e547caee4c6325b2" category="paragraph">使用 SnapMirror 主動式同步時、資料不會有「主要」和「次要」複本。每個叢集都可以從其本機資料複本提供讀取 IO 、而且每個叢集都會將寫入複寫到其合作夥伴。結果是對稱 IO 行為。</block>
  <block id="36b94662a6696bbaee0152aefe40ed13" category="paragraph">除了其他選項之外、這可讓您將 Oracle RAC 當作延伸叢集來執行、並在兩個站台上執行作業執行個體。或者、您也可以建置 RPO = 0 主動被動式資料庫叢集、在站台中斷期間、可在站台之間移動單一執行個體資料庫、而此程序可透過 Pacemaker 或 VMware HA 等產品來自動化。所有這些選項的基礎都是由 SnapMirror 主動式同步管理的同步複寫。</block>
  <block id="d1a363496283d60774ff9c9c51ffe653" category="paragraph">在正常作業中、 SnapMirror 主動式同步可隨時提供 RPO = 0 同步複本、但有一個例外。如果資料無法複寫、 ONTAP 將釋出複寫資料的需求、並在另一個站台上的 LUN 離線時、繼續在一個站台上提供 IO 服務。</block>
  <block id="72f31f711b37dc7ce7b34e00dd56b5ae" category="paragraph">ONTAP Mediator 是從 NetApp 支援下載的軟體應用程式、通常部署在小型虛擬機器上。ONTAP Mediator 與 SnapMirror 主動式同步搭配使用時、並不是一種斷路器。它是參與 SnapMirror 主動同步複寫之兩個叢集的替代通訊通道。自動化作業由 ONTAP 根據合作夥伴透過直接連線和協調員所收到的回應來驅動。</block>
  <block id="b06e5b68abe4f23a716133f1fa1a4472" category="summary">Oracle 和 SM 為慣用站台</block>
  <block id="6d14548094c3b2a5b0a69049f8497fa8" category="doc">Oracle 和 SM-as 統一存取</block>
  <block id="36ba939f32969ddc6751427944e3569d" category="paragraph">最重要的需求是將資料檔案隔離到一個或多個專用磁碟區。它們必須不受任何其他檔案類型的污染。原因在於確保資料檔案複寫完全不受其他資料類型複寫的影響、例如歸檔記錄。如需檔案配置的其他資訊、以及確保儲存配置適合快照的重要詳細資料<block ref="c87a7212960b8cc2aca49adb1795e291" category="inline-link-macro-rx"></block>、請參閱。</block>
  <block id="64c93f87be857cf43f66e341a377693a" category="paragraph">作業系統可以偵測並<block ref="1da707b60c3b55bd01cb7df7c171a368" prefix=" " category="inline-code"></block>位於同一個磁碟區（即相同的來源檔案系統）上的事實<block ref="9ad16912cc0ba54a259b1a15d233c264" prefix=" " category="inline-code"></block>。作業系統接著會使用相同的裝置控制代碼來存取資料。這樣做可以改善 OS 快取和某些其他作業的使用、但會干擾 DNFS 。如果 DNFS 必須存取上的<block ref="1da707b60c3b55bd01cb7df7c171a368" prefix=" " category="inline-code"></block>檔案<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block>，可能會錯誤地嘗試使用錯誤的資料路徑。結果是 I/O 作業失敗。在這些組態中、將裝載選項新增<block ref="4740c034d97ca90a96b8050082816605" prefix=" " category="inline-code"></block>至任何與該主機上其他 NFS 檔案系統共用來源 Volume 的 NFS 檔案系統。這樣做會強制 Linux 作業系統為該檔案系統分配獨立的裝置控制代碼。</block>
  <block id="30d0582d4c5a0b280454304dcff9c28f" category="paragraph">Solaris 11 變更了 IT 處理大型 I/O 作業的方式、可能會在 SAN 儲存陣列上造成嚴重的效能問題。此問題記錄在 NetApp 追蹤錯誤報告 630173 「 Solaris 11 ZFS 效能回歸」中。</block>
  <block id="c041cd46ed4caba0947ab494ac5bb1d9" category="paragraph">這不是 ONTAP 錯誤。這是在 Solaris 瑕疵 7199305 和 7082975 下追蹤的 Solaris 瑕疵。</block>
  <block id="a83650b3549679a1591275f0f9cd38e0" category="paragraph">您可以諮詢 Oracle 支援部門、瞭解您的 Solaris 11 版本是否受到影響、或者您也可以變更為較小的值來測試因應措施<block ref="954f82599f7db0212a28fd448e03bdf3" prefix=" " category="inline-code"></block>。</block>
  <block id="65711e429e82120028dff2df28b4b92d" category="paragraph">您可以以 root 執行下列命令來達成此目的：</block>
  <block id="f0eff8c4d89b44c0cf8b8c323abeaa20" category="paragraph">如果您需要離線程序、請延遲重新探索或重新啟動服務、直到命令指出所有移轉均成功完成為止<block ref="1ab15ef2c245a4434fcea3cc3149f4f4" prefix=" " category="inline-code"></block>。然後您可以按照中所述完成移轉程序<block ref="bfe85b0236d22bff0d0d13e4e3fecb98" category="inline-link-macro-rx"></block>。</block>
  <block id="dbd3f1a817d137c052ec01ef60940131" category="inline-link">不對外的LUN匯入文件ONTAP</block>
  <block id="1e63fd2b99b2fef1f5d2ae61ebd5b4a3" category="paragraph">NetApp 中介紹了使用 FLI 遷移 SAN 資源的過程<block ref="3a5bd22edab525577a3f095f01c2551b" category="inline-link-rx"></block>。</block>
  <block id="4fc57ef291a6bc6be0f3f8c81e4f9b44" category="paragraph">以下流程圖顯示最佳移轉路徑的考量類型。您可以在影像上按一下滑鼠右鍵、然後在新的索引標籤中開啟影像、以改善可讀性。</block>
  <block id="17ed98f652bb960b10b3357e44785f38" category="inline-image-macro">移轉流程圖</block>
  <block id="f420007a3c90420b30780388a0e05dbc" category="paragraph"><block ref="6ee66f70cd2b82e9dd03128a50a38de9" category="inline-image-macro-rx" type="image"></block>。</block>
  <block id="fb3e908ec44ab0657a364e90a649adee" category="admonition">如需可產生異常結果的 Linux 特定 DNFS 問題、請參閱中的<block ref="6ada863f3548cecdf5d7a06e9c4201cd" category="inline-link-macro-rx"></block>說明<block ref="4740c034d97ca90a96b8050082816605" prefix=" " category="inline-code"></block>。</block>
  <block id="7dde30333f2f14b8935a6f394318dd19" category="paragraph">&lt;stdin&gt; 中未解析的指令 - 包括： lun-aligns.adoc []</block>
  <block id="baeaebf1ec4083a8b5a2278617a67479" category="paragraph">另請參閱一節中有關壓縮區塊對齊<block ref="936e7f76dd05eeca0e082776361dee38" category="inline-link-macro-rx"></block>的討論。任何與 8KB 壓縮區塊邊界對齊的配置、也會與 4KB 邊界對齊。</block>
  <block id="62cc2062c0bb14fd9ee41267e11b9824" category="paragraph">&lt;stdin&gt; 中未解析的指令 - 包括： database-misarge-warnations.adoc []</block>
  <block id="0452707f6213531bbf4f41e5f16cdead" category="paragraph">可透過多種機制將複製卸載至執行 ONTAP 的系統、通常是在 VM 、 vVol 或資料存放區層級。其中包括：</block>
  <block id="a4ec3dfc79c8493b1e9fcaee6b06b5a8" category="summary">ONTAP 廣泛支援混合雲。</block>
  <block id="14f3c0fa1399e57b5998b528cc5f3515" category="paragraph">ONTAP 是一種企業級橫向擴充 NAS 陣列、其中包括許多其他功能。ONTAP 讓 VMware vSphere 能夠從許多 ESXi 主機同時存取 NFS 連線的資料存放區、遠超出對 VMFS 檔案系統的限制。如一節所述、將 NFS 與 vSphere 搭配使用可提供一些易用性和儲存效率可見度優勢<block ref="72b655a9973dbed02099f5e63762d591" category="inline-link-macro-rx"></block>。</block>
  <block id="ef7f5a0b4e0866202a92874cc85a2fd2" category="list-text">需要更謹慎移轉的虛擬機器包括使用附加儲存設備的資料庫和應用程式。一般而言、請考慮使用應用程式的工具來管理移轉。對於Oracle、請考慮使用Oracle工具（例如RMAN或ASM）來移轉資料庫檔案。如需詳細資訊、請參閱<block ref="74eec9db95a0d18126c677c2dcc1d6f1" category="inline-link-rx"></block> 。同樣地、對於SQL Server、請考慮使用SQL Server Management Studio或NetApp工具、例如SnapManager 適用於SQL Server或SnapCenter VMware。</block>
  <block id="8c796e9ce33123891311630e9843b227" category="paragraph">在執行 ONTAP 的系統上使用 vSphere 時、設定網路設定非常簡單、類似於其他網路組態。以下是幾點需要考量的事項：</block>
  <block id="66149c951df015fb5f7aa252fa92bf64" category="paragraph">在執行 ONTAP 的系統上使用 vSphere 時、設定網路設定非常簡單、類似於其他網路組態。</block>
  <block id="bfcd75cb17a665212ae0889e787a7330" category="paragraph">執行 ONTAP 的系統可以使用儲存 QoS 功能、以 Mbps 和 / 或 I/O 每秒（ IOPS ）來限制不同儲存物件（例如檔案、 LUN 、磁碟區或整個 SVM ）的處理量。</block>
  <block id="5c60617d5730a7a614bfa0383a2affbd" category="admonition">這不適用於 VVols 。</block>
  <block id="b78488659ce8aad3288a0ad7f27c84fb" category="admonition">VVols 需要 VMware vSphere 的使用 ONTAP 工具、此工具可作為 ONTAP 的 VASA 提供者。請參閱<block ref="2486a36e844a24e9d1cf22351b1f1514" category="inline-link-macro-rx"></block>以瞭解 vVols 最佳實務做法。</block>
  <block id="58da89a03db394d8f73b6516f5a75882" category="paragraph">ONTAP QoS 和 VMware vSphere 儲存 I/O 控制（ SEC ）是輔助技術、 vSphere 和儲存管理員可以一起使用這些技術來管理 ONTAP 系統上所託管的 vSphere VM 效能。每個工具都有自己的優點、如下表所示。由於VMware vCenter和ONTAP VMware vCenter的範圍不同、有些物件可由一個系統來查看和管理、而非由另一個系統來管理。</block>
  <block id="bf0dee50832ba16a28008161612fd476" category="paragraph">ONTAP 透過簡化的軟體定義方法、統一化儲存設備、實現安全高效的管理、更高的效能、以及無縫的擴充性。這種方法可加強資料保護、並有效運用雲端資源。</block>
  <block id="a6848cf51eef6140971685faf5c7a111" category="paragraph">在vSphere環境中、這種方法也可能代表虛擬桌面基礎架構（VDI）的統一化系統、以及虛擬伺服器基礎架構（VSI）。執行 ONTAP 的系統在 VSI 方面通常比傳統企業陣列便宜、但具備先進的儲存效率功能、可在同一個系統中處理 VDI 。此外、從SSD到SATA、還能統一化各種儲存媒體、並將這些媒體輕鬆延伸到雲端。ONTAP無需購買單一 Flash 陣列即可獲得效能、 SATA 陣列可用於歸檔、而獨立的系統則可用於雲端。將它們緊密連結在一起。ONTAP</block>
  <block id="3a5159fa23e450460f03e5a885a6c51c" category="paragraph">*[ 附註 ]</block>
  <block id="d235766de3bd77aa4983181862c135d7" category="admonition">在此案例中、 MetroCluster 行為並無任何變更、所有資料存放區仍會保持不變、不受其個別站台影響。</block>
  <block id="14d627875de76f84985b8a3b27c96633" category="list-text">在此期間、虛擬機器 I/O 作業不會受到影響、但效能會降低、因為資料是透過 ISL 連結從遠端磁碟機櫃存取。</block>
  <block id="290cbdcb6abb203d45786213f3c43662" category="admonition">在此期間、虛擬機器仍在執行中、在此案例中 MetroCluster 行為並無變更。所有的資料存放區都會繼續保持不變、不受其個別站台影響。</block>
  <block id="9a18dc3c2c9a217a632ca45b5b93a004" category="admonition">在放置管理程式找到適當的儲存設備之前、 HA 主機不會開始重新啟動嘗試、因此在站台完全故障的情況下、執行切入後即會發生重新啟動嘗試。</block>
  <block id="e3f530e977d74053c6d70eb84886e756" category="sidebar">致勝</block>
  <block id="faeaec9eda6bc4c8cb6e1a9156a858be" category="sidebar">可用度</block>
  <block id="4289ad5c614f8037a8810e869b56facd" category="sidebar">整合</block>
  <block id="bc967dc2d57e6eff184a821bf7577a80" category="sidebar">擴充</block>
  <block id="86a69bd2f501f95ed83bb7014fac7e30" category="sidebar">快照與複製</block>
  <block id="58bc025e75c4b3fd1adf3ea672dd4424" category="sidebar">史詩般的架構與設計</block>
  <block id="92672a7a2b909945fbfa9f44f057c7a1" category="sidebar">規模調整</block>
  <block id="41b36522e1e1020bad35b072e2f4caeb" category="sidebar">儲存需求</block>
  <block id="ddb04c3c1835c48b34dced1c453450e9" category="sidebar">組態與最佳實務做法</block>
  <block id="3e23b54348b2b8424e24a426570dc9f2" category="sidebar">主機公用程式</block>
  <block id="6e19e43ad6dccde81e8d288a0c9ce380" category="sidebar">LUN 和磁碟區組態</block>
  <block id="a2ddb4431dcf2a898d386c1f3b82c926" category="sidebar">檔案服務</block>
  <block id="9985b4390c40137573e6da05caf85874" category="sidebar">通訊協定</block>
  <block id="894445e8ea6df545bfbc4247797a2162" category="sidebar">儲存規模調整</block>
  <block id="051c025eb3cc7303bf3116bffdb7e95d" category="sidebar">MetroCluster 架構</block>
  <block id="a1930436e8ea74adaf54ff76d868829b" category="sidebar">SQL Server 搭配 MetroCluster</block>
  <block id="33673f825b847c6610f7c7115da0bbde" category="sidebar">偏好的網站</block>
  <block id="57848b20be1bd330229089d2e136d982" category="sidebar">網路拓撲</block>
  <block id="3a1c15502275494d5a57fe7f225fa951" category="sidebar">SQL Server 搭配 SM</block>
  <block id="e30da740afd1eb5c7fc5ade391ee694d" category="sidebar">Oracle 組態</block>
  <block id="3d9396f3fc3010d09439c0c007a897aa" category="sidebar">Oracle 單一執行個體</block>
  <block id="87e1ed5a71c4eb8ff653400f9dd917a0" category="sidebar">Oracle RAC 和 tiebreaker</block>
  <block id="4a1483b5d5deb83e67e3184b05202d31" category="sidebar">範例架構</block>
  <block id="8b7786259860e64596ef2df3349d25e1" category="sidebar">RAC 互連故障</block>
  <block id="d65b736af70982866f4f95287faab7ac" category="sidebar">SnapMirror 通訊失敗</block>
  <block id="9b7da52d3b31b3d0a034473609a069e5" category="sidebar">網路互連總故障</block>
  <block id="1163a74136e40a05bc320e61f567a4df" category="sidebar">站台故障</block>
  <block id="29a8ec19326654cdf89bb8516725720a" category="sidebar">中介故障</block>
  <block id="38ea1deaf691187fc38ab915566310c5" category="sidebar">故障後的服務還原</block>
  <block id="9132b772b1437e64c8acac2be79a7a0f" category="sidebar">手動容錯移轉</block>
  <block id="05b66cacce7105ad4a548ef5054997f0" category="doc">特殊警示點設定</block>
  <block id="eccafd14420b568fff639755b251d1bd" category="paragraph">特殊警示是指每個叢集的組態、表示特定主機 WWN 或 iSCSI 啟動器 ID 屬於本機主機。這是設定 LUN 存取的第二個選用步驟。</block>
  <block id="d99ea4fad7d0a9010283969d9ddf89aa" category="paragraph">第一步是一般的 igroup 組態。每個 LUN 都必須對應至包含需要存取該 LUN 之主機的 WWN/iSCSI ID 的 igroup 。這會控制哪些主機擁有對 LUN 的 _access_ 。</block>
  <block id="bba32ce1a7b85dd9ba50c49b1a53fe4c" category="paragraph">第二個選用步驟是設定主機鄰近度。這無法控制存取、而是控制 _priority_ 。</block>
  <block id="98271aec6138a28e374c8f3724a535b6" category="paragraph">例如、站台 A 的主機可能設定為存取受 SnapMirror 主動式同步保護的 LUN 、而且由於 SAN 延伸至站台、因此該 LUN 可使用站台 A 上的儲存設備或站台 B 上的儲存設備來存取路徑</block>
  <block id="81959299f52ddb567fd902f3e1ae5311" category="paragraph">如果沒有特殊警示點設定、則該主機會同時使用兩個儲存系統、因為這兩個儲存系統都會通告主動 / 最佳化的路徑。如果站台之間的 SAN 延遲和 / 或頻寬受到限制、這可能無法進行設計、您可能希望確保在正常作業期間、每個主機都優先使用本機儲存系統的路徑。這是透過將主機 WWN/iSCSI ID 新增至本機叢集做為近端主機來設定的。這可以在 CLI 或 SystemManager 上完成。</block>
  <block id="f08670cf73640d447fb34d01b0f6418f" category="paragraph">在 AFF 系統中、設定主機鄰近時、路徑會如下所示。</block>
  <block id="85a2564342597a065a3926228b7e9fcd" category="paragraph">SQL Server 可設定為以多種方式搭配 SnapMirror 作用中同步處理。正確的答案取決於可用的網路連線能力、 RPO 需求和可用度需求。</block>
  <block id="d60999416cfb11e4fa51f3dbe7386d64" category="paragraph">SM-AS 和 MetroCluster 在整體功能上相似，但在實作 RPO =0 複寫的方式及其管理方式上有重要差異。SnapMirror 非同步和同步也可作為 DR 計畫的一部分使用，但它們並非設計為 HA 重新安裝技術。</block>
  <block id="e122442a5a5728cd45ffc4ddd170a36f" category="list-text">MetroCluster 組態更像是一個整合式叢集，節點分散在各個站台上。SM-AS 的運作方式類似於兩個原本是相互不同的叢集，這些叢集正在合作為選取的 RPO = 0 同步複寫 LUN 提供服務。</block>
  <block id="dbbbd9519f58f000ae618fd3a3f2f38c" category="list-text">MetroCluster 組態中的資料只能在任何指定時間從特定站台存取。另一個資料複本位於另一個站台，但資料是被動的。如果沒有儲存系統容錯移轉，就無法存取。</block>
  <block id="72d2ba33caf4a678d0b02c7a4a562662" category="list-text">MetroCluster 和 SM-AS 執行鏡像會在不同層級執行。MetroCluster 鏡射是在 RAID 層執行。低階資料會使用 SyncMirror 以鏡射格式儲存。在 LUN ，磁碟區和傳輸協定層，使用鏡像幾乎是不可見的。</block>
  <block id="33613d29368b0b312d33bd204505f12b" category="list-text">相反地， SM-AS 鏡射則發生在傳輸協定層。這兩個叢集都是整體上的不相關叢集。資料的兩個複本同步後，兩個叢集只需鏡射寫入。當某個叢集發生寫入時，它會複寫到另一個叢集。只有當兩個站台的寫入作業完成時，才會將寫入內容確認給主機。除了這種傳輸協定分割行為之外，這兩個叢集都是正常的 ONTAP 叢集。</block>
  <block id="c6ce2d48c3feb0ac105233b1d47d6785" category="list-text">MetroCluster 的主要角色是大規模複寫。您可以使用 RPO=0 和接近零的 RTO 來複寫整個陣列。這簡化了容錯移轉程序，因為只有一件事需要容錯移轉，而且在容量和 IOPS 方面的擴充能力極佳。</block>
  <block id="22c8f7d4250a7117dcec5e795cf01979" category="list-text">SMAS 的一個關鍵使用案例是精細複寫。有時候您不想將所有資料複寫為單一單元，或者您需要選擇性地容錯移轉特定工作負載。</block>
  <block id="466f5e6d5af96a45aba533d742d1f30e" category="list-text">另一個用於 SM-AS 的重要使用案例是用於雙主動式作業，您想要在兩個不同位置的兩個不同叢集上提供完全可用的資料複本，而且效能特性相同，如果需要，也不需要在各個站台之間擴充 SAN 。您可以讓應用程式同時在兩個站台上執行，以降低容錯移轉作業期間的整體 RTO 。</block>
  <block id="3ab2196c18fe1cd72bf252059597387b" category="section-title">NetApp MetroCluster 和 SnapMirror 作用中同步</block>
  <block id="95da439be4f858e05c58cde4b5946324" category="paragraph">對於許多客戶而言，災難恢復不僅需要擁有遠端資料複本，還需要能夠快速使用該資料。NetApp 提供兩種技術來滿足這種需求： MetroCluster 和 SnapMirror 主動同步</block>
  <block id="3e6b18011054436086bb6cf813b0cb23" category="section-title">SM 與 MCC 比較</block>
  <block id="4ab72a69aa303ab33d610a6f6e594e68" category="section-title">Checksum</block>
  <block id="0a4a3e3ef29b5fc4ea4e557f166532b4" category="paragraph">SnapMirror 主動式同步（ SM-AS ）是以 SnapMirror 同步為基礎。使用 MetroCluster 、每個 ONTAP 控制器都負責將其磁碟機資料複寫到遠端位置。有了 SnapMirror 主動式同步、您基本上擁有兩個不同的 ONTAP 系統、可維護 LUN 資料的獨立複本、但可以合作呈現該 LUN 的單一執行個體。從主機的角度來看、這是單一 LUN 實體。</block>
  <block id="2f589372957b08ce09879b8a2ab6e58c" category="section-title">啟用 DNFS</block>
  <block id="1a89d30b5bb0e2de334e029001a92f8a" category="paragraph">Oracle DNFS 可與 NFSv3 搭配使用，除了啟用 DNFS 程式庫之外，不需要任何組態（請參閱 Oracle 說明文件以取得所需的特定命令），但如果 DNFS 無法建立連線，則可無訊息還原至核心 NFS 用戶端。如果發生這種情況，效能可能會受到嚴重影響。</block>
  <block id="9cb0e5a02b9facf3c0e654f08ceceda4" category="paragraph">如果您想要在多個介面上使用 NFSSv4.X 的 DNFS 多工處理，或是使用加密，則必須設定一個 fstab 檔案。語法非常嚴格。檔案中的小錯誤可能會導致啟動掛起或略過 oranfstab 檔案。</block>
  <block id="3c04631b254b4b0e971a2c82517f50cb" category="paragraph">要確保某些 DNFS 正常運作，唯一的方法是查詢 v$dnfs 表格。</block>
  <block id="21986e459426718105f7dc1a16e88bd0" category="paragraph">以下是位於 /et. 的範例 oranfstab 檔案這是可放置 oranfstab 檔案的多個位置之一。</block>
  <block id="1d4338d2de6e933a6941c8605def3a39" category="paragraph">第一步是檢查 DNFS 是否可用於指定的檔案系統：</block>
  <block id="75bc8bd82bedf61e91351f8667b97e13" category="paragraph">此輸出表示 DNFS 正與這兩個檔案系統搭配使用，但 * 不 * 表示 oranfstab 可以運作。如果出現錯誤， DNFS 會自動探索主機的 NFS 檔案系統，您仍可能會看到此命令的相同輸出。</block>
  <block id="f4327e73856b2069e10b045605d3fbe9" category="paragraph">多重路徑檢查方式如下：</block>
  <block id="99dc2d8bc11eb27fb0b920ca969e43e1" category="paragraph">這些是 DNFS 正在使用的連線。每個 SVRNAME 項目都會顯示兩個路徑和通道。這表示多重路徑功能正常運作，這表示 oranfstab 檔案已被辨識及處理。</block>
  <block id="d99de907aa06fa04c7b19ffceff68307" category="admonition">以下各節是 ONTAP 9 版本 15.1 的最新版本，但租用和鎖定行為以及調校選項可能會從版本變更為版本。如果您需要調整 NFSv4 租用 / 鎖定逾時，請洽詢 NetApp 支援以取得最新資訊。</block>
  <block id="4bf95f1ea9ecf4f42a7b323970405bb4" category="paragraph">此寬限期可控制網路介面變更期間的租用回收，但第二個寬限期則可控制儲存容錯移轉期間的回收。<block ref="d75aeb1a8759ea7475fe0ddcd2058ca1" prefix=" " category="inline-code"></block>這是節點層級選項。</block>
  <block id="0ba7c8a7759adb519c715ac93fdee2a6" category="paragraph">例如，如果您經常需要執行 LIF 容錯移轉，而且需要縮短寬限期，您可以變更<block ref="b1280b7c6d986647dff33b87ce276327" prefix=" " category="inline-code"></block>。如果您想要在控制器容錯移轉期間改善 IO 恢復時間，您需要變更<block ref="d75aeb1a8759ea7475fe0ddcd2058ca1" prefix=" " category="inline-code"></block>。</block>
  <block id="3f3edac1c3ed7bfad53f9d42b9a0c5a7" category="paragraph">只有在完全瞭解風險和後果之後，才應謹慎變更這些價值。無法完全避免使用 NFSv4.X 執行容錯移轉和移轉作業所涉及的 IO 暫停。鎖定，租賃和寬限期是 NFS RFC 的一部分。對於許多客戶而言， NFSv3 較為理想，因為容錯移轉時間較快。</block>
  <block id="167503c08e9285f5c4a4a61a0123897b" category="paragraph">寬限期與租用期間已連線。如上所述、預設的租用逾時為 30 秒、這表示 NFSv4 用戶端必須至少每 30 秒與伺服器簽入一次、否則就會遺失租約、進而導致鎖定。存在寬限期、可讓 NFS 伺服器重建租用 / 鎖定資料、預設為 45 秒。寬限期必須比租用期間長。如此可確保設計為至少每 30 秒續約的 NFS 用戶端環境、在重新啟動後能夠與伺服器簽入。45 秒的寬限期可確保所有預期至少每 30 秒續約一次的客戶都有機會續約。</block>
  <block id="6be050126f2df5ae7cd944ce446241c2" category="paragraph">如果無法接受 30 秒的逾時、您可以選擇延長租用期。</block>
  <block id="38d530634a8d32e8775a37109fc08542" category="paragraph">如果您想要將租用逾時延長至 60 秒，以因應 60 秒的網路中斷，您也必須增加寬限期。這表示您將會在控制器容錯移轉期間經歷更長的 IO 暫停時間。</block>
  <block id="ac76821692fdb2dae1d98babe804fb8f" category="paragraph">這通常不是問題。一般使用者每年只會更新 ONTAP 控制器一或兩次、而且由於硬體故障而造成的非計畫性容錯移轉極少。此外、如果您的網路發生 60 秒網路中斷的可能性、而您需要將租用逾時時間延長至 60 秒、那麼您可能不會反對罕見的儲存系統容錯移轉、導致暫停時間也達 61 秒。您已確認網路暫停超過 60 秒、而且速度較快。</block>
  <block id="3a80e1e29c96d0837b12aef65785a41a" category="doc">組態參數</block>
  <block id="4bb9f72180425717a416a5037a100cca" category="searchtitle">MySQL 和 InnoDB 檔案結構</block>
  <block id="9a41c04f55c43c1bfac6d1e3fb0992de" category="doc">NFSv3 插槽表</block>
  <block id="dce12836eeccf070f53590dc5d86633d" category="doc">區塊大小</block>
  <block id="b4aa7c0127688b4c623685cfeed4ab97" category="searchtitle">Oracle Real Application 叢集逾時</block>
  <block id="6fae8d228f324e0e0a9c817b746b9bd0" category="doc">RAC 逾時</block>
  <block id="b64e3a0dc81f710f886a442e1a397bb9" category="doc">資料庫管理與自動化工具</block>
  <block id="87921e5ee2cf87589874871f0d361694" category="doc">資料庫可用度</block>
  <block id="accd3900cbd3e4d55a38c8518052015c" category="doc">Checksum 與資料完整性</block>
  <block id="5611150a7a2a706d09d267b466f083d6" category="paragraph">使用真正的儲存陣列、資料完整性可在多個層級上使用校驗和加以保護。如果 IP 型網路中的資料毀損、傳輸控制傳輸協定（ TCP ）層會拒絕封包資料並要求重新傳輸。FC 傳輸協定包括校驗和、封裝的 SCSI 資料也一樣。在陣列上之後、 ONTAP 就有 RAID 和 Checksum 保護。可能會發生毀損、但如同大多數企業陣列一樣、系統會偵測並修正毀損。一般而言、整個磁碟機都會故障、導致 RAID 重建、資料庫完整性也不會受到影響。磁碟機上的個別位元組仍可能受到宇宙輻射或故障的 Flash 儲存格損壞。如果發生這種情況，同位檢查將會失敗，磁碟機將會故障，並開始 RAID 重建。資料完整性再次不受影響。最後一道防線是使用校驗和。例如，如果磁碟機毀損資料發生災難性的韌體錯誤，而 RAID 同位檢查無法偵測到該錯誤，則 Checksum 將不相符， ONTAP 會在 Oracle 資料庫收到毀損的區塊之前，阻止該區塊的傳輸。</block>
  <block id="cd985f59320d95026288fa5ff6dcf58a" category="doc">線上備份</block>
  <block id="9c030078e0f444e80ad1c24e215220a4" category="doc">使用 ONTAP 保護資料</block>
  <block id="6bb9a5aec98309d1414b32f7e0751415" category="doc">資料保護規劃</block>
  <block id="06db8225d3ec2b43755ddc9358302450" category="doc">RTO ， RPO 和 SLA 規劃</block>
  <block id="5d827e5d4c92779310224878dc408813" category="summary">Oracle 資料庫 DR 搭配 MetroCluster</block>
  <block id="f0b223afb696335287bc2ed9501b5b33" category="doc">使用 MetroCluster 進行災難恢復</block>
  <block id="67be2475945283126e261087dcc833b7" category="doc">MetroCluster 和 NVFAIL</block>
  <block id="13262509535baae73d0cc7ab06de1fc6" category="searchtitle">MetroCluster 上的 Oracle Extended RAC</block>
  <block id="7993038617c805a663d50702c4494b68" category="doc">Oracle Extended RAC</block>
  <block id="75b233b87417347976ef489e09961c77" category="doc">Oracle 單一執行個體</block>
  <block id="aa51324dbf5137dc80d29f127e7265f1" category="doc">Oracle 單一執行個體</block>
  <block id="254742fbeffe659f98f802792b541c45" category="doc">RAC tiebreaker</block>
  <block id="aeee9c92b22d6f18b8670c9f330ea7c9" category="doc">網路互連性總故障</block>
  <block id="0ef819e6ae8a74f9c8ac0158a24b1627" category="doc">服務還原</block>
  <block id="8367f9ef79397d7d8f1367cb4392c602" category="summary">Oracle 和 SnapMirror 主動同步 - 站台故障</block>
  <block id="5c8784e46ac32f6b1c9b78f954c1a473" category="summary">SnapMirror 主動式同步 - SnapMirror 通訊失敗</block>
  <block id="7ed82538ab967cd6e2949aa971158dc9" category="searchtitle">Oracle ， SnapMirror 主動同步和 ONTAP 調解器</block>
  <block id="db2170f38b52c13c31e0572c709b6f8a" category="searchtitle">Oracle 與 SnapMirror 主動式同步總覽</block>
  <block id="e9a673980d8df30ed4173e4b7c4ecd2c" category="searchtitle">Oracle 和 SnapMirror 主動同步慣用站台</block>
  <block id="45d97b0c2ca342ad882153a1245f9897" category="doc">SnapMirror 主動式同步偏好的站台</block>
  <block id="0bb4536e921f4d96dd701c1afe746457" category="doc">ASMLib/AFD （ ASM 篩選器驅動程式）</block>
  <block id="3ee9e6a595247d1965be0d0c6cd0f22e" category="doc">資料檔案移轉</block>
  <block id="a9761df551af398a0fc2974288502d8a" category="doc">主機資料複製</block>
  <block id="d437e7d8b6513f91bbd58e0b1e08c90b" category="doc">移轉規劃</block>
  <block id="4c7e0d612a5f0e09f272083633991979" category="doc">TCP/IP 和乙太網路組態</block>
  <block id="9f2dc5f476d250d879dc58a583f93fd1" category="searchtitle">用於 Oracle 資料庫的 FC SAN 組態</block>
  <block id="08f606415b4ad7fb864651eac04fcd8e" category="searchtitle">Oracle 資料庫效能最佳化與基準測試</block>
  <block id="b30e3ef968d39d109aea4a92750c9792" category="doc">過時的 NFSv3 鎖定</block>
  <block id="1d19e21de0f93b11f5ceb8b535a3afc2" category="doc">容量管理</block>
  <block id="8d409dbefa8e76403d7adf4cbd315d3d" category="doc">ONTAP 容錯移轉 / 切換</block>
  <block id="0f03a4e25b68a1a67d3be8f0d989ef8b" category="doc">透過 ONTAP QoS 進行效能管理</block>
  <block id="555472a0fed2f80e0848845e538a08af" category="doc">Oracle Direct NFS （ DNFS ）</block>
  <block id="92d0288d9e0c6ed5ffd8dcd2e0900101" category="paragraph">寫入時， DNFS 多重路徑功能無法與 NFSv4.1 搭配最新版本的 Oracle 資料庫一起使用。將 NFSv4.1 指定為傳輸協定的 oranFstab 檔案只能使用單一路徑陳述式進行指定的匯出。原因是 ONTAP 不支援用戶端 ID 主幹。解決此限制的 Oracle 資料庫修補程式可能會在未來推出。</block>
  <block id="3fdf18c0210b51691df97c8be74021a3" category="doc">ASM 回收公用程式（ ASMRU ）</block>
  <block id="d63f66214ae30c5b9b10653f1e503492" category="doc">LUN 對齊</block>
  <block id="38baeef7dc11ad9438aa5b211745d9f6" category="searchtitle">Oracle 資料庫 LUN 調整大小和 LVM 調整大小</block>
  <block id="f447f8c9180e11bc4219ace93e7431fb" category="doc">LUN 調整大小和 LVM 調整大小</block>
  <block id="c8d869d733bd5299001f9d90b9f00d90" category="doc">LUN 規模調整和 LUN 數量</block>
  <block id="4ee97146242ed12473141d7ecad00ee1" category="doc">備份分層</block>
  <block id="e7cba09a05ca3e6ccdd30a1aa0a7d3af" category="doc">歸檔記錄分層</block>
  <block id="c1affdf2bd2e606557f2bf12c69af8f8" category="doc">部分檔案分層</block>
  <block id="3bf6f5a455b1889775d79713ad4e19ed" category="doc">擷取原則</block>
  <block id="636d94f9e0fb52c5d7560661b059b203" category="doc">快照分層</block>
  <block id="bf5f70c9080724ef27b09203705b1abc" category="doc">完整檔案分層</block>
  <block id="acf5662e9defb6f8df644e0d8b4caa28" category="doc">初始化參數</block>
  <block id="03095e209912bbf8e40f883c88befe49" category="searchtitle">PostgreSQL 原生資料保護</block>
  <block id="300e5ea4a0c7d02b8a4efeba5a1f6faf" category="doc">原生 Ddta 保護</block>
  <block id="1c3ee6977dcad0709502549dd7b111f3" category="sidebar">Oracle DR 搭配 MetroCluster</block>
  <block id="662637dadb14be675de52ed993629bcd" category="paragraph">針對伺服器作業系統佇列深度考量、資料庫至少要使用八個 LUN （每個磁碟區一個 LUN ）。根據 ONTAP 叢集中的節點數量來增加 LUN 數量。例如，使用 4 節點（ 2 HA 配對）叢集時，請新增 4 個 LUN 。對於較大型的環境，可能需要更多 LUN ；使用相同數量的磁碟區（總共八個，分散於儲存節點），並在叢集節點和磁碟區之間以兩個的倍數新增 LUN 。此方法可讓您輕鬆擴充 Epic 環境。</block>
  <block id="f73f987e4ea887ccfd1bf297bad46e22" category="paragraph">* 範例 1 ： 2 節點 ONTAP 叢集 *</block>
  <block id="f08ea6531fe21723a28ec9f89ea3e451" category="paragraph">2 個節點， 1 個 HA 配對 8 個磁碟區，每個節點 4 個磁碟區 8 個 LUN ，每個磁碟區 1 個 LUN ，新增 2 個 LUN ，一個位於 volume01 的 node1 ，一個位於 volume02 的 node02 。</block>
  <block id="fd52d4fb0b6e3cfb46cae3e012d26c20" category="paragraph">* 範例 2 ： 4 節點 ONTAP 叢集 *</block>
  <block id="489d5412107ca7c901de568b7c7dcce3" category="paragraph">4 個節點， 2 個 HA 配對 8 個磁碟區，每個節點 2 個磁碟區 8 個 LUN ，每個磁碟區 1 個 LUN 新增 4 個 LUN ，一個位於 vole01 的 node1 ，一個位於 vole02 的 node02 ，一個位於 volume03 的 node03 ，一個位於 volume04 的 node04 。</block>
  <block id="2feec0f4e37d9566d4cf292116430adb" category="paragraph">如果伺服器需要更多儲存設備、最簡單的選項就是擴充包含磁碟區的 LUN 。第二個選項是一次以兩個的倍數（每個節點一個磁碟區）將 LUN 新增至磁碟區群組。</block>
  <block id="c338b7a4eb0c6f0bb88b444f6c195b01" category="admonition">如果在需要 4 個以上節點或 8 個 LUN 的大型環境中，請諮詢 Epic 聯盟團隊以確認 LUN 設計。您可以在 EPIC @ NetApp .com 聯絡團隊。</block>
  <block id="e9afc81d3b8e2990f966bb247fa75a6b" category="list-text">在 8 個磁碟區中使用 8 個 LUN 來啟動，一次在叢集的所有節點上新增 2 個 LUN 。</block>
  <block id="eb75aeb3b4b2b9734ba3e52f5483f0b2" category="inline-link-macro">ONTAP 文件</block>
  <block id="c5432110ad66f4e2e624118b88a48126" category="list-text">以預期的 3 年成長規模建立 LUN 。（如需最大 LUN 大小，請參閱<block ref="2a57767dbf71d600f009b2fefab6360d" category="inline-link-macro-rx"></block>。）</block>
  <block id="4631d10aa7c8cd31e9dcf52425c327ee" category="paragraph">六種通訊協定用於將 VMware vSphere 連接至執行 ONTAP 的系統上的資料存放區：</block>
  <block id="4dc791031dce7528180b933655b6f73e" category="paragraph">FCP ， NVMe / FC ， NVMe / TCP 和 iSCSI 是區塊傳輸協定，使用 vSphere 虛擬機器檔案系統（ VMFS ）將 VM 儲存在 ONTAP FlexVol volume 中的 ONTAP LUN 或 NVMe 命名空間內。NFS是一種檔案傳輸協定、可將VM放入資料存放區（只是ONTAP 指不需要VMFS的功能）。SMB（CIFS）、iSCSI、NVMe / TCP或NFS也可直接從客體作業系統使用到ONTAP 不支援。</block>
  <block id="6b8f0029ce30f9b4d5fe0def33875511" category="cell">FC</block>
  <block id="81761811d0f769f1e8ab81834167af5c" category="cell">啟用資料保護（ VADP ）的 VMware vStorage API 備份軟體</block>
  <block id="50f09c99cf03d7efc83cfdc33047b54f" category="cell">是 ^1^</block>
  <block id="bb3e0b0b29c5930728585f775194c32b" category="cell">沒有 ^2^</block>
  <block id="b42c555e5ddbb6a4354369bbdd6b4513" category="cell">僅 v3 ^2^</block>
  <block id="cb928308729506b7eff5e7791a0ce0ba" category="list-text">老舊的客體作業系統（OS）需要與儲存系統一致、才能獲得最佳效能和儲存效率。然而、Microsoft和Linux經銷商（例如Red Hat）所支援的現代化作業系統不再需要調整、以使檔案系統分割區與虛擬環境中基礎儲存系統的區塊保持一致。如果您使用的是需要調整的舊作業系統，請在 NetApp 支援知識庫中搜尋使用「 VM 調整」的文章，或是向 NetApp 銷售或合作夥伴聯絡人索取一份 TR-3747 複本。</block>
  <block id="2d95becf2e726f81e5f2c0c9447ec2ad" category="paragraph">一般而言， * NetApp 建議 * 在 vCenter 內使用 ONTAP 工具 for VMware vSphere 介面來配置傳統和 vVols 資料存放區，以確保遵循最佳實務做法。</block>
  <block id="3405fd91ec611e14ca0464a159e87d21" category="list-text">當 ESXi 和 ONTAP 儲存陣列連線至乙太網路儲存網路時， * NetApp 建議 * 將這些系統連線的乙太網路連接埠設定為快速擴充樹協定（ RSTP ）邊緣連接埠，或使用 Cisco PortFast 功能。* NetApp 建議 * 在使用 Cisco PortFast 功能且啟用 802.1Q VLAN 主幹的環境中，啟用擴充樹 PortFast 主幹功能至 ESXi 伺服器或 ONTAP 儲存陣列。</block>
  <block id="96d48caf96811ccfa373aaf5fbe6f862" category="list-text">* NetApp 建議 * 下列連結集合的最佳實務做法：</block>
  <block id="d4b27e1b61577e2e3dfeebd3b8129da5" category="list-text">避免在主機之間共用磁碟區。例如、雖然可以在單一磁碟區中建立 2 個 LUN 、並將每個 LUN 共用至不同的主機、但這應該避免、因為這樣可能會使管理複雜化。在同一主機上執行多個 SQL Server 執行個體的情況下，除非您接近節點上的磁碟區限制，否則請避免共用磁碟區，而每個主機的每個執行個體都有個別的磁碟區，以便於進行資料管理。</block>
  <block id="e3ea9105e22caf8aa06aee0279a968bb" category="list-text">適當時、請設定 Volume 自動調整大小原則、以協助避免空間不足的情況。</block>
  <block id="72a9733bd5929d30a93ea680e0c3fad1" category="list-text">將資料庫次要檔案（作為檔案群組的一部分）放置在不同的磁碟區、可改善 SQL Server 資料庫的效能。只有當資料庫的檔案未與任何其他檔案共用其 LUN<block ref="937f38432beb92fdba3d47780720bdf7" prefix=" " category="inline-code"></block> 時、此分隔才有效<block ref="937f38432beb92fdba3d47780720bdf7" prefix=" " category="inline-code"></block>。</block>
  <block id="82d9655a27436534991360ea4c0dc680" category="paragraph">Tempdb 資料庫可能會過度使用。除了在 ONTAP 上最佳放置使用者資料庫檔案之外， tempdb 資料檔案放置位置也是減少分配爭用的關鍵。tempdb 應放置在不同的磁碟上，而非與使用者資料檔案共用。</block>
  <block id="5c4a7832da0e9f8799089fdc985bb9b3" category="list-text">應以相同大小建立 tempdb 資料檔</block>
  <block id="20453a1c8627ad0bc536be210636fa41" category="paragraph">下列範例指令碼會建立八個大小相同的 tempdb 檔案，並將 tempdb 移至 SQL Server 2012 及更新版本的裝載點，以修改 tempdb<block ref="ae6fbe62f3ddc46fa9a9885244d23675" prefix=" " category="inline-code"></block> 。</block>
  <block id="3f808654ebfed6aae875b71a402ac91b" category="inline-link-macro">ONTAP 9 注意事項。 16.1</block>
  <block id="afb530fcc81b2978f808bd5327a32c87" category="inline-link-macro">ONTAP 9.16.0 注意事項</block>
  <block id="d804afb237a517c556722013a1b8ec73" category="inline-link-macro">ONTAP 9.15.1 注意事項</block>
  <block id="5f016d328522d91c512269e0786e144d" category="inline-link-macro">ONTAP 9.15.0 注意事項</block>
  <block id="98ea16e049d26c017c083e3896766015" category="inline-link-macro">ONTAP 9.14.1 注意事項</block>
  <block id="2a0d0e639657d07a66d55606242f8863" category="inline-link-macro">ONTAP 9.14.0 注意事項</block>
  <block id="d13ca0508189923e4791d61e82518903" category="paragraph"><block ref="ee254fc53b05f67f41ce3314151253c2" category="inline-link-macro-rx"></block> <block ref="83cffbd8d99e434b2f5f3940f69ff8e4" category="inline-link-macro-rx"></block> <block ref="23ce2232a13ec581d8a1f356c5cc2645" category="inline-link-macro-rx"></block> <block ref="4d4f1ffb0dbcd5627ca696d020c34dce" category="inline-link-macro-rx"></block> <block ref="d16c9b11843460f788b4709fb5f6f9c0" category="inline-link-macro-rx"></block> <block ref="5032e7169b10b3f96d6c299a82923a0e" category="inline-link-macro-rx"></block> <block ref="f7a2b1db149ed9886af0ce846dbc3e14" category="inline-link-macro-rx"></block> <block ref="b349c509ad858348b30db7e73307e3aa" category="inline-link-macro-rx"></block> <block ref="0dce234dfded58bd461541473b86e42a" category="inline-link-macro-rx"></block> <block ref="9760ec4df13f0afbdfec88ae16c871ae" category="inline-link-macro-rx"></block> <block ref="b6dab2933dfb92cf0c1355707a4aec7c" category="inline-link-macro-rx"></block> <block ref="1b7c80b26162b03bd0addd587f70df55" category="inline-link-macro-rx"></block> <block ref="14faf912aa42102a6628af4551e02583" category="inline-link-macro-rx"></block> <block ref="a90f36d649d3be5d386cc3563ab044fb" category="inline-link-macro-rx"></block> <block ref="2cd65b4a044075cfd9ad4a91f42fdff4" category="inline-link-macro-rx"></block> <block ref="5e764cc3fdcc19ff667796e414159bdc" category="inline-link-macro-rx"></block> <block ref="561451f09c7bca700ea0d7833cd9e92e" category="inline-link-macro-rx"></block> <block ref="d23d341a344216fbf99a91152429d49c" category="inline-link-macro-rx"></block> <block ref="b35e8fbd7b0369b23734510994911ec4" category="inline-link-macro-rx"></block> <block ref="41d4305cf7a6acb595086f123121a781" category="inline-link-macro-rx"></block> <block ref="ea685649fabe77da53e843fec56f72b8" category="inline-link-macro-rx"></block></block>
  <block id="c9e7f99d53af8a795853cdf25af30b41" category="section-title">適用於 MetroCluster IP 組態的 ONTAP Mediator</block>
  <block id="f6cab8e78e70dc1f9720a3ef038776e0" category="inline-link-macro">9.9.1 MetroCluster IP 組態的 ONTAP Mediator 注意事項</block>
  <block id="ebe991cfd03b446bbf8687699ccbd660" category="inline-link-macro">9.8 適用於 MetroCluster IP 組態的 ONTAP Mediator 注意事項</block>
  <block id="2db41096b15f25232cba7341c2140448" category="inline-link-macro">9.7 適用於 MetroCluster IP 組態的 ONTAP Mediator 注意事項</block>
  <block id="f81cc577527b8b7cad4405edd62a83d4" category="paragraph"><block ref="3e82164cf34143fb60c8ff9df8c41c0a" category="inline-link-macro-rx"></block> <block ref="d53517b81c95b1c10115cf953ff553c1" category="inline-link-macro-rx"></block> <block ref="b1bde49b948d4004f51f0cd5e9a9e990" category="inline-link-macro-rx"></block></block>
  <block id="7d90174e2cb3f5e3051541506c8587b4" category="list-text">使用適用於 VMware vSphere 的 ONTAP 工具來配置資料存放區，因為它能自動簡化匯出原則的管理。</block>
  <block id="4ac7ffa40244bc8345591768f8411745" category="list-text">使用外掛安裝功能，將現有的資料存放區套用至新伺服器。</block>
  <block id="adf5380025d4004543deef73a471bbd5" category="inline-link-macro">使用 NetApp 和 VMware 的 NFSv3 nconnect 功能</block>
  <block id="f9f508df0fe89d92476e598965812f69" category="list-text">目前支援的所有 VMware vSphere 版本均可使用 NFS v3 和 v4.1 。正式支援 nconnect 已新增至 vSphere 8.0 更新 2 for NFS v3 ，以及更新 3 for NFS v4.1 。對於 NFS v4.1 、 vSphere 持續支援工作階段主幹、 Kerberos 驗證及完整性 Kerberos 驗證。請務必注意、工作階段主幹需要 ONTAP 9.14.1 或更新版本。您可以在<block ref="8bbf9cc2e5403eec56b8cc2f4bd74d68" category="inline-link-macro-rx"></block>中深入瞭解 nconnect 功能及其如何改善效能。</block>
  <block id="81439479f2f4c0fa8c28668334fa82bd" category="list-text">vSphere 8 中 nconnect 的最大值為 4 ，預設值為 1 。vSphere 中的最大值上限可透過進階設定，以每部主機為基礎提高，但通常不需要。</block>
  <block id="b279126f58fd7f43a55f5efc8596bcea" category="list-text">對於需要比單一 TCP 連線更高效能的環境，建議使用值 4 。</block>
  <block id="9d676095b7ff8ea1b1779bc58fb32a92" category="list-text">請注意， ESXi 的 NFS 連線數量上限為 256 個，每個 nconnect 連線數量都會計入該總數。例如，兩個 nconnect=4 的資料存放區將計為八個總連線。</block>
  <block id="efdc45c7bd15d84f5bcb4df0560d6d3a" category="list-text">在正式作業環境中實作大規模變更之前，請務必先測試 nconnect 對環境的效能影響。</block>
  <block id="d1801a2d87a0325c6c691a74f5d1ffef" category="list-text">值得注意的是、 NFSv3 和 NFSv4.1 使用不同的鎖定機制。NFSv3 使用用戶端端鎖定、而 NFSv4.1 則使用伺服器端鎖定。雖然 ONTAP 磁碟區可以透過兩種傳輸協定匯出、但 ESXi 只能透過一種傳輸協定掛載資料存放區。不過、這並不表示其他 ESXi 主機無法透過不同版本掛載相同的資料存放區。為了避免任何問題、請務必指定要在掛載時使用的通訊協定版本、確保所有主機都使用相同版本、因此使用相同的鎖定樣式。避免在主機之間混合使用 NFS 版本是非常重要的。如有可能、請使用主機設定檔來檢查法規遵循狀況。</block>
  <block id="c17658fd7af3bb19a0f047cb1e006186" category="list-text">NFS 匯出原則規則用於控制 vSphere 主機的存取。您可以將一個原則與多個磁碟區（資料存放區）搭配使用。使用 NFS 時， ESXi 會使用 sys （ UNIX ）安全樣式，並需要根掛載選項來執行 VM 。在現階段、此選項稱為超級使用者、使用超級使用者選項時、不需要指定匿名使用者ID。ONTAP請注意，匯出具有不同值的原則規則<block ref="ea72d12ecaa06afdb0c8a3b15e485e95" prefix=" " category="inline-code"></block>，<block ref="df809a941c1287d18c08bb5927b639dc" prefix=" " category="inline-code"></block>可能會導致 ONTAP 工具發生 SVM 探索問題。IP 位址應該是以逗號分隔的清單，不含安裝資料存放區的 vmkernel 連接埠位址空間。以下是原則規則範例：</block>
  <block id="a001b05a0a70d03d708c133c88072a2b" category="list-text">用戶端符合主機名稱， IP 位址，網路群組或網域的清單： 192.168.42.221192.168.42.22</block>
  <block id="0106a8755025c8789c58f6ca3db3cd93" category="list-text">RO 存取規則：任何</block>
  <block id="1c66db8bac919c3f29211badf0369156" category="list-text">RW 存取規則：任何</block>
  <block id="193fc1ecf90841d52215e705d60caa7b" category="list-text">匿名使用者對應的使用者 ID ： 65534</block>
  <block id="f913a13d0c2cb8f8dd45dc1479901025" category="list-text">超級使用者安全性類型：任何</block>
  <block id="e44d8f7f976db169814f15c0e3c91250" category="list-text">在 setattr 中使用 setuid Bits ： true</block>
  <block id="c154c7fcb68e62b069047ccff2521dc0" category="list-text">允許建立裝置：對</block>
  <block id="71168bd99a960bfb425e723f5750b3fc" category="list-text">如果使用 NetApp NFS 外掛程式 for VMware VAAI ，則應將傳輸協定設定為<block ref="2521ef5d58fc027d3121662b7d8f9ac2" prefix=" " category="inline-code"></block>建立或修改匯出原則規則的時間。需要 NFSv4 傳輸協定， VAAI 複本卸載才能運作，並將傳輸協定指定為<block ref="2521ef5d58fc027d3121662b7d8f9ac2" prefix=" " category="inline-code"></block>自動包含 NFSv3 和 NFSv4 版本。即使資料存放區類型是建立為 NFS v3 ，也需要這項功能。</block>
  <block id="dd68c690edda5e0630944465c5950d11" category="list-text">存取傳輸協定： NFS</block>
  <block id="4d6306be791d29381011bb901e0351d5" category="list-text">用戶端比對規格： 192.168.42.21192.168.42.22</block>
  <block id="62297138e048f9159339e4709b23cd2f" category="list-text">做為連接 iSCSI 的 LUN 或連接至 NVMe / TCP 的命名空間，可由軟體啟動器從 VM 來賓作業系統存取和控制</block>
  <block id="7eae63bf83e6298ab64a2dd5e2544df9" category="inline-link-macro">VMware 組態最大值工具</block>
  <block id="ee1c3928454779ec08bd2d50271b6621" category="admonition">如需 ESXi 支援的最新限制，請參閱<block ref="ca32979bcc653e1966d3624ee8d76604" category="inline-link-macro-rx"></block>。</block>
  <block id="387b349695476180bf90cc1891288318" category="list-text">檢查 <block ref="1f38ac07598dbb4b06912539aafa4211" category="inline-link-macro-rx"></block>NetApp 與 VMware 合作所建議的設定。</block>
  <block id="9c4a21e654649a6a5201381ce4ba6cbd" category="paragraph">下表提供 vSphere 支援的傳統資料存放區功能與 ONTAP 。此資訊不適用於vVols資料存放區、但通常適用於使用支援ONTAP 的版本資訊的vSphere 6.x及更新版本。您也可以參閱<block ref="ca32979bcc653e1966d3624ee8d76604" category="inline-link-macro-rx"></block>以取得特定 vSphere 版本，以確認特定限制。</block>
  <block id="27071f484b59aa9ce5f5cffcefefd481" category="paragraph">^2^ 使用 NVMe 的資料存放區和 NFS v4.1 需要 vSphere 複寫。SRM 目前不支援以陣列為基礎的 NFS v4.1 複寫。適用於 VMware vSphere 儲存複寫介面卡（）的 ONTAP 工具目前不支援 NVMe 型陣列複寫。</block>
  <block id="f992800e6b8aa5ca675e5d1c9fd9950c" category="summary">利用此功能、您可以建立可套用至多個工作的備份原則。SnapCenter這些原則可定義排程、保留、複寫及其他功能。它們持續允許選擇性地選擇 VM 一致的快照，以利用 Hypervisor 的能力來在執行 VMware 快照之前，先關閉 I/O 。</block>
  <block id="0a99e5aa10081a6cc2cd756764a791f5" category="inline-link-macro">Snapshot 限制</block>
  <block id="aa4e326f7359bc14116e671e7002dd80" category="paragraph">ONTAP 使用傳統的 iSCSI 和光纖通道傳輸協定（ FCP ）為 VMware vSphere 提供企業級的區塊儲存設備，並支援 NVMe / FC 和 NVMe / TCP ，提供高效率和高效能的次世代區塊傳輸協定 NVMe over Fabrics （ NVMe of ）。</block>
  <block id="69ed4612751aa53c36bfb06723b9ac3c" category="inline-link-macro">資料存放區和傳輸協定 - SAN</block>
  <block id="6ed827bb740ef6ae13ba33875f09bd4d" category="paragraph">如需使用 vSphere 和 ONTAP 實作 VM 儲存區塊傳輸協定的詳細最佳實務做法，請參閱<block ref="851570383af5746336da824a0a2590e1" category="inline-link-macro-rx"></block></block>
  <block id="080533926d0a5f93ded730459d8fe38e" category="paragraph">vSphere可讓客戶使用企業級NFS陣列、同時存取ESXi叢集中所有節點的資料存放區。如一節所述<block ref="72b655a9973dbed02099f5e63762d591" category="inline-link-macro-rx"></block>，在搭配 vSphere 使用 NFS 時，有一些易用性和儲存效率可見度的優點。</block>
  <block id="d9243800afbb4af685507413cda85fb3" category="inline-link-macro">資料存放區和傳輸協定 - NFS</block>
  <block id="5b17d236da497a1c9e5d89b42dfc8264" category="paragraph">如需建議的最佳實務做法，請參閱<block ref="75fda850433b3639ed71701079d043be" category="inline-link-macro-rx"></block></block>
  <block id="d240aead1fe438e9f66d54e3cebb7e47" category="paragraph">以下是所有目前支援版本 ONTAP 的建議主機設定。</block>
  <block id="11d0e9e8442c67c812829427e008eb11" category="inline-link-macro">VMFS5 虛擬機器的空間回收</block>
  <block id="fef769c2e7ba3ba16273c3c81c47ed9e" category="cell">保留預設值（ 0 ）、但可視需要變更。如需詳細資訊、請參閱 <block ref="9b26e5c0136d6a9ffe3ef541d9621427" category="inline-link-macro-rx"></block></block>
  <block id="c99694bb5336dd37a10341183ec8a950" category="inline-link-macro">VMware知識庫2069356</block>
  <block id="2f5a0569065e71943058f8fb26e3e8da" category="inline-link">變更延遲循環配置資源的預設參數</block>
  <block id="da151950bd7f77d4d82f31a151e48d86" category="paragraph">對於帶有 vSphere 7 的 FCP 和 iSCSI ，如需更多詳細資料<block ref="ad69e690a8561a2cf3328cde094252f4" category="inline-link-macro-rx"></block>，請參閱適用於帶有 vSphere 8 的 FCP 和 iSCSI ，如需更多詳細資料<block ref="0b6ab7c7c874850b69a7bdde572cc0ce" category="inline-link-macro-rx"></block>，請參閱適用於帶有 vSphere 7 的 NVMe 的詳細資料，如需更多詳細資料<block ref="72dcc917faa9346f108bcba624c6b54f" category="inline-link-macro-rx"></block>，請參閱<block ref="6388c35b35c0c848de96298937e342cf" category="inline-link-macro-rx"></block></block>
  <block id="b565c40b717c5d84ecaff52fbb94903d" category="paragraph">NetApp 於 2012 年首次宣布，在開發 VMware vSphere API for Storage Aware （ VASA ）方面與 VMware 合作，成為早期設計合作夥伴，這是以儲存原則為基礎的管理（ SPBM ）與企業儲存陣列的基礎。此方法為 VMFS 和 NFS 儲存帶來有限的 VM 精細儲存管理。</block>
  <block id="e01da3b454da14823394d0b9b3fac1d6" category="section-title">虛擬磁碟區（ vVols ）</block>
  <block id="b077cca6e6fd5e690157294fd7f87e08" category="paragraph">VVols 是一種革命性的儲存架構，可實現 VM 精細的儲存管理，讓儲存設備不僅能以每個 VM 為基礎進行管理（包括 VM 中繼資料），還能以每個 VMDK 為基礎進行管理。 VVols 是軟體定義資料中心（ SDDC ）策略的關鍵元件，可構成 VMware Cloud Foundation （ VCF ）的基礎，為虛擬化環境提供更有效率且可擴充的儲存架構。</block>
  <block id="7dba0dd24357e8a19109bbbf7f689fb2" category="paragraph">VVols 可讓 VM 以每個 VM 為基礎來使用儲存設備，因為每個 VM 儲存物件都是 NetApp ONTAP 中的唯一實體。ASA R2 系統不再需要磁碟區管理，這表示每個 VM 儲存物件都是陣列上唯一的儲存單元（ SU ），可以獨立控制。如此一來，就能建立可套用至個別 VM 或 VMDK 的儲存原則（以及獨立式 SUS ），以精細控制效能，可用度及資料保護等儲存服務。</block>
  <block id="f467f22eb6ec5b3e0694963b3f16ebc2" category="section-title">儲存原則型管理（ SPBM ）</block>
  <block id="05ba8cf72b56cd6a89d699c0a922d186" category="paragraph">SPBM提供一個架構、可在虛擬化環境可用的儲存服務與透過原則配置的儲存元素之間、做為抽象層。此方法可讓儲存架構設計師設計具有不同功能的儲存集區。VM 管理員可以輕鬆使用這些資源池。然後，系統管理員可以將虛擬機器工作負載需求與已配置的儲存資源池進行比對。這種方法簡化了儲存管理，並能更有效率地使用儲存資源。</block>
  <block id="4e1ae190f1f93f025754e7944927b697" category="paragraph">SPBM 是 vVols 的關鍵元件，提供以原則為基礎的架構來管理儲存服務。原則是由 vSphere 管理員使用廠商 VASA Provider （ VP ）公開的規則和功能來建立。可針對不同的儲存服務建立原則，例如效能，可用度和資料保護。可將原則指派給個別 VM 或 VMDK ，以精細控制儲存服務。</block>
  <block id="ac0bb89f2c9215fb6f1280fb1d88d213" category="section-title">NetApp ONTAP 和 VVols</block>
  <block id="1402ced4d3888a58c5af1059e38ea6b4" category="paragraph">NetApp ONTAP 在 vVols 擴充領域領導儲存產業，在單一叢集內支援數十萬個 vVols * 。相反地，企業陣列和較小的 Flash 陣列廠商每個陣列最多支援數千個 vVols 。ONTAP 為 VMware vSphere 環境提供可擴充且有效率的儲存解決方案，支援 vVols 的豐富儲存服務，包括重複資料刪除，壓縮，精簡配置和資料保護。SPBM 可與 VMware vSphere 環境無縫整合。</block>
  <block id="6070863553bff7655694da4be22f793e" category="paragraph">我們先前提到， VM 管理員可以將容量當成儲存池使用。這是透過使用 vSphere 中代表為邏輯資料存放區的儲存容器來完成的。</block>
  <block id="5db11f8fed5bd72f359ab9469069dffa" category="summary">ONTAP 工具 10 安裝檢查清單</block>
  <block id="a5d727df2ce2d168bae39c78df4b9054" category="doc">檢查清單</block>
  <block id="7aed7b3182cbdda9aceb9c8f8b3c2dbe" category="paragraph">使用此安裝檢查清單來確保成功部署（已更新 10.3 版及更新版本）。</block>
  <block id="06c2cea18679d64399783748fa367bdd" category="inline-image-macro">一</block>
  <block id="1e90f607d380c9ee51b487edec3975fa" category="list-title"><block ref="58f667aaf05f87159670e12bd9bc076b" category="inline-image-macro-rx" type="image"></block>初步規劃</block>
  <block id="5541521d8d465590f0919510f29154b2" category="inline-link">部署 VMware vSphere ONTAP 工具的組態限制</block>
  <block id="225d03736b7d93585b216af68e8caa12" category="list-text">判斷您環境所需的 ONTAP 工具組態大小和類型。如需詳細資訊，請參閱<block ref="de0a48be1b1ae6c0ec73a4762c1d7abf" category="inline-link-rx"></block>。</block>
  <block id="c56feb728c490e11ea8eba91afce9419" category="list-text">判斷您將使用適用於 VMware Site Recovery Manager （ SRM ）或即時網站恢復（ VLSR ）的 ONTAP 工具儲存複寫介面卡（ SRA ）。如果是，您將需要存取 SRM/VSRR 伺服器管理介面，才能安裝 SRA 。</block>
  <block id="15ee84770ceab89b9fe30ec618843c01" category="inline-link">在 ONTAP 中建立叢集對等關係</block>
  <block id="bfbb5bcd0f88a18adcc2741da1b9063a" category="inline-link">在 ONTAP 中建立叢集間 SVM 對等關係</block>
  <block id="d8a2601707345eab1d4df3e541d61f3c" category="list-text">如果您將使用由 ONTAP 工具管理的 SnapMirror 複寫（包括但不限於 SnapMirror 作用中同步），則您的 ONTAP 管理員必須<block ref="f4be9e71a34420e69a7db6d0cf97d232" category="inline-link-rx"></block><block ref="42356490ef97c026f7c04a9cb9eeee7d" category="inline-link-rx"></block>先使用 ONTAP 工具搭配 SnapMirror 。</block>
  <block id="801ab24683a4a8c433c6eb40c48bcd9d" category="inline-link">下載</block>
  <block id="18f5114f4a595ad26525bf20f301ce19" category="list-text"><block ref="20462cf0cb6f4e0f9c91cc66c831d98e" category="inline-link-rx"></block>工具 OVA ，如有需要，還可取得 ONTAP tar.gz 檔案。</block>
  <block id="aada29daee1d64ed0fe907043855cb7e" category="inline-image-macro">二</block>
  <block id="770c8023395525bc05b5a8fc2e6efa8b" category="list-title"><block ref="54f425ce8d89f4ed6b8a546561af5d60" category="inline-image-macro-rx" type="image"></block>配置 IP 位址和 DNS 記錄</block>
  <block id="08b0c7e27d2f1780fce59893f12e7642" category="list-text">ONTAP 工具應用程式位址：_________ 。_________ 。__________</block>
  <block id="6bb090d29a0e3de8cc001d02c1e8a7b3" category="list-text">內部服務地址： __________ 。_________ 。_________ 。__________</block>
  <block id="e32a9122e97bf17560b53c6993301629" category="list-text">節點一的 DNS 主機名稱 _________________________________________</block>
  <block id="1cb7943b8cf41289c8d5ae2c9f9ec310" category="list-text">節點一的 IP 位址： __________ 。_________ 。_________ 。__________</block>
  <block id="2b5f3d5d41f4d2986a55a91aa934205c" category="list-text">子網路遮罩 _________ 。_________ 。_________ 。__________</block>
  <block id="ed7c49acbcb0724e63d695ba272bcd1d" category="list-text">默認網關：_________ 。_________ 。__________</block>
  <block id="a637d19158a083f61d5e6d9df66998cb" category="list-text">DNS 伺服器 1 __________ 。_________ 。_________ 。__________</block>
  <block id="b7eed84956833fb9e8cbb126fb30803f" category="list-text">DNS 伺服器 2 ： _________ 。_________ 。_________ 。__________</block>
  <block id="7f7df9c7f87bea4d47136da35a80f4a9" category="list-text">DNS 搜尋網域 _________________________________________</block>
  <block id="59cd965988b8905f3416029cd3a1facf" category="list-text">節點 2 的 DNS 主機名稱（選用） _________________________________________</block>
  <block id="242e264b9e179f0ea25123089a967467" category="list-text">節點二的 IP 位址（選用） _________ 。_________ 。_________ 。__________</block>
  <block id="4115e1d934066b360d5cdd8013198fff" category="list-text">節點三的 DNS 主機名稱（選用） _________________________________________</block>
  <block id="8043aaa26cf3f85d9ab4df441ceb6ef3" category="list-text">節點三的 IP 位址（選用） _________ 。_________ 。_________ 。__________</block>
  <block id="305c44d3641b44153a7487e28382fffb" category="list-text">為上述所有 IP 位址建立 DNS 記錄。</block>
  <block id="ca8a2087e5557e317599344687a57391" category="inline-image-macro">三</block>
  <block id="543a0cfd4f6527c92c513911b3079c22" category="list-title"><block ref="05b2444faffd66d76e88602ea7dd353f" category="inline-image-macro-rx" type="image"></block>網路防火牆組態</block>
  <block id="76841410d8f9a6881e0b96f150e9cedf" category="inline-link">連接埠需求</block>
  <block id="1cb44e38b7d534b49fb7ce15d6726cb0" category="list-text">在網路防火牆中開啟上述 IP 位址所需的連接埠。如需最新更新，請參閱<block ref="d75d54fbd8f18143d683ed6f5389e615" category="inline-link-rx"></block>。</block>
  <block id="981b8fcee42e1e726a67a2b9a98ea6e9" category="inline-image-macro">四</block>
  <block id="640e990f06389e4b49f54086ba1aba46" category="inline-link">編輯應用裝置設定並啟用 VASA 服務</block>
  <block id="49b964c1f288e8e75650b3e86683914d" category="list-text">若要使用 vVols ，您必須先使用<block ref="c9f7d482e0b51df808dc044e3e43f591" category="inline-link-rx"></block>。同時，請檢閱下列兩個項目。</block>
  <block id="8ba46a1826b102cd1b8b0fb75a241176" category="inline-link">實現高可用度</block>
  <block id="acc64c77b8528b3513e0bab18372f0d3" category="list-text">如果您計畫在正式作業環境中使用 vVols ，<block ref="b5eaf1d61c4c1246e4e215774dc53776" category="inline-link-rx"></block>請使用上述兩個選用 IP 位址。</block>
  <block id="fddd8f455515e6a6de8e8d876641e0c5" category="inline-link">啟用 SRA 服務</block>
  <block id="777b715f4e7db3295048bd9409cb3a0f" category="list-text">如果您計畫使用工具儲存複寫介面卡（ ONTAP ）來執行 VMware Site Recovery Manager 或即時網站恢復，<block ref="9eb793199b56cb94f5df0c657a62ea9e" category="inline-link-rx"></block>。</block>
  <block id="e5d9de39f7ca1ba2637e5640af3ae8aa" category="inline-image-macro">五</block>
  <block id="e03ec7d1e46f44c47e1547f8c19fdbb5" category="list-text">根據 VMware ，如果將 vVols 搭配多個 vCenter 使用，則需要 CA 簽署的憑證。</block>
  <block id="777f90dea67a6de19d7e4287d6d65525" category="list-text">Vasa 服務 ________________________________</block>
  <block id="50261e7dc97594e1ef47d1913fadd642" category="list-text">管理服務 _________________________________________</block>
  <block id="e6fbc0b9673f8c86726688d7607fc8f5" category="inline-image-macro">六</block>
  <block id="96c44f7328270a7b9e72a07f78739ecf" category="list-text">共享儲存設備上的資料存放區為必填項目。或者，您也可以在與節點 1 相同的資料存放區上使用內容庫，以便使用 VAAI 快速複製範本。</block>
  <block id="656b82abf6edc190097506cd4d1d585b" category="list-text">內容庫（僅 HA 需要） _________________________________________</block>
  <block id="99325facb7679dc357733bd909532cfc" category="list-text">節點一資料存放區 ________________________________</block>
  <block id="f669e2c7e65edea7adca0c4006b6cf36" category="list-text">節點 2 資料存放區（選用，但建議用於 HA ） _________________________________________</block>
  <block id="5ba1096fffa0ecfd4695651916c48133" category="list-text">節點三資料存放區（選用，但建議用於 HA ） _________________________________________</block>
  <block id="12e67aac3e7f9227cc35f8f047d7dc74" category="inline-image-macro">七</block>
  <block id="db5321854b38ff4107ff88c3d3fb2602" category="inline-link">部署 OVA</block>
  <block id="62386ee2b40ea01fd147eb04a3da8b17" category="list-text"><block ref="2b093a8e786abd40836246bfb87e05bd" category="inline-link-rx"></block>使用 vSphere 用戶端。</block>
  <block id="baca0ca6729684fd54206793ae4b5bd5" category="inline-image-macro">八</block>
  <block id="d40a477cc61e319a78ef1bb36d8ea566" category="list-text">在 HA 部署中為 VM 建立反關聯規則。</block>
  <block id="4695b076293ddedd5434ae5a73b57ae2" category="list-text">如果使用 HA ，儲存 VMotion 節點二和三會分隔資料存放區（選用，但建議使用）。</block>
  <block id="fde3f7a850bbaaac2a3706bf8c7df54c" category="inline-link">設定 ONTAP 使用者角色和權限</block>
  <block id="064719d8b0308f2a4bc89590c3becdab" category="inline-link">使用管理憑證</block>
  <block id="d59a2f6a46dd460183ac2d0c23cf6f75" category="list-text"><block ref="53fb9f19112a80479a138e84ac0182c6" category="inline-link-rx"></block>在 ONTAP 工具管理員中安裝任何必要的 CA 簽署憑證。</block>
  <block id="6245e46af5a3bdaf57696763c4214c70" category="inline-link">新增 vCenter Server 執行個體</block>
  <block id="427d083edfb4d6df118817492fea1fea" category="list-text"><block ref="9271e724c67dd3dffeb4e3ddaf43b80d" category="inline-link-rx"></block>在 ONTAP 工具管理程式中。</block>
  <block id="75299228e38c6c56354b3fbc53bd01db" category="inline-link">內建叢集</block>
  <block id="0583aea4353aeb5998071022ebbb79ae" category="inline-link">內建 SVM</block>
  <block id="4d5a9665c20fe0f045d612f3d7c14c3a" category="inline-link">在 VMware Live Site Recovery 應用裝置上設定 SRA</block>
  <block id="74d3c40ee5d2741e75390e90d13a881a" category="list-text">如果您爲 SRM/VSR 啓用了 SRA 以保護傳統的數據存儲，請參閱<block ref="ae14a63430307f4358dbb1aa0a6215ef" category="inline-link-rx"></block>。</block>
  <block id="56b3d744b9b4be462a3690ae4544597f" category="inline-link">接近零 RPO</block>
  <block id="f2866fe05fc7b275f3e2c504b39a3676" category="list-text">設定的原生備份<block ref="f915d15018e6084f8326718037772bc7" category="inline-link-rx"></block>。</block>
  <block id="c6a161ea3b473fa2cdc98e5283764902" category="list-text">設定定期備份至其他儲存媒體。</block>
  <block id="ed0748e15540f55b7e9e13424330165e" category="paragraph">請遵循下列最佳實務做法，為您的虛擬機器建立 vVols 儲存設備。</block>
  <block id="071d555e17e95fc548b89eaa2c3d9abf" category="section-title">準備使用 ONTAP 工具建立 VVols 資料存放區</block>
  <block id="ed0b328de155f4d64394b3fa01aa3eda" category="inline-link">將本機層（集合體）指派給 SVM</block>
  <block id="835f14a0eb02625831ec957a0e6d8a57" category="list-text"><block ref="62ee77b15c683e37c03a082cde78e3a1" category="inline-link-rx"></block>適用於所有非 ASA R2 系統。</block>
  <block id="975336c37f4c9eec8db7574a1acdfc20" category="inline-link">設定生命總覽</block>
  <block id="a51cd3bd8dc9efabd4808d4faa54cb85" category="inline-link">結合實體連接埠以建立介面群組</block>
  <block id="02da2876df386437299938fff21fad98" category="list-text">每個節點至少有一個 LIF 用於每個交換器 / 架構連線。最佳做法是為 FCP 、 iSCSI 或 NVMe 型傳輸協定、每個節點建立兩個以上的資料傳輸協定。每個節點只需一個 LIF 就能容納 NFS 型 VVols ，但 LIF 應該受到 LACP ifgroup 的保護。如需詳細資訊，請參閱<block ref="f0614b67c9ad440bb8aa968adbd6137a" category="inline-link-rx"></block>和<block ref="a5ffd5460ffa788a3fba4a7f91132efb" category="inline-link-rx"></block>。</block>
  <block id="1e410bafe9c5869016fc8d733372d354" category="list-text">如果您打算為租戶 vCenter 使用 SVM 範圍認證，則每個 SVM 至少要有一個管理 LIF 。</block>
  <block id="88ad52445ad4b758c30b8d41e4898479" category="inline-link">ONTAP 叢集和 SVM 已被對等執行</block>
  <block id="9e972a46542b8d916a3d602fa7d61635" category="list-text">如果您打算使用 SnapMirror ，請確定來源和目標<block ref="03354afe01dc1f53e5b25fc0bc002ae0" category="inline-link-rx"></block>。</block>
  <block id="2a03ee5b0887b8a6bf23fd52456544db" category="inline-link">部署適用於 VMware vSphere 的 ONTAP 工具</block>
  <block id="23f58455f809e6f8a8a2cac1db0e49cf" category="list-text"><block ref="17b63a5e90adbe276a8874700041ac19" category="inline-link-rx"></block>使用從 NetApp 支援網站下載的 OVA 。</block>
  <block id="1bcb0e86c49aae8128bbabb5d9d3d585" category="list-text">ONTAP 工具 10.0 及更新版本支援每個應用裝置多個 vCenter 伺服器，您不再需要在每個 vCenter 部署一個 ONTAP 工具應用裝置。</block>
  <block id="951d3fc54a28f9f46798897467d96a5b" category="inline-link">管理憑證</block>
  <block id="6d8aae47de809b9e77fb4f1ee0ed7730" category="list-text">如果您計畫將多個 vCenter 連線至單一 ONTAP 工具執行個體，則必須建立並安裝 CA 簽署的憑證。請參閱<block ref="32dbc6ca4c4a8bcb0695dd873f46e9e4" category="inline-link-rx"></block>以取得步驟。</block>
  <block id="31be7f8c3c1f560d4cfdde9947673161" category="list-text">從 10.3 開始， ONTAP 工具現在就部署為單一節點的小型應用裝置，適合大多數非 vVols 工作負載。</block>
  <block id="485a78e60d40cdf87a9864e840ed44a8" category="inline-link">橫向擴充 ONTAP 工具</block>
  <block id="0112f904af205a304a0144318d92a88f" category="inline-link">在沒有 vSphere DRS 的情況下使用關聯規則</block>
  <block id="7ff088db1b9b2e6077b66b3e834c022c" category="inline-link">建立 VM-VM 關聯規則</block>
  <block id="1d7299ee36dd01581c03d394e21875e9" category="inline-link">使用內建的組態備份公用程式</block>
  <block id="aaccfa1f911c7ed3afac8a1c9005cf08" category="list-text">建議使用正式版 VVols 的最佳實務做法是消除任何單點故障。建立反關聯規則，以防止 ONTAP 工具 VM 在同一部主機上一起執行。在初始部署之後，也建議使用 Storage VMotion 將 ONTAP 工具 VM 放置在不同的資料存放區中。瞭解有關或<block ref="33bad2ad715296cb3b9df2aa8e0bbe93" category="inline-link-rx"></block>的更多信息<block ref="9d1413939148e981fa32923e1c0a740d" category="inline-link-rx"></block>。您也應該排程頻繁備份和 / 或<block ref="835137bc934138d6c89439748022267d" category="inline-link-rx"></block>。</block>
  <block id="97075bcba23b351ceb599f8167247f82" category="list-text">為您的環境設定 ONTAP 工具 10.3 。</block>
  <block id="46efd89ca4d682d645c74916f2c8e8f4" category="list-text"><block ref="9271e724c67dd3dffeb4e3ddaf43b80d" category="inline-link-rx"></block>在 ONTAP 工具管理器 UI 中。</block>
  <block id="6eaf552fe4b827d87d969ecf00791fab" category="inline-link">新增 ONTAP 叢集</block>
  <block id="e4c64ea440c0954a75e29bee53f58731" category="list-text">ONTAP 工具 10.3 支援安全的多租戶共享。如果您不需要安全的多租戶共享，只要<block ref="c70dc775815ebe034e3eb8a346ef862b" category="inline-link-rx"></block>前往 vCenter 的 ONTAP 工具功能表，按一下儲存設備後端 _ ，然後按一下 _add_ 按鈕即可。</block>
  <block id="2fdde12c870630cac6cf925e7762e8b7" category="list-text">登入 ONTAP 工具管理員 UI</block>
  <block id="bfae79cf17053457fef781bcd20e0f14" category="inline-link">內建儲存叢集</block>
  <block id="b7d3b83b5327fbad54ed641ffe056c7b" category="list-text"><block ref="b7d3b83b5327fbad54ed641ffe056c7b" category="inline-link-rx"></block></block>
  <block id="a5ff3af9e80b6313b32053dd07f43a23" category="inline-link">將儲存後端與 vCenter Server 執行個體建立關聯</block>
  <block id="b60bfa6652bfe8b1d4f8779e792ac95c" category="list-text"><block ref="b60bfa6652bfe8b1d4f8779e792ac95c" category="inline-link-rx"></block></block>
  <block id="e3efa7d6ee6a48514d6cd7ff7795498f" category="list-text">將特定 SVM 認證提供給 vCenter 管理員，然後將 SVM 新增為 vCenter 的 ONTAP 工具儲存設備後端功能表中的儲存後端。</block>
  <block id="0abec471b6c51c227aee6d0b1708d228" category="list-text">最佳做法是為儲存帳戶建立 RBAC 角色。</block>
  <block id="e235f10d1a7bf30f3198a59ac049dc9c" category="list-text">ONTAP 工具包含 JSON 檔案，其中包含 ONTAP 工具儲存設備帳戶所需的角色權限。您可以將 JSON 檔案上傳至 ONTAP 系統管理員，以簡化 RBAC 角色和使用者的建立。</block>
  <block id="8ca4b3b11e162a34da542a63661edf9a" category="list-text">如需ONTAP RBAC 角色的詳細資訊，請參閱<block ref="34ad13b9bdc1ec3d2d017144f37b1766" category="inline-link-rx"></block>。</block>
  <block id="e4f0d44befb2f792ce908178a949f26d" category="admonition">整個叢集必須在 ONTAP 工具管理員 UI 中建立的原因，是因為許多用於 vVols 的 API 只能在叢集層級上使用。</block>
  <block id="90aa53fd267c0c35741d35381ad7a054" category="section-title">使用 ONTAP 工具建立 VVols 資料存放區</block>
  <block id="2899926e592e956d9ee50e9ac1a3fcc5" category="paragraph">以滑鼠右鍵按一下您要建立 VVols 資料存放區的主機、叢集或資料中心、然後選取 ONTAP tools_ &gt; _Provision Datastority_ 。</block>
  <block id="893534fd72b00ed504664763cdcfc0a5" category="inline-image-macro">role ="thum" "Provision datastore wizard" ， 300</block>
  <block id="4a68f477edf1ea24da48b805acb7318c" category="paragraph"><block ref="4a68f477edf1ea24da48b805acb7318c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="20474b1a0c7edf7bd0809f2cb13dfe99" category="list-text">選擇 VVols 並提供有意義的名稱，然後選取所需的傳輸協定。您也可以提供資料存放區的說明。</block>
  <block id="f4f44261c4e217310cb4f0bb2cc389f5" category="list-text">ONTAP 工具 10.3 搭配 ASA R2 。</block>
  <block id="39a5735e417853a21c6d8ed53aa5cb1f" category="paragraph"><block ref="39a5735e417853a21c6d8ed53aa5cb1f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="e332ae811243a2074f58eb5d5efdcc21" category="list-text">選取 ASA R2 系統 SVM ，然後按一下 _NEXT 。</block>
  <block id="dac9a06ae28c99c2bc00c2f1ca94c7ed" category="paragraph"><block ref="dac9a06ae28c99c2bc00c2f1ca94c7ed" category="inline-image-macro-rx" type="image"></block></block>
  <block id="2b3dd72cbd7ce4cf79b8fe46700d45d5" category="list-text">按一下完成 _</block>
  <block id="278f04f3dff2f303eed4edfbc836f534" category="paragraph"><block ref="278f04f3dff2f303eed4edfbc836f534" category="inline-image-macro-rx" type="image"></block></block>
  <block id="78195be4e07f2cf980cf70b78cfd4a62" category="list-text">就是這麼簡單！</block>
  <block id="ca8e7cc39790460719db057ff38e167d" category="list-text">ONTAP 工具 10.3 搭配 ONTAP FAS ， AFF 和 ASA PRIOR ASA R2 。</block>
  <block id="7f016940a12444f321c6a4251eb495cf" category="list-text">選取傳輸協定</block>
  <block id="c3646108adeb4be26557fcbb99f62dc2" category="paragraph"><block ref="c3646108adeb4be26557fcbb99f62dc2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b0ec44dc6f9561dfdf58606f8e389753" category="list-text">選取 SVM ，然後按一下 _NEXT 。</block>
  <block id="444c0ec9fa985ffe1e7a13b90ec73f1b" category="paragraph"><block ref="444c0ec9fa985ffe1e7a13b90ec73f1b" category="inline-image-macro-rx" type="image"></block></block>
  <block id="75403559d3b552e859c244a233ae00ac" category="list-text">按一下新增磁碟區 _ 或使用現有的磁碟區 _ ，然後指定屬性。請注意，在 ONTAP 工具 10.3 中，您可以要求同時建立多個磁碟區。您也可以手動新增多個磁碟區，以便在 ONTAP 叢集之間取得平衡。按一下 _NEXT</block>
  <block id="9a7e72607a6faad27d7fbe6e5f295675" category="paragraph"><block ref="9a7e72607a6faad27d7fbe6e5f295675" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4e1a38b50f0db11d407ccb112de6a782" category="paragraph"><block ref="4e1a38b50f0db11d407ccb112de6a782" category="inline-image-macro-rx" type="image"></block></block>
  <block id="2037e6ffbfee1dde5dddbbca50cda2de" category="paragraph"><block ref="2037e6ffbfee1dde5dddbbca50cda2de" category="inline-image-macro-rx" type="image"></block></block>
  <block id="775c4cf447196b1d2af4bc4eb340eab0" category="list-text">您可以在資料存放區的「組態」索引標籤的「 ONTAP 工具」功能表中看到指派的磁碟區。</block>
  <block id="f16d549f88c459ef96e6cb1cfd5e5ad6" category="paragraph"><block ref="f16d549f88c459ef96e6cb1cfd5e5ad6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="66ded2ce50d43c22f8e56efe6053a76d" category="list-text">現在您可以從 vCenter UI 的 _Policies and Profiles_ 功能表建立 VM 儲存原則。</block>
  <block id="fc7ec2dfcc40e5c7c47dca5758e10523" category="paragraph">將 VM 從傳統資料存放區移轉至 vVols 資料存放區、就像在傳統資料存放區之間移動 VM 一樣簡單。只要選取虛擬機器、然後從「動作」清單中選取「移轉」、然後選取移轉類型 _ 僅變更儲存設備 _ 即可。出現提示時，請選取符合 VVols 資料存放區的 VM 儲存原則。移轉複本作業可與 vSphere 6.0 及更新版本一起卸載，以便將 SAN VMFS 移轉至 vVols ，但無法從 NAS VMDK 移轉至 vVols 。</block>
  <block id="26fcc57b7c0de02dc9e8360d6f4b3493" category="paragraph">若要使用原則型管理來自動化儲存資源配置，您需要建立對應至所需儲存功能的 VM 儲存原則。</block>
  <block id="8b8944ec0cef6dd0777b2144561987fe" category="admonition">ONTAP 工具 10.0 及更新版本不再像舊版一樣使用儲存功能設定檔。而是直接在 VM 儲存原則本身中定義儲存功能。</block>
  <block id="0774b1717ce18129cd8e3ec0094e8640" category="paragraph">建立儲存原則之後，即可在佈建新 VM 時使用。</block>
  <block id="473e84e674f60e2fe619202a460efdfb" category="inline-image-macro">role = 「使用 ONTAP 工具建立 VM 儲存原則」 VASA Provider 9.10"300</block>
  <block id="e2f8ccc321215682fc34ae142633f3ff" category="paragraph"><block ref="b8f36bdf242d29fb6768827d6130494d" category="inline-image-macro-rx" type="image"></block> <block ref="e2501bb4f16d0f74914f04323d8e5e58" category="inline-image-macro-rx" type="image"></block> <block ref="166606e94a626af27852e00771133222" category="inline-image-macro-rx" type="image"></block> <block ref="8a14d5d27355a6630c7d65d859977eb8" category="inline-image-macro-rx" type="image"></block> <block ref="50b6bc69b9e417ba7f80bbcc0baaf57d" category="inline-image-macro-rx" type="image"></block> <block ref="8ec6614ba8e8947129dafaaede18ec39" category="inline-image-macro-rx" type="image"></block> <block ref="7bf707d7de5e0a048094c66368c89e52" category="inline-image-macro-rx" type="image"></block></block>
  <block id="71ea2d7b6b501372ec2ecc7846b5bd74" category="section-title">使用 ONTAP 工具進行效能管理</block>
  <block id="4357d652f2cfe6e15b6e8c54aacec10b" category="paragraph">ONTAP 工具使用其本身的平衡放置演算法，將新的 vVol 置入具有統一或傳統 ASA 系統的 Best FlexVol volume ，或是在 vVols 資料存放區內搭配 ASA R2 系統的儲存可用性區域（ SAZ ）。放置方式是根據將備份儲存設備與 VM 儲存原則配對而定。如此可確保資料存放區和備份儲存設備符合指定的效能需求。</block>
  <block id="97c380438d77f28866d8fca75c697d78" category="list-text">* 虛擬機器原則可指定最小和最大 IOPS * 。</block>
  <block id="f980d0e57da48ae0fc9f45625e32cf7d" category="list-text">在將 VM 原則重新套用至使用它的 VM 之前，變更原則中的 IOPS 並不會變更 vVols 上的 QoS 。或者，您也可以建立具有所需 IOPS 的新原則，並將其套用至目標 VM 。一般而言，建議您只為不同服務層級定義個別的 VM 儲存原則，然後只需變更 VM 上的 VM 儲存原則即可。</block>
  <block id="6c47cd98201c31f6165c0239e8fa84b8" category="list-text">ASA ， ASA R2 ， AFF 和 FAS 特性設定具有不同的 IOPs 設定。所有快閃系統皆可使用最小和最大值；不過，非 AFF 系統只能使用最大 IOPs 設定。</block>
  <block id="6c2d6091dcb0d9df928f0dc687f86383" category="inline-image-macro">role ="thum" " 重新套用 VM 儲存原則 "300</block>
  <block id="8551dcdff381e3430606b1ff98a1e369" category="paragraph"><block ref="8551dcdff381e3430606b1ff98a1e369" category="inline-image-macro-rx" type="image"></block></block>
  <block id="def8fabb3f167c5ac05ad7f416c77a5c" category="paragraph">搭配 NetApp 使用 vVols 的關鍵在於適用於 VMware vSphere 的 ONTAP 工具，這類伺服器是 NetApp ONTAP 9 系統的 VASA （ vSphere API for Storage Aware ）提供者介面。</block>
  <block id="e1688cfcbc1a78418422879cc779caf5" category="paragraph">ONTAP 工具也包括 vCenter UI 擴充， REST API 服務，適用於 VMware Site Recovery Manager / 即時網站恢復的儲存複寫介面卡，監控和主機組態工具，以及一系列可協助您更妥善管理 VMware 環境的報告。</block>
  <block id="3122b363be1cca4e9b79843907db549f" category="paragraph">對於使用 VMware Cloud Foundation 搭配 vSAN 的客戶，可將 vVols 新增至任何管理或工作負載網域，做為補充儲存空間。 vVols 可透過通用的儲存原則型管理架構，與 vSAN 無縫整合。</block>
  <block id="adcd94c2ec3aa54fc9fbaa77544ccc10" category="paragraph">新一代 ONTAP 工具 10 版本系列採用可擴充的容器化微服務架構，可透過 ESXi 上的簡易 OVA 格式應用裝置進行部署，將先前的功能現代化。ONTAP 工具 10 將三種舊應用裝置和產品的所有功能整合到單一部署中。對於 vVols 管理，您將使用直覺式 vCenter UI 延伸功能或 REST API 來管理 ONTAP 工具 VASA Provider 。請注意， SRA 元件適用於傳統的資料存放區； VMware Site Recovery Manager 不會將 SRA 用於 vVols 。</block>
  <block id="b87ac5af4acce876c9cb950c7c5a1891" category="section-title">ONTAP 工具 VASA Provider 架構，可搭配統一化系統使用 iSCSI 或 FCP</block>
  <block id="b566b0372bb84d18bc26fdc4c0fbd397" category="paragraph">若要進行新的安裝、請將虛擬應用裝置部署到 vSphere 環境中。部署後，您可以登入管理器 UI ，或使用其餘 API 來擴充或擴充部署，內建 vCenter （這會將外掛程式登錄至 vCenter ），內建儲存系統，以及將儲存系統與 vCenter 建立關聯。只有當您計畫將安全的多租戶共享與專用 SVM 搭配使用時，才需要在 ONTAP 工具管理器 UI 中安裝儲存系統，並將叢集與 vCenter 關聯，否則您只需在 ONTAP 工具 vCenter UI 延伸中，或使用 REST API 即可輕鬆建置所需的儲存叢集。</block>
  <block id="26ffc687a7267f96a389530199971cd1" category="inline-link">適用於 VMware vSphere 的 ONTAP 工具文件</block>
  <block id="e8d49fe128837c5d33383898126449d6" category="paragraph">請參閱<block ref="d7e84668ac8db4130d4662ae6bde9c89" category="inline-link-macro-rx"></block>本文件中的，或<block ref="b9c3640cd3dcc39d23d49bf169dd367b" category="inline-link-rx"></block>。</block>
  <block id="2e2b8d8692ea57a5a089be51e49a3104" category="paragraph">最佳做法是將 ONTAP 工具和 vCenter 應用裝置儲存在傳統的 NFS 或 VMFS 資料存放區上，以避免任何相依性衝突。由於 vCenter 和 ONTAP 工具必須在 vVols 作業期間彼此通訊，因此請勿將 ONTAP 工具應用裝置或 vCenter Server 應用裝置（ VCSA ）安裝或移至他們正在管理的 vVols 儲存設備。如果發生這種情況，重新啟動 vCenter 或 ONTAP 工具應用裝置可能會導致控制面板存取中斷，以及應用裝置無法開機。</block>
  <block id="d6776ddc59d905e2967855a8949b8ff0" category="inline-link">適用於 VMware vSphere 10 的 ONTAP 工具 - 下載</block>
  <block id="e085c3225ffce6bb698ac8cf50cc0dc4" category="inline-link">從適用於 VMware vSphere 10.x 的 ONTAP 工具升級至 10.3</block>
  <block id="e43b5fd407b2bc9fda1a39851a48f9bb" category="inline-link">從適用於 VMware vSphere 9.x 的 ONTAP 工具移轉至 10.3</block>
  <block id="8374c9fea191c7d2f4430555aa250de3" category="paragraph">如需調整虛擬應用裝置規模及瞭解組態限制，請參閱<block ref="d602e3cdd9623c66a90a3f53a55d967f" category="inline-link-rx"></block></block>
  <block id="eddf7820ea4e2a78603e1bff3aa3bbb6" category="paragraph"><block ref="eddf7820ea4e2a78603e1bff3aa3bbb6" category="inline-link-rx"></block></block>
  <block id="a4552c6e2a6c6188a04ffaf366c67ea5" category="list-text"><block ref="a4552c6e2a6c6188a04ffaf366c67ea5" category="inline-link-rx"></block></block>
  <block id="2bd2f3ded095498e9ee97f7cc9074dc0" category="inline-link">VMware vSphere 的 ONTAP 工具總覽</block>
  <block id="0e8f3f9d7644f28839e4eb573b4c2589" category="list-text"><block ref="0e8f3f9d7644f28839e4eb573b4c2589" category="inline-link-rx"></block></block>
  <block id="b832e56b13b2026b9c4d50d0f3f07904" category="list-text"><block ref="b832e56b13b2026b9c4d50d0f3f07904" category="inline-link-rx"></block></block>
  <block id="f0bc076dbe95da208c42e642105b0125" category="list-text"><block ref="f0bc076dbe95da208c42e642105b0125" category="inline-link-rx"></block></block>
  <block id="5245dc6f2a790bb421c841d2dfa17c0d" category="inline-link">配置資料存放區</block>
  <block id="607bc4263c4e2c484eb0fbbfdc21b438" category="list-text"><block ref="607bc4263c4e2c484eb0fbbfdc21b438" category="inline-link-rx"></block></block>
  <block id="f5f3c80e03e60f2a58399685adcf6610" category="list-text"><block ref="f5f3c80e03e60f2a58399685adcf6610" category="inline-link-rx"></block></block>
  <block id="1608a10fc8319b14c6c50a77edab9e7c" category="inline-link">修改ESXi主機設定</block>
  <block id="1f4b95b02061cf146ca813dd68f240b5" category="list-text"><block ref="1f4b95b02061cf146ca813dd68f240b5" category="inline-link-rx"></block></block>
  <block id="952be4c4311cd0b3b105435f5c484336" category="inline-link">使用 ONTAP 工具和 SnapMirror Active Sync 設定 vSphere Metro Storage 叢集（ VMSC ）</block>
  <block id="4e22d6ab0229a29e7c9f041b1f4263a0" category="list-text"><block ref="4e22d6ab0229a29e7c9f041b1f4263a0" category="inline-link-rx"></block></block>
  <block id="c724784c65896d8b16350f4b0580dfd4" category="inline-link">保護虛擬機器</block>
  <block id="19ffdbf6d480a0097bf46b6fe379b412" category="list-text"><block ref="7970b8a3df0aeb298f96944db6f19225" category="inline-link-rx"></block>使用 SRM</block>
  <block id="cb2b70161843498e22e97eb5f155009c" category="inline-link">監控叢集，資料存放區和虛擬機器</block>
  <block id="1f901bed9e91faa77a039d895d167c4b" category="list-text"><block ref="1f901bed9e91faa77a039d895d167c4b" category="inline-link-rx"></block></block>
  <block id="90d45c9fcbbcfdfcff766c447a16f73a" category="paragraph">VASA Provider 包含儀表板、內含個別 vVols VM 的效能與容量資訊。這些資訊直接來自 VVol 檔案和 LUN 的 ONTAP ，包括延遲， IOPS ，處理量等。使用所有目前支援的 ONTAP 9 版本時，預設會啟用此功能。請注意，初始設定後，資料可能需要 30 分鐘才能填入儀表板。</block>
  <block id="6861075c55e048882e2c055171a337b2" category="section-title">其他最佳實務做法</block>
  <block id="ce76fed6b9276669c61e2b0b85e8e767" category="paragraph">通常， ONTAP 支持 VMware 定義的 vVols 限制（請參閱發佈的<block ref="a6efdd9b1a19df6105024b4869e0582b" category="inline-link-rx"></block>）。請務必檢查<block ref="bb9c67b5a4c15a85b5e6aa6c9afd0285" category="inline-link-rx"></block> LUN ，命名空間和檔案數量和大小的更新限制。</block>
  <block id="3729a48b517da427fd2d9807ebc0fed5" category="paragraph">* 在使用 FCP for vVols 之前，請先將光纖通道架構分區。 *</block>
  <block id="f156d8db1f2ed380f0199266e583aa1b" category="paragraph">對於非 ASA R2 系統，最好將數個備份磁碟區新增至 vVols 資料存放區，以便在 ONTAP 叢集上分散工作負載，支援不同的原則選項，或增加允許的 LUN 或檔案數量。不過、如果需要最高的儲存效率、請將所有的備份磁碟區放在單一集合體上。或者、如果需要最大的複製效能、請考慮使用單一 FlexVol 磁碟區、並將範本或內容庫保留在相同的磁碟區中。VASA Provider 將許多 VVols 儲存作業卸載至 ONTAP 、包括移轉、複製和快照。在單一 FlexVol 磁碟區內完成此作業時、會使用節省空間的檔案複本、而且幾乎可以立即使用。當跨 FlexVol 磁碟區執行此作業時、複本會快速可用、並使用即時重複資料刪除和壓縮功能、但在背景工作使用背景重複資料刪除和壓縮在磁碟區上執行之前、最大的儲存效率可能無法恢復。視來源和目的地而定、部分效率可能會降低。</block>
  <block id="256a688cc49c759f4698b8d5d1dd7b6a" category="paragraph">在 ASA R2 系統中，這種複雜度會被移除，因為磁碟區或集合體的概念會從使用者那裏抽象出來。動態放置會自動處理，並視需要建立傳輸協定端點。如果需要額外的擴充功能，則可即時自動建立其他傳輸協定端點。</block>
  <block id="66a77b29a2cc0bdf1aa1bf8f6d4dac96" category="paragraph">* 確保您擁有足夠的資料生命。 *請參閱 <block ref="d7e84668ac8db4130d4662ae6bde9c89" category="inline-link-macro-rx"></block>。</block>
  <block id="b2dd36bd4918e00f8b2e15e6d62a4b94" category="section-title">VASA供應商</block>
  <block id="0a4ba68e118d83e29ea66516a02f1b48" category="section-title">傳輸協定端點（ PE ）</block>
  <block id="974863a1395a284a680d09e18cf6c9cc" category="section-title">虛擬傳輸協定端點（ VPE ）</block>
  <block id="8f13bfaaa8ba18765f4525a280f647cf" category="section-title">虛擬 Volume 資料存放區</block>
  <block id="80c64f568dcf805b418e425957b8c975" category="paragraph">| 虛擬 Volume 資料存放區是 VVols 容器的邏輯資料存放區呈現，由 VASA Provider 建立及維護。該容器代表從 VASA Provider 管理的儲存系統所配置的儲存容量集區。ONTAP 工具支援將多個 FlexVol 磁碟區（稱為備份磁碟區）分配至單一 VVols 資料存放區、這些 VVols 資料存放區可跨越 ONTAP 叢集中的多個節點、將 Flash 和混合式系統結合在一起、提供不同的功能。管理員可以使用資源配置精靈或 REST API 來建立新的 FlexVol Volume 、或選擇預先建立的 FlexVol Volume 來備份儲存區（如果有的話）。</block>
  <block id="9f1893d8db5ceaf62726d1a0aa228224" category="section-title">VM 儲存原則</block>
  <block id="0aa8052a92097a4f8ec3114e7249a0e1" category="paragraph">VM 儲存原則是在 vCenter 的原則和設定檔下建立。對於 vVols 、請使用 NetApp vVols 儲存類型供應商的規則來建立規則集。ONTAP 工具 10.X 現在提供比 ONTAP 工具 9.X 更簡單的方法，可讓您直接在 VM 儲存原則本身中指定儲存屬性。</block>
  <block id="2efad47a2579a212fb659be8b8101b3c" category="paragraph">VM 佈建完成後， VASA Provider 將繼續檢查法規遵循狀況，並在備份磁碟區不再符合原則時，在 vCenter 中警示 VM 管理員。</block>
  <block id="1bf63b567c68de7fcd78fcc89f42f93c" category="inline-link">使用主機叢集保護來保護</block>
  <block id="b6930b017bd126db888766f9750b206b" category="section-title">VMware vSphere 組態</block>
  <block id="2587ca69fa38fdcf84be76d7302e4e48" category="admonition">本文檔中的任何內容都不能取代<block ref="0802e50581eb79c07178f36fed073afc" category="inline-link-rx"></block>。本內容僅供參考，無法取代正式的 VMware 文件。</block>
  <block id="0daafa8f38daf57ac774520f73c6131b" category="section-title">視需要建立資料存放區叢集</block>
  <block id="5888812a5e670c1dc41279a5d93cc502" category="paragraph">* 使用 ONTAP 儲存設備時，建議停用 Storage DRS 。</block>
  <block id="f58d6a99824e61e497bca94714a3efef" category="list-text">儲存 DRS 通常不需要或建議用於 ONTAP 儲存系統。</block>
  <block id="8525b77695e58a3254731f53ce2b2162" category="list-text">ONTAP 提供本身的儲存效率功能，例如重複資料刪除，壓縮和壓縮，這些功能可能會受到儲存 DRS 的影響。</block>
  <block id="c9a841ce409cdc722c7bdd080f0f88de" category="list-text">如果您使用的是 ONTAP 快照，則 Storage VMotion 會在快照中保留 VM 的複本，可能會增加儲存使用率，並可能影響備份應用程式，例如追蹤 VM 及其 ONTAP 快照的 NetApp SnapCenter 。</block>
  <block id="e5239709587bb3ebb34629be6c41ac7b" category="paragraph">NetApp ® MetroCluster ™和 SnapMirror 主動同步（以前稱爲 SnapMirror 業務連續性或 SMBC ）均支持 VMSC 解決方案，如果一個或多個故障域發生整體中斷，則可提供高級業務連續性。不同故障模式的恢復能力取決於您選擇的組態選項。</block>
  <block id="1e1566860cb6afbc338f9fba32c4e5e5" category="list-text">對稱 Active Sync （ ONTAP 9.15.1 ）</block>
  <block id="b9ca5ba97cf75d3dafb51f78e073770a" category="inline-link">NetApp文件</block>
  <block id="1c71125ba0668792e46d93c17dc6c428" category="paragraph">如需 SnapMirror 主動式同步的特定設計與部署資訊，請參閱<block ref="9ace5d3ebe2fe57037322de54ac9a869" category="inline-link-rx"></block>。</block>
  <block id="c50c3de11b39aab15ac6b3b860691105" category="paragraph">VMware Storage DRS 功能可將資料存放區集合至單一單元，並在超過儲存 I/O 控制（ SEIOC ）臨界值時平衡虛擬機器磁碟。</block>
  <block id="a6389705a0010980a83767268763aa53" category="sidebar">使用 ONTAP 工具的虛擬磁碟區（ vVols ） 10.</block>
  <block id="d858ab232a556e2be473d51d09bc0c3d" category="sidebar">ONTAP 工具安裝檢查清單</block>
  <block id="2e0a1393be1d4f990f277513b8384831" category="cell">保留預設值（ 1 ）如需詳細資訊，請參閱<block ref="3b98534d1167689d42f2d1a533484036" category="inline-link-macro-rx"></block></block>
  <block id="79a22fb066bcc86a371f557f30051d43" category="inline-link">設定分區</block>
  <block id="b5d661217ddfecce129a41707ffa9fa9" category="list-text">判斷您是否將使用光纖通道（ FC ）進行儲存連線。如果是，您必須<block ref="1ce5ae0107fd362eacaa4ef5b56c5d82" category="inline-link-rx"></block>在 FC 交換器上啟用 ESXi 主機與 SVM FC 生命期之間的連線。</block>
  <block id="49e1b0dac188727de519431ac2068825" category="list-text">向您的網路團隊索取下列 IP 資訊。前三個 IP 位址為必填；節點二和節點三用於橫向擴充高可用度（ HA ）部署。需要 DNS 主機記錄，所有節點名稱和所有位址都應位於相同的 VLAN 和子網路上。</block>
  <block id="7be8dd6dbcd142349f300df69f6a63d2" category="list-title"><block ref="beadfa85a2fdca06b91edc1131c603e6" category="inline-image-macro-rx" type="image"></block>儲存設備</block>
  <block id="829d9899725b36358387edfa5df0e486" category="list-title"><block ref="99e8b2f00e172bfcff96afdce69907bc" category="inline-image-macro-rx" type="image"></block>部署 OVA</block>
  <block id="2c63315a0e6899fa3f810f1b06553689" category="list-title"><block ref="ef78558f80439832e0f51cc22cee8b8c" category="inline-image-macro-rx" type="image"></block>將 vCenter 新增至 ONTAP 工具</block>
  <block id="0547f403694814dca82327ab77f95205" category="list-title"><block ref="36915574c413876eaa75cbd48f69fd00" category="inline-image-macro-rx" type="image"></block>將儲存設備後端新增至 ONTAP 工具</block>
  <block id="5abf46747a299bb4d24d81d3a3f343aa" category="list-text"><block ref="40ea307f91b1c1591600230b15a0b728" category="inline-link-rx"></block>在 ONTAP 工具管理程式中，將其與 vCenter 建立關聯。</block>
  <block id="e69b3c58a2b1480f291387c690bf92b4" category="list-text"><block ref="9f5477aac946ec407262cd052d80864d" category="inline-link-rx"></block>在 ONTAP 工具 vCenter UI 中。</block>
  <block id="9e80f1d38a7781fc49c6800d20337ec2" category="list-text"><block ref="40ea307f91b1c1591600230b15a0b728" category="inline-link-rx"></block>直接在 ONTAP 工具 vCenter UI 中。或者，在此案例中，您可以在不使用 vVols 時直接新增 SVM 。</block>
  <block id="421bdf5be659af6d75aab31df92b7907" category="list-title"><block ref="430057c670c01688e904ed2ba129a0b5" category="inline-image-macro-rx" type="image"></block>設定應用裝置服務（選用）</block>
  <block id="24db11216549ee55172c33cf3def2f3f" category="inline-image-macro">九</block>
  <block id="8a339db13a88428ad39d370cfdd1129a" category="list-title"><block ref="b37b448eff4f65237cf47b29bdd2817c" category="inline-image-macro-rx" type="image"></block>憑證（選用）</block>
  <block id="a185c3c138dca5ef46afc33288a67d1f" category="inline-image-macro">十</block>
  <block id="71fc21799db94f8cae72c8732659492c" category="list-title"><block ref="6097494f0af631df68e3dcb7a6da8d2a" category="inline-image-macro-rx" type="image"></block>其他部署後工作</block>
  <block id="93da9d9a3842b9e17ab9de43211bf697" category="paragraph">如需詳細資訊，請參閱<block ref="0802e50581eb79c07178f36fed073afc" category="inline-link-rx"></block></block>
  <block id="275507174f3ab21b1a65c1d5e8446001" category="paragraph">您也應該<block ref="0802e50581eb79c07178f36fed073afc" category="inline-link-rx"></block>參閱。</block>
  <block id="c44625cf01f743c720301c28e8461709" category="list-text">請注意，此步驟可能需要 45 分鐘才能完成</block>
  <block id="7747c50f7bb3ac05c39d999f8d5ce43e" category="list-text">在 OVA 部署的步驟 3 中，選取「自訂此虛擬機器的硬體」選項，然後在步驟 10 中設定下列項目：</block>
  <block id="a7510781f5c52d40e5706471809518f0" category="list-text">" 啟用 CPU Hot Add"</block>
  <block id="5b1ae3ca31ee580e9664ebf0949a302c" category="list-text">" 記憶體熱插拔 "</block>
  <block id="2cd9adcb9e8de7c58834011ca647797d" category="list-text"><block ref="4ccf4d83bac775854f5f0cfb549c6d86" category="inline-link-rx"></block>如果不使用 admin ，請使用隨附的 JSON 檔案。</block>
  <block id="067561a3b92d67321174249eb7de567d" category="paragraph">NetApp 於 2012 年開始與 VMware 合作、為 vSphere 5 支援 vSphere API for Storage Aware （ VASA ）。此早期的 VASA Provider 允許定義設定檔中的儲存功能、以便在資源配置時用來篩選資料存放區、並在之後檢查原則是否符合規定。隨著時間演進、新增新功能以實現更多自動化資源配置、並新增虛擬磁碟區或 vVols 、其中個別的儲存物件用於虛擬機器檔案和虛擬磁碟。這些物件可以是 LUN ，檔案，現在可以是 vSphere 8 NVMe 命名空間（搭配 ONTAP 工具 9.13P2 使用）。NetApp 與 VMware 密切合作，作為 2015 年 vSphere 6 所發佈 vVols 的參考合作夥伴，並再次成為 vSphere 8 中使用 NVMe over Fabrics 的 vVols 設計合作夥伴。NetApp 持續強化 vVols 、以充分利用 ONTAP 的最新功能。</block>
  <block id="e867f73e9a09d015c82be5c45264cda9" category="paragraph">VVols 是儲存在 vVols 資料存放區中的實際虛擬機器檔案和磁碟。使用術語 vVol （奇異）是指單一特定檔案、 LUN 或命名空間。ONTAP 會根據資料存放區使用的傳輸協定、建立 NVMe 命名空間、 LUN 或檔案。有幾種不同類型的 vVols ；最常見的是 Config （其中只有一個使用 VMFS ，其中包含 VM VMX 檔案等中繼資料檔案）， Data （虛擬磁碟或 VMDK ）和 Swap （在 VM 開機時建立）。受 VMware VM 加密保護的 vVols 類型為 other 。VMware VM 加密不應與 ONTAP Volume 或 Aggregate 加密混淆。</block>
  <block id="f615a85ee8b4ffd3bdd64ab72c2cf934" category="paragraph">如上所述，使用原則可協助簡化 VM 或 VMDK 的資源配置工作。只要選取適當的原則， VASA Provider 就會顯示支援該原則的 VVols 資料存放區，並將 VVol 置入符合法規的個別 FlexVol volume 。</block>
  <block id="d5938f26039c87ff0b18251b9b89e0ec" category="list-text">在單一磁碟區內或 ONTAP 叢集中的多個磁碟區之間快速建立複本、相較於傳統的 VAAI 複本、這是一項優勢。而且儲存效率也很高。磁碟區內的複製作業會使用 ONTAP 檔案複製、就像 FlexClone 磁碟區一樣、而且只會儲存來源 vVol 檔案 /LUN/ 命名空間的變更。因此、為了生產或其他應用程式的目的而建立的長期虛擬機器會迅速建立、佔用最少空間、並可從虛擬機器層級保護（使用適用於 VMware vSphere 的 NetApp SnapCenter 外掛程式、 VMware 託管快照或 VADP 備份）和效能管理（搭配 ONTAP QoS ）中獲益。VVols 的跨磁碟區複製速度比 VAAI 備份 VASA 快得多，我們可以建立複本，並在複本完成之前，允許在目的地存取複本。資料區塊會以背景程序複製，以填入目的地 vVol 。這類似於 ONTAP 不中斷運作的 LUN 移動對傳統 LUN 的運作方式。</block>
  <block id="5c2620ed6abb266a7824246fc409e405" category="admonition">如果磁碟區是完整配置的，則必須注意完全停用該磁碟區的所有效率功能，包括使用命令解壓縮及移除重複資料刪除<block ref="3cfeff511a11b8c5f54ce9749a719a58" prefix=" " category="inline-code"></block>。輸出中不應出現 Volume<block ref="df899f2d908ec33afe1d01ee26b3dd47" prefix=" " category="inline-code"></block> 。如果有、則磁碟區仍會部分設定為使用效率功能。因此、覆寫保證會以不同的方式運作、這會增加組態超視導致磁碟區意外用盡空間的機會、進而導致資料庫 I/O 錯誤。</block>
  <block id="d276d666f03c049a59433c8727efaa6e" category="paragraph">在 Linux 環境中、在整個磁碟機裝置上建立邏輯磁碟區群組。當需要磁碟分割時，請執行並驗證每個磁碟分割的開頭是否為八個的倍數，以檢查對齊<block ref="ab425294b9ef9f9c8acbc3f08f92b37d" prefix=" " category="inline-code"></block>。這表示分割區從八個 512 位元組磁區的倍數開始、即 4KB 。</block>
  <block id="e23f5b5639a79ab22ace94b51b47872d" category="paragraph"><block ref="e23f5b5639a79ab22ace94b51b47872d" category="inline-image-macro-rx" type="image"></block></block>
  <block id="39e45e79eb595c951cff8267572302f1" category="inline-image-macro">SyncMirror 組態</block>
  <block id="8c91b2538377a2c3400ec4694ba15e2e" category="paragraph"><block ref="8c91b2538377a2c3400ec4694ba15e2e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="073b52a996437eabf93f7783b02e2fe9" category="paragraph">此<block ref="fe3ee14511b9b1e5dfd5af1f82ac3216" category="inline-link-macro-rx"></block>軟體可在第三個站台上執行，以監控 MetroCluster 環境的健全狀況，傳送通知，並在災難情況下強制切換。您可以在上找到<block ref="2acc94a061be1196588f7f734d193bf6" category="inline-link-macro-rx"></block>有關 tiebreaker 的完整說明，但 MetroCluster tiebreaker 的主要用途是偵測站台遺失。它還必須區分站台遺失和連線中斷。例如、不應因為斷路器無法到達主要站台而進行切入、這就是為什麼斷路器也會監控遠端站台與主要站台聯絡的能力。</block>
  <block id="007bfe897ab1dfc6713daff4c13130e2" category="admonition">當強制切入時， MCTB 軟體無法驗證 NVRAM 是否與 / 或叢同步。如果已設定自動切換、則應在維護活動期間停用、導致 NVRAM 或 SyncMirror 叢同步中斷。</block>
  <block id="d5e917df8e0b7f1db3996ead2cbeb2ac" category="paragraph">ONTAP Mediator 可搭配 MetroCluster IP 和某些其他 ONTAP 解決方案使用。它是一項傳統的斷路器服務，就像上述的 MetroCluster tiebreaker 軟體一樣，但也包含一項重要功能，即執行自動無人值守的移除。</block>
  <block id="bf74d7de09985a8ef553e5122b5d0f7c" category="inline-image-macro">ClusterLion 圖表</block>
  <block id="0354d54d7a567ab0e86cd8a04f4919a1" category="paragraph"><block ref="0354d54d7a567ab0e86cd8a04f4919a1" category="inline-image-macro-rx" type="image"></block></block>
  <block id="0db380344593268d0331dffbd0e53491" category="inline-image-macro">MetroCluster IP 架構</block>
  <block id="207f169ffa50efdada53e61e95be500f" category="paragraph"><block ref="207f169ffa50efdada53e61e95be500f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="d012707a79628e35e35aa78aae04ba03" category="inline-image-macro">四節點 MetroCluster</block>
  <block id="d2d10d2707ff9930a55b8735ba28ca8b" category="paragraph"><block ref="d2d10d2707ff9930a55b8735ba28ca8b" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f76fa4fd08c3d58e5591281c16d5c61b" category="inline-image-macro">雙節點 MetroCluster</block>
  <block id="4cc7f7e2eae466068330e3136b2e786f" category="paragraph"><block ref="4cc7f7e2eae466068330e3136b2e786f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="57d3154f4afcd986d4f30b4e06c1c434" category="paragraph">ONTAP Flexible Volume （或更簡單地說，磁碟區）與 LUN 並不等同。Volume 是管理容器、用於儲存檔案或 LUN 等資料。例如、資料庫可能放置在 8-LUN 等量磁碟區集上、而所有 LUN 都包含在單一磁碟區中。</block>
  <block id="05ef9b22209f0e35efc9b6f875ad3c55" category="inline-link-macro">ONTAP 文件。</block>
  <block id="a9f5ed6c3fb24e75b9bbfde2801f43c5" category="paragraph">如需快照的詳細資訊，請參閱<block ref="8f47a9b0ccec19c7f5d940ab138ea0b4" category="inline-link-macro-rx"></block></block>
  <block id="7509bd2cfd7821f433d962315cc50a57" category="paragraph">從 ONTAP 9.12.1 開始，快照不只是唯讀的，也能防止意外或刻意刪除。此功能稱為防竄改快照。您可以透過快照原則設定及強制執行保留期間。產生的快照必須等到到期日才會刪除。沒有系統管理或支援中心覆寫。</block>
  <block id="287130f9ebd13d6ed68dd04d8d2a295e" category="admonition">防竄改快照無法使用 Fabric Pool 進行階層式管理。</block>
  <block id="c2f55c662895ff4fac4100a2a0852e43" category="paragraph">如需防竄改快照的詳細資訊，請參閱<block ref="fd5bfd16d2f3d4d67a500529a5ee8cad" category="inline-link-macro-rx"></block></block>
  <block id="be7dc70d98bcb6099a5c94c0eb263502" category="paragraph">快照也可以複寫到遠端系統。這包括防竄改快照，在遠端系統上套用及強制執行保留期間。因此資料保護效益與本機快照相同、但資料位於第二個儲存陣列上。如此可確保原始陣列的毀損不會影響備份。</block>
  <block id="170814cc5599dd2691018c487b6c756b" category="paragraph">如需 SnapMirror 的詳細資訊，請參閱<block ref="3a921b7bc4d1ecfb45f8d64003b59241" category="inline-link-macro-rx"></block></block>
  <block id="f1e054edf08e67911f64f3d6bc85055c" category="paragraph">新設定的 ONTAP 儲存系統類似於新佈建的 VMware ESX 伺服器、因為在建立虛擬機器之前、兩者都無法支援任何使用者。透過 ONTAP 、您可以建立儲存虛擬機器（ SVM ）、成為最基本的儲存管理單元。每個 SVM 都有自己的儲存資源、傳輸協定組態、 IP 位址和 FCP WWN 。這是 ONTAP 多租戶共享的基礎。</block>
  <block id="9f531561663c2d70601e59d0a2a97e22" category="paragraph">如需 SVM 的詳細資訊，請參閱<block ref="49f63552efbf93d6a834173c0aa523ad" category="inline-link-macro-rx"></block></block>
  <block id="7995495e3afeef685b0a0bcf51360d6c" category="paragraph">如需管理存取控制的詳細資訊，請參閱<block ref="a0740fbcbe9ba6690a7ab99ab89cd2c9" category="inline-link-macro-rx"></block></block>
  <block id="19fd31cbf45473230fbcebf8392cc91e" category="section-title">多因素驗證（ MFA ）</block>
  <block id="96654aef2c50a23153b1537b5229776f" category="paragraph">如需更多關於多因素驗證（ MFA ）的資訊，請參閱<block ref="1786169af27633b737f29186948225e1" category="inline-link-macro-rx"></block></block>
  <block id="e888b1b74bec5238c3c604159ac1d53a" category="paragraph">如需 API RBAC 的詳細資訊，請參閱<block ref="e61ba9faf8dbe169378ea875c9b479b4" category="inline-link-macro-rx"></block></block>
  <block id="6e09a67fb21def2cb508cbfe0d7c0794" category="paragraph">如需更多有關多重管理驗證（ MAV ）的資訊，請參閱<block ref="88147b7c4319c7463e1de20879284ceb" category="inline-link-macro-rx"></block></block>
  <block id="d682e5055f8368ad42d44e0de5e75ed3" category="inline-image-macro">SnapMirror 作用中同步正常作業</block>
  <block id="a61d348ee21d7fdf1a9da822a79df846" category="paragraph"><block ref="a61d348ee21d7fdf1a9da822a79df846" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3fe281f607d85b52408e82cb2d7aef71" category="inline-image-macro">SnapMirror 作用中同步失敗</block>
  <block id="c5ff28a15762db1ce9589bc45fe42a83" category="paragraph"><block ref="c5ff28a15762db1ce9589bc45fe42a83" category="inline-image-macro-rx" type="image"></block></block>
  <block id="a98433bfbc9755650778888be2e155c8" category="inline-image-macro">SnapMirror 主動式同步容錯移轉</block>
  <block id="5fe2be834f0686a9a02a2872ecb20f91" category="paragraph"><block ref="5fe2be834f0686a9a02a2872ecb20f91" category="inline-image-macro-rx" type="image"></block></block>
  <block id="40685542fb725d5516910c5721538340" category="inline-image-macro">SnapMirror 主動式同步修復</block>
  <block id="67e60a13c39559320bab1f6f456824d0" category="paragraph"><block ref="67e60a13c39559320bab1f6f456824d0" category="inline-image-macro-rx" type="image"></block></block>
  <block id="217536ed57b639cdf05f688cf8ddaca1" category="inline-image-macro">SnapMirror 作用中同步容錯回復</block>
  <block id="362b862a6b72622be34b2904dcbf413b" category="paragraph"><block ref="362b862a6b72622be34b2904dcbf413b" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f060f17ec7a3fc2a182a4759545d4cb3" category="paragraph"><block ref="f060f17ec7a3fc2a182a4759545d4cb3" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3d25a1eebebf538e68ea79a21fdeb31c" category="paragraph"><block ref="3d25a1eebebf538e68ea79a21fdeb31c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="1cf9d22584fea5a10f4ed164a871a45f" category="paragraph"><block ref="1cf9d22584fea5a10f4ed164a871a45f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4be3d396256a7548ce446a9a03183122" category="paragraph"><block ref="4be3d396256a7548ce446a9a03183122" category="inline-image-macro-rx" type="image"></block></block>
  <block id="05933557921f3e80d9d78fff7d9532d6" category="paragraph"><block ref="05933557921f3e80d9d78fff7d9532d6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="2a5e066e529edd11b35f46c161170620" category="paragraph">相反地、叢集式應用程式（例如 Oracle RAC ）可提供在兩個不同站台同時可用的服務。失去站台並不代表整個應用程式服務都會遺失。執行個體仍可在仍正常運作的站台上執行。</block>
  <block id="d629eadf33041c24ee81c3752a895f8d" category="paragraph"><block ref="d629eadf33041c24ee81c3752a895f8d" category="inline-image-macro-rx" type="image"></block></block>
  <block id="267017761cb9de7ce4e0ea9f0e078628" category="paragraph"><block ref="267017761cb9de7ce4e0ea9f0e078628" category="inline-image-macro-rx" type="image"></block></block>
  <block id="fd994146b555ce2a39038a16098a6e3e" category="list-text"><block ref="9df22f196a33acd0b372fe502de51211" prefix="" category="inline-code"></block>- 僅擷取隨機讀取的資料</block>
  <block id="0c65a737281c49235c3058020e81f7b9" category="list-text"><block ref="8805d416ce540c5f2df34af5b18d742b" prefix="" category="inline-code"></block>- 擷取所有依序或隨機讀取的資料</block>
  <block id="deea309eeb62f907bfa37ca436857255" category="list-text"><block ref="334c4a4c42fdb79d7ebc3e73b517e6f8" prefix="" category="inline-code"></block>- 擷取所有依序或隨機讀取的資料</block>
  <block id="c4216ce97dadec9cf3de76609a5a07de" category="list-text"><block ref="a181a603769c1f98ad927e7367c7aa51" prefix="" category="inline-code"></block>- 請勿從容量層擷取資料</block>
  <block id="47f64097ec44c9f18f4025941f2e4436" category="inline-image-macro">分層FabricPool</block>
  <block id="0a5778c8b17c5df28190c8f022c4e11a" category="paragraph"><block ref="0a5778c8b17c5df28190c8f022c4e11a" category="inline-image-macro-rx" type="image"></block></block>
  <block id="e6edcd80dc55ce70fb5c4fa1c13c9bc6" category="section-title">超執行緒</block>
  <block id="7e4c522ec8e0c58e24f493765888ed54" category="paragraph">超執行緒是指同步多執行緒（ SMT ）實作，可改善在 x86 處理器上執行運算的平行化。Intel 和 AMD 處理器均提供 SMT 。</block>
  <block id="4114d233d42e1381db8a36ed5a76930b" category="paragraph">超執行緒會產生邏輯 CPU ，在作業系統中顯示為實體 CPU 。SQL Server 接著會看到這些額外的 CPU 、並使用這些 CPU 、就好像核心數量比實際存在的數量還多。這可以透過增加平行化來大幅改善效能。</block>
  <block id="fbb6d18b081bfa69df40139eb4b0213b" category="inline-image-macro">SQL Server 記錄訊息</block>
  <block id="d78202a5fb91002bb31924c80636beee" category="paragraph"><block ref="d78202a5fb91002bb31924c80636beee" category="inline-image-macro-rx" type="image"></block></block>
  <block id="8f2b07811863589142fb500958a93aef" category="paragraph">雖然這對大型查詢很有幫助、但可能會造成效能問題並限制並行處理。更好的方法是將平行度限制在單一 CPU 插槽中的實體核心數量。例如，在具有兩個實體 CPU 插槽，每個插槽有 12 個核心的伺服器上，無論超執行緒為何，都<block ref="1abedc5f6ab369ab9fcd16d6b7990638" prefix=" " category="inline-code"></block>應該設定為 12 。<block ref="1abedc5f6ab369ab9fcd16d6b7990638" prefix=" " category="inline-code"></block>無法限制或指定要使用的 CPU 。而是限制單一批次查詢可以使用的 CPU 數量。</block>
  <block id="2bcdfd16d227f0659d58f9c368f92311" category="inline-link-macro">設定最大工作執行緒伺服器組態選項</block>
  <block id="784d03ae991a0cc4ef7f8b5318d0643e" category="paragraph">何時應設定 SQL Server 使用更多工作執行緒？如果每個排程器的平均工作佇列長度超過 1 、您可能會因為在系統中新增更多執行緒而受益、但前提是負載未受 CPU 限制或遇到任何其他繁重的等待。如果發生上述任一種情況、新增更多執行緒並不會有幫助、因為它們最終會等待其他系統瓶頸。如需工作者執行緒上限的詳細資訊，請參閱<block ref="516f4431a9f331f442450f80b5638a9d" category="inline-link-macro-rx"></block>。</block>
  <block id="a5ee78f6f06a355d893076bd00799f33" category="inline-image-macro">最大工作執行緒數</block>
  <block id="06a7934dd21e03f634b6cd9fc8dfafd5" category="paragraph"><block ref="06a7934dd21e03f634b6cd9fc8dfafd5" category="inline-image-macro-rx" type="image"></block></block>
  <block id="c7acc2cdcff9c9156a99e4f37871f0b3" category="searchtitle">使用 SnapCenter 和 T-SQL 命令保護 ONTAP 上的 Microsoft SQL Server 資料庫</block>
  <block id="d56a13248537a908d7fb7730827a3ea8" category="paragraph">保護 SQL Server 資料庫環境是一項多層面的工作，不只是管理資料庫本身而已。ONTAP 提供數項獨特功能、旨在保護資料庫基礎架構的儲存層面。</block>
  <block id="1fdd8a4c4832d13ddabbb02c424cf87d" category="paragraph">如果在切換之前、主控虛擬化資料庫的磁碟區、檔案系統和資料存放區並未在災難恢復站台上使用、則不需要在相關的磁碟區上設定<block ref="a2626552f293b2377efe829e69d14daa" prefix=" " category="inline-code"></block>。</block>
  <block id="358f73eb3e0830400b47b849dd1ff244" category="summary">Microsoft SQL Server 和 ONTAP Mediator</block>
  <block id="d7b47db08dce16a62f9ea97613e8f704" category="paragraph">安全地自動化容錯移轉需要 Mediator 。理想情況下、它會放置在獨立的第三站台、但如果與參與複寫的叢集之一共存、則仍能滿足大多數需求。</block>
  <block id="f9619e52c7cdde4c0b1a97530a47dd35" category="section-title">SnapMirror 主動式與對稱式主動 / 主動式同步的架構</block>
  <block id="19faeb7ab81d5f28227fc1778d55ff90" category="inline-image-macro">SnapMirror 主動同步架構</block>
  <block id="133eca4b24d6c05606859c2288c8ac7f" category="paragraph"><block ref="133eca4b24d6c05606859c2288c8ac7f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="441756ba9f536a754940c70c53cb3b13" category="paragraph">** ONTAP 調解器 **</block>
  <block id="b41efcb6893de373f77e07be9a8e0d32" category="paragraph"><block ref="b41efcb6893de373f77e07be9a8e0d32" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f830e7995cd120ac203db751bdb1174b" category="paragraph">NetApp 提供 Astra Trident 、可提供進階的儲存管理功能。例如、 Astra Trident 可讓在 Kubernetes 中建立的容器自動在適當的層級上配置儲存設備、套用匯出原則、設定快照原則、甚至將一個容器複製到另一個容器。如需其他資訊，請參閱<block ref="d243cca937364184efa824b0525b876a" category="inline-link-macro-rx"></block>。</block>
  <block id="e5f3f995b3e054f0d6bfdd13c3597e2c" category="paragraph"><block ref="e5f3f995b3e054f0d6bfdd13c3597e2c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="9b87cb3e85b59ad2d04537560673f94b" category="inline-image-macro">I/O 類型</block>
  <block id="977d1017b39374152ac0d18ac3267ca2" category="paragraph"><block ref="977d1017b39374152ac0d18ac3267ca2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="77ea00d93c10244a077ab55be57f5c28" category="admonition">您可以將此參數或 InnoDB_IO_capACure_max 參數設定得太高且浪費，嚴重損害效能</block>
  <block id="04a3449528520ec35e2bce9c433ee1a4" category="admonition">在新的 ASA 平台中，使用 _Vault_ 原則將快照複寫到遠端叢集，然後鎖定目的地，使快照防竄改。</block>
  <block id="c1a5c6240b77f4bda50ebb9ea018010b" category="paragraph"><block ref="c1a5c6240b77f4bda50ebb9ea018010b" category="inline-image-macro-rx" type="image"></block></block>
  <block id="a1fb4e9793df0c2c759586b0d4cc9a59" category="inline-link-macro">依 SQL Server 版本計算容量限制</block>
  <block id="c637f2ccb4ed04efecb5d430f9b8e9fa" category="paragraph">此處的注意點是、每個 SQL Server 版本都有自己的運算能力限制。如需更多資訊、請參閱 <block ref="5f7d6b9101e39b0f89ce2a4419443b58" category="inline-link-macro-rx"></block>。</block>
  <block id="027202a07b43ba49311d98b7812a6c84" category="searchtitle">使用 NetApp 管理軟體保護 Microsoft SQL Server 資料</block>
  <block id="a6612611980ab8001eb37d9b0d21fc8b" category="list-text">使用新的備份群組和備份伺服器命令，在儲存單元上同時執行多個資料庫的快照。</block>
  <block id="0dedd2c3e15900b4f533838e17976dab" category="list-text">如果資料庫工作負載橫跨多個儲存單元，請建立一致性群組以簡化管理工作。一致性群組是以單一單元管理的儲存單元集合。</block>
  <block id="7f9d52f3748a3a0f2854076ed4952d80" category="admonition">* NetApp 建議 * 使用 SnapCenter 來建立 Snapshot 複本。上述 T-SQL 方法也能正常運作，但 SnapCenter 提供完整的備份，還原及複製程序自動化功能。它也會執行探索、以確保建立正確的快照。</block>
  <block id="e158a020500bd25736fbcb79dbd57ef0" category="admonition">如果 SQL Server 資料庫是託管在 VMware 虛擬化環境中執行的虛擬磁碟上，請使用 SnapCenter 。如果資料庫裝載於裸機實體伺服器或來賓連線 SCSI 上，請使用 T-SQL Snapshot 命令備份資料庫。</block>
  <block id="19f005706f432809f0c867f9d97c05b0" category="admonition">* NetApp 建議 * 使用 SnapCenter 來建立 Snapshot 複本。上述 T-SQL 方法也能正常運作，但 SnapCenter 提供完整的備份，還原及複製程序自動化功能。它也會執行探索、以確保建立正確的快照。不需要預先設定。</block>
  <block id="88db39456c39e1de4d937d721ec1f2fc" category="doc">資料庫檔案與檔案群組</block>
  <block id="2bcb2e2e60d655aca12a6062bc99f69c" category="section-title">資料庫執行個體檔案初始化</block>
  <block id="44f4b94c8c1ceb120fb9fb9a843fbc0b" category="paragraph">SQL Server 全年無休可用性群組複寫功能是絕佳的選項、 NetApp 提供多種選項、可將資料保護與全年無休整合。不過，在某些情況下，您可能會想要使用下列選項來考慮 ONTAP 複寫技術。</block>
  <block id="5698ceeb808e1afe078605b6dbb0a4cb" category="paragraph">SnapMirror 技術提供快速靈活的企業解決方案、可在 LAN 和 WAN 上複寫資料。SnapMirror 技術只會在建立初始鏡射後、將變更的資料區塊傳輸到目的地、大幅降低網路頻寬需求。可以在同步或非同步模式中設定。NetApp ASA 中的 SnapMirror 同步複寫是使用 SnapMirror 作用中同步進行設定。</block>
  <block id="8d4bad202645c8ab15f054b63fe34160" category="paragraph">對於許多客戶而言，業務持續運作不只需要擁有遠端資料複本，還需要能夠使用 SnapMirror Active Sync 在 NetApp ONTAP 中快速使用該資料</block>
  <block id="07b431b6fdd20fcb79eababc436bc39b" category="paragraph">有了 SnapMirror 主動式同步、您基本上擁有兩個不同的 ONTAP 系統、可維護 LUN 資料的獨立複本、但可以合作呈現該 LUN 的單一執行個體。從主機的角度來看、這是單一 LUN 實體。SnapMirror 主動式同步功能支援 iSCSI / FC 型 LUN 。</block>
  <block id="2ae812ab75c34451d9dd11549d394f2a" category="paragraph">SnapMirror 主動式同步可提供 RPO=0 複寫，而且在兩個個別叢集之間實作也很容易。一旦兩個資料複本同步，兩個叢集只需鏡射寫入即可。當某個叢集發生寫入時，它會複寫到另一個叢集。只有當兩個站台的寫入作業完成時，才會將寫入內容確認給主機。除了這種傳輸協定分割行為之外，這兩個叢集都是正常的 ONTAP 叢集。</block>
  <block id="1848ac209b4ee9b7c68bbc4a1711a45d" category="paragraph">另一個用於 SM-AS 的重要使用案例是用於雙主動式作業，您想要在兩個不同位置的兩個不同叢集上提供完全可用的資料複本，而且效能特性相同，如果需要，也不需要在各個站台之間擴充 SAN 。您可以在兩個站台上執行應用程式，但前提是支援應用程式，因此可在容錯移轉作業期間降低整體 RTO 。</block>
  <block id="bdd8b094b65ec8544e0ad9724a1984ad" category="searchtitle">Microsoft SQL Server 和 SnapMirror 主動式同步容錯移轉</block>
  <block id="3fc36a3b35bb877723ed17d69c3d57fb" category="summary">Microsoft SQL Server 和 ONTAP 中介</block>
  <block id="b029689b71622a39b3564f8800798f34" category="paragraph"><block ref="b029689b71622a39b3564f8800798f34" category="inline-image-macro-rx" type="image"></block></block>
  <block id="5a2e2e33df9734d8ef57bcb93643d89a" category="paragraph">相反地、叢集式應用程式（例如 Oracle RAC ）可提供在兩個不同站台同時可用的服務。失去站台並不代表整個應用程式服務都會遺失。執行個體仍可在仍正常運作的站台上執行。</block>
  <block id="a87e788e43169f3df56a7eee4e9bd79c" category="searchtitle">SQL Server 和 SnapMirror 主動式同步</block>
  <block id="5181c0b41b072fc878e6ffdb78976292" category="paragraph">SnapMirror 主動式同步支援對稱式主動 / 主動式架構，可提供同步雙向複寫功能，以利業務持續運作及災難恢復。它可協助您保護關鍵 SAN 工作負載的資料存取、同時跨多個故障網域同時讀寫資料、確保不中斷營運、並將災難或系統故障期間的停機時間降至最低。</block>
  <block id="3fa280b2a8840046be265109ff9f0696" category="section-title">具有對稱主動 / 主動式的 SnapMirror 主動式架構</block>
  <block id="a93a13dd139e6bb0629cd0ace446c595" category="paragraph"><block ref="a93a13dd139e6bb0629cd0ace446c595" category="inline-image-macro-rx" type="image"></block></block>
  <block id="c2048364072b2c53688aeb273047e068" category="paragraph">** ONTAP 調解器 **</block>
  <block id="309d61d5c343d8fd53c2c585c64587b6" category="searchtitle">Microsoft SQL Server 搭配 SnapMirror 主動式同步</block>
  <block id="c3764435b077d7aa876e89575fe5dd64" category="paragraph"><block ref="c3764435b077d7aa876e89575fe5dd64" category="inline-image-macro-rx" type="image"></block></block>
  <block id="335b6de9aebdde6ff1e76f9688ff7ff7" category="paragraph"><block ref="335b6de9aebdde6ff1e76f9688ff7ff7" category="inline-image-macro-rx" type="image"></block></block>
  <block id="481a499afea5f44d3d3173e0504a6ee5" category="paragraph">透過統一存取、 IO 就能跨越 WAN 。它是全網狀網路叢集，可能是或不適合所有使用案例。</block>
  <block id="e7de94b63ec3b4535a16228dd6f49119" category="paragraph">如果兩個站台相距 100 公尺、且具備光纖連線能力、則不應偵測到透過 WAN 的額外延遲、但如果站台相距很遠、則兩個站台的讀取效能都會受到影響。使用非統一存取網路的 ASA 可讓您選擇取得 ASA 的成本和功能效益，而不會造成跨站台延遲存取的影響，或是使用主機鄰近功能，讓兩個站台都能存取站台本機讀寫。</block>
  <block id="cb2187a7d951edc5247ba9c129fee8f3" category="paragraph">設定主機鄰近時，路徑會如下所示。</block>
  <block id="277d64d9a84f721cc341e91f0de1dcae" category="inline-image-macro">SnapMirror Active Sync ASA 與鄰近環境的統一網路連線</block>
  <block id="7ee14065ea840a8b3d77ca1b09cd0d68" category="paragraph"><block ref="7ee14065ea840a8b3d77ca1b09cd0d68" category="inline-image-macro-rx" type="image"></block></block>
  <block id="988f5836c7a60d1374a4804da23d51e4" category="paragraph"><block ref="988f5836c7a60d1374a4804da23d51e4" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b7986b8213ecdd63004689cc2dedb163" category="searchtitle">使用 SnapMirror 進行 Microsoft SQL Server 災難恢復</block>
  <block id="f10483e265b11816545d508fc76923ed" category="list-text">使用同步複寫搭配 SnapMirror 主動式同步，以滿足快速資料恢復的需求，而非同步解決方案則可在 RPO 中提供靈活彈性。</block>
  <block id="76deb86c7bf1ea33d737ef060d9ffff6" category="list-text">如果您使用 SnapCenter 來備份資料庫並將快照複寫到遠端叢集，請勿排程控制器的 SnapMirror 更新以確保一致性。而是在完整備份或記錄備份完成後、從 SnapCenter 啟用 SnapMirror 更新以更新 SnapMirror 。</block>
  <block id="ad2a53b49c8e7cc0e22f4346908a1866" category="list-text">平衡叢集中不同節點之間包含 SQL Server 資料的儲存單元，以允許所有叢集節點共用 SnapMirror 複寫活動。此套裝作業系統可最佳化節點資源的使用。</block>
  <block id="98b161980bf5831bfe65c048b46d0439" category="summary">ASA 上的 Microsoft SQL Server 資料庫檔案放置位置</block>
  <block id="1b1b4c822e9c1b28b845dcc038fec08e" category="searchtitle">Microsoft SQL Server 資料庫檔案和檔案群組</block>
  <block id="ba25a3e50659c5e29996ff4f5d42a259" category="paragraph">記錄目錄是在 SQL Server 中指定、用於在主機層級儲存交易記錄備份資料。如果您使用 SnapCenter 來備份記錄檔、則 SnapCenter 使用的每個 SQL Server 主機都必須設定一個主機記錄目錄、才能執行記錄備份。</block>
  <block id="c05ca2066a3b729016e386c067cd91b4" category="paragraph">將記錄目錄放在專用儲存單元上。主機記錄目錄中的資料量取決於備份的大小和保留備份的天數。SnapCenter 每個 SQL Server 主機只允許一個主機記錄目錄。您可以在 SnapCenter --&gt; 主機 --&gt; 組態外掛程式中設定主機記錄目錄。</block>
  <block id="74432d98a78bf2e3e3b497b91dc1c516" category="list-text">在 SnapCenter 複製交易記錄的專用儲存單元上建立主機記錄目錄。</block>
  <block id="00b0277b7e21cfea83e1cd6202498b9e" category="list-text">如果您使用的是 Always on 容錯移轉叢集執行個體，則用於主機記錄目錄的儲存單元必須是與在 SnapCenter 中備份的 SQL Server 執行個體位於同一個叢集群組中的叢集磁碟資源。</block>
  <block id="c42f502d6a45acd6c1d2a13f44016270" category="summary">ASA 系統上的 Microsoft SQL Server 儲存考量</block>
  <block id="e7a0b265e1ae7c0bf7047bd4770bc53d" category="paragraph">NetApp ASA R2 為僅限執行關鍵任務工作負載的 SAN 客戶，提供簡化且功能強大的解決方案。執行 ONTAP 儲存解決方案的 ASA R2 平台與 Microsoft SQL Server 的結合，可實現企業級資料庫儲存設計，滿足現今最嚴苛的應用程式需求。</block>
  <block id="95cc7be66d78a646c5ee563f83198ab4" category="paragraph">下列 ASA 平台歸類為支援所有 SAN 傳輸協定（ iSCSI ， FC ， NVMe / FC ， NVMe / TCP ）的 ASA R2 系統。iSCSI ， FC ， NVMe / FC 和 NVMe / TCP 傳輸協定支援對稱的雙主動式架構，可執行多重路徑，讓主機和儲存設備之間的所有路徑都處於主動 / 最佳化狀態：</block>
  <block id="5d6a7459a3583d9e29f4b486d809b6a1" category="list-text">ASA A1K</block>
  <block id="009f19d7e9e80eda1c7dbf7374519e58" category="list-text">ASA A90</block>
  <block id="cd527b2aadf2bebf28ba082002724ab0" category="list-text">ASA A70</block>
  <block id="3ee9bc9a210bd85fa921ca63bdeef612" category="list-text">ASA A50</block>
  <block id="e21bdbd552261278be0a5ad02fbc6fa7" category="list-text">ASA A30</block>
  <block id="3c609b480f1311eaec9774146ac50e79" category="list-text">ASA A20</block>
  <block id="2b304856171196502641312a496c6d54" category="inline-link-macro">NetApp ASA</block>
  <block id="4dd59f71d7cf036df0941aa4fcd50443" category="paragraph">如需詳細資訊、請參閱 <block ref="a37d9d52d65391d0ce6c582426431be1" category="inline-link-macro-rx"></block></block>
  <block id="bb9a4cadd83e3ce26b592d1a9eeafb2e" category="paragraph">在 ONTAP 解決方案上最佳化 SQL Server 需要瞭解 SQL Server I/O 模式和特性。SQL Server 資料庫設計完善的儲存配置必須支援 SQL Server 的效能需求、同時提供整個基礎架構的最大管理能力。良好的儲存配置也能讓初始部署成功、並隨著業務成長、環境隨時間而順利成長。</block>
  <block id="bfdf538d8298e1c20008ee59ebb494a0" category="paragraph">Microsoft 建議將資料和記錄檔放在不同的磁碟機上。對於同時更新和要求資料的應用程式、記錄檔會密集寫入、而且資料檔（視應用程式而定）會密集讀寫。對於資料擷取、不需要記錄檔。因此、您可以從放在自己磁碟機上的資料檔案來滿足資料要求。</block>
  <block id="801afe45de7db517b57f747a8973280a" category="section-title">儲存單元考量</block>
  <block id="5e64d69892f623826e85a5239abf0607" category="paragraph">ASA 中的儲存單元是指 SCSI/FC 主機的 LUN ，或 NVMe 主機的 NVMe 命名空間。根據支援的傳輸協定，系統會提示您建立 LUN ， NVMe 命名空間或兩者。在您建立資料庫部署的儲存單元之前，請務必瞭解 SQL Server I/O 模式和特性的差異，視工作負載及備份與還原需求而定。請參閱下列儲存單元的 NetApp 建議：</block>
  <block id="506a88168c6bdfeb32f8fae8409c1eba" category="list-text">避免在同一主機上執行的多個 SQL Server 之間共用相同的儲存單元，以避免複雜的管理作業。在同一主機上執行多個 SQL Server 執行個體的情況下，除非您接近節點上的儲存單元限制，否則請避免共用，而每個主機的每個執行個體都有個別的儲存單元，以便於資料管理。</block>
  <block id="3c00c0b1042b695af03e498424f2ee1e" category="list-text">請使用 NTFS 掛載點而非磁碟機代號、以超越 Windows 中 26 個磁碟機代號的限制。</block>
  <block id="216443bb5f5d2545cc1881816458e899" category="list-text">停用快照排程和保留原則。而是使用 SnapCenter 來協調 SQL Server 資料儲存單元的 Snapshot 複本。</block>
  <block id="44d48620d1d725aaad54d642f73970a9" category="list-text">將 SQL Server 系統資料庫放在專用的儲存單元上。</block>
  <block id="5375f513e791de754ec7d070bbf5512c" category="list-text">Tempdb 是 SQL Server 用來做為暫用工作區的系統資料庫，特別是用於 I/O 密集型 DBCC CHECKDB 作業。因此，請將此資料庫放在專用的儲存單元上。在儲存單元數是一項挑戰的大型環境中，您可以在仔細規劃之後，將 tempdb 與系統資料庫整合到同一個儲存單元中。對 tempdb 的資料保護不是高優先順序、因為每次重新啟動 SQL Server 時都會重新建立此資料庫。</block>
  <block id="5b2b825a890a5ed31984f174b5420a05" category="list-text">將使用者資料檔案放<block ref="937f38432beb92fdba3d47780720bdf7" prefix="(" category="inline-code"></block>在不同的儲存單元上，因為它們是隨機讀取 / 寫入工作負載。建立交易記錄備份的頻率通常高於資料庫備份。因此<block ref="cb15b9539ae0d984ff8740c68b52561c" prefix="(" category="inline-code"></block>，請將交易記錄檔放在不同的儲存單元或 VMDK 上，以建立每個儲存單元的獨立備份排程。這種分隔方式也能將記錄檔的連續寫入I/O與資料檔案的隨機讀寫I/O隔離、大幅提升SQL Server效能。</block>
  <block id="892e3db84641b51931ab0dac9977d1bf" category="list-text">請確定要儲存記錄備份的使用者資料庫檔案和記錄目錄位於不同的儲存單元上，以防止保留原則在將快照與 SnapMirror 功能搭配資料保險箱原則使用時覆寫快照。</block>
  <block id="d3bcdc884b8b6c9a2e038e5aca8eb201" category="list-text">請勿在同一個儲存單元上混合使用資料庫和非資料庫檔案，例如全文搜尋相關檔案。</block>
  <block id="c7b140168b3cdc8eaaa3041ffa0d954a" category="list-text">將資料庫次要檔案（作為檔案群組的一部分）放置在不同的儲存單元上，可改善 SQL Server 資料庫的效能。只有當資料庫的檔案未與任何其他檔案共用其儲存單元<block ref="937f38432beb92fdba3d47780720bdf7" prefix=" " category="inline-code"></block>時，此分隔才有效<block ref="937f38432beb92fdba3d47780720bdf7" prefix=" " category="inline-code"></block>。</block>
  <block id="47d411a79b7445f424218bb5a6265a1a" category="list-text">在 Windows 伺服器中使用磁碟管理程式格式化磁碟時，請確定分割區的分配單元大小設為 64K 。</block>
  <block id="b1d3c04670a31b00b47ed2f54cef4f19" category="list-text">請勿將使用者資料庫或系統資料庫放置在裝載點的儲存單元上。</block>
  <block id="995050bacc63636e91e211836cab350a" category="list-text">如果您使用的是 Always on 容錯移轉叢集執行個體，則使用者資料庫必須放置在跨 Windows 伺服器容錯移轉叢集節點共用的儲存單元上，而且實體磁碟叢集資源會指派給與 SQL Server 執行個體相關聯的叢集群組。</block>
  <block id="79b0cf2c987928face3999e45504752c" category="sidebar">AFF / FAS 系統上的儲存組態</block>
  <block id="120f8cb87e8ceb36804a526419a5803a" category="sidebar">AFF / FAS 系統上的 Microsoft SQL Server</block>
  <block id="fc5b2b3c5350dcd6f3cc1cc3cdf1a13f" category="sidebar">ASA R2 系統上的儲存組態</block>
  <block id="8bdbdec629db36efc1c9bdbf743dd56a" category="sidebar">ASA 系統上的 Microsoft SQL Server</block>
  <block id="3e2b4674c9afc41f9c3a0311b458ed23" category="list-text">如果磁碟區和（或） LUN 並未精簡配置，您必須停用所有效率設定，因為使用這些功能並不會節省成本，而將複雜資源配置與啟用空間效率的組合，可能會導致非預期的行為，包括空間不足的錯誤。</block>
  <block id="c2dc7d465f4be5df7a663820063fe07c" category="summary">Microsoft SQL Server 可用度群組搭配 SnapCenter</block>
  <block id="b474dc2fb6ce60c11ecdfbe0a373bf34" category="doc">SQL Server 可用度群組搭配 SnapCenter</block>
  <block id="0a1151b962e7b34ea7fa78538961cc63" category="paragraph">SnapCenter 支援備份使用 Windows 容錯移轉叢集設定的 SQL Server 可用性群組資料庫。</block>
  <block id="55876228853abf632dec9346a4f372ec" category="inline-link-macro">文件</block>
  <block id="19bc77c28d506c79f4e3acd767956f68" category="paragraph">Microsoft SQL Server 的 SnapCenter 外掛程式必須安裝在 Windows 伺服器容錯移轉叢集的所有節點上。請參閱<block ref="7ea17b48fc658598752bd1b70818d0c2" category="inline-link-macro-rx"></block>先決條件和設定 SnapCenter 外掛程式的步驟。</block>
  <block id="878026ceb11256fd34df776a768794b2" category="paragraph">SnapCenter 會探索 Windows 主機中的所有資料庫，執行個體和可用度群組，並在 SnapCenter 資源頁面上列舉資源。</block>
  <block id="feb288d4161a267b78f781ef497c33f6" category="section-title">保護 Always On Availability 群組中的資料庫</block>
  <block id="6493759953e55bc95c88e42046f8c8e1" category="paragraph">可用度群組中的資料庫可透過多種方式受到保護。</block>
  <block id="71903a5ca626286195e8839f74b46627" category="list-text">資料庫層級備份：選取資料庫資源頁面的可用度資料庫，新增包含完整 / 記錄備份的原則，排程備份。無論資料庫角色是主要複本或次要複本， SnapCenter 都會進行備份。您也可以將資料庫新增至資源群組來設定保護。</block>
  <block id="402962f18d83fc2e3da0155e7c85d340" category="list-text">執行個體層級備份：選取執行個體，並根據選取的原則保護執行個體上執行的所有資料庫。所有資料庫，包括執行為主要或次要複本的可用度資料庫，都會使用 SnapCenter 進行備份。也可以將執行個體新增至資源群組來設定保護。</block>
  <block id="4eea6cb4e656587b45ce878e96aced6c" category="list-text">可用度群組層級備份：在設定原則時， SnapCenter 有進階選項可用於可用性群組層級備份。原則中的可用性群組設定可讓使用者選取備份的複本喜好設定。您可以選取主要複本，次要複本或全部複本。預設選項是根據 SQL Server 可用性群組組組態中的備份複本集。</block>
  <block id="df79a1b2903886af697a431a42cecd61" category="paragraph">只有在使用可用性群組層級備份來保護可用性群組資料庫，且不適用於資料庫或執行個體層級備份時， SnapCenter 原則中的可用性群組設定才會套用。</block>
  <block id="2b371d66d8eda6963cd085c7a884f4d7" category="admonition">* NetApp 建議 * 使用可用度層級備份，在 NetApp ONTAP 儲存設備上執行的所有複本之間進行備份。</block>
  <block id="5c0ae1f6e89ffad82dfe5e7773da2fd6" category="section-title">在 SnapCenter 中設定記錄備份</block>
  <block id="b3b9b1046ddf8efb1b774f35855a0d1c" category="paragraph">如果可用性群組是在獨立式 SQL Server 安裝程式上設定，則必須在 Windows 伺服器容錯移轉叢集的每個節點上掛載專用磁碟。應使用專用磁碟來設定記錄目錄，以儲存交易記錄備份。</block>
  <block id="ac3f0583ff584e6a0d60cd070d6edce2" category="paragraph">如果在 SQL Server 容錯移轉叢集上設定可用性群組，則應在 SQL Server 容錯移轉叢集執行個體上建立叢集磁碟，以將其移轉至主機記錄目錄。</block>
  <block id="57194431a839a253461e94f7d15e0d30" category="section-title">使用 SnapCenter 還原可用度群組設定中的資料庫</block>
  <block id="cb66b1b1ce1e9f56d0a1572ba3dcccdd" category="list-text">SnapCenter 提供重新植入選項，可從次複本可用的最新快照中自動恢復資料庫。重新連上的作業會自動還原，並將資料庫備份加入可用性群組。</block>
  <block id="4c25cf6fd81e138392692e0a7e5523f3" category="list-text">在可用性群組中還原複本資料庫的另一種方法是中斷可用性群組並執行完整的完整和記錄還原。使用 SnapCenter 以 NORECOVERY 模式還原資料庫，然後使用 SQL Server Management Studio 或 T-SQL 將資料庫加入可用性群組。</block>
  <block id="533d3de92f8337e84aa0eccec7e4698f" category="list-text">若要只恢復資料子集，可以使用 SnapCenter 的複製功能來建立資料庫的複本。資料庫複本是使用 SnapCenter 在幾分鐘內建立，然後使用 SQL Server 原生工具將資料匯出至主要複本。</block>
  <block id="f652b77e8bd5ef106d3fbeec02a874c5" category="inline-link-macro">TR-4714 使用 NetApp SnapCenter 的 Microsoft SQL Server 最佳實務做法</block>
  <block id="9cc210a8901b58403ed2b299b9f87ac9" category="paragraph">如需設定資料庫儲存配置以符合 RTO 和 RPO 需求的最佳實務做法<block ref="4619ebf0116b8a67a7bd991a2d661c12" category="inline-link-macro-rx"></block>，請參閱。</block>
  <block id="724394156ac637a07abed4b02026424a" category="admonition">SnapCenter 不支援分散式可用性群組和內含可用性群組。</block>
  <block id="f9feae8e1753d6486bf95d4403f7d5a7" category="list-text">請勿在包含 SQL Server 資料檔案的 FAS 上的任何磁碟區上啟用重複資料刪除功能，除非已知該磁碟區包含相同資料的多個複本，例如將資料庫從備份還原至單一磁碟區。</block>
  <block id="3e7987259108445ae7c1491ed79b073d" category="list-text">現在 LUN 名稱為「叢集磁碟」，並顯示為磁碟下的可用儲存設備。</block>
  <block id="c1e7f55d2b03b3e23328dcdcd802d754" category="list-text">在 LUN （「叢集磁碟」）上按一下滑鼠右鍵，然後按一下「 Add to Cluster Shared Volumes 」現在 LUN 顯示為 CSV 。</block>
  <block id="43e27ab0f91db8b4bb59d8e4c4d1e8ed" category="list-text">將 Windows Server ISO 中的 \NanoServer 資料夾中的 NanoServerImageGenerator 資料夾複製到本機硬碟。</block>
  <block id="7e5f3f135d7a8c51734f09f3d5a12050" category="list-text">以系統管理員身分啟動 Windows PowerShell ，瀏覽至本機硬碟上複製的 NanoServerImageGenerator 資料夾，然後執行下列 Cmdlet ：</block>
  <block id="eacb5e0f83e8ccaa90b1b924f6610ac2" category="paragraph">NetApp ONTAP 中的儲存 QoS 可讓您將儲存物件分組，並設定群組的處理量限制。儲存 QoS 可用於限制工作負載的處理量、並監控工作負載效能。有了這項功能、儲存管理員就能依組織、應用程式、業務單位、或正式作業或開發環境來分隔工作負載。</block>
  <block id="34d1a06b342ddf788eb8d311a6a90b0f" category="paragraph">此外，重複資料刪除， NetApp FlexClone （ R ）複本， NetApp 快照技術，精簡配置，壓縮及儲存分層等 NetApp 儲存效率功能，也為在 Windows Server 上執行的工作負載帶來可觀的價值。</block>
  <block id="832d3120e6d9fa2f59f4e48705370613" category="paragraph">將多個節點彙總至叢集式系統。叢集中的節點會持續彼此通訊、以協調叢集活動。節點也可以使用備援路徑，將資料透明地從節點移至節點，以連接由兩個 10Gb 乙太網路交換器組成的專用叢集互連。叢集中的節點可以互相接管、在任何容錯移轉案例中提供高可用度。叢集是在整個叢集上進行管理、而非以每個節點為基礎、而且資料是從一或多個儲存虛擬機器（ SVM ）提供。叢集必須至少有一個 SVM 才能提供資料。</block>
  <block id="7d1f2201f5f9a58716d9d3945ca25236" category="paragraph">叢集的基本單元是節點、節點會新增至叢集、作為高可用度（ HA ）配對的一部分。HA 配對可透過 HA 互連（與專用叢集互連分開）彼此通訊，並維持與 HA 配對磁碟的備援連線，實現高可用度。雖然磁碟櫃可能包含屬於 HA 配對任一成員的磁碟、但磁碟不會在 HA 配對之間共用。下圖說明 Windows Server 環境中的 NetApp 儲存部署。</block>
  <block id="89b1c55fe8e272ac47674f0cc764a248" category="paragraph">NetApp PowerShell Toolkit （ PSTK ）是一個 PowerShell 模組、可提供端點對端自動化、並可讓您管理 ONTAP 的儲存設備。ONTAP 模組包含超過 2 ， 000 個 Cmdlet ，可協助管理 NetApp AFF ， FAS ，市售硬體和雲端資源。</block>
  <block id="511fb782308cb99c53153d22cdb1d521" category="list-text">在 Hyper-V 使用 iSCSI LUN 時，請務必在 Hyper-V 主機的防火牆設定中啟用「 iSCSI Service （ TCP 輸入） for Inbound 」和「 iSCSI Service （ TCP 輸出） for Outbound 」。如此一來、 iSCSI 流量就能往返於 Hyper-V 主機和 NetApp 控制器。</block>
  <block id="faccfad1846422576248770b7a6395e9" category="list-text">使用虛擬光纖通道來佈建 VM 需要啟用 N_Port ID 虛擬化的 FC HBA 。最多支援四個 FC 連接埠。</block>
  <block id="7b0285f3bc080c0c79f477f620f40e9e" category="list-text">有關 FC HBA 的信息，請參閱<block ref="5555d80b97794db0ba7e8564a4b85ca4" category="inline-link-rx"></block>。</block>
  <block id="f00baf160282989fbb1cb808699a6f2a" category="paragraph">Hyper-V 叢集式伺服器（稱為節點）是由實體網路和叢集軟體所連接。這些節點使用共用儲存設備來儲存 VM 檔案，包括組態，虛擬硬碟（ VHD ）檔案和快照。共享儲存設備可以是 NetApp SMB/CIFS 共用區、或是 NetApp LUN 上的 CSV 、如下所示。此共享儲存設備提供一致且分散的命名空間、可由叢集中的所有節點同時存取。因此、如果叢集中有一個節點發生故障、另一個節點會透過稱為容錯移轉的程序來提供服務。您可以使用容錯移轉叢集管理單元和容錯移轉叢集 Windows PowerShell Cmdlet 來管理容錯移轉叢集。</block>
  <block id="111539b465998ea501279f7e74e96c23" category="paragraph">ONTAP 提供 NetApp 儲存效率功能，例如 NetApp 快照技術，複製，重複資料刪除，精簡配置，精簡複寫，壓縮，虛擬儲存分層等，並提供更高的效能與效率。</block>
  <block id="77c4f5b694a7632dd418203c35b28001" category="paragraph">如需完整且定期更新的已測試及支援 SAN 和 NAS 組態對照表，請參閱<block ref="5555d80b97794db0ba7e8564a4b85ca4" category="inline-link-rx"></block> NetApp 支援網站上的。有了 IMT 、您就能判斷特定環境所支援的確切產品和功能版本。NetApp IMT 定義與 NetApp 支援組態相容的產品元件和版本。具體結果取決於每位客戶依照已發佈規格所安裝的產品。</block>
  <block id="5dda25d6b4e823951b5421768be35626" category="paragraph">LUN 的直接路徑是指 SVM 的生命和要存取的 LUN 位於同一個節點上的路徑。若要從實體目標連接埠移至磁碟，就不需要周遊叢集互連。</block>
  <block id="c364dd3fe0de768ba9017fa088c60e25" category="paragraph">間接路徑是指 SVM 的生命與 LUN 位於不同節點上的資料路徑。資料必須周遊叢集互連，才能從實體目標連接埠移至磁碟。</block>
  <block id="2111c0c11662be8bb8715d01b06012e1" category="summary">TR-4792 提供在採用 NVIDIA 圖形處理單元（ GPU ）和虛擬化軟體的 VMware Horizon 環境中，將 NetApp 615C 用於 3D 圖形工作負載的指引。</block>
  <block id="3797bd9f7fdebe600f0b50130ab6e88e" category="doc">適用於 VMware vSphere 9.13 存取點的 ONTAP 工具（使用者）</block>
  <block id="fe3b52cc276d9b4f6ff1d7dd52ebf482" category="doc">適用於 VMware vSphere 9.13 的每位使用者並行要求上限（網路安全保護 /DOS 攻擊） ONTAP 工具</block>
  <block id="999ce5ccae91de7a317d5634f874aaf1" category="doc">ONTAP 工具 9.13 HTTPS 憑證</block>
  <block id="773a7bfeb117dbffddb5069c857898f1" category="doc">驗證 VMware vSphere 9.13 安裝套件的 ONTAP 工具完整性</block>
  <block id="d0190e0d0c684fb3bf0db89bc85d9fa8" category="list-text">瀏覽至「憑證管理 UI ： a. 」。從「首頁」功能表選取「管理」。 b. 在「憑證」下，按一下「憑證管理」。</block>
  <block id="e8783ca43a9865b78e97faa419114d3c" category="doc">ONTAP 工具 9.13 登入橫幅</block>
  <block id="3b3c746ae575763a882807d59864cd91" category="paragraph">使用者在登入提示中輸入使用者名稱後、會顯示下列登入橫幅。請注意， SSH 預設為停用，只有在從 VM 主控台啟用時，才允許一次性登入。</block>
  <block id="5d012d90287d95d6d8add32b5532516f" category="doc">ONTAP 工具 9.13 相互 TLS （憑證型驗證）</block>
  <block id="985cdfe4013537c1d4d5c214f7c0dd0d" category="doc">ONTAP 工具 9.13 的網路時間傳輸協定（ NTP ）組態</block>
  <block id="5b0454dc521b829107eee95fdbdcf609" category="doc">適用於 VMware vSphere 9.13 的 ONTAP 工具安全性強化指南</block>
  <block id="2b7bcb6c5618e904562d6803c126f1fd" category="doc">ONTAP 工具的密碼原則 9.13.</block>
  <block id="00100652bee31d3d3d08d4e151ec666b" category="doc">適用於 ONTAP 工具 9.13 的連接埠和通訊協定</block>
  <block id="db739753b5ca22081d5a70569c187468" category="paragraph">請注意下表列出正確運作 ONTAP 工具所需的輸入和輸出連接埠。請務必確保只開啟表中所述的連接埠、以進行遠端機器的連線、而所有其他連接埠則應封鎖、以進行遠端機器的連線。這將有助於確保系統的安全性。</block>
  <block id="9fbc29d1252118b9f8037064f509bbc6" category="doc">ONTAP 工具的閒置逾時 9.13</block>
  <block id="67119628cfd34ebda11e94844fd8ae42" category="inline-link-macro"><block ref="67119628cfd34ebda11e94844fd8ae42" category="inline-link-rx"></block></block>
  <block id="e1d3de60f7ed9e2b5f5783aa86ff23d8" category="list-text">適用於 VMware vSphere 10.x 資源的 ONTAP 工具<block ref="2a13554f799535d02439d73fba6b8874" category="inline-link-macro-rx"></block></block>
  <block id="430d5e16a0652c5ee12e9434368c8970" category="list-text">適用於 VMware vSphere 9.x 資源的 ONTAP 工具<block ref="9d52dd6d1c195e015d4baef3146522a8" category="inline-link-macro-rx"></block></block>
  <block id="4644d098069796f6576040c27eaa2902" category="inline-link-macro"><block ref="4644d098069796f6576040c27eaa2902" category="inline-link-rx"></block></block>
  <block id="f9b6e9a89bb3e4c6302d8214e9ef8e1f" category="list-text">VMware Live Site Recovery 說明文件<block ref="401159cdbd602df2732f9d02a280896a" category="inline-link-macro-rx"></block></block>
  <block id="0a94bde8cd1434df225de9583026ce2a" category="paragraph">請參閱 NetApp 支援網站上的，<block ref="de89165a46abdf575eb9a1ba0995e131" category="inline-link-macro-rx"></block>以驗證本文件中所述的確切產品和功能版本是否支援您的特定環境。NetApp IMT 解決方案定義了可用於建構NetApp支援組態的產品元件和版本。具體結果取決於每位客戶依照已發佈規格所安裝的產品。</block>
  <block id="92f5dfcc91de805d4d9a5e53648b4d2a" category="section-title">使用最新版的 ONTAP 工具 10</block>
  <block id="1464492cec5287ef61574839a96af5c6" category="paragraph">ONTAP 工具 10 比舊版大幅改善，包括：</block>
  <block id="b87867526ca4f4c733e3ce06f5010124" category="list-text">測試容錯移轉速度加快 8 倍 *</block>
  <block id="27074144cd68d611ee2ff77b05e534c7" category="list-text">清理與重新保護速度加快 2 倍 *</block>
  <block id="3b8fbbed2d84b9255b899aa6e5ca940a" category="list-text">故障切換速度加快 32%*</block>
  <block id="aec894aa3f9e8a2faa2fbdd72e233401" category="list-text">原生支援共用網站配置</block>
  <block id="bee99bc5e766f9e6501e1f77a31daf3b" category="paragraph">這些改進是根據內部測試而定，可能會因您的環境而有所不同。</block>
  <block id="d7d8e8809bed362c1ee6bc2b541e379d" category="list-text">預設的vsadmin SVM帳戶沒有執行ONTAP 各項功能工作所需的存取層級。因此，您需要建立新的 SVM 帳戶。<block ref="4010916266efe7d8b0185d4d2025f808" category="inline-link-rx"></block>使用隨附的 JSON 檔案。這可用於SVM或叢集範圍內的帳戶。</block>
  <block id="87849b3f2b772c5e059e8e32ae26acba" category="list-text">由於 vCenter UI 外掛程式， VASA Provider 和 SRA 伺服器都是完全整合的微服務，因此您必須將儲存設備新增至 SRM 中的介面卡，方法與在 vCenter UI for ONTAP 工具中新增儲存設備的方式相同。否則、SRA伺服器可能無法辨識透過SRA介面卡從SRM傳送的要求。</block>
  <block id="132951122a677efd5c41a88deabeabd8" category="list-text">使用 SVM 範圍的認證時不會執行 NFS 路徑檢查，除非您先<block ref="ea2efd531a0984091e8158139d5ccc0c" category="inline-link-rx"></block>在 ONTAP 工具管理程式中，並將其與 vCenter 相關聯。這是因為實體位置從SVM邏輯上抽象化。不過這並不是令人擔心的問題、因為使用ONTAP 間接路徑時、現代的功能不再受到明顯的效能下降影響。</block>
  <block id="0a1fcbae4c54aa60a8f2fe5671680e27" category="doc">VSR/SRM 和 ONTAP 工具的新功能</block>
  <block id="03a93b2df7509ea17938237f51860034" category="paragraph">NetApp已與VMware建立了近二十年的深厚合作關係、並致力於盡快提供最新版本的支援。請務必查看 NetApp<block ref="5a1370857464a2f4fc64961fad76707f" category="inline-link-rx"></block> ，以取得最新的合格軟體組合。</block>
  <block id="bdbeaf4744c4096d9ca05899a1b20ac6" category="list-text">不支援SRM 8.2（8.1、8.3和8）。支援 4 及更新版本）</block>
  <block id="99d2e422e054ee65d15c388ce83e3aad" category="list-text">請查看<block ref="5a1370857464a2f4fc64961fad76707f" category="inline-link-rx"></block>是否有最新的合格版本。</block>
  <block id="03e80035ff033dbb43bc1cf4dfd27b9d" category="paragraph">工具 10.4 ONTAP 現在可以支援最大的 VSR/SRM 規模。</block>
  <block id="5b71ff881fa46f7d950270720dfba930" category="list-text">受保護虛擬機器總數 = 5000</block>
  <block id="00b46b3bd011b06ddc97d2d87f3f693c" category="list-text">每個保護群組的 VM 數 = 1000</block>
  <block id="f13d5084a9427ce818e051b68dd775de" category="list-text">恢復計畫總數 = 250</block>
  <block id="32037bfb6e7cea15bb8d753bacb8c6f1" category="list-text">每個恢復計畫的保護群組總數 = 250</block>
  <block id="0e10d41896dde55f485a601573eb4cd1" category="list-text">複寫資料存放區總數 = 255</block>
  <block id="9f1fc329126d15e2b5b7ab32cb32d7b5" category="list-text">同時執行恢復計畫的總數。= 10</block>
  <block id="1e1088bfcfb8add5780ae378f2754112" category="paragraph">SRA伺服器組態現在可由REST API管理。我們新增了 Swagger UI 來協助您建置自動化工作流程，您可以在 ONTAP 工具應用裝置上找到，網址為：<block ref="8a609c6f0b4bce52148730c8d12b504f" prefix=" " category="inline-code"></block>。</block>
  <block id="0544f3896fcb77e4b634ce110f6bd9b9" category="list-text">每個站台的SAN傳輸協定應該是同質的。您可以混合使用NFS和SAN、但SAN傳輸協定不應在站台內混合使用。例如，您可以在站台 A 中使用 FCP ，在站台 B 中使用 iSCSI 。您不應在站台 A 同時使用 FCP 和 iSCSI</block>
  <block id="4e3807553eb007466c17fb67a2210f32" category="list-text">先前的指南建議建立 LIF 至資料位置。也就是說、務必使用實體擁有磁碟區的節點上的LIF來掛載資料存放區。雖然這仍是最佳實務做法，但在 ONTAP 9 的現代化版本中，不再需要這麼做。只要可能、而且如果提供叢集範圍的認證、 ONTAP 工具仍會選擇在資料的本機生命體之間平衡負載、但這並不是高可用度或高效能的需求。</block>
  <block id="f48bad2be9e924ec16a98855ffa5205d" category="list-text">ONTAP 9 可設定為自動移除快照、以在自動調整大小無法提供足夠的緊急容量時、在空間不足的情況下保留正常運作時間。此功能的預設設定不會自動刪除 SnapMirror 所建立的快照。如果刪除 SnapMirror 快照、則 NetApp 無法針對受影響的磁碟區進行反向和重新同步複寫。若要防止 ONTAP 刪除 SnapMirror 快照，請將快照自動刪除功能設定為「試用」。</block>
  <block id="9d9eddaf9d0daee09cf623c1a7efe898" category="inline-link-macro">設定磁碟區以自動擴充及縮小其大小</block>
  <block id="cdf854c312fc769dc7a37371e3862cf7" category="list-text">對於包含 SAN 資料存放區和 NFS 資料存放區的磁碟區<block ref="d89f4f8b1d7c18847b88b46142f61535" prefix=" " category="inline-code"></block>，應將 Volume autossize 設為<block ref="4d200fce73a8e1cc965cfc2c43343824" prefix=" " category="inline-code"></block>。有關此主題的詳細信息<block ref="1e69033938f9e72dbed381804139dcb7" category="inline-link-macro-rx"></block>，請參見。</block>
  <block id="0f5c04a3e7eeab838bfbea0da2647014" category="paragraph">複寫群組包含一起還原的虛擬機器邏輯集合。由於SnapMirror複寫是在磁碟區層級進行、因此一個磁碟區中的所有VM都位於相同的複寫群組中。ONTAP</block>
  <block id="5e3d02d3d6c87568b9fb31c561e3c30c" category="paragraph">複寫群組的考量因素有多種、以及如何將VM分散到FlexVol 整個流程區。將類似的 VM 分組在同一個磁碟區中、可以提高儲存效率、因為較舊的 ONTAP 系統缺乏 Aggregate 層級的重複資料刪除功能、但群組會增加磁碟區的大小、並減少磁碟區 I/O 並行處理。在現代 ONTAP 系統中、透過在同一個集合體中跨 FlexVol 磁碟區散佈 VM 、以達到最佳的效能與儲存效率平衡、進而運用彙總層級的重複資料刪除技術、並在多個磁碟區之間取得更高的 I/O 平行化。您可以將磁碟區中的虛擬機器一起還原、因為保護群組（如下所述）可以包含多個複寫群組。此配置的缺點是，由於 SnapMirror 並未將 Aggregate 重複資料刪除納入考量，因此可能會多次透過線路傳輸區塊。</block>
  <block id="63e4890c97de111da0d06968949b7dd9" category="paragraph">例如、您的公司可能擁有第 1 層關鍵業務應用程式、而該應用程式則仰賴 Microsoft SQL Server 來執行其資料庫。因此、您決定將虛擬機器置於優先順序群組1。在優先順序群組1中、您開始規劃訂單以啟動服務。您可能希望 Microsoft Windows 網域控制站在 Microsoft SQL 伺服器之前先開機，這需要在應用程式伺服器之前先上線，依此類推。您可以將所有這些 VM 新增至優先順序群組、然後設定相依性、因為相依性僅適用於指定的優先順序群組。</block>
  <block id="d64567ab52d5b1768fa4574f7913b737" category="paragraph">最佳做法是，每當對受保護的 VM 儲存設備組態進行變更時，請務必執行測試容錯移轉。如此可確保在發生災難時、 Site Recovery Manager 能夠在預期的 RTO 目標內還原服務。</block>
  <block id="440c65ed1c918c9b0812a49f7d368131" category="summary">適用於 VMware Live Site Recovery （ VSR ）和 Site Recovery Manager （ SRM ）的 ONTAP 解決方案</block>
  <block id="05d7c63979cf1697d07b8942ba9871b7" category="doc">VMware Live Site Recovery with ONTAP</block>
  <block id="26f37d417bce4746b39183f7a16780af" category="paragraph">ONTAP 自 2002 年推出現代化資料中心以來，一直是 VMware vSphere 和雲端基礎環境的主要儲存解決方案。它持續推出創新功能，可簡化管理並降低成本。</block>
  <block id="e0982d67f17f6b02d88a0cbc066cd4ae" category="paragraph">本文件著重於最新版 ONTAP 9 中的功能，這些功能搭配適用於 VMware vSphere 10.4 的 ONTAP 工具（包括 NetApp 儲存複寫介面卡 [SRA] 和 VASA 提供者 [VP] ），以及 VMware Live Site Recovery 9 。</block>
  <block id="07f63b028c614758695673e7c08bb043" category="section-title">為何要將 ONTAP 搭配 VSR 或 SRM 使用？</block>
  <block id="785b838a99d90e91a3859239a468a546" category="section-title">VLSR如何運用ONTAP VMware®</block>
  <block id="1625d4b695f746dca5ff4f4c76ddee9c" category="paragraph">VLSR利用ONTAP VMware ONTAP vSphere的進階資料管理技術與VMware vSphere的VMware vSphere工具整合、此虛擬應用裝置包含三個主要元件：</block>
  <block id="69fc564a57c8d57102ff1d2144ad8232" category="list-text">ONTAP 工具 vCenter 外掛程式（前身為虛擬儲存主控台（ VSC ））可簡化儲存管理與效率功能，提升可用度，並降低儲存成本與營運成本，無論您使用的是 SAN 或 NAS 。它採用最佳實務做法來配置資料存放區、並針對NFS和區塊儲存環境最佳化ESXi主機設定。為了獲得所有這些優點、 NetApp 建議在搭配執行 ONTAP 的系統使用 vSphere 時使用此外掛程式。</block>
  <block id="60da32bc0bc08789d91b50e6c1e297c4" category="list-text">ONTAP 工具 VASA Provider 支援 VMware vStorage API for Storage Aware （ VASA ）架構。VASA Provider將vCenter Server與ONTAP VMware連線、以協助資源配置及監控VM儲存設備。這項功能可支援 VMware 虛擬磁碟區（ vVols ），並可管理 VM 儲存原則和個別 VM vVols 效能。它也提供監控容量和設定檔法規遵循的警示。</block>
  <block id="aedad0f692989ea8f930a5704478b317" category="list-text">SRA與VLSR搭配使用、可管理傳統VMFS與NFS資料存放區的正式作業與災難恢復站台之間的VM資料複寫、也可用於災難恢復複本的不中斷測試。它有助於自動化探索、還原及重新保護等工作。其中包括適用於 Windows SRM 伺服器的 SRA 伺服器應用裝置和 SRA 介面卡，以及 VSR 應用裝置。</block>
  <block id="9220276841499e90e16d19b02e4be757" category="paragraph">SRA 為 VSR 伺服器提供命令與控制介面，可管理內含 VMware 虛擬機器（ VM ）的 ONTAP FlexVol 磁碟區，以及保護這些磁碟區的 SnapMirror 複寫。</block>
  <block id="1590566734d497290ef7dec19c83ae27" category="paragraph">如果發生真正的災難、甚至是計畫性的移轉、VLSR可讓您透過最終的SnapMirror更新（如果您選擇這樣做）、將任何最後一分鐘的變更傳送至資料集。然後中斷鏡射、並將資料存放區掛載至DR主機。此時、您的VM可以根據預先規劃的策略、以任何順序自動開機。</block>
  <block id="ad84b24a08fcf7b630aabbaa227285e4" category="admonition">雖然 ONTAP 系統可讓您將同一個叢集中的 SVM 配對，以進行 SnapMirror 複寫，但該案例並未通過 VLSR 的測試和認證。因此，建議您在使用 VLSR 時，僅使用不同叢集的 SVM 。</block>
  <block id="7c4dce5fd159dd8fdded222a89550c4b" category="section-title">VLSR搭配ONTAP 功能完善和其他使用案例：混合雲和移轉</block>
  <block id="8fff56a05881c6f706c3ed3a782050f2" category="paragraph">VLSR也可利用SnapMirror、將VM從一個資料中心有效地傳輸到另一個資料中心、甚至是同一個資料中心內、無論您是自己、或是透過任何數量的NetApp合作夥伴服務供應商、來執行計畫性的移轉作業。</block>
  <block id="d274b8ae04172dec40c6aa0549b00986" category="summary">使用 ONTAP 搭配 SnapMirror ， VMware VSR 和 SRM 的複寫拓撲。</block>
  <block id="08db3b842a4cb2c270982436a350d96f" category="paragraph">單一VM無法在多個VLSR陣列上擁有資料（虛擬機器磁碟（VMDK）或RDM）、原因如下：</block>
  <block id="d8a9d635a5de68d706349e0ba1582a33" category="list-text">VLSR只能看到SVM、而非個別的實體控制器。</block>
  <block id="03a2d94e9dd3faa9d1c2ba5048e50ff5" category="cell">若要判斷可支援性、請謹記此規則：若要使用VLSR和NetApp SRA來保護VM、VM的所有部分都必須只存在於一個SVM上。此規則同時適用於受保護的站台和恢復站台。</block>
  <block id="e30b1ded833744ef423f9c06bfca3bab" category="paragraph">下圖顯示了VLSR和SRA支援的SnapMirror關係配置案例。複寫磁碟區中的每個VM在每個站台只擁有一個VLSR陣列（SVM）上的資料。</block>
  <block id="aefe28ee95511224d6209514d7186d90" category="paragraph">當您在VLSR中使用陣列型複寫（ABR）時、保護群組會隔離為單一陣列配對、如下面的快照所示。在這種情況<block ref="129864522ed0e4ac80f306ecfa130ef7" prefix=" " category="inline-code"></block>下，<block ref="ec87aa7f4c8e70a139fd988f87b6549f" prefix=" " category="inline-code"></block>會與<block ref="387d04b65848414d4697f145a3782f90" prefix=" " category="inline-code"></block><block ref="58bdbfcb72c2dd3d883a7ca754443a4c" prefix=" " category="inline-code"></block>恢復站點進行對等的連接。不過、您只能在建立保護群組時、從兩個陣列配對中選取一個。</block>
  <block id="2e7b54c50f0d287a5bf008ad268a0789" category="paragraph">不受支援的組態在個別VM擁有的多個SVM上有資料（VMDK或RDM）。在以下圖中所示的範例中，<block ref="df777c4d2477e55571925353ce589f7e" prefix=" " category="inline-code"></block>由於有兩個 SVM 上的資料，因此無法使用 VSR 來設定保護<block ref="df777c4d2477e55571925353ce589f7e" prefix=" " category="inline-code"></block>。</block>
  <block id="4fdeeea2f6ee5d6350aa8d922fb0a5af" category="paragraph">任何將個別NetApp磁碟區從一個來源SVM複寫到同一個SVM或不同SVM中的多個目的地的複寫關係、都稱為SnapMirror連出。VLSR不支援連出。在下圖所示的範例中，<block ref="df777c4d2477e55571925353ce589f7e" prefix=" " category="inline-code"></block>無法在 VLSR 中設定保護，因為它會與 SnapMirror 一起複寫到兩個不同的位置。</block>
  <block id="9aaec9a7e35a54378af7cf34a10ff7ad" category="paragraph">VLSR不支援SnapMirror關係的串聯、在這種關係中、來源磁碟區會複寫到目的地磁碟區、而目的地磁碟區也會使用SnapMirror複寫到另一個目的地磁碟區。在下圖所示的案例中、VLSR無法用於任何站台之間的容錯移轉。</block>
  <block id="c37d439a6d3a3437f39236143c5a460a" category="paragraph">NetApp SnapVault 解決方案軟體可在NetApp儲存系統之間、以磁碟形式備份企業資料。可在同一個環境中共存的VMware vCenter和SnapMirror、不過VLSR僅支援SnapMirror關係的容錯移轉。SnapVault</block>
  <block id="79f08fde51df68a19d8383c68f8adebb" category="paragraph">您可以在串聯組態中建立來源Volume、將磁碟區複寫到DR站台的SnapMirror目的地、然後從該磁碟區保存到SnapVault 一個目的地。來源Volume也可建立在連出關係中、其中一個目的地是SnapMirror目的地、另一個目的地SnapVault 是一個目的地。不過、SRA不會在SnapVault 發生VLSR容錯移轉或複寫反轉時、自動重新設定「還原」關係、以使用SnapMirror目的地Volume作為資料庫的來源。</block>
  <block id="4cc1b133c2294fcf3e444666786b490e" category="cell">如果在同一環境中使用 SnapVault 和 VSR ， NetApp 建議您使用 SnapMirror 到 SnapVault 串聯組態，在這種組態中， SnapVault 備份通常是從災難恢復站台的 SnapMirror 目的地執行。發生災難時、此組態會使主要站台無法存取。將SnapVault 還原目的地保留在恢復站台、可在SnapVault 容錯移轉後重新設定還原功能、SnapVault 以便在恢復站台上操作時繼續執行還原備份。</block>
  <block id="28ce1496405d55f61c08746bcc7d2134" category="paragraph">在VMware環境中、每個資料存放區都有通用唯一識別碼（UUID）、而且每個VM都有唯一的託管物件ID（MOID）。在容錯移轉或容錯回復期間、VLSR不會維護這些ID。由於VLSR在容錯移轉期間不會維護資料存放區UUID和VM MOID、因此在VLSR容錯移轉之後、任何依賴這些ID的應用程式都必須重新設定。例如NetApp Active IQ Unified Manager 解決方案就是應用程式、它可協調SnapVault vSphere環境中的功能複寫。</block>
  <block id="36021caed35d3ff177cae271cf95e17f" category="paragraph">下圖說明使用VLSR將SnapMirror複寫還原回主要站台之後的組態。環境也經過重新設定、SnapVault 使目前的SnapMirror來源產生了不支援的資料。此設定為SnapMirror SnapVault 的橫向風扇組態。</block>
  <block id="b352b28b9db88c716b387eac7bfd478e" category="paragraph">在 vsrm 執行容錯回復並再次反轉 SnapMirror 關係之後，正式作業資料會回到主要站台。此資料現在的保護方式與容錯移轉至DR站台之前相同、透過SnapMirror和SnapVault 還原備份。</block>
  <block id="0df9db9c3f8671a5c3e32d66c594a54d" category="paragraph">qtree是允許應用NAS檔案系統配額的特殊目錄。利用SnapMirror複寫的磁碟區中、能夠建立qtree和qtree。ONTAP不過、SnapMirror不允許複寫個別qtree或qtree層級的複寫。所有SnapMirror複寫僅位於磁碟區層級。因此、NetApp不建議搭配VLSR使用qtree。</block>
  <block id="5c7eaf04fc264c6082cadf5fd01b4cd3" category="paragraph">VMware VLSR和NetApp SRA支援在一個站台使用FC傳輸協定、在另一個站台使用iSCSI傳輸協定。不過、它不支援在同一個ESXi主機或同一個叢集中的不同主機上混合使用FC附加資料存放區和iSCSI附加資料存放區。VLSR不支援此組態、因為在VLSR容錯移轉或測試容錯移轉期間、VLSR會在要求中包含ESXi主機中的所有FC和iSCSI啟動器。</block>
  <block id="612460a6891d7eecad16636b2ccd03ec" category="cell">VLSR和SRA支援受保護站台與恢復站台之間的混合FC和iSCSI傳輸協定。不過、每個站台只能設定一個FC或iSCSI傳輸協定、而非在同一個站台設定兩個傳輸協定。如果要求在同一個站台同時設定FC和iSCSI傳輸協定、NetApp建議某些主機使用iSCSI、而其他主機則使用FC。在此情況下、NetApp也建議設定VLSR資源對應、以便將VM設定為容錯移轉至一組主機或另一組主機。</block>
  <block id="2fc50e10e291654a0ac526fdd9d85edd" category="doc">使用 VVols 複寫時疑難排解 VSRM/SRM</block>
  <block id="3d0b50d268649e9f201008e1735764c1" category="paragraph">當使用 ONTAP 工具 9.13P2 時，使用 VVols 複寫時， VSR 和 SRM 中的工作流程與使用 SRA 和傳統資料存放區的工作流程大不相同。例如、沒有Array Manager概念。因此，<block ref="0ec64480a9620a1430c0ae1b6603ea01" prefix=" " category="inline-code"></block>和<block ref="ba6c59072f543cb828e47d5bac560371" prefix=" " category="inline-code"></block>命令永遠不會出現。</block>
  <block id="36c0e0bf3cbce9baff381f0038982596" category="inline-link">Omnissa Horizon View</block>
  <block id="713e31d24f394517ddb2727e75ad1c07" category="list-text">使用vSphere API進行vSphere複製與移轉–陣列整合（VAAI）。VM 複製作業可在 SAN 和 NAS 環境中卸載至 ONTAP （ NetApp 提供 ESXi 外掛程式以啟用 VAAI for NFS ）。 vSphere 只會卸載 NAS 資料存放區中冷（關閉電源） VM 上的作業，而熱 VM （複製和 Storage VMotion ）上的作業也會卸載至 SAN 。ONTAP 採用最有效率的來源和目的地方法。此功能也可由<block ref="d752e276b58b6c367f27570fc3212480" category="inline-link-rx"></block>使用。</block>
  <block id="f6f2c5686cc4f0cddb9b97a821855375" category="list-text">SRA （與 VMware Live Site Recovery/Site Recovery Manager 搭配使用）。在此、複本可用來在不中斷營運的情況下測試災難恢復複本的還原。</block>
  <block id="ab145b0c5bc936679238040b42d242a8" category="list-text">使用SnapCenter NetApp工具（如VMware）進行備份與恢復。VM 複本可用來驗證備份作業，以及掛載 VM 備份，以便還原個別檔案。</block>
  <block id="b1fd904929f16090f01753d2728346c6" category="paragraph">VMware、NetApp及協力廠商工具可叫用不需載入的複製。ONTAP卸載至ONTAP 不完整的複本有多項優點。在大多數情況下、它們都能節省空間、只需要儲存設備來變更物件；讀取和寫入時不會產生額外的效能影響、在某些情況下、透過在高速快取中共用區塊來改善效能。此外、也會從ESXi伺服器卸載CPU週期和網路I/O。使用 FlexVol volume 在傳統資料存放區內進行複製卸載，可透過 FlexClone 授權（包含在 ONTAP One 授權中）快速有效，但 FlexVol 磁碟區之間的複本速度可能較慢。如果您將VM範本保留為複製來源、請考慮將其放在資料存放區磁碟區內（使用資料夾或內容程式庫來組織它們）、以獲得快速且具空間效益的複本。</block>
  <block id="706253931ccf2225bbabb539eead1ee1" category="paragraph">ONTAP 9.8 搭配適用於 VMware vSphere 9.8% 至 9.13 的 ONTAP 工具，以及適用於 VMware 4.4 及更新版本的 SnapCenter 外掛程式，新增了對 vSphere 中 FlexGroup Volume 備份資料存放區的支援。FlexGroup Volume 可簡化大型資料存放區的建立、並在 ONTAP 叢集上自動建立必要的分散式組成磁碟區、讓 ONTAP 系統發揮最大效能。</block>
  <block id="fea36c6d0158f7614a47593cee5c4381" category="paragraph">如果您需要具備完整 ONTAP 叢集功能的單一可擴充 vSphere 資料存放區，或是擁有非常龐大的複製工作負載，而這些工作負載可透過持續保持複製快取的溫控，從 FlexGroup 複製機制中獲益，請將 FlexGroup Volume 搭配 vSphere 一起使用。</block>
  <block id="4b2e7f21f2ab284dbe47715a088a87e4" category="paragraph">除了針對 vSphere 工作負載進行廣泛的系統測試之外、 ONTAP 9.8 也為 FlexGroup 資料存放區新增了複本卸載機制。這套新系統使用改良的複製引擎、在背景中的成員之間複寫檔案、同時允許存取來源和目的地。然後使用這種組成本機快取，根據需要快速產生 VM 複本。</block>
  <block id="a8abf0cad71a45472969fad71143d9b0" category="inline-link">如何設定 ONTAP FlexGroup 磁碟區以允許 VAAI 複本卸載</block>
  <block id="c53113221d1d9379aed8b77f57224f6d" category="paragraph">若要啟用 FlexGroup 最佳化複本卸載，請參閱<block ref="fbd3cc38c04df5a782d56a4261d462a4" category="inline-link-rx"></block></block>
  <block id="dd2b1d725ccce54064350ab418850836" category="paragraph">如需搭配 VAAI 使用 FlexGroup Volume 的詳細資訊，請參閱此知識庫文章：<block ref="23db52497ce446299e31ecc0b7572649" category="inline-link-rx"></block></block>
  <block id="b66d69c6b478b422763ae8a4362fd4cc" category="paragraph">請注意， VMware vSphere 會將 NFS 資料存放區的所有 IO 視為每個主機的單一佇列，而一個 VM 上的 QoS 節流會影響該主機同一資料存放區中其他 VM 的效能。這與 vVols 形成對照、 vVols 可在移轉至其他資料存放區時維持其 QoS 原則設定、並在節流時不會影響其他 VM 的 IO 。</block>
  <block id="55fcf4f8582fc20cbc496c8370d02a9f" category="list-text">VMware 和 NetApp 支援從 ONTAP 9.14.1 開始的 NFSv4.1 工作階段主幹。如需特定版本詳細資料，請參閱 NetApp NFS 4.1 互通性對照表工具（ IMT ）注意事項。NFSv3 不支援多個實體路徑到一個 Volume 、但支援從 vSphere 8.0U2 開始的 nconnect 。有關 nconnect 的詳細資訊<block ref="2b967deae9aa9df284273d8dd1c4a3f3" category="inline-link-macro-rx"></block>，請參閱。</block>
  <block id="692b0504520eb51f2f7e36bb610ab39c" category="list-text">使用適用於VMware VAAI的NFS外掛程式進行複本卸載。請注意、雖然如前所述、在 FlexGroup 資料存放區內增強複製功能、但在 FlexVol 和 / 或 FlexGroup 磁碟區之間複製 VM 時、 ONTAP 並未提供與 ESXi 主機複本相比的顯著效能優勢。因此，在決定使用 VAAI 或 FlexGroup 磁碟區時，請考慮您的複製工作負載。修改組成磁碟區數量是最佳化 FlexGroup 型複製的一種方法。如同調整先前提到的快取逾時。</block>
  <block id="7e6aa8006e5e8e08a135d46ba03f7aca" category="list-text">使用適用於 VMware vSphere 9.8% 至 9.13 的 ONTAP 工具，使用 ONTAP 度量（儀表板和 VM 報告）來監控 FlexGroup VM 的效能，並在個別 VM 上管理 QoS 。目前無法透過ONTAP REST指令或API取得這些指標。</block>
  <block id="b8ed23c8b817e9613412fc97543a876a" category="list-text">如果您使用 fpolicy ，請務必排除 .lck 檔案，因為每當 VM 開機時， vSphere 都會使用這些檔案來鎖定。</block>
  <block id="d76b03755162bf8402fea0ef97d95c2b" category="list-text">如需支援所需的特定 ESXi 修補程式層級，請參閱中的 NFS v4.1 互通性表附註<block ref="aaa18d9ccb38f09094f0c241a8585efd" category="inline-link-macro-rx"></block>。</block>
  <block id="2e5d8aa3dfa8ef34ca5131d20f9dad51" category="inline-link-macro">設定</block>
  <block id="428a818039f2f00961fdd9e4de07b721" category="inline-link">VMware知識庫386364</block>
  <block id="e43e8e9d4a1f6f9dbd56154ac2df4c6a" category="list-text">如中所述<block ref="5c427f7294fd54c254262776a96b148a" category="inline-link-macro-rx"></block>，如果您不使用 vSphere CSI for Kubernetes ，則應設定 newSyncInterval per<block ref="e3529737a3b4eef7cff2c05dcd47fcdc" category="inline-link-rx"></block></block>
  <block id="686d950560445531708a511e6ad1567c" category="paragraph">在 vSphere 中，有四種使用區塊儲存裝置的方法：</block>
  <block id="8f3179360beae87966e6fc5f46edfb7b" category="list-text">做為 vVols 資料存放區</block>
  <block id="041c0652f0218403d2721d2ddd9260df" category="admonition">extents 是 vSphere 儲存概念，您可以將多個 LUN 「拼接」在一起，以建立單一較大的資料存放區。切勿使用範圍來達到所需的資料存放區大小。單一 LUN 是 VMFS 資料存放區的最佳實務做法。</block>
  <block id="9d6605bbb339340832866d8bab7bf7e5" category="paragraph">vSphere 內建支援多個儲存裝置路徑。 vSphere 可偵測支援儲存系統的儲存裝置類型，並自動設定多重路徑堆疊，以支援使用中儲存系統的功能，所使用的傳輸協定的完整版本，或是使用 ASA ， AFF ， FAS 或軟體定義的 ONTAP 。</block>
  <block id="4dbfcd0fae38bf4e35602557a83d9ea3" category="paragraph">vSphere 和 ONTAP 都支援非對稱邏輯單元存取（ ALUA ），可為光纖通道和 iSCSI 建立主動 / 最佳化和主動 / 非最佳化的路徑，以及使用 NVMe / FC 和 NVMe / TCP 的非對稱命名空間存取（ ANA ）。在 ONTAP 中， ALUA 或全日空最佳化路徑會使用位於要存取之 LUN 或命名空間的節點上的目標連接埠，沿著直接資料路徑前進。在 vSphere 和 ONTAP 中， ALUA/ANA 預設為開啟。vSphere 中的多重路徑軟體可將 ONTAP 叢集識別為 ALUA 或 ANA ，並使用適當的原生外掛程式搭配循環資源負載平衡原則。</block>
  <block id="c35f72eea36b7f94209ed29c1e457501" category="paragraph">使用 NetApp 的 ASA 系統， LUN 和命名空間會呈現給具有對稱路徑的 ESXi 主機。這表示所有路徑都是主動且最佳化的。vSphere 中的多重路徑軟體可將 ASA 系統辨識為對稱，並使用適當的原生外掛程式搭配循環負載平衡原則。</block>
  <block id="719d3c21fd388bea9bc6e0ae1f7aead3" category="admonition">如需最佳化的多重路徑設定，請參閱<block ref="1f38ac07598dbb4b06912539aafa4211" category="inline-link-macro-rx"></block>。</block>
  <block id="ab0394f516e490b8b46d91283e6b9f4f" category="paragraph">ESXi 不會看到任何超出其限制的 LUN ，命名空間或路徑。在更大ONTAP 的實體叢集中、可以在LUN限制之前達到路徑限制。為了解決此限制、ONTAP 支援8.3版及更新版本中的選擇性LUN對應（SLM),</block>
  <block id="43a4405ebd9c78d08e6cdf383a650243" category="paragraph">對於向指定LUN通告路徑的節點、SLM會有限制。NetApp 最佳做法是每個 SVM 每個節點至少有兩個生命期，並使用 SLM 來限制通告給裝載 LUN 及其 HA 合作夥伴之節點的路徑。雖然存在其他路徑、但預設不會通告這些路徑。您可以使用新增和移除在SLMs中的報告節點引數來修改通告的路徑。請注意、在 8.3 之前版本中建立的 LUN 會通告所有路徑、而且需要修改以僅通告主控 HA 配對的路徑。有關 SLM 的詳細信息，請參閱第 5.9 節<block ref="a2bae1e6a9d1ce7703c1f95bb6ec1d6e" category="inline-link-rx"></block>（英文）。先前的連接埠集方法也可用於進一步減少LUN的可用路徑。PortSets可減少igroup中的啟動器可透過哪些可見路徑來查看LUN、進而提供協助。</block>
  <block id="b05dc829eda4798f22045fd6851afaaf" category="list-text">對於在 Data ONTAP 8.3 之前建立的 LUN ，請執行命令來移除 LUN 報告節點，並限制 LUN 存取 LUN 所屬節點及其 HA 合作夥伴，以手動套用 SLM<block ref="886fd385b633a0746a8a08f8f00c67cd" prefix=" " category="inline-code"></block> 。</block>
  <block id="b0bdc1022637913a5e63f708d401c7dd" category="paragraph">SCSI 型區塊傳輸協定（ iSCSI ， FC 和 FCoE ）會使用 LUN ID 和序號以及唯一名稱來存取 LUN 。FC 和 FCoE 使用全球名稱（ WWNN 和 WWPN ），而 iSCSI 則使用 iSCSI 合格名稱（ IQN ），根據 LUN 建立路徑，以根據 PortSet 和 SLM 篩選的 igroup 對應。NVMe 型區塊傳輸協定是透過將具有自動產生命名空間 ID 的命名空間指派給 NVMe 子系統來管理，並將該子系統對應至主機的 NVMe 合格名稱（ NQN ）。無論 FC 或 TCP 為何， NVMe 命名空間都會使用 NQN 來對應，而非 WWPN 或 WWNN 。然後，主機會建立軟體定義控制器，讓對應的子系統存取其命名空間。ONTAP 內部的 LUN 和命名空間路徑對區塊傳輸協定毫無意義，而且不會出現在傳輸協定的任何位置。因此、只包含LUN的磁碟區根本不需要內部掛載、而包含資料存放區所用LUN的磁碟區則不需要使用交會路徑。</block>
  <block id="274b68192b056e268f128ff63bfcd4a4" category="cell">不適用</block>
  <block id="582afacce7e9a2be95f7ef78c502a227" category="cell">每部主機 256 個 NFS 連線（受 nconnect 和工作階段主幹傳輸影響）預設 NFS 。最大磁碟區為8。使用VMware vSphere的VMware vSphere功能將其提升至256個。ONTAP</block>
  <block id="10a941de93465e9a6eee9a21f0334c73" category="cell">300TB FlexVol 以上的穩定區塊（含FlexGroup 不穩定區）</block>
  <block id="5567896b478134e909968961c6a17720" category="cell">即時站台恢復 / 站台恢復管理程式</block>
  <block id="9ec9fe6b9d42732de69c5f1b252be1db" category="cell">ONTAP 快照</block>
  <block id="ddf9393cfd2f44676f3a0bce71fc55e0" category="cell">啟用 SnapCenter 和 VADP 的備份軟體</block>
  <block id="a383dfc926e414528d11cef825a5dbf3" category="cell">啟用 SnapCenter 和 VADP 的備份軟體， vSphere Client 和 vSphere Web Client 資料存放區瀏覽器</block>
  <block id="f44de200e9dad7356d95c3b2b370d3ef" category="cell">SnapCenter 和 VADP 備份軟體，僅限 Windows</block>
  <block id="ff9f148c8b974c820cc302f7190a7533" category="cell">啟用 SnapCenter 和 VADP 的備份軟體和協力廠商應用程式</block>
  <block id="920ab17e6978a5f8b455022d3ec15080" category="paragraph">^1^ * NetApp 建議 * 在 Microsoft 叢集中使用來賓 iSCSI ，而非在 VMFS 資料存放區中使用啟用多寫入器的 VMDK 。Microsoft 和 VMware 完全支援這種方法，可提供 ONTAP （ SnapMirror 到 ONTAP 系統內部部署或雲端）的絕佳彈性，易於設定和自動化，並可透過 SnapCenter 加以保護。 vSphere 7 新增了叢集式 VMDK 選項。這與啟用多寫入器的 VMDK 不同，後者需要啟用叢集式 VMDK 支援的 VMFS 6 資料存放區。其他限制也適用。如需組態準則，請參閱 VMware <block ref="46658ede14d15d79e2a20c75a7b15bb2" category="inline-link-macro-rx"></block>文件。</block>
  <block id="1c39c1dd8f654eedbd266d325b8b2bfe" category="paragraph">執行 ONTAP 的系統支援所有主要儲存傳輸協定、因此客戶可以根據現有和計畫中的網路基礎架構和員工技能、選擇最適合其環境的方案。過去， NetApp 測試通常顯示，以類似線路速度執行的通訊協定與連線數量之間的差異不大。不過， NVMe （ NVMe / TCP 和 NVMe / FC ）顯示 IOPS 顯著提升，延遲縮短，儲存 IO 的主機 CPU 使用量減少達 50% 或更多。在另一端， NFS 可提供最大的靈活度和管理簡易性，尤其是對大量 VM 而言。所有這些通訊協定都可以使用適用於 VMware vSphere 的 ONTAP 工具來使用和管理，這項工具提供了一個簡單的介面來建立和管理資料存放區。</block>
  <block id="a057cf188c3e7763e47d59ffd633784e" category="list-text">* 目前的作業環境。 *雖然 IT 團隊通常擅長管理乙太網路 IP 基礎架構，但並非所有團隊都擅長管理 FC SAN 架構。但是、使用非專為儲存流量設計的通用 IP 網路可能無法正常運作。請考量您所擁有的網路基礎架構、任何計畫性的改善、以及員工管理這些基礎架構的技能和可用度。</block>
  <block id="03acb8fd56768c1827623c3c7e78f5ad" category="list-text">* 易於管理。 *使用 SAN 傳輸協定時，如果需要更多空間，就必須採取幾個步驟，包括擴充 LUN ，重新掃描以探索新的大小，然後擴充檔案系統）。雖然 LUN 的規模可以增加，但 LUN 的大小卻無法減少。NFS可輕鬆調整規模或縮減規模、儲存系統也能自動調整大小。SAN 可透過來賓作業系統 DEALLOCATE/TRIM / 取消對應命令來提供空間回收，讓已刪除檔案的空間傳回陣列。這種類型的空間回收對於 NFS 資料存放區來說並不困難。</block>
  <block id="2153785b657110dbec7bac0a2931c4b0" category="paragraph">可靈活建立VM和虛擬磁碟的資料存放區。ONTAP雖然在使用 ONTAP 工具為 vSphere 佈建資料存放區時會套用許多 ONTAP 最佳實務做法（列於一節<block ref="2e24324ebf41be836715e1e0dd648f4f" category="inline-link-macro-rx"></block>），但以下是一些額外的準則可供考量：</block>
  <block id="4179f1498130aa878933f74dbe16642c" category="list-text">部署vSphere搭配ONTAP 使用不間斷的NFS資料存放區、可實現高效能且易於管理的實作、提供VM對資料存放區的比率、而這些比率無法透過區塊型儲存傳輸協定取得。此架構可減少相關資料存放區數量、使資料存放區密度增加十倍。雖然較大的資料存放區可以提高儲存效率並提供營運效益，但請考慮每個節點至少使用四個資料存放區（ FlexVol Volume ），將 VM 儲存在單一 ONTAP 控制器上，以便從硬體資源獲得最大效能。此方法也可讓您建立具有不同恢復原則的資料存放區。根據業務需求、部分備份或複寫的頻率可能會比其他更高。由於資料存放區FlexGroup 是依設計進行擴充、因此不需要使用多個資料存放區來提升效能。</block>
  <block id="1bce4f9db0fda9ee171dac82c454e8f5" category="list-text">* NetApp 建議 * 將 FlexVol Volume 用於大多數 NFS 資料存放區。從 ONTAP 9.8 FlexGroup 磁碟區開始、也支援作為資料存放區使用、一般建議在某些使用案例中使用。一般不建議使用其他 ONTAP 儲存容器、例如 qtree 、因為目前 VMware vSphere 的 ONTAP 工具或 VMware vSphere 的 NetApp SnapCenter 外掛程式都不支援這些容器。</block>
  <block id="6826e55696449edeff52e813c25cad54" category="list-text">適用於不只FlexVol 4TB、更能滿足8TB的需求。這種規模對於效能、管理簡易性和資料保護來說、是一個很好的平衡點。從小規模開始（例如4TB）、視需要擴充資料存放區（最高300TB）。較小的資料存放區可更快從備份或災難後恢復、並可在叢集之間快速移動。請考慮使用ONTAP 不同步自動調整大小、以便在使用空間變更時自動擴充及縮小磁碟區。VMware vSphere 資料存放區資源配置精靈的 ONTAP 工具預設會針對新的資料存放區使用自動調整大小。您可以使用System Manager或命令列、進一步自訂「成長」和「縮減」臨界值、以及最大和最小大小。</block>
  <block id="0546b812db9e807a7b499d48c3af08ef" category="list-text">此外， VMFS 資料存放區也可以使用 LUN 或 NVMe 命名空間（在新的 ASA 系統中稱為儲存單元）進行設定，這些名稱空間可由 FC ， iSCSI ， NVMe / FC 或 NVMe / TCP 存取。VMFS 可讓叢集中的每個 ESX 伺服器同時存取資料存放區。VMFS資料存放區的大小最多可達64TB、最多可包含32個2TB LUN（VMFS 3）或單一64TB LUN（VMFS 5）。AFF ， ASA 和 FAS 系統上的 ONTAP 最大 LUN 大小為 128TB 。NetApp 一律建議為每個資料存放區使用單一大型 LUN ，而非嘗試使用擴充。與 NFS 一樣，請考慮使用多個資料存放區（磁碟區或儲存單元），在單一 ONTAP 控制器上發揮最大效能。</block>
  <block id="69f31e71b4d944d0f4c405d0e6e39f7e" category="list-text">在某些情況下、您甚至不需要資料存放區。請考慮來賓擁有的檔案系統，例如 NFS ， SMB ， NVMe / TCP 或由來賓管理的 iSCSI 檔案系統。如需特定的應用程式指南、請參閱適用於您應用程式的NetApp技術報告。例如，<block ref="cfa0393f870bc70fd8973ae18376facc" category="inline-link-macro-rx"></block>有一節關於虛擬化的內容，其中包含實用的詳細資料。</block>
  <block id="bcc3251e9d72ed4c51a3b9557e4067c9" category="list-text">雖然您可以仔細規劃移轉至適當的目的地資料存放區、但通常較容易大量移轉、然後視需要組織。如果您有特定的資料保護需求、例如不同的 Snapshot 排程、您可能會想要使用此方法來引導您移轉至不同的資料存放區。此外，一旦 VM 位於 NetApp 叢集上， Storage VMotion 就可以使用 VAAI 卸載，在叢集上的資料存放區之間移動 VM ，而不需要主機型複本。請注意， NFS 不會卸載已開機虛擬機器的 Storage VMotion ，不過 VMFS 會卸載。</block>
  <block id="0ad05ff30fea1e84deaaa1ed7bee8fac" category="paragraph">在執行 ONTAP 的系統上使用 vSphere 時、最重要的最佳實務做法是安裝和使用適用於 VMware vSphere 外掛程式（前身為虛擬儲存主控台）的 ONTAP 工具。此 vCenter 外掛程式可簡化儲存管理，提升可用度，並降低儲存成本和營運成本，無論是使用 SAN 或 NAS ， ONTAP Select ， AFF ， FAS ，甚至是 ASA （在 VMware 或 KVM VM 中執行的軟體定義版本 ONTAP ）。它採用最佳實務做法來配置資料存放區、並針對多重路徑和HBA逾時最佳化ESXi主機設定（如附錄B所述）。由於它是 vCenter 外掛程式、因此可用於所有連線至 vCenter 伺服器的 vSphere Web 用戶端。</block>
  <block id="e4aac7f3219a7f18dc97515d5997afad" category="admonition">在以映像為基礎的 vSphere 叢集上，您仍會想要將 NFS 外掛程式新增至映像，這樣當您使用 ONTAP 工具安裝時，它們就不會違反法規遵循。</block>
  <block id="279b6091a0ac82b44d1b55974e5be84e" category="paragraph">ONTAP 工具也是 VASA Provider for ONTAP 許多功能的管理介面，可支援以 vVols 為基礎的儲存原則管理。</block>
  <block id="56de38ee4f3cd70309ddc44c00acb1fb" category="list-text">NetApp 僅建議停用 ONTAP 叢集內叢集互連連接埠上的網路流程控制。對於用於資料流量的其餘網路連接埠、NetApp並未提出其他最佳實務做法建議。您應視需要啟用或停用。如需流程控制的更多背景資訊、請參閱<block ref="3455dc2b3e7cd12a38e508bec690aa67" category="inline-link-rx"></block>。</block>
  <block id="3a04c6fe53e84b0859143746f9b8b3bc" category="paragraph">備份及快速還原虛擬機器（ VM ）是使用 ONTAP for vSphere 的主要優點。此功能可透過適用於 VMware vSphere 的 SnapCenter 外掛程式，在 vCenter 內輕鬆管理。許多客戶使用 SnapCenter 來強化第三方備份解決方案，以運用 ONTAP 的快照技術，因為它提供了使用 ONTAP 最快，最直接的方法來還原 VM 。擁有 ONTAP One 授權的客戶可免費取得 SnapCenter ，也可取得其他授權套裝組合。</block>
  <block id="17d20b1dcedfc04c7879e9675412b0db" category="section-title">NetApp ONTAP Volume 快照</block>
  <block id="424a2b394957a69a3a605706153f9539" category="paragraph">快照是 ONTAP 的重要功能，可讓您建立資料的時間點複本。它們不僅節省空間，而且可以快速建立，因此非常適合用來保護 VM 和資料存放區。快照可用於多種用途，包括備份，恢復和測試。這些快照與 VMware （一致性）快照不同，適合長期保護。由於效能和其他影響，僅建議短期使用 VMware vCenter 管理的快照。如<block ref="edb84c63886608dd2a747873a2732130" category="inline-link-macro-rx"></block>需詳細資訊、請參閱。</block>
  <block id="9fe3ffc9df0f8a5c691d2ed0c67a5b03" category="paragraph">快照是在磁碟區層級建立，可用於保護該磁碟區內的所有 VM 和資料存放區。這表示您可以建立整個資料存放區的快照，其中包括該資料存放區內的所有 VM 。</block>
  <block id="d1c6249258c65372addf83e0659b487e" category="paragraph">對於 NFS 資料存放區，您可以瀏覽 .snapshots 目錄，輕鬆檢視快照中的 VM 檔案。這可讓您快速存取及還原快照中的檔案，而無需使用特定的備份解決方案。</block>
  <block id="98366d305ee795988e2e64b7dc1644c0" category="paragraph">對於 VMFS 資料存放區，您可以根據所需的快照來建立資料存放區的 FlexClone 。這可讓您建立以快照為基礎的新資料存放區，用於測試或開發用途。FlexClone 只會佔用快照執行後所做變更的空間，因此是建立資料存放區複本的極具空間效益的方法。建立 FlexClone 之後，您可以將 LUN 或命名空間對應至 ESXi 主機，就像一般的資料存放區一樣。這不僅能讓您還原特定的 VM 檔案，還能讓您根據正式作業資料快速建立測試或開發環境，而不會影響正式作業環境的效能。</block>
  <block id="03e4c24bf78c3a62e1dced5c76036cf1" category="inline-link">ONTAP 本機快照複本</block>
  <block id="331645ef05e71ecf888b1c6732e111f1" category="inline-link">ONTAP SnapMirror 複寫</block>
  <block id="428f746f2aae5a59f6c035e9d5ea0b6f" category="paragraph">如需快照的詳細資訊，請參閱 ONTAP 文件。下列連結提供其他詳細資料：<block ref="8952dffd5c4f20d5268260325aabe39c" category="inline-link-rx"></block> <block ref="0f48fac4970e6e00b85c774c033fa517" category="inline-link-rx"></block></block>
  <block id="27ad839d4296d122cd72e93f1112d733" category="section-title">適用於 VMware vSphere 的 SnapCenter 外掛程式</block>
  <block id="f3980536bb15eae0ba5c0b2657f8433a" category="paragraph">利用此功能、您可以建立可套用至多個工作的備份原則。SnapCenter這些原則可定義排程、保留、複寫及其他功能。它們持續允許選擇性地選擇 VM 一致的快照，以利用 Hypervisor 的能力來在執行 VMware 快照之前，先關閉 I/O 。不過、由於VMware快照的效能影響、除非您需要靜止客體檔案系統、否則一般不建議使用這些快照。請改用快照來提供一般保護，並使用應用程式工具（例如 SnapCenter 應用程式外掛程式）來保護交易資料，例如 SQL Server 或 Oracle 。</block>
  <block id="fcc3a75d51e5e5b8a03324e1a626fb47" category="paragraph">這些外掛程式提供延伸功能、可在實體和虛擬環境中保護資料庫。透過 vSphere ，您可以使用它們來保護 SQL Server 或 Oracle 資料庫，其中的資料儲存在直接連線至來賓作業系統的 RDM LUN ， vVols 或 NVMe / TCP 命名空間和 iSCSI LUN ，或是 VMFS 或 NFS 資料存放區上的 VMDK 檔案。外掛程式允許指定不同類型的資料庫備份，支援線上或離線備份，並保護資料庫檔案及記錄檔。除了備份與還原之外，外掛程式也支援用於開發或測試目的的資料庫複製。</block>
  <block id="ed4b38adcac92958d35c1949278ac403" category="inline-link">適用於 VMware vSphere 的 SnapCenter 外掛程式規模調整指南</block>
  <block id="12a351ccc1f78e4aee2d5bf9f55f754b" category="paragraph">如需尺寸調整資訊，請參閱<block ref="c5fb486dbca6b73042cefb5314c3e0ce" category="inline-link-rx"></block></block>
  <block id="555f2327888d8e7cf50068fd301b189d" category="section-title">適用於 VMware vSphere 的 ONTAP 工具與 VMware Live Site Recovery</block>
  <block id="bdfe900673edfc6634c23bde843c6420" category="paragraph">適用於 VMware vSphere 的 ONTAP 工具（ OT4VS ）是免費的外掛程式，可在 VMware vSphere 和 NetApp ONTAP 之間提供無縫整合。它可讓您直接從 vSphere Web Client 管理 ONTAP 儲存設備，讓您更輕鬆地執行資源配置儲存，管理複寫及監控效能等工作。</block>
  <block id="d6c59a18f3b83d8486f9527e20ea1941" category="paragraph">若要改善災難恢復功能，請考慮使用 ONTAP 的 NetApp ，這是適用於 VMware vSphere 的 ONTAP 工具的一部分，以及 VMware Live Site Recovery （原稱為 Site Recovery Manager ）。此工具不僅支援使用 SnapMirror 將資料存放區複寫到災難恢復站台，也可透過複製資料存放區，在災難恢復環境中進行不中斷的測試。此外，內建自動化功能可簡化災難恢復，並在解決停電後重新保護生產環境。</block>
  <block id="d223a7adee575c4956124c0868f0825f" category="section-title">vSphere Metro 儲存叢集（ VMSC ），搭配 NetApp MetroCluster 和 SnapMirror 主動式同步</block>
  <block id="85abd770c37e6b8f0dd32bb10e63df19" category="paragraph">最後，若要獲得最高層級的資料保護，請考慮使用 NetApp MetroCluster 的 VMware vSphere Metro Storage Cluster （ VMSC ）組態。 VMSC 是 VMware 認證的 NetApp 支援解決方案，使用同步複寫，提供高可用度叢集的相同效益，但分散於不同站台，以避免站台災難。NetApp SnapMirror Active Sync 與 AFF ， AFF 及 MetroCluster with ASA 可提供具成本效益的同步複寫組態，可從任何單一儲存元件故障進行透明還原，並可在 SnapMirror 主動式同步或單一命令還原時使用 MetroCluster 進行透明還原。 VMSC 的詳細說明請參閱。<block ref="252912db8b98e51588a897ab91b985e0" category="inline-link-rx"></block></block>
  <block id="99f033ca163a880d3ebaf5192a303bf9" category="paragraph">執行 ONTAP 的系統可利用靜態加密輕鬆保護任何資料。NetApp 儲存加密（ NSE ）使用 ONTAP 的自我加密磁碟機（ SED ）來保護 SAN 和 NAS 資料。NetApp也提供NetApp Volume Encryption和NetApp Aggregate Encryption、這是一種簡單、以軟體為基礎的方法、可加密任何磁碟機上的磁碟區。此軟體加密不需要特殊的磁碟機或外部金鑰管理員、 ONTAP 客戶可免費使用。您可以在不中斷用戶端或應用程式的情況下進行升級並開始使用，這些應用程式已通過 FIPS 140-2 第 1 級標準驗證，包括 Onboard Key Manager 。</block>
  <block id="5826cf23650ea572524e9309431c2169" category="list-text">* 內建金鑰管理程式。 *NetApp 軟體加密包含內建金鑰管理程式，無需額外付費，無需購買和使用複雜的高可用度金鑰管理伺服器，即可輕鬆上手。</block>
  <block id="1499e638502a512eab8c6e5e76d54ece" category="paragraph">開始使用軟體加密非常簡單。安裝授權之後，只要指定複雜密碼來設定 Onboard Key Manager ，然後建立新的磁碟區，或是進行儲存端磁碟區移轉以啟用加密即可。NetApp正致力於在未來的VMware工具版本中、為加密功能提供更多整合式支援。</block>
  <block id="0499c7df3779345b8007d3f36acf7bae" category="list-text">將儲存網路流量與其他網路區隔。使用專屬的VLAN或獨立的交換器來儲存、即可建立獨立的網路。如果儲存網路共用實體路徑（例如上行鏈路）、您可能需要QoS或額外的上行鏈路連接埠、以確保有足夠的頻寬。除非您的解決方案指南特別要求，否則請勿將主機直接連線至儲存設備；使用交換器來建立備援路徑，讓 VMware HA 在不需介入的情況下運作。</block>
  <block id="d0ffa72f3503feac723dc422bf406d9f" category="list-text">如果您的網路支援巨型框架，則應該使用巨型框架。如果使用、請確定在儲存設備和ESXi主機之間的路徑中、所有網路裝置、VLAN等上的設定都相同。否則、您可能會看到效能或連線問題。MTU也必須在ESXi虛擬交換器、VMkernel連接埠、以及每ONTAP 個節點的實體連接埠或介面群組上設定相同。</block>
  <block id="7e8f5f024231d60cdc9576880a7f052a" category="list-text">NetApp 僅建議停用 ONTAP 叢集內叢集互連連接埠上的網路流程控制。NetApp 對於用於資料流量的其餘網路連接埠的流量控制最佳實務做法，並無其他建議。您應該視需要啟用或停用它。如需流程控制的更多背景資訊、請參閱<block ref="3455dc2b3e7cd12a38e508bec690aa67" category="inline-link-rx"></block>。</block>
  <block id="6e4e8c0fcc610bc580228562a24b83ab" category="section-title">SAN （ FC ， NVMe / FC ， iSCSI ， NVMe / TCP ）， RDM</block>
  <block id="10a270aa1bdf582d9f25983e1c822f19" category="paragraph">儲存管理員有時偏好從組態中移除網路交換器、以簡化其基礎架構。在某些情況下可能會支援這項功能。不過，有一些限制和注意事項需要注意。</block>
  <block id="020f95916177eb14567bf65de71d3668" category="paragraph">實際上、 NetApp 客戶確實有直接連線的 NFS 、但通常僅適用於容錯移轉期間 IO 暫停的工作負載。使用硬掛載時、在這類暫停期間不應有任何 IO 錯誤。IO 應該會凍結，直到服務還原為止，無論是透過容錯回復或手動介入，在主機上的 NIC 之間移動 IP 位址。</block>
  <block id="72ddef074f60e5fc537d32dc77a96c36" category="paragraph">本文件介紹適用於 vSphere 的 ONTAP 解決方案，重點介紹最新的產品資訊和最佳實務做法，以簡化部署，降低風險並簡化管理。</block>
  <block id="ce688f68d7fc3cbdd2bee58fdaa7a3ae" category="paragraph">本文件著重於在 vSphere 7.0 或更新版本上執行的 ONTAP （ 9.x ）最新版本中的功能。如需特定版本的詳細資訊，請參閱<block ref="ab7acb1690084e25996646d49d4a381e" category="inline-link-rx"></block>和<block ref="e1593898142109fc8cd8025356d3f312" category="inline-link-rx"></block>。</block>
  <block id="7642d26aa7df3de4ab3a541dbfe31437" category="paragraph">VMware vSphere API for Storage Aware （ VASA ）可讓儲存管理員輕鬆設定具有明確定義功能的資料存放區，並可讓 VM 管理員在需要時使用這些功能來配置 VM ，而無需彼此互動。</block>
  <block id="13844ac053869d38b76530ed8f4159a9" category="paragraph">在 VASA 之前， VM 管理員可以定義 VM 儲存原則，但他們必須與儲存管理員合作來識別適當的資料存放區，通常是使用文件或命名慣例。有了VASA、儲存管理員可以定義一系列的儲存功能、包括效能、分層、加密及複寫。一組磁碟區或一組磁碟區的功能稱為儲存功能設定檔（scp）。</block>
  <block id="ea70c1612f8cd9738b66d05af624f8c5" category="paragraph">VMware vSphere API for Storage Aware （ VASA ）可讓儲存管理員輕鬆設定具有明確定義功能的資料存放區，並可讓 VM 管理員在需要時使用這些功能來配置 VM ，而無需彼此互動。請看一下這種方法、瞭解它如何簡化虛擬化儲存作業、並避免許多瑣碎的工作。</block>
  <block id="15526db5729ae485923742110cf54c7a" category="paragraph">VMware Storage Distributed Resource Scheduler （ SDR ）是 vSphere 功能，可根據目前的 I/O 延遲和空間使用量，自動將 VM 放置在資料存放區叢集中。</block>
  <block id="e21e1ecabc11b1c40a35e9030d8474bd" category="list-text">除非您有特定要求，否則請勿使用 SDR 。</block>
  <block id="397f2530fca86e36b28c183ded119555" category="list-text">使用 ONTAP 時不需要 SDR 。SDR 並不瞭解重複資料刪除和壓縮等 ONTAP 儲存效率功能，因此可能會做出不適合您環境的決策。</block>
  <block id="28ef5b69fedbf0bfc161c069c66b8c56" category="list-text">SDR 不知道 ONTAP QoS 原則，因此可能會做出不適合效能的決策。</block>
  <block id="07495043326316f508fa4c530196be56" category="list-text">SDR 不知道 ONTAP 快照複本，因此可能會做出決定，導致快照呈指數成長。例如，將 VM 移至另一個資料存放區會在新的資料存放區中建立新檔案，導致快照增加。對於擁有大型磁碟或許多快照的 VM 而言，這種情況尤其如此。然後，如果將 VM 移回原始資料存放區，原始資料存放區上的快照就會變得更大。</block>
  <block id="2b53a21ac29cb3161e892454cf7f0621" category="paragraph">如果您確實使用 SDR ，請考慮下列最佳實務做法：</block>
  <block id="2c1e5c80beebd647a22327e2b18b2ddf" category="list-text">當 SDR 在資料存放區之間移動 VMDK 時， ONTAP 複製或重複資料刪除所節省的任何空間，可能會因其在目的地上刪除重複資料或壓縮的程度而有所降低。</block>
  <block id="2d8ff546478fe1dc3783d293a5650bb1" category="inline-link">Storage DRS 常見問題集</block>
  <block id="9fe1a69b0192fb5955b959edd763b9d6" category="paragraph">有關 SDR 的詳細信息，請參閱 VMware 文檔，網址爲<block ref="6f5bfdeedeaf40bf3dcc7dcc4311a1cf" category="inline-link-rx"></block>。</block>
  <block id="2a104d02cb0299df0ebe47fa0ceb2e3f" category="paragraph">使用適用於 VMware vSphere 的 ONTAP 工具輕鬆設定這些值：從 ONTAP 工具總覽頁面向下捲動至底部，然後按一下 ESXi 主機相容性 Portlet 中的套用建議設定。</block>
  <block id="b8ed49f8c2faef2a05f3432a8bf20432" category="cell">newSyncInterval.NewSyncs</block>
  <block id="b7715db44a4dfbe51370a25ea991a2f0" category="cell">如果您不使用 vSphere CSI for Kubernetes ，請依設定<block ref="e3529737a3b4eef7cff2c05dcd47fcdc" category="inline-link-rx"></block></block>
  <block id="bc7b51a623cfc5e288b304d2f9c93eac" category="admonition">使用 VMware vSphere ESXi 7.0.1 和 VMware vSphere ESXi 7.0.2 時， NFS 進階組態選項 MaxQueueDepth 可能無法正常運作。如需詳細資訊，請參閱<block ref="861055760f3cd527823fd34a49459992" category="inline-link-macro-rx"></block>。</block>
  <block id="93754b0c6a333efae9b897da113630eb" category="paragraph">這種統一化方法原本是指在單一儲存系統上同時支援 NAS 和 SAN 傳輸協定、而 ONTAP 則是 SAN 的領先平台、同時也是 NAS 的原始優勢。ONTAP 現在也提供 S3 物件傳輸協定支援。雖然 S3 不用於資料存放區、但您可以將它用於來賓應用程式。您可以在中的 ONTAP 中深入瞭解 S3 <block ref="9a0a48164e4b196191c2134bda6f342d" category="inline-link-macro-rx"></block>傳輸協定支援。統一化儲存技術這個詞彙已演變成統一化的儲存管理方法，包括從單一介面管理所有儲存資源的能力。這包括能夠同時管理內部部署和雲端儲存資源，最新的 All SAN Array （ ASA ）系統，以及從單一介面管理多個儲存系統的能力。</block>
  <block id="9f4686c99993be53ee2c19ad1e4f9c69" category="paragraph">儲存虛擬機器（ SVM ）是 ONTAP 中安全的多租戶共享單元。這是一種邏輯結構、可讓用戶端存取執行 ONTAP 的系統。SVM可透過邏輯介面（LIF）、透過多種資料存取傳輸協定同時提供資料。SVM透過NAS傳輸協定（例如CIFS和NFS）提供檔案層級的資料存取、並透過SAN傳輸協定（例如iSCSI、FC/FCoE和NVMe）提供區塊層級的資料存取。SVM 可以同時將資料單獨提供給 SAN 和 NAS 用戶端、也可以搭配 S3 使用。</block>
  <block id="ddf4bde5aaaa48fac85f6c5a4c180815" category="paragraph">NetApp 提供數種獨立式軟體工具，可與傳統的 ONTAP 和 ASA 系統相容，並整合 vSphere ，有效管理虛擬化環境。</block>
  <block id="9955c42610092bf7a7dbb035ba2362df" category="paragraph">ONTAP ONE 授權隨附下列工具，無需額外付費。請參閱圖1、瞭解這些工具如何在vSphere環境中共同運作。</block>
  <block id="28c25b3bd0941927acf5da7cedf09056" category="paragraph"><block ref="b4726a9e2d7c67e5d20fb7588efe2682" category="inline-link-rx"></block>是一組工具，可搭配 vSphere 使用 ONTAP 儲存設備。vCenter外掛程式先前稱為虛擬儲存主控台（VSC）、可簡化儲存管理與效率功能、增強可用度、並降低儲存成本與營運成本、無論您使用SAN或NAS。它採用最佳實務做法來配置資料存放區、並針對NFS和區塊儲存環境最佳化ESXi主機設定。針對所有這些優點、 NetApp 建議在搭配執行 ONTAP 的系統使用 vSphere 時、使用這些 ONTAP 工具作為最佳實務做法。其中包括伺服器應用裝置， vCenter 的 UI 擴充， VASA Provider 和 Storage Replication Adapter 。幾乎所有的功能都可以透過簡單的REST API來自動化、而大多數的現代化自動化工具都能耗用這些API ONTAP 。</block>
  <block id="88450f60f7fbe5f503e1fecfcab9fb4d" category="list-text">* vCenter UI 延伸。 *ONTAP 工具的 UI 延伸功能可將易於使用的內容相關功能表嵌入到 vCenter UI 中，以簡化工作流程，簡化作業團隊和 vCenter 管理員的工作。這些功能表可用於管理主機和儲存設備，資訊入口小工具和原生警示功能。</block>
  <block id="8fc0876b17dbd4327218c6365f4d3ed1" category="inline-link">適用於 VMware VAAI 的 NetApp NFS 外掛程式</block>
  <block id="6b7f9103f91020461893e7625153d87c" category="paragraph"><block ref="e56b6fbfc57db1f13007ad438701316e" category="inline-link-rx"></block>是 ESXi 主機的外掛程式，可讓主機使用 VAAI 功能搭配 ONTAP 上的 NFS 資料存放區。它支援複製卸載、以進行複製作業、保留大型虛擬磁碟檔案的空間、以及快照卸載。將複本作業卸載到儲存設備並不一定能更快完成、但它確實能降低網路頻寬需求、並卸載CPU週期、緩衝區和佇列等主機資源。您可以使用ONTAP VMware vSphere的支援功能、在ESXi主機上安裝外掛程式、或是在支援的情況下安裝vSphere Lifecycle Manager（vLCM）。</block>
  <block id="662df1486cbd8ddf1909b804fde3b122" category="section-title">優質軟體選項</block>
  <block id="89a13650cc26099f24645b3ebabd8681" category="inline-link">資料基礎架構洞見（ DII ）</block>
  <block id="7449970110f98c992170b6bbd68252f9" category="paragraph">作為技術設計合作夥伴， NetApp 提供架構意見，並於 2015 年宣布支援 VVols 。這項新技術現在可透過 SPBM 將 VM 精細且真正的陣列原生儲存資源配置自動化。</block>
  <block id="09807314260bef27b90345fd0212a57f" category="paragraph">儲存容器是由儲存管理員所建立，用於群組 VM 管理員可以使用的儲存資源。根據您使用的 ONTAP 系統類型，儲存容器的建立方式可能有所不同。使用傳統的 ONTAP 9 叢集，容器會被指派一個或多個組成儲存池的備份 FlexVol 磁碟區。使用 ASA R2 系統時，整個叢集就是儲存池。</block>
  <block id="660bee009f0ed31eb05e51ba93850f4d" category="paragraph">* 視平台和傳輸協定而定</block>
  <block id="935aaefee7fac977eb8c3770e167d5f9" category="summary">客戶可以放心選擇 ONTAP for vSphere ，因為其統一化的 SAN 和 NAS 儲存解決方案，以及最新的 All SAN Array 中所採用的全新簡化的分散式儲存架構。此平台提供卓越的快照保護和強大的管理工具。ONTAP 將功能卸載至專用儲存設備，可將主機資源最大化，降低成本，並維持最佳效能。此外，使用 Storage VMotion 可在 VMFS ， NFS 或 vVols 之間輕鬆移轉工作負載。</block>
  <block id="b587bd8bd461a8e643d3122ed2fc385e" category="doc">為何選擇 ONTAP for VMware vSphere ？</block>
  <block id="f89ab8928b3772533629296451ffbbf3" category="section-title">使用 ONTAP for vSphere 的優點</block>
  <block id="be68f84ad2e7ab7d1f2a41defa80f499" category="list-text">* 所有 SAN 陣列（ ASA ） *最新的 ONTAP ASA 系統（從 A1K ， A90 ， A70 ， A50 ， A30 和 A20 開始）是以全新的儲存架構為基礎，消除了傳統的 ONTAP 儲存模式來管理集合體和磁碟區。由於沒有檔案系統共用，因此不需要磁碟區！連接至 HA 配對的所有儲存設備都會視為通用儲存可用區域（ SAZ ），其中 LUN 和 NVMe 命名空間會配置為「儲存單元」（ SUS ）。最新的 ASA 系統設計為易於管理，並為 SAN 儲存管理員提供熟悉的體驗。這種新架構非常適合 vSphere 環境，因為它能輕鬆管理儲存資源，並為 SAN 儲存管理員提供簡化的體驗。ASA 架構也支援最新的 NVMe over Fabrics （ NVMe of ）技術，為 vSphere 工作負載提供更高的效能和擴充性。</block>
  <block id="088651913adba4fc73fbb23602f7c656" category="list-text">* Snapshot 技術。 *ONTAP 是第一款提供資料保護快照技術的公司，也是業界最先進的公司。這種節省空間的資料保護方法已延伸至支援 VMware vSphere API for Array Integration （ VAAI ）。這項整合可讓您充分利用 ONTAP 的快照功能來執行備份與還原作業，進而降低對正式作業環境的影響。這種方法也可讓您使用快照來快速恢復 VM ，減少還原資料所需的時間與心力。此外， ONTAP 的快照技術也與 VMware 的即時網站恢復（ VLSR ，前身為 Site Recovery Manager [RSR] ）解決方案整合，為您的虛擬化環境提供全方位的資料保護策略。</block>
  <block id="9406fb3af0e8e2bf8446823785c0e069" category="inline-link">資料基礎架構洞見</block>
  <block id="1c951601876e4daa83bce02aba074440" category="list-text">在開始安裝之前，您應該檢查<block ref="ab7acb1690084e25996646d49d4a381e" category="inline-link-rx"></block>以確保您的部署已通過認證。</block>
  <block id="ef30f0c0c266a8b9be1816aa72a0f58f" category="list-text">判斷您是否要使用多租戶 SVM 或允許完整叢集存取。如果使用多租戶 SVM ，您需要在每個要使用的 SVM 上都有 SVM 管理 LIF 。此 LIF 必須透過連接埠 443 由 ONTAP 工具存取。</block>
  <block id="4050ff4d6d35bffd46dbff7fad4e6941" category="doc">在 AFF ， ASA ， ASA R2 和 FAS 系統上部署 vVols</block>
  <block id="8a440842662a6052845e4abd1f7d5dec" category="paragraph">資源配置 vVols 資料存放區涉及數個步驟。NetApp 的 ASA R2 系統專為 VMware 工作負載所設計，提供與傳統 ONTAP 系統不同的使用者體驗。使用 ASA R2 系統時， ONTAP 工具 10.3 版或更新版本需要較少的步驟來設定，並納入針對新儲存架構最佳化的 UI 延伸和 REST API 支援。</block>
  <block id="3164e4b18dd8dcc542a3c18024fc82b6" category="inline-link-macro">檢查清單</block>
  <block id="35d34bb35f01ef3d59680d5fb99f1085" category="paragraph">如果您已經使用 ONTAP 工具來管理，自動化及報告現有的 VMFS 或傳統 NFS 型儲存設備，則可以略過部署程序的前兩個步驟。您也可以參閱本完整文件<block ref="9dbdf15e49c83951dd903469aa18bcda" category="inline-link-macro-rx"></block>，瞭解如何部署及設定 ONTAP 工具。</block>
  <block id="d851df02ab3826ddf58a3627857cb8a5" category="list-text">建立儲存虛擬機器（ SVM ）及其傳輸協定組態。請注意， ASA R2 系統可能不需要這項功能，因為它們通常已經有單一 SVM 用於資料服務。您可以選擇 NVMe / FC （僅限 ONTAP 工具 9.13 ）， NFSv3 ， NFSv4.1 ， iSCSI ， FCP ，或這些選項的組合。NVMe / TCP 和 NVMe / FC 也可用於傳統的含 ONTAP 工具 10.3 及更新版本的 VMFS 資料存放區。您可以使用 ONTAP 系統管理員精靈或叢集 Shell 命令列。</block>
  <block id="0be185fbc79ad0a2e0901c2bf99d7071" category="list-text">對於非 ASA R2 系統，目前可能會建立磁碟區，但最佳做法是讓 ONTAP 工具中的 _ 資源存放區 _ 精靈建立這些磁碟區。此規則唯一的例外是，您打算將 vVols 複寫搭配 VMware Site Recovery Manager 和 ONTAP 工具 9.13 使用。使用現有的 FlexVol 磁碟區與現有的 SnapMirror 關係、更容易設定。請注意、不要在任何磁碟區上啟用用於 VVols 的 QoS 、因為這是由 SPBM 和 ONTAP 工具管理的。</block>
  <block id="08aa56f631ccbed4e095da7781f63af4" category="list-text">建議的最佳實務做法是<block ref="ef398e4ee19e56a537bbd5564e5f4512" category="inline-link-rx"></block>將所有正式作業工作負載的 10.3 及更新版本設定為 3 節點高可用度（ HA ）組態。為了實驗室或測試目的，您可以使用單一節點部署。</block>
  <block id="ee88aebf80e3a3f63dfba15f3b663832" category="list-text">在您想要將特定儲存虛擬機器（ SVM ）委派給特定 vCenter 的安全多租戶環境中，您必須執行下列動作。</block>
  <block id="ddf4cee1ee4746501a3a74ca7e1b2ce0" category="paragraph">vSphere 中使用 VM 儲存原則來管理儲存 I/O 控制或 vSphere 加密等選用功能。它們也可與 vVols 搭配使用、將特定的儲存功能套用至 VM 。請使用「 NetApp ． clustered ． ONTAP ． VP ． VVOL 」儲存類型。請參閱連結： vmware-vols-ontap.html#Best Practices [ 透過 NFS v3 使用 vVols 的範例網路組態 ] 、以瞭解 ONTAP 工具 VASA Provider 的範例。「 NetApp ， ONTAP ， VP.VASA10 」儲存設備的規則將用於非 VVols 型資料存放區。</block>
  <block id="5e182d41ad3ea710eea81b3297a29a79" category="paragraph">ONTAP One 授權包含所有必要的授權，可搭配 ONTAP 系統使用 VVols 。唯一的額外需求是免費的 ONTAP 工具 OVA ，它是 VASA 供應商。在 vVols 環境中， VASA Provider 軟體將陣列功能轉譯為原則導向屬性，可透過 VASA API 加以運用，而 vSphere 管理員無需知道這些功能如何在幕後管理。如此可根據原則動態使用已分配的儲存容量，無需手動建立傳統的資料存放區，並管理其個別的儲存使用率。簡而言之， vVols 將管理企業儲存設備的所有複雜性都從 vSphere 管理員中擷取出來，讓他們能夠專注於虛擬化層。</block>
  <block id="98f85fc67e5f6131ae07084cdeebb84a" category="paragraph">您可以使用 NetApp 支援網站上提供的升級 ISO 檔案來支援 ONTAP 工具的就地升級<block ref="b5b3717cb556fa4a89daf005a0a23ea8" category="inline-link-rx"></block>（需要登入）。請依照<block ref="f4c1005a920344cdec43558687897506" category="inline-link-rx"></block>指南指示來升級應用裝置。您也可以從 ONTAP 工具 9.13 到 10.3 進行並排升級。請參閱<block ref="f6676f6d529f1f81f9da02084f545f3c" category="inline-link-rx"></block>以深入瞭解該主題。</block>
  <block id="96e626dfdfc4f6474618b5d6e22f052e" category="list-text"><block ref="96e626dfdfc4f6474618b5d6e22f052e" category="inline-link-rx"></block></block>
  <block id="62c6b269dc04e5f59ec38c35e3251edb" category="paragraph">雖然可以使用一般 vSphere 介面建立 vVols 資料存放區，但使用 ONTAP 工具會根據需要自動建立傳輸協定端點，並使用 ONTAP 最佳實務做法建立 FlexVol Volume （ ASA R2 不需要）。只要在主機 / 叢集 / 資料中心上按一下滑鼠右鍵，然後選取 ONTAP tools_ 和 _Provision datastority_ 即可。您只需在精靈中選擇所需的 vVols 選項即可。</block>
  <block id="c1d59fa07379d331f1649dd32c8b663d" category="paragraph">如果您需要重新開機設備，這可能會導致「雞蛋」情況，因為它們在重新開機時無法重新連結自己的 vVols 。您可以將它們儲存在由不同 ONTAP 工具和 vCenter 部署所管理的 vVols 資料存放區。</block>
  <block id="4e9810675a80252409e746ff4f07c469" category="paragraph">* 根據您的需求規劃備份 FlexVol 磁碟區。 *</block>
  <block id="6ce93abd27f08d98b3c9e6da0a3d3006" category="admonition">本文件已更新，包含 vSphere 8.0 更新 3 ， ONTAP 工具 10.4 版本和新 NetApp ASA 系統中的新 vVols 功能。</block>
  <block id="183c087ffc7731fee88c6d40b2024a45" category="paragraph">VMware vSphere API for Storage Aware （ VASA ）可讓 VM 管理員輕鬆使用所需的任何儲存功能來配置 VM 、而無需與儲存團隊互動。在 VASA 之前， VM 管理員可以定義 VM 儲存原則，但必須與儲存管理員一起找出適當的資料存放區，通常是使用文件或命名慣例。有了 VASA 、具有適當權限的 vCenter 管理員就能定義一系列儲存功能、 vCenter 使用者隨後可以使用這些功能來配置 VM 。VM 儲存原則與資料存放區功能之間的對應可讓 vCenter 顯示相容資料存放區清單以供選擇，並可啟用其他技術，例如 Aria （前身為 vRealize ） Automation 或 Tanzu Kubernetes Grid ，以自動從指派的原則中選取儲存區。這種方法稱為儲存原則型管理。雖然 VASA Provider 規則和 VM 儲存原則也可用於傳統的資料存放區，但我們的重點是 vVols 資料存放區。</block>
  <block id="daeee50444f5c211b19aa03182c97401" category="paragraph">當 VMware 在 2015 年推出 VVols 支援 VASA 2.0 時，他們將其描述為「整合與管理架構，為外部儲存設備（ SAN/NAS ）提供全新的作業模式」。此作業模式可提供多項優點，搭配 ONTAP 儲存設備使用。</block>
  <block id="5631462c0980ed3fbdd07e734f163939" category="list-text">透過 Aria （前身為 vRealize ）套件， OpenStack 等，充分運用自動化與協調功能。</block>
  <block id="40ea6e1672fc21c11ea997d9b187dcef" category="paragraph">在 ONTAP 工具 9.7.1 的初始版本中，必須預先建立 FlexVol Volume 並啟用 SnapMirror 保護，才能將其作為 VVols 資料存放區的備份磁碟區。從 ONTAP 工具 9.10 開始、不再需要此程序。您現在可以將 SnapMirror 保護新增至現有的備份磁碟區、並更新您的 VM 儲存原則、以利用與 SRM 整合的災難恢復、移轉協調和自動化功能、來善用原則型管理。</block>
  <block id="0d5e4b39b7c99ac3687449b64c2f61d7" category="paragraph">除了 NetApp 虛擬化產品的各種知識庫文章之外， NetApp 支援網站也提供產品的便利登陸頁面<block ref="6e90053136fd326e5d581844ca21966d" category="inline-link-rx"></block>。此入口網站提供 NetApp 社群文章、下載、技術報告及 VMware 解決方案討論的連結。您可以在以下網址取得：</block>
  <block id="24096e60b90028c96c0a8e8df7c3c258" category="paragraph">NetApp MetroCluster 的設定說明請參閱<block ref="2c736bccede87dae47dcf61108f083c4" category="inline-link-rx"></block>。SnapMirror Active Sync （ SMas ）的說明也可在以下網址取得：<block ref="14203840309dd1b6e13f73373477bb9d" category="inline-link-rx"></block>。</block>
  <block id="e69c207b2671a8571c172595068da749" category="paragraph">如果未使用 MetroCluster ，或是您的 ONTAP 系統不支援 MetroCluster ，例如 ASA R2 系統，則可以使用 SnapMirror 主動式同步功能，在不同故障網域中的多個 ONTAP 叢集上提供資料存放區精細保護和主動式存取。SMas 使用一致性群組（ CGS ）來確保一個或多個資料存放區之間的寫入順序一致性，您可以根據應用程式和資料存放區需求建立多個 CGS 。一致性群組對於需要在多個資料存放區之間進行資料同步的應用程式特別有用。例如，分散在資料存放區之間的客體 LVM 。SMas 也支援原始裝置對應（ RDM ），以及與來賓 iSCSI 啟動器連線的來賓儲存設備。有關一致性群組的詳細資訊，請參閱<block ref="8bba9b5b97dba092834d7a48a07f102d" category="inline-link-rx"></block>。</block>
  <block id="646b17235be3514942344039b13b0ef5" category="paragraph">與 MetroCluster 相比、使用 SnapMirror 主動式同步管理 VMSC 組態有一些差異。首先， SMas 是僅限 SAN 的組態， SnapMirror 主動式同步無法保護任何 NFS 資料存放區。其次、您必須將兩個 LUN 複本對應到 ESXi 主機、以便它們存取兩個故障網域中的複寫資料存放區。第三，您必須針對要使用 SnapMirror 主動式同步保護的資料存放區，建立一或多個一致性群組。最後，您必須為建立的一致性群組建立 SnapMirror 原則。您可以使用 ONTAP 工具 vCenter 外掛程式中的「保護叢集」精靈，或使用 ONTAP CLI 或系統管理員手動完成所有這些工作。</block>
  <block id="46a01589543ca9b2c28b281bc82d5190" category="section-title">使用 ONTAP Tools vCenter Plugin for SnapMirror Active Sync</block>
  <block id="8acd56e642eabaf4e2e00e987d06c0dd" category="paragraph">ONTAP 工具 vCenter 外掛程式提供簡單且直覺的方式，可為 VMSC 設定 SnapMirror 主動式同步。您可以使用 ONTAP 工具 vCenter 外掛程式來建立和管理兩個 ONTAP 叢集之間的 SnapMirror 主動式同步關係。此外掛程式提供易於使用的介面，可有效建立及管理這些關係。您可以在上深入瞭解 ONTAP 工具 vCenter 外掛程式<block ref="238135431b1a2d25dda1f29146112b60" category="inline-link-rx"></block>，或直接跳至<block ref="50b45f063e0080035a4876db2aa395bd" category="inline-link-rx"></block>。</block>
  <block id="be0e7f3621283e77712fee8493cfe7c2" category="list-text">按一下「確定」。</block>
  <block id="1dddac6a529bf77c76b061ccea8bd130" category="list-text">建議搭配 MetroCluster 的 VMSC 使用下列其他 vSphere HA 設定：</block>
  <block id="4b0d37b4c720a2f35c5ebf18456af4c4" category="paragraph">新增稱為 das.心跳 DsPerHost 的進階設定、可能會增加心跳資料存放區的數量。使用四個心跳資料存放區（ HB DSS ）、每個站台兩個。使用「從清單中選取但輔助」選項。這是必要的、因為如果某個站台發生故障、您仍需要兩個 HB DSS 。不過，這些不一定要使用 MetroCluster 或 SnapMirror 主動式同步來保護。</block>
  <block id="261a4b114a90c38336a91406135768d4" category="list-text">您可以建立事件型警示、在虛擬機器違反 VM 主機關聯規則時觸發。在 vSphere Client 中，新增虛擬機器的警示，並選取「 VM 正在違反 VM-Host 關聯規則」作為事件觸發程序。如需建立及編輯警示的詳細資訊，請參閱<block ref="68398319bb6b2bfb9f64390479799795" category="inline-link-macro-rx"></block>文件。</block>
  <block id="d34c2eaf11cfea5ea00aa0943b8fcfab" category="admonition">本文件取代先前發佈的技術報告 _TR-4128 ： NetApp MetroCluster 上的 vSphere</block>
  <block id="2483a165b6002a92b0e076050cb48ea0" category="paragraph">NetApp MetroCluster 使用 NetApp 的 HA （控制器容錯移轉或 CFO ）功能來防範控制器故障。它也包括本機 SyncMirror 技術，災難時的叢集容錯移轉（災難時的叢集容錯移轉或 CFOD ），硬體備援，以及地理區隔，以達到高可用度。SyncMirror 會將資料寫入兩個叢中、以同步鏡射 MetroCluster 組態的兩個部份資料：本機叢（位於本機櫃上）主動提供資料、而遠端叢（位於遠端機櫃上）通常不會提供資料。所有 MetroCluster 元件（例如控制器、儲存設備、纜線、交換器（與 Fabric MetroCluster 搭配使用）和介面卡）均具備硬體備援功能。</block>
  <block id="4e7a787aaa9321ad4106d26a88e54252" category="paragraph">NetApp SnapMirror 主動式同步可在非 MetroCluster 系統和 ASA R2 系統上使用，透過 FCP 和 iSCSI SAN 傳輸協定提供資料存放區精細保護。它可讓您保護整個 VMSC ，或選擇性地保護高優先順序工作負載。它提供對本機和遠端站台的主動式存取、而 NetApp MetroCluster 則是主動式待命解決方案。從 ONTAP 9.15.1 開始， SnapMirror 主動式同步支援對稱式主動 / 主動式功能，可從受保護 LUN 的兩個複本進行讀取和寫入 I/O 作業，並提供雙向同步複寫功能，讓兩個 LUN 複本都能在本機執行 I/O 作業。在 ONTAP 9.15.1 之前， SnapMirror 主動式同步僅支援非對稱式主動 / 主動式組態，其中次要站台上的資料會代理至 LUN 的主要複本。</block>
  <block id="0e050612c89bbe89c4a1f2c79db93a7f" category="paragraph">NetApp MetroCluster 可部署在兩種不同的組態中，以搭配 vSphere 使用：</block>
  <block id="bb74c883034be56ad2c714b34888809d" category="image-alt">使用 MetroCluster 的 VMSC 圖表</block>
  <block id="2a36d659f1adb408dfdab4248eac6770" category="image-alt">使用 ONTAP 和管理服務器的 VMSC 圖表</block>
  <block id="051b8072cddf34ff82fc627b5ef88b06" category="paragraph">這些工具可為整個儲存環境提供全站台保護、確保資料永遠可用。無論您是使用獨立式伺服器，高可用度伺服器叢集，容器或虛擬化伺服器， NetApp 技術都能在電力中斷，冷卻或網路連線中斷，儲存陣列關機或作業錯誤等情況下，無縫維持儲存可用度。</block>
  <block id="f027f8c94b36e501200aa21bd5b3643f" category="paragraph">在接管期間， MetroCluster 組態中的 NAS 生命期會自動容錯移轉。不過， SAN 生命期不會容錯移轉，而是會繼續使用邏輯單元編號（ LUN ）的直接路徑。</block>
  <block id="3b414f3b9c656fa9b5680e32bf9b7d2d" category="paragraph">有關 HA 接管和恢復的詳細信息，請參閱<block ref="5a72801b431f75b7489a0e7de50680bf" category="inline-link-rx"></block>。值得一提的是、這項功能並非 MetroCluster 或 SnapMirror 主動式同步的專屬功能。</block>
  <block id="49c8d9bbd63bc0df306259c93fa4d364" category="paragraph">有了 SnapMirror 主動式同步、由於兩個複本都是同時使用的、因此您現有的主機將繼續運作。ONTAP Mediator 是確保站台容錯移轉正確進行所需的工具。</block>
  <block id="240e602413c054e65f7a1233278f5c39" category="doc">使用 MetroCluster 的 VMSC 的失敗案例</block>
  <block id="8c3100c726feafcb8f5c89188709b8da" category="paragraph">在此案例中、有兩個以上的磁碟或整個機櫃發生故障。資料是從仍在運作的複合環境提供、不會中斷資料服務。磁碟故障可能會影響本機或遠端叢。由於只有一個叢處於作用中狀態、因此集合體會顯示為降級模式。更換故障磁碟後、受影響的集合體將自動重新同步以重建資料。重新同步後、集合體將自動返回正常的鏡射模式。如果單一 RAID 群組中有兩個以上的磁碟發生故障，則必須重新建置叢。</block>
  <block id="e3010a7324dc76261135a69dad98bcf2" category="paragraph">在站台之間分割 ESXi 主機之後， vSphere HA 代理程式會檢查資料存放區心跳，而且在每個站台中，本機 ESXi 主機將能夠將資料存放區心跳更新至各自的讀取 / 寫入磁碟區 /LUN 。站台 A 中的主機會假設站台 B 中的其他 ESXi 主機故障，因為沒有網路 / 資料存放區心跳。站台 A 的 vSphere HA 會嘗試重新啟動站台 B 的虛擬機器，因為站台 B 的資料存放區因為儲存 ISL 故障而無法存取，因此最終會失敗。站台 B 也會再次出現類似的情況</block>
  <block id="7ae222a2c832e4ce999571e88803083d" category="paragraph">在一個或多個 ISL 故障的情況下、流量會繼續流經其餘的連結。如果兩個架構上的所有 ISL 都發生故障、使得儲存和 NVRAM 複寫站台之間沒有連結、則每個控制器都會繼續提供其本機資料。在至少還原一個 ISL 上，所有的叢會自動重新同步。</block>
  <block id="33cb67cb29131f1d0275317dce2cf236" category="paragraph">在對等叢集連結故障案例中、由於 Fabric ISL 仍處於作用中狀態、因此兩個站台的資料服務（讀取和寫入）都會繼續存在於兩個叢集。任何叢集組態變更（例如、新增 SVM 、在現有 SVM 中配置 Volume 或 LUN ）都無法傳播到其他站台。這些資料會保留在本機 CRS 中繼資料磁碟區中，並在還原對等叢集連結時自動傳播到其他叢集。如果必須強制切換才能還原對等叢集連結、則在切換程序中、仍在運作中的站台上、中繼資料磁碟區的遠端複寫複本會自動重新播放未完成的叢集組態變更。</block>
  <block id="5cac5bfa9407e4851e57fffb3704c323" category="paragraph">VMware 的叢集技術可將 ESXi 伺服器分組為虛擬機器的共用資源集區，並提供 vSphere High Availability （ HA ）。 vSphere HA 可為在虛擬機器中執行的應用程式提供易於使用的高可用度。當叢集上啟用 HA 功能時、每部 ESXi 伺服器都會與其他主機保持通訊、以便在任何 ESXi 主機無回應或隔離時、 HA 叢集可在叢集中的未運作主機之間、協調在該 ESXi 主機上執行的虛擬機器的還原作業。萬一來賓作業系統發生故障， vSphere HA 可在同一部實體伺服器上重新啟動受影響的虛擬機器。 vSphere HA 可減少計畫性停機，避免非計畫性停機，並快速從停機中恢復。</block>
  <block id="13756f2a610f8f2a9bfce56369289ce1" category="paragraph">請務必瞭解 VMware vSphere 不知道 NetApp MetroCluster 或 SnapMirror 主動式同步，並視主機和 VM 群組關聯性組態而定，將 vSphere 叢集中的所有 ESXi 主機視為 HA 叢集作業的合格主機。</block>
  <block id="cb6dde9af508c07c13495c7ceb17dabf" category="paragraph">隔離回應是 vSphere HA 中的一項設定、可決定當 vSphere HA 叢集中的主機失去管理網路連線但仍繼續執行時、在虛擬機器上觸發的動作。此設定有三個選項：「已停用」，「關機並重新啟動 VM 」和「關機並重新啟動 VM 」。</block>
  <block id="f3392184f9671e794187188ae9003393" category="paragraph">「關機」比「關機」好，因為「關機」無法清除磁碟或提交交易的最新變更。如果虛擬機器在 300 秒內未關機、則會關閉電源。若要變更等待時間、請使用進階選項 das.isolationshutdowntimeout 。</block>
  <block id="5cda3e7fc012f3f66cb81b04173c232e" category="paragraph">NetApp 建議將「主機隔離回應」設為「已停用」。</block>
  <block id="d32f0f71e4c6ada2841e017ad5b25fab" category="paragraph">NetApp 建議將「使用 PDL 回應資料存放區」設定為「 * 關閉並重新啟動 VM* 」。偵測到這種情況時、將會在 vSphere HA 叢集中的健全主機上立即重新啟動 VM 。</block>
  <block id="990ae835e5ddcf593414be2262bdace1" category="list-text">NetApp 建議將「使用 APD 的資料存放區回應」設定為「 * 關閉並重新啟動 VM （保守） * 」。</block>
  <block id="ed239ad833fcd059d909a3b5c5ef32f0" category="list-text">如果 APD 狀態已解決，且在逾時之前已還原對儲存設備的存取，則除非您明確設定 HA ，否則 HA 不會不必要地重新啟動虛擬機器。如果即使環境已從 APD 條件恢復、仍需要回應、則 APD 逾時後的 APD 恢復回應應設定為重設虛擬機器。</block>
  <block id="2f567a5b33a98cbc762cbf67a7d2a620" category="section-title">適用於 NetApp SnapMirror Active Sync 的 VMware DRS 實作</block>
  <block id="c55b2a3b93f65c4f9532694d5e8ffba3" category="paragraph">VMware DRS 是一項功能、可將叢集中的主機資源集合在一起、主要用於在虛擬基礎架構中的叢集內進行負載平衡。VMware DRS 主要會計算 CPU 和記憶體資源、以便在叢集中執行負載平衡。由於 vSphere 不知道延伸叢集、因此在負載平衡時會考慮兩個站台中的所有主機。</block>
  <block id="7753c40d9b983d2079b72842e3406960" category="paragraph">NetApp 建議實作「應該」規則，而非「必須」規則，因為在發生故障時 vSphere HA 會違反這些規則。使用「必須」規則可能導致服務中斷。</block>
  <block id="e3537ea3aae3c4341dab60d15af5afd0" category="paragraph">服務的可用度應永遠高於效能。在完整資料中心故障的情況下，「必須」規則必須從 VM 主機關聯群組中選擇主機，而當資料中心無法使用時，虛擬機器將不會重新啟動。</block>
  <block id="b88201736c7c63fe1df854d89bf2427f" category="sidebar">為何選擇 ONTAP for VMware</block>
  <block id="4d68c6910c7e5b8e5f736a0a37eba4e6" category="paragraph">自從 ESX 在二十多年前引進現代化資料中心以來， ONTAP一直是 VMware vSphere 以及最近的 Cloud Foundation 的領先儲存解決方案。 NetApp持續推出創新系統，例如最新一代ASA A 系列，以及SnapMirror主動同步等功能。這些進步簡化了管理，增強了彈性，並降低了 IT 基礎架構的總擁有成本 (TCO)。</block>
  <block id="d51eebcc193505dec7ec133bd17d0702" category="paragraph">本文檔介紹了適用於 VMware Live Site Recovery (VLSR)（以前稱為 Site Recovery Manager (SRM)，VMware 業界領先的災難復原 (DR) 軟體）的ONTAP解決方案，包括最新產品資訊和最佳實踐，以簡化部署、降低風險並簡化持續管理。</block>
  <block id="3f17c15e23b90a1416deb27191a1348e" category="admonition">本文檔取代了先前發布的技術報告《TR-4900：使用 ONTAP 的 VMware Site Recovery Manager》</block>
  <block id="2c958a4052929ded88125b8785727f4a" category="paragraph">由ONTAP提供支援的NetApp資料管理平台是 VLSR 最廣泛採用的儲存解決方案之一。原因有很多：一個安全、高效能、統一協議（NAS 和 SAN 結合）的資料管理平台，提供產業定義的儲存效率、多租戶、服務品質控制、使用空間高效快照的資料保護以及使用SnapMirror的複製。所有這些都利用原生混合多雲整合來保護 VMware 工作負載，並提供大量自動化和編排工具。</block>
  <block id="5b2c42c877c0360cfec4222fd847686f" category="paragraph">當您使用SnapMirror進行基於陣列的複製時，您可以利用 ONTAP 最成熟、最成熟的技術之一。 SnapMirror為您提供安全、高效的資料傳輸優勢，僅複製更改的檔案系統區塊，而不是整個虛擬機器或資料儲存區。即使這些區塊也利用了空間節省功能，例如重複資料刪除、壓縮和壓縮。現代ONTAP系統現在使用與版本無關的SnapMirror，讓您可以靈活地選擇來源叢集和目標叢集。  SnapMirror確實已成為最強大的災難復原工具之一。</block>
  <block id="e6e16bd7b0eb9a9b6d1b84b252dfef52" category="paragraph">無論您使用的是傳統的 NFS、iSCSI 或光纖通道連接的資料儲存（現在支援vVols資料儲存），VLSR 都能提供強大的第一方產品，利用ONTAP的最佳功能進行災難復原或資料中心遷移規劃和編排。</block>
  <block id="34ae253d12dacf4256947aab08d2797a" category="paragraph">在 VLSR 伺服器上安裝並設定 SRA 適配器以保護非 vVols 資料儲存區後，您可以開始設定 vSphere 環境以進行災難復原的任務。</block>
  <block id="aa1408f10ab599451ceb8278538aceb3" category="paragraph">VLSR 可以使用 NetApp 專有的FlexClone技術無中斷地測試您的 DR 計劃，以便在您的 DR 站點幾乎即時地克隆受保護的資料儲存。  VLSR 創建了一個沙箱來進行安全測試，以便在發生真正的災難時保護您的組織和客戶，讓您對組織在災難期間執行故障轉移的能力充滿信心。</block>
  <block id="4a3ecc4c037b88a5dd4a78c48aa300b8" category="cell">vSphere 7.0 到 8.0，設定為 128。  ESXi 8.0 之後的版本中將忽略此設定。</block>
  <block id="4ca458329416c6834c4fcde7d851a203" category="list-text">在高效能環境中使用非ASA系統或使用單一 LUN 資料儲存測試效能時，請考慮將循環 (VMW_PSP_RR) 路徑選擇策略 (PSP) 的負載平衡設定從預設 IOPS 設定 1000 變更為值 1。看<block ref="1687988694c35db61b845d7b15620672" category="inline-link-macro-rx"></block>了解更多。</block>
  <block id="b236a2de8d4b9a7647b4e38da0f41f0f" category="list-text">在 vSphere 6.7 Update 1 中，VMware 為 Round Robin PSP 引進了一種新的延遲負載平衡機制。現在，當使用具有 NVMe 命名空間的 HPP（高效能插件）以及 vSphere 8.0u2 及更高版本、iSCSI 和 FCP 連接的 LUN 時，也可以使用延遲選項。新選項在選擇 I/O 最佳路徑時會考慮 I/O 頻寬和路徑延遲。 NetApp建議在具有非等效路徑連接的環境中使用延遲選項，例如一條路徑上的網路跳數比另一條路徑上的網路跳數更多的情況，或使用NetApp ASA系統時。看<block ref="d244127cef9364538ba1012ad8871adc" category="inline-link-rx"></block>了解更多。</block>
  <block id="8c243b1b00784482e5851745cf6cbb46" category="paragraph">客戶可以放心地選擇ONTAP for vSphere 作為 SAN 和 NAS 儲存解決方案。最新的 All SAN 陣列採用了新的簡化分解儲存架構，為 SAN 儲存管理員提供了熟悉的簡化體驗，同時保留了傳統ONTAP系統的大部分整合和功能集。 ONTAP系統提供卓越的快照保護和強大的管理工具。透過將功能卸載到專用存儲， ONTAP可以最大限度地利用主機資源、降低成本並保持最佳效能。此外，可以使用 Storage vMotion 輕鬆跨 VMFS、NFS 或vVols遷移工作負載。</block>
  <block id="90d5572babcb90a9380df46334d2e1e8" category="paragraph">ONTAP與 vSphere 結合使用是一種很好的組合，可讓您減少主機硬體和 VMware 軟體的費用。您還可以以較低的成本保護您的數據，同時保持一致的高效能。由於虛擬化工作負載是移動的，您可以探索使用 Storage vMotion 的不同方法在同一儲存系統上跨 VMFS、NFS 或vVols資料儲存移動虛擬機器。</block>
  <block id="e74fa8c8fcfd6e51d8817a758d558fc7" category="paragraph">以下是當今客戶重視的關鍵因素：</block>
  <block id="bf6e1db9bc182aafee86baa8047fa767" category="list-text">*統一儲存。 *運行ONTAP 的系統在幾個重要方面是統一的。最初，這種方法同時涉及 NAS 和 SAN 協議， ONTAP繼續成為 SAN 的領先平台，同時又具有 NAS 方面的原始優勢。在 vSphere 世界中，這種方法也意味著虛擬桌面基礎架構 (VDI) 與虛擬伺服器基礎架構 (VSI) 的統一系統。運行ONTAP 的系統對於 VSI 而言通常比傳統企業陣列更便宜，並且具有高級儲存效率功能，可在同一系統中處理 VDI。 ONTAP還統一了各種儲存介質，從 SSD 到 SATA，並且可以輕鬆擴展到雲端。沒有必要為了效能而購買一個儲存作業系統，為了歸檔而購買另一個，為了雲端而購買另一個。  ONTAP將它們全部連結在一起。</block>
  <block id="2afba2255c7be3f11ffd2cc4f8b80e6f" category="list-text">*虛擬捲和基於儲存策略的管理。 * NetApp是 VMware 在 vSphere Virtual Volumes (vVols) 開發方面的早期設計合作夥伴，為vVols和 VMware vSphere APIs for Storage Awareness (VASA) 提供架構輸入和早期支援。這種方法不僅為 VMFS 帶來了細粒度的 VM 儲存管理，還支援透過基於儲存策略的管理實現儲存配置的自動化。這種方法允許儲存架構師設計具有不同功能的儲存池，以便虛擬機器管理員輕鬆使用。  ONTAP在 vVol 規模方面處於儲存產業領先地位，在單一叢集中支援數十萬個vVols ，而企業陣列和小型快閃陣列供應商每個陣列僅支援數千個vVols 。  NetApp也透過即將推出的功能推動細粒度 VM 管理的發展。</block>
  <block id="6876f82e64fd9d6a64f99665e3913906" category="list-text">*儲存效率。 *儘管NetApp是第一個為生產工作負載提供重複資料刪除功能的公司，但這項創新並不是該領域的第一次或最後一次創新。它從快照開始，這是一種節省空間且不會影響效能的資料保護機制，同時結合FlexClone技術，可立即為生產和備份使用製作虛擬機器的讀取/寫入副本。  NetApp繼續提供內聯功能，包括重複資料刪除、壓縮和零區塊重複資料刪除，以從昂貴的 SSD 中榨取最多的儲存空間。 ONTAP還增加了使用壓縮將較小的 I/O 操作和檔案打包到磁碟區塊中的功能。這些功能的結合使得客戶普遍看到 VSI 節省高達 5:1，VDI 節省高達 30:1。最新一代ONTAP系統還包括硬體加速壓縮和重複資料刪除功能，可進一步提高儲存效率並降低成本。這種方法可讓您在更少的空間內儲存更多數據，從而降低整體儲存成本並提高效能。  NetApp對其儲存效率功能非常有信心，因此提供了一個連結： https://www.netapp.com/pdf.html?item=/media/79014-ng-937-Efficiency-Guarantee-Customer-Flyer.pdf item=/media/79014-ng-937-Efficiency-Guarantee-Customer-Flyer.pdf [效率保證^]。</block>
  <block id="a54f2a3da40d66f7a06b1a0b6fdfa9a8" category="list-text">*多租戶* ONTAP長期以來一直是多租戶領域的領導者，可讓您在單一叢集上建立多個儲存虛擬機器 (SVM)。這種方法可讓您隔離工作負載並為不同的租戶提供不同等級的服務，使其成為服務提供者和大型企業的理想選擇。最新一代ONTAP系統還包括對租戶容量管理的支援。此功能可讓您為每個租用戶設定容量限制，確保沒有單一租用戶可以消耗所有可用資源。這種方法有助於確保所有租戶都能獲得他們期望的服務級別，同時也能在租戶之間提供高級別的安全性和隔離。此外，ONTAP 的多租戶功能與 VMware 的 vSphere 平台集成，讓您可以透過以下方式輕鬆管理和監控虛擬化環境<block ref="238135431b1a2d25dda1f29146112b60" category="inline-link-rx"></block>和<block ref="409cf7667ac8df435e8d9883234935b9" category="inline-link-rx"></block>。</block>
  <block id="2a2939154778c60691f9f31e86248f82" category="list-text">*混合雲。 *無論用於本地私有雲、公有雲基礎架構或結合兩者優點的混合雲， ONTAP解決方案都可以協助您建置資料結構以簡化和最佳化資料管理。從高效能全快閃系統開始，然後將它們與磁碟或雲端儲存系統結合，以實現資料保護和雲端運算。從 Azure、AWS、IBM 或 Google Cloud 中選擇，以優化成本並避免鎖定。根據需要利用對 OpenStack 和容器技術的進階支援。  NetApp還為ONTAP提供基於雲端的備份（ SnapMirror Cloud、 Cloud Backup Service和Cloud Sync）以及儲存分層和歸檔工具（FabricPool ），以協助降低營運費用並利用雲端的廣泛覆蓋範圍。</block>
  <block id="ea286565525af4dcaa423ad23150249f" category="paragraph">每個NetApp SVM 在 Site Recovery Manager 中都被視為唯一陣列。VLSR 支援某些陣列到陣列（或 SVM 到 SVM）複製佈局。</block>
  <block id="229406b7ca97303faec1240cf4a1fc11" category="section-title">VMFS 支援SnapMirror主動同步</block>
  <block id="1843642fc06043e7400ba7901fad582a" category="paragraph">ONTAP工具 10.3 及更高版本也支援使用SnapMirror主動同步 (SMas) 保護您的 VMFS 資料儲存庫。這使得兩個相對較近的資料中心（稱為故障域）之間的業務連續性能夠實現透明的故障轉移。然後可以透過 VLSR 的ONTAP工具 SRA 使用非同步SnapMirror來協調遠距離災難復原。</block>
  <block id="eb9f146fc1b0b4bc5e3804fa7d20b1a5" category="inline-link">了解ONTAP SnapMirror主動同步</block>
  <block id="7bcca325804b87edcbde47da8ec3bb3c" category="paragraph"><block ref="7bcca325804b87edcbde47da8ec3bb3c" category="inline-link-rx"></block></block>
  <block id="a0b90d1e79d4aef818085b3423183ae7" category="paragraph">資料儲存區被收集在一個一致性群組 (CG) 中，並且所有資料儲存區的虛擬機器都將作為相同 CG 的成員保持寫入順序一致。</block>
  <block id="d27c7eb1b19cbebab6552ca4574e51e5" category="paragraph">一些例子可能是柏林和漢堡的網站受 SMas 保護，第三個網站副本使用SnapMirror非同步並受 VLSR 保護。另一個例子可能是使用 SMas 保護紐約和新澤西的站點，並保護芝加哥的第三個站點。</block>
  <block id="3b2b0ebfa27de38f05b20b21651ca265" category="inline-image-macro">SMas佈局</block>
  <block id="65e70274fc1f803a54b1efd4b9ef1df0" category="paragraph"><block ref="65e70274fc1f803a54b1efd4b9ef1df0" category="inline-image-macro-rx" type="image"></block></block>
  <block id="aff39d99fde3099978b06c2121c26bd9" category="paragraph">在設計基於虛擬機器的應用程式時，請考慮未來的雲端移動性。例如，不要將應用程式和資料檔案放在一起，而是對資料使用單獨的 LUN 或 NFS 匯出。這使您可以將虛擬機器和資料分別遷移到雲端服務。</block>
  <block id="a34428791f8c5ce4b1184d505db69402" category="inline-link-macro">備份和恢復文檔</block>
  <block id="48f148d7f57b20a6060d03bbcf7335ad" category="list-text"><block ref="48f148d7f57b20a6060d03bbcf7335ad" category="inline-link-macro-rx"></block></block>
  <block id="e198d5cba43e1161bc035f28e60cc161" category="inline-link-macro">災難復原文檔</block>
  <block id="d39786efdbd499fa740dd3765a7d5cf9" category="list-text"><block ref="d39786efdbd499fa740dd3765a7d5cf9" category="inline-link-macro-rx"></block></block>
  <block id="0da690016e4be64638cdfef258418203" category="inline-link">NetApp Backup and Recovery</block>
  <block id="cd7147239f56f957d4a7cc78ef256227" category="paragraph">此外，適用於 VMware 的SnapCenter插件可以與<block ref="ea219d297aff06b5ddbb99bc32d2e25b" category="inline-link-rx"></block>，為大多數ONTAP系統提供有效的 3-2-1 備份解決方案。請注意，如果使用具有高級服務的虛擬機器備份和恢復，可能會收取一些費用，例如用於額外備份儲存的物件儲存。本節概述了可用於保護虛擬機器和資料儲存的各種選項。</block>
  <block id="19cbafc0246850c97323cac4fb786794" category="section-title">NetApp Disaster Recovery</block>
  <block id="c256d43e8fa2b8e01df9b9333e730677" category="list-text">*儲存複製適配器。 *SRA 與 VMware Live Site Recovery (VLSR)/Site Recovery Manager (SRM) 一起使用，使用SnapMirror進行基於陣列的複製，管理生產站點和災難復原站點之間的資料複製。它可以在災難發生時自動執行故障轉移任務，並可以幫助無中斷地測試 DR 副本，以確保對 DR 解決方案的信心。</block>
  <block id="78dea62c276f3a86642777c27b42218f" category="paragraph">這<block ref="df7f63ec4790cd7696ac38c73a72d254" category="inline-link-rx"></block> 是 vCenter Server 的插件，可讓您管理虛擬機器 (VM) 和資料儲存區的備份和還原。它提供了一個單一介面來管理跨多個ONTAP系統的虛擬機器和資料儲存庫的備份、復原和複製。SnapCenter支援使用SnapMirror複製到輔助站點以及從輔助站點恢復。最新版本也支援SnapMirror到雲端（S3）、防篡改快照、 SnapLock和SnapMirror主動同步。適用於 VMware vSphere 的SnapCenter插件可以與SnapCenter應用程式插件集成，以提供應用程式一致的備份。</block>
  <block id="1e3f6786e57985e5818c765f46508ca6" category="inline-link">NetApp Disaster Recovery(DR)</block>
  <block id="9469e1759c7e42bfeb74f9c90db108cb" category="list-text">如果您打算使用儲存多租用戶而不是使用 vCenter 中的ONTAP叢集憑證將特定 SVM 指派給 vCenter，請依照下列步驟操作：</block>
  <block id="617275a68b9e63b5c1bdbaedd18295fb" category="list-text">如果*不*在 vCenter 中使用多租用戶 SVM：</block>
  <block id="618f681cdba2c4c2fc4bbcbf50528810" category="paragraph">ONTAP架構是一個靈活且可擴充的儲存平台，為資料儲存提供 SAN（FCP、iSCSI 和 NVMe-oF）和 NAS（NFS v3 和 v4.1）服務。NetApp AFF、 ASA和FAS儲存系統使用ONTAP作業系統為客戶儲存存取提供附加協議，如 S3 和 SMB/CIFS。</block>
  <block id="dece980ac7b814fce6a3ac5ab9c2c18d" category="paragraph">vSphere Metro Storage Cluster (vMSC) 是一種經過認證的配置，可保護虛擬機器 (VM) 和容器免受故障影響。這是透過使用延伸儲存概念以及 ESXi 主機叢集來實現的，這些叢集分佈在不同的故障域中，例如機架、建築物、校園甚至城市。NetApp MetroCluster和SnapMirror主動同步儲存技術用於為主機叢集提供零恢復點目標 (RPO=0) 保護。vMSC 配置旨在確保即使整個實體或邏輯「站點」發生故障，資料也始終可用。作為 vMSC 設定一部分的儲存設備必須在成功完成 vMSC 認證流程後進行認證。所有支援的儲存設備都可以在<block ref="34bc39e238eb497134ec6f46ab689fb0" category="inline-link-rx"></block>。</block>
  <block id="fd480a9146da7f38fc6111c24d64620e" category="paragraph">NetApp客戶已成功在 Azure 雲端執行所有 Epic 工作負載。  AWS 和 Google Cloud 也能夠運行 Epic 工作負載。  NetApp提供企業級功能和在雲端中有效運作 Epic 所需的效能。  NetApp雲端選項透過 iSCSI 提供區塊並透過 NFS 或 SMB 提供檔案。</block>
  <block id="c4a18a844b0430569f6e8b2d7bfc02b5" category="list-text">*第一方產品。 *Amazon FSx for NetApp ONTAP、 Google Cloud NetApp Volumes和Azure NetApp Files在領先的公有雲環境中提供高效能、多協定託管儲存服務。VMware Cloud on AWS（VMC on AWS）、Azure VMware Solution（AVS）和 Google Cloud VMware Engine（GCVE）可以直接將它們用作客戶作業系統（GOS）和運算執行個體的資料儲存或儲存。</block>
  <block id="e465d3a307ef6903982ceaea5de22f9a" category="list-text">*雲端服務。 *使用NetApp Backup and Recovery或SnapMirror Cloud 透過公有雲儲存保護來自本機系統的資料。NetApp Copy and Sync有助於在 NAS 和物件儲存之間遷移資料並保持資料同步。NetApp Disaster Recovery提供了一種經濟高效的解決方案，利用NetApp技術作為強大且功能強大的災難復原解決方案的基礎，適用於 DR 到雲端、DR 到本地以及本地到本地。</block>
  <block id="1e8675e287bf96049d13eb5bf5b6fac6" category="inline-link-macro">什麼是Azure NetApp Files？</block>
  <block id="0756abbe79f45685a93dcbd06502741d" category="list-text"><block ref="0756abbe79f45685a93dcbd06502741d" category="inline-link-macro-rx"></block></block>
  <block id="1e813c9851ad8226497585cd68a9aa1c" category="paragraph">NetApp提供以下優質軟體產品。它們不包含在ONTAP One 許可證中，必須單獨購買。</block>
  <block id="46aee8859cf7d350c8d57a3c97362a07" category="list-text"><block ref="84f74eb2e2d8d303e0cb7d49d5faf63f" category="inline-link-rx"></block>適用於 VMware vSphere。這是一項基於雲端的服務，為 VMware 環境提供災難復原和備份。它可以與SnapCenter一起使用，也可以單獨使用，並且支援使用 SAN 或 NAS 進行本地到本地的 DR，以及使用 NFS 進行本地到雲端/從雲端（如果支援）。</block>
  <block id="f2f7b54edfb5972f4e3e57e3873f8a6f" category="list-text"><block ref="32ac26eb0ba8de4f2245bdaa97bc7e60" category="inline-link-rx"></block>。這是一項基於雲端的服務，為 VMware 環境提供監控和分析。它支援異質儲存環境中的其他儲存供應商，以及多個交換器供應商和其他虛擬機器管理程式。DII 提供 VMware 環境的效能、容量和健康狀況的完整端到端洞察。</block>
  <block id="2d025755c29d2044d54015979818fb44" category="paragraph">除了AFF、 ASA和FAS系統上的ONTAP 9 之外， NetApp還支援ONTAP Select上的 VMware 工作負載、帶有 VMware Cloud on AWS 的Amazon FSx for NetApp 、帶有 Azure VMware Solution 的Azure NetApp Files 、具有 Google VMware Engine Cloud VMware Engine的 Cloudware Solution 、Google Cloud NetApp Volumes的Storage，但具體功能可能會因服務提供者和可用的網路連線而異。</block>
  <block id="2ee606af5da3062695cabb75a160eb48" category="inline-link">Equinix Metal 上的NetApp存儲</block>
  <block id="fea612aa54d66a179c5538c5cd1b8525" category="paragraph">將 VLSR 部署與ONTAP高級資料管理功能相集成，與本地儲存選項相比，可大幅提高規模和效能。但更重要的是，它帶來了混合雲的靈活性。混合雲可讓您透過使用FabricPool將高效能陣列中未使用的資料塊分層到您首選的超大規模器（可以是本地 S3 存儲，例如NetApp StorageGRID ）來節省資金。您也可以將SnapMirror用於基於邊緣的系統，並使用軟體定義的ONTAP Select或基於雲端的 DR<block ref="48f4ab00daadfbd5f3a95d2ba27ed047" category="inline-link-rx"></block>或其他託管ONTAP服務。</block>
  <block id="0fc9a0e7b30259b88ee28dc36905dc46" category="paragraph">災難復原 (DR) 是一種基於雲端的服務，可在災難發生時提供保護您的資料和應用程式的全面解決方案。它提供了一系列功能，包括自動故障轉移和故障復原、多個時間點復原點、應用程式一致的災難復原以及對本地和基於雲端的ONTAP系統的支援。NetApp Disaster Recovery旨在與ONTAP和您的 VMware vSphere 環境無縫協作，提供統一的災難復原解決方案。</block>
</blocks>