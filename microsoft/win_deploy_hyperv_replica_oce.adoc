---
sidebar: sidebar 
permalink: microsoft/win_deploy_hyperv_replica_oce.html 
keywords: Windows,Hyper-V,VHDX,VM,Virtual 
summary: 本附錄說明如何在叢集環境外部署 Hyper-V 複本。 
---
= 在叢集環境外部署 Hyper-V 複本
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
本附錄說明如何在叢集環境外部署 Hyper-V 複本。



== 先決條件

* 您需要位於相同或不同地理位置的獨立 Hyper-V 伺服器、作為主要和複本伺服器。
* 如果使用不同的站台、則必須設定每個站台的防火牆、以允許主要伺服器和複本伺服器之間的通訊。
* 複本伺服器必須有足夠的空間來儲存複寫的工作負載。




== 部署

. 設定複本伺服器。
+
.. 為了讓傳入的防火牆規則允許傳入的複寫流量、請執行下列 PowerShell Cmdlet ：
+
 Enable-Netfirewallrule -displayname "Hyper-V Replica HTTP Listener (TCP-In)"
.. 從 Server Manager 的「工具」區段開啟 Hyper-V Manager 。
.. 按一下「動作」中的「 Hyper-V 設定」。
.. 按一下 [ 複寫組態 ] ，然後選取 [ 將此電腦啟用為複本伺服器 ] 。
.. 在驗證和連接埠區段中、選取驗證方法和連接埠。
.. 在 [ 授權與儲存 ] 區段中，指定儲存複寫 VM 和檔案的位置。


. 在主伺服器上啟用 VM 複寫。VM 複寫是以每個 VM 為基礎啟用、而非針對整個 Hyper-V 伺服器。
+
.. 在 Hyper-V Manager 中、以滑鼠右鍵按一下虛擬機器、然後按一下「啟用複寫」以開啟「啟用複寫」精靈。
.. 提供必須複寫 VM 的複本伺服器名稱。
.. 提供驗證類型和複本伺服器連接埠、該伺服器連接埠已設定為在複本伺服器上接收複寫流量。
.. 選取要複寫的 VHD 。
.. 選擇將變更傳送至複本伺服器的頻率（持續時間）。
.. 設定還原點以指定複本伺服器上要維護的還原點數目。
.. 選擇初始複寫方法、指定將 VM 資料初始複本傳輸到複本伺服器的方法。
.. 檢閱摘要、然後按一下「完成」。
.. 此程序會在複本伺服器上建立 VM 複本。






== 複寫

. 執行測試容錯移轉、確保複本 VM 在複本伺服器上正常運作。測試會在複本伺服器上建立一個暫存 VM 。
+
.. 登入複本伺服器。
.. 在 Hyper-V Manager 中、以滑鼠右鍵按一下複本 VM 、按一下複寫、然後按一下測試容錯移轉。
.. 選擇要使用的恢復點。
.. 此程序會建立名稱相同的 VM 、並附加 -Test 。
.. 驗證虛擬機器、確保一切正常運作。
.. 容錯移轉之後、如果您為複本測試 VM 選取停止測試容錯移轉、則會刪除該虛擬機器。


. 執行計畫性容錯移轉、將主要 VM 上的最新變更複寫到複本 VM 。
+
.. 登入主要伺服器。
.. 關閉要容錯移轉的 VM 。
.. 在 Hyper-V Manager 中、以滑鼠右鍵按一下關閉的 VM 、按一下「複寫」、然後按一下「規劃容錯移轉」。
.. 按一下容錯移轉、將最新的 VM 變更傳輸至複本伺服器。


. 在主 VM 故障時執行非計畫性容錯移轉。
+
.. 登入複本伺服器。
.. 在 Hyper-V Manager 中、以滑鼠右鍵按一下複本 VM 、按一下複寫、然後按一下容錯移轉。
.. 選擇要使用的恢復點。
.. 按一下「容錯移轉」以容錯移轉 VM 。



