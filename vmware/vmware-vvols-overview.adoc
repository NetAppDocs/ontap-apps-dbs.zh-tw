---
sidebar: sidebar 
permalink: vmware/vmware-vvols-overview.html 
keywords: tr-4400, vvols, ontap, virtual volumes 
summary: 以下是 VMware vSphere 虛擬磁碟區（ VVols ）與 ONTAP 的概觀 
---
= 總覽
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
ONTAP 在過去二十多年來一直是 VMware vSphere 環境的領先儲存解決方案、並持續新增創新功能來簡化管理、同時降低成本。

本文件涵蓋適用於 VMware vSphere 虛擬磁碟區（ VVols ）的 ONTAP 功能、包括最新的產品資訊和使用案例、以及最佳實務做法和其他資訊、可簡化部署並減少錯誤。


NOTE: 本文件將先前發佈的技術報告 _TR-4400: VMware vSphere 虛擬磁碟區（ vVols ）取代為 ONTAP

最佳實務做法是輔助其他文件、例如指南和相容性清單。這些技術是根據實驗室測試和NetApp工程師與客戶廣泛的現場經驗所開發。它們可能不是唯一可行或受支援的實務做法、但通常是最簡單的解決方案、可滿足大多數客戶的需求。


NOTE: 本文件已更新，包含 vSphere 8.0 更新 3 ， ONTAP 工具 10.4 版本和新 NetApp ASA 系統中的新 vVols 功能。



== 虛擬磁碟區（ vVols ）概觀

NetApp 於 2012 年開始與 VMware 合作、為 vSphere 5 支援 vSphere API for Storage Aware （ VASA ）。此早期的 VASA Provider 允許定義設定檔中的儲存功能、以便在資源配置時用來篩選資料存放區、並在之後檢查原則是否符合規定。隨著時間演進、新增新功能以實現更多自動化資源配置、並新增虛擬磁碟區或 vVols 、其中個別的儲存物件用於虛擬機器檔案和虛擬磁碟。這些物件可以是 LUN ，檔案，現在可以是 vSphere 8 NVMe 命名空間（搭配 ONTAP 工具 9.13P2 使用）。NetApp 與 VMware 密切合作，作為 2015 年 vSphere 6 所發佈 vVols 的參考合作夥伴，並再次成為 vSphere 8 中使用 NVMe over Fabrics 的 vVols 設計合作夥伴。NetApp 持續強化 vVols 、以充分利用 ONTAP 的最新功能。

有幾個元件需要注意：



=== VASA供應商

這是處理 VMware vSphere 與儲存系統之間通訊的軟體元件。對於 ONTAP 、 VASA Provider 會在名為 ONTAP tools for VMware vSphere 的應用裝置（簡稱 ONTAP 工具）中執行。ONTAP 工具也包括 vCenter 外掛程式、適用於 VMware Site Recovery Manager 的儲存複寫介面卡（ SRA ）、以及用於建置自己自動化的 REST API 伺服器。ONTAP 工具在 vCenter 中設定及登錄後、就不再需要直接與 ONTAP 系統互動、因為幾乎所有的儲存需求都可以直接從 vCenter UI 中進行管理、或透過 REST API 自動化來進行管理。



=== 傳輸協定端點（ PE ）

傳輸協定端點是 ESXi 主機和 vVols 資料存放區之間 I/O 的 Proxy 。ONTAP VASA Provider 會自動建立這些 LUN 、每個 VVols 資料存放區的 FlexVol 磁碟區一個傳輸協定端點 LUN （大小為 4 MB ）、或是在資料存放區中主控 FlexVol 磁碟區的儲存節點上、每個 NFS 介面（ LIF ）一個 NFS 裝載點。ESXi 主機直接裝載這些傳輸協定端點、而非個別的 vVol LUN 和虛擬磁碟檔案。不需要管理 VASA Provider 自動建立、掛載、卸載及刪除的傳輸協定端點、以及任何必要的介面群組或匯出原則。



=== 虛擬傳輸協定端點（ VPE ）

vSphere 8 的新功能是、搭配 vVols 使用 NVMe over Fabrics （ NVMe of ）時、 ONTAP 中不再有傳輸協定端點的概念。相反地、只要第一個虛擬機器開機、 ESXi 主機就會為每個 ANA 群組自動產生一個虛擬 PE 。ONTAP 會自動為資料存放區所使用的每個 FlexVol 磁碟區建立全日空群組。

使用 NVMe for VVols 的另一個優點是、 VASA Provider 不需要任何繫結要求。而是由 ESXi 主機根據 VPE 在內部處理 vVol 繫結功能。這可減少 vVol 綁定風暴對服務造成影響的機會。

如需詳細資訊、請參閱 https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-storage/GUID-23B47AAC-6A31-466C-84F9-8CF8F1CDD149.html["NVMe 和虛擬磁碟區"^] 開啟 https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-storage/GUID-23B47AAC-6A31-466C-84F9-8CF8F1CDD149.html["vmware.com"^]



=== 虛擬 Volume 資料存放區

| 虛擬磁碟區資料儲存是vVols容器的邏輯資料儲存表示，由 VASA 供應商建立和維護。此容器代表由 VASA 提供者管理的儲存系統提供的儲存容量池。ONTAP工具支援將多個FlexVol磁碟區（稱為後備磁碟區）指派給單一vVols資料存儲，這些vVols資料儲存可跨越ONTAP叢集中的多個節點，將具有不同功能的快閃記憶體和混合系統結合。管理員可以使用設定精靈或 REST API 建立新的FlexVol卷，或選擇預先建立的FlexVol磁碟區作為後備儲存（如果有的話）。



=== 虛擬磁碟區（ vVols ）

vVols是儲存在vVols資料儲存中的實際虛擬機器檔案和磁碟。使用術語 vVol（單數）指的是單一特定檔案、LUN 或命名空間。ONTAP根據資料儲存所使用的協定建立 NVMe 命名空間、LUN 或檔案。vVols)有幾種不同的類型；最常見的包括設定磁碟區 (Config，唯一使用 VMFS 檔案系統的捲，包含元資料文件，例如虛擬機器的 VMX 檔案)、資料磁碟區 (Data，虛擬磁碟或 VMDK) 和交換磁碟區 (Swap，在虛擬機器啟動時建立)。受 VMware 虛擬機器加密保護的vVols區類型為「其他」。VMware VM 加密不應與ONTAP磁碟區或聚合加密混淆。



== 基於政策的管理

VMware vSphere API for Storage Awareness (VASA) 讓虛擬機器管理員能夠輕鬆使用配置虛擬機器所需的任何儲存功能，而無需與儲存團隊互動。在 VASA 出現之前，虛擬機器管理員可以定義虛擬機器存儲策略，但必須與存儲管理員合作來確定合適的資料存儲，通常是透過文件或命名約定來實現的。透過 VASA，具有相應權限的 vCenter 管理員可以定義一系列儲存功能，供 vCenter 使用者用於設定虛擬機器。VM 儲存策略與資料儲存功能之間的對應關係，使得 vCenter 能夠顯示可供選擇的相容資料儲存列表，並支援其他技術，例如 VCF（以前稱為 Aria 和 vRealize）自動化或 VMware vSphere Kubernetes 服務 (VKS)，從指派的策略中自動選擇儲存。這種方法稱為基於儲存策略的管理。雖然 VASA Provider 規則和 VM 儲存策略也可以與傳統資料儲存一起使用，但我們在這裡的重點是vVols資料儲存。



=== VM 儲存原則

VM 儲存原則是在 vCenter 的原則和設定檔下建立。對於 vVols 、請使用 NetApp vVols 儲存類型供應商的規則來建立規則集。ONTAP 工具 10.X 現在提供比 ONTAP 工具 9.X 更簡單的方法，可讓您直接在 VM 儲存原則本身中指定儲存屬性。

如上所述，使用原則可協助簡化 VM 或 VMDK 的資源配置工作。只要選取適當的原則， VASA Provider 就會顯示支援該原則的 VVols 資料存放區，並將 VVol 置入符合法規的個別 FlexVol volume 。



=== 使用儲存原則部署 VM

image::vvols-image3.png[使用儲存原則部署虛擬機器,800,480]

一旦虛擬機器完成配置，VASA 提供者將繼續檢查合規性，並在備份磁碟區不再符合政策時透過 vCenter 中的警報提醒虛擬機器管理員。



=== VM 儲存原則法規遵循

image::vvols-image4.png[虛擬機器儲存原則符合性,320,100]



== NetApp VVols 支援

ONTAP自 2012 年首次發布以來就一直支援 VASA 規範。雖然其他NetApp儲存系統可能支援 VASA，但本文檔重點介紹目前支援的ONTAP 9 版本。



=== ONTAP

除了AFF、 ASA和FAS系統上的ONTAP 9 之外， NetApp還支援ONTAP Select上的 VMware 工作負載、帶有 VMware Cloud on AWS 的Amazon FSx for NetApp 、帶有 Azure VMware Solution 的Azure NetApp Files 、具有 Google VMware Engine Cloud VMware Engine的 Cloudware Solution 、Google Cloud NetApp Volumes的Storage，但具體功能可能會因服務提供者和可用的網路連線而異。

截至本文發佈時，超大規模環境僅限於傳統的 NFS v3 資料儲存；因此， vVols僅適用於本地ONTAP系統，或提供本地系統全部功能的雲端連接系統，例如NetApp合作夥伴和全球服務供應商託管的系統。

_ 如需 ONTAP 的詳細資訊、請參閱 https://docs.netapp.com/us-en/ontap-family/["產品文件ONTAP"^]_

_ 如需 ONTAP 和 VMware vSphere 最佳實務做法的詳細資訊、請參閱 link:vmware-vsphere-overview.html["TR-4597"^]_



== 搭配 ONTAP 使用 vVols 的優點

2015 年，VMware 在 VASA 2.0 中引入了vVols支持，他們將其描述為「一個整合和管理框架，為外部儲存（SAN/NAS）提供了一種新的操作模式」。這種運作模式與ONTAP儲存結合，具有諸多優勢。



=== 基於政策的管理

如第 1.2 節所述，基於策略的管理允許使用預先定義的策略來設定和隨後管理虛擬機器。這可以從多方面幫助IT維：

* 提高速度。ONTAP工具消除了 vCenter 管理員為儲存設定活動向儲存團隊開立工單的需求。但是，透過限制對特定功能的訪問， ONTAP工具在 vCenter 和ONTAP系統中的 RBAC 角色仍然允許獨立團隊（例如儲存團隊）或同一團隊的獨立活動。
* * 更聰明的資源配置。 * 儲存系統功能可透過 VASA API 公開、讓資源配置工作流程能夠充分利用進階功能、而無需 VM 管理員瞭解如何管理儲存系統。
* * 更快的資源配置。 * 可在單一資料存放區中支援不同的儲存功能、並根據 VM 原則自動選擇適合的 VM 。
* * 避免錯誤。 * 儲存和 VM 原則是事先開發的、並可視需要套用、而無需每次佈建 VM 時都自訂儲存設備。當儲存功能從定義的原則中移出時、就會發出法規遵循警報。如前所述、 SCP 可讓初始資源配置可預測且可重複執行、而 VM 儲存原則則以 SCP 為基礎、則可確保正確放置。
* * 更好的容量管理。 *Vasa 與 ONTAP 工具可視需要將儲存容量降至個別的集合層級、並在容量開始不足時提供多層警示。




=== 現代化 SAN 上的 VM 精細管理

使用光纖通道和 iSCSI 的 SAN 儲存系統是 VMware ESX 最早支援的儲存系統，但它們缺乏從儲存系統管理單一 VM 檔案和磁碟的功能。相反，系統會設定 LUN，然後由 VMFS 管理各個檔案。這使得儲存系統難以直接管理單一虛擬機器的儲存效能、複製和保護。 vVols 結合了vVols儲存用戶已經享有的儲存粒度，以及ONTAP強大的高效能 SAN 功能。

現在，借助 vSphere 8 和ONTAP tools for VMware vSphere， vVols用於傳統 SCSI 協定的那些精細控制功能，現在也可以在現代光纖通道 SAN 中使用 NVMe over Fabrics 來實現，從而在規模上獲得更高的效能。透過 vSphere 8.0 更新 1，現在可以部署完整的端對端 NVMe 解決方案，使用vVols，而無需在虛擬機器管理程式儲存堆疊中進行任何 I/O 轉換。



=== 更強大的儲存卸載功能

雖然 VAAI 提供各種卸載到儲存的操作，但 VASA 提供者可以解決一些問題。SAN VAAI 無法將 VMware 管理的快照卸載到儲存系統。NFS VAAI 可以卸載 VM 管理的快照，但對具有儲存原生快照的 VM 存在一些限制。由於vVols使用單獨的 LUN、命名空間或檔案作為虛擬機器磁碟， ONTAP可以快速且有效率地複製檔案或 LUN，從而建立 VM 粒度的快照，不再需要增量檔案。NFS VAAI 也不支援熱（通電）Storage vMotion 遷移的卸載克隆操作。當使用 VAAI 和傳統 NFS 資料儲存時，必須關閉虛擬機器電源才能卸載遷移任務。ONTAP工具中的 VASA 提供者可實現近乎即時、儲存高效的熱遷移和冷遷移克隆，並且還支援對vVols進行近乎即時的跨磁碟區遷移複製。由於這些顯著的儲存效率優勢，您或許能夠充分利用vVols工作負載。 https://www.netapp.com/pdf.html?item=/media/8207-flyer-efficiency-guaranteepdf.pdf["效率保證"] 程式.同樣，如果使用 VAAI 進行跨卷克隆不能滿足您的要求，那麼借助vVols 的複製體驗改進，您很可能能夠解決您的業務難題。



=== vVols 的常見使用案例

除了這些優點之外、我們也會看到 vVol 儲存設備的常見使用案例：

* * 隨選虛擬機器資源配置 *
+
** 私有雲或服務供應商 IaaS 。
** 透過 Aria （前身為 vRealize ）套件， OpenStack 等，充分運用自動化與協調功能。


* * 一流磁碟（ FCD ） *
+
** VMware vSphere Kubernetes Service (VKS) 持久化磁碟區。
** 透過獨立的 VMDK 生命週期管理提供類似 Amazon EBS 的服務。


* * 隨需提供暫存虛擬機器 *
+
** 測試 / 開發實驗室
** 訓練環境






=== vVols 的常見優點

在充分發揮其優勢時（例如在上述使用案例中）、 vVols 提供下列具體改善：

* 在ONTAP叢集中，克隆可以在單一磁碟區內或跨多個磁碟區快速創建，這比傳統的啟用 VAAI 的克隆具有優勢。它們還具有良好的存儲效率。卷內的克隆使用ONTAP檔案克隆，類似FlexClone卷，僅儲存來源 vVol 檔案/LUN/命名空間的變更。因此，用於生產或其他應用程式用途的長期虛擬機器可以快速創建，佔用空間極小，並且可以受益於虛擬機器層級的保護（使用適用於 VMware vSphere 的NetApp SnapCenter插件、VMware 管理的快照或 VADP 備份）和效能管理（使用ONTAP QoS）。使用vVols進行跨卷克隆比使用 VAAI 快得多，因為使用 VASA，我們可以在複製完成之前建立克隆並允許在目標位置存取它。資料塊作為後台程序複製到目標 vVol。這與ONTAP對傳統 LUN 的非中斷式 LUN 遷移的工作方式類似。
* VVols 是搭配 vSphere CSI 使用 TKG 時的理想儲存技術、可提供由 vCenter 管理員管理的獨立儲存類別和容量。
* 亞馬遜 EBS 類服務可以透過 FCD 交付，因為 FCD VMDK 顧名思義是 vSphere 中的一等公民，其生命週期可以獨立於它可能附加到的虛擬機器進行管理。

